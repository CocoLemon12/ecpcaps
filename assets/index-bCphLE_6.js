(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const f of l.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&r(f)}).observe(document,{childList:!0,subtree:!0});function n(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(s){if(s.ep)return;s.ep=!0;const l=n(s);fetch(s.href,l)}})();var BS=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Xa(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var eM={exports:{}},Xb={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var R6;function Tee(){if(R6)return Xb;R6=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,s,l){var f=null;if(l!==void 0&&(f=""+l),s.key!==void 0&&(f=""+s.key),"key"in s){l={};for(var i in s)i!=="key"&&(l[i]=s[i])}else l=s;return s=l.ref,{$$typeof:t,type:r,key:f,ref:s!==void 0?s:null,props:l}}return Xb.Fragment=e,Xb.jsx=n,Xb.jsxs=n,Xb}var D6;function Eee(){return D6||(D6=1,eM.exports=Tee()),eM.exports}var ne=Eee(),tM={exports:{}},ga={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var L6;function Mee(){if(L6)return ga;L6=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),f=Symbol.for("react.context"),i=Symbol.for("react.forward_ref"),x=Symbol.for("react.suspense"),S=Symbol.for("react.memo"),I=Symbol.for("react.lazy"),R=Symbol.iterator;function F(Be){return Be===null||typeof Be!="object"?null:(Be=R&&Be[R]||Be["@@iterator"],typeof Be=="function"?Be:null)}var j={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},H=Object.assign,G={};function W(Be,bt,xe){this.props=Be,this.context=bt,this.refs=G,this.updater=xe||j}W.prototype.isReactComponent={},W.prototype.setState=function(Be,bt){if(typeof Be!="object"&&typeof Be!="function"&&Be!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Be,bt,"setState")},W.prototype.forceUpdate=function(Be){this.updater.enqueueForceUpdate(this,Be,"forceUpdate")};function J(){}J.prototype=W.prototype;function ie(Be,bt,xe){this.props=Be,this.context=bt,this.refs=G,this.updater=xe||j}var he=ie.prototype=new J;he.constructor=ie,H(he,W.prototype),he.isPureReactComponent=!0;var ge=Array.isArray,fe={H:null,A:null,T:null,S:null},ye=Object.prototype.hasOwnProperty;function pe(Be,bt,xe,Le,Xe,ct){return xe=ct.ref,{$$typeof:t,type:Be,key:bt,ref:xe!==void 0?xe:null,props:ct}}function be(Be,bt){return pe(Be.type,bt,void 0,void 0,void 0,Be.props)}function Ae(Be){return typeof Be=="object"&&Be!==null&&Be.$$typeof===t}function Oe(Be){var bt={"=":"=0",":":"=2"};return"$"+Be.replace(/[=:]/g,function(xe){return bt[xe]})}var ue=/\/+/g;function we(Be,bt){return typeof Be=="object"&&Be!==null&&Be.key!=null?Oe(""+Be.key):bt.toString(36)}function ke(){}function De(Be){switch(Be.status){case"fulfilled":return Be.value;case"rejected":throw Be.reason;default:switch(typeof Be.status=="string"?Be.then(ke,ke):(Be.status="pending",Be.then(function(bt){Be.status==="pending"&&(Be.status="fulfilled",Be.value=bt)},function(bt){Be.status==="pending"&&(Be.status="rejected",Be.reason=bt)})),Be.status){case"fulfilled":return Be.value;case"rejected":throw Be.reason}}throw Be}function je(Be,bt,xe,Le,Xe){var ct=typeof Be;(ct==="undefined"||ct==="boolean")&&(Be=null);var vt=!1;if(Be===null)vt=!0;else switch(ct){case"bigint":case"string":case"number":vt=!0;break;case"object":switch(Be.$$typeof){case t:case e:vt=!0;break;case I:return vt=Be._init,je(vt(Be._payload),bt,xe,Le,Xe)}}if(vt)return Xe=Xe(Be),vt=Le===""?"."+we(Be,0):Le,ge(Xe)?(xe="",vt!=null&&(xe=vt.replace(ue,"$&/")+"/"),je(Xe,bt,xe,"",function(yt){return yt})):Xe!=null&&(Ae(Xe)&&(Xe=be(Xe,xe+(Xe.key==null||Be&&Be.key===Xe.key?"":(""+Xe.key).replace(ue,"$&/")+"/")+vt)),bt.push(Xe)),1;vt=0;var Nt=Le===""?".":Le+":";if(ge(Be))for(var mt=0;mt<Be.length;mt++)Le=Be[mt],ct=Nt+we(Le,mt),vt+=je(Le,bt,xe,ct,Xe);else if(mt=F(Be),typeof mt=="function")for(Be=mt.call(Be),mt=0;!(Le=Be.next()).done;)Le=Le.value,ct=Nt+we(Le,mt++),vt+=je(Le,bt,xe,ct,Xe);else if(ct==="object"){if(typeof Be.then=="function")return je(De(Be),bt,xe,Le,Xe);throw bt=String(Be),Error("Objects are not valid as a React child (found: "+(bt==="[object Object]"?"object with keys {"+Object.keys(Be).join(", ")+"}":bt)+"). If you meant to render a collection of children, use an array instead.")}return vt}function ze(Be,bt,xe){if(Be==null)return Be;var Le=[],Xe=0;return je(Be,Le,"","",function(ct){return bt.call(xe,ct,Xe++)}),Le}function Ue(Be){if(Be._status===-1){var bt=Be._result;bt=bt(),bt.then(function(xe){(Be._status===0||Be._status===-1)&&(Be._status=1,Be._result=xe)},function(xe){(Be._status===0||Be._status===-1)&&(Be._status=2,Be._result=xe)}),Be._status===-1&&(Be._status=0,Be._result=bt)}if(Be._status===1)return Be._result.default;throw Be._result}var Fe=typeof reportError=="function"?reportError:function(Be){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var bt=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Be=="object"&&Be!==null&&typeof Be.message=="string"?String(Be.message):String(Be),error:Be});if(!window.dispatchEvent(bt))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Be);return}console.error(Be)};function Qe(){}return ga.Children={map:ze,forEach:function(Be,bt,xe){ze(Be,function(){bt.apply(this,arguments)},xe)},count:function(Be){var bt=0;return ze(Be,function(){bt++}),bt},toArray:function(Be){return ze(Be,function(bt){return bt})||[]},only:function(Be){if(!Ae(Be))throw Error("React.Children.only expected to receive a single React element child.");return Be}},ga.Component=W,ga.Fragment=n,ga.Profiler=s,ga.PureComponent=ie,ga.StrictMode=r,ga.Suspense=x,ga.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=fe,ga.act=function(){throw Error("act(...) is not supported in production builds of React.")},ga.cache=function(Be){return function(){return Be.apply(null,arguments)}},ga.cloneElement=function(Be,bt,xe){if(Be==null)throw Error("The argument must be a React element, but you passed "+Be+".");var Le=H({},Be.props),Xe=Be.key,ct=void 0;if(bt!=null)for(vt in bt.ref!==void 0&&(ct=void 0),bt.key!==void 0&&(Xe=""+bt.key),bt)!ye.call(bt,vt)||vt==="key"||vt==="__self"||vt==="__source"||vt==="ref"&&bt.ref===void 0||(Le[vt]=bt[vt]);var vt=arguments.length-2;if(vt===1)Le.children=xe;else if(1<vt){for(var Nt=Array(vt),mt=0;mt<vt;mt++)Nt[mt]=arguments[mt+2];Le.children=Nt}return pe(Be.type,Xe,void 0,void 0,ct,Le)},ga.createContext=function(Be){return Be={$$typeof:f,_currentValue:Be,_currentValue2:Be,_threadCount:0,Provider:null,Consumer:null},Be.Provider=Be,Be.Consumer={$$typeof:l,_context:Be},Be},ga.createElement=function(Be,bt,xe){var Le,Xe={},ct=null;if(bt!=null)for(Le in bt.key!==void 0&&(ct=""+bt.key),bt)ye.call(bt,Le)&&Le!=="key"&&Le!=="__self"&&Le!=="__source"&&(Xe[Le]=bt[Le]);var vt=arguments.length-2;if(vt===1)Xe.children=xe;else if(1<vt){for(var Nt=Array(vt),mt=0;mt<vt;mt++)Nt[mt]=arguments[mt+2];Xe.children=Nt}if(Be&&Be.defaultProps)for(Le in vt=Be.defaultProps,vt)Xe[Le]===void 0&&(Xe[Le]=vt[Le]);return pe(Be,ct,void 0,void 0,null,Xe)},ga.createRef=function(){return{current:null}},ga.forwardRef=function(Be){return{$$typeof:i,render:Be}},ga.isValidElement=Ae,ga.lazy=function(Be){return{$$typeof:I,_payload:{_status:-1,_result:Be},_init:Ue}},ga.memo=function(Be,bt){return{$$typeof:S,type:Be,compare:bt===void 0?null:bt}},ga.startTransition=function(Be){var bt=fe.T,xe={};fe.T=xe;try{var Le=Be(),Xe=fe.S;Xe!==null&&Xe(xe,Le),typeof Le=="object"&&Le!==null&&typeof Le.then=="function"&&Le.then(Qe,Fe)}catch(ct){Fe(ct)}finally{fe.T=bt}},ga.unstable_useCacheRefresh=function(){return fe.H.useCacheRefresh()},ga.use=function(Be){return fe.H.use(Be)},ga.useActionState=function(Be,bt,xe){return fe.H.useActionState(Be,bt,xe)},ga.useCallback=function(Be,bt){return fe.H.useCallback(Be,bt)},ga.useContext=function(Be){return fe.H.useContext(Be)},ga.useDebugValue=function(){},ga.useDeferredValue=function(Be,bt){return fe.H.useDeferredValue(Be,bt)},ga.useEffect=function(Be,bt){return fe.H.useEffect(Be,bt)},ga.useId=function(){return fe.H.useId()},ga.useImperativeHandle=function(Be,bt,xe){return fe.H.useImperativeHandle(Be,bt,xe)},ga.useInsertionEffect=function(Be,bt){return fe.H.useInsertionEffect(Be,bt)},ga.useLayoutEffect=function(Be,bt){return fe.H.useLayoutEffect(Be,bt)},ga.useMemo=function(Be,bt){return fe.H.useMemo(Be,bt)},ga.useOptimistic=function(Be,bt){return fe.H.useOptimistic(Be,bt)},ga.useReducer=function(Be,bt,xe){return fe.H.useReducer(Be,bt,xe)},ga.useRef=function(Be){return fe.H.useRef(Be)},ga.useState=function(Be){return fe.H.useState(Be)},ga.useSyncExternalStore=function(Be,bt,xe){return fe.H.useSyncExternalStore(Be,bt,xe)},ga.useTransition=function(){return fe.H.useTransition()},ga.version="19.0.0",ga}var k6;function zD(){return k6||(k6=1,tM.exports=Mee()),tM.exports}var st=zD();const kt=Xa(st);var nM={exports:{}},Zb={},rM={exports:{}},iM={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var N6;function Cee(){return N6||(N6=1,function(t){function e(ze,Ue){var Fe=ze.length;ze.push(Ue);e:for(;0<Fe;){var Qe=Fe-1>>>1,Be=ze[Qe];if(0<s(Be,Ue))ze[Qe]=Ue,ze[Fe]=Be,Fe=Qe;else break e}}function n(ze){return ze.length===0?null:ze[0]}function r(ze){if(ze.length===0)return null;var Ue=ze[0],Fe=ze.pop();if(Fe!==Ue){ze[0]=Fe;e:for(var Qe=0,Be=ze.length,bt=Be>>>1;Qe<bt;){var xe=2*(Qe+1)-1,Le=ze[xe],Xe=xe+1,ct=ze[Xe];if(0>s(Le,Fe))Xe<Be&&0>s(ct,Le)?(ze[Qe]=ct,ze[Xe]=Fe,Qe=Xe):(ze[Qe]=Le,ze[xe]=Fe,Qe=xe);else if(Xe<Be&&0>s(ct,Fe))ze[Qe]=ct,ze[Xe]=Fe,Qe=Xe;else break e}}return Ue}function s(ze,Ue){var Fe=ze.sortIndex-Ue.sortIndex;return Fe!==0?Fe:ze.id-Ue.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;t.unstable_now=function(){return l.now()}}else{var f=Date,i=f.now();t.unstable_now=function(){return f.now()-i}}var x=[],S=[],I=1,R=null,F=3,j=!1,H=!1,G=!1,W=typeof setTimeout=="function"?setTimeout:null,J=typeof clearTimeout=="function"?clearTimeout:null,ie=typeof setImmediate<"u"?setImmediate:null;function he(ze){for(var Ue=n(S);Ue!==null;){if(Ue.callback===null)r(S);else if(Ue.startTime<=ze)r(S),Ue.sortIndex=Ue.expirationTime,e(x,Ue);else break;Ue=n(S)}}function ge(ze){if(G=!1,he(ze),!H)if(n(x)!==null)H=!0,De();else{var Ue=n(S);Ue!==null&&je(ge,Ue.startTime-ze)}}var fe=!1,ye=-1,pe=5,be=-1;function Ae(){return!(t.unstable_now()-be<pe)}function Oe(){if(fe){var ze=t.unstable_now();be=ze;var Ue=!0;try{e:{H=!1,G&&(G=!1,J(ye),ye=-1),j=!0;var Fe=F;try{t:{for(he(ze),R=n(x);R!==null&&!(R.expirationTime>ze&&Ae());){var Qe=R.callback;if(typeof Qe=="function"){R.callback=null,F=R.priorityLevel;var Be=Qe(R.expirationTime<=ze);if(ze=t.unstable_now(),typeof Be=="function"){R.callback=Be,he(ze),Ue=!0;break t}R===n(x)&&r(x),he(ze)}else r(x);R=n(x)}if(R!==null)Ue=!0;else{var bt=n(S);bt!==null&&je(ge,bt.startTime-ze),Ue=!1}}break e}finally{R=null,F=Fe,j=!1}Ue=void 0}}finally{Ue?ue():fe=!1}}}var ue;if(typeof ie=="function")ue=function(){ie(Oe)};else if(typeof MessageChannel<"u"){var we=new MessageChannel,ke=we.port2;we.port1.onmessage=Oe,ue=function(){ke.postMessage(null)}}else ue=function(){W(Oe,0)};function De(){fe||(fe=!0,ue())}function je(ze,Ue){ye=W(function(){ze(t.unstable_now())},Ue)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(ze){ze.callback=null},t.unstable_continueExecution=function(){H||j||(H=!0,De())},t.unstable_forceFrameRate=function(ze){0>ze||125<ze?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):pe=0<ze?Math.floor(1e3/ze):5},t.unstable_getCurrentPriorityLevel=function(){return F},t.unstable_getFirstCallbackNode=function(){return n(x)},t.unstable_next=function(ze){switch(F){case 1:case 2:case 3:var Ue=3;break;default:Ue=F}var Fe=F;F=Ue;try{return ze()}finally{F=Fe}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(ze,Ue){switch(ze){case 1:case 2:case 3:case 4:case 5:break;default:ze=3}var Fe=F;F=ze;try{return Ue()}finally{F=Fe}},t.unstable_scheduleCallback=function(ze,Ue,Fe){var Qe=t.unstable_now();switch(typeof Fe=="object"&&Fe!==null?(Fe=Fe.delay,Fe=typeof Fe=="number"&&0<Fe?Qe+Fe:Qe):Fe=Qe,ze){case 1:var Be=-1;break;case 2:Be=250;break;case 5:Be=1073741823;break;case 4:Be=1e4;break;default:Be=5e3}return Be=Fe+Be,ze={id:I++,callback:Ue,priorityLevel:ze,startTime:Fe,expirationTime:Be,sortIndex:-1},Fe>Qe?(ze.sortIndex=Fe,e(S,ze),n(x)===null&&ze===n(S)&&(G?(J(ye),ye=-1):G=!0,je(ge,Fe-Qe))):(ze.sortIndex=Be,e(x,ze),H||j||(H=!0,De())),ze},t.unstable_shouldYield=Ae,t.unstable_wrapCallback=function(ze){var Ue=F;return function(){var Fe=F;F=Ue;try{return ze.apply(this,arguments)}finally{F=Fe}}}}(iM)),iM}var z6;function Iee(){return z6||(z6=1,rM.exports=Cee()),rM.exports}var aM={exports:{}},Qu={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var B6;function Pee(){if(B6)return Qu;B6=1;var t=zD();function e(x){var S="https://react.dev/errors/"+x;if(1<arguments.length){S+="?args[]="+encodeURIComponent(arguments[1]);for(var I=2;I<arguments.length;I++)S+="&args[]="+encodeURIComponent(arguments[I])}return"Minified React error #"+x+"; visit "+S+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},s=Symbol.for("react.portal");function l(x,S,I){var R=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:R==null?null:""+R,children:x,containerInfo:S,implementation:I}}var f=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function i(x,S){if(x==="font")return"";if(typeof S=="string")return S==="use-credentials"?S:""}return Qu.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Qu.createPortal=function(x,S){var I=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!S||S.nodeType!==1&&S.nodeType!==9&&S.nodeType!==11)throw Error(e(299));return l(x,S,null,I)},Qu.flushSync=function(x){var S=f.T,I=r.p;try{if(f.T=null,r.p=2,x)return x()}finally{f.T=S,r.p=I,r.d.f()}},Qu.preconnect=function(x,S){typeof x=="string"&&(S?(S=S.crossOrigin,S=typeof S=="string"?S==="use-credentials"?S:"":void 0):S=null,r.d.C(x,S))},Qu.prefetchDNS=function(x){typeof x=="string"&&r.d.D(x)},Qu.preinit=function(x,S){if(typeof x=="string"&&S&&typeof S.as=="string"){var I=S.as,R=i(I,S.crossOrigin),F=typeof S.integrity=="string"?S.integrity:void 0,j=typeof S.fetchPriority=="string"?S.fetchPriority:void 0;I==="style"?r.d.S(x,typeof S.precedence=="string"?S.precedence:void 0,{crossOrigin:R,integrity:F,fetchPriority:j}):I==="script"&&r.d.X(x,{crossOrigin:R,integrity:F,fetchPriority:j,nonce:typeof S.nonce=="string"?S.nonce:void 0})}},Qu.preinitModule=function(x,S){if(typeof x=="string")if(typeof S=="object"&&S!==null){if(S.as==null||S.as==="script"){var I=i(S.as,S.crossOrigin);r.d.M(x,{crossOrigin:I,integrity:typeof S.integrity=="string"?S.integrity:void 0,nonce:typeof S.nonce=="string"?S.nonce:void 0})}}else S==null&&r.d.M(x)},Qu.preload=function(x,S){if(typeof x=="string"&&typeof S=="object"&&S!==null&&typeof S.as=="string"){var I=S.as,R=i(I,S.crossOrigin);r.d.L(x,I,{crossOrigin:R,integrity:typeof S.integrity=="string"?S.integrity:void 0,nonce:typeof S.nonce=="string"?S.nonce:void 0,type:typeof S.type=="string"?S.type:void 0,fetchPriority:typeof S.fetchPriority=="string"?S.fetchPriority:void 0,referrerPolicy:typeof S.referrerPolicy=="string"?S.referrerPolicy:void 0,imageSrcSet:typeof S.imageSrcSet=="string"?S.imageSrcSet:void 0,imageSizes:typeof S.imageSizes=="string"?S.imageSizes:void 0,media:typeof S.media=="string"?S.media:void 0})}},Qu.preloadModule=function(x,S){if(typeof x=="string")if(S){var I=i(S.as,S.crossOrigin);r.d.m(x,{as:typeof S.as=="string"&&S.as!=="script"?S.as:void 0,crossOrigin:I,integrity:typeof S.integrity=="string"?S.integrity:void 0})}else r.d.m(x)},Qu.requestFormReset=function(x){r.d.r(x)},Qu.unstable_batchedUpdates=function(x,S){return x(S)},Qu.useFormState=function(x,S,I){return f.H.useFormState(x,S,I)},Qu.useFormStatus=function(){return f.H.useHostTransitionStatus()},Qu.version="19.0.0",Qu}var j6;function Oee(){if(j6)return aM.exports;j6=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),aM.exports=Pee(),aM.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var F6;function Ree(){if(F6)return Zb;F6=1;var t=Iee(),e=zD(),n=Oee();function r(p){var b="https://react.dev/errors/"+p;if(1<arguments.length){b+="?args[]="+encodeURIComponent(arguments[1]);for(var M=2;M<arguments.length;M++)b+="&args[]="+encodeURIComponent(arguments[M])}return"Minified React error #"+p+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)}var l=Symbol.for("react.element"),f=Symbol.for("react.transitional.element"),i=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),I=Symbol.for("react.profiler"),R=Symbol.for("react.provider"),F=Symbol.for("react.consumer"),j=Symbol.for("react.context"),H=Symbol.for("react.forward_ref"),G=Symbol.for("react.suspense"),W=Symbol.for("react.suspense_list"),J=Symbol.for("react.memo"),ie=Symbol.for("react.lazy"),he=Symbol.for("react.offscreen"),ge=Symbol.for("react.memo_cache_sentinel"),fe=Symbol.iterator;function ye(p){return p===null||typeof p!="object"?null:(p=fe&&p[fe]||p["@@iterator"],typeof p=="function"?p:null)}var pe=Symbol.for("react.client.reference");function be(p){if(p==null)return null;if(typeof p=="function")return p.$$typeof===pe?null:p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case x:return"Fragment";case i:return"Portal";case I:return"Profiler";case S:return"StrictMode";case G:return"Suspense";case W:return"SuspenseList"}if(typeof p=="object")switch(p.$$typeof){case j:return(p.displayName||"Context")+".Provider";case F:return(p._context.displayName||"Context")+".Consumer";case H:var b=p.render;return p=p.displayName,p||(p=b.displayName||b.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case J:return b=p.displayName||null,b!==null?b:be(p.type)||"Memo";case ie:b=p._payload,p=p._init;try{return be(p(b))}catch{}}return null}var Ae=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Oe=Object.assign,ue,we;function ke(p){if(ue===void 0)try{throw Error()}catch(M){var b=M.stack.trim().match(/\n( *(at )?)/);ue=b&&b[1]||"",we=-1<M.stack.indexOf(`
    at`)?" (<anonymous>)":-1<M.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ue+p+we}var De=!1;function je(p,b){if(!p||De)return"";De=!0;var M=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var B={DetermineComponentFrameRoot:function(){try{if(b){var ir=function(){throw Error()};if(Object.defineProperty(ir.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ir,[])}catch(Hn){var Mn=Hn}Reflect.construct(p,[],ir)}else{try{ir.call()}catch(Hn){Mn=Hn}p.call(ir.prototype)}}else{try{throw Error()}catch(Hn){Mn=Hn}(ir=p())&&typeof ir.catch=="function"&&ir.catch(function(){})}}catch(Hn){if(Hn&&Mn&&typeof Hn.stack=="string")return[Hn.stack,Mn.stack]}return[null,null]}};B.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var Y=Object.getOwnPropertyDescriptor(B.DetermineComponentFrameRoot,"name");Y&&Y.configurable&&Object.defineProperty(B.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var ae=B.DetermineComponentFrameRoot(),Ne=ae[0],ot=ae[1];if(Ne&&ot){var Bt=Ne.split(`
`),ln=ot.split(`
`);for(Y=B=0;B<Bt.length&&!Bt[B].includes("DetermineComponentFrameRoot");)B++;for(;Y<ln.length&&!ln[Y].includes("DetermineComponentFrameRoot");)Y++;if(B===Bt.length||Y===ln.length)for(B=Bt.length-1,Y=ln.length-1;1<=B&&0<=Y&&Bt[B]!==ln[Y];)Y--;for(;1<=B&&0<=Y;B--,Y--)if(Bt[B]!==ln[Y]){if(B!==1||Y!==1)do if(B--,Y--,0>Y||Bt[B]!==ln[Y]){var $n=`
`+Bt[B].replace(" at new "," at ");return p.displayName&&$n.includes("<anonymous>")&&($n=$n.replace("<anonymous>",p.displayName)),$n}while(1<=B&&0<=Y);break}}}finally{De=!1,Error.prepareStackTrace=M}return(M=p?p.displayName||p.name:"")?ke(M):""}function ze(p){switch(p.tag){case 26:case 27:case 5:return ke(p.type);case 16:return ke("Lazy");case 13:return ke("Suspense");case 19:return ke("SuspenseList");case 0:case 15:return p=je(p.type,!1),p;case 11:return p=je(p.type.render,!1),p;case 1:return p=je(p.type,!0),p;default:return""}}function Ue(p){try{var b="";do b+=ze(p),p=p.return;while(p);return b}catch(M){return`
Error generating stack: `+M.message+`
`+M.stack}}function Fe(p){var b=p,M=p;if(p.alternate)for(;b.return;)b=b.return;else{p=b;do b=p,(b.flags&4098)!==0&&(M=b.return),p=b.return;while(p)}return b.tag===3?M:null}function Qe(p){if(p.tag===13){var b=p.memoizedState;if(b===null&&(p=p.alternate,p!==null&&(b=p.memoizedState)),b!==null)return b.dehydrated}return null}function Be(p){if(Fe(p)!==p)throw Error(r(188))}function bt(p){var b=p.alternate;if(!b){if(b=Fe(p),b===null)throw Error(r(188));return b!==p?null:p}for(var M=p,B=b;;){var Y=M.return;if(Y===null)break;var ae=Y.alternate;if(ae===null){if(B=Y.return,B!==null){M=B;continue}break}if(Y.child===ae.child){for(ae=Y.child;ae;){if(ae===M)return Be(Y),p;if(ae===B)return Be(Y),b;ae=ae.sibling}throw Error(r(188))}if(M.return!==B.return)M=Y,B=ae;else{for(var Ne=!1,ot=Y.child;ot;){if(ot===M){Ne=!0,M=Y,B=ae;break}if(ot===B){Ne=!0,B=Y,M=ae;break}ot=ot.sibling}if(!Ne){for(ot=ae.child;ot;){if(ot===M){Ne=!0,M=ae,B=Y;break}if(ot===B){Ne=!0,B=ae,M=Y;break}ot=ot.sibling}if(!Ne)throw Error(r(189))}}if(M.alternate!==B)throw Error(r(190))}if(M.tag!==3)throw Error(r(188));return M.stateNode.current===M?p:b}function xe(p){var b=p.tag;if(b===5||b===26||b===27||b===6)return p;for(p=p.child;p!==null;){if(b=xe(p),b!==null)return b;p=p.sibling}return null}var Le=Array.isArray,Xe=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ct={pending:!1,data:null,method:null,action:null},vt=[],Nt=-1;function mt(p){return{current:p}}function yt(p){0>Nt||(p.current=vt[Nt],vt[Nt]=null,Nt--)}function _e(p,b){Nt++,vt[Nt]=p.current,p.current=b}var on=mt(null),Kt=mt(null),Pn=mt(null),Ut=mt(null);function cn(p,b){switch(_e(Pn,b),_e(Kt,p),_e(on,null),p=b.nodeType,p){case 9:case 11:b=(b=b.documentElement)&&(b=b.namespaceURI)?rb(b):0;break;default:if(p=p===8?b.parentNode:b,b=p.tagName,p=p.namespaceURI)p=rb(p),b=ib(p,b);else switch(b){case"svg":b=1;break;case"math":b=2;break;default:b=0}}yt(on),_e(on,b)}function At(){yt(on),yt(Kt),yt(Pn)}function xr(p){p.memoizedState!==null&&_e(Ut,p);var b=on.current,M=ib(b,p.type);b!==M&&(_e(Kt,p),_e(on,M))}function Rn(p){Kt.current===p&&(yt(on),yt(Kt)),Ut.current===p&&(yt(Ut),Yg._currentValue=ct)}var Dn=Object.prototype.hasOwnProperty,ar=t.unstable_scheduleCallback,hr=t.unstable_cancelCallback,ur=t.unstable_shouldYield,Ir=t.unstable_requestPaint,Un=t.unstable_now,Vr=t.unstable_getCurrentPriorityLevel,pi=t.unstable_ImmediatePriority,Li=t.unstable_UserBlockingPriority,wi=t.unstable_NormalPriority,xn=t.unstable_LowPriority,Xn=t.unstable_IdlePriority,hn=t.log,er=t.unstable_setDisableYieldValue,yr=null,Vi=null;function ki(p){if(Vi&&typeof Vi.onCommitFiberRoot=="function")try{Vi.onCommitFiberRoot(yr,p,void 0,(p.current.flags&128)===128)}catch{}}function mi(p){if(typeof hn=="function"&&er(p),Vi&&typeof Vi.setStrictMode=="function")try{Vi.setStrictMode(yr,p)}catch{}}var ti=Math.clz32?Math.clz32:Fa,Pr=Math.log,ys=Math.LN2;function Fa(p){return p>>>=0,p===0?32:31-(Pr(p)/ys|0)|0}var Za=128,Oo=4194304;function Ia(p){var b=p&42;if(b!==0)return b;switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return p&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return p}}function fi(p,b){var M=p.pendingLanes;if(M===0)return 0;var B=0,Y=p.suspendedLanes,ae=p.pingedLanes,Ne=p.warmLanes;p=p.finishedLanes!==0;var ot=M&134217727;return ot!==0?(M=ot&~Y,M!==0?B=Ia(M):(ae&=ot,ae!==0?B=Ia(ae):p||(Ne=ot&~Ne,Ne!==0&&(B=Ia(Ne))))):(ot=M&~Y,ot!==0?B=Ia(ot):ae!==0?B=Ia(ae):p||(Ne=M&~Ne,Ne!==0&&(B=Ia(Ne)))),B===0?0:b!==0&&b!==B&&(b&Y)===0&&(Y=B&-B,Ne=b&-b,Y>=Ne||Y===32&&(Ne&4194176)!==0)?b:B}function la(p,b){return(p.pendingLanes&~(p.suspendedLanes&~p.pingedLanes)&b)===0}function Iu(p,b){switch(p){case 1:case 2:case 4:case 8:return b+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return b+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function zs(){var p=Za;return Za<<=1,(Za&4194176)===0&&(Za=128),p}function Zt(){var p=Oo;return Oo<<=1,(Oo&62914560)===0&&(Oo=4194304),p}function Ee(p){for(var b=[],M=0;31>M;M++)b.push(p);return b}function Re(p,b){p.pendingLanes|=b,b!==268435456&&(p.suspendedLanes=0,p.pingedLanes=0,p.warmLanes=0)}function tt(p,b,M,B,Y,ae){var Ne=p.pendingLanes;p.pendingLanes=M,p.suspendedLanes=0,p.pingedLanes=0,p.warmLanes=0,p.expiredLanes&=M,p.entangledLanes&=M,p.errorRecoveryDisabledLanes&=M,p.shellSuspendCounter=0;var ot=p.entanglements,Bt=p.expirationTimes,ln=p.hiddenUpdates;for(M=Ne&~M;0<M;){var $n=31-ti(M),ir=1<<$n;ot[$n]=0,Bt[$n]=-1;var Mn=ln[$n];if(Mn!==null)for(ln[$n]=null,$n=0;$n<Mn.length;$n++){var Hn=Mn[$n];Hn!==null&&(Hn.lane&=-536870913)}M&=~ir}B!==0&&gt(p,B,0),ae!==0&&Y===0&&p.tag!==0&&(p.suspendedLanes|=ae&~(Ne&~b))}function gt(p,b,M){p.pendingLanes|=b,p.suspendedLanes&=~b;var B=31-ti(b);p.entangledLanes|=b,p.entanglements[B]=p.entanglements[B]|1073741824|M&4194218}function ft(p,b){var M=p.entangledLanes|=b;for(p=p.entanglements;M;){var B=31-ti(M),Y=1<<B;Y&b|p[B]&b&&(p[B]|=b),M&=~Y}}function Tt(p){return p&=-p,2<p?8<p?(p&134217727)!==0?32:268435456:8:2}function Ft(){var p=Xe.p;return p!==0?p:(p=window.event,p===void 0?32:tS(p.type))}function Ct(p,b){var M=Xe.p;try{return Xe.p=p,b()}finally{Xe.p=M}}var Ht=Math.random().toString(36).slice(2),Gt="__reactFiber$"+Ht,$t="__reactProps$"+Ht,Sn="__reactContainer$"+Ht,Nn="__reactEvents$"+Ht,qn="__reactListeners$"+Ht,vr="__reactHandles$"+Ht,Or="__reactResources$"+Ht,Rr="__reactMarker$"+Ht;function qr(p){delete p[Gt],delete p[$t],delete p[Nn],delete p[qn],delete p[vr]}function Ri(p){var b=p[Gt];if(b)return b;for(var M=p.parentNode;M;){if(b=M[Sn]||M[Gt]){if(M=b.alternate,b.child!==null||M!==null&&M.child!==null)for(p=lb(p);p!==null;){if(M=p[Gt])return M;p=lb(p)}return b}p=M,M=p.parentNode}return null}function Xi(p){if(p=p[Gt]||p[Sn]){var b=p.tag;if(b===5||b===6||b===13||b===26||b===27||b===3)return p}return null}function Hr(p){var b=p.tag;if(b===5||b===26||b===27||b===6)return p.stateNode;throw Error(r(33))}function gi(p){var b=p[Or];return b||(b=p[Or]={hoistableStyles:new Map,hoistableScripts:new Map}),b}function Gr(p){p[Rr]=!0}var Ni=new Set,Pa={};function Ua(p,b){_s(p,b),_s(p+"Capture",b)}function _s(p,b){for(Pa[p]=b,p=0;p<b.length;p++)Ni.add(b[p])}var vs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ro=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),bs={},Bs={};function iu(p){return Dn.call(Bs,p)?!0:Dn.call(bs,p)?!1:Ro.test(p)?Bs[p]=!0:(bs[p]=!0,!1)}function Wo(p,b,M){if(iu(b))if(M===null)p.removeAttribute(b);else{switch(typeof M){case"undefined":case"function":case"symbol":p.removeAttribute(b);return;case"boolean":var B=b.toLowerCase().slice(0,5);if(B!=="data-"&&B!=="aria-"){p.removeAttribute(b);return}}p.setAttribute(b,""+M)}}function Oa(p,b,M){if(M===null)p.removeAttribute(b);else{switch(typeof M){case"undefined":case"function":case"symbol":case"boolean":p.removeAttribute(b);return}p.setAttribute(b,""+M)}}function Fl(p,b,M,B){if(B===null)p.removeAttribute(M);else{switch(typeof B){case"undefined":case"function":case"symbol":case"boolean":p.removeAttribute(M);return}p.setAttributeNS(b,M,""+B)}}function Do(p){switch(typeof p){case"bigint":case"boolean":case"number":case"string":case"undefined":return p;case"object":return p;default:return""}}function gh(p){var b=p.type;return(p=p.nodeName)&&p.toLowerCase()==="input"&&(b==="checkbox"||b==="radio")}function Pu(p){var b=gh(p)?"checked":"value",M=Object.getOwnPropertyDescriptor(p.constructor.prototype,b),B=""+p[b];if(!p.hasOwnProperty(b)&&typeof M<"u"&&typeof M.get=="function"&&typeof M.set=="function"){var Y=M.get,ae=M.set;return Object.defineProperty(p,b,{configurable:!0,get:function(){return Y.call(this)},set:function(Ne){B=""+Ne,ae.call(this,Ne)}}),Object.defineProperty(p,b,{enumerable:M.enumerable}),{getValue:function(){return B},setValue:function(Ne){B=""+Ne},stopTracking:function(){p._valueTracker=null,delete p[b]}}}}function Jh(p){p._valueTracker||(p._valueTracker=Pu(p))}function lc(p){if(!p)return!1;var b=p._valueTracker;if(!b)return!0;var M=b.getValue(),B="";return p&&(B=gh(p)?p.checked?"true":"false":p.value),p=B,p!==M?(b.setValue(p),!0):!1}function Ou(p){if(p=p||(typeof document<"u"?document:void 0),typeof p>"u")return null;try{return p.activeElement||p.body}catch{return p.body}}var cl=/[\n"\\]/g;function Ys(p){return p.replace(cl,function(b){return"\\"+b.charCodeAt(0).toString(16)+" "})}function Lo(p,b,M,B,Y,ae,Ne,ot){p.name="",Ne!=null&&typeof Ne!="function"&&typeof Ne!="symbol"&&typeof Ne!="boolean"?p.type=Ne:p.removeAttribute("type"),b!=null?Ne==="number"?(b===0&&p.value===""||p.value!=b)&&(p.value=""+Do(b)):p.value!==""+Do(b)&&(p.value=""+Do(b)):Ne!=="submit"&&Ne!=="reset"||p.removeAttribute("value"),b!=null?cc(p,Ne,Do(b)):M!=null?cc(p,Ne,Do(M)):B!=null&&p.removeAttribute("value"),Y==null&&ae!=null&&(p.defaultChecked=!!ae),Y!=null&&(p.checked=Y&&typeof Y!="function"&&typeof Y!="symbol"),ot!=null&&typeof ot!="function"&&typeof ot!="symbol"&&typeof ot!="boolean"?p.name=""+Do(ot):p.removeAttribute("name")}function Ul(p,b,M,B,Y,ae,Ne,ot){if(ae!=null&&typeof ae!="function"&&typeof ae!="symbol"&&typeof ae!="boolean"&&(p.type=ae),b!=null||M!=null){if(!(ae!=="submit"&&ae!=="reset"||b!=null))return;M=M!=null?""+Do(M):"",b=b!=null?""+Do(b):M,ot||b===p.value||(p.value=b),p.defaultValue=b}B=B??Y,B=typeof B!="function"&&typeof B!="symbol"&&!!B,p.checked=ot?p.checked:!!B,p.defaultChecked=!!B,Ne!=null&&typeof Ne!="function"&&typeof Ne!="symbol"&&typeof Ne!="boolean"&&(p.name=Ne)}function cc(p,b,M){b==="number"&&Ou(p.ownerDocument)===p||p.defaultValue===""+M||(p.defaultValue=""+M)}function so(p,b,M,B){if(p=p.options,b){b={};for(var Y=0;Y<M.length;Y++)b["$"+M[Y]]=!0;for(M=0;M<p.length;M++)Y=b.hasOwnProperty("$"+p[M].value),p[M].selected!==Y&&(p[M].selected=Y),Y&&B&&(p[M].defaultSelected=!0)}else{for(M=""+Do(M),b=null,Y=0;Y<p.length;Y++){if(p[Y].value===M){p[Y].selected=!0,B&&(p[Y].defaultSelected=!0);return}b!==null||p[Y].disabled||(b=p[Y])}b!==null&&(b.selected=!0)}}function ko(p,b,M){if(b!=null&&(b=""+Do(b),b!==p.value&&(p.value=b),M==null)){p.defaultValue!==b&&(p.defaultValue=b);return}p.defaultValue=M!=null?""+Do(M):""}function yh(p,b,M,B){if(b==null){if(B!=null){if(M!=null)throw Error(r(92));if(Le(B)){if(1<B.length)throw Error(r(93));B=B[0]}M=B}M==null&&(M=""),b=M}M=Do(b),p.defaultValue=M,B=p.textContent,B===M&&B!==""&&B!==null&&(p.value=B)}function Bc(p,b){if(b){var M=p.firstChild;if(M&&M===p.lastChild&&M.nodeType===3){M.nodeValue=b;return}}p.textContent=b}var ud=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function ql(p,b,M){var B=b.indexOf("--")===0;M==null||typeof M=="boolean"||M===""?B?p.setProperty(b,""):b==="float"?p.cssFloat="":p[b]="":B?p.setProperty(b,M):typeof M!="number"||M===0||ud.has(b)?b==="float"?p.cssFloat=M:p[b]=(""+M).trim():p[b]=M+"px"}function No(p,b,M){if(b!=null&&typeof b!="object")throw Error(r(62));if(p=p.style,M!=null){for(var B in M)!M.hasOwnProperty(B)||b!=null&&b.hasOwnProperty(B)||(B.indexOf("--")===0?p.setProperty(B,""):B==="float"?p.cssFloat="":p[B]="");for(var Y in b)B=b[Y],b.hasOwnProperty(Y)&&M[Y]!==B&&ql(p,Y,B)}else for(var ae in b)b.hasOwnProperty(ae)&&ql(p,ae,b[ae])}function jc(p){if(p.indexOf("-")===-1)return!1;switch(p){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Qh=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ko=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ei(p){return Ko.test(""+p)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":p}var oo=null;function dr(p){return p=p.target||p.srcElement||window,p.correspondingUseElement&&(p=p.correspondingUseElement),p.nodeType===3?p.parentNode:p}var Ru=null,yi=null;function ef(p){var b=Xi(p);if(b&&(p=b.stateNode)){var M=p[$t]||null;e:switch(p=b.stateNode,b.type){case"input":if(Lo(p,M.value,M.defaultValue,M.defaultValue,M.checked,M.defaultChecked,M.type,M.name),b=M.name,M.type==="radio"&&b!=null){for(M=p;M.parentNode;)M=M.parentNode;for(M=M.querySelectorAll('input[name="'+Ys(""+b)+'"][type="radio"]'),b=0;b<M.length;b++){var B=M[b];if(B!==p&&B.form===p.form){var Y=B[$t]||null;if(!Y)throw Error(r(90));Lo(B,Y.value,Y.defaultValue,Y.defaultValue,Y.checked,Y.defaultChecked,Y.type,Y.name)}}for(b=0;b<M.length;b++)B=M[b],B.form===p.form&&lc(B)}break e;case"textarea":ko(p,M.value,M.defaultValue);break e;case"select":b=M.value,b!=null&&so(p,!!M.multiple,b,!1)}}}var Si=!1;function js(p,b,M){if(Si)return p(b,M);Si=!0;try{var B=p(b);return B}finally{if(Si=!1,(Ru!==null||yi!==null)&&(Av(),Ru&&(b=Ru,p=yi,yi=Ru=null,ef(b),p)))for(b=0;b<p.length;b++)ef(p[b])}}function au(p,b){var M=p.stateNode;if(M===null)return null;var B=M[$t]||null;if(B===null)return null;M=B[b];e:switch(b){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(B=!B.disabled)||(p=p.type,B=!(p==="button"||p==="input"||p==="select"||p==="textarea")),p=!B;break e;default:p=!1}if(p)return null;if(M&&typeof M!="function")throw Error(r(231,b,typeof M));return M}var su=!1;if(vs)try{var Jn={};Object.defineProperty(Jn,"passive",{get:function(){su=!0}}),window.addEventListener("test",Jn,Jn),window.removeEventListener("test",Jn,Jn)}catch{su=!1}var ri=null,_i=null,Fs=null;function _h(){if(Fs)return Fs;var p,b=_i,M=b.length,B,Y="value"in ri?ri.value:ri.textContent,ae=Y.length;for(p=0;p<M&&b[p]===Y[p];p++);var Ne=M-p;for(B=1;B<=Ne&&b[M-B]===Y[ae-B];B++);return Fs=Y.slice(p,1<B?1-B:void 0)}function li(p){var b=p.keyCode;return"charCode"in p?(p=p.charCode,p===0&&b===13&&(p=13)):p=b,p===10&&(p=13),32<=p||p===13?p:0}function zo(){return!0}function uc(){return!1}function xs(p){function b(M,B,Y,ae,Ne){this._reactName=M,this._targetInst=Y,this.type=B,this.nativeEvent=ae,this.target=Ne,this.currentTarget=null;for(var ot in p)p.hasOwnProperty(ot)&&(M=p[ot],this[ot]=M?M(ae):ae[ot]);return this.isDefaultPrevented=(ae.defaultPrevented!=null?ae.defaultPrevented:ae.returnValue===!1)?zo:uc,this.isPropagationStopped=uc,this}return Oe(b.prototype,{preventDefault:function(){this.defaultPrevented=!0;var M=this.nativeEvent;M&&(M.preventDefault?M.preventDefault():typeof M.returnValue!="unknown"&&(M.returnValue=!1),this.isDefaultPrevented=zo)},stopPropagation:function(){var M=this.nativeEvent;M&&(M.stopPropagation?M.stopPropagation():typeof M.cancelBubble!="unknown"&&(M.cancelBubble=!0),this.isPropagationStopped=zo)},persist:function(){},isPersistent:zo}),b}var za={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(p){return p.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ta=xs(za),lo=Oe({},za,{view:0,detail:0}),vh=xs(lo),tf,ou,lu,Yo=Oe({},lo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:$l,button:0,buttons:0,relatedTarget:function(p){return p.relatedTarget===void 0?p.fromElement===p.srcElement?p.toElement:p.fromElement:p.relatedTarget},movementX:function(p){return"movementX"in p?p.movementX:(p!==lu&&(lu&&p.type==="mousemove"?(tf=p.screenX-lu.screenX,ou=p.screenY-lu.screenY):ou=tf=0,lu=p),tf)},movementY:function(p){return"movementY"in p?p.movementY:ou}}),os=xs(Yo),Fc=Oe({},Yo,{dataTransfer:0}),ws=xs(Fc),wl=Oe({},lo,{relatedTarget:0}),Xo=xs(wl),qa=Oe({},za,{animationName:0,elapsedTime:0,pseudoElement:0}),Us=xs(qa),Vl=Oe({},za,{clipboardData:function(p){return"clipboardData"in p?p.clipboardData:window.clipboardData}}),ns=xs(Vl),Pf=Oe({},za,{data:0}),Bo=xs(Pf),bh={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hc={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},fc={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Vd(p){var b=this.nativeEvent;return b.getModifierState?b.getModifierState(p):(p=fc[p])?!!b[p]:!1}function $l(){return Vd}var Dm=Oe({},lo,{key:function(p){if(p.key){var b=bh[p.key]||p.key;if(b!=="Unidentified")return b}return p.type==="keypress"?(p=li(p),p===13?"Enter":String.fromCharCode(p)):p.type==="keydown"||p.type==="keyup"?hc[p.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:$l,charCode:function(p){return p.type==="keypress"?li(p):0},keyCode:function(p){return p.type==="keydown"||p.type==="keyup"?p.keyCode:0},which:function(p){return p.type==="keypress"?li(p):p.type==="keydown"||p.type==="keyup"?p.keyCode:0}}),xh=xs(Dm),qs=Oe({},Yo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hd=xs(qs),Hl=Oe({},lo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:$l}),fd=xs(Hl),se=Oe({},za,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ge=xs(se),Rt=Oe({},Yo,{deltaX:function(p){return"deltaX"in p?p.deltaX:"wheelDeltaX"in p?-p.wheelDeltaX:0},deltaY:function(p){return"deltaY"in p?p.deltaY:"wheelDeltaY"in p?-p.wheelDeltaY:"wheelDelta"in p?-p.wheelDelta:0},deltaZ:0,deltaMode:0}),Yt=xs(Rt),dn=Oe({},za,{newState:0,oldState:0}),kn=xs(dn),rr=[9,13,27,32],wr=vs&&"CompositionEvent"in window,Wr=null;vs&&"documentMode"in document&&(Wr=document.documentMode);var Ai=vs&&"TextEvent"in window&&!Wr,Pi=vs&&(!wr||Wr&&8<Wr&&11>=Wr),pa=" ",Ss=!1;function As(p,b){switch(p){case"keyup":return rr.indexOf(b.keyCode)!==-1;case"keydown":return b.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Xs(p){return p=p.detail,typeof p=="object"&&"data"in p?p.data:null}var Ja=!1;function Mr(p,b){switch(p){case"compositionend":return Xs(b);case"keypress":return b.which!==32?null:(Ss=!0,pa);case"textInput":return p=b.data,p===pa&&Ss?null:p;default:return null}}function sr(p,b){if(Ja)return p==="compositionend"||!wr&&As(p,b)?(p=_h(),Fs=_i=ri=null,Ja=!1,p):null;switch(p){case"paste":return null;case"keypress":if(!(b.ctrlKey||b.altKey||b.metaKey)||b.ctrlKey&&b.altKey){if(b.char&&1<b.char.length)return b.char;if(b.which)return String.fromCharCode(b.which)}return null;case"compositionend":return Pi&&b.locale!=="ko"?null:b.data;default:return null}}var ul={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Sr(p){var b=p&&p.nodeName&&p.nodeName.toLowerCase();return b==="input"?!!ul[p.type]:b==="textarea"}function dc(p,b,M,B){Ru?yi?yi.push(B):yi=[B]:Ru=B,b=Cd(b,"onChange"),0<b.length&&(M=new Ta("onChange","change",null,M,B),p.push({event:M,listeners:b}))}var Gl=null,br=null;function nf(p){Ov(p,0)}function Wl(p){var b=Hr(p);if(lc(b))return p}function cu(p,b){if(p==="change")return b}var wh=!1;if(vs){var Ts;if(vs){var ya="oninput"in document;if(!ya){var uu=document.createElement("div");uu.setAttribute("oninput","return;"),ya=typeof uu.oninput=="function"}Ts=ya}else Ts=!1;wh=Ts&&(!document.documentMode||9<document.documentMode)}function On(){Gl&&(Gl.detachEvent("onpropertychange",Sh),br=Gl=null)}function Sh(p){if(p.propertyName==="value"&&Wl(br)){var b=[];dc(b,br,p,dr(p)),js(nf,b)}}function Vs(p,b,M){p==="focusin"?(On(),Gl=b,br=M,Gl.attachEvent("onpropertychange",Sh)):p==="focusout"&&On()}function co(p){if(p==="selectionchange"||p==="keyup"||p==="keydown")return Wl(br)}function dd(p,b){if(p==="click")return Wl(b)}function Of(p,b){if(p==="input"||p==="change")return Wl(b)}function uo(p,b){return p===b&&(p!==0||1/p===1/b)||p!==p&&b!==b}var Rs=typeof Object.is=="function"?Object.is:uo;function Sl(p,b){if(Rs(p,b))return!0;if(typeof p!="object"||p===null||typeof b!="object"||b===null)return!1;var M=Object.keys(p),B=Object.keys(b);if(M.length!==B.length)return!1;for(B=0;B<M.length;B++){var Y=M[B];if(!Dn.call(b,Y)||!Rs(p[Y],b[Y]))return!1}return!0}function Du(p){for(;p&&p.firstChild;)p=p.firstChild;return p}function Kl(p,b){var M=Du(p);p=0;for(var B;M;){if(M.nodeType===3){if(B=p+M.textContent.length,p<=b&&B>=b)return{node:M,offset:b-p};p=B}e:{for(;M;){if(M.nextSibling){M=M.nextSibling;break e}M=M.parentNode}M=void 0}M=Du(M)}}function rf(p,b){return p&&b?p===b?!0:p&&p.nodeType===3?!1:b&&b.nodeType===3?rf(p,b.parentNode):"contains"in p?p.contains(b):p.compareDocumentPosition?!!(p.compareDocumentPosition(b)&16):!1:!1}function Al(p){p=p!=null&&p.ownerDocument!=null&&p.ownerDocument.defaultView!=null?p.ownerDocument.defaultView:window;for(var b=Ou(p.document);b instanceof p.HTMLIFrameElement;){try{var M=typeof b.contentWindow.location.href=="string"}catch{M=!1}if(M)p=b.contentWindow;else break;b=Ou(p.document)}return b}function xo(p){var b=p&&p.nodeName&&p.nodeName.toLowerCase();return b&&(b==="input"&&(p.type==="text"||p.type==="search"||p.type==="tel"||p.type==="url"||p.type==="password")||b==="textarea"||p.contentEditable==="true")}function Ah(p,b){var M=Al(b);b=p.focusedElem;var B=p.selectionRange;if(M!==b&&b&&b.ownerDocument&&rf(b.ownerDocument.documentElement,b)){if(B!==null&&xo(b)){if(p=B.start,M=B.end,M===void 0&&(M=p),"selectionStart"in b)b.selectionStart=p,b.selectionEnd=Math.min(M,b.value.length);else if(M=(p=b.ownerDocument||document)&&p.defaultView||window,M.getSelection){M=M.getSelection();var Y=b.textContent.length,ae=Math.min(B.start,Y);B=B.end===void 0?ae:Math.min(B.end,Y),!M.extend&&ae>B&&(Y=B,B=ae,ae=Y),Y=Kl(b,ae);var Ne=Kl(b,B);Y&&Ne&&(M.rangeCount!==1||M.anchorNode!==Y.node||M.anchorOffset!==Y.offset||M.focusNode!==Ne.node||M.focusOffset!==Ne.offset)&&(p=p.createRange(),p.setStart(Y.node,Y.offset),M.removeAllRanges(),ae>B?(M.addRange(p),M.extend(Ne.node,Ne.offset)):(p.setEnd(Ne.node,Ne.offset),M.addRange(p)))}}for(p=[],M=b;M=M.parentNode;)M.nodeType===1&&p.push({element:M,left:M.scrollLeft,top:M.scrollTop});for(typeof b.focus=="function"&&b.focus(),b=0;b<p.length;b++)M=p[b],M.element.scrollLeft=M.left,M.element.scrollTop=M.top}}var Lu=vs&&"documentMode"in document&&11>=document.documentMode,Tl=null,hu=null,pc=null,Va=!1;function pd(p,b,M){var B=M.window===M?M.document:M.nodeType===9?M:M.ownerDocument;Va||Tl==null||Tl!==Ou(B)||(B=Tl,"selectionStart"in B&&xo(B)?B={start:B.selectionStart,end:B.selectionEnd}:(B=(B.ownerDocument&&B.ownerDocument.defaultView||window).getSelection(),B={anchorNode:B.anchorNode,anchorOffset:B.anchorOffset,focusNode:B.focusNode,focusOffset:B.focusOffset}),pc&&Sl(pc,B)||(pc=B,B=Cd(hu,"onSelect"),0<B.length&&(b=new Ta("onSelect","select",null,b,M),p.push({event:b,listeners:B}),b.target=Tl)))}function Zs(p,b){var M={};return M[p.toLowerCase()]=b.toLowerCase(),M["Webkit"+p]="webkit"+b,M["Moz"+p]="moz"+b,M}var ho={animationend:Zs("Animation","AnimationEnd"),animationiteration:Zs("Animation","AnimationIteration"),animationstart:Zs("Animation","AnimationStart"),transitionrun:Zs("Transition","TransitionRun"),transitionstart:Zs("Transition","TransitionStart"),transitioncancel:Zs("Transition","TransitionCancel"),transitionend:Zs("Transition","TransitionEnd")},Th={},Eh={};vs&&(Eh=document.createElement("div").style,"AnimationEvent"in window||(delete ho.animationend.animation,delete ho.animationiteration.animation,delete ho.animationstart.animation),"TransitionEvent"in window||delete ho.transitionend.transition);function Js(p){if(Th[p])return Th[p];if(!ho[p])return p;var b=ho[p],M;for(M in b)if(b.hasOwnProperty(M)&&M in Eh)return Th[p]=b[M];return p}var ku=Js("animationend"),fu=Js("animationiteration"),mc=Js("animationstart"),Nu=Js("transitionrun"),gc=Js("transitionstart"),zu=Js("transitioncancel"),du=Js("transitionend"),Uc=new Map,jo="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function ls(p,b){Uc.set(p,b),Ua(b,[p])}var Yi=[],ea=0,$a=0;function rs(){for(var p=ea,b=$a=ea=0;b<p;){var M=Yi[b];Yi[b++]=null;var B=Yi[b];Yi[b++]=null;var Y=Yi[b];Yi[b++]=null;var ae=Yi[b];if(Yi[b++]=null,B!==null&&Y!==null){var Ne=B.pending;Ne===null?Y.next=Y:(Y.next=Ne.next,Ne.next=Y),B.pending=Y}ae!==0&&Xl(M,Y,ae)}}function Yl(p,b,M,B){Yi[ea++]=p,Yi[ea++]=b,Yi[ea++]=M,Yi[ea++]=B,$a|=B,p.lanes|=B,p=p.alternate,p!==null&&(p.lanes|=B)}function Bu(p,b,M,B){return Yl(p,b,M,B),ni(p)}function Zo(p,b){return Yl(p,null,null,b),ni(p)}function Xl(p,b,M){p.lanes|=M;var B=p.alternate;B!==null&&(B.lanes|=M);for(var Y=!1,ae=p.return;ae!==null;)ae.childLanes|=M,B=ae.alternate,B!==null&&(B.childLanes|=M),ae.tag===22&&(p=ae.stateNode,p===null||p._visibility&1||(Y=!0)),p=ae,ae=ae.return;Y&&b!==null&&p.tag===3&&(ae=p.stateNode,Y=31-ti(M),ae=ae.hiddenUpdates,p=ae[Y],p===null?ae[Y]=[b]:p.push(b),b.lane=M|536870912)}function ni(p){if(50<yl)throw yl=0,Fh=null,Error(r(185));for(var b=p.return;b!==null;)p=b,b=p.return;return p.tag===3?p.stateNode:null}var ju={},El=new WeakMap;function Qa(p,b){if(typeof p=="object"&&p!==null){var M=El.get(p);return M!==void 0?M:(b={value:p,source:b,stack:Ue(b)},El.set(p,b),b)}return{value:p,source:b,stack:Ue(b)}}var pu=[],Mh=0,ua=null,Rf=0,Jo=[],hl=0,Fu=null,yc=1,qc="";function mu(p,b){pu[Mh++]=Rf,pu[Mh++]=ua,ua=p,Rf=b}function Np(p,b,M){Jo[hl++]=yc,Jo[hl++]=qc,Jo[hl++]=Fu,Fu=p;var B=yc;p=qc;var Y=32-ti(B)-1;B&=~(1<<Y),M+=1;var ae=32-ti(b)+Y;if(30<ae){var Ne=Y-Y%5;ae=(B&(1<<Ne)-1).toString(32),B>>=Ne,Y-=Ne,yc=1<<32-ti(b)+Y|M<<Y|B,qc=ae+p}else yc=1<<ae|M<<Y|B,qc=p}function Df(p){p.return!==null&&(mu(p,1),Np(p,1,0))}function Lf(p){for(;p===ua;)ua=pu[--Mh],pu[Mh]=null,Rf=pu[--Mh],pu[Mh]=null;for(;p===Fu;)Fu=Jo[--hl],Jo[hl]=null,qc=Jo[--hl],Jo[hl]=null,yc=Jo[--hl],Jo[hl]=null}var Qo=null,Ha=null,_a=!1,Zl=null,_c=!1,$d=Error(r(519));function gu(p){var b=Error(r(418,""));throw Ih(Qa(b,p)),$d}function md(p){var b=p.stateNode,M=p.type,B=p.memoizedProps;switch(b[Gt]=p,b[$t]=B,M){case"dialog":La("cancel",b),La("close",b);break;case"iframe":case"object":case"embed":La("load",b);break;case"video":case"audio":for(M=0;M<$m.length;M++)La($m[M],b);break;case"source":La("error",b);break;case"img":case"image":case"link":La("error",b),La("load",b);break;case"details":La("toggle",b);break;case"input":La("invalid",b),Ul(b,B.value,B.defaultValue,B.checked,B.defaultChecked,B.type,B.name,!0),Jh(b);break;case"select":La("invalid",b);break;case"textarea":La("invalid",b),yh(b,B.value,B.defaultValue,B.children),Jh(b)}M=B.children,typeof M!="string"&&typeof M!="number"&&typeof M!="bigint"||b.textContent===""+M||B.suppressHydrationWarning===!0||Id(b.textContent,M)?(B.popover!=null&&(La("beforetoggle",b),La("toggle",b)),B.onScroll!=null&&La("scroll",b),B.onScrollEnd!=null&&La("scrollend",b),B.onClick!=null&&(b.onclick=$g),b=!0):b=!1,b||gu(p)}function Ch(p){for(Qo=p.return;Qo;)switch(Qo.tag){case 3:case 27:_c=!0;return;case 5:case 13:_c=!1;return;default:Qo=Qo.return}}function kf(p){if(p!==Qo)return!1;if(!_a)return Ch(p),_a=!0,!1;var b=!1,M;if((M=p.tag!==3&&p.tag!==27)&&((M=p.tag===5)&&(M=p.type,M=!(M!=="form"&&M!=="button")||Nv(p.type,p.memoizedProps)),M=!M),M&&(b=!0),b&&Ha&&gu(p),Ch(p),p.tag===13){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(r(317));e:{for(p=p.nextSibling,b=0;p;){if(p.nodeType===8)if(M=p.data,M==="/$"){if(b===0){Ha=Ic(p.nextSibling);break e}b--}else M!=="$"&&M!=="$!"&&M!=="$?"||b++;p=p.nextSibling}Ha=null}}else Ha=Qo?Ic(p.stateNode.nextSibling):null;return!0}function Nf(){Ha=Qo=null,_a=!1}function Ih(p){Zl===null?Zl=[p]:Zl.push(p)}var gd=Error(r(460)),Lm=Error(r(474)),af={then:function(){}};function Cg(p){return p=p.status,p==="fulfilled"||p==="rejected"}function yu(){}function Vc(p,b,M){switch(M=p[M],M===void 0?p.push(b):M!==b&&(b.then(yu,yu),b=M),b.status){case"fulfilled":return b.value;case"rejected":throw p=b.reason,p===gd?Error(r(483)):p;default:if(typeof b.status=="string")b.then(yu,yu);else{if(p=jr,p!==null&&100<p.shellSuspendCounter)throw Error(r(482));p=b,p.status="pending",p.then(function(B){if(b.status==="pending"){var Y=b;Y.status="fulfilled",Y.value=B}},function(B){if(b.status==="pending"){var Y=b;Y.status="rejected",Y.reason=B}})}switch(b.status){case"fulfilled":return b.value;case"rejected":throw p=b.reason,p===gd?Error(r(483)):p}throw vc=b,gd}}var vc=null;function Ig(){if(vc===null)throw Error(r(459));var p=vc;return vc=null,p}var zf=null,fl=0;function el(p){var b=fl;return fl+=1,zf===null&&(zf=[]),Vc(zf,p,b)}function Bf(p,b){b=b.props.ref,p.ref=b!==void 0?b:null}function Ph(p,b){throw b.$$typeof===l?Error(r(525)):(p=Object.prototype.toString.call(b),Error(r(31,p==="[object Object]"?"object with keys {"+Object.keys(b).join(", ")+"}":p)))}function zp(p){var b=p._init;return b(p._payload)}function Bp(p){function b(yn,rn){if(p){var An=yn.deletions;An===null?(yn.deletions=[rn],yn.flags|=16):An.push(rn)}}function M(yn,rn){if(!p)return null;for(;rn!==null;)b(yn,rn),rn=rn.sibling;return null}function B(yn){for(var rn=new Map;yn!==null;)yn.key!==null?rn.set(yn.key,yn):rn.set(yn.index,yn),yn=yn.sibling;return rn}function Y(yn,rn){return yn=Tn(yn,rn),yn.index=0,yn.sibling=null,yn}function ae(yn,rn,An){return yn.index=An,p?(An=yn.alternate,An!==null?(An=An.index,An<rn?(yn.flags|=33554434,rn):An):(yn.flags|=33554434,rn)):(yn.flags|=1048576,rn)}function Ne(yn){return p&&yn.alternate===null&&(yn.flags|=33554434),yn}function ot(yn,rn,An,Qn){return rn===null||rn.tag!==6?(rn=Qt(An,yn.mode,Qn),rn.return=yn,rn):(rn=Y(rn,An),rn.return=yn,rn)}function Bt(yn,rn,An,Qn){var Kr=An.type;return Kr===x?$n(yn,rn,An.props.children,Qn,An.key):rn!==null&&(rn.elementType===Kr||typeof Kr=="object"&&Kr!==null&&Kr.$$typeof===ie&&zp(Kr)===rn.type)?(rn=Y(rn,An.props),Bf(rn,An),rn.return=yn,rn):(rn=an(An.type,An.key,An.props,null,yn.mode,Qn),Bf(rn,An),rn.return=yn,rn)}function ln(yn,rn,An,Qn){return rn===null||rn.tag!==4||rn.stateNode.containerInfo!==An.containerInfo||rn.stateNode.implementation!==An.implementation?(rn=fn(An,yn.mode,Qn),rn.return=yn,rn):(rn=Y(rn,An.children||[]),rn.return=yn,rn)}function $n(yn,rn,An,Qn,Kr){return rn===null||rn.tag!==7?(rn=Pt(An,yn.mode,Qn,Kr),rn.return=yn,rn):(rn=Y(rn,An),rn.return=yn,rn)}function ir(yn,rn,An){if(typeof rn=="string"&&rn!==""||typeof rn=="number"||typeof rn=="bigint")return rn=Qt(""+rn,yn.mode,An),rn.return=yn,rn;if(typeof rn=="object"&&rn!==null){switch(rn.$$typeof){case f:return An=an(rn.type,rn.key,rn.props,null,yn.mode,An),Bf(An,rn),An.return=yn,An;case i:return rn=fn(rn,yn.mode,An),rn.return=yn,rn;case ie:var Qn=rn._init;return rn=Qn(rn._payload),ir(yn,rn,An)}if(Le(rn)||ye(rn))return rn=Pt(rn,yn.mode,An,null),rn.return=yn,rn;if(typeof rn.then=="function")return ir(yn,el(rn),An);if(rn.$$typeof===j)return ir(yn,Wc(yn,rn),An);Ph(yn,rn)}return null}function Mn(yn,rn,An,Qn){var Kr=rn!==null?rn.key:null;if(typeof An=="string"&&An!==""||typeof An=="number"||typeof An=="bigint")return Kr!==null?null:ot(yn,rn,""+An,Qn);if(typeof An=="object"&&An!==null){switch(An.$$typeof){case f:return An.key===Kr?Bt(yn,rn,An,Qn):null;case i:return An.key===Kr?ln(yn,rn,An,Qn):null;case ie:return Kr=An._init,An=Kr(An._payload),Mn(yn,rn,An,Qn)}if(Le(An)||ye(An))return Kr!==null?null:$n(yn,rn,An,Qn,null);if(typeof An.then=="function")return Mn(yn,rn,el(An),Qn);if(An.$$typeof===j)return Mn(yn,rn,Wc(yn,An),Qn);Ph(yn,An)}return null}function Hn(yn,rn,An,Qn,Kr){if(typeof Qn=="string"&&Qn!==""||typeof Qn=="number"||typeof Qn=="bigint")return yn=yn.get(An)||null,ot(rn,yn,""+Qn,Kr);if(typeof Qn=="object"&&Qn!==null){switch(Qn.$$typeof){case f:return yn=yn.get(Qn.key===null?An:Qn.key)||null,Bt(rn,yn,Qn,Kr);case i:return yn=yn.get(Qn.key===null?An:Qn.key)||null,ln(rn,yn,Qn,Kr);case ie:var ma=Qn._init;return Qn=ma(Qn._payload),Hn(yn,rn,An,Qn,Kr)}if(Le(Qn)||ye(Qn))return yn=yn.get(An)||null,$n(rn,yn,Qn,Kr,null);if(typeof Qn.then=="function")return Hn(yn,rn,An,el(Qn),Kr);if(Qn.$$typeof===j)return Hn(yn,rn,An,Wc(rn,Qn),Kr);Ph(rn,Qn)}return null}function Zr(yn,rn,An,Qn){for(var Kr=null,ma=null,oi=rn,Ci=rn=0,tc=null;oi!==null&&Ci<An.length;Ci++){oi.index>Ci?(tc=oi,oi=null):tc=oi.sibling;var es=Mn(yn,oi,An[Ci],Qn);if(es===null){oi===null&&(oi=tc);break}p&&oi&&es.alternate===null&&b(yn,oi),rn=ae(es,rn,Ci),ma===null?Kr=es:ma.sibling=es,ma=es,oi=tc}if(Ci===An.length)return M(yn,oi),_a&&mu(yn,Ci),Kr;if(oi===null){for(;Ci<An.length;Ci++)oi=ir(yn,An[Ci],Qn),oi!==null&&(rn=ae(oi,rn,Ci),ma===null?Kr=oi:ma.sibling=oi,ma=oi);return _a&&mu(yn,Ci),Kr}for(oi=B(oi);Ci<An.length;Ci++)tc=Hn(oi,yn,Ci,An[Ci],Qn),tc!==null&&(p&&tc.alternate!==null&&oi.delete(tc.key===null?Ci:tc.key),rn=ae(tc,rn,Ci),ma===null?Kr=tc:ma.sibling=tc,ma=tc);return p&&oi.forEach(function(sm){return b(yn,sm)}),_a&&mu(yn,Ci),Kr}function Zi(yn,rn,An,Qn){if(An==null)throw Error(r(151));for(var Kr=null,ma=null,oi=rn,Ci=rn=0,tc=null,es=An.next();oi!==null&&!es.done;Ci++,es=An.next()){oi.index>Ci?(tc=oi,oi=null):tc=oi.sibling;var sm=Mn(yn,oi,es.value,Qn);if(sm===null){oi===null&&(oi=tc);break}p&&oi&&sm.alternate===null&&b(yn,oi),rn=ae(sm,rn,Ci),ma===null?Kr=sm:ma.sibling=sm,ma=sm,oi=tc}if(es.done)return M(yn,oi),_a&&mu(yn,Ci),Kr;if(oi===null){for(;!es.done;Ci++,es=An.next())es=ir(yn,es.value,Qn),es!==null&&(rn=ae(es,rn,Ci),ma===null?Kr=es:ma.sibling=es,ma=es);return _a&&mu(yn,Ci),Kr}for(oi=B(oi);!es.done;Ci++,es=An.next())es=Hn(oi,yn,Ci,es.value,Qn),es!==null&&(p&&es.alternate!==null&&oi.delete(es.key===null?Ci:es.key),rn=ae(es,rn,Ci),ma===null?Kr=es:ma.sibling=es,ma=es);return p&&oi.forEach(function(l3){return b(yn,l3)}),_a&&mu(yn,Ci),Kr}function $o(yn,rn,An,Qn){if(typeof An=="object"&&An!==null&&An.type===x&&An.key===null&&(An=An.props.children),typeof An=="object"&&An!==null){switch(An.$$typeof){case f:e:{for(var Kr=An.key;rn!==null;){if(rn.key===Kr){if(Kr=An.type,Kr===x){if(rn.tag===7){M(yn,rn.sibling),Qn=Y(rn,An.props.children),Qn.return=yn,yn=Qn;break e}}else if(rn.elementType===Kr||typeof Kr=="object"&&Kr!==null&&Kr.$$typeof===ie&&zp(Kr)===rn.type){M(yn,rn.sibling),Qn=Y(rn,An.props),Bf(Qn,An),Qn.return=yn,yn=Qn;break e}M(yn,rn);break}else b(yn,rn);rn=rn.sibling}An.type===x?(Qn=Pt(An.props.children,yn.mode,Qn,An.key),Qn.return=yn,yn=Qn):(Qn=an(An.type,An.key,An.props,null,yn.mode,Qn),Bf(Qn,An),Qn.return=yn,yn=Qn)}return Ne(yn);case i:e:{for(Kr=An.key;rn!==null;){if(rn.key===Kr)if(rn.tag===4&&rn.stateNode.containerInfo===An.containerInfo&&rn.stateNode.implementation===An.implementation){M(yn,rn.sibling),Qn=Y(rn,An.children||[]),Qn.return=yn,yn=Qn;break e}else{M(yn,rn);break}else b(yn,rn);rn=rn.sibling}Qn=fn(An,yn.mode,Qn),Qn.return=yn,yn=Qn}return Ne(yn);case ie:return Kr=An._init,An=Kr(An._payload),$o(yn,rn,An,Qn)}if(Le(An))return Zr(yn,rn,An,Qn);if(ye(An)){if(Kr=ye(An),typeof Kr!="function")throw Error(r(150));return An=Kr.call(An),Zi(yn,rn,An,Qn)}if(typeof An.then=="function")return $o(yn,rn,el(An),Qn);if(An.$$typeof===j)return $o(yn,rn,Wc(yn,An),Qn);Ph(yn,An)}return typeof An=="string"&&An!==""||typeof An=="number"||typeof An=="bigint"?(An=""+An,rn!==null&&rn.tag===6?(M(yn,rn.sibling),Qn=Y(rn,An),Qn.return=yn,yn=Qn):(M(yn,rn),Qn=Qt(An,yn.mode,Qn),Qn.return=yn,yn=Qn),Ne(yn)):M(yn,rn)}return function(yn,rn,An,Qn){try{fl=0;var Kr=$o(yn,rn,An,Qn);return zf=null,Kr}catch(oi){if(oi===gd)throw oi;var ma=tn(29,oi,null,yn.mode);return ma.lanes=Qn,ma.return=yn,ma}finally{}}}var Uu=Bp(!0),yd=Bp(!1),tl=mt(null),Oh=mt(0);function bc(p,b){p=ci,_e(Oh,p),_e(tl,b),ci=p|b.baseLanes}function Rh(){_e(Oh,ci),_e(tl,tl.current)}function qu(){ci=Oh.current,yt(tl),yt(Oh)}var Ml=mt(null),$c=null;function Vu(p){var b=p.alternate;_e(Ds,Ds.current&1),_e(Ml,p),$c===null&&(b===null||tl.current!==null||b.memoizedState!==null)&&($c=p)}function Hd(p){if(p.tag===22){if(_e(Ds,Ds.current),_e(Ml,p),$c===null){var b=p.alternate;b!==null&&b.memoizedState!==null&&($c=p)}}else Dh()}function Dh(){_e(Ds,Ds.current),_e(Ml,Ml.current)}function $u(p){yt(Ml),$c===p&&($c=null),yt(Ds)}var Ds=mt(0);function jp(p){for(var b=p;b!==null;){if(b.tag===13){var M=b.memoizedState;if(M!==null&&(M=M.dehydrated,M===null||M.data==="$?"||M.data==="$!"))return b}else if(b.tag===19&&b.memoizedProps.revealOrder!==void 0){if((b.flags&128)!==0)return b}else if(b.child!==null){b.child.return=b,b=b.child;continue}if(b===p)break;for(;b.sibling===null;){if(b.return===null||b.return===p)return null;b=b.return}b.sibling.return=b.return,b=b.sibling}return null}var km=typeof AbortController<"u"?AbortController:function(){var p=[],b=this.signal={aborted:!1,addEventListener:function(M,B){p.push(B)}};this.abort=function(){b.aborted=!0,p.forEach(function(M){return M()})}},_d=t.unstable_scheduleCallback,Fp=t.unstable_NormalPriority,Qs={$$typeof:j,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function jf(){return{controller:new km,data:new Map,refCount:0}}function q(p){p.refCount--,p.refCount===0&&_d(Fp,function(){p.controller.abort()})}var Z=null,de=0,Ie=0,Ve=null;function Ze(p,b){if(Z===null){var M=Z=[];de=0,Ie=n_(),Ve={status:"pending",value:void 0,then:function(B){M.push(B)}}}return de++,b.then(et,et),b}function et(){if(--de===0&&Z!==null){Ve!==null&&(Ve.status="fulfilled");var p=Z;Z=null,Ie=0,Ve=null;for(var b=0;b<p.length;b++)(0,p[b])()}}function at(p,b){var M=[],B={status:"pending",value:null,reason:null,then:function(Y){M.push(Y)}};return p.then(function(){B.status="fulfilled",B.value=b;for(var Y=0;Y<M.length;Y++)(0,M[Y])(b)},function(Y){for(B.status="rejected",B.reason=Y,Y=0;Y<M.length;Y++)(0,M[Y])(void 0)}),B}var ut=Ae.S;Ae.S=function(p,b){typeof b=="object"&&b!==null&&typeof b.then=="function"&&Ze(p,b),ut!==null&&ut(p,b)};var St=mt(null);function Jt(){var p=St.current;return p!==null?p:jr.pooledCache}function Mt(p,b){b===null?_e(St,St.current):_e(St,b.pool)}function vn(){var p=Jt();return p===null?null:{parent:Qs._currentValue,pool:p}}var nn=0,wn=null,pn=null,_t=null,en=!1,Vn=!1,Yn=!1,Gn=0,Tr=0,pr=null,ii=0;function cr(){throw Error(r(321))}function va(p,b){if(b===null)return!1;for(var M=0;M<b.length&&M<p.length;M++)if(!Rs(p[M],b[M]))return!1;return!0}function Ea(p,b,M,B,Y,ae){return nn=ae,wn=b,b.memoizedState=null,b.updateQueue=null,b.lanes=0,Ae.H=p===null||p.memoizedState===null?_u:Jl,Yn=!1,ae=M(B,Y),Yn=!1,Vn&&(ae=ta(b,M,B,Y)),$i(p),ae}function $i(p){Ae.H=Tc;var b=pn!==null&&pn.next!==null;if(nn=0,_t=pn=wn=null,en=!1,Tr=0,pr=null,b)throw Error(r(300));p===null||il||(p=p.dependencies,p!==null&&wd(p)&&(il=!0))}function ta(p,b,M,B){wn=p;var Y=0;do{if(Vn&&(pr=null),Tr=0,Vn=!1,25<=Y)throw Error(r(301));if(Y+=1,_t=pn=null,p.updateQueue!=null){var ae=p.updateQueue;ae.lastEffect=null,ae.events=null,ae.stores=null,ae.memoCache!=null&&(ae.memoCache.index=0)}Ae.H=vu,ae=b(M,B)}while(Vn);return ae}function Ga(){var p=Ae.H,b=p.useState()[0];return b=typeof b.then=="function"?ba(b):b,p=p.useState()[0],(pn!==null?pn.memoizedState:null)!==p&&(wn.flags|=1024),b}function Bi(){var p=Gn!==0;return Gn=0,p}function vi(p,b,M){b.updateQueue=p.updateQueue,b.flags&=-2053,p.lanes&=~M}function cs(p){if(en){for(p=p.memoizedState;p!==null;){var b=p.queue;b!==null&&(b.pending=null),p=p.next}en=!1}nn=0,_t=pn=wn=null,Vn=!1,Tr=Gn=0,pr=null}function Ba(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return _t===null?wn.memoizedState=_t=p:_t=_t.next=p,_t}function ji(){if(pn===null){var p=wn.alternate;p=p!==null?p.memoizedState:null}else p=pn.next;var b=_t===null?wn.memoizedState:_t.next;if(b!==null)_t=b,pn=p;else{if(p===null)throw wn.alternate===null?Error(r(467)):Error(r(310));pn=p,p={memoizedState:pn.memoizedState,baseState:pn.baseState,baseQueue:pn.baseQueue,queue:pn.queue,next:null},_t===null?wn.memoizedState=_t=p:_t=_t.next=p}return _t}var fo;fo=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}};function ba(p){var b=Tr;return Tr+=1,pr===null&&(pr=[]),p=Vc(pr,p,b),b=wn,(_t===null?b.memoizedState:_t.next)===null&&(b=b.alternate,Ae.H=b===null||b.memoizedState===null?_u:Jl),p}function is(p){if(p!==null&&typeof p=="object"){if(typeof p.then=="function")return ba(p);if(p.$$typeof===j)return Gs(p)}throw Error(r(438,String(p)))}function bi(p){var b=null,M=wn.updateQueue;if(M!==null&&(b=M.memoCache),b==null){var B=wn.alternate;B!==null&&(B=B.updateQueue,B!==null&&(B=B.memoCache,B!=null&&(b={data:B.data.map(function(Y){return Y.slice()}),index:0})))}if(b==null&&(b={data:[],index:0}),M===null&&(M=fo(),wn.updateQueue=M),M.memoCache=b,M=b.data[b.index],M===void 0)for(M=b.data[b.index]=Array(p),B=0;B<p;B++)M[B]=ge;return b.index++,M}function ka(p,b){return typeof b=="function"?b(p):b}function $s(p){var b=ji();return wo(b,pn,p)}function wo(p,b,M){var B=p.queue;if(B===null)throw Error(r(311));B.lastRenderedReducer=M;var Y=p.baseQueue,ae=B.pending;if(ae!==null){if(Y!==null){var Ne=Y.next;Y.next=ae.next,ae.next=Ne}b.baseQueue=Y=ae,B.pending=null}if(ae=p.baseState,Y===null)p.memoizedState=ae;else{b=Y.next;var ot=Ne=null,Bt=null,ln=b,$n=!1;do{var ir=ln.lane&-536870913;if(ir!==ln.lane?(fr&ir)===ir:(nn&ir)===ir){var Mn=ln.revertLane;if(Mn===0)Bt!==null&&(Bt=Bt.next={lane:0,revertLane:0,action:ln.action,hasEagerState:ln.hasEagerState,eagerState:ln.eagerState,next:null}),ir===Ie&&($n=!0);else if((nn&Mn)===Mn){ln=ln.next,Mn===Ie&&($n=!0);continue}else ir={lane:0,revertLane:ln.revertLane,action:ln.action,hasEagerState:ln.hasEagerState,eagerState:ln.eagerState,next:null},Bt===null?(ot=Bt=ir,Ne=ae):Bt=Bt.next=ir,wn.lanes|=Mn,Ka|=Mn;ir=ln.action,Yn&&M(ae,ir),ae=ln.hasEagerState?ln.eagerState:M(ae,ir)}else Mn={lane:ir,revertLane:ln.revertLane,action:ln.action,hasEagerState:ln.hasEagerState,eagerState:ln.eagerState,next:null},Bt===null?(ot=Bt=Mn,Ne=ae):Bt=Bt.next=Mn,wn.lanes|=ir,Ka|=ir;ln=ln.next}while(ln!==null&&ln!==b);if(Bt===null?Ne=ae:Bt.next=ot,!Rs(ae,p.memoizedState)&&(il=!0,$n&&(M=Ve,M!==null)))throw M;p.memoizedState=ae,p.baseState=Ne,p.baseQueue=Bt,B.lastRenderedState=ae}return Y===null&&(B.lanes=0),[p.memoizedState,B.dispatch]}function nl(p){var b=ji(),M=b.queue;if(M===null)throw Error(r(311));M.lastRenderedReducer=p;var B=M.dispatch,Y=M.pending,ae=b.memoizedState;if(Y!==null){M.pending=null;var Ne=Y=Y.next;do ae=p(ae,Ne.action),Ne=Ne.next;while(Ne!==Y);Rs(ae,b.memoizedState)||(il=!0),b.memoizedState=ae,b.baseQueue===null&&(b.baseState=ae),M.lastRenderedState=ae}return[ae,B]}function Cl(p,b,M){var B=wn,Y=ji(),ae=_a;if(ae){if(M===void 0)throw Error(r(407));M=M()}else M=b();var Ne=!Rs((pn||Y).memoizedState,M);if(Ne&&(Y.memoizedState=M,il=!0),Y=Y.queue,Wu(xc.bind(null,B,Y,p),[p]),Y.getSnapshot!==b||Ne||_t!==null&&_t.memoizedState.tag&1){if(B.flags|=2048,Pl(9,Il.bind(null,B,Y,M,b),{destroy:void 0},null),jr===null)throw Error(r(349));ae||(nn&60)!==0||Es(B,b,M)}return M}function Es(p,b,M){p.flags|=16384,p={getSnapshot:b,value:M},b=wn.updateQueue,b===null?(b=fo(),wn.updateQueue=b,b.stores=[p]):(M=b.stores,M===null?b.stores=[p]:M.push(p))}function Il(p,b,M,B){b.value=M,b.getSnapshot=B,En(b)&&Fn(p)}function xc(p,b,M){return M(function(){En(b)&&Fn(p)})}function En(p){var b=p.getSnapshot;p=p.value;try{var M=b();return!Rs(p,M)}catch{return!0}}function Fn(p){var b=Zo(p,2);b!==null&&Dl(b,p,2)}function Wa(p){var b=Ba();if(typeof p=="function"){var M=p;if(p=M(),Yn){mi(!0);try{M()}finally{mi(!1)}}}return b.memoizedState=b.baseState=p,b.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ka,lastRenderedState:p},b}function Ra(p,b,M,B){return p.baseState=M,wo(p,pn,typeof B=="function"?B:ka)}function qt(p,b,M,B,Y){if(Xu(p))throw Error(r(485));if(p=b.action,p!==null){var ae={payload:Y,action:p,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(Ne){ae.listeners.push(Ne)}};Ae.T!==null?M(!0):ae.isTransition=!1,B(ae),M=b.pending,M===null?(ae.next=b.pending=ae,Up(b,ae)):(ae.next=M.next,b.pending=M.next=ae)}}function Up(p,b){var M=b.action,B=b.payload,Y=p.state;if(b.isTransition){var ae=Ae.T,Ne={};Ae.T=Ne;try{var ot=M(Y,B),Bt=Ae.S;Bt!==null&&Bt(Ne,ot),sf(p,b,ot)}catch(ln){lf(p,b,ln)}finally{Ae.T=ae}}else try{ae=M(Y,B),sf(p,b,ae)}catch(ln){lf(p,b,ln)}}function sf(p,b,M){M!==null&&typeof M=="object"&&typeof M.then=="function"?M.then(function(B){of(p,b,B)},function(B){return lf(p,b,B)}):of(p,b,M)}function of(p,b,M){b.status="fulfilled",b.value=M,wc(b),p.state=M,b=p.pending,b!==null&&(M=b.next,M===b?p.pending=null:(M=M.next,b.next=M,Up(p,M)))}function lf(p,b,M){var B=p.pending;if(p.pending=null,B!==null){B=B.next;do b.status="rejected",b.reason=M,wc(b),b=b.next;while(b!==B)}p.action=null}function wc(p){p=p.listeners;for(var b=0;b<p.length;b++)(0,p[b])()}function cf(p,b){return b}function Hc(p,b){if(_a){var M=jr.formState;if(M!==null){e:{var B=wn;if(_a){if(Ha){t:{for(var Y=Ha,ae=_c;Y.nodeType!==8;){if(!ae){Y=null;break t}if(Y=Ic(Y.nextSibling),Y===null){Y=null;break t}}ae=Y.data,Y=ae==="F!"||ae==="F"?Y:null}if(Y){Ha=Ic(Y.nextSibling),B=Y.data==="F!";break e}}gu(B)}B=!1}B&&(b=M[0])}}return M=Ba(),M.memoizedState=M.baseState=b,B={pending:null,lanes:0,dispatch:null,lastRenderedReducer:cf,lastRenderedState:b},M.queue=B,M=Xd.bind(null,wn,B),B.dispatch=M,B=Wa(!1),ae=Yu.bind(null,wn,!1,B.queue),B=Ba(),Y={state:b,dispatch:null,action:p,pending:null},B.queue=Y,M=qt.bind(null,wn,Y,ae,M),Y.dispatch=M,B.memoizedState=p,[b,M,!1]}function Nm(p){var b=ji();return Gd(b,pn,p)}function Gd(p,b,M){b=wo(p,b,cf)[0],p=$s(ka)[0],b=typeof b=="object"&&b!==null&&typeof b.then=="function"?ba(b):b;var B=ji(),Y=B.queue,ae=Y.dispatch;return M!==B.memoizedState&&(wn.flags|=2048,Pl(9,zm.bind(null,Y,M),{destroy:void 0},null)),[b,ae,p]}function zm(p,b){p.action=b}function uf(p){var b=ji(),M=pn;if(M!==null)return Gd(b,M,p);ji(),b=b.memoizedState,M=ji();var B=M.queue.dispatch;return M.memoizedState=p,[b,B,!1]}function Pl(p,b,M,B){return p={tag:p,create:b,inst:M,deps:B,next:null},b=wn.updateQueue,b===null&&(b=fo(),wn.updateQueue=b),M=b.lastEffect,M===null?b.lastEffect=p.next=p:(B=M.next,M.next=p,p.next=B,b.lastEffect=p),p}function Ff(){return ji().memoizedState}function Hu(p,b,M,B){var Y=Ba();wn.flags|=p,Y.memoizedState=Pl(1|b,M,{destroy:void 0},B===void 0?null:B)}function Gu(p,b,M,B){var Y=ji();B=B===void 0?null:B;var ae=Y.memoizedState.inst;pn!==null&&B!==null&&va(B,pn.memoizedState.deps)?Y.memoizedState=Pl(b,M,ae,B):(wn.flags|=p,Y.memoizedState=Pl(1|b,M,ae,B))}function Wd(p,b){Hu(8390656,8,p,b)}function Wu(p,b){Gu(2048,8,p,b)}function rl(p,b){return Gu(4,2,p,b)}function Bm(p,b){return Gu(4,4,p,b)}function eo(p,b){if(typeof b=="function"){p=p();var M=b(p);return function(){typeof M=="function"?M():b(null)}}if(b!=null)return p=p(),b.current=p,function(){b.current=null}}function Pg(p,b,M){M=M!=null?M.concat([p]):null,Gu(4,4,eo.bind(null,b,p),M)}function hf(){}function na(p,b){var M=ji();b=b===void 0?null:b;var B=M.memoizedState;return b!==null&&va(b,B[1])?B[0]:(M.memoizedState=[p,b],p)}function Mi(p,b){var M=ji();b=b===void 0?null:b;var B=M.memoizedState;if(b!==null&&va(b,B[1]))return B[0];if(B=p(),Yn){mi(!0);try{p()}finally{mi(!1)}}return M.memoizedState=[B,b],B}function Kd(p,b,M){return M===void 0||(nn&1073741824)!==0?p.memoizedState=b:(p.memoizedState=M,p=_f(),wn.lanes|=p,Ka|=p,M)}function Sc(p,b,M,B){return Rs(M,b)?M:tl.current!==null?(p=Kd(p,M,B),Rs(p,b)||(il=!0),p):(nn&42)===0?(il=!0,p.memoizedState=M):(p=_f(),wn.lanes|=p,Ka|=p,b)}function Lh(p,b,M,B,Y){var ae=Xe.p;Xe.p=ae!==0&&8>ae?ae:8;var Ne=Ae.T,ot={};Ae.T=ot,Yu(p,!1,b,M);try{var Bt=Y(),ln=Ae.S;if(ln!==null&&ln(ot,Bt),Bt!==null&&typeof Bt=="object"&&typeof Bt.then=="function"){var $n=at(Bt,B);ff(p,b,$n,go(p))}else ff(p,b,B,go(p))}catch(ir){ff(p,b,{then:function(){},status:"rejected",reason:ir},go())}finally{Xe.p=ae,Ae.T=Ne}}function Ac(){}function Ku(p,b,M,B){if(p.tag!==5)throw Error(r(476));var Y=vd(p).queue;Lh(p,Y,b,ct,M===null?Ac:function(){return Uf(p),M(B)})}function vd(p){var b=p.memoizedState;if(b!==null)return b;b={memoizedState:ct,baseState:ct,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ka,lastRenderedState:ct},next:null};var M={};return b.next={memoizedState:M,baseState:M,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ka,lastRenderedState:M},next:null},p.memoizedState=b,p=p.alternate,p!==null&&(p.memoizedState=b),b}function Uf(p){var b=vd(p).next.queue;ff(p,b,{},go())}function Ol(){return Gs(Yg)}function bd(){return ji().memoizedState}function So(){return ji().memoizedState}function kh(p){for(var b=p.return;b!==null;){switch(b.tag){case 24:case 3:var M=go();p=Sd(M);var B=Ad(b,p,M);B!==null&&(Dl(B,b,M),Td(B,b,M)),b={cache:jf()},p.payload=b;return}b=b.return}}function Yd(p,b,M){var B=go();M={lane:B,revertLane:0,action:M,hasEagerState:!1,eagerState:null,next:null},Xu(p)?Zd(b,M):(M=Bu(p,b,M,B),M!==null&&(Dl(M,p,B),Nh(M,b,B)))}function Xd(p,b,M){var B=go();ff(p,b,M,B)}function ff(p,b,M,B){var Y={lane:B,revertLane:0,action:M,hasEagerState:!1,eagerState:null,next:null};if(Xu(p))Zd(b,Y);else{var ae=p.alternate;if(p.lanes===0&&(ae===null||ae.lanes===0)&&(ae=b.lastRenderedReducer,ae!==null))try{var Ne=b.lastRenderedState,ot=ae(Ne,M);if(Y.hasEagerState=!0,Y.eagerState=ot,Rs(ot,Ne))return Yl(p,b,Y,0),jr===null&&rs(),!1}catch{}finally{}if(M=Bu(p,b,Y,B),M!==null)return Dl(M,p,B),Nh(M,b,B),!0}return!1}function Yu(p,b,M,B){if(B={lane:2,revertLane:n_(),action:B,hasEagerState:!1,eagerState:null,next:null},Xu(p)){if(b)throw Error(r(479))}else b=Bu(p,M,B,2),b!==null&&Dl(b,p,2)}function Xu(p){var b=p.alternate;return p===wn||b!==null&&b===wn}function Zd(p,b){Vn=en=!0;var M=p.pending;M===null?b.next=b:(b.next=M.next,M.next=b),p.pending=b}function Nh(p,b,M){if((M&4194176)!==0){var B=b.lanes;B&=p.pendingLanes,M|=B,b.lanes=M,ft(p,M)}}var Tc={readContext:Gs,use:is,useCallback:cr,useContext:cr,useEffect:cr,useImperativeHandle:cr,useLayoutEffect:cr,useInsertionEffect:cr,useMemo:cr,useReducer:cr,useRef:cr,useState:cr,useDebugValue:cr,useDeferredValue:cr,useTransition:cr,useSyncExternalStore:cr,useId:cr};Tc.useCacheRefresh=cr,Tc.useMemoCache=cr,Tc.useHostTransitionStatus=cr,Tc.useFormState=cr,Tc.useActionState=cr,Tc.useOptimistic=cr;var _u={readContext:Gs,use:is,useCallback:function(p,b){return Ba().memoizedState=[p,b===void 0?null:b],p},useContext:Gs,useEffect:Wd,useImperativeHandle:function(p,b,M){M=M!=null?M.concat([p]):null,Hu(4194308,4,eo.bind(null,b,p),M)},useLayoutEffect:function(p,b){return Hu(4194308,4,p,b)},useInsertionEffect:function(p,b){Hu(4,2,p,b)},useMemo:function(p,b){var M=Ba();b=b===void 0?null:b;var B=p();if(Yn){mi(!0);try{p()}finally{mi(!1)}}return M.memoizedState=[B,b],B},useReducer:function(p,b,M){var B=Ba();if(M!==void 0){var Y=M(b);if(Yn){mi(!0);try{M(b)}finally{mi(!1)}}}else Y=b;return B.memoizedState=B.baseState=Y,p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:Y},B.queue=p,p=p.dispatch=Yd.bind(null,wn,p),[B.memoizedState,p]},useRef:function(p){var b=Ba();return p={current:p},b.memoizedState=p},useState:function(p){p=Wa(p);var b=p.queue,M=Xd.bind(null,wn,b);return b.dispatch=M,[p.memoizedState,M]},useDebugValue:hf,useDeferredValue:function(p,b){var M=Ba();return Kd(M,p,b)},useTransition:function(){var p=Wa(!1);return p=Lh.bind(null,wn,p.queue,!0,!1),Ba().memoizedState=p,[!1,p]},useSyncExternalStore:function(p,b,M){var B=wn,Y=Ba();if(_a){if(M===void 0)throw Error(r(407));M=M()}else{if(M=b(),jr===null)throw Error(r(349));(fr&60)!==0||Es(B,b,M)}Y.memoizedState=M;var ae={value:M,getSnapshot:b};return Y.queue=ae,Wd(xc.bind(null,B,ae,p),[p]),B.flags|=2048,Pl(9,Il.bind(null,B,ae,M,b),{destroy:void 0},null),M},useId:function(){var p=Ba(),b=jr.identifierPrefix;if(_a){var M=qc,B=yc;M=(B&~(1<<32-ti(B)-1)).toString(32)+M,b=":"+b+"R"+M,M=Gn++,0<M&&(b+="H"+M.toString(32)),b+=":"}else M=ii++,b=":"+b+"r"+M.toString(32)+":";return p.memoizedState=b},useCacheRefresh:function(){return Ba().memoizedState=kh.bind(null,wn)}};_u.useMemoCache=bi,_u.useHostTransitionStatus=Ol,_u.useFormState=Hc,_u.useActionState=Hc,_u.useOptimistic=function(p){var b=Ba();b.memoizedState=b.baseState=p;var M={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return b.queue=M,b=Yu.bind(null,wn,!0,M),M.dispatch=b,[p,b]};var Jl={readContext:Gs,use:is,useCallback:na,useContext:Gs,useEffect:Wu,useImperativeHandle:Pg,useInsertionEffect:rl,useLayoutEffect:Bm,useMemo:Mi,useReducer:$s,useRef:Ff,useState:function(){return $s(ka)},useDebugValue:hf,useDeferredValue:function(p,b){var M=ji();return Sc(M,pn.memoizedState,p,b)},useTransition:function(){var p=$s(ka)[0],b=ji().memoizedState;return[typeof p=="boolean"?p:ba(p),b]},useSyncExternalStore:Cl,useId:bd};Jl.useCacheRefresh=So,Jl.useMemoCache=bi,Jl.useHostTransitionStatus=Ol,Jl.useFormState=Nm,Jl.useActionState=Nm,Jl.useOptimistic=function(p,b){var M=ji();return Ra(M,pn,p,b)};var vu={readContext:Gs,use:is,useCallback:na,useContext:Gs,useEffect:Wu,useImperativeHandle:Pg,useInsertionEffect:rl,useLayoutEffect:Bm,useMemo:Mi,useReducer:nl,useRef:Ff,useState:function(){return nl(ka)},useDebugValue:hf,useDeferredValue:function(p,b){var M=ji();return pn===null?Kd(M,p,b):Sc(M,pn.memoizedState,p,b)},useTransition:function(){var p=nl(ka)[0],b=ji().memoizedState;return[typeof p=="boolean"?p:ba(p),b]},useSyncExternalStore:Cl,useId:bd};vu.useCacheRefresh=So,vu.useMemoCache=bi,vu.useHostTransitionStatus=Ol,vu.useFormState=uf,vu.useActionState=uf,vu.useOptimistic=function(p,b){var M=ji();return pn!==null?Ra(M,pn,p,b):(M.baseState=p,[p,M.queue.dispatch])};function Ms(p,b,M,B){b=p.memoizedState,M=M(B,b),M=M==null?b:Oe({},b,M),p.memoizedState=M,p.lanes===0&&(p.updateQueue.baseState=M)}var Ql={isMounted:function(p){return(p=p._reactInternals)?Fe(p)===p:!1},enqueueSetState:function(p,b,M){p=p._reactInternals;var B=go(),Y=Sd(B);Y.payload=b,M!=null&&(Y.callback=M),b=Ad(p,Y,B),b!==null&&(Dl(b,p,B),Td(b,p,B))},enqueueReplaceState:function(p,b,M){p=p._reactInternals;var B=go(),Y=Sd(B);Y.tag=1,Y.payload=b,M!=null&&(Y.callback=M),b=Ad(p,Y,B),b!==null&&(Dl(b,p,B),Td(b,p,B))},enqueueForceUpdate:function(p,b){p=p._reactInternals;var M=go(),B=Sd(M);B.tag=2,b!=null&&(B.callback=b),b=Ad(p,B,M),b!==null&&(Dl(b,p,M),Td(b,p,M))}};function Gc(p,b,M,B,Y,ae,Ne){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(B,ae,Ne):b.prototype&&b.prototype.isPureReactComponent?!Sl(M,B)||!Sl(Y,ae):!0}function Hs(p,b,M,B){p=b.state,typeof b.componentWillReceiveProps=="function"&&b.componentWillReceiveProps(M,B),typeof b.UNSAFE_componentWillReceiveProps=="function"&&b.UNSAFE_componentWillReceiveProps(M,B),b.state!==p&&Ql.enqueueReplaceState(b,b.state,null)}function Ec(p,b){var M=b;if("ref"in b){M={};for(var B in b)B!=="ref"&&(M[B]=b[B])}if(p=p.defaultProps){M===b&&(M=Oe({},M));for(var Y in p)M[Y]===void 0&&(M[Y]=p[Y])}return M}var df=typeof reportError=="function"?reportError:function(p){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var b=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof p=="object"&&p!==null&&typeof p.message=="string"?String(p.message):String(p),error:p});if(!window.dispatchEvent(b))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",p);return}console.error(p)};function Jd(p){df(p)}function qf(p){console.error(p)}function pf(p){df(p)}function zh(p,b){try{var M=p.onUncaughtError;M(b.value,{componentStack:b.stack})}catch(B){setTimeout(function(){throw B})}}function jm(p,b,M){try{var B=p.onCaughtError;B(M.value,{componentStack:M.stack,errorBoundary:b.tag===1?b.stateNode:null})}catch(Y){setTimeout(function(){throw Y})}}function qp(p,b,M){return M=Sd(M),M.tag=3,M.payload={element:null},M.callback=function(){zh(p,b)},M}function Fm(p){return p=Sd(p),p.tag=3,p}function Og(p,b,M,B){var Y=M.type.getDerivedStateFromError;if(typeof Y=="function"){var ae=B.value;p.payload=function(){return Y(ae)},p.callback=function(){jm(b,M,B)}}var Ne=M.stateNode;Ne!==null&&typeof Ne.componentDidCatch=="function"&&(p.callback=function(){jm(b,M,B),typeof Y!="function"&&(as===null?as=new Set([this]):as.add(this));var ot=B.stack;this.componentDidCatch(B.value,{componentStack:ot!==null?ot:""})})}function Fy(p,b,M,B,Y){if(M.flags|=32768,B!==null&&typeof B=="object"&&typeof B.then=="function"){if(b=M.alternate,b!==null&&rp(b,M,Y,!0),M=Ml.current,M!==null){switch(M.tag){case 13:return $c===null?Ev():M.alternate===null&&Oi===0&&(Oi=3),M.flags&=-257,M.flags|=65536,M.lanes=Y,B===af?M.flags|=16384:(b=M.updateQueue,b===null?M.updateQueue=new Set([B]):b.add(B),J1(p,B,Y)),!1;case 22:return M.flags|=65536,B===af?M.flags|=16384:(b=M.updateQueue,b===null?(b={transitions:null,markerInstances:null,retryQueue:new Set([B])},M.updateQueue=b):(M=b.retryQueue,M===null?b.retryQueue=new Set([B]):M.add(B)),J1(p,B,Y)),!1}throw Error(r(435,M.tag))}return J1(p,B,Y),Ev(),!1}if(_a)return b=Ml.current,b!==null?((b.flags&65536)===0&&(b.flags|=256),b.flags|=65536,b.lanes=Y,B!==$d&&(p=Error(r(422),{cause:B}),Ih(Qa(p,M)))):(B!==$d&&(b=Error(r(423),{cause:B}),Ih(Qa(b,M))),p=p.current.alternate,p.flags|=65536,Y&=-Y,p.lanes|=Y,B=Qa(B,M),Y=qp(p.stateNode,B,Y),Lg(p,Y),Oi!==4&&(Oi=2)),!1;var ae=Error(r(520),{cause:B});if(ae=Qa(ae,M),Ti===null?Ti=[ae]:Ti.push(ae),Oi!==4&&(Oi=2),b===null)return!0;B=Qa(B,M),M=b;do{switch(M.tag){case 3:return M.flags|=65536,p=Y&-Y,M.lanes|=p,p=qp(M.stateNode,B,p),Lg(M,p),!1;case 1:if(b=M.type,ae=M.stateNode,(M.flags&128)===0&&(typeof b.getDerivedStateFromError=="function"||ae!==null&&typeof ae.componentDidCatch=="function"&&(as===null||!as.has(ae))))return M.flags|=65536,Y&=-Y,M.lanes|=Y,Y=Fm(Y),Og(Y,p,M,B),Lg(M,Y),!1}M=M.return}while(M!==null);return!1}var Vp=Error(r(461)),il=!1;function dl(p,b,M,B){b.child=p===null?yd(b,null,M,B):Uu(b,p.child,M,B)}function Uy(p,b,M,B,Y){M=M.render;var ae=b.ref;if("ref"in B){var Ne={};for(var ot in B)ot!=="ref"&&(Ne[ot]=B[ot])}else Ne=B;return xu(b),B=Ea(p,b,M,Ne,ae,Y),ot=Bi(),p!==null&&!il?(vi(p,b,Y),bu(p,b,Y)):(_a&&ot&&Df(b),b.flags|=1,dl(p,b,B,Y),b.child)}function qy(p,b,M,B,Y){if(p===null){var ae=M.type;return typeof ae=="function"&&!un(ae)&&ae.defaultProps===void 0&&M.compare===null?(b.tag=15,b.type=ae,Vy(p,b,ae,B,Y)):(p=an(M.type,null,B,b,b.mode,Y),p.ref=b.ref,p.return=b,b.child=p)}if(ae=p.child,!ps(p,Y)){var Ne=ae.memoizedProps;if(M=M.compare,M=M!==null?M:Sl,M(Ne,B)&&p.ref===b.ref)return bu(p,b,Y)}return b.flags|=1,p=Tn(ae,B),p.ref=b.ref,p.return=b,b.child=p}function Vy(p,b,M,B,Y){if(p!==null){var ae=p.memoizedProps;if(Sl(ae,B)&&p.ref===b.ref)if(il=!1,b.pendingProps=B=ae,ps(p,Y))(p.flags&131072)!==0&&(il=!0);else return b.lanes=p.lanes,bu(p,b,Y)}return Qd(p,b,M,B,Y)}function $p(p,b,M){var B=b.pendingProps,Y=B.children,ae=(b.stateNode._pendingVisibility&2)!==0,Ne=p!==null?p.memoizedState:null;if(pl(p,b),B.mode==="hidden"||ae){if((b.flags&128)!==0){if(B=Ne!==null?Ne.baseLanes|M:M,p!==null){for(Y=b.child=p.child,ae=0;Y!==null;)ae=ae|Y.lanes|Y.childLanes,Y=Y.sibling;b.childLanes=ae&~B}else b.childLanes=0,b.child=null;return Hp(p,b,B,M)}if((M&536870912)!==0)b.memoizedState={baseLanes:0,cachePool:null},p!==null&&Mt(b,Ne!==null?Ne.cachePool:null),Ne!==null?bc(b,Ne):Rh(),Hd(b);else return b.lanes=b.childLanes=536870912,Hp(p,b,Ne!==null?Ne.baseLanes|M:M,M)}else Ne!==null?(Mt(b,Ne.cachePool),bc(b,Ne),Dh(),b.memoizedState=null):(p!==null&&Mt(b,null),Rh(),Dh());return dl(p,b,Y,M),b.child}function Hp(p,b,M,B){var Y=Jt();return Y=Y===null?null:{parent:Qs._currentValue,pool:Y},b.memoizedState={baseLanes:M,cachePool:Y},p!==null&&Mt(b,null),Rh(),Hd(b),p!==null&&rp(p,b,B,!0),null}function pl(p,b){var M=b.ref;if(M===null)p!==null&&p.ref!==null&&(b.flags|=2097664);else{if(typeof M!="function"&&typeof M!="object")throw Error(r(284));(p===null||p.ref!==M)&&(b.flags|=2097664)}}function Qd(p,b,M,B,Y){return xu(b),M=Ea(p,b,M,B,void 0,Y),B=Bi(),p!==null&&!il?(vi(p,b,Y),bu(p,b,Y)):(_a&&B&&Df(b),b.flags|=1,dl(p,b,M,Y),b.child)}function $y(p,b,M,B,Y,ae){return xu(b),b.updateQueue=null,M=ta(b,B,M,Y),$i(p),B=Bi(),p!==null&&!il?(vi(p,b,ae),bu(p,b,ae)):(_a&&B&&Df(b),b.flags|=1,dl(p,b,M,ae),b.child)}function Hy(p,b,M,B,Y){if(xu(b),b.stateNode===null){var ae=ju,Ne=M.contextType;typeof Ne=="object"&&Ne!==null&&(ae=Gs(Ne)),ae=new M(B,ae),b.memoizedState=ae.state!==null&&ae.state!==void 0?ae.state:null,ae.updater=Ql,b.stateNode=ae,ae._reactInternals=b,ae=b.stateNode,ae.props=B,ae.state=b.memoizedState,ae.refs={},gf(b),Ne=M.contextType,ae.context=typeof Ne=="object"&&Ne!==null?Gs(Ne):ju,ae.state=b.memoizedState,Ne=M.getDerivedStateFromProps,typeof Ne=="function"&&(Ms(b,M,Ne,B),ae.state=b.memoizedState),typeof M.getDerivedStateFromProps=="function"||typeof ae.getSnapshotBeforeUpdate=="function"||typeof ae.UNSAFE_componentWillMount!="function"&&typeof ae.componentWillMount!="function"||(Ne=ae.state,typeof ae.componentWillMount=="function"&&ae.componentWillMount(),typeof ae.UNSAFE_componentWillMount=="function"&&ae.UNSAFE_componentWillMount(),Ne!==ae.state&&Ql.enqueueReplaceState(ae,ae.state,null),Kp(b,B,ae,Y),yf(),ae.state=b.memoizedState),typeof ae.componentDidMount=="function"&&(b.flags|=4194308),B=!0}else if(p===null){ae=b.stateNode;var ot=b.memoizedProps,Bt=Ec(M,ot);ae.props=Bt;var ln=ae.context,$n=M.contextType;Ne=ju,typeof $n=="object"&&$n!==null&&(Ne=Gs($n));var ir=M.getDerivedStateFromProps;$n=typeof ir=="function"||typeof ae.getSnapshotBeforeUpdate=="function",ot=b.pendingProps!==ot,$n||typeof ae.UNSAFE_componentWillReceiveProps!="function"&&typeof ae.componentWillReceiveProps!="function"||(ot||ln!==Ne)&&Hs(b,ae,B,Ne),Kc=!1;var Mn=b.memoizedState;ae.state=Mn,Kp(b,B,ae,Y),yf(),ln=b.memoizedState,ot||Mn!==ln||Kc?(typeof ir=="function"&&(Ms(b,M,ir,B),ln=b.memoizedState),(Bt=Kc||Gc(b,M,Bt,B,Mn,ln,Ne))?($n||typeof ae.UNSAFE_componentWillMount!="function"&&typeof ae.componentWillMount!="function"||(typeof ae.componentWillMount=="function"&&ae.componentWillMount(),typeof ae.UNSAFE_componentWillMount=="function"&&ae.UNSAFE_componentWillMount()),typeof ae.componentDidMount=="function"&&(b.flags|=4194308)):(typeof ae.componentDidMount=="function"&&(b.flags|=4194308),b.memoizedProps=B,b.memoizedState=ln),ae.props=B,ae.state=ln,ae.context=Ne,B=Bt):(typeof ae.componentDidMount=="function"&&(b.flags|=4194308),B=!1)}else{ae=b.stateNode,Yy(p,b),Ne=b.memoizedProps,$n=Ec(M,Ne),ae.props=$n,ir=b.pendingProps,Mn=ae.context,ln=M.contextType,Bt=ju,typeof ln=="object"&&ln!==null&&(Bt=Gs(ln)),ot=M.getDerivedStateFromProps,(ln=typeof ot=="function"||typeof ae.getSnapshotBeforeUpdate=="function")||typeof ae.UNSAFE_componentWillReceiveProps!="function"&&typeof ae.componentWillReceiveProps!="function"||(Ne!==ir||Mn!==Bt)&&Hs(b,ae,B,Bt),Kc=!1,Mn=b.memoizedState,ae.state=Mn,Kp(b,B,ae,Y),yf();var Hn=b.memoizedState;Ne!==ir||Mn!==Hn||Kc||p!==null&&p.dependencies!==null&&wd(p.dependencies)?(typeof ot=="function"&&(Ms(b,M,ot,B),Hn=b.memoizedState),($n=Kc||Gc(b,M,$n,B,Mn,Hn,Bt)||p!==null&&p.dependencies!==null&&wd(p.dependencies))?(ln||typeof ae.UNSAFE_componentWillUpdate!="function"&&typeof ae.componentWillUpdate!="function"||(typeof ae.componentWillUpdate=="function"&&ae.componentWillUpdate(B,Hn,Bt),typeof ae.UNSAFE_componentWillUpdate=="function"&&ae.UNSAFE_componentWillUpdate(B,Hn,Bt)),typeof ae.componentDidUpdate=="function"&&(b.flags|=4),typeof ae.getSnapshotBeforeUpdate=="function"&&(b.flags|=1024)):(typeof ae.componentDidUpdate!="function"||Ne===p.memoizedProps&&Mn===p.memoizedState||(b.flags|=4),typeof ae.getSnapshotBeforeUpdate!="function"||Ne===p.memoizedProps&&Mn===p.memoizedState||(b.flags|=1024),b.memoizedProps=B,b.memoizedState=Hn),ae.props=B,ae.state=Hn,ae.context=Bt,B=$n):(typeof ae.componentDidUpdate!="function"||Ne===p.memoizedProps&&Mn===p.memoizedState||(b.flags|=4),typeof ae.getSnapshotBeforeUpdate!="function"||Ne===p.memoizedProps&&Mn===p.memoizedState||(b.flags|=1024),B=!1)}return ae=B,pl(p,b),B=(b.flags&128)!==0,ae||B?(ae=b.stateNode,M=B&&typeof M.getDerivedStateFromError!="function"?null:ae.render(),b.flags|=1,p!==null&&B?(b.child=Uu(b,p.child,null,Y),b.child=Uu(b,null,M,Y)):dl(p,b,M,Y),b.memoizedState=ae.state,p=b.child):p=bu(p,b,Y),p}function Sv(p,b,M,B){return Nf(),b.flags|=256,dl(p,b,M,B),b.child}var Gy={dehydrated:null,treeContext:null,retryLane:0};function Da(p){return{baseLanes:p,cachePool:vn()}}function Rg(p,b,M){return p=p!==null?p.childLanes&~M:0,b&&(p|=Ws),p}function Dg(p,b,M){var B=b.pendingProps,Y=!1,ae=(b.flags&128)!==0,Ne;if((Ne=ae)||(Ne=p!==null&&p.memoizedState===null?!1:(Ds.current&2)!==0),Ne&&(Y=!0,b.flags&=-129),Ne=(b.flags&32)!==0,b.flags&=-33,p===null){if(_a){if(Y?Vu(b):Dh(),_a){var ot=Ha,Bt;if(Bt=ot){e:{for(Bt=ot,ot=_c;Bt.nodeType!==8;){if(!ot){ot=null;break e}if(Bt=Ic(Bt.nextSibling),Bt===null){ot=null;break e}}ot=Bt}ot!==null?(b.memoizedState={dehydrated:ot,treeContext:Fu!==null?{id:yc,overflow:qc}:null,retryLane:536870912},Bt=tn(18,null,null,0),Bt.stateNode=ot,Bt.return=b,b.child=Bt,Qo=b,Ha=null,Bt=!0):Bt=!1}Bt||gu(b)}if(ot=b.memoizedState,ot!==null&&(ot=ot.dehydrated,ot!==null))return ot.data==="$!"?b.lanes=16:b.lanes=536870912,null;$u(b)}return ot=B.children,B=B.fallback,Y?(Dh(),Y=b.mode,ot=ep({mode:"hidden",children:ot},Y),B=Pt(B,Y,M,null),ot.return=b,B.return=b,ot.sibling=B,b.child=ot,Y=b.child,Y.memoizedState=Da(M),Y.childLanes=Rg(p,Ne,M),b.memoizedState=Gy,B):(Vu(b),Wy(b,ot))}if(Bt=p.memoizedState,Bt!==null&&(ot=Bt.dehydrated,ot!==null)){if(ae)b.flags&256?(Vu(b),b.flags&=-257,b=Um(p,b,M)):b.memoizedState!==null?(Dh(),b.child=p.child,b.flags|=128,b=null):(Dh(),Y=B.fallback,ot=b.mode,B=ep({mode:"visible",children:B.children},ot),Y=Pt(Y,ot,M,null),Y.flags|=2,B.return=b,Y.return=b,B.sibling=Y,b.child=B,Uu(b,p.child,null,M),B=b.child,B.memoizedState=Da(M),B.childLanes=Rg(p,Ne,M),b.memoizedState=Gy,b=Y);else if(Vu(b),ot.data==="$!"){if(Ne=ot.nextSibling&&ot.nextSibling.dataset,Ne)var ln=Ne.dgst;Ne=ln,B=Error(r(419)),B.stack="",B.digest=Ne,Ih({value:B,source:null,stack:null}),b=Um(p,b,M)}else if(il||rp(p,b,M,!1),Ne=(M&p.childLanes)!==0,il||Ne){if(Ne=jr,Ne!==null){if(B=M&-M,(B&42)!==0)B=1;else switch(B){case 2:B=1;break;case 8:B=4;break;case 32:B=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:B=64;break;case 268435456:B=134217728;break;default:B=0}if(B=(B&(Ne.suspendedLanes|M))!==0?0:B,B!==0&&B!==Bt.retryLane)throw Bt.retryLane=B,Zo(p,B),Dl(Ne,p,B),Vp}ot.data==="$?"||Ev(),b=Um(p,b,M)}else ot.data==="$?"?(b.flags|=128,b.child=p.child,b=YE.bind(null,p),ot._reactRetry=b,b=null):(p=Bt.treeContext,Ha=Ic(ot.nextSibling),Qo=b,_a=!0,Zl=null,_c=!1,p!==null&&(Jo[hl++]=yc,Jo[hl++]=qc,Jo[hl++]=Fu,yc=p.id,qc=p.overflow,Fu=b),b=Wy(b,B.children),b.flags|=4096);return b}return Y?(Dh(),Y=B.fallback,ot=b.mode,Bt=p.child,ln=Bt.sibling,B=Tn(Bt,{mode:"hidden",children:B.children}),B.subtreeFlags=Bt.subtreeFlags&31457280,ln!==null?Y=Tn(ln,Y):(Y=Pt(Y,ot,M,null),Y.flags|=2),Y.return=b,B.return=b,B.sibling=Y,b.child=B,B=Y,Y=b.child,ot=p.child.memoizedState,ot===null?ot=Da(M):(Bt=ot.cachePool,Bt!==null?(ln=Qs._currentValue,Bt=Bt.parent!==ln?{parent:ln,pool:ln}:Bt):Bt=vn(),ot={baseLanes:ot.baseLanes|M,cachePool:Bt}),Y.memoizedState=ot,Y.childLanes=Rg(p,Ne,M),b.memoizedState=Gy,B):(Vu(b),M=p.child,p=M.sibling,M=Tn(M,{mode:"visible",children:B.children}),M.return=b,M.sibling=null,p!==null&&(Ne=b.deletions,Ne===null?(b.deletions=[p],b.flags|=16):Ne.push(p)),b.child=M,b.memoizedState=null,M)}function Wy(p,b){return b=ep({mode:"visible",children:b},p.mode),b.return=p,p.child=b}function ep(p,b){return sn(p,b,0,null)}function Um(p,b,M){return Uu(b,p.child,null,M),p=Wy(b,b.pendingProps.children),p.flags|=2,b.memoizedState=null,p}function Gp(p,b,M){p.lanes|=b;var B=p.alternate;B!==null&&(B.lanes|=b),Ky(p.return,b,M)}function Wp(p,b,M,B,Y){var ae=p.memoizedState;ae===null?p.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:B,tail:M,tailMode:Y}:(ae.isBackwards=b,ae.rendering=null,ae.renderingStartTime=0,ae.last=B,ae.tail=M,ae.tailMode=Y)}function Bh(p,b,M){var B=b.pendingProps,Y=B.revealOrder,ae=B.tail;if(dl(p,b,B.children,M),B=Ds.current,(B&2)!==0)B=B&1|2,b.flags|=128;else{if(p!==null&&(p.flags&128)!==0)e:for(p=b.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&Gp(p,M,b);else if(p.tag===19)Gp(p,M,b);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===b)break e;for(;p.sibling===null;){if(p.return===null||p.return===b)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}B&=1}switch(_e(Ds,B),Y){case"forwards":for(M=b.child,Y=null;M!==null;)p=M.alternate,p!==null&&jp(p)===null&&(Y=M),M=M.sibling;M=Y,M===null?(Y=b.child,b.child=null):(Y=M.sibling,M.sibling=null),Wp(b,!1,Y,M,ae);break;case"backwards":for(M=null,Y=b.child,b.child=null;Y!==null;){if(p=Y.alternate,p!==null&&jp(p)===null){b.child=Y;break}p=Y.sibling,Y.sibling=M,M=Y,Y=p}Wp(b,!0,M,null,ae);break;case"together":Wp(b,!1,null,null,void 0);break;default:b.memoizedState=null}return b.child}function bu(p,b,M){if(p!==null&&(b.dependencies=p.dependencies),Ka|=b.lanes,(M&b.childLanes)===0)if(p!==null){if(rp(p,b,M,!1),(M&b.childLanes)===0)return null}else return null;if(p!==null&&b.child!==p.child)throw Error(r(153));if(b.child!==null){for(p=b.child,M=Tn(p,p.pendingProps),b.child=M,M.return=b;p.sibling!==null;)p=p.sibling,M=M.sibling=Tn(p,p.pendingProps),M.return=b;M.sibling=null}return b.child}function ps(p,b){return(p.lanes&b)!==0?!0:(p=p.dependencies,!!(p!==null&&wd(p)))}function Zu(p,b,M){switch(b.tag){case 3:cn(b,b.stateNode.containerInfo),Ju(b,Qs,p.memoizedState.cache),Nf();break;case 27:case 5:xr(b);break;case 4:cn(b,b.stateNode.containerInfo);break;case 10:Ju(b,b.type,b.memoizedProps.value);break;case 13:var B=b.memoizedState;if(B!==null)return B.dehydrated!==null?(Vu(b),b.flags|=128,null):(M&b.child.childLanes)!==0?Dg(p,b,M):(Vu(b),p=bu(p,b,M),p!==null?p.sibling:null);Vu(b);break;case 19:var Y=(p.flags&128)!==0;if(B=(M&b.childLanes)!==0,B||(rp(p,b,M,!1),B=(M&b.childLanes)!==0),Y){if(B)return Bh(p,b,M);b.flags|=128}if(Y=b.memoizedState,Y!==null&&(Y.rendering=null,Y.tail=null,Y.lastEffect=null),_e(Ds,Ds.current),B)break;return null;case 22:case 23:return b.lanes=0,$p(p,b,M);case 24:Ju(b,Qs,p.memoizedState.cache)}return bu(p,b,M)}function tp(p,b,M){if(p!==null)if(p.memoizedProps!==b.pendingProps)il=!0;else{if(!ps(p,M)&&(b.flags&128)===0)return il=!1,Zu(p,b,M);il=(p.flags&131072)!==0}else il=!1,_a&&(b.flags&1048576)!==0&&Np(b,Rf,b.index);switch(b.lanes=0,b.tag){case 16:e:{p=b.pendingProps;var B=b.elementType,Y=B._init;if(B=Y(B._payload),b.type=B,typeof B=="function")un(B)?(p=Ec(B,p),b.tag=1,b=Hy(null,b,B,p,M)):(b.tag=0,b=Qd(null,b,B,p,M));else{if(B!=null){if(Y=B.$$typeof,Y===H){b.tag=11,b=Uy(null,b,B,p,M);break e}else if(Y===J){b.tag=14,b=qy(null,b,B,p,M);break e}}throw b=be(B)||B,Error(r(306,b,""))}}return b;case 0:return Qd(p,b,b.type,b.pendingProps,M);case 1:return B=b.type,Y=Ec(B,b.pendingProps),Hy(p,b,B,Y,M);case 3:e:{if(cn(b,b.stateNode.containerInfo),p===null)throw Error(r(387));var ae=b.pendingProps;Y=b.memoizedState,B=Y.element,Yy(p,b),Kp(b,ae,null,M);var Ne=b.memoizedState;if(ae=Ne.cache,Ju(b,Qs,ae),ae!==Y.cache&&qm(b,[Qs],M,!0),yf(),ae=Ne.element,Y.isDehydrated)if(Y={element:ae,isDehydrated:!1,cache:Ne.cache},b.updateQueue.baseState=Y,b.memoizedState=Y,b.flags&256){b=Sv(p,b,ae,M);break e}else if(ae!==B){B=Qa(Error(r(424)),b),Ih(B),b=Sv(p,b,ae,M);break e}else for(Ha=Ic(b.stateNode.containerInfo.firstChild),Qo=b,_a=!0,Zl=null,_c=!0,M=yd(b,null,ae,M),b.child=M;M;)M.flags=M.flags&-3|4096,M=M.sibling;else{if(Nf(),ae===B){b=bu(p,b,M);break e}dl(p,b,ae,M)}b=b.child}return b;case 26:return pl(p,b),p===null?(M=hb(b.type,null,b.pendingProps,null))?b.memoizedState=M:_a||(M=b.type,p=b.pendingProps,B=Hg(Pn.current).createElement(M),B[Gt]=b,B[$t]=p,Ao(B,M,p),Gr(B),b.stateNode=B):b.memoizedState=hb(b.type,p.memoizedProps,b.pendingProps,p.memoizedState),null;case 27:return xr(b),p===null&&_a&&(B=b.stateNode=o_(b.type,b.pendingProps,Pn.current),Qo=b,_c=!0,Ha=Ic(B.firstChild)),B=b.pendingProps.children,p!==null||_a?dl(p,b,B,M):b.child=Uu(b,null,B,M),pl(p,b),b.child;case 5:return p===null&&_a&&((Y=B=Ha)&&(B=n3(B,b.type,b.pendingProps,_c),B!==null?(b.stateNode=B,Qo=b,Ha=Ic(B.firstChild),_c=!1,Y=!0):Y=!1),Y||gu(b)),xr(b),Y=b.type,ae=b.pendingProps,Ne=p!==null?p.memoizedProps:null,B=ae.children,Nv(Y,ae)?B=null:Ne!==null&&Nv(Y,Ne)&&(b.flags|=32),b.memoizedState!==null&&(Y=Ea(p,b,Ga,null,null,M),Yg._currentValue=Y),pl(p,b),dl(p,b,B,M),b.child;case 6:return p===null&&_a&&((p=M=Ha)&&(M=r3(M,b.pendingProps,_c),M!==null?(b.stateNode=M,Qo=b,Ha=null,p=!0):p=!1),p||gu(b)),null;case 13:return Dg(p,b,M);case 4:return cn(b,b.stateNode.containerInfo),B=b.pendingProps,p===null?b.child=Uu(b,null,B,M):dl(p,b,B,M),b.child;case 11:return Uy(p,b,b.type,b.pendingProps,M);case 7:return dl(p,b,b.pendingProps,M),b.child;case 8:return dl(p,b,b.pendingProps.children,M),b.child;case 12:return dl(p,b,b.pendingProps.children,M),b.child;case 10:return B=b.pendingProps,Ju(b,b.type,B.value),dl(p,b,B.children,M),b.child;case 9:return Y=b.type._context,B=b.pendingProps.children,xu(b),Y=Gs(Y),B=B(Y),b.flags|=1,dl(p,b,B,M),b.child;case 14:return qy(p,b,b.type,b.pendingProps,M);case 15:return Vy(p,b,b.type,b.pendingProps,M);case 19:return Bh(p,b,M);case 22:return $p(p,b,M);case 24:return xu(b),B=Gs(Qs),p===null?(Y=Jt(),Y===null&&(Y=jr,ae=jf(),Y.pooledCache=ae,ae.refCount++,ae!==null&&(Y.pooledCacheLanes|=M),Y=ae),b.memoizedState={parent:B,cache:Y},gf(b),Ju(b,Qs,Y)):((p.lanes&M)!==0&&(Yy(p,b),Kp(b,null,null,M),yf()),Y=p.memoizedState,ae=b.memoizedState,Y.parent!==B?(Y={parent:B,cache:B},b.memoizedState=Y,b.lanes===0&&(b.memoizedState=b.updateQueue.baseState=Y),Ju(b,Qs,B)):(B=ae.cache,Ju(b,Qs,B),B!==Y.cache&&qm(b,[Qs],M,!0))),dl(p,b,b.pendingProps.children,M),b.child;case 29:throw b.pendingProps}throw Error(r(156,b.tag))}var np=mt(null),xd=null,mf=null;function Ju(p,b,M){_e(np,b._currentValue),b._currentValue=M}function jh(p){p._currentValue=np.current,yt(np)}function Ky(p,b,M){for(;p!==null;){var B=p.alternate;if((p.childLanes&b)!==b?(p.childLanes|=b,B!==null&&(B.childLanes|=b)):B!==null&&(B.childLanes&b)!==b&&(B.childLanes|=b),p===M)break;p=p.return}}function qm(p,b,M,B){var Y=p.child;for(Y!==null&&(Y.return=p);Y!==null;){var ae=Y.dependencies;if(ae!==null){var Ne=Y.child;ae=ae.firstContext;e:for(;ae!==null;){var ot=ae;ae=Y;for(var Bt=0;Bt<b.length;Bt++)if(ot.context===b[Bt]){ae.lanes|=M,ot=ae.alternate,ot!==null&&(ot.lanes|=M),Ky(ae.return,M,p),B||(Ne=null);break e}ae=ot.next}}else if(Y.tag===18){if(Ne=Y.return,Ne===null)throw Error(r(341));Ne.lanes|=M,ae=Ne.alternate,ae!==null&&(ae.lanes|=M),Ky(Ne,M,p),Ne=null}else Ne=Y.child;if(Ne!==null)Ne.return=Y;else for(Ne=Y;Ne!==null;){if(Ne===p){Ne=null;break}if(Y=Ne.sibling,Y!==null){Y.return=Ne.return,Ne=Y;break}Ne=Ne.return}Y=Ne}}function rp(p,b,M,B){p=null;for(var Y=b,ae=!1;Y!==null;){if(!ae){if((Y.flags&524288)!==0)ae=!0;else if((Y.flags&262144)!==0)break}if(Y.tag===10){var Ne=Y.alternate;if(Ne===null)throw Error(r(387));if(Ne=Ne.memoizedProps,Ne!==null){var ot=Y.type;Rs(Y.pendingProps.value,Ne.value)||(p!==null?p.push(ot):p=[ot])}}else if(Y===Ut.current){if(Ne=Y.alternate,Ne===null)throw Error(r(387));Ne.memoizedState.memoizedState!==Y.memoizedState.memoizedState&&(p!==null?p.push(Yg):p=[Yg])}Y=Y.return}p!==null&&qm(b,p,M,B),b.flags|=262144}function wd(p){for(p=p.firstContext;p!==null;){if(!Rs(p.context._currentValue,p.memoizedValue))return!0;p=p.next}return!1}function xu(p){xd=p,mf=null,p=p.dependencies,p!==null&&(p.firstContext=null)}function Gs(p){return Vf(xd,p)}function Wc(p,b){return xd===null&&xu(p),Vf(p,b)}function Vf(p,b){var M=b._currentValue;if(b={context:b,memoizedValue:M,next:null},mf===null){if(p===null)throw Error(r(308));mf=b,p.dependencies={lanes:0,firstContext:b},p.flags|=524288}else mf=mf.next=b;return M}var Kc=!1;function gf(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Yy(p,b){p=p.updateQueue,b.updateQueue===p&&(b.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,callbacks:null})}function Sd(p){return{lane:p,tag:0,payload:null,callback:null,next:null}}function Ad(p,b,M){var B=p.updateQueue;if(B===null)return null;if(B=B.shared,(Cr&2)!==0){var Y=B.pending;return Y===null?b.next=b:(b.next=Y.next,Y.next=b),B.pending=b,b=ni(p),Xl(p,null,M),b}return Yl(p,B,b,M),ni(p)}function Td(p,b,M){if(b=b.updateQueue,b!==null&&(b=b.shared,(M&4194176)!==0)){var B=b.lanes;B&=p.pendingLanes,M|=B,b.lanes=M,ft(p,M)}}function Lg(p,b){var M=p.updateQueue,B=p.alternate;if(B!==null&&(B=B.updateQueue,M===B)){var Y=null,ae=null;if(M=M.firstBaseUpdate,M!==null){do{var Ne={lane:M.lane,tag:M.tag,payload:M.payload,callback:null,next:null};ae===null?Y=ae=Ne:ae=ae.next=Ne,M=M.next}while(M!==null);ae===null?Y=ae=b:ae=ae.next=b}else Y=ae=b;M={baseState:B.baseState,firstBaseUpdate:Y,lastBaseUpdate:ae,shared:B.shared,callbacks:B.callbacks},p.updateQueue=M;return}p=M.lastBaseUpdate,p===null?M.firstBaseUpdate=b:p.next=b,M.lastBaseUpdate=b}var ml=!1;function yf(){if(ml){var p=Ve;if(p!==null)throw p}}function Kp(p,b,M,B){ml=!1;var Y=p.updateQueue;Kc=!1;var ae=Y.firstBaseUpdate,Ne=Y.lastBaseUpdate,ot=Y.shared.pending;if(ot!==null){Y.shared.pending=null;var Bt=ot,ln=Bt.next;Bt.next=null,Ne===null?ae=ln:Ne.next=ln,Ne=Bt;var $n=p.alternate;$n!==null&&($n=$n.updateQueue,ot=$n.lastBaseUpdate,ot!==Ne&&(ot===null?$n.firstBaseUpdate=ln:ot.next=ln,$n.lastBaseUpdate=Bt))}if(ae!==null){var ir=Y.baseState;Ne=0,$n=ln=Bt=null,ot=ae;do{var Mn=ot.lane&-536870913,Hn=Mn!==ot.lane;if(Hn?(fr&Mn)===Mn:(B&Mn)===Mn){Mn!==0&&Mn===Ie&&(ml=!0),$n!==null&&($n=$n.next={lane:0,tag:ot.tag,payload:ot.payload,callback:null,next:null});e:{var Zr=p,Zi=ot;Mn=b;var $o=M;switch(Zi.tag){case 1:if(Zr=Zi.payload,typeof Zr=="function"){ir=Zr.call($o,ir,Mn);break e}ir=Zr;break e;case 3:Zr.flags=Zr.flags&-65537|128;case 0:if(Zr=Zi.payload,Mn=typeof Zr=="function"?Zr.call($o,ir,Mn):Zr,Mn==null)break e;ir=Oe({},ir,Mn);break e;case 2:Kc=!0}}Mn=ot.callback,Mn!==null&&(p.flags|=64,Hn&&(p.flags|=8192),Hn=Y.callbacks,Hn===null?Y.callbacks=[Mn]:Hn.push(Mn))}else Hn={lane:Mn,tag:ot.tag,payload:ot.payload,callback:ot.callback,next:null},$n===null?(ln=$n=Hn,Bt=ir):$n=$n.next=Hn,Ne|=Mn;if(ot=ot.next,ot===null){if(ot=Y.shared.pending,ot===null)break;Hn=ot,ot=Hn.next,Hn.next=null,Y.lastBaseUpdate=Hn,Y.shared.pending=null}}while(!0);$n===null&&(Bt=ir),Y.baseState=Bt,Y.firstBaseUpdate=ln,Y.lastBaseUpdate=$n,ae===null&&(Y.shared.lanes=0),Ka|=Ne,p.lanes=Ne,p.memoizedState=ir}}function Xy(p,b){if(typeof p!="function")throw Error(r(191,p));p.call(b)}function ip(p,b){var M=p.callbacks;if(M!==null)for(p.callbacks=null,p=0;p<M.length;p++)Xy(M[p],b)}function Ed(p,b){try{var M=b.updateQueue,B=M!==null?M.lastEffect:null;if(B!==null){var Y=B.next;M=Y;do{if((M.tag&p)===p){B=void 0;var ae=M.create,Ne=M.inst;B=ae(),Ne.destroy=B}M=M.next}while(M!==Y)}}catch(ot){Ls(b,b.return,ot)}}function Fo(p,b,M){try{var B=b.updateQueue,Y=B!==null?B.lastEffect:null;if(Y!==null){var ae=Y.next;B=ae;do{if((B.tag&p)===p){var Ne=B.inst,ot=Ne.destroy;if(ot!==void 0){Ne.destroy=void 0,Y=b;var Bt=M;try{ot()}catch(ln){Ls(Y,Bt,ln)}}}B=B.next}while(B!==ae)}}catch(ln){Ls(b,b.return,ln)}}function Yc(p){var b=p.updateQueue;if(b!==null){var M=p.stateNode;try{ip(b,M)}catch(B){Ls(p,p.return,B)}}}function ap(p,b,M){M.props=Ec(p.type,p.memoizedProps),M.state=p.memoizedState;try{M.componentWillUnmount()}catch(B){Ls(p,b,B)}}function wu(p,b){try{var M=p.ref;if(M!==null){var B=p.stateNode;switch(p.tag){case 26:case 27:case 5:var Y=B;break;default:Y=B}typeof M=="function"?p.refCleanup=M(Y):M.current=Y}}catch(ae){Ls(p,b,ae)}}function al(p,b){var M=p.ref,B=p.refCleanup;if(M!==null)if(typeof B=="function")try{B()}catch(Y){Ls(p,b,Y)}finally{p.refCleanup=null,p=p.alternate,p!=null&&(p.refCleanup=null)}else if(typeof M=="function")try{M(null)}catch(Y){Ls(p,b,Y)}else M.current=null}function kg(p){var b=p.type,M=p.memoizedProps,B=p.stateNode;try{e:switch(b){case"button":case"input":case"select":case"textarea":M.autoFocus&&B.focus();break e;case"img":M.src?B.src=M.src:M.srcSet&&(B.srcset=M.srcSet)}}catch(Y){Ls(p,p.return,Y)}}function zi(p,b,M){try{var B=p.stateNode;QE(B,p.type,M,b),B[$t]=b}catch(Y){Ls(p,p.return,Y)}}function $f(p){return p.tag===5||p.tag===3||p.tag===26||p.tag===27||p.tag===4}function Zy(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||$f(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==27&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function Jy(p,b,M){var B=p.tag;if(B===5||B===6)p=p.stateNode,b?M.nodeType===8?M.parentNode.insertBefore(p,b):M.insertBefore(p,b):(M.nodeType===8?(b=M.parentNode,b.insertBefore(p,M)):(b=M,b.appendChild(p)),M=M._reactRootContainer,M!=null||b.onclick!==null||(b.onclick=$g));else if(B!==4&&B!==27&&(p=p.child,p!==null))for(Jy(p,b,M),p=p.sibling;p!==null;)Jy(p,b,M),p=p.sibling}function sp(p,b,M){var B=p.tag;if(B===5||B===6)p=p.stateNode,b?M.insertBefore(p,b):M.appendChild(p);else if(B!==4&&B!==27&&(p=p.child,p!==null))for(sp(p,b,M),p=p.sibling;p!==null;)sp(p,b,M),p=p.sibling}var gl=!1,Ma=!1,Uo=!1,Mc=typeof WeakSet=="function"?WeakSet:Set,xa=null,Ng=!1;function Cc(p,b){if(p=p.containerInfo,Uh=rm,p=Al(p),xo(p)){if("selectionStart"in p)var M={start:p.selectionStart,end:p.selectionEnd};else e:{M=(M=p.ownerDocument)&&M.defaultView||window;var B=M.getSelection&&M.getSelection();if(B&&B.rangeCount!==0){M=B.anchorNode;var Y=B.anchorOffset,ae=B.focusNode;B=B.focusOffset;try{M.nodeType,ae.nodeType}catch{M=null;break e}var Ne=0,ot=-1,Bt=-1,ln=0,$n=0,ir=p,Mn=null;t:for(;;){for(var Hn;ir!==M||Y!==0&&ir.nodeType!==3||(ot=Ne+Y),ir!==ae||B!==0&&ir.nodeType!==3||(Bt=Ne+B),ir.nodeType===3&&(Ne+=ir.nodeValue.length),(Hn=ir.firstChild)!==null;)Mn=ir,ir=Hn;for(;;){if(ir===p)break t;if(Mn===M&&++ln===Y&&(ot=Ne),Mn===ae&&++$n===B&&(Bt=Ne),(Hn=ir.nextSibling)!==null)break;ir=Mn,Mn=ir.parentNode}ir=Hn}M=ot===-1||Bt===-1?null:{start:ot,end:Bt}}else M=null}M=M||{start:0,end:0}}else M=null;for(s_={focusedElem:p,selectionRange:M},rm=!1,xa=b;xa!==null;)if(b=xa,p=b.child,(b.subtreeFlags&1028)!==0&&p!==null)p.return=b,xa=p;else for(;xa!==null;){switch(b=xa,ae=b.alternate,p=b.flags,b.tag){case 0:break;case 11:case 15:break;case 1:if((p&1024)!==0&&ae!==null){p=void 0,M=b,Y=ae.memoizedProps,ae=ae.memoizedState,B=M.stateNode;try{var Zr=Ec(M.type,Y,M.elementType===M.type);p=B.getSnapshotBeforeUpdate(Zr,ae),B.__reactInternalSnapshotBeforeUpdate=p}catch(Zi){Ls(M,M.return,Zi)}}break;case 3:if((p&1024)!==0){if(p=b.stateNode.containerInfo,M=p.nodeType,M===9)ob(p);else if(M===1)switch(p.nodeName){case"HEAD":case"HTML":case"BODY":ob(p);break;default:p.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((p&1024)!==0)throw Error(r(163))}if(p=b.sibling,p!==null){p.return=b.return,xa=p;break}xa=b.return}return Zr=Ng,Ng=!1,Zr}function Qy(p,b,M){var B=M.flags;switch(M.tag){case 0:case 11:case 15:ee(p,M),B&4&&Ed(5,M);break;case 1:if(ee(p,M),B&4)if(p=M.stateNode,b===null)try{p.componentDidMount()}catch(ot){Ls(M,M.return,ot)}else{var Y=Ec(M.type,b.memoizedProps);b=b.memoizedState;try{p.componentDidUpdate(Y,b,p.__reactInternalSnapshotBeforeUpdate)}catch(ot){Ls(M,M.return,ot)}}B&64&&Yc(M),B&512&&wu(M,M.return);break;case 3:if(ee(p,M),B&64&&(B=M.updateQueue,B!==null)){if(p=null,M.child!==null)switch(M.child.tag){case 27:case 5:p=M.child.stateNode;break;case 1:p=M.child.stateNode}try{ip(B,p)}catch(ot){Ls(M,M.return,ot)}}break;case 26:ee(p,M),B&512&&wu(M,M.return);break;case 27:case 5:ee(p,M),b===null&&B&4&&kg(M),B&512&&wu(M,M.return);break;case 12:ee(p,M);break;case 13:ee(p,M),B&4&&_(p,M);break;case 22:if(Y=M.memoizedState!==null||gl,!Y){b=b!==null&&b.memoizedState!==null||Ma;var ae=gl,Ne=Ma;gl=Y,(Ma=b)&&!Ne?ce(p,M,(M.subtreeFlags&8772)!==0):ee(p,M),gl=ae,Ma=Ne}B&512&&(M.memoizedProps.mode==="manual"?wu(M,M.return):al(M,M.return));break;default:ee(p,M)}}function Hf(p){var b=p.alternate;b!==null&&(p.alternate=null,Hf(b)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(b=p.stateNode,b!==null&&qr(b)),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}var qo=null,y=!1;function o(p,b,M){for(M=M.child;M!==null;)u(p,b,M),M=M.sibling}function u(p,b,M){if(Vi&&typeof Vi.onCommitFiberUnmount=="function")try{Vi.onCommitFiberUnmount(yr,M)}catch{}switch(M.tag){case 26:Ma||al(M,b),o(p,b,M),M.memoizedState?M.memoizedState.count--:M.stateNode&&(M=M.stateNode,M.parentNode.removeChild(M));break;case 27:Ma||al(M,b);var B=qo,Y=y;for(qo=M.stateNode,o(p,b,M),M=M.stateNode,b=M.attributes;b.length;)M.removeAttributeNode(b[0]);qr(M),qo=B,y=Y;break;case 5:Ma||al(M,b);case 6:Y=qo;var ae=y;if(qo=null,o(p,b,M),qo=Y,y=ae,qo!==null)if(y)try{p=qo,B=M.stateNode,p.nodeType===8?p.parentNode.removeChild(B):p.removeChild(B)}catch(Ne){Ls(M,b,Ne)}else try{qo.removeChild(M.stateNode)}catch(Ne){Ls(M,b,Ne)}break;case 18:qo!==null&&(y?(b=qo,M=M.stateNode,b.nodeType===8?sb(b.parentNode,M):b.nodeType===1&&sb(b,M),m_(b)):sb(qo,M.stateNode));break;case 4:B=qo,Y=y,qo=M.stateNode.containerInfo,y=!0,o(p,b,M),qo=B,y=Y;break;case 0:case 11:case 14:case 15:Ma||Fo(2,M,b),Ma||Fo(4,M,b),o(p,b,M);break;case 1:Ma||(al(M,b),B=M.stateNode,typeof B.componentWillUnmount=="function"&&ap(M,b,B)),o(p,b,M);break;case 21:o(p,b,M);break;case 22:Ma||al(M,b),Ma=(B=Ma)||M.memoizedState!==null,o(p,b,M),Ma=B;break;default:o(p,b,M)}}function _(p,b){if(b.memoizedState===null&&(p=b.alternate,p!==null&&(p=p.memoizedState,p!==null&&(p=p.dehydrated,p!==null))))try{m_(p)}catch(M){Ls(b,b.return,M)}}function w(p){switch(p.tag){case 13:case 19:var b=p.stateNode;return b===null&&(b=p.stateNode=new Mc),b;case 22:return p=p.stateNode,b=p._retryCache,b===null&&(b=p._retryCache=new Mc),b;default:throw Error(r(435,p.tag))}}function T(p,b){var M=w(p);b.forEach(function(B){var Y=XE.bind(null,p,B);M.has(B)||(M.add(B),B.then(Y,Y))})}function C(p,b){var M=b.deletions;if(M!==null)for(var B=0;B<M.length;B++){var Y=M[B],ae=p,Ne=b,ot=Ne;e:for(;ot!==null;){switch(ot.tag){case 27:case 5:qo=ot.stateNode,y=!1;break e;case 3:qo=ot.stateNode.containerInfo,y=!0;break e;case 4:qo=ot.stateNode.containerInfo,y=!0;break e}ot=ot.return}if(qo===null)throw Error(r(160));u(ae,Ne,Y),qo=null,y=!1,ae=Y.alternate,ae!==null&&(ae.return=null),Y.return=null}if(b.subtreeFlags&13878)for(b=b.child;b!==null;)V(b,p),b=b.sibling}var z=null;function V(p,b){var M=p.alternate,B=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:C(b,p),$(p),B&4&&(Fo(3,p,p.return),Ed(3,p),Fo(5,p,p.return));break;case 1:C(b,p),$(p),B&512&&(Ma||M===null||al(M,M.return)),B&64&&gl&&(p=p.updateQueue,p!==null&&(B=p.callbacks,B!==null&&(M=p.shared.hiddenCallbacks,p.shared.hiddenCallbacks=M===null?B:M.concat(B))));break;case 26:var Y=z;if(C(b,p),$(p),B&512&&(Ma||M===null||al(M,M.return)),B&4){var ae=M!==null?M.memoizedState:null;if(B=p.memoizedState,M===null)if(B===null)if(p.stateNode===null){e:{B=p.type,M=p.memoizedProps,Y=Y.ownerDocument||Y;t:switch(B){case"title":ae=Y.getElementsByTagName("title")[0],(!ae||ae[Rr]||ae[Gt]||ae.namespaceURI==="http://www.w3.org/2000/svg"||ae.hasAttribute("itemprop"))&&(ae=Y.createElement(B),Y.head.insertBefore(ae,Y.querySelector("head > title"))),Ao(ae,B,M),ae[Gt]=p,Gr(ae),B=ae;break e;case"link":var Ne=fb("link","href",Y).get(B+(M.href||""));if(Ne){for(var ot=0;ot<Ne.length;ot++)if(ae=Ne[ot],ae.getAttribute("href")===(M.href==null?null:M.href)&&ae.getAttribute("rel")===(M.rel==null?null:M.rel)&&ae.getAttribute("title")===(M.title==null?null:M.title)&&ae.getAttribute("crossorigin")===(M.crossOrigin==null?null:M.crossOrigin)){Ne.splice(ot,1);break t}}ae=Y.createElement(B),Ao(ae,B,M),Y.head.appendChild(ae);break;case"meta":if(Ne=fb("meta","content",Y).get(B+(M.content||""))){for(ot=0;ot<Ne.length;ot++)if(ae=Ne[ot],ae.getAttribute("content")===(M.content==null?null:""+M.content)&&ae.getAttribute("name")===(M.name==null?null:M.name)&&ae.getAttribute("property")===(M.property==null?null:M.property)&&ae.getAttribute("http-equiv")===(M.httpEquiv==null?null:M.httpEquiv)&&ae.getAttribute("charset")===(M.charSet==null?null:M.charSet)){Ne.splice(ot,1);break t}}ae=Y.createElement(B),Ao(ae,B,M),Y.head.appendChild(ae);break;default:throw Error(r(468,B))}ae[Gt]=p,Gr(ae),B=ae}p.stateNode=B}else db(Y,p.type,p.stateNode);else p.stateNode=cp(Y,B,p.memoizedProps);else ae!==B?(ae===null?M.stateNode!==null&&(M=M.stateNode,M.parentNode.removeChild(M)):ae.count--,B===null?db(Y,p.type,p.stateNode):cp(Y,B,p.memoizedProps)):B===null&&p.stateNode!==null&&zi(p,p.memoizedProps,M.memoizedProps)}break;case 27:if(B&4&&p.alternate===null){Y=p.stateNode,ae=p.memoizedProps;try{for(var Bt=Y.firstChild;Bt;){var ln=Bt.nextSibling,$n=Bt.nodeName;Bt[Rr]||$n==="HEAD"||$n==="BODY"||$n==="SCRIPT"||$n==="STYLE"||$n==="LINK"&&Bt.rel.toLowerCase()==="stylesheet"||Y.removeChild(Bt),Bt=ln}for(var ir=p.type,Mn=Y.attributes;Mn.length;)Y.removeAttributeNode(Mn[0]);Ao(Y,ir,ae),Y[Gt]=p,Y[$t]=ae}catch(Zr){Ls(p,p.return,Zr)}}case 5:if(C(b,p),$(p),B&512&&(Ma||M===null||al(M,M.return)),p.flags&32){Y=p.stateNode;try{Bc(Y,"")}catch(Zr){Ls(p,p.return,Zr)}}B&4&&p.stateNode!=null&&(Y=p.memoizedProps,zi(p,Y,M!==null?M.memoizedProps:Y)),B&1024&&(Uo=!0);break;case 6:if(C(b,p),$(p),B&4){if(p.stateNode===null)throw Error(r(162));B=p.memoizedProps,M=p.stateNode;try{M.nodeValue=B}catch(Zr){Ls(p,p.return,Zr)}}break;case 3:if(nm=null,Y=z,z=Wm(b.containerInfo),C(b,p),z=Y,$(p),B&4&&M!==null&&M.memoizedState.isDehydrated)try{m_(b.containerInfo)}catch(Zr){Ls(p,p.return,Zr)}Uo&&(Uo=!1,K(p));break;case 4:B=z,z=Wm(p.stateNode.containerInfo),C(b,p),$(p),z=B;break;case 12:C(b,p),$(p);break;case 13:C(b,p),$(p),p.child.flags&8192&&p.memoizedState!==null!=(M!==null&&M.memoizedState!==null)&&(sa=Un()),B&4&&(B=p.updateQueue,B!==null&&(p.updateQueue=null,T(p,B)));break;case 22:if(B&512&&(Ma||M===null||al(M,M.return)),Bt=p.memoizedState!==null,ln=M!==null&&M.memoizedState!==null,$n=gl,ir=Ma,gl=$n||Bt,Ma=ir||ln,C(b,p),Ma=ir,gl=$n,$(p),b=p.stateNode,b._current=p,b._visibility&=-3,b._visibility|=b._pendingVisibility&2,B&8192&&(b._visibility=Bt?b._visibility&-2:b._visibility|1,Bt&&(b=gl||Ma,M===null||ln||b||te(p)),p.memoizedProps===null||p.memoizedProps.mode!=="manual"))e:for(M=null,b=p;;){if(b.tag===5||b.tag===26||b.tag===27){if(M===null){ln=M=b;try{if(Y=ln.stateNode,Bt)ae=Y.style,typeof ae.setProperty=="function"?ae.setProperty("display","none","important"):ae.display="none";else{Ne=ln.stateNode,ot=ln.memoizedProps.style;var Hn=ot!=null&&ot.hasOwnProperty("display")?ot.display:null;Ne.style.display=Hn==null||typeof Hn=="boolean"?"":(""+Hn).trim()}}catch(Zr){Ls(ln,ln.return,Zr)}}}else if(b.tag===6){if(M===null){ln=b;try{ln.stateNode.nodeValue=Bt?"":ln.memoizedProps}catch(Zr){Ls(ln,ln.return,Zr)}}}else if((b.tag!==22&&b.tag!==23||b.memoizedState===null||b===p)&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===p)break e;for(;b.sibling===null;){if(b.return===null||b.return===p)break e;M===b&&(M=null),b=b.return}M===b&&(M=null),b.sibling.return=b.return,b=b.sibling}B&4&&(B=p.updateQueue,B!==null&&(M=B.retryQueue,M!==null&&(B.retryQueue=null,T(p,M))));break;case 19:C(b,p),$(p),B&4&&(B=p.updateQueue,B!==null&&(p.updateQueue=null,T(p,B)));break;case 21:break;default:C(b,p),$(p)}}function $(p){var b=p.flags;if(b&2){try{if(p.tag!==27){e:{for(var M=p.return;M!==null;){if($f(M)){var B=M;break e}M=M.return}throw Error(r(160))}switch(B.tag){case 27:var Y=B.stateNode,ae=Zy(p);sp(p,ae,Y);break;case 5:var Ne=B.stateNode;B.flags&32&&(Bc(Ne,""),B.flags&=-33);var ot=Zy(p);sp(p,ot,Ne);break;case 3:case 4:var Bt=B.stateNode.containerInfo,ln=Zy(p);Jy(p,ln,Bt);break;default:throw Error(r(161))}}}catch($n){Ls(p,p.return,$n)}p.flags&=-3}b&4096&&(p.flags&=-4097)}function K(p){if(p.subtreeFlags&1024)for(p=p.child;p!==null;){var b=p;K(b),b.tag===5&&b.flags&1024&&b.stateNode.reset(),p=p.sibling}}function ee(p,b){if(b.subtreeFlags&8772)for(b=b.child;b!==null;)Qy(p,b.alternate,b),b=b.sibling}function te(p){for(p=p.child;p!==null;){var b=p;switch(b.tag){case 0:case 11:case 14:case 15:Fo(4,b,b.return),te(b);break;case 1:al(b,b.return);var M=b.stateNode;typeof M.componentWillUnmount=="function"&&ap(b,b.return,M),te(b);break;case 26:case 27:case 5:al(b,b.return),te(b);break;case 22:al(b,b.return),b.memoizedState===null&&te(b);break;default:te(b)}p=p.sibling}}function ce(p,b,M){for(M=M&&(b.subtreeFlags&8772)!==0,b=b.child;b!==null;){var B=b.alternate,Y=p,ae=b,Ne=ae.flags;switch(ae.tag){case 0:case 11:case 15:ce(Y,ae,M),Ed(4,ae);break;case 1:if(ce(Y,ae,M),B=ae,Y=B.stateNode,typeof Y.componentDidMount=="function")try{Y.componentDidMount()}catch(ln){Ls(B,B.return,ln)}if(B=ae,Y=B.updateQueue,Y!==null){var ot=B.stateNode;try{var Bt=Y.shared.hiddenCallbacks;if(Bt!==null)for(Y.shared.hiddenCallbacks=null,Y=0;Y<Bt.length;Y++)Xy(Bt[Y],ot)}catch(ln){Ls(B,B.return,ln)}}M&&Ne&64&&Yc(ae),wu(ae,ae.return);break;case 26:case 27:case 5:ce(Y,ae,M),M&&B===null&&Ne&4&&kg(ae),wu(ae,ae.return);break;case 12:ce(Y,ae,M);break;case 13:ce(Y,ae,M),M&&Ne&4&&_(Y,ae);break;case 22:ae.memoizedState===null&&ce(Y,ae,M),wu(ae,ae.return);break;default:ce(Y,ae,M)}b=b.sibling}}function Te(p,b){var M=null;p!==null&&p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(M=p.memoizedState.cachePool.pool),p=null,b.memoizedState!==null&&b.memoizedState.cachePool!==null&&(p=b.memoizedState.cachePool.pool),p!==M&&(p!=null&&p.refCount++,M!=null&&q(M))}function ve(p,b){p=null,b.alternate!==null&&(p=b.alternate.memoizedState.cache),b=b.memoizedState.cache,b!==p&&(b.refCount++,p!=null&&q(p))}function Ce(p,b,M,B){if(b.subtreeFlags&10256)for(b=b.child;b!==null;)Pe(p,b,M,B),b=b.sibling}function Pe(p,b,M,B){var Y=b.flags;switch(b.tag){case 0:case 11:case 15:Ce(p,b,M,B),Y&2048&&Ed(9,b);break;case 3:Ce(p,b,M,B),Y&2048&&(p=null,b.alternate!==null&&(p=b.alternate.memoizedState.cache),b=b.memoizedState.cache,b!==p&&(b.refCount++,p!=null&&q(p)));break;case 12:if(Y&2048){Ce(p,b,M,B),p=b.stateNode;try{var ae=b.memoizedProps,Ne=ae.id,ot=ae.onPostCommit;typeof ot=="function"&&ot(Ne,b.alternate===null?"mount":"update",p.passiveEffectDuration,-0)}catch(Bt){Ls(b,b.return,Bt)}}else Ce(p,b,M,B);break;case 23:break;case 22:ae=b.stateNode,b.memoizedState!==null?ae._visibility&4?Ce(p,b,M,B):Je(p,b):ae._visibility&4?Ce(p,b,M,B):(ae._visibility|=4,qe(p,b,M,B,(b.subtreeFlags&10256)!==0)),Y&2048&&Te(b.alternate,b);break;case 24:Ce(p,b,M,B),Y&2048&&ve(b.alternate,b);break;default:Ce(p,b,M,B)}}function qe(p,b,M,B,Y){for(Y=Y&&(b.subtreeFlags&10256)!==0,b=b.child;b!==null;){var ae=p,Ne=b,ot=M,Bt=B,ln=Ne.flags;switch(Ne.tag){case 0:case 11:case 15:qe(ae,Ne,ot,Bt,Y),Ed(8,Ne);break;case 23:break;case 22:var $n=Ne.stateNode;Ne.memoizedState!==null?$n._visibility&4?qe(ae,Ne,ot,Bt,Y):Je(ae,Ne):($n._visibility|=4,qe(ae,Ne,ot,Bt,Y)),Y&&ln&2048&&Te(Ne.alternate,Ne);break;case 24:qe(ae,Ne,ot,Bt,Y),Y&&ln&2048&&ve(Ne.alternate,Ne);break;default:qe(ae,Ne,ot,Bt,Y)}b=b.sibling}}function Je(p,b){if(b.subtreeFlags&10256)for(b=b.child;b!==null;){var M=p,B=b,Y=B.flags;switch(B.tag){case 22:Je(M,B),Y&2048&&Te(B.alternate,B);break;case 24:Je(M,B),Y&2048&&ve(B.alternate,B);break;default:Je(M,B)}b=b.sibling}}var Ye=8192;function lt(p){if(p.subtreeFlags&Ye)for(p=p.child;p!==null;)nt(p),p=p.sibling}function nt(p){switch(p.tag){case 26:lt(p),p.flags&Ye&&p.memoizedState!==null&&X2(z,p.memoizedState,p.memoizedProps);break;case 5:lt(p);break;case 3:case 4:var b=z;z=Wm(p.stateNode.containerInfo),lt(p),z=b;break;case 22:p.memoizedState===null&&(b=p.alternate,b!==null&&b.memoizedState!==null?(b=Ye,Ye=16777216,lt(p),Ye=b):lt(p));break;default:lt(p)}}function rt(p){var b=p.alternate;if(b!==null&&(p=b.child,p!==null)){b.child=null;do b=p.sibling,p.sibling=null,p=b;while(p!==null)}}function it(p){var b=p.deletions;if((p.flags&16)!==0){if(b!==null)for(var M=0;M<b.length;M++){var B=b[M];xa=B,Xt(B,p)}rt(p)}if(p.subtreeFlags&10256)for(p=p.child;p!==null;)dt(p),p=p.sibling}function dt(p){switch(p.tag){case 0:case 11:case 15:it(p),p.flags&2048&&Fo(9,p,p.return);break;case 3:it(p);break;case 12:it(p);break;case 22:var b=p.stateNode;p.memoizedState!==null&&b._visibility&4&&(p.return===null||p.return.tag!==13)?(b._visibility&=-5,xt(p)):it(p);break;default:it(p)}}function xt(p){var b=p.deletions;if((p.flags&16)!==0){if(b!==null)for(var M=0;M<b.length;M++){var B=b[M];xa=B,Xt(B,p)}rt(p)}for(p=p.child;p!==null;){switch(b=p,b.tag){case 0:case 11:case 15:Fo(8,b,b.return),xt(b);break;case 22:M=b.stateNode,M._visibility&4&&(M._visibility&=-5,xt(b));break;default:xt(b)}p=p.sibling}}function Xt(p,b){for(;xa!==null;){var M=xa;switch(M.tag){case 0:case 11:case 15:Fo(8,M,b);break;case 23:case 22:if(M.memoizedState!==null&&M.memoizedState.cachePool!==null){var B=M.memoizedState.cachePool.pool;B!=null&&B.refCount++}break;case 24:q(M.memoizedState.cache)}if(B=M.child,B!==null)B.return=M,xa=B;else e:for(M=p;xa!==null;){B=xa;var Y=B.sibling,ae=B.return;if(Hf(B),B===M){xa=null;break e}if(Y!==null){Y.return=ae,xa=Y;break e}xa=ae}}}function zt(p,b,M,B){this.tag=p,this.key=M,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=b,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=B,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function tn(p,b,M,B){return new zt(p,b,M,B)}function un(p){return p=p.prototype,!(!p||!p.isReactComponent)}function Tn(p,b){var M=p.alternate;return M===null?(M=tn(p.tag,b,p.key,p.mode),M.elementType=p.elementType,M.type=p.type,M.stateNode=p.stateNode,M.alternate=p,p.alternate=M):(M.pendingProps=b,M.type=p.type,M.flags=0,M.subtreeFlags=0,M.deletions=null),M.flags=p.flags&31457280,M.childLanes=p.childLanes,M.lanes=p.lanes,M.child=p.child,M.memoizedProps=p.memoizedProps,M.memoizedState=p.memoizedState,M.updateQueue=p.updateQueue,b=p.dependencies,M.dependencies=b===null?null:{lanes:b.lanes,firstContext:b.firstContext},M.sibling=p.sibling,M.index=p.index,M.ref=p.ref,M.refCleanup=p.refCleanup,M}function Lt(p,b){p.flags&=31457282;var M=p.alternate;return M===null?(p.childLanes=0,p.lanes=b,p.child=null,p.subtreeFlags=0,p.memoizedProps=null,p.memoizedState=null,p.updateQueue=null,p.dependencies=null,p.stateNode=null):(p.childLanes=M.childLanes,p.lanes=M.lanes,p.child=M.child,p.subtreeFlags=0,p.deletions=null,p.memoizedProps=M.memoizedProps,p.memoizedState=M.memoizedState,p.updateQueue=M.updateQueue,p.type=M.type,b=M.dependencies,p.dependencies=b===null?null:{lanes:b.lanes,firstContext:b.firstContext}),p}function an(p,b,M,B,Y,ae){var Ne=0;if(B=p,typeof p=="function")un(p)&&(Ne=1);else if(typeof p=="string")Ne=Y2(p,M,on.current)?26:p==="html"||p==="head"||p==="body"?27:5;else e:switch(p){case x:return Pt(M.children,Y,ae,b);case S:Ne=8,Y|=24;break;case I:return p=tn(12,M,b,Y|2),p.elementType=I,p.lanes=ae,p;case G:return p=tn(13,M,b,Y),p.elementType=G,p.lanes=ae,p;case W:return p=tn(19,M,b,Y),p.elementType=W,p.lanes=ae,p;case he:return sn(M,Y,ae,b);default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case R:case j:Ne=10;break e;case F:Ne=9;break e;case H:Ne=11;break e;case J:Ne=14;break e;case ie:Ne=16,B=null;break e}Ne=29,M=Error(r(130,p===null?"null":typeof p,"")),B=null}return b=tn(Ne,M,b,Y),b.elementType=p,b.type=B,b.lanes=ae,b}function Pt(p,b,M,B){return p=tn(7,p,B,b),p.lanes=M,p}function sn(p,b,M,B){p=tn(22,p,B,b),p.elementType=he,p.lanes=M;var Y={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var ae=Y._current;if(ae===null)throw Error(r(456));if((Y._pendingVisibility&2)===0){var Ne=Zo(ae,2);Ne!==null&&(Y._pendingVisibility|=2,Dl(Ne,ae,2))}},attach:function(){var ae=Y._current;if(ae===null)throw Error(r(456));if((Y._pendingVisibility&2)!==0){var Ne=Zo(ae,2);Ne!==null&&(Y._pendingVisibility&=-3,Dl(Ne,ae,2))}}};return p.stateNode=Y,p}function Qt(p,b,M){return p=tn(6,p,null,b),p.lanes=M,p}function fn(p,b,M){return b=tn(4,p.children!==null?p.children:[],p.key,b),b.lanes=M,b.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},b}function Wt(p){p.flags|=4}function mn(p,b){if(b.type!=="stylesheet"||(b.state.loading&4)!==0)p.flags&=-16777217;else if(p.flags|=16777216,!pb(b)){if(b=Ml.current,b!==null&&((fr&4194176)===fr?$c!==null:(fr&62914560)!==fr&&(fr&536870912)===0||b!==$c))throw vc=af,Lm;p.flags|=8192}}function zn(p,b){b!==null&&(p.flags|=4),p.flags&16384&&(b=p.tag!==22?Zt():536870912,p.lanes|=b,po|=b)}function Bn(p,b){if(!_a)switch(p.tailMode){case"hidden":b=p.tail;for(var M=null;b!==null;)b.alternate!==null&&(M=b),b=b.sibling;M===null?p.tail=null:M.sibling=null;break;case"collapsed":M=p.tail;for(var B=null;M!==null;)M.alternate!==null&&(B=M),M=M.sibling;B===null?b||p.tail===null?p.tail=null:p.tail.sibling=null:B.sibling=null}}function In(p){var b=p.alternate!==null&&p.alternate.child===p.child,M=0,B=0;if(b)for(var Y=p.child;Y!==null;)M|=Y.lanes|Y.childLanes,B|=Y.subtreeFlags&31457280,B|=Y.flags&31457280,Y.return=p,Y=Y.sibling;else for(Y=p.child;Y!==null;)M|=Y.lanes|Y.childLanes,B|=Y.subtreeFlags,B|=Y.flags,Y.return=p,Y=Y.sibling;return p.subtreeFlags|=B,p.childLanes=M,b}function or(p,b,M){var B=b.pendingProps;switch(Lf(b),b.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return In(b),null;case 1:return In(b),null;case 3:return M=b.stateNode,B=null,p!==null&&(B=p.memoizedState.cache),b.memoizedState.cache!==B&&(b.flags|=2048),jh(Qs),At(),M.pendingContext&&(M.context=M.pendingContext,M.pendingContext=null),(p===null||p.child===null)&&(kf(b)?Wt(b):p===null||p.memoizedState.isDehydrated&&(b.flags&256)===0||(b.flags|=1024,Zl!==null&&(Yp(Zl),Zl=null))),In(b),null;case 26:return M=b.memoizedState,p===null?(Wt(b),M!==null?(In(b),mn(b,M)):(In(b),b.flags&=-16777217)):M?M!==p.memoizedState?(Wt(b),In(b),mn(b,M)):(In(b),b.flags&=-16777217):(p.memoizedProps!==B&&Wt(b),In(b),b.flags&=-16777217),null;case 27:Rn(b),M=Pn.current;var Y=b.type;if(p!==null&&b.stateNode!=null)p.memoizedProps!==B&&Wt(b);else{if(!B){if(b.stateNode===null)throw Error(r(166));return In(b),null}p=on.current,kf(b)?md(b):(p=o_(Y,B,M),b.stateNode=p,Wt(b))}return In(b),null;case 5:if(Rn(b),M=b.type,p!==null&&b.stateNode!=null)p.memoizedProps!==B&&Wt(b);else{if(!B){if(b.stateNode===null)throw Error(r(166));return In(b),null}if(p=on.current,kf(b))md(b);else{switch(Y=Hg(Pn.current),p){case 1:p=Y.createElementNS("http://www.w3.org/2000/svg",M);break;case 2:p=Y.createElementNS("http://www.w3.org/1998/Math/MathML",M);break;default:switch(M){case"svg":p=Y.createElementNS("http://www.w3.org/2000/svg",M);break;case"math":p=Y.createElementNS("http://www.w3.org/1998/Math/MathML",M);break;case"script":p=Y.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild);break;case"select":p=typeof B.is=="string"?Y.createElement("select",{is:B.is}):Y.createElement("select"),B.multiple?p.multiple=!0:B.size&&(p.size=B.size);break;default:p=typeof B.is=="string"?Y.createElement(M,{is:B.is}):Y.createElement(M)}}p[Gt]=b,p[$t]=B;e:for(Y=b.child;Y!==null;){if(Y.tag===5||Y.tag===6)p.appendChild(Y.stateNode);else if(Y.tag!==4&&Y.tag!==27&&Y.child!==null){Y.child.return=Y,Y=Y.child;continue}if(Y===b)break e;for(;Y.sibling===null;){if(Y.return===null||Y.return===b)break e;Y=Y.return}Y.sibling.return=Y.return,Y=Y.sibling}b.stateNode=p;e:switch(Ao(p,M,B),M){case"button":case"input":case"select":case"textarea":p=!!B.autoFocus;break e;case"img":p=!0;break e;default:p=!1}p&&Wt(b)}}return In(b),b.flags&=-16777217,null;case 6:if(p&&b.stateNode!=null)p.memoizedProps!==B&&Wt(b);else{if(typeof B!="string"&&b.stateNode===null)throw Error(r(166));if(p=Pn.current,kf(b)){if(p=b.stateNode,M=b.memoizedProps,B=null,Y=Qo,Y!==null)switch(Y.tag){case 27:case 5:B=Y.memoizedProps}p[Gt]=b,p=!!(p.nodeValue===M||B!==null&&B.suppressHydrationWarning===!0||Id(p.nodeValue,M)),p||gu(b)}else p=Hg(p).createTextNode(B),p[Gt]=b,b.stateNode=p}return In(b),null;case 13:if(B=b.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(Y=kf(b),B!==null&&B.dehydrated!==null){if(p===null){if(!Y)throw Error(r(318));if(Y=b.memoizedState,Y=Y!==null?Y.dehydrated:null,!Y)throw Error(r(317));Y[Gt]=b}else Nf(),(b.flags&128)===0&&(b.memoizedState=null),b.flags|=4;In(b),Y=!1}else Zl!==null&&(Yp(Zl),Zl=null),Y=!0;if(!Y)return b.flags&256?($u(b),b):($u(b),null)}if($u(b),(b.flags&128)!==0)return b.lanes=M,b;if(M=B!==null,p=p!==null&&p.memoizedState!==null,M){B=b.child,Y=null,B.alternate!==null&&B.alternate.memoizedState!==null&&B.alternate.memoizedState.cachePool!==null&&(Y=B.alternate.memoizedState.cachePool.pool);var ae=null;B.memoizedState!==null&&B.memoizedState.cachePool!==null&&(ae=B.memoizedState.cachePool.pool),ae!==Y&&(B.flags|=2048)}return M!==p&&M&&(b.child.flags|=8192),zn(b,b.updateQueue),In(b),null;case 4:return At(),p===null&&Dv(b.stateNode.containerInfo),In(b),null;case 10:return jh(b.type),In(b),null;case 19:if(yt(Ds),Y=b.memoizedState,Y===null)return In(b),null;if(B=(b.flags&128)!==0,ae=Y.rendering,ae===null)if(B)Bn(Y,!1);else{if(Oi!==0||p!==null&&(p.flags&128)!==0)for(p=b.child;p!==null;){if(ae=jp(p),ae!==null){for(b.flags|=128,Bn(Y,!1),p=ae.updateQueue,b.updateQueue=p,zn(b,p),b.subtreeFlags=0,p=M,M=b.child;M!==null;)Lt(M,p),M=M.sibling;return _e(Ds,Ds.current&1|2),b.child}p=p.sibling}Y.tail!==null&&Un()>mo&&(b.flags|=128,B=!0,Bn(Y,!1),b.lanes=4194304)}else{if(!B)if(p=jp(ae),p!==null){if(b.flags|=128,B=!0,p=p.updateQueue,b.updateQueue=p,zn(b,p),Bn(Y,!0),Y.tail===null&&Y.tailMode==="hidden"&&!ae.alternate&&!_a)return In(b),null}else 2*Un()-Y.renderingStartTime>mo&&M!==536870912&&(b.flags|=128,B=!0,Bn(Y,!1),b.lanes=4194304);Y.isBackwards?(ae.sibling=b.child,b.child=ae):(p=Y.last,p!==null?p.sibling=ae:b.child=ae,Y.last=ae)}return Y.tail!==null?(b=Y.tail,Y.rendering=b,Y.tail=b.sibling,Y.renderingStartTime=Un(),b.sibling=null,p=Ds.current,_e(Ds,B?p&1|2:p&1),b):(In(b),null);case 22:case 23:return $u(b),qu(),B=b.memoizedState!==null,p!==null?p.memoizedState!==null!==B&&(b.flags|=8192):B&&(b.flags|=8192),B?(M&536870912)!==0&&(b.flags&128)===0&&(In(b),b.subtreeFlags&6&&(b.flags|=8192)):In(b),M=b.updateQueue,M!==null&&zn(b,M.retryQueue),M=null,p!==null&&p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(M=p.memoizedState.cachePool.pool),B=null,b.memoizedState!==null&&b.memoizedState.cachePool!==null&&(B=b.memoizedState.cachePool.pool),B!==M&&(b.flags|=2048),p!==null&&yt(St),null;case 24:return M=null,p!==null&&(M=p.memoizedState.cache),b.memoizedState.cache!==M&&(b.flags|=2048),jh(Qs),In(b),null;case 25:return null}throw Error(r(156,b.tag))}function Br(p,b){switch(Lf(b),b.tag){case 1:return p=b.flags,p&65536?(b.flags=p&-65537|128,b):null;case 3:return jh(Qs),At(),p=b.flags,(p&65536)!==0&&(p&128)===0?(b.flags=p&-65537|128,b):null;case 26:case 27:case 5:return Rn(b),null;case 13:if($u(b),p=b.memoizedState,p!==null&&p.dehydrated!==null){if(b.alternate===null)throw Error(r(340));Nf()}return p=b.flags,p&65536?(b.flags=p&-65537|128,b):null;case 19:return yt(Ds),null;case 4:return At(),null;case 10:return jh(b.type),null;case 22:case 23:return $u(b),qu(),p!==null&&yt(St),p=b.flags,p&65536?(b.flags=p&-65537|128,b):null;case 24:return jh(Qs),null;case 25:return null;default:return null}}function mr(p,b){switch(Lf(b),b.tag){case 3:jh(Qs),At();break;case 26:case 27:case 5:Rn(b);break;case 4:At();break;case 13:$u(b);break;case 19:yt(Ds);break;case 10:jh(b.type);break;case 22:case 23:$u(b),qu(),p!==null&&yt(St);break;case 24:jh(Qs)}}var Dr={getCacheForType:function(p){var b=Gs(Qs),M=b.data.get(p);return M===void 0&&(M=p(),b.data.set(p,M)),M}},Er=typeof WeakMap=="function"?WeakMap:Map,Cr=0,jr=null,Nr=null,fr=0,ai=0,Ar=null,tr=!1,si=!1,Hi=!1,ci=0,Oi=0,Ka=0,us=0,to=0,Ws=0,po=0,Ti=null,ra=null,Di=!1,sa=0,mo=1/0,wa=null,as=null,Su=!1,Vo=null,ec=0,Rl=0,Xc=null,yl=0,Fh=null;function go(){if((Cr&2)!==0&&fr!==0)return fr&-fr;if(Ae.T!==null){var p=Ie;return p!==0?p:n_()}return Ft()}function _f(){Ws===0&&(Ws=(fr&536870912)===0||_a?zs():536870912);var p=Ml.current;return p!==null&&(p.flags|=32),Ws}function Dl(p,b,M){(p===jr&&ai===2||p.cancelPendingCommit!==null)&&(Vm(p,0),lp(p,fr,Ws,!1)),Re(p,M),((Cr&2)===0||p!==jr)&&(p===jr&&((Cr&2)===0&&(us|=M),Oi===4&&lp(p,fr,Ws,!1)),Gf(p))}function op(p,b,M){if((Cr&6)!==0)throw Error(r(327));var B=!M&&(b&60)===0&&(b&p.expiredLanes)===0||la(p,b),Y=B?Xp(p,b):Mv(p,b,!0),ae=B;do{if(Y===0){si&&!B&&lp(p,b,0,!1);break}else if(Y===6)lp(p,b,0,!tr);else{if(M=p.current.alternate,ae&&!I2(M)){Y=Mv(p,b,!1),ae=!1;continue}if(Y===2){if(ae=b,p.errorRecoveryDisabledLanes&ae)var Ne=0;else Ne=p.pendingLanes&-536870913,Ne=Ne!==0?Ne:Ne&536870912?536870912:0;if(Ne!==0){b=Ne;e:{var ot=p;Y=Ti;var Bt=ot.current.memoizedState.isDehydrated;if(Bt&&(Vm(ot,Ne).flags|=256),Ne=Mv(ot,Ne,!1),Ne!==2){if(Hi&&!Bt){ot.errorRecoveryDisabledLanes|=ae,us|=ae,Y=4;break e}ae=ra,ra=Y,ae!==null&&Yp(ae)}Y=Ne}if(ae=!1,Y!==2)continue}}if(Y===1){Vm(p,0),lp(p,b,0,!0);break}e:{switch(B=p,Y){case 0:case 1:throw Error(r(345));case 4:if((b&4194176)===b){lp(B,b,Ws,!tr);break e}break;case 2:ra=null;break;case 3:case 5:break;default:throw Error(r(329))}if(B.finishedWork=M,B.finishedLanes=b,(b&62914560)===b&&(ae=sa+300-Un(),10<ae)){if(lp(B,b,Ws,!tr),fi(B,0)!==0)break e;B.timeoutHandle=Wf(zg.bind(null,B,M,ra,wa,Di,b,Ws,us,po,tr,2,-0,0),ae);break e}zg(B,M,ra,wa,Di,b,Ws,us,po,tr,0,-0,0)}}break}while(!0);Gf(p)}function Yp(p){ra===null?ra=p:ra.push.apply(ra,p)}function zg(p,b,M,B,Y,ae,Ne,ot,Bt,ln,$n,ir,Mn){var Hn=b.subtreeFlags;if((Hn&8192||(Hn&16785408)===16785408)&&(c_={stylesheets:null,count:0,unsuspend:s3},nt(b),b=Fv(),b!==null)){p.cancelPendingCommit=b(O2.bind(null,p,M,B,Y,Ne,ot,Bt,1,ir,Mn)),lp(p,ae,Ne,!ln);return}O2(p,M,B,Y,Ne,ot,Bt,$n,ir,Mn)}function I2(p){for(var b=p;;){var M=b.tag;if((M===0||M===11||M===15)&&b.flags&16384&&(M=b.updateQueue,M!==null&&(M=M.stores,M!==null)))for(var B=0;B<M.length;B++){var Y=M[B],ae=Y.getSnapshot;Y=Y.value;try{if(!Rs(ae(),Y))return!1}catch{return!1}}if(M=b.child,b.subtreeFlags&16384&&M!==null)M.return=b,b=M;else{if(b===p)break;for(;b.sibling===null;){if(b.return===null||b.return===p)return!0;b=b.return}b.sibling.return=b.return,b=b.sibling}}return!0}function lp(p,b,M,B){b&=~to,b&=~us,p.suspendedLanes|=b,p.pingedLanes&=~b,B&&(p.warmLanes|=b),B=p.expirationTimes;for(var Y=b;0<Y;){var ae=31-ti(Y),Ne=1<<ae;B[ae]=-1,Y&=~Ne}M!==0&&gt(p,M,b)}function Av(){return(Cr&6)===0?(Jp(0),!1):!0}function Tv(){if(Nr!==null){if(ai===0)var p=Nr.return;else p=Nr,mf=xd=null,cs(p),zf=null,fl=0,p=Nr;for(;p!==null;)mr(p.alternate,p),p=p.return;Nr=null}}function Vm(p,b){p.finishedWork=null,p.finishedLanes=0;var M=p.timeoutHandle;M!==-1&&(p.timeoutHandle=-1,F2(M)),M=p.cancelPendingCommit,M!==null&&(p.cancelPendingCommit=null,M()),Tv(),jr=p,Nr=M=Tn(p.current,null),fr=b,ai=0,Ar=null,tr=!1,si=la(p,b),Hi=!1,po=Ws=to=us=Ka=Oi=0,ra=Ti=null,Di=!1,(b&8)!==0&&(b|=b&32);var B=p.entangledLanes;if(B!==0)for(p=p.entanglements,B&=b;0<B;){var Y=31-ti(B),ae=1<<Y;b|=p[Y],B&=~ae}return ci=b,rs(),M}function G1(p,b){wn=null,Ae.H=Tc,b===gd?(b=Ig(),ai=3):b===Lm?(b=Ig(),ai=4):ai=b===Vp?8:b!==null&&typeof b=="object"&&typeof b.then=="function"?6:1,Ar=b,Nr===null&&(Oi=1,zh(p,Qa(b,p.current)))}function W1(){var p=Ae.H;return Ae.H=Tc,p===null?Tc:p}function K1(){var p=Ae.A;return Ae.A=Dr,p}function Ev(){Oi=4,tr||(fr&4194176)!==fr&&Ml.current!==null||(si=!0),(Ka&134217727)===0&&(us&134217727)===0||jr===null||lp(jr,fr,Ws,!1)}function Mv(p,b,M){var B=Cr;Cr|=2;var Y=W1(),ae=K1();(jr!==p||fr!==b)&&(wa=null,Vm(p,b)),b=!1;var Ne=Oi;e:do try{if(ai!==0&&Nr!==null){var ot=Nr,Bt=Ar;switch(ai){case 8:Tv(),Ne=6;break e;case 3:case 2:case 6:Ml.current===null&&(b=!0);var ln=ai;if(ai=0,Ar=null,jg(p,ot,Bt,ln),M&&si){Ne=0;break e}break;default:ln=ai,ai=0,Ar=null,jg(p,ot,Bt,ln)}}Y1(),Ne=Oi;break}catch($n){G1(p,$n)}while(!0);return b&&p.shellSuspendCounter++,mf=xd=null,Cr=B,Ae.H=Y,Ae.A=ae,Nr===null&&(jr=null,fr=0,rs()),Ne}function Y1(){for(;Nr!==null;)X1(Nr)}function Xp(p,b){var M=Cr;Cr|=2;var B=W1(),Y=K1();jr!==p||fr!==b?(wa=null,mo=Un()+500,Vm(p,b)):si=la(p,b);e:do try{if(ai!==0&&Nr!==null){b=Nr;var ae=Ar;t:switch(ai){case 1:ai=0,Ar=null,jg(p,b,ae,1);break;case 2:if(Cg(ae)){ai=0,Ar=null,Bg(b);break}b=function(){ai===2&&jr===p&&(ai=7),Gf(p)},ae.then(b,b);break e;case 3:ai=7;break e;case 4:ai=5;break e;case 7:Cg(ae)?(ai=0,Ar=null,Bg(b)):(ai=0,Ar=null,jg(p,b,ae,7));break;case 5:var Ne=null;switch(Nr.tag){case 26:Ne=Nr.memoizedState;case 5:case 27:var ot=Nr;if(!Ne||pb(Ne)){ai=0,Ar=null;var Bt=ot.sibling;if(Bt!==null)Nr=Bt;else{var ln=ot.return;ln!==null?(Nr=ln,Cv(ln)):Nr=null}break t}}ai=0,Ar=null,jg(p,b,ae,5);break;case 6:ai=0,Ar=null,jg(p,b,ae,6);break;case 8:Tv(),Oi=6;break e;default:throw Error(r(462))}}_l();break}catch($n){G1(p,$n)}while(!0);return mf=xd=null,Ae.H=B,Ae.A=Y,Cr=M,Nr!==null?0:(jr=null,fr=0,rs(),Oi)}function _l(){for(;Nr!==null&&!ur();)X1(Nr)}function X1(p){var b=tp(p.alternate,p,ci);p.memoizedProps=p.pendingProps,b===null?Cv(p):Nr=b}function Bg(p){var b=p,M=b.alternate;switch(b.tag){case 15:case 0:b=$y(M,b,b.pendingProps,b.type,void 0,fr);break;case 11:b=$y(M,b,b.pendingProps,b.type.render,b.ref,fr);break;case 5:cs(b);default:mr(M,b),b=Nr=Lt(b,ci),b=tp(M,b,ci)}p.memoizedProps=p.pendingProps,b===null?Cv(p):Nr=b}function jg(p,b,M,B){mf=xd=null,cs(b),zf=null,fl=0;var Y=b.return;try{if(Fy(p,Y,b,M,fr)){Oi=1,zh(p,Qa(M,p.current)),Nr=null;return}}catch(ae){if(Y!==null)throw Nr=Y,ae;Oi=1,zh(p,Qa(M,p.current)),Nr=null;return}b.flags&32768?(_a||B===1?p=!0:si||(fr&536870912)!==0?p=!1:(tr=p=!0,(B===2||B===3||B===6)&&(B=Ml.current,B!==null&&B.tag===13&&(B.flags|=16384))),P2(b,p)):Cv(b)}function Cv(p){var b=p;do{if((b.flags&32768)!==0){P2(b,tr);return}p=b.return;var M=or(b.alternate,b,ci);if(M!==null){Nr=M;return}if(b=b.sibling,b!==null){Nr=b;return}Nr=b=p}while(b!==null);Oi===0&&(Oi=5)}function P2(p,b){do{var M=Br(p.alternate,p);if(M!==null){M.flags&=32767,Nr=M;return}if(M=p.return,M!==null&&(M.flags|=32768,M.subtreeFlags=0,M.deletions=null),!b&&(p=p.sibling,p!==null)){Nr=p;return}Nr=p=M}while(p!==null);Oi=6,Nr=null}function O2(p,b,M,B,Y,ae,Ne,ot,Bt,ln){var $n=Ae.T,ir=Xe.p;try{Xe.p=2,Ae.T=null,e_(p,b,M,B,ir,Y,ae,Ne,ot,Bt,ln)}finally{Ae.T=$n,Xe.p=ir}}function e_(p,b,M,B,Y,ae,Ne,ot){do vf();while(Vo!==null);if((Cr&6)!==0)throw Error(r(327));var Bt=p.finishedWork;if(B=p.finishedLanes,Bt===null)return null;if(p.finishedWork=null,p.finishedLanes=0,Bt===p.current)throw Error(r(177));p.callbackNode=null,p.callbackPriority=0,p.cancelPendingCommit=null;var ln=Bt.lanes|Bt.childLanes;if(ln|=$a,tt(p,B,ln,ae,Ne,ot),p===jr&&(Nr=jr=null,fr=0),(Bt.subtreeFlags&10256)===0&&(Bt.flags&10256)===0||Su||(Su=!0,Rl=ln,Xc=M,ZE(wi,function(){return vf(),null})),M=(Bt.flags&15990)!==0,(Bt.subtreeFlags&15990)!==0||M?(M=Ae.T,Ae.T=null,ae=Xe.p,Xe.p=2,Ne=Cr,Cr|=4,Cc(p,Bt),V(Bt,p),Ah(s_,p.containerInfo),rm=!!Uh,s_=Uh=null,p.current=Bt,Qy(p,Bt.alternate,Bt),Ir(),Cr=Ne,Xe.p=ae,Ae.T=M):p.current=Bt,Su?(Su=!1,Vo=p,ec=B):Z1(p,ln),ln=p.pendingLanes,ln===0&&(as=null),ki(Bt.stateNode),Gf(p),b!==null)for(Y=p.onRecoverableError,Bt=0;Bt<b.length;Bt++)ln=b[Bt],Y(ln.value,{componentStack:ln.stack});return(ec&3)!==0&&vf(),ln=p.pendingLanes,(B&4194218)!==0&&(ln&42)!==0?p===Fh?yl++:(yl=0,Fh=p):yl=0,Jp(0),null}function Z1(p,b){(p.pooledCacheLanes&=b)===0&&(b=p.pooledCache,b!=null&&(p.pooledCache=null,q(b)))}function vf(){if(Vo!==null){var p=Vo,b=Rl;Rl=0;var M=Tt(ec),B=Ae.T,Y=Xe.p;try{if(Xe.p=32>M?32:M,Ae.T=null,Vo===null)var ae=!1;else{M=Xc,Xc=null;var Ne=Vo,ot=ec;if(Vo=null,ec=0,(Cr&6)!==0)throw Error(r(331));var Bt=Cr;if(Cr|=4,dt(Ne.current),Pe(Ne,Ne.current,ot,M),Cr=Bt,Jp(0,!1),Vi&&typeof Vi.onPostCommitFiberRoot=="function")try{Vi.onPostCommitFiberRoot(yr,Ne)}catch{}ae=!0}return ae}finally{Xe.p=Y,Ae.T=B,Z1(p,b)}}return!1}function Fg(p,b,M){b=Qa(M,b),b=qp(p.stateNode,b,2),p=Ad(p,b,2),p!==null&&(Re(p,2),Gf(p))}function Ls(p,b,M){if(p.tag===3)Fg(p,p,M);else for(;b!==null;){if(b.tag===3){Fg(b,p,M);break}else if(b.tag===1){var B=b.stateNode;if(typeof b.type.getDerivedStateFromError=="function"||typeof B.componentDidCatch=="function"&&(as===null||!as.has(B))){p=Qa(M,p),M=Fm(2),B=Ad(b,M,2),B!==null&&(Og(M,B,b,p),Re(B,2),Gf(B));break}}b=b.return}}function J1(p,b,M){var B=p.pingCache;if(B===null){B=p.pingCache=new Er;var Y=new Set;B.set(b,Y)}else Y=B.get(b),Y===void 0&&(Y=new Set,B.set(b,Y));Y.has(M)||(Hi=!0,Y.add(M),p=KE.bind(null,p,b,M),b.then(p,p))}function KE(p,b,M){var B=p.pingCache;B!==null&&B.delete(b),p.pingedLanes|=p.suspendedLanes&M,p.warmLanes&=~M,jr===p&&(fr&M)===M&&(Oi===4||Oi===3&&(fr&62914560)===fr&&300>Un()-sa?(Cr&2)===0&&Vm(p,0):to|=M,po===fr&&(po=0)),Gf(p)}function R2(p,b){b===0&&(b=Zt()),p=Zo(p,b),p!==null&&(Re(p,b),Gf(p))}function YE(p){var b=p.memoizedState,M=0;b!==null&&(M=b.retryLane),R2(p,M)}function XE(p,b){var M=0;switch(p.tag){case 13:var B=p.stateNode,Y=p.memoizedState;Y!==null&&(M=Y.retryLane);break;case 19:B=p.stateNode;break;case 22:B=p.stateNode._retryCache;break;default:throw Error(r(314))}B!==null&&B.delete(b),R2(p,M)}function ZE(p,b){return ar(p,b)}var Ug=null,qg=null,Zp=!1,Iv=!1,no=!1,Md=0;function Gf(p){p!==qg&&p.next===null&&(qg===null?Ug=qg=p:qg=qg.next=p),Iv=!0,Zp||(Zp=!0,t_(Pv))}function Jp(p,b){if(!no&&Iv){no=!0;do for(var M=!1,B=Ug;B!==null;){if(p!==0){var Y=B.pendingLanes;if(Y===0)var ae=0;else{var Ne=B.suspendedLanes,ot=B.pingedLanes;ae=(1<<31-ti(42|p)+1)-1,ae&=Y&~(Ne&~ot),ae=ae&201326677?ae&201326677|1:ae?ae|2:0}ae!==0&&(M=!0,eb(B,ae))}else ae=fr,ae=fi(B,B===jr?ae:0),(ae&3)===0||la(B,ae)||(M=!0,eb(B,ae));B=B.next}while(M);no=!1}}function Pv(){Iv=Zp=!1;var p=0;Md!==0&&(ab()&&(p=Md),Md=0);for(var b=Un(),M=null,B=Ug;B!==null;){var Y=B.next,ae=Vg(B,b);ae===0?(B.next=null,M===null?Ug=Y:M.next=Y,Y===null&&(qg=M)):(M=B,(p!==0||(ae&3)!==0)&&(Iv=!0)),B=Y}Jp(p)}function Vg(p,b){for(var M=p.suspendedLanes,B=p.pingedLanes,Y=p.expirationTimes,ae=p.pendingLanes&-62914561;0<ae;){var Ne=31-ti(ae),ot=1<<Ne,Bt=Y[Ne];Bt===-1?((ot&M)===0||(ot&B)!==0)&&(Y[Ne]=Iu(ot,b)):Bt<=b&&(p.expiredLanes|=ot),ae&=~ot}if(b=jr,M=fr,M=fi(p,p===b?M:0),B=p.callbackNode,M===0||p===b&&ai===2||p.cancelPendingCommit!==null)return B!==null&&B!==null&&hr(B),p.callbackNode=null,p.callbackPriority=0;if((M&3)===0||la(p,M)){if(b=M&-M,b===p.callbackPriority)return b;switch(B!==null&&hr(B),Tt(M)){case 2:case 8:M=Li;break;case 32:M=wi;break;case 268435456:M=Xn;break;default:M=wi}return B=Q1.bind(null,p),M=ar(M,B),p.callbackPriority=b,p.callbackNode=M,b}return B!==null&&B!==null&&hr(B),p.callbackPriority=2,p.callbackNode=null,2}function Q1(p,b){var M=p.callbackNode;if(vf()&&p.callbackNode!==M)return null;var B=fr;return B=fi(p,p===jr?B:0),B===0?null:(op(p,B,b),Vg(p,Un()),p.callbackNode!=null&&p.callbackNode===M?Q1.bind(null,p):null)}function eb(p,b){if(vf())return null;op(p,b,!0)}function t_(p){e3(function(){(Cr&6)!==0?ar(pi,p):p()})}function n_(){return Md===0&&(Md=zs()),Md}function r_(p){return p==null||typeof p=="symbol"||typeof p=="boolean"?null:typeof p=="function"?p:Ei(""+p)}function D2(p,b){var M=b.ownerDocument.createElement("input");return M.name=b.name,M.value=b.value,p.id&&M.setAttribute("form",p.id),b.parentNode.insertBefore(M,b),p=new FormData(p),M.parentNode.removeChild(M),p}function L2(p,b,M,B,Y){if(b==="submit"&&M&&M.stateNode===Y){var ae=r_((Y[$t]||null).action),Ne=B.submitter;Ne&&(b=(b=Ne[$t]||null)?r_(b.formAction):Ne.getAttribute("formAction"),b!==null&&(ae=b,Ne=null));var ot=new Ta("action","action",null,B,Y);p.push({event:ot,listeners:[{instance:null,listener:function(){if(B.defaultPrevented){if(Md!==0){var Bt=Ne?D2(Y,Ne):new FormData(Y);Ku(M,{pending:!0,data:Bt,method:Y.method,action:ae},null,Bt)}}else typeof ae=="function"&&(ot.preventDefault(),Bt=Ne?D2(Y,Ne):new FormData(Y),Ku(M,{pending:!0,data:Bt,method:Y.method,action:ae},ae,Bt))},currentTarget:Y}]})}}for(var i_=0;i_<jo.length;i_++){var a_=jo[i_],tb=a_.toLowerCase(),k2=a_[0].toUpperCase()+a_.slice(1);ls(tb,"on"+k2)}ls(ku,"onAnimationEnd"),ls(fu,"onAnimationIteration"),ls(mc,"onAnimationStart"),ls("dblclick","onDoubleClick"),ls("focusin","onFocus"),ls("focusout","onBlur"),ls(Nu,"onTransitionRun"),ls(gc,"onTransitionStart"),ls(zu,"onTransitionCancel"),ls(du,"onTransitionEnd"),_s("onMouseEnter",["mouseout","mouseover"]),_s("onMouseLeave",["mouseout","mouseover"]),_s("onPointerEnter",["pointerout","pointerover"]),_s("onPointerLeave",["pointerout","pointerover"]),Ua("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ua("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ua("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ua("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ua("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ua("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var $m="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),N2=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat($m));function Ov(p,b){b=(b&4)!==0;for(var M=0;M<p.length;M++){var B=p[M],Y=B.event;B=B.listeners;e:{var ae=void 0;if(b)for(var Ne=B.length-1;0<=Ne;Ne--){var ot=B[Ne],Bt=ot.instance,ln=ot.currentTarget;if(ot=ot.listener,Bt!==ae&&Y.isPropagationStopped())break e;ae=ot,Y.currentTarget=ln;try{ae(Y)}catch($n){df($n)}Y.currentTarget=null,ae=Bt}else for(Ne=0;Ne<B.length;Ne++){if(ot=B[Ne],Bt=ot.instance,ln=ot.currentTarget,ot=ot.listener,Bt!==ae&&Y.isPropagationStopped())break e;ae=ot,Y.currentTarget=ln;try{ae(Y)}catch($n){df($n)}Y.currentTarget=null,ae=Bt}}}}function La(p,b){var M=b[Nn];M===void 0&&(M=b[Nn]=new Set);var B=p+"__bubble";M.has(B)||(nb(b,p,2,!1),M.add(B))}function Rv(p,b,M){var B=0;b&&(B|=4),nb(M,p,B,b)}var Hm="_reactListening"+Math.random().toString(36).slice(2);function Dv(p){if(!p[Hm]){p[Hm]=!0,Ni.forEach(function(M){M!=="selectionchange"&&(N2.has(M)||Rv(M,!1,p),Rv(M,!0,p))});var b=p.nodeType===9?p:p.ownerDocument;b===null||b[Hm]||(b[Hm]=!0,Rv("selectionchange",!1,b))}}function nb(p,b,M,B){switch(tS(b)){case 2:var Y=Q2;break;case 8:Y=eS;break;default:Y=bb}M=Y.bind(null,b,M,p),Y=void 0,!su||b!=="touchstart"&&b!=="touchmove"&&b!=="wheel"||(Y=!0),B?Y!==void 0?p.addEventListener(b,M,{capture:!0,passive:Y}):p.addEventListener(b,M,!0):Y!==void 0?p.addEventListener(b,M,{passive:Y}):p.addEventListener(b,M,!1)}function Lv(p,b,M,B,Y){var ae=B;if((b&1)===0&&(b&2)===0&&B!==null)e:for(;;){if(B===null)return;var Ne=B.tag;if(Ne===3||Ne===4){var ot=B.stateNode.containerInfo;if(ot===Y||ot.nodeType===8&&ot.parentNode===Y)break;if(Ne===4)for(Ne=B.return;Ne!==null;){var Bt=Ne.tag;if((Bt===3||Bt===4)&&(Bt=Ne.stateNode.containerInfo,Bt===Y||Bt.nodeType===8&&Bt.parentNode===Y))return;Ne=Ne.return}for(;ot!==null;){if(Ne=Ri(ot),Ne===null)return;if(Bt=Ne.tag,Bt===5||Bt===6||Bt===26||Bt===27){B=ae=Ne;continue e}ot=ot.parentNode}}B=B.return}js(function(){var ln=ae,$n=dr(M),ir=[];e:{var Mn=Uc.get(p);if(Mn!==void 0){var Hn=Ta,Zr=p;switch(p){case"keypress":if(li(M)===0)break e;case"keydown":case"keyup":Hn=xh;break;case"focusin":Zr="focus",Hn=Xo;break;case"focusout":Zr="blur",Hn=Xo;break;case"beforeblur":case"afterblur":Hn=Xo;break;case"click":if(M.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Hn=os;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Hn=ws;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Hn=fd;break;case ku:case fu:case mc:Hn=Us;break;case du:Hn=Ge;break;case"scroll":case"scrollend":Hn=vh;break;case"wheel":Hn=Yt;break;case"copy":case"cut":case"paste":Hn=ns;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Hn=hd;break;case"toggle":case"beforetoggle":Hn=kn}var Zi=(b&4)!==0,$o=!Zi&&(p==="scroll"||p==="scrollend"),yn=Zi?Mn!==null?Mn+"Capture":null:Mn;Zi=[];for(var rn=ln,An;rn!==null;){var Qn=rn;if(An=Qn.stateNode,Qn=Qn.tag,Qn!==5&&Qn!==26&&Qn!==27||An===null||yn===null||(Qn=au(rn,yn),Qn!=null&&Zi.push(bf(rn,Qn,An))),$o)break;rn=rn.return}0<Zi.length&&(Mn=new Hn(Mn,Zr,null,M,$n),ir.push({event:Mn,listeners:Zi}))}}if((b&7)===0){e:{if(Mn=p==="mouseover"||p==="pointerover",Hn=p==="mouseout"||p==="pointerout",Mn&&M!==oo&&(Zr=M.relatedTarget||M.fromElement)&&(Ri(Zr)||Zr[Sn]))break e;if((Hn||Mn)&&(Mn=$n.window===$n?$n:(Mn=$n.ownerDocument)?Mn.defaultView||Mn.parentWindow:window,Hn?(Zr=M.relatedTarget||M.toElement,Hn=ln,Zr=Zr?Ri(Zr):null,Zr!==null&&($o=Fe(Zr),Zi=Zr.tag,Zr!==$o||Zi!==5&&Zi!==27&&Zi!==6)&&(Zr=null)):(Hn=null,Zr=ln),Hn!==Zr)){if(Zi=os,Qn="onMouseLeave",yn="onMouseEnter",rn="mouse",(p==="pointerout"||p==="pointerover")&&(Zi=hd,Qn="onPointerLeave",yn="onPointerEnter",rn="pointer"),$o=Hn==null?Mn:Hr(Hn),An=Zr==null?Mn:Hr(Zr),Mn=new Zi(Qn,rn+"leave",Hn,M,$n),Mn.target=$o,Mn.relatedTarget=An,Qn=null,Ri($n)===ln&&(Zi=new Zi(yn,rn+"enter",Zr,M,$n),Zi.target=An,Zi.relatedTarget=$o,Qn=Zi),$o=Qn,Hn&&Zr)t:{for(Zi=Hn,yn=Zr,rn=0,An=Zi;An;An=Gm(An))rn++;for(An=0,Qn=yn;Qn;Qn=Gm(Qn))An++;for(;0<rn-An;)Zi=Gm(Zi),rn--;for(;0<An-rn;)yn=Gm(yn),An--;for(;rn--;){if(Zi===yn||yn!==null&&Zi===yn.alternate)break t;Zi=Gm(Zi),yn=Gm(yn)}Zi=null}else Zi=null;Hn!==null&&z2(ir,Mn,Hn,Zi,!1),Zr!==null&&$o!==null&&z2(ir,$o,Zr,Zi,!0)}}e:{if(Mn=ln?Hr(ln):window,Hn=Mn.nodeName&&Mn.nodeName.toLowerCase(),Hn==="select"||Hn==="input"&&Mn.type==="file")var Kr=cu;else if(Sr(Mn))if(wh)Kr=Of;else{Kr=co;var ma=Vs}else Hn=Mn.nodeName,!Hn||Hn.toLowerCase()!=="input"||Mn.type!=="checkbox"&&Mn.type!=="radio"?ln&&jc(ln.elementType)&&(Kr=cu):Kr=dd;if(Kr&&(Kr=Kr(p,ln))){dc(ir,Kr,M,$n);break e}ma&&ma(p,Mn,ln),p==="focusout"&&ln&&Mn.type==="number"&&ln.memoizedProps.value!=null&&cc(Mn,"number",Mn.value)}switch(ma=ln?Hr(ln):window,p){case"focusin":(Sr(ma)||ma.contentEditable==="true")&&(Tl=ma,hu=ln,pc=null);break;case"focusout":pc=hu=Tl=null;break;case"mousedown":Va=!0;break;case"contextmenu":case"mouseup":case"dragend":Va=!1,pd(ir,M,$n);break;case"selectionchange":if(Lu)break;case"keydown":case"keyup":pd(ir,M,$n)}var oi;if(wr)e:{switch(p){case"compositionstart":var Ci="onCompositionStart";break e;case"compositionend":Ci="onCompositionEnd";break e;case"compositionupdate":Ci="onCompositionUpdate";break e}Ci=void 0}else Ja?As(p,M)&&(Ci="onCompositionEnd"):p==="keydown"&&M.keyCode===229&&(Ci="onCompositionStart");Ci&&(Pi&&M.locale!=="ko"&&(Ja||Ci!=="onCompositionStart"?Ci==="onCompositionEnd"&&Ja&&(oi=_h()):(ri=$n,_i="value"in ri?ri.value:ri.textContent,Ja=!0)),ma=Cd(ln,Ci),0<ma.length&&(Ci=new Bo(Ci,p,null,M,$n),ir.push({event:Ci,listeners:ma}),oi?Ci.data=oi:(oi=Xs(M),oi!==null&&(Ci.data=oi)))),(oi=Ai?Mr(p,M):sr(p,M))&&(Ci=Cd(ln,"onBeforeInput"),0<Ci.length&&(ma=new Bo("onBeforeInput","beforeinput",null,M,$n),ir.push({event:ma,listeners:Ci}),ma.data=oi)),L2(ir,p,ln,M,$n)}Ov(ir,b)})}function bf(p,b,M){return{instance:p,listener:b,currentTarget:M}}function Cd(p,b){for(var M=b+"Capture",B=[];p!==null;){var Y=p,ae=Y.stateNode;Y=Y.tag,Y!==5&&Y!==26&&Y!==27||ae===null||(Y=au(p,M),Y!=null&&B.unshift(bf(p,Y,ae)),Y=au(p,b),Y!=null&&B.push(bf(p,Y,ae))),p=p.return}return B}function Gm(p){if(p===null)return null;do p=p.return;while(p&&p.tag!==5&&p.tag!==27);return p||null}function z2(p,b,M,B,Y){for(var ae=b._reactName,Ne=[];M!==null&&M!==B;){var ot=M,Bt=ot.alternate,ln=ot.stateNode;if(ot=ot.tag,Bt!==null&&Bt===B)break;ot!==5&&ot!==26&&ot!==27||ln===null||(Bt=ln,Y?(ln=au(M,ae),ln!=null&&Ne.unshift(bf(M,ln,Bt))):Y||(ln=au(M,ae),ln!=null&&Ne.push(bf(M,ln,Bt)))),M=M.return}Ne.length!==0&&p.push({event:b,listeners:Ne})}var B2=/\r\n?/g,JE=/\u0000|\uFFFD/g;function j2(p){return(typeof p=="string"?p:""+p).replace(B2,`
`).replace(JE,"")}function Id(p,b){return b=j2(b),j2(p)===b}function $g(){}function Cs(p,b,M,B,Y,ae){switch(M){case"children":typeof B=="string"?b==="body"||b==="textarea"&&B===""||Bc(p,B):(typeof B=="number"||typeof B=="bigint")&&b!=="body"&&Bc(p,""+B);break;case"className":Oa(p,"class",B);break;case"tabIndex":Oa(p,"tabindex",B);break;case"dir":case"role":case"viewBox":case"width":case"height":Oa(p,M,B);break;case"style":No(p,B,ae);break;case"data":if(b!=="object"){Oa(p,"data",B);break}case"src":case"href":if(B===""&&(b!=="a"||M!=="href")){p.removeAttribute(M);break}if(B==null||typeof B=="function"||typeof B=="symbol"||typeof B=="boolean"){p.removeAttribute(M);break}B=Ei(""+B),p.setAttribute(M,B);break;case"action":case"formAction":if(typeof B=="function"){p.setAttribute(M,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof ae=="function"&&(M==="formAction"?(b!=="input"&&Cs(p,b,"name",Y.name,Y,null),Cs(p,b,"formEncType",Y.formEncType,Y,null),Cs(p,b,"formMethod",Y.formMethod,Y,null),Cs(p,b,"formTarget",Y.formTarget,Y,null)):(Cs(p,b,"encType",Y.encType,Y,null),Cs(p,b,"method",Y.method,Y,null),Cs(p,b,"target",Y.target,Y,null)));if(B==null||typeof B=="symbol"||typeof B=="boolean"){p.removeAttribute(M);break}B=Ei(""+B),p.setAttribute(M,B);break;case"onClick":B!=null&&(p.onclick=$g);break;case"onScroll":B!=null&&La("scroll",p);break;case"onScrollEnd":B!=null&&La("scrollend",p);break;case"dangerouslySetInnerHTML":if(B!=null){if(typeof B!="object"||!("__html"in B))throw Error(r(61));if(M=B.__html,M!=null){if(Y.children!=null)throw Error(r(60));p.innerHTML=M}}break;case"multiple":p.multiple=B&&typeof B!="function"&&typeof B!="symbol";break;case"muted":p.muted=B&&typeof B!="function"&&typeof B!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(B==null||typeof B=="function"||typeof B=="boolean"||typeof B=="symbol"){p.removeAttribute("xlink:href");break}M=Ei(""+B),p.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",M);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":B!=null&&typeof B!="function"&&typeof B!="symbol"?p.setAttribute(M,""+B):p.removeAttribute(M);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":B&&typeof B!="function"&&typeof B!="symbol"?p.setAttribute(M,""):p.removeAttribute(M);break;case"capture":case"download":B===!0?p.setAttribute(M,""):B!==!1&&B!=null&&typeof B!="function"&&typeof B!="symbol"?p.setAttribute(M,B):p.removeAttribute(M);break;case"cols":case"rows":case"size":case"span":B!=null&&typeof B!="function"&&typeof B!="symbol"&&!isNaN(B)&&1<=B?p.setAttribute(M,B):p.removeAttribute(M);break;case"rowSpan":case"start":B==null||typeof B=="function"||typeof B=="symbol"||isNaN(B)?p.removeAttribute(M):p.setAttribute(M,B);break;case"popover":La("beforetoggle",p),La("toggle",p),Wo(p,"popover",B);break;case"xlinkActuate":Fl(p,"http://www.w3.org/1999/xlink","xlink:actuate",B);break;case"xlinkArcrole":Fl(p,"http://www.w3.org/1999/xlink","xlink:arcrole",B);break;case"xlinkRole":Fl(p,"http://www.w3.org/1999/xlink","xlink:role",B);break;case"xlinkShow":Fl(p,"http://www.w3.org/1999/xlink","xlink:show",B);break;case"xlinkTitle":Fl(p,"http://www.w3.org/1999/xlink","xlink:title",B);break;case"xlinkType":Fl(p,"http://www.w3.org/1999/xlink","xlink:type",B);break;case"xmlBase":Fl(p,"http://www.w3.org/XML/1998/namespace","xml:base",B);break;case"xmlLang":Fl(p,"http://www.w3.org/XML/1998/namespace","xml:lang",B);break;case"xmlSpace":Fl(p,"http://www.w3.org/XML/1998/namespace","xml:space",B);break;case"is":Wo(p,"is",B);break;case"innerText":case"textContent":break;default:(!(2<M.length)||M[0]!=="o"&&M[0]!=="O"||M[1]!=="n"&&M[1]!=="N")&&(M=Qh.get(M)||M,Wo(p,M,B))}}function kv(p,b,M,B,Y,ae){switch(M){case"style":No(p,B,ae);break;case"dangerouslySetInnerHTML":if(B!=null){if(typeof B!="object"||!("__html"in B))throw Error(r(61));if(M=B.__html,M!=null){if(Y.children!=null)throw Error(r(60));p.innerHTML=M}}break;case"children":typeof B=="string"?Bc(p,B):(typeof B=="number"||typeof B=="bigint")&&Bc(p,""+B);break;case"onScroll":B!=null&&La("scroll",p);break;case"onScrollEnd":B!=null&&La("scrollend",p);break;case"onClick":B!=null&&(p.onclick=$g);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Pa.hasOwnProperty(M))e:{if(M[0]==="o"&&M[1]==="n"&&(Y=M.endsWith("Capture"),b=M.slice(2,Y?M.length-7:void 0),ae=p[$t]||null,ae=ae!=null?ae[M]:null,typeof ae=="function"&&p.removeEventListener(b,ae,Y),typeof B=="function")){typeof ae!="function"&&ae!==null&&(M in p?p[M]=null:p.hasAttribute(M)&&p.removeAttribute(M)),p.addEventListener(b,B,Y);break e}M in p?p[M]=B:B===!0?p.setAttribute(M,""):Wo(p,M,B)}}}function Ao(p,b,M){switch(b){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":La("error",p),La("load",p);var B=!1,Y=!1,ae;for(ae in M)if(M.hasOwnProperty(ae)){var Ne=M[ae];if(Ne!=null)switch(ae){case"src":B=!0;break;case"srcSet":Y=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,b));default:Cs(p,b,ae,Ne,M,null)}}Y&&Cs(p,b,"srcSet",M.srcSet,M,null),B&&Cs(p,b,"src",M.src,M,null);return;case"input":La("invalid",p);var ot=ae=Ne=Y=null,Bt=null,ln=null;for(B in M)if(M.hasOwnProperty(B)){var $n=M[B];if($n!=null)switch(B){case"name":Y=$n;break;case"type":Ne=$n;break;case"checked":Bt=$n;break;case"defaultChecked":ln=$n;break;case"value":ae=$n;break;case"defaultValue":ot=$n;break;case"children":case"dangerouslySetInnerHTML":if($n!=null)throw Error(r(137,b));break;default:Cs(p,b,B,$n,M,null)}}Ul(p,ae,ot,Bt,ln,Ne,Y,!1),Jh(p);return;case"select":La("invalid",p),B=Ne=ae=null;for(Y in M)if(M.hasOwnProperty(Y)&&(ot=M[Y],ot!=null))switch(Y){case"value":ae=ot;break;case"defaultValue":Ne=ot;break;case"multiple":B=ot;default:Cs(p,b,Y,ot,M,null)}b=ae,M=Ne,p.multiple=!!B,b!=null?so(p,!!B,b,!1):M!=null&&so(p,!!B,M,!0);return;case"textarea":La("invalid",p),ae=Y=B=null;for(Ne in M)if(M.hasOwnProperty(Ne)&&(ot=M[Ne],ot!=null))switch(Ne){case"value":B=ot;break;case"defaultValue":Y=ot;break;case"children":ae=ot;break;case"dangerouslySetInnerHTML":if(ot!=null)throw Error(r(91));break;default:Cs(p,b,Ne,ot,M,null)}yh(p,B,Y,ae),Jh(p);return;case"option":for(Bt in M)if(M.hasOwnProperty(Bt)&&(B=M[Bt],B!=null))switch(Bt){case"selected":p.selected=B&&typeof B!="function"&&typeof B!="symbol";break;default:Cs(p,b,Bt,B,M,null)}return;case"dialog":La("cancel",p),La("close",p);break;case"iframe":case"object":La("load",p);break;case"video":case"audio":for(B=0;B<$m.length;B++)La($m[B],p);break;case"image":La("error",p),La("load",p);break;case"details":La("toggle",p);break;case"embed":case"source":case"link":La("error",p),La("load",p);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ln in M)if(M.hasOwnProperty(ln)&&(B=M[ln],B!=null))switch(ln){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,b));default:Cs(p,b,ln,B,M,null)}return;default:if(jc(b)){for($n in M)M.hasOwnProperty($n)&&(B=M[$n],B!==void 0&&kv(p,b,$n,B,M,void 0));return}}for(ot in M)M.hasOwnProperty(ot)&&(B=M[ot],B!=null&&Cs(p,b,ot,B,M,null))}function QE(p,b,M,B){switch(b){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var Y=null,ae=null,Ne=null,ot=null,Bt=null,ln=null,$n=null;for(Hn in M){var ir=M[Hn];if(M.hasOwnProperty(Hn)&&ir!=null)switch(Hn){case"checked":break;case"value":break;case"defaultValue":Bt=ir;default:B.hasOwnProperty(Hn)||Cs(p,b,Hn,null,B,ir)}}for(var Mn in B){var Hn=B[Mn];if(ir=M[Mn],B.hasOwnProperty(Mn)&&(Hn!=null||ir!=null))switch(Mn){case"type":ae=Hn;break;case"name":Y=Hn;break;case"checked":ln=Hn;break;case"defaultChecked":$n=Hn;break;case"value":Ne=Hn;break;case"defaultValue":ot=Hn;break;case"children":case"dangerouslySetInnerHTML":if(Hn!=null)throw Error(r(137,b));break;default:Hn!==ir&&Cs(p,b,Mn,Hn,B,ir)}}Lo(p,Ne,ot,Bt,ln,$n,ae,Y);return;case"select":Hn=Ne=ot=Mn=null;for(ae in M)if(Bt=M[ae],M.hasOwnProperty(ae)&&Bt!=null)switch(ae){case"value":break;case"multiple":Hn=Bt;default:B.hasOwnProperty(ae)||Cs(p,b,ae,null,B,Bt)}for(Y in B)if(ae=B[Y],Bt=M[Y],B.hasOwnProperty(Y)&&(ae!=null||Bt!=null))switch(Y){case"value":Mn=ae;break;case"defaultValue":ot=ae;break;case"multiple":Ne=ae;default:ae!==Bt&&Cs(p,b,Y,ae,B,Bt)}b=ot,M=Ne,B=Hn,Mn!=null?so(p,!!M,Mn,!1):!!B!=!!M&&(b!=null?so(p,!!M,b,!0):so(p,!!M,M?[]:"",!1));return;case"textarea":Hn=Mn=null;for(ot in M)if(Y=M[ot],M.hasOwnProperty(ot)&&Y!=null&&!B.hasOwnProperty(ot))switch(ot){case"value":break;case"children":break;default:Cs(p,b,ot,null,B,Y)}for(Ne in B)if(Y=B[Ne],ae=M[Ne],B.hasOwnProperty(Ne)&&(Y!=null||ae!=null))switch(Ne){case"value":Mn=Y;break;case"defaultValue":Hn=Y;break;case"children":break;case"dangerouslySetInnerHTML":if(Y!=null)throw Error(r(91));break;default:Y!==ae&&Cs(p,b,Ne,Y,B,ae)}ko(p,Mn,Hn);return;case"option":for(var Zr in M)if(Mn=M[Zr],M.hasOwnProperty(Zr)&&Mn!=null&&!B.hasOwnProperty(Zr))switch(Zr){case"selected":p.selected=!1;break;default:Cs(p,b,Zr,null,B,Mn)}for(Bt in B)if(Mn=B[Bt],Hn=M[Bt],B.hasOwnProperty(Bt)&&Mn!==Hn&&(Mn!=null||Hn!=null))switch(Bt){case"selected":p.selected=Mn&&typeof Mn!="function"&&typeof Mn!="symbol";break;default:Cs(p,b,Bt,Mn,B,Hn)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Zi in M)Mn=M[Zi],M.hasOwnProperty(Zi)&&Mn!=null&&!B.hasOwnProperty(Zi)&&Cs(p,b,Zi,null,B,Mn);for(ln in B)if(Mn=B[ln],Hn=M[ln],B.hasOwnProperty(ln)&&Mn!==Hn&&(Mn!=null||Hn!=null))switch(ln){case"children":case"dangerouslySetInnerHTML":if(Mn!=null)throw Error(r(137,b));break;default:Cs(p,b,ln,Mn,B,Hn)}return;default:if(jc(b)){for(var $o in M)Mn=M[$o],M.hasOwnProperty($o)&&Mn!==void 0&&!B.hasOwnProperty($o)&&kv(p,b,$o,void 0,B,Mn);for($n in B)Mn=B[$n],Hn=M[$n],!B.hasOwnProperty($n)||Mn===Hn||Mn===void 0&&Hn===void 0||kv(p,b,$n,Mn,B,Hn);return}}for(var yn in M)Mn=M[yn],M.hasOwnProperty(yn)&&Mn!=null&&!B.hasOwnProperty(yn)&&Cs(p,b,yn,null,B,Mn);for(ir in B)Mn=B[ir],Hn=M[ir],!B.hasOwnProperty(ir)||Mn===Hn||Mn==null&&Hn==null||Cs(p,b,ir,Mn,B,Hn)}var Uh=null,s_=null;function Hg(p){return p.nodeType===9?p:p.ownerDocument}function rb(p){switch(p){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function ib(p,b){if(p===0)switch(b){case"svg":return 1;case"math":return 2;default:return 0}return p===1&&b==="foreignObject"?0:p}function Nv(p,b){return p==="textarea"||p==="noscript"||typeof b.children=="string"||typeof b.children=="number"||typeof b.children=="bigint"||typeof b.dangerouslySetInnerHTML=="object"&&b.dangerouslySetInnerHTML!==null&&b.dangerouslySetInnerHTML.__html!=null}var zv=null;function ab(){var p=window.event;return p&&p.type==="popstate"?p===zv?!1:(zv=p,!0):(zv=null,!1)}var Wf=typeof setTimeout=="function"?setTimeout:void 0,F2=typeof clearTimeout=="function"?clearTimeout:void 0,U2=typeof Promise=="function"?Promise:void 0,e3=typeof queueMicrotask=="function"?queueMicrotask:typeof U2<"u"?function(p){return U2.resolve(null).then(p).catch(t3)}:Wf;function t3(p){setTimeout(function(){throw p})}function sb(p,b){var M=b,B=0;do{var Y=M.nextSibling;if(p.removeChild(M),Y&&Y.nodeType===8)if(M=Y.data,M==="/$"){if(B===0){p.removeChild(Y),m_(b);return}B--}else M!=="$"&&M!=="$?"&&M!=="$!"||B++;M=Y}while(M);m_(b)}function ob(p){var b=p.firstChild;for(b&&b.nodeType===10&&(b=b.nextSibling);b;){var M=b;switch(b=b.nextSibling,M.nodeName){case"HTML":case"HEAD":case"BODY":ob(M),qr(M);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(M.rel.toLowerCase()==="stylesheet")continue}p.removeChild(M)}}function n3(p,b,M,B){for(;p.nodeType===1;){var Y=M;if(p.nodeName.toLowerCase()!==b.toLowerCase()){if(!B&&(p.nodeName!=="INPUT"||p.type!=="hidden"))break}else if(B){if(!p[Rr])switch(b){case"meta":if(!p.hasAttribute("itemprop"))break;return p;case"link":if(ae=p.getAttribute("rel"),ae==="stylesheet"&&p.hasAttribute("data-precedence"))break;if(ae!==Y.rel||p.getAttribute("href")!==(Y.href==null?null:Y.href)||p.getAttribute("crossorigin")!==(Y.crossOrigin==null?null:Y.crossOrigin)||p.getAttribute("title")!==(Y.title==null?null:Y.title))break;return p;case"style":if(p.hasAttribute("data-precedence"))break;return p;case"script":if(ae=p.getAttribute("src"),(ae!==(Y.src==null?null:Y.src)||p.getAttribute("type")!==(Y.type==null?null:Y.type)||p.getAttribute("crossorigin")!==(Y.crossOrigin==null?null:Y.crossOrigin))&&ae&&p.hasAttribute("async")&&!p.hasAttribute("itemprop"))break;return p;default:return p}}else if(b==="input"&&p.type==="hidden"){var ae=Y.name==null?null:""+Y.name;if(Y.type==="hidden"&&p.getAttribute("name")===ae)return p}else return p;if(p=Ic(p.nextSibling),p===null)break}return null}function r3(p,b,M){if(b==="")return null;for(;p.nodeType!==3;)if((p.nodeType!==1||p.nodeName!=="INPUT"||p.type!=="hidden")&&!M||(p=Ic(p.nextSibling),p===null))return null;return p}function Ic(p){for(;p!=null;p=p.nextSibling){var b=p.nodeType;if(b===1||b===3)break;if(b===8){if(b=p.data,b==="$"||b==="$!"||b==="$?"||b==="F!"||b==="F")break;if(b==="/$")return null}}return p}function lb(p){p=p.previousSibling;for(var b=0;p;){if(p.nodeType===8){var M=p.data;if(M==="$"||M==="$!"||M==="$?"){if(b===0)return p;b--}else M==="/$"&&b++}p=p.previousSibling}return null}function o_(p,b,M){switch(b=Hg(M),p){case"html":if(p=b.documentElement,!p)throw Error(r(452));return p;case"head":if(p=b.head,!p)throw Error(r(453));return p;case"body":if(p=b.body,!p)throw Error(r(454));return p;default:throw Error(r(451))}}var qh=new Map,cb=new Set;function Wm(p){return typeof p.getRootNode=="function"?p.getRootNode():p.ownerDocument}var Pd=Xe.d;Xe.d={f:Bv,r:q2,D:V2,C:i3,L:$2,m:H2,X:W2,S:G2,M:ub};function Bv(){var p=Pd.f(),b=Av();return p||b}function q2(p){var b=Xi(p);b!==null&&b.tag===5&&b.type==="form"?Uf(b):Pd.r(p)}var Qp=typeof document>"u"?null:document;function jv(p,b,M){var B=Qp;if(B&&typeof b=="string"&&b){var Y=Ys(b);Y='link[rel="'+p+'"][href="'+Y+'"]',typeof M=="string"&&(Y+='[crossorigin="'+M+'"]'),cb.has(Y)||(cb.add(Y),p={rel:p,crossOrigin:M,href:b},B.querySelector(Y)===null&&(b=B.createElement("link"),Ao(b,"link",p),Gr(b),B.head.appendChild(b)))}}function V2(p){Pd.D(p),jv("dns-prefetch",p,null)}function i3(p,b){Pd.C(p,b),jv("preconnect",p,b)}function $2(p,b,M){Pd.L(p,b,M);var B=Qp;if(B&&p&&b){var Y='link[rel="preload"][as="'+Ys(b)+'"]';b==="image"&&M&&M.imageSrcSet?(Y+='[imagesrcset="'+Ys(M.imageSrcSet)+'"]',typeof M.imageSizes=="string"&&(Y+='[imagesizes="'+Ys(M.imageSizes)+'"]')):Y+='[href="'+Ys(p)+'"]';var ae=Y;switch(b){case"style":ae=em(p);break;case"script":ae=Gg(p)}qh.has(ae)||(p=Oe({rel:"preload",href:b==="image"&&M&&M.imageSrcSet?void 0:p,as:b},M),qh.set(ae,p),B.querySelector(Y)!==null||b==="style"&&B.querySelector(l_(ae))||b==="script"&&B.querySelector(Wg(ae))||(b=B.createElement("link"),Ao(b,"link",p),Gr(b),B.head.appendChild(b)))}}function H2(p,b){Pd.m(p,b);var M=Qp;if(M&&p){var B=b&&typeof b.as=="string"?b.as:"script",Y='link[rel="modulepreload"][as="'+Ys(B)+'"][href="'+Ys(p)+'"]',ae=Y;switch(B){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":ae=Gg(p)}if(!qh.has(ae)&&(p=Oe({rel:"modulepreload",href:p},b),qh.set(ae,p),M.querySelector(Y)===null)){switch(B){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(M.querySelector(Wg(ae)))return}B=M.createElement("link"),Ao(B,"link",p),Gr(B),M.head.appendChild(B)}}}function G2(p,b,M){Pd.S(p,b,M);var B=Qp;if(B&&p){var Y=gi(B).hoistableStyles,ae=em(p);b=b||"default";var Ne=Y.get(ae);if(!Ne){var ot={loading:0,preload:null};if(Ne=B.querySelector(l_(ae)))ot.loading=5;else{p=Oe({rel:"stylesheet",href:p,"data-precedence":b},M),(M=qh.get(ae))&&Km(p,M);var Bt=Ne=B.createElement("link");Gr(Bt),Ao(Bt,"link",p),Bt._p=new Promise(function(ln,$n){Bt.onload=ln,Bt.onerror=$n}),Bt.addEventListener("load",function(){ot.loading|=1}),Bt.addEventListener("error",function(){ot.loading|=2}),ot.loading|=4,tm(Ne,b,B)}Ne={type:"stylesheet",instance:Ne,count:1,state:ot},Y.set(ae,Ne)}}}function W2(p,b){Pd.X(p,b);var M=Qp;if(M&&p){var B=gi(M).hoistableScripts,Y=Gg(p),ae=B.get(Y);ae||(ae=M.querySelector(Wg(Y)),ae||(p=Oe({src:p,async:!0},b),(b=qh.get(Y))&&Kg(p,b),ae=M.createElement("script"),Gr(ae),Ao(ae,"link",p),M.head.appendChild(ae)),ae={type:"script",instance:ae,count:1,state:null},B.set(Y,ae))}}function ub(p,b){Pd.M(p,b);var M=Qp;if(M&&p){var B=gi(M).hoistableScripts,Y=Gg(p),ae=B.get(Y);ae||(ae=M.querySelector(Wg(Y)),ae||(p=Oe({src:p,async:!0,type:"module"},b),(b=qh.get(Y))&&Kg(p,b),ae=M.createElement("script"),Gr(ae),Ao(ae,"link",p),M.head.appendChild(ae)),ae={type:"script",instance:ae,count:1,state:null},B.set(Y,ae))}}function hb(p,b,M,B){var Y=(Y=Pn.current)?Wm(Y):null;if(!Y)throw Error(r(446));switch(p){case"meta":case"title":return null;case"style":return typeof M.precedence=="string"&&typeof M.href=="string"?(b=em(M.href),M=gi(Y).hoistableStyles,B=M.get(b),B||(B={type:"style",instance:null,count:0,state:null},M.set(b,B)),B):{type:"void",instance:null,count:0,state:null};case"link":if(M.rel==="stylesheet"&&typeof M.href=="string"&&typeof M.precedence=="string"){p=em(M.href);var ae=gi(Y).hoistableStyles,Ne=ae.get(p);if(Ne||(Y=Y.ownerDocument||Y,Ne={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},ae.set(p,Ne),(ae=Y.querySelector(l_(p)))&&!ae._p&&(Ne.instance=ae,Ne.state.loading=5),qh.has(p)||(M={rel:"preload",as:"style",href:M.href,crossOrigin:M.crossOrigin,integrity:M.integrity,media:M.media,hrefLang:M.hrefLang,referrerPolicy:M.referrerPolicy},qh.set(p,M),ae||a3(Y,p,M,Ne.state))),b&&B===null)throw Error(r(528,""));return Ne}if(b&&B!==null)throw Error(r(529,""));return null;case"script":return b=M.async,M=M.src,typeof M=="string"&&b&&typeof b!="function"&&typeof b!="symbol"?(b=Gg(M),M=gi(Y).hoistableScripts,B=M.get(b),B||(B={type:"script",instance:null,count:0,state:null},M.set(b,B)),B):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,p))}}function em(p){return'href="'+Ys(p)+'"'}function l_(p){return'link[rel="stylesheet"]['+p+"]"}function K2(p){return Oe({},p,{"data-precedence":p.precedence,precedence:null})}function a3(p,b,M,B){p.querySelector('link[rel="preload"][as="style"]['+b+"]")?B.loading=1:(b=p.createElement("link"),B.preload=b,b.addEventListener("load",function(){return B.loading|=1}),b.addEventListener("error",function(){return B.loading|=2}),Ao(b,"link",M),Gr(b),p.head.appendChild(b))}function Gg(p){return'[src="'+Ys(p)+'"]'}function Wg(p){return"script[async]"+p}function cp(p,b,M){if(b.count++,b.instance===null)switch(b.type){case"style":var B=p.querySelector('style[data-href~="'+Ys(M.href)+'"]');if(B)return b.instance=B,Gr(B),B;var Y=Oe({},M,{"data-href":M.href,"data-precedence":M.precedence,href:null,precedence:null});return B=(p.ownerDocument||p).createElement("style"),Gr(B),Ao(B,"style",Y),tm(B,M.precedence,p),b.instance=B;case"stylesheet":Y=em(M.href);var ae=p.querySelector(l_(Y));if(ae)return b.state.loading|=4,b.instance=ae,Gr(ae),ae;B=K2(M),(Y=qh.get(Y))&&Km(B,Y),ae=(p.ownerDocument||p).createElement("link"),Gr(ae);var Ne=ae;return Ne._p=new Promise(function(ot,Bt){Ne.onload=ot,Ne.onerror=Bt}),Ao(ae,"link",B),b.state.loading|=4,tm(ae,M.precedence,p),b.instance=ae;case"script":return ae=Gg(M.src),(Y=p.querySelector(Wg(ae)))?(b.instance=Y,Gr(Y),Y):(B=M,(Y=qh.get(ae))&&(B=Oe({},M),Kg(B,Y)),p=p.ownerDocument||p,Y=p.createElement("script"),Gr(Y),Ao(Y,"link",B),p.head.appendChild(Y),b.instance=Y);case"void":return null;default:throw Error(r(443,b.type))}else b.type==="stylesheet"&&(b.state.loading&4)===0&&(B=b.instance,b.state.loading|=4,tm(B,M.precedence,p));return b.instance}function tm(p,b,M){for(var B=M.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),Y=B.length?B[B.length-1]:null,ae=Y,Ne=0;Ne<B.length;Ne++){var ot=B[Ne];if(ot.dataset.precedence===b)ae=ot;else if(ae!==Y)break}ae?ae.parentNode.insertBefore(p,ae.nextSibling):(b=M.nodeType===9?M.head:M,b.insertBefore(p,b.firstChild))}function Km(p,b){p.crossOrigin==null&&(p.crossOrigin=b.crossOrigin),p.referrerPolicy==null&&(p.referrerPolicy=b.referrerPolicy),p.title==null&&(p.title=b.title)}function Kg(p,b){p.crossOrigin==null&&(p.crossOrigin=b.crossOrigin),p.referrerPolicy==null&&(p.referrerPolicy=b.referrerPolicy),p.integrity==null&&(p.integrity=b.integrity)}var nm=null;function fb(p,b,M){if(nm===null){var B=new Map,Y=nm=new Map;Y.set(M,B)}else Y=nm,B=Y.get(M),B||(B=new Map,Y.set(M,B));if(B.has(p))return B;for(B.set(p,null),M=M.getElementsByTagName(p),Y=0;Y<M.length;Y++){var ae=M[Y];if(!(ae[Rr]||ae[Gt]||p==="link"&&ae.getAttribute("rel")==="stylesheet")&&ae.namespaceURI!=="http://www.w3.org/2000/svg"){var Ne=ae.getAttribute(b)||"";Ne=p+Ne;var ot=B.get(Ne);ot?ot.push(ae):B.set(Ne,[ae])}}return B}function db(p,b,M){p=p.ownerDocument||p,p.head.insertBefore(M,b==="title"?p.querySelector("head > title"):null)}function Y2(p,b,M){if(M===1||b.itemProp!=null)return!1;switch(p){case"meta":case"title":return!0;case"style":if(typeof b.precedence!="string"||typeof b.href!="string"||b.href==="")break;return!0;case"link":if(typeof b.rel!="string"||typeof b.href!="string"||b.href===""||b.onLoad||b.onError)break;switch(b.rel){case"stylesheet":return p=b.disabled,typeof b.precedence=="string"&&p==null;default:return!0}case"script":if(b.async&&typeof b.async!="function"&&typeof b.async!="symbol"&&!b.onLoad&&!b.onError&&b.src&&typeof b.src=="string")return!0}return!1}function pb(p){return!(p.type==="stylesheet"&&(p.state.loading&3)===0)}var c_=null;function s3(){}function X2(p,b,M){if(c_===null)throw Error(r(475));var B=c_;if(b.type==="stylesheet"&&(typeof M.media!="string"||matchMedia(M.media).matches!==!1)&&(b.state.loading&4)===0){if(b.instance===null){var Y=em(M.href),ae=p.querySelector(l_(Y));if(ae){p=ae._p,p!==null&&typeof p=="object"&&typeof p.then=="function"&&(B.count++,B=u_.bind(B),p.then(B,B)),b.state.loading|=4,b.instance=ae,Gr(ae);return}ae=p.ownerDocument||p,M=K2(M),(Y=qh.get(Y))&&Km(M,Y),ae=ae.createElement("link"),Gr(ae);var Ne=ae;Ne._p=new Promise(function(ot,Bt){Ne.onload=ot,Ne.onerror=Bt}),Ao(ae,"link",M),b.instance=ae}B.stylesheets===null&&(B.stylesheets=new Map),B.stylesheets.set(b,p),(p=b.state.preload)&&(b.state.loading&3)===0&&(B.count++,b=u_.bind(B),p.addEventListener("load",b),p.addEventListener("error",b))}}function Fv(){if(c_===null)throw Error(r(475));var p=c_;return p.stylesheets&&p.count===0&&qv(p,p.stylesheets),0<p.count?function(b){var M=setTimeout(function(){if(p.stylesheets&&qv(p,p.stylesheets),p.unsuspend){var B=p.unsuspend;p.unsuspend=null,B()}},6e4);return p.unsuspend=b,function(){p.unsuspend=null,clearTimeout(M)}}:null}function u_(){if(this.count--,this.count===0){if(this.stylesheets)qv(this,this.stylesheets);else if(this.unsuspend){var p=this.unsuspend;this.unsuspend=null,p()}}}var Uv=null;function qv(p,b){p.stylesheets=null,p.unsuspend!==null&&(p.count++,Uv=new Map,b.forEach(mb,p),Uv=null,u_.call(p))}function mb(p,b){if(!(b.state.loading&4)){var M=Uv.get(p);if(M)var B=M.get(null);else{M=new Map,Uv.set(p,M);for(var Y=p.querySelectorAll("link[data-precedence],style[data-precedence]"),ae=0;ae<Y.length;ae++){var Ne=Y[ae];(Ne.nodeName==="LINK"||Ne.getAttribute("media")!=="not all")&&(M.set(Ne.dataset.precedence,Ne),B=Ne)}B&&M.set(null,B)}Y=b.instance,Ne=Y.getAttribute("data-precedence"),ae=M.get(Ne)||B,ae===B&&M.set(null,Y),M.set(Ne,Y),this.count++,B=u_.bind(this),Y.addEventListener("load",B),Y.addEventListener("error",B),ae?ae.parentNode.insertBefore(Y,ae.nextSibling):(p=p.nodeType===9?p.head:p,p.insertBefore(Y,p.firstChild)),b.state.loading|=4}}var Yg={$$typeof:j,Provider:null,Consumer:null,_currentValue:ct,_currentValue2:ct,_threadCount:0};function Z2(p,b,M,B,Y,ae,Ne,ot){this.tag=1,this.containerInfo=p,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ee(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ee(0),this.hiddenUpdates=Ee(null),this.identifierPrefix=B,this.onUncaughtError=Y,this.onCaughtError=ae,this.onRecoverableError=Ne,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ot,this.incompleteTransitions=new Map}function gb(p,b,M,B,Y,ae,Ne,ot,Bt,ln,$n,ir){return p=new Z2(p,b,M,Ne,ot,Bt,ln,ir),b=1,ae===!0&&(b|=24),ae=tn(3,null,null,b),p.current=ae,ae.stateNode=p,b=jf(),b.refCount++,p.pooledCache=b,b.refCount++,ae.memoizedState={element:B,isDehydrated:M,cache:b},gf(ae),p}function yb(p){return p?(p=ju,p):ju}function _b(p,b,M,B,Y,ae){Y=yb(Y),B.context===null?B.context=Y:B.pendingContext=Y,B=Sd(b),B.payload={element:M},ae=ae===void 0?null:ae,ae!==null&&(B.callback=ae),M=Ad(p,B,b),M!==null&&(Dl(M,p,b),Td(M,p,b))}function J2(p,b){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var M=p.retryLane;p.retryLane=M!==0&&M<b?M:b}}function Vv(p,b){J2(p,b),(p=p.alternate)&&J2(p,b)}function vb(p){if(p.tag===13){var b=Zo(p,67108864);b!==null&&Dl(b,p,67108864),Vv(p,67108864)}}var rm=!0;function Q2(p,b,M,B){var Y=Ae.T;Ae.T=null;var ae=Xe.p;try{Xe.p=2,bb(p,b,M,B)}finally{Xe.p=ae,Ae.T=Y}}function eS(p,b,M,B){var Y=Ae.T;Ae.T=null;var ae=Xe.p;try{Xe.p=8,bb(p,b,M,B)}finally{Xe.p=ae,Ae.T=Y}}function bb(p,b,M,B){if(rm){var Y=xb(B);if(Y===null)Lv(p,b,B,$v,M),Tb(p,B);else if(nS(Y,p,b,M,B))B.stopPropagation();else if(Tb(p,B),b&4&&-1<Ab.indexOf(p)){for(;Y!==null;){var ae=Xi(Y);if(ae!==null)switch(ae.tag){case 3:if(ae=ae.stateNode,ae.current.memoizedState.isDehydrated){var Ne=Ia(ae.pendingLanes);if(Ne!==0){var ot=ae;for(ot.pendingLanes|=2,ot.entangledLanes|=2;Ne;){var Bt=1<<31-ti(Ne);ot.entanglements[1]|=Bt,Ne&=~Bt}Gf(ae),(Cr&6)===0&&(mo=Un()+500,Jp(0))}}break;case 13:ot=Zo(ae,2),ot!==null&&Dl(ot,ae,2),Av(),Vv(ae,2)}if(ae=xb(B),ae===null&&Lv(p,b,B,$v,M),ae===Y)break;Y=ae}Y!==null&&B.stopPropagation()}else Lv(p,b,B,null,M)}}function xb(p){return p=dr(p),wb(p)}var $v=null;function wb(p){if($v=null,p=Ri(p),p!==null){var b=Fe(p);if(b===null)p=null;else{var M=b.tag;if(M===13){if(p=Qe(b),p!==null)return p;p=null}else if(M===3){if(b.stateNode.current.memoizedState.isDehydrated)return b.tag===3?b.stateNode.containerInfo:null;p=null}else b!==p&&(p=null)}}return $v=p,null}function tS(p){switch(p){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Vr()){case pi:return 2;case Li:return 8;case wi:case xn:return 32;case Xn:return 268435456;default:return 32}default:return 32}}var Sb=!1,im=null,up=null,am=null,h_=new Map,f_=new Map,Od=[],Ab="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Tb(p,b){switch(p){case"focusin":case"focusout":im=null;break;case"dragenter":case"dragleave":up=null;break;case"mouseover":case"mouseout":am=null;break;case"pointerover":case"pointerout":h_.delete(b.pointerId);break;case"gotpointercapture":case"lostpointercapture":f_.delete(b.pointerId)}}function Xg(p,b,M,B,Y,ae){return p===null||p.nativeEvent!==ae?(p={blockedOn:b,domEventName:M,eventSystemFlags:B,nativeEvent:ae,targetContainers:[Y]},b!==null&&(b=Xi(b),b!==null&&vb(b)),p):(p.eventSystemFlags|=B,b=p.targetContainers,Y!==null&&b.indexOf(Y)===-1&&b.push(Y),p)}function nS(p,b,M,B,Y){switch(b){case"focusin":return im=Xg(im,p,b,M,B,Y),!0;case"dragenter":return up=Xg(up,p,b,M,B,Y),!0;case"mouseover":return am=Xg(am,p,b,M,B,Y),!0;case"pointerover":var ae=Y.pointerId;return h_.set(ae,Xg(h_.get(ae)||null,p,b,M,B,Y)),!0;case"gotpointercapture":return ae=Y.pointerId,f_.set(ae,Xg(f_.get(ae)||null,p,b,M,B,Y)),!0}return!1}function Eb(p){var b=Ri(p.target);if(b!==null){var M=Fe(b);if(M!==null){if(b=M.tag,b===13){if(b=Qe(M),b!==null){p.blockedOn=b,Ct(p.priority,function(){if(M.tag===13){var B=go(),Y=Zo(M,B);Y!==null&&Dl(Y,M,B),Vv(M,B)}});return}}else if(b===3&&M.stateNode.current.memoizedState.isDehydrated){p.blockedOn=M.tag===3?M.stateNode.containerInfo:null;return}}}p.blockedOn=null}function d_(p){if(p.blockedOn!==null)return!1;for(var b=p.targetContainers;0<b.length;){var M=xb(p.nativeEvent);if(M===null){M=p.nativeEvent;var B=new M.constructor(M.type,M);oo=B,M.target.dispatchEvent(B),oo=null}else return b=Xi(M),b!==null&&vb(b),p.blockedOn=M,!1;b.shift()}return!0}function Mb(p,b,M){d_(p)&&M.delete(b)}function rS(){Sb=!1,im!==null&&d_(im)&&(im=null),up!==null&&d_(up)&&(up=null),am!==null&&d_(am)&&(am=null),h_.forEach(Mb),f_.forEach(Mb)}function p_(p,b){p.blockedOn===b&&(p.blockedOn=null,Sb||(Sb=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,rS)))}var Zg=null;function Cb(p){Zg!==p&&(Zg=p,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Zg===p&&(Zg=null);for(var b=0;b<p.length;b+=3){var M=p[b],B=p[b+1],Y=p[b+2];if(typeof B!="function"){if(wb(B||M)===null)continue;break}var ae=Xi(M);ae!==null&&(p.splice(b,3),b-=3,Ku(ae,{pending:!0,data:Y,method:M.method,action:B},B,Y))}}))}function m_(p){function b(Bt){return p_(Bt,p)}im!==null&&p_(im,p),up!==null&&p_(up,p),am!==null&&p_(am,p),h_.forEach(b),f_.forEach(b);for(var M=0;M<Od.length;M++){var B=Od[M];B.blockedOn===p&&(B.blockedOn=null)}for(;0<Od.length&&(M=Od[0],M.blockedOn===null);)Eb(M),M.blockedOn===null&&Od.shift();if(M=(p.ownerDocument||p).$$reactFormReplay,M!=null)for(B=0;B<M.length;B+=3){var Y=M[B],ae=M[B+1],Ne=Y[$t]||null;if(typeof ae=="function")Ne||Cb(M);else if(Ne){var ot=null;if(ae&&ae.hasAttribute("formAction")){if(Y=ae,Ne=ae[$t]||null)ot=Ne.formAction;else if(wb(Y)!==null)continue}else ot=Ne.action;typeof ot=="function"?M[B+1]=ot:(M.splice(B,3),B-=3),Cb(M)}}}function Ym(p){this._internalRoot=p}g_.prototype.render=Ym.prototype.render=function(p){var b=this._internalRoot;if(b===null)throw Error(r(409));var M=b.current,B=go();_b(M,B,p,b,null,null)},g_.prototype.unmount=Ym.prototype.unmount=function(){var p=this._internalRoot;if(p!==null){this._internalRoot=null;var b=p.containerInfo;p.tag===0&&vf(),_b(p.current,2,null,p,null,null),Av(),b[Sn]=null}};function g_(p){this._internalRoot=p}g_.prototype.unstable_scheduleHydration=function(p){if(p){var b=Ft();p={blockedOn:null,target:p,priority:b};for(var M=0;M<Od.length&&b!==0&&b<Od[M].priority;M++);Od.splice(M,0,p),M===0&&Eb(p)}};var iS=e.version;if(iS!=="19.0.0")throw Error(r(527,iS,"19.0.0"));Xe.findDOMNode=function(p){var b=p._reactInternals;if(b===void 0)throw typeof p.render=="function"?Error(r(188)):(p=Object.keys(p).join(","),Error(r(268,p)));return p=bt(b),p=p!==null?xe(p):null,p=p===null?null:p.stateNode,p};var o3={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:Ae,findFiberByHostInstance:Ri,reconcilerVersion:"19.0.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Hv=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Hv.isDisabled&&Hv.supportsFiber)try{yr=Hv.inject(o3),Vi=Hv}catch{}}return Zb.createRoot=function(p,b){if(!s(p))throw Error(r(299));var M=!1,B="",Y=Jd,ae=qf,Ne=pf,ot=null;return b!=null&&(b.unstable_strictMode===!0&&(M=!0),b.identifierPrefix!==void 0&&(B=b.identifierPrefix),b.onUncaughtError!==void 0&&(Y=b.onUncaughtError),b.onCaughtError!==void 0&&(ae=b.onCaughtError),b.onRecoverableError!==void 0&&(Ne=b.onRecoverableError),b.unstable_transitionCallbacks!==void 0&&(ot=b.unstable_transitionCallbacks)),b=gb(p,1,!1,null,null,M,B,Y,ae,Ne,ot,null),p[Sn]=b.current,Dv(p.nodeType===8?p.parentNode:p),new Ym(b)},Zb.hydrateRoot=function(p,b,M){if(!s(p))throw Error(r(299));var B=!1,Y="",ae=Jd,Ne=qf,ot=pf,Bt=null,ln=null;return M!=null&&(M.unstable_strictMode===!0&&(B=!0),M.identifierPrefix!==void 0&&(Y=M.identifierPrefix),M.onUncaughtError!==void 0&&(ae=M.onUncaughtError),M.onCaughtError!==void 0&&(Ne=M.onCaughtError),M.onRecoverableError!==void 0&&(ot=M.onRecoverableError),M.unstable_transitionCallbacks!==void 0&&(Bt=M.unstable_transitionCallbacks),M.formState!==void 0&&(ln=M.formState)),b=gb(p,1,!0,b,M??null,B,Y,ae,Ne,ot,Bt,ln),b.context=yb(null),M=b.current,B=go(),Y=Sd(B),Y.callback=null,Ad(M,Y,B),b.current.lanes=B,Re(b,B),Gf(b),p[Sn]=b.current,Dv(p),new g_(b)},Zb.version="19.0.0",Zb}var U6;function Dee(){if(U6)return nM.exports;U6=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),nM.exports=Ree(),nM.exports}var Lee=Dee(),Jb={},q6;function kee(){if(q6)return Jb;q6=1,Object.defineProperty(Jb,"__esModule",{value:!0}),Jb.parse=f,Jb.serialize=S;const t=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,e=/^[\u0021-\u003A\u003C-\u007E]*$/,n=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,r=/^[\u0020-\u003A\u003D-\u007E]*$/,s=Object.prototype.toString,l=(()=>{const F=function(){};return F.prototype=Object.create(null),F})();function f(F,j){const H=new l,G=F.length;if(G<2)return H;const W=(j==null?void 0:j.decode)||I;let J=0;do{const ie=F.indexOf("=",J);if(ie===-1)break;const he=F.indexOf(";",J),ge=he===-1?G:he;if(ie>ge){J=F.lastIndexOf(";",ie-1)+1;continue}const fe=i(F,J,ie),ye=x(F,ie,fe),pe=F.slice(fe,ye);if(H[pe]===void 0){let be=i(F,ie+1,ge),Ae=x(F,ge,be);const Oe=W(F.slice(be,Ae));H[pe]=Oe}J=ge+1}while(J<G);return H}function i(F,j,H){do{const G=F.charCodeAt(j);if(G!==32&&G!==9)return j}while(++j<H);return H}function x(F,j,H){for(;j>H;){const G=F.charCodeAt(--j);if(G!==32&&G!==9)return j+1}return H}function S(F,j,H){const G=(H==null?void 0:H.encode)||encodeURIComponent;if(!t.test(F))throw new TypeError(`argument name is invalid: ${F}`);const W=G(j);if(!e.test(W))throw new TypeError(`argument val is invalid: ${j}`);let J=F+"="+W;if(!H)return J;if(H.maxAge!==void 0){if(!Number.isInteger(H.maxAge))throw new TypeError(`option maxAge is invalid: ${H.maxAge}`);J+="; Max-Age="+H.maxAge}if(H.domain){if(!n.test(H.domain))throw new TypeError(`option domain is invalid: ${H.domain}`);J+="; Domain="+H.domain}if(H.path){if(!r.test(H.path))throw new TypeError(`option path is invalid: ${H.path}`);J+="; Path="+H.path}if(H.expires){if(!R(H.expires)||!Number.isFinite(H.expires.valueOf()))throw new TypeError(`option expires is invalid: ${H.expires}`);J+="; Expires="+H.expires.toUTCString()}if(H.httpOnly&&(J+="; HttpOnly"),H.secure&&(J+="; Secure"),H.partitioned&&(J+="; Partitioned"),H.priority)switch(typeof H.priority=="string"?H.priority.toLowerCase():void 0){case"low":J+="; Priority=Low";break;case"medium":J+="; Priority=Medium";break;case"high":J+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${H.priority}`)}if(H.sameSite)switch(typeof H.sameSite=="string"?H.sameSite.toLowerCase():H.sameSite){case!0:case"strict":J+="; SameSite=Strict";break;case"lax":J+="; SameSite=Lax";break;case"none":J+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${H.sameSite}`)}return J}function I(F){if(F.indexOf("%")===-1)return F;try{return decodeURIComponent(F)}catch{return F}}function R(F){return s.call(F)==="[object Date]"}return Jb}kee();/**
 * react-router v7.3.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var V6="popstate";function Nee(t={}){function e(s,l){let{pathname:f="/",search:i="",hash:x=""}=uv(s.location.hash.substring(1));return!f.startsWith("/")&&!f.startsWith(".")&&(f="/"+f),f4("",{pathname:f,search:i,hash:x},l.state&&l.state.usr||null,l.state&&l.state.key||"default")}function n(s,l){let f=s.document.querySelector("base"),i="";if(f&&f.getAttribute("href")){let x=s.location.href,S=x.indexOf("#");i=S===-1?x:x.slice(0,S)}return i+"#"+(typeof l=="string"?l:Fx(l))}function r(s,l){Mp(s.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(l)})`)}return Bee(e,n,r,t)}function ll(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Mp(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function zee(){return Math.random().toString(36).substring(2,10)}function $6(t,e){return{usr:t.state,key:t.key,idx:e}}function f4(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?uv(e):e,state:n,key:e&&e.key||r||zee()}}function Fx({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function uv(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function Bee(t,e,n,r={}){let{window:s=document.defaultView,v5Compat:l=!1}=r,f=s.history,i="POP",x=null,S=I();S==null&&(S=0,f.replaceState({...f.state,idx:S},""));function I(){return(f.state||{idx:null}).idx}function R(){i="POP";let W=I(),J=W==null?null:W-S;S=W,x&&x({action:i,location:G.location,delta:J})}function F(W,J){i="PUSH";let ie=f4(G.location,W,J);n&&n(ie,W),S=I()+1;let he=$6(ie,S),ge=G.createHref(ie);try{f.pushState(he,"",ge)}catch(fe){if(fe instanceof DOMException&&fe.name==="DataCloneError")throw fe;s.location.assign(ge)}l&&x&&x({action:i,location:G.location,delta:1})}function j(W,J){i="REPLACE";let ie=f4(G.location,W,J);n&&n(ie,W),S=I();let he=$6(ie,S),ge=G.createHref(ie);f.replaceState(he,"",ge),l&&x&&x({action:i,location:G.location,delta:0})}function H(W){let J=s.location.origin!=="null"?s.location.origin:s.location.href,ie=typeof W=="string"?W:Fx(W);return ie=ie.replace(/ $/,"%20"),ll(J,`No window.location.(origin|href) available to create URL for href: ${ie}`),new URL(ie,J)}let G={get action(){return i},get location(){return t(s,f)},listen(W){if(x)throw new Error("A history only accepts one active listener");return s.addEventListener(V6,R),x=W,()=>{s.removeEventListener(V6,R),x=null}},createHref(W){return e(s,W)},createURL:H,encodeLocation(W){let J=H(W);return{pathname:J.pathname,search:J.search,hash:J.hash}},push:F,replace:j,go(W){return f.go(W)}};return G}function D$(t,e,n="/"){return jee(t,e,n,!1)}function jee(t,e,n,r){let s=typeof e=="string"?uv(e):e,l=hg(s.pathname||"/",n);if(l==null)return null;let f=L$(t);Fee(f);let i=null;for(let x=0;i==null&&x<f.length;++x){let S=Zee(l);i=Yee(f[x],S,r)}return i}function L$(t,e=[],n=[],r=""){let s=(l,f,i)=>{let x={relativePath:i===void 0?l.path||"":i,caseSensitive:l.caseSensitive===!0,childrenIndex:f,route:l};x.relativePath.startsWith("/")&&(ll(x.relativePath.startsWith(r),`Absolute route path "${x.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),x.relativePath=x.relativePath.slice(r.length));let S=og([r,x.relativePath]),I=n.concat(x);l.children&&l.children.length>0&&(ll(l.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${S}".`),L$(l.children,e,I,S)),!(l.path==null&&!l.index)&&e.push({path:S,score:Wee(S,l.index),routesMeta:I})};return t.forEach((l,f)=>{var i;if(l.path===""||!((i=l.path)!=null&&i.includes("?")))s(l,f);else for(let x of k$(l.path))s(l,f,x)}),e}function k$(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),l=n.replace(/\?$/,"");if(r.length===0)return s?[l,""]:[l];let f=k$(r.join("/")),i=[];return i.push(...f.map(x=>x===""?l:[l,x].join("/"))),s&&i.push(...f),i.map(x=>t.startsWith("/")&&x===""?"/":x)}function Fee(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:Kee(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var Uee=/^:[\w-]+$/,qee=3,Vee=2,$ee=1,Hee=10,Gee=-2,H6=t=>t==="*";function Wee(t,e){let n=t.split("/"),r=n.length;return n.some(H6)&&(r+=Gee),e&&(r+=Vee),n.filter(s=>!H6(s)).reduce((s,l)=>s+(Uee.test(l)?qee:l===""?$ee:Hee),r)}function Kee(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function Yee(t,e,n=!1){let{routesMeta:r}=t,s={},l="/",f=[];for(let i=0;i<r.length;++i){let x=r[i],S=i===r.length-1,I=l==="/"?e:e.slice(l.length)||"/",R=UA({path:x.relativePath,caseSensitive:x.caseSensitive,end:S},I),F=x.route;if(!R&&S&&n&&!r[r.length-1].route.index&&(R=UA({path:x.relativePath,caseSensitive:x.caseSensitive,end:!1},I)),!R)return null;Object.assign(s,R.params),f.push({params:s,pathname:og([l,R.pathname]),pathnameBase:tte(og([l,R.pathnameBase])),route:F}),R.pathnameBase!=="/"&&(l=og([l,R.pathnameBase]))}return f}function UA(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=Xee(t.path,t.caseSensitive,t.end),s=e.match(n);if(!s)return null;let l=s[0],f=l.replace(/(.)\/+$/,"$1"),i=s.slice(1);return{params:r.reduce((S,{paramName:I,isOptional:R},F)=>{if(I==="*"){let H=i[F]||"";f=l.slice(0,l.length-H.length).replace(/(.)\/+$/,"$1")}const j=i[F];return R&&!j?S[I]=void 0:S[I]=(j||"").replace(/%2F/g,"/"),S},{}),pathname:l,pathnameBase:f,pattern:t}}function Xee(t,e=!1,n=!0){Mp(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(f,i,x)=>(r.push({paramName:i,isOptional:x!=null}),x?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function Zee(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Mp(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function hg(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function Jee(t,e="/"){let{pathname:n,search:r="",hash:s=""}=typeof t=="string"?uv(t):t;return{pathname:n?n.startsWith("/")?n:Qee(n,e):e,search:nte(r),hash:rte(s)}}function Qee(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function sM(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function ete(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function N$(t){let e=ete(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function z$(t,e,n,r=!1){let s;typeof t=="string"?s=uv(t):(s={...t},ll(!s.pathname||!s.pathname.includes("?"),sM("?","pathname","search",s)),ll(!s.pathname||!s.pathname.includes("#"),sM("#","pathname","hash",s)),ll(!s.search||!s.search.includes("#"),sM("#","search","hash",s)));let l=t===""||s.pathname==="",f=l?"/":s.pathname,i;if(f==null)i=n;else{let R=e.length-1;if(!r&&f.startsWith("..")){let F=f.split("/");for(;F[0]==="..";)F.shift(),R-=1;s.pathname=F.join("/")}i=R>=0?e[R]:"/"}let x=Jee(s,i),S=f&&f!=="/"&&f.endsWith("/"),I=(l||f===".")&&n.endsWith("/");return!x.pathname.endsWith("/")&&(S||I)&&(x.pathname+="/"),x}var og=t=>t.join("/").replace(/\/\/+/g,"/"),tte=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),nte=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,rte=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function ite(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}var B$=["POST","PUT","PATCH","DELETE"];new Set(B$);var ate=["GET",...B$];new Set(ate);var E1=st.createContext(null);E1.displayName="DataRouter";var g5=st.createContext(null);g5.displayName="DataRouterState";var j$=st.createContext({isTransitioning:!1});j$.displayName="ViewTransition";var ste=st.createContext(new Map);ste.displayName="Fetchers";var ote=st.createContext(null);ote.displayName="Await";var Im=st.createContext(null);Im.displayName="Navigation";var Vw=st.createContext(null);Vw.displayName="Location";var wg=st.createContext({outlet:null,matches:[],isDataRoute:!1});wg.displayName="Route";var BD=st.createContext(null);BD.displayName="RouteError";function lte(t,{relative:e}={}){ll($w(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=st.useContext(Im),{hash:s,pathname:l,search:f}=Hw(t,{relative:e}),i=l;return n!=="/"&&(i=l==="/"?n:og([n,l])),r.createHref({pathname:i,search:f,hash:s})}function $w(){return st.useContext(Vw)!=null}function Py(){return ll($w(),"useLocation() may be used only in the context of a <Router> component."),st.useContext(Vw).location}var F$="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function U$(t){st.useContext(Im).static||st.useLayoutEffect(t)}function jD(){let{isDataRoute:t}=st.useContext(wg);return t?xte():cte()}function cte(){ll($w(),"useNavigate() may be used only in the context of a <Router> component.");let t=st.useContext(E1),{basename:e,navigator:n}=st.useContext(Im),{matches:r}=st.useContext(wg),{pathname:s}=Py(),l=JSON.stringify(N$(r)),f=st.useRef(!1);return U$(()=>{f.current=!0}),st.useCallback((x,S={})=>{if(Mp(f.current,F$),!f.current)return;if(typeof x=="number"){n.go(x);return}let I=z$(x,JSON.parse(l),s,S.relative==="path");t==null&&e!=="/"&&(I.pathname=I.pathname==="/"?e:og([e,I.pathname])),(S.replace?n.replace:n.push)(I,S.state,S)},[e,n,l,s,t])}st.createContext(null);function Hw(t,{relative:e}={}){let{matches:n}=st.useContext(wg),{pathname:r}=Py(),s=JSON.stringify(N$(n));return st.useMemo(()=>z$(t,JSON.parse(s),r,e==="path"),[t,s,r,e])}function ute(t,e){return q$(t,e)}function q$(t,e,n,r){var ie;ll($w(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:s,static:l}=st.useContext(Im),{matches:f}=st.useContext(wg),i=f[f.length-1],x=i?i.params:{},S=i?i.pathname:"/",I=i?i.pathnameBase:"/",R=i&&i.route;{let he=R&&R.path||"";V$(S,!R||he.endsWith("*")||he.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${S}" (under <Route path="${he}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${he}"> to <Route path="${he==="/"?"*":`${he}/*`}">.`)}let F=Py(),j;if(e){let he=typeof e=="string"?uv(e):e;ll(I==="/"||((ie=he.pathname)==null?void 0:ie.startsWith(I)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${I}" but pathname "${he.pathname}" was given in the \`location\` prop.`),j=he}else j=F;let H=j.pathname||"/",G=H;if(I!=="/"){let he=I.replace(/^\//,"").split("/");G="/"+H.replace(/^\//,"").split("/").slice(he.length).join("/")}let W=!l&&n&&n.matches&&n.matches.length>0?n.matches:D$(t,{pathname:G});Mp(R||W!=null,`No routes matched location "${j.pathname}${j.search}${j.hash}" `),Mp(W==null||W[W.length-1].route.element!==void 0||W[W.length-1].route.Component!==void 0||W[W.length-1].route.lazy!==void 0,`Matched leaf route at location "${j.pathname}${j.search}${j.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let J=mte(W&&W.map(he=>Object.assign({},he,{params:Object.assign({},x,he.params),pathname:og([I,s.encodeLocation?s.encodeLocation(he.pathname).pathname:he.pathname]),pathnameBase:he.pathnameBase==="/"?I:og([I,s.encodeLocation?s.encodeLocation(he.pathnameBase).pathname:he.pathnameBase])})),f,n,r);return e&&J?st.createElement(Vw.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...j},navigationType:"POP"}},J):J}function hte(){let t=bte(),e=ite(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:r},l={padding:"2px 4px",backgroundColor:r},f=null;return console.error("Error handled by React Router default ErrorBoundary:",t),f=st.createElement(st.Fragment,null,st.createElement("p",null,"💿 Hey developer 👋"),st.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",st.createElement("code",{style:l},"ErrorBoundary")," or"," ",st.createElement("code",{style:l},"errorElement")," prop on your route.")),st.createElement(st.Fragment,null,st.createElement("h2",null,"Unexpected Application Error!"),st.createElement("h3",{style:{fontStyle:"italic"}},e),n?st.createElement("pre",{style:s},n):null,f)}var fte=st.createElement(hte,null),dte=class extends st.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){console.error("React Router caught the following error during render",t,e)}render(){return this.state.error!==void 0?st.createElement(wg.Provider,{value:this.props.routeContext},st.createElement(BD.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function pte({routeContext:t,match:e,children:n}){let r=st.useContext(E1);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),st.createElement(wg.Provider,{value:t},n)}function mte(t,e=[],n=null,r=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let s=t,l=n==null?void 0:n.errors;if(l!=null){let x=s.findIndex(S=>S.route.id&&(l==null?void 0:l[S.route.id])!==void 0);ll(x>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(l).join(",")}`),s=s.slice(0,Math.min(s.length,x+1))}let f=!1,i=-1;if(n)for(let x=0;x<s.length;x++){let S=s[x];if((S.route.HydrateFallback||S.route.hydrateFallbackElement)&&(i=x),S.route.id){let{loaderData:I,errors:R}=n,F=S.route.loader&&!I.hasOwnProperty(S.route.id)&&(!R||R[S.route.id]===void 0);if(S.route.lazy||F){f=!0,i>=0?s=s.slice(0,i+1):s=[s[0]];break}}}return s.reduceRight((x,S,I)=>{let R,F=!1,j=null,H=null;n&&(R=l&&S.route.id?l[S.route.id]:void 0,j=S.route.errorElement||fte,f&&(i<0&&I===0?(V$("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),F=!0,H=null):i===I&&(F=!0,H=S.route.hydrateFallbackElement||null)));let G=e.concat(s.slice(0,I+1)),W=()=>{let J;return R?J=j:F?J=H:S.route.Component?J=st.createElement(S.route.Component,null):S.route.element?J=S.route.element:J=x,st.createElement(pte,{match:S,routeContext:{outlet:x,matches:G,isDataRoute:n!=null},children:J})};return n&&(S.route.ErrorBoundary||S.route.errorElement||I===0)?st.createElement(dte,{location:n.location,revalidation:n.revalidation,component:j,error:R,children:W(),routeContext:{outlet:null,matches:G,isDataRoute:!0}}):W()},null)}function FD(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function gte(t){let e=st.useContext(E1);return ll(e,FD(t)),e}function yte(t){let e=st.useContext(g5);return ll(e,FD(t)),e}function _te(t){let e=st.useContext(wg);return ll(e,FD(t)),e}function UD(t){let e=_te(t),n=e.matches[e.matches.length-1];return ll(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function vte(){return UD("useRouteId")}function bte(){var r;let t=st.useContext(BD),e=yte("useRouteError"),n=UD("useRouteError");return t!==void 0?t:(r=e.errors)==null?void 0:r[n]}function xte(){let{router:t}=gte("useNavigate"),e=UD("useNavigate"),n=st.useRef(!1);return U$(()=>{n.current=!0}),st.useCallback(async(s,l={})=>{Mp(n.current,F$),n.current&&(typeof s=="number"?t.navigate(s):await t.navigate(s,{fromRouteId:e,...l}))},[t,e])}var G6={};function V$(t,e,n){!e&&!G6[t]&&(G6[t]=!0,Mp(!1,n))}st.memo(wte);function wte({routes:t,future:e,state:n}){return q$(t,void 0,n,e)}function bp(t){ll(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Ste({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:s,static:l=!1}){ll(!$w(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let f=t.replace(/^\/*/,"/"),i=st.useMemo(()=>({basename:f,navigator:s,static:l,future:{}}),[f,s,l]);typeof n=="string"&&(n=uv(n));let{pathname:x="/",search:S="",hash:I="",state:R=null,key:F="default"}=n,j=st.useMemo(()=>{let H=hg(x,f);return H==null?null:{location:{pathname:H,search:S,hash:I,state:R,key:F},navigationType:r}},[f,x,S,I,R,F,r]);return Mp(j!=null,`<Router basename="${f}"> is not able to match the URL "${x}${S}${I}" because it does not start with the basename, so the <Router> won't render anything.`),j==null?null:st.createElement(Im.Provider,{value:i},st.createElement(Vw.Provider,{children:e,value:j}))}function Ate({children:t,location:e}){return ute(d4(t),e)}function d4(t,e=[]){let n=[];return st.Children.forEach(t,(r,s)=>{if(!st.isValidElement(r))return;let l=[...e,s];if(r.type===st.Fragment){n.push.apply(n,d4(r.props.children,l));return}ll(r.type===bp,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),ll(!r.props.index||!r.props.children,"An index route cannot have child routes.");let f={id:r.props.id||l.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(f.children=d4(r.props.children,l)),n.push(f)}),n}var mA="get",gA="application/x-www-form-urlencoded";function y5(t){return t!=null&&typeof t.tagName=="string"}function Tte(t){return y5(t)&&t.tagName.toLowerCase()==="button"}function Ete(t){return y5(t)&&t.tagName.toLowerCase()==="form"}function Mte(t){return y5(t)&&t.tagName.toLowerCase()==="input"}function Cte(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function Ite(t,e){return t.button===0&&(!e||e==="_self")&&!Cte(t)}var jS=null;function Pte(){if(jS===null)try{new FormData(document.createElement("form"),0),jS=!1}catch{jS=!0}return jS}var Ote=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function oM(t){return t!=null&&!Ote.has(t)?(Mp(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${gA}"`),null):t}function Rte(t,e){let n,r,s,l,f;if(Ete(t)){let i=t.getAttribute("action");r=i?hg(i,e):null,n=t.getAttribute("method")||mA,s=oM(t.getAttribute("enctype"))||gA,l=new FormData(t)}else if(Tte(t)||Mte(t)&&(t.type==="submit"||t.type==="image")){let i=t.form;if(i==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let x=t.getAttribute("formaction")||i.getAttribute("action");if(r=x?hg(x,e):null,n=t.getAttribute("formmethod")||i.getAttribute("method")||mA,s=oM(t.getAttribute("formenctype"))||oM(i.getAttribute("enctype"))||gA,l=new FormData(i,t),!Pte()){let{name:S,type:I,value:R}=t;if(I==="image"){let F=S?`${S}.`:"";l.append(`${F}x`,"0"),l.append(`${F}y`,"0")}else S&&l.append(S,R)}}else{if(y5(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=mA,r=null,s=gA,f=t}return l&&s==="text/plain"&&(f=l,l=void 0),{action:r,method:n.toLowerCase(),encType:s,formData:l,body:f}}function qD(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}async function Dte(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Lte(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function kte(t,e,n){let r=await Promise.all(t.map(async s=>{let l=e.routes[s.route.id];if(l){let f=await Dte(l,n);return f.links?f.links():[]}return[]}));return jte(r.flat(1).filter(Lte).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function W6(t,e,n,r,s,l){let f=(x,S)=>n[S]?x.route.id!==n[S].route.id:!0,i=(x,S)=>{var I;return n[S].pathname!==x.pathname||((I=n[S].route.path)==null?void 0:I.endsWith("*"))&&n[S].params["*"]!==x.params["*"]};return l==="assets"?e.filter((x,S)=>f(x,S)||i(x,S)):l==="data"?e.filter((x,S)=>{var R;let I=r.routes[x.route.id];if(!I||!I.hasLoader)return!1;if(f(x,S)||i(x,S))return!0;if(x.route.shouldRevalidate){let F=x.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:((R=n[0])==null?void 0:R.params)||{},nextUrl:new URL(t,window.origin),nextParams:x.params,defaultShouldRevalidate:!0});if(typeof F=="boolean")return F}return!0}):[]}function Nte(t,e,{includeHydrateFallback:n}={}){return zte(t.map(r=>{let s=e.routes[r.route.id];if(!s)return[];let l=[s.module];return s.clientActionModule&&(l=l.concat(s.clientActionModule)),s.clientLoaderModule&&(l=l.concat(s.clientLoaderModule)),n&&s.hydrateFallbackModule&&(l=l.concat(s.hydrateFallbackModule)),s.imports&&(l=l.concat(s.imports)),l}).flat(1))}function zte(t){return[...new Set(t)]}function Bte(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function jte(t,e){let n=new Set;return new Set(e),t.reduce((r,s)=>{let l=JSON.stringify(Bte(s));return n.has(l)||(n.add(l),r.push({key:l,link:s})),r},[])}function Fte(t,e){let n=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return n.pathname==="/"?n.pathname="_root.data":e&&hg(n.pathname,e)==="/"?n.pathname=`${e.replace(/\/$/,"")}/_root.data`:n.pathname=`${n.pathname.replace(/\/$/,"")}.data`,n}function $$(){let t=st.useContext(E1);return qD(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function Ute(){let t=st.useContext(g5);return qD(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var VD=st.createContext(void 0);VD.displayName="FrameworkContext";function H$(){let t=st.useContext(VD);return qD(t,"You must render this element inside a <HydratedRouter> element"),t}function qte(t,e){let n=st.useContext(VD),[r,s]=st.useState(!1),[l,f]=st.useState(!1),{onFocus:i,onBlur:x,onMouseEnter:S,onMouseLeave:I,onTouchStart:R}=e,F=st.useRef(null);st.useEffect(()=>{if(t==="render"&&f(!0),t==="viewport"){let G=J=>{J.forEach(ie=>{f(ie.isIntersecting)})},W=new IntersectionObserver(G,{threshold:.5});return F.current&&W.observe(F.current),()=>{W.disconnect()}}},[t]),st.useEffect(()=>{if(r){let G=setTimeout(()=>{f(!0)},100);return()=>{clearTimeout(G)}}},[r]);let j=()=>{s(!0)},H=()=>{s(!1),f(!1)};return n?t!=="intent"?[l,F,{}]:[l,F,{onFocus:Qb(i,j),onBlur:Qb(x,H),onMouseEnter:Qb(S,j),onMouseLeave:Qb(I,H),onTouchStart:Qb(R,j)}]:[!1,F,{}]}function Qb(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function Vte({page:t,...e}){let{router:n}=$$(),r=st.useMemo(()=>D$(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?st.createElement(Hte,{page:t,matches:r,...e}):null}function $te(t){let{manifest:e,routeModules:n}=H$(),[r,s]=st.useState([]);return st.useEffect(()=>{let l=!1;return kte(t,e,n).then(f=>{l||s(f)}),()=>{l=!0}},[t,e,n]),r}function Hte({page:t,matches:e,...n}){let r=Py(),{manifest:s,routeModules:l}=H$(),{basename:f}=$$(),{loaderData:i,matches:x}=Ute(),S=st.useMemo(()=>W6(t,e,x,s,r,"data"),[t,e,x,s,r]),I=st.useMemo(()=>W6(t,e,x,s,r,"assets"),[t,e,x,s,r]),R=st.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let H=new Set,G=!1;if(e.forEach(J=>{var he;let ie=s.routes[J.route.id];!ie||!ie.hasLoader||(!S.some(ge=>ge.route.id===J.route.id)&&J.route.id in i&&((he=l[J.route.id])!=null&&he.shouldRevalidate)||ie.hasClientLoader?G=!0:H.add(J.route.id))}),H.size===0)return[];let W=Fte(t,f);return G&&H.size>0&&W.searchParams.set("_routes",e.filter(J=>H.has(J.route.id)).map(J=>J.route.id).join(",")),[W.pathname+W.search]},[f,i,r,s,S,e,t,l]),F=st.useMemo(()=>Nte(I,s),[I,s]),j=$te(I);return st.createElement(st.Fragment,null,R.map(H=>st.createElement("link",{key:H,rel:"prefetch",as:"fetch",href:H,...n})),F.map(H=>st.createElement("link",{key:H,rel:"modulepreload",href:H,...n})),j.map(({key:H,link:G})=>st.createElement("link",{key:H,...G})))}function Gte(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var G$=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{G$&&(window.__reactRouterVersion="7.3.0")}catch{}function Wte({basename:t,children:e,window:n}){let r=st.useRef();r.current==null&&(r.current=Nee({window:n,v5Compat:!0}));let s=r.current,[l,f]=st.useState({action:s.action,location:s.location}),i=st.useCallback(x=>{st.startTransition(()=>f(x))},[f]);return st.useLayoutEffect(()=>s.listen(i),[s,i]),st.createElement(Ste,{basename:t,children:e,location:l.location,navigationType:l.action,navigator:s})}var W$=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,K$=st.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:s,reloadDocument:l,replace:f,state:i,target:x,to:S,preventScrollReset:I,viewTransition:R,...F},j){let{basename:H}=st.useContext(Im),G=typeof S=="string"&&W$.test(S),W,J=!1;if(typeof S=="string"&&G&&(W=S,G$))try{let Ae=new URL(window.location.href),Oe=S.startsWith("//")?new URL(Ae.protocol+S):new URL(S),ue=hg(Oe.pathname,H);Oe.origin===Ae.origin&&ue!=null?S=ue+Oe.search+Oe.hash:J=!0}catch{Mp(!1,`<Link to="${S}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let ie=lte(S,{relative:s}),[he,ge,fe]=qte(r,F),ye=Zte(S,{replace:f,state:i,target:x,preventScrollReset:I,relative:s,viewTransition:R});function pe(Ae){e&&e(Ae),Ae.defaultPrevented||ye(Ae)}let be=st.createElement("a",{...F,...fe,href:W||ie,onClick:J||l?e:pe,ref:Gte(j,ge),target:x,"data-discover":!G&&n==="render"?"true":void 0});return he&&!G?st.createElement(st.Fragment,null,be,st.createElement(Vte,{page:ie})):be});K$.displayName="Link";var Kte=st.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:s=!1,style:l,to:f,viewTransition:i,children:x,...S},I){let R=Hw(f,{relative:S.relative}),F=Py(),j=st.useContext(g5),{navigator:H,basename:G}=st.useContext(Im),W=j!=null&&nne(R)&&i===!0,J=H.encodeLocation?H.encodeLocation(R).pathname:R.pathname,ie=F.pathname,he=j&&j.navigation&&j.navigation.location?j.navigation.location.pathname:null;n||(ie=ie.toLowerCase(),he=he?he.toLowerCase():null,J=J.toLowerCase()),he&&G&&(he=hg(he,G)||he);const ge=J!=="/"&&J.endsWith("/")?J.length-1:J.length;let fe=ie===J||!s&&ie.startsWith(J)&&ie.charAt(ge)==="/",ye=he!=null&&(he===J||!s&&he.startsWith(J)&&he.charAt(J.length)==="/"),pe={isActive:fe,isPending:ye,isTransitioning:W},be=fe?e:void 0,Ae;typeof r=="function"?Ae=r(pe):Ae=[r,fe?"active":null,ye?"pending":null,W?"transitioning":null].filter(Boolean).join(" ");let Oe=typeof l=="function"?l(pe):l;return st.createElement(K$,{...S,"aria-current":be,className:Ae,ref:I,style:Oe,to:f,viewTransition:i},typeof x=="function"?x(pe):x)});Kte.displayName="NavLink";var Yte=st.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:s,state:l,method:f=mA,action:i,onSubmit:x,relative:S,preventScrollReset:I,viewTransition:R,...F},j)=>{let H=ene(),G=tne(i,{relative:S}),W=f.toLowerCase()==="get"?"get":"post",J=typeof i=="string"&&W$.test(i),ie=he=>{if(x&&x(he),he.defaultPrevented)return;he.preventDefault();let ge=he.nativeEvent.submitter,fe=(ge==null?void 0:ge.getAttribute("formmethod"))||f;H(ge||he.currentTarget,{fetcherKey:e,method:fe,navigate:n,replace:s,state:l,relative:S,preventScrollReset:I,viewTransition:R})};return st.createElement("form",{ref:j,method:W,action:G,onSubmit:r?x:ie,...F,"data-discover":!J&&t==="render"?"true":void 0})});Yte.displayName="Form";function Xte(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Y$(t){let e=st.useContext(E1);return ll(e,Xte(t)),e}function Zte(t,{target:e,replace:n,state:r,preventScrollReset:s,relative:l,viewTransition:f}={}){let i=jD(),x=Py(),S=Hw(t,{relative:l});return st.useCallback(I=>{if(Ite(I,e)){I.preventDefault();let R=n!==void 0?n:Fx(x)===Fx(S);i(t,{replace:R,state:r,preventScrollReset:s,relative:l,viewTransition:f})}},[x,i,S,n,r,e,t,s,l,f])}var Jte=0,Qte=()=>`__${String(++Jte)}__`;function ene(){let{router:t}=Y$("useSubmit"),{basename:e}=st.useContext(Im),n=vte();return st.useCallback(async(r,s={})=>{let{action:l,method:f,encType:i,formData:x,body:S}=Rte(r,e);if(s.navigate===!1){let I=s.fetcherKey||Qte();await t.fetch(I,n,s.action||l,{preventScrollReset:s.preventScrollReset,formData:x,body:S,formMethod:s.method||f,formEncType:s.encType||i,flushSync:s.flushSync})}else await t.navigate(s.action||l,{preventScrollReset:s.preventScrollReset,formData:x,body:S,formMethod:s.method||f,formEncType:s.encType||i,replace:s.replace,state:s.state,fromRouteId:n,flushSync:s.flushSync,viewTransition:s.viewTransition})},[t,e,n])}function tne(t,{relative:e}={}){let{basename:n}=st.useContext(Im),r=st.useContext(wg);ll(r,"useFormAction must be used inside a RouteContext");let[s]=r.matches.slice(-1),l={...Hw(t||".",{relative:e})},f=Py();if(t==null){l.search=f.search;let i=new URLSearchParams(l.search),x=i.getAll("index");if(x.some(I=>I==="")){i.delete("index"),x.filter(R=>R).forEach(R=>i.append("index",R));let I=i.toString();l.search=I?`?${I}`:""}}return(!t||t===".")&&s.route.index&&(l.search=l.search?l.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(l.pathname=l.pathname==="/"?n:og([n,l.pathname])),Fx(l)}function nne(t,e={}){let n=st.useContext(j$);ll(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=Y$("useViewTransitionState"),s=Hw(t,{relative:e.relative});if(!n.isTransitioning)return!1;let l=hg(n.currentLocation.pathname,r)||n.currentLocation.pathname,f=hg(n.nextLocation.pathname,r)||n.nextLocation.pathname;return UA(s.pathname,f)!=null||UA(s.pathname,l)!=null}new TextEncoder;var K6={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X$=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},rne=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const l=t[n++];e[r++]=String.fromCharCode((s&31)<<6|l&63)}else if(s>239&&s<365){const l=t[n++],f=t[n++],i=t[n++],x=((s&7)<<18|(l&63)<<12|(f&63)<<6|i&63)-65536;e[r++]=String.fromCharCode(55296+(x>>10)),e[r++]=String.fromCharCode(56320+(x&1023))}else{const l=t[n++],f=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(l&63)<<6|f&63)}}return e.join("")},Z$={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const l=t[s],f=s+1<t.length,i=f?t[s+1]:0,x=s+2<t.length,S=x?t[s+2]:0,I=l>>2,R=(l&3)<<4|i>>4;let F=(i&15)<<2|S>>6,j=S&63;x||(j=64,f||(F=64)),r.push(n[I],n[R],n[F],n[j])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(X$(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):rne(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const l=n[t.charAt(s++)],i=s<t.length?n[t.charAt(s)]:0;++s;const S=s<t.length?n[t.charAt(s)]:64;++s;const R=s<t.length?n[t.charAt(s)]:64;if(++s,l==null||i==null||S==null||R==null)throw new ine;const F=l<<2|i>>4;if(r.push(F),S!==64){const j=i<<4&240|S>>2;if(r.push(j),R!==64){const H=S<<6&192|R;r.push(H)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class ine extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const ane=function(t){const e=X$(t);return Z$.encodeByteArray(e,!0)},qA=function(t){return ane(t).replace(/\./g,"")},J$=function(t){try{return Z$.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sne(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const one=()=>sne().__FIREBASE_DEFAULTS__,lne=()=>{if(typeof process>"u"||typeof K6>"u")return;const t=K6.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},cne=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&J$(t[1]);return e&&JSON.parse(e)},$D=()=>{try{return one()||lne()||cne()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},Q$=t=>{var e,n;return(n=(e=$D())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},une=t=>{const e=Q$(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},eH=()=>{var t;return(t=$D())===null||t===void 0?void 0:t.config},tH=t=>{var e;return(e=$D())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hne{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fne(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,l=t.sub||t.user_id;if(!l)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const f=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:l,user_id:l,firebase:{sign_in_provider:"custom",identities:{}}},t);return[qA(JSON.stringify(n)),qA(JSON.stringify(f)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ph(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function dne(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ph())}function pne(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function mne(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function gne(){const t=ph();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function yne(){try{return typeof indexedDB=="object"}catch{return!1}}function _ne(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var l;e(((l=s.error)===null||l===void 0?void 0:l.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vne="FirebaseError";class Sg extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=vne,Object.setPrototypeOf(this,Sg.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Gw.prototype.create)}}class Gw{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,l=this.errors[e],f=l?bne(l,r):"Error",i=`${this.serviceName}: ${f} (${s}).`;return new Sg(s,i,r)}}function bne(t,e){return t.replace(xne,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const xne=/\{\$([^}]+)}/g;function wne(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function VA(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const l=t[s],f=e[s];if(Y6(l)&&Y6(f)){if(!VA(l,f))return!1}else if(l!==f)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function Y6(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ww(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function gx(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,l]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(l)}}),e}function yx(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function Sne(t,e){const n=new Ane(t,e);return n.subscribe.bind(n)}class Ane{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");Tne(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=lM),s.error===void 0&&(s.error=lM),s.complete===void 0&&(s.complete=lM);const l=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),l}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Tne(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function lM(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kc(t){return t&&t._delegate?t._delegate:t}class Z_{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I_="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ene{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new hne;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(l){if(s)return null;throw l}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Cne(e))try{this.getOrInitializeService({instanceIdentifier:I_})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const l=this.getOrInitializeService({instanceIdentifier:s});r.resolve(l)}catch{}}}}clearInstance(e=I_){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=I_){return this.instances.has(e)}getOptions(e=I_){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[l,f]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(l);r===i&&f.resolve(s)}return s}onInit(e,n){var r;const s=this.normalizeInstanceIdentifier(n),l=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;l.add(e),this.onInitCallbacks.set(s,l);const f=this.instances.get(s);return f&&e(f,s),()=>{l.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Mne(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=I_){return this.component?this.component.multipleInstances?e:I_:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Mne(t){return t===I_?void 0:t}function Cne(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ine{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new Ene(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var hs;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(hs||(hs={}));const Pne={debug:hs.DEBUG,verbose:hs.VERBOSE,info:hs.INFO,warn:hs.WARN,error:hs.ERROR,silent:hs.SILENT},One=hs.INFO,Rne={[hs.DEBUG]:"log",[hs.VERBOSE]:"log",[hs.INFO]:"info",[hs.WARN]:"warn",[hs.ERROR]:"error"},Dne=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=Rne[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class HD{constructor(e){this.name=e,this._logLevel=One,this._logHandler=Dne,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in hs))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Pne[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,hs.DEBUG,...e),this._logHandler(this,hs.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,hs.VERBOSE,...e),this._logHandler(this,hs.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,hs.INFO,...e),this._logHandler(this,hs.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,hs.WARN,...e),this._logHandler(this,hs.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,hs.ERROR,...e),this._logHandler(this,hs.ERROR,...e)}}const Lne=(t,e)=>e.some(n=>t instanceof n);let X6,Z6;function kne(){return X6||(X6=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Nne(){return Z6||(Z6=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const nH=new WeakMap,p4=new WeakMap,rH=new WeakMap,cM=new WeakMap,GD=new WeakMap;function zne(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",l),t.removeEventListener("error",f)},l=()=>{n(xy(t.result)),s()},f=()=>{r(t.error),s()};t.addEventListener("success",l),t.addEventListener("error",f)});return e.then(n=>{n instanceof IDBCursor&&nH.set(n,t)}).catch(()=>{}),GD.set(e,t),e}function Bne(t){if(p4.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",l),t.removeEventListener("error",f),t.removeEventListener("abort",f)},l=()=>{n(),s()},f=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",l),t.addEventListener("error",f),t.addEventListener("abort",f)});p4.set(t,e)}let m4={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return p4.get(t);if(e==="objectStoreNames")return t.objectStoreNames||rH.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return xy(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function jne(t){m4=t(m4)}function Fne(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(uM(this),e,...n);return rH.set(r,e.sort?e.sort():[e]),xy(r)}:Nne().includes(t)?function(...e){return t.apply(uM(this),e),xy(nH.get(this))}:function(...e){return xy(t.apply(uM(this),e))}}function Une(t){return typeof t=="function"?Fne(t):(t instanceof IDBTransaction&&Bne(t),Lne(t,kne())?new Proxy(t,m4):t)}function xy(t){if(t instanceof IDBRequest)return zne(t);if(cM.has(t))return cM.get(t);const e=Une(t);return e!==t&&(cM.set(t,e),GD.set(e,t)),e}const uM=t=>GD.get(t);function qne(t,e,{blocked:n,upgrade:r,blocking:s,terminated:l}={}){const f=indexedDB.open(t,e),i=xy(f);return r&&f.addEventListener("upgradeneeded",x=>{r(xy(f.result),x.oldVersion,x.newVersion,xy(f.transaction),x)}),n&&f.addEventListener("blocked",x=>n(x.oldVersion,x.newVersion,x)),i.then(x=>{l&&x.addEventListener("close",()=>l()),s&&x.addEventListener("versionchange",S=>s(S.oldVersion,S.newVersion,S))}).catch(()=>{}),i}const Vne=["get","getKey","getAll","getAllKeys","count"],$ne=["put","add","delete","clear"],hM=new Map;function J6(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(hM.get(e))return hM.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=$ne.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||Vne.includes(n)))return;const l=async function(f,...i){const x=this.transaction(f,s?"readwrite":"readonly");let S=x.store;return r&&(S=S.index(i.shift())),(await Promise.all([S[n](...i),s&&x.done]))[0]};return hM.set(e,l),l}jne(t=>({...t,get:(e,n,r)=>J6(e,n)||t.get(e,n,r),has:(e,n)=>!!J6(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hne{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(Gne(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function Gne(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const g4="@firebase/app",Q6="0.9.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J_=new HD("@firebase/app"),Wne="@firebase/app-compat",Kne="@firebase/analytics-compat",Yne="@firebase/analytics",Xne="@firebase/app-check-compat",Zne="@firebase/app-check",Jne="@firebase/auth",Qne="@firebase/auth-compat",ere="@firebase/database",tre="@firebase/database-compat",nre="@firebase/functions",rre="@firebase/functions-compat",ire="@firebase/installations",are="@firebase/installations-compat",sre="@firebase/messaging",ore="@firebase/messaging-compat",lre="@firebase/performance",cre="@firebase/performance-compat",ure="@firebase/remote-config",hre="@firebase/remote-config-compat",fre="@firebase/storage",dre="@firebase/storage-compat",pre="@firebase/firestore",mre="@firebase/firestore-compat",gre="firebase",yre="9.23.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y4="[DEFAULT]",_re={[g4]:"fire-core",[Wne]:"fire-core-compat",[Yne]:"fire-analytics",[Kne]:"fire-analytics-compat",[Zne]:"fire-app-check",[Xne]:"fire-app-check-compat",[Jne]:"fire-auth",[Qne]:"fire-auth-compat",[ere]:"fire-rtdb",[tre]:"fire-rtdb-compat",[nre]:"fire-fn",[rre]:"fire-fn-compat",[ire]:"fire-iid",[are]:"fire-iid-compat",[sre]:"fire-fcm",[ore]:"fire-fcm-compat",[lre]:"fire-perf",[cre]:"fire-perf-compat",[ure]:"fire-rc",[hre]:"fire-rc-compat",[fre]:"fire-gcs",[dre]:"fire-gcs-compat",[pre]:"fire-fst",[mre]:"fire-fst-compat","fire-js":"fire-js",[gre]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $A=new Map,_4=new Map;function vre(t,e){try{t.container.addComponent(e)}catch(n){J_.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function $0(t){const e=t.name;if(_4.has(e))return J_.debug(`There were multiple attempts to register component ${e}.`),!1;_4.set(e,t);for(const n of $A.values())vre(n,t);return!0}function WD(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bre={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},wy=new Gw("app","Firebase",bre);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xre{constructor(e,n,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Z_("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw wy.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M1=yre;function iH(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r=Object.assign({name:y4,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw wy.create("bad-app-name",{appName:String(s)});if(n||(n=eH()),!n)throw wy.create("no-options");const l=$A.get(s);if(l){if(VA(n,l.options)&&VA(r,l.config))return l;throw wy.create("duplicate-app",{appName:s})}const f=new Ine(s);for(const x of _4.values())f.addComponent(x);const i=new xre(n,r,f);return $A.set(s,i),i}function aH(t=y4){const e=$A.get(t);if(!e&&t===y4&&eH())return iH();if(!e)throw wy.create("no-app",{appName:t});return e}function Sy(t,e,n){var r;let s=(r=_re[t])!==null&&r!==void 0?r:t;n&&(s+=`-${n}`);const l=s.match(/\s|\//),f=e.match(/\s|\//);if(l||f){const i=[`Unable to register library "${s}" with version "${e}":`];l&&i.push(`library name "${s}" contains illegal characters (whitespace or "/")`),l&&f&&i.push("and"),f&&i.push(`version name "${e}" contains illegal characters (whitespace or "/")`),J_.warn(i.join(" "));return}$0(new Z_(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wre="firebase-heartbeat-database",Sre=1,Ux="firebase-heartbeat-store";let fM=null;function sH(){return fM||(fM=qne(wre,Sre,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(Ux)}}}).catch(t=>{throw wy.create("idb-open",{originalErrorMessage:t.message})})),fM}async function Are(t){try{return await(await sH()).transaction(Ux).objectStore(Ux).get(oH(t))}catch(e){if(e instanceof Sg)J_.warn(e.message);else{const n=wy.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});J_.warn(n.message)}}}async function eB(t,e){try{const r=(await sH()).transaction(Ux,"readwrite");await r.objectStore(Ux).put(e,oH(t)),await r.done}catch(n){if(n instanceof Sg)J_.warn(n.message);else{const r=wy.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});J_.warn(r.message)}}}function oH(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tre=1024,Ere=30*24*60*60*1e3;class Mre{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new Ire(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=tB();if(this._heartbeatsCache===null&&(this._heartbeatsCache=await this._heartbeatsCachePromise),!(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r)))return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(s=>{const l=new Date(s.date).valueOf();return Date.now()-l<=Ere}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache===null||this._heartbeatsCache.heartbeats.length===0)return"";const e=tB(),{heartbeatsToSend:n,unsentEntries:r}=Cre(this._heartbeatsCache.heartbeats),s=qA(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}}function tB(){return new Date().toISOString().substring(0,10)}function Cre(t,e=Tre){const n=[];let r=t.slice();for(const s of t){const l=n.find(f=>f.agent===s.agent);if(l){if(l.dates.push(s.date),nB(n)>e){l.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),nB(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class Ire{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return yne()?_ne().then(()=>!0).catch(()=>!1):!1}async read(){return await this._canUseIndexedDBPromise?await Are(this.app)||{heartbeats:[]}:{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return eB(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return eB(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function nB(t){return qA(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pre(t){$0(new Z_("platform-logger",e=>new Hne(e),"PRIVATE")),$0(new Z_("heartbeat",e=>new Mre(e),"PRIVATE")),Sy(g4,Q6,t),Sy(g4,Q6,"esm2017"),Sy("fire-js","")}Pre("");var Ore="firebase",Rre="9.23.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Sy(Ore,Rre,"app");function KD(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n}function lH(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Dre=lH,cH=new Gw("auth","Firebase",lH());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HA=new HD("@firebase/auth");function Lre(t,...e){HA.logLevel<=hs.WARN&&HA.warn(`Auth (${M1}): ${t}`,...e)}function yA(t,...e){HA.logLevel<=hs.ERROR&&HA.error(`Auth (${M1}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cp(t,...e){throw YD(t,...e)}function bm(t,...e){return YD(t,...e)}function kre(t,e,n){const r=Object.assign(Object.assign({},Dre()),{[e]:n});return new Gw("auth","Firebase",r).create(e,{appName:t.name})}function YD(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return cH.create(t,...e)}function Ji(t,e,...n){if(!t)throw YD(e,...n)}function tg(t){const e="INTERNAL ASSERTION FAILED: "+t;throw yA(e),new Error(e)}function fg(t,e){t||tg(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v4(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function Nre(){return rB()==="http:"||rB()==="https:"}function rB(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zre(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Nre()||pne()||"connection"in navigator)?navigator.onLine:!0}function Bre(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kw{constructor(e,n){this.shortDelay=e,this.longDelay=n,fg(n>e,"Short delay should be less than long delay!"),this.isMobile=dne()||mne()}get(){return zre()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XD(t,e){fg(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uH{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;tg("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;tg("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;tg("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jre={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fre=new Kw(3e4,6e4);function Yw(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function C1(t,e,n,r,s={}){return hH(t,s,async()=>{let l={},f={};r&&(e==="GET"?f=r:l={body:JSON.stringify(r)});const i=Ww(Object.assign({key:t.config.apiKey},f)).slice(1),x=await t._getAdditionalHeaders();return x["Content-Type"]="application/json",t.languageCode&&(x["X-Firebase-Locale"]=t.languageCode),uH.fetch()(fH(t,t.config.apiHost,n,i),Object.assign({method:e,headers:x,referrerPolicy:"no-referrer"},l))})}async function hH(t,e,n){t._canInitEmulator=!1;const r=Object.assign(Object.assign({},jre),e);try{const s=new Ure(t),l=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const f=await l.json();if("needConfirmation"in f)throw FS(t,"account-exists-with-different-credential",f);if(l.ok&&!("errorMessage"in f))return f;{const i=l.ok?f.errorMessage:f.error.message,[x,S]=i.split(" : ");if(x==="FEDERATED_USER_ID_ALREADY_LINKED")throw FS(t,"credential-already-in-use",f);if(x==="EMAIL_EXISTS")throw FS(t,"email-already-in-use",f);if(x==="USER_DISABLED")throw FS(t,"user-disabled",f);const I=r[x]||x.toLowerCase().replace(/[_\s]+/g,"-");if(S)throw kre(t,I,S);Cp(t,I)}}catch(s){if(s instanceof Sg)throw s;Cp(t,"network-request-failed",{message:String(s)})}}async function _5(t,e,n,r,s={}){const l=await C1(t,e,n,r,s);return"mfaPendingCredential"in l&&Cp(t,"multi-factor-auth-required",{_serverResponse:l}),l}function fH(t,e,n,r){const s=`${e}${n}?${r}`;return t.config.emulator?XD(t.config,s):`${t.config.apiScheme}://${s}`}class Ure{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(bm(this.auth,"network-request-failed")),Fre.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function FS(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=bm(t,e,r);return s.customData._tokenResponse=n,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qre(t,e){return C1(t,"POST","/v1/accounts:delete",e)}async function Vre(t,e){return C1(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mx(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function $re(t,e=!1){const n=kc(t),r=await n.getIdToken(e),s=ZD(r);Ji(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const l=typeof s.firebase=="object"?s.firebase:void 0,f=l==null?void 0:l.sign_in_provider;return{claims:s,token:r,authTime:Mx(dM(s.auth_time)),issuedAtTime:Mx(dM(s.iat)),expirationTime:Mx(dM(s.exp)),signInProvider:f||null,signInSecondFactor:(l==null?void 0:l.sign_in_second_factor)||null}}function dM(t){return Number(t)*1e3}function ZD(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return yA("JWT malformed, contained fewer than 3 sections"),null;try{const s=J$(n);return s?JSON.parse(s):(yA("Failed to decode base64 JWT payload"),null)}catch(s){return yA("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function Hre(t){const e=ZD(t);return Ji(e,"internal-error"),Ji(typeof e.exp<"u","internal-error"),Ji(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qx(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Sg&&Gre(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function Gre({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wre{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dH{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Mx(this.lastLoginAt),this.creationTime=Mx(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GA(t){var e;const n=t.auth,r=await t.getIdToken(),s=await qx(t,Vre(n,{idToken:r}));Ji(s==null?void 0:s.users.length,n,"internal-error");const l=s.users[0];t._notifyReloadListener(l);const f=!((e=l.providerUserInfo)===null||e===void 0)&&e.length?Xre(l.providerUserInfo):[],i=Yre(t.providerData,f),x=t.isAnonymous,S=!(t.email&&l.passwordHash)&&!(i!=null&&i.length),I=x?S:!1,R={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:i,metadata:new dH(l.createdAt,l.lastLoginAt),isAnonymous:I};Object.assign(t,R)}async function Kre(t){const e=kc(t);await GA(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Yre(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function Xre(t){return t.map(e=>{var{providerId:n}=e,r=KD(e,["providerId"]);return{providerId:n,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zre(t,e){const n=await hH(t,{},async()=>{const r=Ww({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:l}=t.config,f=fH(t,s,"/v1/token",`key=${l}`),i=await t._getAdditionalHeaders();return i["Content-Type"]="application/x-www-form-urlencoded",uH.fetch()(f,{method:"POST",headers:i,body:r})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vx{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ji(e.idToken,"internal-error"),Ji(typeof e.idToken<"u","internal-error"),Ji(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Hre(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}async getToken(e,n=!1){return Ji(!this.accessToken||this.refreshToken,e,"user-token-expired"),!n&&this.accessToken&&!this.isExpired?this.accessToken:this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:l}=await Zre(e,n);this.updateTokensAndExpiration(r,s,Number(l))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:l}=n,f=new Vx;return r&&(Ji(typeof r=="string","internal-error",{appName:e}),f.refreshToken=r),s&&(Ji(typeof s=="string","internal-error",{appName:e}),f.accessToken=s),l&&(Ji(typeof l=="number","internal-error",{appName:e}),f.expirationTime=l),f}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Vx,this.toJSON())}_performRefresh(){return tg("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sy(t,e){Ji(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class $_{constructor(e){var{uid:n,auth:r,stsTokenManager:s}=e,l=KD(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Wre(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=l.displayName||null,this.email=l.email||null,this.emailVerified=l.emailVerified||!1,this.phoneNumber=l.phoneNumber||null,this.photoURL=l.photoURL||null,this.isAnonymous=l.isAnonymous||!1,this.tenantId=l.tenantId||null,this.providerData=l.providerData?[...l.providerData]:[],this.metadata=new dH(l.createdAt||void 0,l.lastLoginAt||void 0)}async getIdToken(e){const n=await qx(this,this.stsTokenManager.getToken(this.auth,e));return Ji(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return $re(this,e)}reload(){return Kre(this)}_assign(e){this!==e&&(Ji(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new $_(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){Ji(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await GA(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await qx(this,qre(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var r,s,l,f,i,x,S,I;const R=(r=n.displayName)!==null&&r!==void 0?r:void 0,F=(s=n.email)!==null&&s!==void 0?s:void 0,j=(l=n.phoneNumber)!==null&&l!==void 0?l:void 0,H=(f=n.photoURL)!==null&&f!==void 0?f:void 0,G=(i=n.tenantId)!==null&&i!==void 0?i:void 0,W=(x=n._redirectEventId)!==null&&x!==void 0?x:void 0,J=(S=n.createdAt)!==null&&S!==void 0?S:void 0,ie=(I=n.lastLoginAt)!==null&&I!==void 0?I:void 0,{uid:he,emailVerified:ge,isAnonymous:fe,providerData:ye,stsTokenManager:pe}=n;Ji(he&&pe,e,"internal-error");const be=Vx.fromJSON(this.name,pe);Ji(typeof he=="string",e,"internal-error"),sy(R,e.name),sy(F,e.name),Ji(typeof ge=="boolean",e,"internal-error"),Ji(typeof fe=="boolean",e,"internal-error"),sy(j,e.name),sy(H,e.name),sy(G,e.name),sy(W,e.name),sy(J,e.name),sy(ie,e.name);const Ae=new $_({uid:he,auth:e,email:F,emailVerified:ge,displayName:R,isAnonymous:fe,photoURL:H,phoneNumber:j,tenantId:G,stsTokenManager:be,createdAt:J,lastLoginAt:ie});return ye&&Array.isArray(ye)&&(Ae.providerData=ye.map(Oe=>Object.assign({},Oe))),W&&(Ae._redirectEventId=W),Ae}static async _fromIdTokenResponse(e,n,r=!1){const s=new Vx;s.updateFromServerResponse(n);const l=new $_({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await GA(l),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iB=new Map;function ng(t){fg(t instanceof Function,"Expected a class definition");let e=iB.get(t);return e?(fg(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,iB.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pH{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}pH.type="NONE";const aB=pH;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _A(t,e,n){return`firebase:${t}:${e}:${n}`}class I0{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:l}=this.auth;this.fullUserKey=_A(this.userKey,s.apiKey,l),this.fullPersistenceKey=_A("persistence",s.apiKey,l),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?$_._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new I0(ng(aB),e,r);const s=(await Promise.all(n.map(async S=>{if(await S._isAvailable())return S}))).filter(S=>S);let l=s[0]||ng(aB);const f=_A(r,e.config.apiKey,e.name);let i=null;for(const S of n)try{const I=await S._get(f);if(I){const R=$_._fromJSON(e,I);S!==l&&(i=R),l=S;break}}catch{}const x=s.filter(S=>S._shouldAllowMigration);return!l._shouldAllowMigration||!x.length?new I0(l,e,r):(l=x[0],i&&await l._set(f,i.toJSON()),await Promise.all(n.map(async S=>{if(S!==l)try{await S._remove(f)}catch{}})),new I0(l,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sB(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(yH(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(mH(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(vH(e))return"Blackberry";if(bH(e))return"Webos";if(JD(e))return"Safari";if((e.includes("chrome/")||gH(e))&&!e.includes("edge/"))return"Chrome";if(_H(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function mH(t=ph()){return/firefox\//i.test(t)}function JD(t=ph()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function gH(t=ph()){return/crios\//i.test(t)}function yH(t=ph()){return/iemobile/i.test(t)}function _H(t=ph()){return/android/i.test(t)}function vH(t=ph()){return/blackberry/i.test(t)}function bH(t=ph()){return/webos/i.test(t)}function v5(t=ph()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function Jre(t=ph()){var e;return v5(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function Qre(){return gne()&&document.documentMode===10}function xH(t=ph()){return v5(t)||_H(t)||bH(t)||vH(t)||/windows phone/i.test(t)||yH(t)}function eie(){try{return!!(window&&window!==window.top)}catch{return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wH(t,e=[]){let n;switch(t){case"Browser":n=sB(ph());break;case"Worker":n=`${sB(ph())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${M1}/${r}`}async function SH(t,e){return C1(t,"GET","/v2/recaptchaConfig",Yw(t,e))}function oB(t){return t!==void 0&&t.enterprise!==void 0}class AH{constructor(e){if(this.siteKey="",this.emailPasswordEnabled=!1,e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.emailPasswordEnabled=e.recaptchaEnforcementState.some(n=>n.provider==="EMAIL_PASSWORD_PROVIDER"&&n.enforcementState!=="OFF")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tie(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}function TH(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const l=bm("internal-error");l.customData=s,n(l)},r.type="text/javascript",r.charset="UTF-8",tie().appendChild(r)})}function nie(t){return`__${t}${Math.floor(Math.random()*1e6)}`}const rie="https://www.google.com/recaptcha/enterprise.js?render=",iie="recaptcha-enterprise",aie="NO_RECAPTCHA";class EH{constructor(e){this.type=iie,this.auth=Xw(e)}async verify(e="verify",n=!1){async function r(l){if(!n){if(l.tenantId==null&&l._agentRecaptchaConfig!=null)return l._agentRecaptchaConfig.siteKey;if(l.tenantId!=null&&l._tenantRecaptchaConfigs[l.tenantId]!==void 0)return l._tenantRecaptchaConfigs[l.tenantId].siteKey}return new Promise(async(f,i)=>{SH(l,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(x=>{if(x.recaptchaKey===void 0)i(new Error("recaptcha Enterprise site key undefined"));else{const S=new AH(x);return l.tenantId==null?l._agentRecaptchaConfig=S:l._tenantRecaptchaConfigs[l.tenantId]=S,f(S.siteKey)}}).catch(x=>{i(x)})})}function s(l,f,i){const x=window.grecaptcha;oB(x)?x.enterprise.ready(()=>{x.enterprise.execute(l,{action:e}).then(S=>{f(S)}).catch(()=>{f(aie)})}):i(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((l,f)=>{r(this.auth).then(i=>{if(!n&&oB(window.grecaptcha))s(i,l,f);else{if(typeof window>"u"){f(new Error("RecaptchaVerifier is only supported in browser"));return}TH(rie+i).then(()=>{s(i,l,f)}).catch(x=>{f(x)})}}).catch(i=>{f(i)})})}}async function lB(t,e,n,r=!1){const s=new EH(t);let l;try{l=await s.verify(n)}catch{l=await s.verify(n,!0)}const f=Object.assign({},e);return r?Object.assign(f,{captchaResp:l}):Object.assign(f,{captchaResponse:l}),Object.assign(f,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(f,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),f}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sie{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=l=>new Promise((f,i)=>{try{const x=e(l);f(x)}catch(x){i(x)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oie{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new cB(this),this.idTokenSubscription=new cB(this),this.beforeStateQueue=new sie(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=cH,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=ng(n)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await I0.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUser(e){var n;const r=await this.assertedPersistence.getCurrentUser();let s=r,l=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const f=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,i=s==null?void 0:s._redirectEventId,x=await this.tryRedirectSignIn(e);(!f||f===i)&&(x!=null&&x.user)&&(s=x.user,l=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(l)try{await this.beforeStateQueue.runMiddleware(s)}catch(f){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(f))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return Ji(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await GA(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Bre()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const n=e?kc(e):null;return n&&Ji(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Ji(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(ng(e))})}async initializeRecaptchaConfig(){const e=await SH(this,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),n=new AH(e);this.tenantId==null?this._agentRecaptchaConfig=n:this._tenantRecaptchaConfigs[this.tenantId]=n,n.emailPasswordEnabled&&new EH(this).verify()}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Gw("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&ng(e)||this._popupRedirectResolver;Ji(n,this,"argument-error"),this.redirectPersistenceManager=await I0.create(this,[ng(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const l=typeof n=="function"?n:n.next.bind(n),f=this._isInitialized?Promise.resolve():this._initializationPromise;return Ji(f,this,"internal-error"),f.then(()=>l(this.currentUser)),typeof n=="function"?e.addObserver(n,r,s):e.addObserver(n)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ji(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=wH(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(n["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(n["X-Firebase-AppCheck"]=s),n}async _getAppCheckToken(){var e;const n=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return n!=null&&n.error&&Lre(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function Xw(t){return kc(t)}class cB{constructor(e){this.auth=e,this.observer=null,this.addObserver=Sne(n=>this.observer=n)}get next(){return Ji(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lie(t,e){const n=WD(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),l=n.getOptions();if(VA(l,e??{}))return s;Cp(s,"already-initialized")}return n.initialize({options:e})}function cie(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(ng);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function uie(t,e,n){const r=Xw(t);Ji(r._canInitEmulator,r,"emulator-config-failed"),Ji(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,l=MH(e),{host:f,port:i}=hie(e),x=i===null?"":`:${i}`;r.config.emulator={url:`${l}//${f}${x}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:f,port:i,protocol:l.replace(":",""),options:Object.freeze({disableWarnings:s})}),fie()}function MH(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function hie(t){const e=MH(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const l=s[1];return{host:l,port:uB(r.substr(l.length+1))}}else{const[l,f]=r.split(":");return{host:l,port:uB(f)}}}function uB(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function fie(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QD{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return tg("not implemented")}_getIdTokenResponse(e){return tg("not implemented")}_linkToIdToken(e,n){return tg("not implemented")}_getReauthenticationResolver(e){return tg("not implemented")}}async function die(t,e){return C1(t,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pM(t,e){return _5(t,"POST","/v1/accounts:signInWithPassword",Yw(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pie(t,e){return _5(t,"POST","/v1/accounts:signInWithEmailLink",Yw(t,e))}async function mie(t,e){return _5(t,"POST","/v1/accounts:signInWithEmailLink",Yw(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $x extends QD{constructor(e,n,r,s=null){super("password",r),this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new $x(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new $x(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){var n;switch(this.signInMethod){case"password":const r={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};if(!((n=e._getRecaptchaConfig())===null||n===void 0)&&n.emailPasswordEnabled){const s=await lB(e,r,"signInWithPassword");return pM(e,s)}else return pM(e,r).catch(async s=>{if(s.code==="auth/missing-recaptcha-token"){console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const l=await lB(e,r,"signInWithPassword");return pM(e,l)}else return Promise.reject(s)});case"emailLink":return pie(e,{email:this._email,oobCode:this._password});default:Cp(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":return die(e,{idToken:n,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return mie(e,{idToken:n,email:this._email,oobCode:this._password});default:Cp(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function P0(t,e){return _5(t,"POST","/v1/accounts:signInWithIdp",Yw(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gie="http://localhost";class Q_ extends QD{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Q_(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):Cp("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=n,l=KD(n,["providerId","signInMethod"]);if(!r||!s)return null;const f=new Q_(r,s);return f.idToken=l.idToken||void 0,f.accessToken=l.accessToken||void 0,f.secret=l.secret,f.nonce=l.nonce,f.pendingToken=l.pendingToken||null,f}_getIdTokenResponse(e){const n=this.buildRequest();return P0(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,P0(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,P0(e,n)}buildRequest(){const e={requestUri:gie,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Ww(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yie(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function _ie(t){const e=gx(yx(t)).link,n=e?gx(yx(e)).deep_link_id:null,r=gx(yx(t)).deep_link_id;return(r?gx(yx(r)).link:null)||r||n||e||t}class eL{constructor(e){var n,r,s,l,f,i;const x=gx(yx(e)),S=(n=x.apiKey)!==null&&n!==void 0?n:null,I=(r=x.oobCode)!==null&&r!==void 0?r:null,R=yie((s=x.mode)!==null&&s!==void 0?s:null);Ji(S&&I&&R,"argument-error"),this.apiKey=S,this.operation=R,this.code=I,this.continueUrl=(l=x.continueUrl)!==null&&l!==void 0?l:null,this.languageCode=(f=x.languageCode)!==null&&f!==void 0?f:null,this.tenantId=(i=x.tenantId)!==null&&i!==void 0?i:null}static parseLink(e){const n=_ie(e);try{return new eL(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I1{constructor(){this.providerId=I1.PROVIDER_ID}static credential(e,n){return $x._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=eL.parseLink(n);return Ji(r,"argument-error"),$x._fromEmailAndCode(e,r.code,r.tenantId)}}I1.PROVIDER_ID="password";I1.EMAIL_PASSWORD_SIGN_IN_METHOD="password";I1.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CH{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zw extends CH{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fy extends Zw{constructor(){super("facebook.com")}static credential(e){return Q_._fromParams({providerId:fy.PROVIDER_ID,signInMethod:fy.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return fy.credentialFromTaggedObject(e)}static credentialFromError(e){return fy.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return fy.credential(e.oauthAccessToken)}catch{return null}}}fy.FACEBOOK_SIGN_IN_METHOD="facebook.com";fy.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dy extends Zw{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Q_._fromParams({providerId:dy.PROVIDER_ID,signInMethod:dy.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return dy.credentialFromTaggedObject(e)}static credentialFromError(e){return dy.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return dy.credential(n,r)}catch{return null}}}dy.GOOGLE_SIGN_IN_METHOD="google.com";dy.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class py extends Zw{constructor(){super("github.com")}static credential(e){return Q_._fromParams({providerId:py.PROVIDER_ID,signInMethod:py.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return py.credentialFromTaggedObject(e)}static credentialFromError(e){return py.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return py.credential(e.oauthAccessToken)}catch{return null}}}py.GITHUB_SIGN_IN_METHOD="github.com";py.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class my extends Zw{constructor(){super("twitter.com")}static credential(e,n){return Q_._fromParams({providerId:my.PROVIDER_ID,signInMethod:my.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return my.credentialFromTaggedObject(e)}static credentialFromError(e){return my.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return my.credential(n,r)}catch{return null}}}my.TWITTER_SIGN_IN_METHOD="twitter.com";my.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H0{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const l=await $_._fromIdTokenResponse(e,r,s),f=hB(r);return new H0({user:l,providerId:f,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=hB(r);return new H0({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function hB(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WA extends Sg{constructor(e,n,r,s){var l;super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,WA.prototype),this.customData={appName:e.name,tenantId:(l=e.tenantId)!==null&&l!==void 0?l:void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new WA(e,n,r,s)}}function IH(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(l=>{throw l.code==="auth/multi-factor-auth-required"?WA._fromErrorAndOperation(t,l,e,r):l})}async function vie(t,e,n=!1){const r=await qx(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return H0._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bie(t,e,n=!1){const{auth:r}=t,s="reauthenticate";try{const l=await qx(t,IH(r,s,e,t),n);Ji(l.idToken,r,"internal-error");const f=ZD(l.idToken);Ji(f,r,"internal-error");const{sub:i}=f;return Ji(t.uid===i,r,"user-mismatch"),H0._forOperation(t,s,l)}catch(l){throw(l==null?void 0:l.code)==="auth/user-not-found"&&Cp(r,"user-mismatch"),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function PH(t,e,n=!1){const r="signIn",s=await IH(t,r,e),l=await H0._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(l.user),l}async function xie(t,e){return PH(Xw(t),e)}function wie(t,e,n){return xie(kc(t),I1.credential(e,n))}function Sie(t,e,n,r){return kc(t).onIdTokenChanged(e,n,r)}function Aie(t,e,n){return kc(t).beforeAuthStateChanged(e,n)}const KA="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OH{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(KA,"1"),this.storage.removeItem(KA),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tie(){const t=ph();return JD(t)||v5(t)}const Eie=1e3,Mie=10;class RH extends OH{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=Tie()&&eie(),this.fallbackToPolling=xH(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((f,i,x)=>{this.notifyListeners(f,x)});return}const r=e.key;if(n?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const f=this.storage.getItem(r);if(e.newValue!==f)e.newValue!==null?this.storage.setItem(r,e.newValue):this.storage.removeItem(r);else if(this.localCache[r]===e.newValue&&!n)return}const s=()=>{const f=this.storage.getItem(r);!n&&this.localCache[r]===f||this.notifyListeners(r,f)},l=this.storage.getItem(r);Qre()&&l!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,Mie):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},Eie)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}RH.type="LOCAL";const Cie=RH;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DH extends OH{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}DH.type="SESSION";const LH=DH;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Iie(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b5{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new b5(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:l}=n.data,f=this.handlersMap[s];if(!(f!=null&&f.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const i=Array.from(f).map(async S=>S(n.origin,l)),x=await Iie(i);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:x})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}b5.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tL(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pie{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let l,f;return new Promise((i,x)=>{const S=tL("",20);s.port1.start();const I=setTimeout(()=>{x(new Error("unsupported_event"))},r);f={messageChannel:s,onMessage(R){const F=R;if(F.data.eventId===S)switch(F.data.status){case"ack":clearTimeout(I),l=setTimeout(()=>{x(new Error("timeout"))},3e3);break;case"done":clearTimeout(l),i(F.data.response);break;default:clearTimeout(I),clearTimeout(l),x(new Error("invalid_response"));break}}},this.handlers.add(f),s.port1.addEventListener("message",f.onMessage),this.target.postMessage({eventType:e,eventId:S,data:n},[s.port2])}).finally(()=>{f&&this.removeMessageHandler(f)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xm(){return window}function Oie(t){xm().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kH(){return typeof xm().WorkerGlobalScope<"u"&&typeof xm().importScripts=="function"}async function Rie(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Die(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function Lie(){return kH()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NH="firebaseLocalStorageDb",kie=1,YA="firebaseLocalStorage",zH="fbase_key";class Jw{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function x5(t,e){return t.transaction([YA],e?"readwrite":"readonly").objectStore(YA)}function Nie(){const t=indexedDB.deleteDatabase(NH);return new Jw(t).toPromise()}function b4(){const t=indexedDB.open(NH,kie);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(YA,{keyPath:zH})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(YA)?e(r):(r.close(),await Nie(),e(await b4()))})})}async function fB(t,e,n){const r=x5(t,!0).put({[zH]:e,value:n});return new Jw(r).toPromise()}async function zie(t,e){const n=x5(t,!1).get(e),r=await new Jw(n).toPromise();return r===void 0?null:r.value}function dB(t,e){const n=x5(t,!0).delete(e);return new Jw(n).toPromise()}const Bie=800,jie=3;class BH{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await b4(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>jie)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return kH()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=b5._getInstance(Lie()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var e,n;if(this.activeServiceWorker=await Rie(),!this.activeServiceWorker)return;this.sender=new Pie(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((n=r[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Die()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await b4();return await fB(e,KA,"1"),await dB(e,KA),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>fB(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>zie(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>dB(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const l=x5(s,!1).getAll();return new Jw(l).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;for(const{fbase_key:s,value:l}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(l)&&(this.notifyListeners(s,l),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Bie)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}BH.type="LOCAL";const Fie=BH;new Kw(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uie(t,e){return e?ng(e):(Ji(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nL extends QD{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return P0(e,this._buildIdpRequest())}_linkToIdToken(e,n){return P0(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return P0(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function qie(t){return PH(t.auth,new nL(t),t.bypassAuthState)}function Vie(t){const{auth:e,user:n}=t;return Ji(n,e,"internal-error"),bie(n,new nL(t),t.bypassAuthState)}async function $ie(t){const{auth:e,user:n}=t;return Ji(n,e,"internal-error"),vie(n,new nL(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jH{constructor(e,n,r,s,l=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=l,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:l,error:f,type:i}=e;if(f){this.reject(f);return}const x={auth:this.auth,requestUri:n,sessionId:r,tenantId:l||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(i)(x))}catch(S){this.reject(S)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return qie;case"linkViaPopup":case"linkViaRedirect":return $ie;case"reauthViaPopup":case"reauthViaRedirect":return Vie;default:Cp(this.auth,"internal-error")}}resolve(e){fg(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){fg(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hie=new Kw(2e3,1e4);class v0 extends jH{constructor(e,n,r,s,l){super(e,n,s,l),this.provider=r,this.authWindow=null,this.pollId=null,v0.currentPopupAction&&v0.currentPopupAction.cancel(),v0.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ji(e,this.auth,"internal-error"),e}async onExecution(){fg(this.filter.length===1,"Popup operations only handle one event");const e=tL();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(bm(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(bm(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,v0.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if(!((r=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(bm(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Hie.get())};e()}}v0.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gie="pendingRedirect",vA=new Map;class Wie extends jH{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=vA.get(this.auth._key());if(!e){try{const r=await Kie(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}vA.set(this.auth._key(),e)}return this.bypassAuthState||vA.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Kie(t,e){const n=Zie(e),r=Xie(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function Yie(t,e){vA.set(t._key(),e)}function Xie(t){return ng(t._redirectPersistence)}function Zie(t){return _A(Gie,t.config.apiKey,t.name)}async function Jie(t,e,n=!1){const r=Xw(t),s=Uie(r,e),f=await new Wie(r,s,n).execute();return f&&!n&&(delete f.user._redirectEventId,await r._persistUserIfCurrent(f.user),await r._setRedirectUser(null,e)),f}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qie=10*60*1e3;class eae{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!tae(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!FH(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";n.onError(bm(this.auth,s))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Qie&&this.cachedEventUids.clear(),this.cachedEventUids.has(pB(e))}saveEventToCache(e){this.cachedEventUids.add(pB(e)),this.lastProcessedEventTime=Date.now()}}function pB(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function FH({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function tae(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return FH(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nae(t,e={}){return C1(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rae=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,iae=/^https?/;async function aae(t){if(t.config.emulator)return;const{authorizedDomains:e}=await nae(t);for(const n of e)try{if(sae(n))return}catch{}Cp(t,"unauthorized-domain")}function sae(t){const e=v4(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const f=new URL(t);return f.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&f.hostname===r}if(!iae.test(n))return!1;if(rae.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oae=new Kw(3e4,6e4);function mB(){const t=xm().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function lae(t){return new Promise((e,n)=>{var r,s,l;function f(){mB(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{mB(),n(bm(t,"network-request-failed"))},timeout:oae.get()})}if(!((s=(r=xm().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((l=xm().gapi)===null||l===void 0)&&l.load)f();else{const i=nie("iframefcb");return xm()[i]=()=>{gapi.load?f():n(bm(t,"network-request-failed"))},TH(`https://apis.google.com/js/api.js?onload=${i}`).catch(x=>n(x))}}).catch(e=>{throw bA=null,e})}let bA=null;function cae(t){return bA=bA||lae(t),bA}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uae=new Kw(5e3,15e3),hae="__/auth/iframe",fae="emulator/auth/iframe",dae={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},pae=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function mae(t){const e=t.config;Ji(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?XD(e,fae):`https://${t.config.authDomain}/${hae}`,r={apiKey:e.apiKey,appName:t.name,v:M1},s=pae.get(t.config.apiHost);s&&(r.eid=s);const l=t._getFrameworks();return l.length&&(r.fw=l.join(",")),`${n}?${Ww(r).slice(1)}`}async function gae(t){const e=await cae(t),n=xm().gapi;return Ji(n,t,"internal-error"),e.open({where:document.body,url:mae(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:dae,dontclear:!0},r=>new Promise(async(s,l)=>{await r.restyle({setHideOnLeave:!1});const f=bm(t,"network-request-failed"),i=xm().setTimeout(()=>{l(f)},uae.get());function x(){xm().clearTimeout(i),s(r)}r.ping(x).then(x,()=>{l(f)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yae={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},_ae=500,vae=600,bae="_blank",xae="http://localhost";class gB{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function wae(t,e,n,r=_ae,s=vae){const l=Math.max((window.screen.availHeight-s)/2,0).toString(),f=Math.max((window.screen.availWidth-r)/2,0).toString();let i="";const x=Object.assign(Object.assign({},yae),{width:r.toString(),height:s.toString(),top:l,left:f}),S=ph().toLowerCase();n&&(i=gH(S)?bae:n),mH(S)&&(e=e||xae,x.scrollbars="yes");const I=Object.entries(x).reduce((F,[j,H])=>`${F}${j}=${H},`,"");if(Jre(S)&&i!=="_self")return Sae(e||"",i),new gB(null);const R=window.open(e||"",i,I);Ji(R,t,"popup-blocked");try{R.focus()}catch{}return new gB(R)}function Sae(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Aae="__/auth/handler",Tae="emulator/auth/handler",Eae=encodeURIComponent("fac");async function yB(t,e,n,r,s,l){Ji(t.config.authDomain,t,"auth-domain-config-required"),Ji(t.config.apiKey,t,"invalid-api-key");const f={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:M1,eventId:s};if(e instanceof CH){e.setDefaultLanguage(t.languageCode),f.providerId=e.providerId||"",wne(e.getCustomParameters())||(f.customParameters=JSON.stringify(e.getCustomParameters()));for(const[I,R]of Object.entries({}))f[I]=R}if(e instanceof Zw){const I=e.getScopes().filter(R=>R!=="");I.length>0&&(f.scopes=I.join(","))}t.tenantId&&(f.tid=t.tenantId);const i=f;for(const I of Object.keys(i))i[I]===void 0&&delete i[I];const x=await t._getAppCheckToken(),S=x?`#${Eae}=${encodeURIComponent(x)}`:"";return`${Mae(t)}?${Ww(i).slice(1)}${S}`}function Mae({config:t}){return t.emulator?XD(t,Tae):`https://${t.authDomain}/${Aae}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mM="webStorageSupport";class Cae{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=LH,this._completeRedirectFn=Jie,this._overrideRedirectResult=Yie}async _openPopup(e,n,r,s){var l;fg((l=this.eventManagers[e._key()])===null||l===void 0?void 0:l.manager,"_initialize() not called before _openPopup()");const f=await yB(e,n,r,v4(),s);return wae(e,f,tL())}async _openRedirect(e,n,r,s){await this._originValidation(e);const l=await yB(e,n,r,v4(),s);return Oie(l),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:l}=this.eventManagers[n];return s?Promise.resolve(s):(fg(l,"If manager is not set, promise should be"),l)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await gae(e),r=new eae(e);return n.register("authEvent",s=>(Ji(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(mM,{type:mM},s=>{var l;const f=(l=s==null?void 0:s[0])===null||l===void 0?void 0:l[mM];f!==void 0&&n(!!f),Cp(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=aae(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return xH()||JD()||v5()}}const Iae=Cae;var _B="@firebase/auth",vB="0.23.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pae{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Ji(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oae(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}function Rae(t){$0(new Z_("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),l=e.getProvider("app-check-internal"),{apiKey:f,authDomain:i}=r.options;Ji(f&&!f.includes(":"),"invalid-api-key",{appName:r.name});const x={apiKey:f,authDomain:i,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:wH(t)},S=new oie(r,s,l,x);return cie(S,n),S},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),$0(new Z_("auth-internal",e=>{const n=Xw(e.getProvider("auth").getImmediate());return(r=>new Pae(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Sy(_B,vB,Oae(t)),Sy(_B,vB,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dae=5*60,Lae=tH("authIdTokenMaxAge")||Dae;let bB=null;const kae=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>Lae)return;const s=n==null?void 0:n.token;bB!==s&&(bB=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function Nae(t=aH()){const e=WD(t,"auth");if(e.isInitialized())return e.getImmediate();const n=lie(t,{popupRedirectResolver:Iae,persistence:[Fie,Cie,LH]}),r=tH("authTokenSyncURL");if(r){const l=kae(r);Aie(n,l,()=>l(n.currentUser)),Sie(n,f=>l(f))}const s=Q$("auth");return s&&uie(n,`http://${s}`),n}Rae("Browser");var zae=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ur,rL=rL||{},ia=zae||self;function w5(t){var e=typeof t;return e=e!="object"?e:t?Array.isArray(t)?"array":e:"null",e=="array"||e=="object"&&typeof t.length=="number"}function S5(t){var e=typeof t;return e=="object"&&t!=null||e=="function"}function Bae(t,e,n){return t.call.apply(t.bind,arguments)}function jae(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var s=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(s,r),t.apply(e,s)}}return function(){return t.apply(e,arguments)}}function hh(t,e,n){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?hh=Bae:hh=jae,hh.apply(null,arguments)}function US(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var r=n.slice();return r.push.apply(r,arguments),t.apply(this,r)}}function nu(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(r,s,l){for(var f=Array(arguments.length-2),i=2;i<arguments.length;i++)f[i-2]=arguments[i];return e.prototype[s].apply(r,f)}}function Oy(){this.s=this.s,this.o=this.o}var Fae=0;Oy.prototype.s=!1;Oy.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),Fae!=0)};Oy.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const UH=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(typeof t=="string")return typeof e!="string"||e.length!=1?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function iL(t){const e=t.length;if(0<e){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function xB(t,e){for(let n=1;n<arguments.length;n++){const r=arguments[n];if(w5(r)){const s=t.length||0,l=r.length||0;t.length=s+l;for(let f=0;f<l;f++)t[s+f]=r[f]}else t.push(r)}}function fh(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}fh.prototype.h=function(){this.defaultPrevented=!0};var Uae=function(){if(!ia.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{ia.addEventListener("test",()=>{},e),ia.removeEventListener("test",()=>{},e)}catch{}return t}();function Hx(t){return/^[\s\xa0]*$/.test(t)}function A5(){var t=ia.navigator;return t&&(t=t.userAgent)?t:""}function pm(t){return A5().indexOf(t)!=-1}function aL(t){return aL[" "](t),t}aL[" "]=function(){};function qae(t,e){var n=kse;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}var Vae=pm("Opera"),G0=pm("Trident")||pm("MSIE"),qH=pm("Edge"),x4=qH||G0,VH=pm("Gecko")&&!(A5().toLowerCase().indexOf("webkit")!=-1&&!pm("Edge"))&&!(pm("Trident")||pm("MSIE"))&&!pm("Edge"),$ae=A5().toLowerCase().indexOf("webkit")!=-1&&!pm("Edge");function $H(){var t=ia.document;return t?t.documentMode:void 0}var w4;e:{var gM="",yM=function(){var t=A5();if(VH)return/rv:([^\);]+)(\)|;)/.exec(t);if(qH)return/Edge\/([\d\.]+)/.exec(t);if(G0)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(t);if($ae)return/WebKit\/(\S+)/.exec(t);if(Vae)return/(?:Version)[ \/]?(\S+)/.exec(t)}();if(yM&&(gM=yM?yM[1]:""),G0){var _M=$H();if(_M!=null&&_M>parseFloat(gM)){w4=String(_M);break e}}w4=gM}var S4;if(ia.document&&G0){var wB=$H();S4=wB||parseInt(w4,10)||void 0}else S4=void 0;var Hae=S4;function Gx(t,e){if(fh.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(VH){e:{try{aL(e.nodeName);var s=!0;break e}catch{}s=!1}s||(e=null)}}else n=="mouseover"?e=t.fromElement:n=="mouseout"&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=t.clientX!==void 0?t.clientX:t.pageX,this.clientY=t.clientY!==void 0?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=typeof t.pointerType=="string"?t.pointerType:Gae[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Gx.$.h.call(this)}}nu(Gx,fh);var Gae={2:"touch",3:"pen",4:"mouse"};Gx.prototype.h=function(){Gx.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var T5="closure_listenable_"+(1e6*Math.random()|0),Wae=0;function Kae(t,e,n,r,s){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.la=s,this.key=++Wae,this.fa=this.ia=!1}function E5(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function sL(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function Yae(t,e){for(const n in t)e.call(void 0,t[n],n,t)}function HH(t){const e={};for(const n in t)e[n]=t[n];return e}const SB="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function GH(t,e){let n,r;for(let s=1;s<arguments.length;s++){r=arguments[s];for(n in r)t[n]=r[n];for(let l=0;l<SB.length;l++)n=SB[l],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function M5(t){this.src=t,this.g={},this.h=0}M5.prototype.add=function(t,e,n,r,s){var l=t.toString();t=this.g[l],t||(t=this.g[l]=[],this.h++);var f=T4(t,e,r,s);return-1<f?(e=t[f],n||(e.ia=!1)):(e=new Kae(e,this.src,l,!!r,s),e.ia=n,t.push(e)),e};function A4(t,e){var n=e.type;if(n in t.g){var r=t.g[n],s=UH(r,e),l;(l=0<=s)&&Array.prototype.splice.call(r,s,1),l&&(E5(e),t.g[n].length==0&&(delete t.g[n],t.h--))}}function T4(t,e,n,r){for(var s=0;s<t.length;++s){var l=t[s];if(!l.fa&&l.listener==e&&l.capture==!!n&&l.la==r)return s}return-1}var oL="closure_lm_"+(1e6*Math.random()|0),vM={};function WH(t,e,n,r,s){if(Array.isArray(e)){for(var l=0;l<e.length;l++)WH(t,e[l],n,r,s);return null}return n=XH(n),t&&t[T5]?t.O(e,n,S5(r)?!!r.capture:!1,s):Xae(t,e,n,!1,r,s)}function Xae(t,e,n,r,s,l){if(!e)throw Error("Invalid event type");var f=S5(s)?!!s.capture:!!s,i=cL(t);if(i||(t[oL]=i=new M5(t)),n=i.add(e,n,r,f,l),n.proxy)return n;if(r=Zae(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)Uae||(s=f),s===void 0&&(s=!1),t.addEventListener(e.toString(),r,s);else if(t.attachEvent)t.attachEvent(YH(e.toString()),r);else if(t.addListener&&t.removeListener)t.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function Zae(){function t(n){return e.call(t.src,t.listener,n)}const e=Jae;return t}function KH(t,e,n,r,s){if(Array.isArray(e))for(var l=0;l<e.length;l++)KH(t,e[l],n,r,s);else r=S5(r)?!!r.capture:!!r,n=XH(n),t&&t[T5]?(t=t.i,e=String(e).toString(),e in t.g&&(l=t.g[e],n=T4(l,n,r,s),-1<n&&(E5(l[n]),Array.prototype.splice.call(l,n,1),l.length==0&&(delete t.g[e],t.h--)))):t&&(t=cL(t))&&(e=t.g[e.toString()],t=-1,e&&(t=T4(e,n,r,s)),(n=-1<t?e[t]:null)&&lL(n))}function lL(t){if(typeof t!="number"&&t&&!t.fa){var e=t.src;if(e&&e[T5])A4(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(YH(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=cL(e))?(A4(n,t),n.h==0&&(n.src=null,e[oL]=null)):E5(t)}}}function YH(t){return t in vM?vM[t]:vM[t]="on"+t}function Jae(t,e){if(t.fa)t=!0;else{e=new Gx(e,this);var n=t.listener,r=t.la||t.src;t.ia&&lL(t),t=n.call(r,e)}return t}function cL(t){return t=t[oL],t instanceof M5?t:null}var bM="__closure_events_fn_"+(1e9*Math.random()>>>0);function XH(t){return typeof t=="function"?t:(t[bM]||(t[bM]=function(e){return t.handleEvent(e)}),t[bM])}function tu(){Oy.call(this),this.i=new M5(this),this.S=this,this.J=null}nu(tu,Oy);tu.prototype[T5]=!0;tu.prototype.removeEventListener=function(t,e,n,r){KH(this,t,e,n,r)};function Cu(t,e){var n,r=t.J;if(r)for(n=[];r;r=r.J)n.push(r);if(t=t.S,r=e.type||e,typeof e=="string")e=new fh(e,t);else if(e instanceof fh)e.target=e.target||t;else{var s=e;e=new fh(r,t),GH(e,s)}if(s=!0,n)for(var l=n.length-1;0<=l;l--){var f=e.g=n[l];s=qS(f,r,!0,e)&&s}if(f=e.g=t,s=qS(f,r,!0,e)&&s,s=qS(f,r,!1,e)&&s,n)for(l=0;l<n.length;l++)f=e.g=n[l],s=qS(f,r,!1,e)&&s}tu.prototype.N=function(){if(tu.$.N.call(this),this.i){var t=this.i,e;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)E5(n[r]);delete t.g[e],t.h--}}this.J=null};tu.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)};tu.prototype.P=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};function qS(t,e,n,r){if(e=t.i.g[String(e)],!e)return!0;e=e.concat();for(var s=!0,l=0;l<e.length;++l){var f=e[l];if(f&&!f.fa&&f.capture==n){var i=f.listener,x=f.la||f.src;f.ia&&A4(t.i,f),s=i.call(x,r)!==!1&&s}}return s&&!r.defaultPrevented}var uL=ia.JSON.stringify;class Qae{constructor(e,n){this.i=e,this.j=n,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}function ese(){var t=hL;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}class tse{constructor(){this.h=this.g=null}add(e,n){const r=ZH.get();r.set(e,n),this.h?this.h.next=r:this.g=r,this.h=r}}var ZH=new Qae(()=>new nse,t=>t.reset());class nse{constructor(){this.next=this.g=this.h=null}set(e,n){this.h=e,this.g=n,this.next=null}reset(){this.next=this.g=this.h=null}}function rse(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function ise(t){ia.setTimeout(()=>{throw t},0)}let Wx,Kx=!1,hL=new tse,JH=()=>{const t=ia.Promise.resolve(void 0);Wx=()=>{t.then(ase)}};var ase=()=>{for(var t;t=ese();){try{t.h.call(t.g)}catch(n){ise(n)}var e=ZH;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Kx=!1};function C5(t,e){tu.call(this),this.h=t||1,this.g=e||ia,this.j=hh(this.qb,this),this.l=Date.now()}nu(C5,tu);Ur=C5.prototype;Ur.ga=!1;Ur.T=null;Ur.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Cu(this,"tick"),this.ga&&(fL(this),this.start()))}};Ur.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function fL(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}Ur.N=function(){C5.$.N.call(this),fL(this),delete this.g};function dL(t,e,n){if(typeof t=="function")n&&(t=hh(t,n));else if(t&&typeof t.handleEvent=="function")t=hh(t.handleEvent,t);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:ia.setTimeout(t,e||0)}function QH(t){t.g=dL(()=>{t.g=null,t.i&&(t.i=!1,QH(t))},t.j);const e=t.h;t.h=null,t.m.apply(null,e)}class sse extends Oy{constructor(e,n){super(),this.m=e,this.j=n,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:QH(this)}N(){super.N(),this.g&&(ia.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Yx(t){Oy.call(this),this.h=t,this.g={}}nu(Yx,Oy);var AB=[];function eG(t,e,n,r){Array.isArray(n)||(n&&(AB[0]=n.toString()),n=AB);for(var s=0;s<n.length;s++){var l=WH(e,n[s],r||t.handleEvent,!1,t.h||t);if(!l)break;t.g[l.key]=l}}function tG(t){sL(t.g,function(e,n){this.g.hasOwnProperty(n)&&lL(e)},t),t.g={}}Yx.prototype.N=function(){Yx.$.N.call(this),tG(this)};Yx.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function I5(){this.g=!0}I5.prototype.Ea=function(){this.g=!1};function ose(t,e,n,r,s,l){t.info(function(){if(t.g)if(l)for(var f="",i=l.split("&"),x=0;x<i.length;x++){var S=i[x].split("=");if(1<S.length){var I=S[0];S=S[1];var R=I.split("_");f=2<=R.length&&R[1]=="type"?f+(I+"="+S+"&"):f+(I+"=redacted&")}}else f=null;else f=l;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+e+`
`+n+`
`+f})}function lse(t,e,n,r,s,l,f){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+e+`
`+n+`
`+l+" "+f})}function b0(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+use(t,n)+(r?" "+r:"")})}function cse(t,e){t.info(function(){return"TIMEOUT: "+e})}I5.prototype.info=function(){};function use(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n){for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var l=s[0];if(l!="noop"&&l!="stop"&&l!="close")for(var f=1;f<s.length;f++)s[f]=""}}}}return uL(n)}catch{return e}}var hv={},TB=null;function P5(){return TB=TB||new tu}hv.Ta="serverreachability";function nG(t){fh.call(this,hv.Ta,t)}nu(nG,fh);function Xx(t){const e=P5();Cu(e,new nG(e))}hv.STAT_EVENT="statevent";function rG(t,e){fh.call(this,hv.STAT_EVENT,t),this.stat=e}nu(rG,fh);function Gh(t){const e=P5();Cu(e,new rG(e,t))}hv.Ua="timingevent";function iG(t,e){fh.call(this,hv.Ua,t),this.size=e}nu(iG,fh);function Qw(t,e){if(typeof t!="function")throw Error("Fn must not be null and must be a function");return ia.setTimeout(function(){t()},e)}var O5={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},aG={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function pL(){}pL.prototype.h=null;function EB(t){return t.h||(t.h=t.i())}function sG(){}var e2={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function mL(){fh.call(this,"d")}nu(mL,fh);function gL(){fh.call(this,"c")}nu(gL,fh);var E4;function R5(){}nu(R5,pL);R5.prototype.g=function(){return new XMLHttpRequest};R5.prototype.i=function(){return{}};E4=new R5;function t2(t,e,n,r){this.l=t,this.j=e,this.m=n,this.W=r||1,this.U=new Yx(this),this.P=hse,t=x4?125:void 0,this.V=new C5(t),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new oG}function oG(){this.i=null,this.g="",this.h=!1}var hse=45e3,M4={},XA={};Ur=t2.prototype;Ur.setTimeout=function(t){this.P=t};function C4(t,e,n){t.L=1,t.v=L5(dg(e)),t.s=n,t.S=!0,lG(t,null)}function lG(t,e){t.G=Date.now(),n2(t),t.A=dg(t.v);var n=t.A,r=t.W;Array.isArray(r)||(r=[String(r)]),gG(n.i,"t",r),t.C=0,n=t.l.J,t.h=new oG,t.g=zG(t.l,n?e:null,!t.s),0<t.O&&(t.M=new sse(hh(t.Pa,t,t.g),t.O)),eG(t.U,t.g,"readystatechange",t.nb),e=t.I?HH(t.I):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.A,t.u,t.s,e)):(t.u="GET",t.g.ha(t.A,t.u,null,e)),Xx(),ose(t.j,t.u,t.A,t.m,t.W,t.s)}Ur.nb=function(t){t=t.target;const e=this.M;e&&mm(t)==3?e.l():this.Pa(t)};Ur.Pa=function(t){try{if(t==this.g)e:{const I=mm(this.g);var e=this.g.Ia();const R=this.g.da();if(!(3>I)&&(I!=3||x4||this.g&&(this.h.h||this.g.ja()||PB(this.g)))){this.J||I!=4||e==7||(e==8||0>=R?Xx(3):Xx(2)),D5(this);var n=this.g.da();this.ca=n;t:if(cG(this)){var r=PB(this.g);t="";var s=r.length,l=mm(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){k_(this),Cx(this);var f="";break t}this.h.i=new ia.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:l&&e==s-1});r.splice(0,s),this.h.g+=t,this.C=0,f=this.h.g}else f=this.g.ja();if(this.i=n==200,lse(this.j,this.u,this.A,this.m,this.W,I,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var i,x=this.g;if((i=x.g?x.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Hx(i)){var S=i;break t}}S=null}if(n=S)b0(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,I4(this,n);else{this.i=!1,this.o=3,Gh(12),k_(this),Cx(this);break e}}this.S?(uG(this,I,f),x4&&this.i&&I==3&&(eG(this.U,this.V,"tick",this.mb),this.V.start())):(b0(this.j,this.m,f,null),I4(this,f)),I==4&&k_(this),this.i&&!this.J&&(I==4?DG(this.l,this):(this.i=!1,n2(this)))}else Rse(this.g),n==400&&0<f.indexOf("Unknown SID")?(this.o=3,Gh(12)):(this.o=0,Gh(13)),k_(this),Cx(this)}}}catch{}finally{}};function cG(t){return t.g?t.u=="GET"&&t.L!=2&&t.l.Ha:!1}function uG(t,e,n){let r=!0,s;for(;!t.J&&t.C<n.length;)if(s=fse(t,n),s==XA){e==4&&(t.o=4,Gh(14),r=!1),b0(t.j,t.m,null,"[Incomplete Response]");break}else if(s==M4){t.o=4,Gh(15),b0(t.j,t.m,n,"[Invalid Chunk]"),r=!1;break}else b0(t.j,t.m,s,null),I4(t,s);cG(t)&&s!=XA&&s!=M4&&(t.h.g="",t.C=0),e!=4||n.length!=0||t.h.h||(t.o=1,Gh(16),r=!1),t.i=t.i&&r,r?0<n.length&&!t.ba&&(t.ba=!0,e=t.l,e.g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),wL(e),e.M=!0,Gh(11))):(b0(t.j,t.m,n,"[Invalid Chunked Response]"),k_(t),Cx(t))}Ur.mb=function(){if(this.g){var t=mm(this.g),e=this.g.ja();this.C<e.length&&(D5(this),uG(this,t,e),this.i&&t!=4&&n2(this))}};function fse(t,e){var n=t.C,r=e.indexOf(`
`,n);return r==-1?XA:(n=Number(e.substring(n,r)),isNaN(n)?M4:(r+=1,r+n>e.length?XA:(e=e.slice(r,r+n),t.C=r+n,e)))}Ur.cancel=function(){this.J=!0,k_(this)};function n2(t){t.Y=Date.now()+t.P,hG(t,t.P)}function hG(t,e){if(t.B!=null)throw Error("WatchDog timer not null");t.B=Qw(hh(t.lb,t),e)}function D5(t){t.B&&(ia.clearTimeout(t.B),t.B=null)}Ur.lb=function(){this.B=null;const t=Date.now();0<=t-this.Y?(cse(this.j,this.A),this.L!=2&&(Xx(),Gh(17)),k_(this),this.o=2,Cx(this)):hG(this,this.Y-t)};function Cx(t){t.l.H==0||t.J||DG(t.l,t)}function k_(t){D5(t);var e=t.M;e&&typeof e.sa=="function"&&e.sa(),t.M=null,fL(t.V),tG(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function I4(t,e){try{var n=t.l;if(n.H!=0&&(n.g==t||P4(n.i,t))){if(!t.K&&P4(n.i,t)&&n.H==3){try{var r=n.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&r.length==3){var s=r;if(s[0]==0){e:if(!n.u){if(n.g)if(n.g.G+3e3<t.G)QA(n),z5(n);else break e;xL(n),Gh(18)}}else n.Fa=s[1],0<n.Fa-n.V&&37500>s[2]&&n.G&&n.A==0&&!n.v&&(n.v=Qw(hh(n.ib,n),6e3));if(1>=vG(n.i)&&n.oa){try{n.oa()}catch{}n.oa=void 0}}else N_(n,11)}else if((t.K||n.g==t)&&QA(n),!Hx(e))for(s=n.Ja.g.parse(e),e=0;e<s.length;e++){let S=s[e];if(n.V=S[0],S=S[1],n.H==2)if(S[0]=="c"){n.K=S[1],n.pa=S[2];const I=S[3];I!=null&&(n.ra=I,n.l.info("VER="+n.ra));const R=S[4];R!=null&&(n.Ga=R,n.l.info("SVER="+n.Ga));const F=S[5];F!=null&&typeof F=="number"&&0<F&&(r=1.5*F,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;const j=t.g;if(j){const H=j.g?j.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(H){var l=r.i;l.g||H.indexOf("spdy")==-1&&H.indexOf("quic")==-1&&H.indexOf("h2")==-1||(l.j=l.l,l.g=new Set,l.h&&(yL(l,l.h),l.h=null))}if(r.F){const G=j.g?j.g.getResponseHeader("X-HTTP-Session-Id"):null;G&&(r.Da=G,Co(r.I,r.F,G))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms")),r=n;var f=t;if(r.wa=NG(r,r.J?r.pa:null,r.Y),f.K){bG(r.i,f);var i=f,x=r.L;x&&i.setTimeout(x),i.B&&(D5(i),n2(i)),r.g=f}else OG(r);0<n.j.length&&B5(n)}else S[0]!="stop"&&S[0]!="close"||N_(n,7);else n.H==3&&(S[0]=="stop"||S[0]=="close"?S[0]=="stop"?N_(n,7):bL(n):S[0]!="noop"&&n.h&&n.h.Aa(S),n.A=0)}}Xx(4)}catch{}}function dse(t){if(t.Z&&typeof t.Z=="function")return t.Z();if(typeof Map<"u"&&t instanceof Map||typeof Set<"u"&&t instanceof Set)return Array.from(t.values());if(typeof t=="string")return t.split("");if(w5(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}e=[],n=0;for(r in t)e[n++]=t[r];return e}function pse(t){if(t.ta&&typeof t.ta=="function")return t.ta();if(!t.Z||typeof t.Z!="function"){if(typeof Map<"u"&&t instanceof Map)return Array.from(t.keys());if(!(typeof Set<"u"&&t instanceof Set)){if(w5(t)||typeof t=="string"){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const r in t)e[n++]=r;return e}}}function fG(t,e){if(t.forEach&&typeof t.forEach=="function")t.forEach(e,void 0);else if(w5(t)||typeof t=="string")Array.prototype.forEach.call(t,e,void 0);else for(var n=pse(t),r=dse(t),s=r.length,l=0;l<s;l++)e.call(void 0,r[l],n&&n[l],t)}var dG=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function mse(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),s=null;if(0<=r){var l=t[n].substring(0,r);s=t[n].substring(r+1)}else l=t[n];e(l,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}function H_(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof H_){this.h=t.h,ZA(this,t.j),this.s=t.s,this.g=t.g,JA(this,t.m),this.l=t.l;var e=t.i,n=new Zx;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),MB(this,n),this.o=t.o}else t&&(e=String(t).match(dG))?(this.h=!1,ZA(this,e[1]||"",!0),this.s=_x(e[2]||""),this.g=_x(e[3]||"",!0),JA(this,e[4]),this.l=_x(e[5]||"",!0),MB(this,e[6]||"",!0),this.o=_x(e[7]||"")):(this.h=!1,this.i=new Zx(null,this.h))}H_.prototype.toString=function(){var t=[],e=this.j;e&&t.push(vx(e,CB,!0),":");var n=this.g;return(n||e=="file")&&(t.push("//"),(e=this.s)&&t.push(vx(e,CB,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n=this.m,n!=null&&t.push(":",String(n))),(n=this.l)&&(this.g&&n.charAt(0)!="/"&&t.push("/"),t.push(vx(n,n.charAt(0)=="/"?_se:yse,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",vx(n,bse)),t.join("")};function dg(t){return new H_(t)}function ZA(t,e,n){t.j=n?_x(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function JA(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function MB(t,e,n){e instanceof Zx?(t.i=e,xse(t.i,t.h)):(n||(e=vx(e,vse)),t.i=new Zx(e,t.h))}function Co(t,e,n){t.i.set(e,n)}function L5(t){return Co(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function _x(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function vx(t,e,n){return typeof t=="string"?(t=encodeURI(t).replace(e,gse),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function gse(t){return t=t.charCodeAt(0),"%"+(t>>4&15).toString(16)+(t&15).toString(16)}var CB=/[#\/\?@]/g,yse=/[#\?:]/g,_se=/[#\?]/g,vse=/[#\?@]/g,bse=/#/g;function Zx(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Ry(t){t.g||(t.g=new Map,t.h=0,t.i&&mse(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}Ur=Zx.prototype;Ur.add=function(t,e){Ry(this),this.i=null,t=P1(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this};function pG(t,e){Ry(t),e=P1(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function mG(t,e){return Ry(t),e=P1(t,e),t.g.has(e)}Ur.forEach=function(t,e){Ry(this),this.g.forEach(function(n,r){n.forEach(function(s){t.call(e,s,r,this)},this)},this)};Ur.ta=function(){Ry(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){const s=t[r];for(let l=0;l<s.length;l++)n.push(e[r])}return n};Ur.Z=function(t){Ry(this);let e=[];if(typeof t=="string")mG(this,t)&&(e=e.concat(this.g.get(P1(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e};Ur.set=function(t,e){return Ry(this),this.i=null,t=P1(this,t),mG(this,t)&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this};Ur.get=function(t,e){return t?(t=this.Z(t),0<t.length?String(t[0]):e):e};function gG(t,e,n){pG(t,e),0<n.length&&(t.i=null,t.g.set(P1(t,e),iL(n)),t.h+=n.length)}Ur.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];const l=encodeURIComponent(String(r)),f=this.Z(r);for(r=0;r<f.length;r++){var s=l;f[r]!==""&&(s+="="+encodeURIComponent(String(f[r]))),t.push(s)}}return this.i=t.join("&")};function P1(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function xse(t,e){e&&!t.j&&(Ry(t),t.i=null,t.g.forEach(function(n,r){var s=r.toLowerCase();r!=s&&(pG(this,r),gG(this,s,n))},t)),t.j=e}var wse=class{constructor(t,e){this.g=t,this.map=e}};function yG(t){this.l=t||Sse,ia.PerformanceNavigationTiming?(t=ia.performance.getEntriesByType("navigation"),t=0<t.length&&(t[0].nextHopProtocol=="hq"||t[0].nextHopProtocol=="h2")):t=!!(ia.g&&ia.g.Ka&&ia.g.Ka()&&ia.g.Ka().ec),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Sse=10;function _G(t){return t.h?!0:t.g?t.g.size>=t.j:!1}function vG(t){return t.h?1:t.g?t.g.size:0}function P4(t,e){return t.h?t.h==e:t.g?t.g.has(e):!1}function yL(t,e){t.g?t.g.add(e):t.h=e}function bG(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}yG.prototype.cancel=function(){if(this.i=xG(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const t of this.g.values())t.cancel();this.g.clear()}};function xG(t){if(t.h!=null)return t.i.concat(t.h.F);if(t.g!=null&&t.g.size!==0){let e=t.i;for(const n of t.g.values())e=e.concat(n.F);return e}return iL(t.i)}var Ase=class{stringify(t){return ia.JSON.stringify(t,void 0)}parse(t){return ia.JSON.parse(t,void 0)}};function Tse(){this.g=new Ase}function Ese(t,e,n){const r=n||"";try{fG(t,function(s,l){let f=s;S5(s)&&(f=uL(s)),e.push(r+l+"="+encodeURIComponent(f))})}catch(s){throw e.push(r+"type="+encodeURIComponent("_badmap")),s}}function Mse(t,e){const n=new I5;if(ia.Image){const r=new Image;r.onload=US(VS,n,r,"TestLoadImage: loaded",!0,e),r.onerror=US(VS,n,r,"TestLoadImage: error",!1,e),r.onabort=US(VS,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=US(VS,n,r,"TestLoadImage: timeout",!1,e),ia.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}function VS(t,e,n,r,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(r)}catch{}}function r2(t){this.l=t.fc||null,this.j=t.ob||!1}nu(r2,pL);r2.prototype.g=function(){return new k5(this.l,this.j)};r2.prototype.i=function(t){return function(){return t}}({});function k5(t,e){tu.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=_L,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}nu(k5,tu);var _L=0;Ur=k5.prototype;Ur.open=function(t,e){if(this.readyState!=_L)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Jx(this)};Ur.send=function(t){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||ia).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};Ur.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,i2(this)),this.readyState=_L};Ur.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Jx(this)),this.g&&(this.readyState=3,Jx(this),this.g)))if(this.responseType==="arraybuffer")t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof ia.ReadableStream<"u"&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;wG(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))};function wG(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}Ur.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?i2(this):Jx(this),this.readyState==3&&wG(this)}};Ur.Za=function(t){this.g&&(this.response=this.responseText=t,i2(this))};Ur.Ya=function(t){this.g&&(this.response=t,i2(this))};Ur.ka=function(){this.g&&i2(this)};function i2(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Jx(t)}Ur.setRequestHeader=function(t,e){this.v.append(t,e)};Ur.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""};Ur.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join(`\r
`)};function Jx(t){t.onreadystatechange&&t.onreadystatechange.call(t)}Object.defineProperty(k5.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(t){this.m=t?"include":"same-origin"}});var Cse=ia.JSON.parse;function xl(t){tu.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=SG,this.L=this.M=!1}nu(xl,tu);var SG="",Ise=/^https?$/i,Pse=["POST","PUT"];Ur=xl.prototype;Ur.Oa=function(t){this.M=t};Ur.ha=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():E4.g(),this.C=this.u?EB(this.u):EB(E4),this.g.onreadystatechange=hh(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(l){IB(this,l);return}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(const l of r.keys())n.set(l,r.get(l));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(n.keys()).find(l=>l.toLowerCase()=="content-type"),s=ia.FormData&&t instanceof ia.FormData,!(0<=UH(Pse,e))||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[l,f]of n)this.g.setRequestHeader(l,f);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{EG(this),0<this.B&&((this.L=Ose(this.g))?(this.g.timeout=this.B,this.g.ontimeout=hh(this.ua,this)):this.A=dL(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(l){IB(this,l)}};function Ose(t){return G0&&typeof t.timeout=="number"&&t.ontimeout!==void 0}Ur.ua=function(){typeof rL<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Cu(this,"timeout"),this.abort(8))};function IB(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,AG(t),N5(t)}function AG(t){t.F||(t.F=!0,Cu(t,"complete"),Cu(t,"error"))}Ur.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Cu(this,"complete"),Cu(this,"abort"),N5(this))};Ur.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),N5(this,!0)),xl.$.N.call(this)};Ur.La=function(){this.s||(this.G||this.v||this.l?TG(this):this.kb())};Ur.kb=function(){TG(this)};function TG(t){if(t.h&&typeof rL<"u"&&(!t.C[1]||mm(t)!=4||t.da()!=2)){if(t.v&&mm(t)==4)dL(t.La,0,t);else if(Cu(t,"readystatechange"),mm(t)==4){t.h=!1;try{const f=t.da();e:switch(f){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var n;if(!(n=e)){var r;if(r=f===0){var s=String(t.I).match(dG)[1]||null;!s&&ia.self&&ia.self.location&&(s=ia.self.location.protocol.slice(0,-1)),r=!Ise.test(s?s.toLowerCase():"")}n=r}if(n)Cu(t,"complete"),Cu(t,"success");else{t.m=6;try{var l=2<mm(t)?t.g.statusText:""}catch{l=""}t.j=l+" ["+t.da()+"]",AG(t)}}finally{N5(t)}}}}function N5(t,e){if(t.g){EG(t);const n=t.g,r=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||Cu(t,"ready");try{n.onreadystatechange=r}catch{}}}function EG(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(ia.clearTimeout(t.A),t.A=null)}Ur.isActive=function(){return!!this.g};function mm(t){return t.g?t.g.readyState:0}Ur.da=function(){try{return 2<mm(this)?this.g.status:-1}catch{return-1}};Ur.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};Ur.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&e.indexOf(t)==0&&(e=e.substring(t.length)),Cse(e)}};function PB(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case SG:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch{return null}}function Rse(t){const e={};t=(t.g&&2<=mm(t)&&t.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<t.length;r++){if(Hx(t[r]))continue;var n=rse(t[r]);const s=n[0];if(n=n[1],typeof n!="string")continue;n=n.trim();const l=e[s]||[];e[s]=l,l.push(n)}Yae(e,function(r){return r.join(", ")})}Ur.Ia=function(){return this.m};Ur.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function MG(t){let e="";return sL(t,function(n,r){e+=r,e+=":",e+=n,e+=`\r
`}),e}function vL(t,e,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=MG(n),typeof t=="string"?n!=null&&encodeURIComponent(String(n)):Co(t,e,n))}function ex(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function CG(t){this.Ga=0,this.j=[],this.l=new I5,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=ex("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=ex("baseRetryDelayMs",5e3,t),this.hb=ex("retryDelaySeedMs",1e4,t),this.eb=ex("forwardChannelMaxRetries",2,t),this.xa=ex("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.dc||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new yG(t&&t.concurrentRequestLimit),this.Ja=new Tse,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}Ur=CG.prototype;Ur.ra=8;Ur.H=1;function bL(t){if(IG(t),t.H==3){var e=t.W++,n=dg(t.I);if(Co(n,"SID",t.K),Co(n,"RID",e),Co(n,"TYPE","terminate"),a2(t,n),e=new t2(t,t.l,e),e.L=2,e.v=L5(dg(n)),n=!1,ia.navigator&&ia.navigator.sendBeacon)try{n=ia.navigator.sendBeacon(e.v.toString(),"")}catch{}!n&&ia.Image&&(new Image().src=e.v,n=!0),n||(e.g=zG(e.l,null),e.g.ha(e.v)),e.G=Date.now(),n2(e)}kG(t)}function z5(t){t.g&&(wL(t),t.g.cancel(),t.g=null)}function IG(t){z5(t),t.u&&(ia.clearTimeout(t.u),t.u=null),QA(t),t.i.cancel(),t.m&&(typeof t.m=="number"&&ia.clearTimeout(t.m),t.m=null)}function B5(t){if(!_G(t.i)&&!t.m){t.m=!0;var e=t.Na;Wx||JH(),Kx||(Wx(),Kx=!0),hL.add(e,t),t.C=0}}function Dse(t,e){return vG(t.i)>=t.i.j-(t.m?1:0)?!1:t.m?(t.j=e.F.concat(t.j),!0):t.H==1||t.H==2||t.C>=(t.cb?0:t.eb)?!1:(t.m=Qw(hh(t.Na,t,e),LG(t,t.C)),t.C++,!0)}Ur.Na=function(t){if(this.m)if(this.m=null,this.H==1){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const s=new t2(this,this.l,t);let l=this.s;if(this.U&&(l?(l=HH(l),GH(l,this.U)):l=this.U),this.o!==null||this.O||(s.I=l,l=null),this.P)e:{for(var e=0,n=0;n<this.j.length;n++){t:{var r=this.j[n];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break t}r=void 0}if(r===void 0)break;if(e+=r,4096<e){e=n;break e}if(e===4096||n===this.j.length-1){e=n+1;break e}}e=1e3}else e=1e3;e=PG(this,s,e),n=dg(this.I),Co(n,"RID",t),Co(n,"CVER",22),this.F&&Co(n,"X-HTTP-Session-Id",this.F),a2(this,n),l&&(this.O?e="headers="+encodeURIComponent(String(MG(l)))+"&"+e:this.o&&vL(n,this.o,l)),yL(this.i,s),this.bb&&Co(n,"TYPE","init"),this.P?(Co(n,"$req",e),Co(n,"SID","null"),s.aa=!0,C4(s,n,null)):C4(s,n,e),this.H=2}}else this.H==3&&(t?OB(this,t):this.j.length==0||_G(this.i)||OB(this))};function OB(t,e){var n;e?n=e.m:n=t.W++;const r=dg(t.I);Co(r,"SID",t.K),Co(r,"RID",n),Co(r,"AID",t.V),a2(t,r),t.o&&t.s&&vL(r,t.o,t.s),n=new t2(t,t.l,n,t.C+1),t.o===null&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=PG(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),yL(t.i,n),C4(n,r,e)}function a2(t,e){t.na&&sL(t.na,function(n,r){Co(e,r,n)}),t.h&&fG({},function(n,r){Co(e,r,n)})}function PG(t,e,n){n=Math.min(t.j.length,n);var r=t.h?hh(t.h.Va,t.h,t):null;e:{var s=t.j;let l=-1;for(;;){const f=["count="+n];l==-1?0<n?(l=s[0].g,f.push("ofs="+l)):l=0:f.push("ofs="+l);let i=!0;for(let x=0;x<n;x++){let S=s[x].g;const I=s[x].map;if(S-=l,0>S)l=Math.max(0,s[x].g-100),i=!1;else try{Ese(I,f,"req"+S+"_")}catch{r&&r(I)}}if(i){r=f.join("&");break e}}}return t=t.j.splice(0,n),e.F=t,r}function OG(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;Wx||JH(),Kx||(Wx(),Kx=!0),hL.add(e,t),t.A=0}}function xL(t){return t.g||t.u||3<=t.A?!1:(t.ba++,t.u=Qw(hh(t.Ma,t),LG(t,t.A)),t.A++,!0)}Ur.Ma=function(){if(this.u=null,RG(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=Qw(hh(this.jb,this),t)}};Ur.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Gh(10),z5(this),RG(this))};function wL(t){t.B!=null&&(ia.clearTimeout(t.B),t.B=null)}function RG(t){t.g=new t2(t,t.l,"rpc",t.ba),t.o===null&&(t.g.I=t.s),t.g.O=0;var e=dg(t.wa);Co(e,"RID","rpc"),Co(e,"SID",t.K),Co(e,"AID",t.V),Co(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&Co(e,"TO",t.qa),Co(e,"TYPE","xmlhttp"),a2(t,e),t.o&&t.s&&vL(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.v=L5(dg(e)),n.s=null,n.S=!0,lG(n,t)}Ur.ib=function(){this.v!=null&&(this.v=null,z5(this),xL(this),Gh(19))};function QA(t){t.v!=null&&(ia.clearTimeout(t.v),t.v=null)}function DG(t,e){var n=null;if(t.g==e){QA(t),wL(t),t.g=null;var r=2}else if(P4(t.i,e))n=e.F,bG(t.i,e),r=1;else return;if(t.H!=0){if(e.i)if(r==1){n=e.s?e.s.length:0,e=Date.now()-e.G;var s=t.C;r=P5(),Cu(r,new iG(r,n)),B5(t)}else OG(t);else if(s=e.o,s==3||s==0&&0<e.ca||!(r==1&&Dse(t,e)||r==2&&xL(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),s){case 1:N_(t,5);break;case 4:N_(t,10);break;case 3:N_(t,6);break;default:N_(t,2)}}}function LG(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function N_(t,e){if(t.l.info("Error code "+e),e==2){var n=null;t.h&&(n=null);var r=hh(t.pb,t);n||(n=new H_("//www.google.com/images/cleardot.gif"),ia.location&&ia.location.protocol=="http"||ZA(n,"https"),L5(n)),Mse(n.toString(),r)}else Gh(2);t.H=0,t.h&&t.h.za(e),kG(t),IG(t)}Ur.pb=function(t){t?(this.l.info("Successfully pinged google.com"),Gh(2)):(this.l.info("Failed to ping google.com"),Gh(1))};function kG(t){if(t.H=0,t.ma=[],t.h){const e=xG(t.i);(e.length!=0||t.j.length!=0)&&(xB(t.ma,e),xB(t.ma,t.j),t.i.i.length=0,iL(t.j),t.j.length=0),t.h.ya()}}function NG(t,e,n){var r=n instanceof H_?dg(n):new H_(n);if(r.g!="")e&&(r.g=e+"."+r.g),JA(r,r.m);else{var s=ia.location;r=s.protocol,e=e?e+"."+s.hostname:s.hostname,s=+s.port;var l=new H_(null);r&&ZA(l,r),e&&(l.g=e),s&&JA(l,s),n&&(l.l=n),r=l}return n=t.F,e=t.Da,n&&e&&Co(r,n,e),Co(r,"VER",t.ra),a2(t,r),r}function zG(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=n&&t.Ha&&!t.va?new xl(new r2({ob:!0})):new xl(t.va),e.Oa(t.J),e}Ur.isActive=function(){return!!this.h&&this.h.isActive(this)};function BG(){}Ur=BG.prototype;Ur.Ba=function(){};Ur.Aa=function(){};Ur.za=function(){};Ur.ya=function(){};Ur.isActive=function(){return!0};Ur.Va=function(){};function eT(){if(G0&&!(10<=Number(Hae)))throw Error("Environmental error: no available transport.")}eT.prototype.g=function(t,e){return new cd(t,e)};function cd(t,e){tu.call(this),this.g=new CG(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!Hx(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Hx(e)&&(this.g.F=e,t=this.h,t!==null&&e in t&&(t=this.h,e in t&&delete t[e])),this.j=new O1(this)}nu(cd,tu);cd.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;Gh(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=NG(t,null,t.Y),B5(t)};cd.prototype.close=function(){bL(this.g)};cd.prototype.u=function(t){var e=this.g;if(typeof t=="string"){var n={};n.__data__=t,t=n}else this.v&&(n={},n.__data__=uL(t),t=n);e.j.push(new wse(e.fb++,t)),e.H==3&&B5(e)};cd.prototype.N=function(){this.g.h=null,delete this.j,bL(this.g),delete this.g,cd.$.N.call(this)};function jG(t){mL.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){e:{for(const n in e){t=n;break e}t=void 0}(this.i=t)&&(t=this.i,e=e!==null&&t in e?e[t]:void 0),this.data=e}else this.data=t}nu(jG,mL);function FG(){gL.call(this),this.status=1}nu(FG,gL);function O1(t){this.g=t}nu(O1,BG);O1.prototype.Ba=function(){Cu(this.g,"a")};O1.prototype.Aa=function(t){Cu(this.g,new jG(t))};O1.prototype.za=function(t){Cu(this.g,new FG)};O1.prototype.ya=function(){Cu(this.g,"b")};function Lse(){this.blockSize=-1}function Ip(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}nu(Ip,Lse);Ip.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function xM(t,e,n){n||(n=0);var r=Array(16);if(typeof e=="string")for(var s=0;16>s;++s)r[s]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(s=0;16>s;++s)r[s]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],s=t.g[2];var l=t.g[3],f=e+(l^n&(s^l))+r[0]+3614090360&4294967295;e=n+(f<<7&4294967295|f>>>25),f=l+(s^e&(n^s))+r[1]+3905402710&4294967295,l=e+(f<<12&4294967295|f>>>20),f=s+(n^l&(e^n))+r[2]+606105819&4294967295,s=l+(f<<17&4294967295|f>>>15),f=n+(e^s&(l^e))+r[3]+3250441966&4294967295,n=s+(f<<22&4294967295|f>>>10),f=e+(l^n&(s^l))+r[4]+4118548399&4294967295,e=n+(f<<7&4294967295|f>>>25),f=l+(s^e&(n^s))+r[5]+1200080426&4294967295,l=e+(f<<12&4294967295|f>>>20),f=s+(n^l&(e^n))+r[6]+2821735955&4294967295,s=l+(f<<17&4294967295|f>>>15),f=n+(e^s&(l^e))+r[7]+4249261313&4294967295,n=s+(f<<22&4294967295|f>>>10),f=e+(l^n&(s^l))+r[8]+1770035416&4294967295,e=n+(f<<7&4294967295|f>>>25),f=l+(s^e&(n^s))+r[9]+2336552879&4294967295,l=e+(f<<12&4294967295|f>>>20),f=s+(n^l&(e^n))+r[10]+4294925233&4294967295,s=l+(f<<17&4294967295|f>>>15),f=n+(e^s&(l^e))+r[11]+2304563134&4294967295,n=s+(f<<22&4294967295|f>>>10),f=e+(l^n&(s^l))+r[12]+1804603682&4294967295,e=n+(f<<7&4294967295|f>>>25),f=l+(s^e&(n^s))+r[13]+4254626195&4294967295,l=e+(f<<12&4294967295|f>>>20),f=s+(n^l&(e^n))+r[14]+2792965006&4294967295,s=l+(f<<17&4294967295|f>>>15),f=n+(e^s&(l^e))+r[15]+1236535329&4294967295,n=s+(f<<22&4294967295|f>>>10),f=e+(s^l&(n^s))+r[1]+4129170786&4294967295,e=n+(f<<5&4294967295|f>>>27),f=l+(n^s&(e^n))+r[6]+3225465664&4294967295,l=e+(f<<9&4294967295|f>>>23),f=s+(e^n&(l^e))+r[11]+643717713&4294967295,s=l+(f<<14&4294967295|f>>>18),f=n+(l^e&(s^l))+r[0]+3921069994&4294967295,n=s+(f<<20&4294967295|f>>>12),f=e+(s^l&(n^s))+r[5]+3593408605&4294967295,e=n+(f<<5&4294967295|f>>>27),f=l+(n^s&(e^n))+r[10]+38016083&4294967295,l=e+(f<<9&4294967295|f>>>23),f=s+(e^n&(l^e))+r[15]+3634488961&4294967295,s=l+(f<<14&4294967295|f>>>18),f=n+(l^e&(s^l))+r[4]+3889429448&4294967295,n=s+(f<<20&4294967295|f>>>12),f=e+(s^l&(n^s))+r[9]+568446438&4294967295,e=n+(f<<5&4294967295|f>>>27),f=l+(n^s&(e^n))+r[14]+3275163606&4294967295,l=e+(f<<9&4294967295|f>>>23),f=s+(e^n&(l^e))+r[3]+4107603335&4294967295,s=l+(f<<14&4294967295|f>>>18),f=n+(l^e&(s^l))+r[8]+1163531501&4294967295,n=s+(f<<20&4294967295|f>>>12),f=e+(s^l&(n^s))+r[13]+2850285829&4294967295,e=n+(f<<5&4294967295|f>>>27),f=l+(n^s&(e^n))+r[2]+4243563512&4294967295,l=e+(f<<9&4294967295|f>>>23),f=s+(e^n&(l^e))+r[7]+1735328473&4294967295,s=l+(f<<14&4294967295|f>>>18),f=n+(l^e&(s^l))+r[12]+2368359562&4294967295,n=s+(f<<20&4294967295|f>>>12),f=e+(n^s^l)+r[5]+4294588738&4294967295,e=n+(f<<4&4294967295|f>>>28),f=l+(e^n^s)+r[8]+2272392833&4294967295,l=e+(f<<11&4294967295|f>>>21),f=s+(l^e^n)+r[11]+1839030562&4294967295,s=l+(f<<16&4294967295|f>>>16),f=n+(s^l^e)+r[14]+4259657740&4294967295,n=s+(f<<23&4294967295|f>>>9),f=e+(n^s^l)+r[1]+2763975236&4294967295,e=n+(f<<4&4294967295|f>>>28),f=l+(e^n^s)+r[4]+1272893353&4294967295,l=e+(f<<11&4294967295|f>>>21),f=s+(l^e^n)+r[7]+4139469664&4294967295,s=l+(f<<16&4294967295|f>>>16),f=n+(s^l^e)+r[10]+3200236656&4294967295,n=s+(f<<23&4294967295|f>>>9),f=e+(n^s^l)+r[13]+681279174&4294967295,e=n+(f<<4&4294967295|f>>>28),f=l+(e^n^s)+r[0]+3936430074&4294967295,l=e+(f<<11&4294967295|f>>>21),f=s+(l^e^n)+r[3]+3572445317&4294967295,s=l+(f<<16&4294967295|f>>>16),f=n+(s^l^e)+r[6]+76029189&4294967295,n=s+(f<<23&4294967295|f>>>9),f=e+(n^s^l)+r[9]+3654602809&4294967295,e=n+(f<<4&4294967295|f>>>28),f=l+(e^n^s)+r[12]+3873151461&4294967295,l=e+(f<<11&4294967295|f>>>21),f=s+(l^e^n)+r[15]+530742520&4294967295,s=l+(f<<16&4294967295|f>>>16),f=n+(s^l^e)+r[2]+3299628645&4294967295,n=s+(f<<23&4294967295|f>>>9),f=e+(s^(n|~l))+r[0]+4096336452&4294967295,e=n+(f<<6&4294967295|f>>>26),f=l+(n^(e|~s))+r[7]+1126891415&4294967295,l=e+(f<<10&4294967295|f>>>22),f=s+(e^(l|~n))+r[14]+2878612391&4294967295,s=l+(f<<15&4294967295|f>>>17),f=n+(l^(s|~e))+r[5]+4237533241&4294967295,n=s+(f<<21&4294967295|f>>>11),f=e+(s^(n|~l))+r[12]+1700485571&4294967295,e=n+(f<<6&4294967295|f>>>26),f=l+(n^(e|~s))+r[3]+2399980690&4294967295,l=e+(f<<10&4294967295|f>>>22),f=s+(e^(l|~n))+r[10]+4293915773&4294967295,s=l+(f<<15&4294967295|f>>>17),f=n+(l^(s|~e))+r[1]+2240044497&4294967295,n=s+(f<<21&4294967295|f>>>11),f=e+(s^(n|~l))+r[8]+1873313359&4294967295,e=n+(f<<6&4294967295|f>>>26),f=l+(n^(e|~s))+r[15]+4264355552&4294967295,l=e+(f<<10&4294967295|f>>>22),f=s+(e^(l|~n))+r[6]+2734768916&4294967295,s=l+(f<<15&4294967295|f>>>17),f=n+(l^(s|~e))+r[13]+1309151649&4294967295,n=s+(f<<21&4294967295|f>>>11),f=e+(s^(n|~l))+r[4]+4149444226&4294967295,e=n+(f<<6&4294967295|f>>>26),f=l+(n^(e|~s))+r[11]+3174756917&4294967295,l=e+(f<<10&4294967295|f>>>22),f=s+(e^(l|~n))+r[2]+718787259&4294967295,s=l+(f<<15&4294967295|f>>>17),f=n+(l^(s|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(s+(f<<21&4294967295|f>>>11))&4294967295,t.g[2]=t.g[2]+s&4294967295,t.g[3]=t.g[3]+l&4294967295}Ip.prototype.j=function(t,e){e===void 0&&(e=t.length);for(var n=e-this.blockSize,r=this.m,s=this.h,l=0;l<e;){if(s==0)for(;l<=n;)xM(this,t,l),l+=this.blockSize;if(typeof t=="string"){for(;l<e;)if(r[s++]=t.charCodeAt(l++),s==this.blockSize){xM(this,r),s=0;break}}else for(;l<e;)if(r[s++]=t[l++],s==this.blockSize){xM(this,r),s=0;break}}this.h=s,this.i+=e};Ip.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=n&255,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var r=0;32>r;r+=8)t[n++]=this.g[e]>>>r&255;return t};function Ns(t,e){this.h=e;for(var n=[],r=!0,s=t.length-1;0<=s;s--){var l=t[s]|0;r&&l==e||(n[s]=l,r=!1)}this.g=n}var kse={};function SL(t){return-128<=t&&128>t?qae(t,function(e){return new Ns([e|0],0>e?-1:0)}):new Ns([t|0],0>t?-1:0)}function gm(t){if(isNaN(t)||!isFinite(t))return O0;if(0>t)return Mu(gm(-t));for(var e=[],n=1,r=0;t>=n;r++)e[r]=t/n|0,n*=O4;return new Ns(e,0)}function UG(t,e){if(t.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(t.charAt(0)=="-")return Mu(UG(t.substring(1),e));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var n=gm(Math.pow(e,8)),r=O0,s=0;s<t.length;s+=8){var l=Math.min(8,t.length-s),f=parseInt(t.substring(s,s+l),e);8>l?(l=gm(Math.pow(e,l)),r=r.R(l).add(gm(f))):(r=r.R(n),r=r.add(gm(f)))}return r}var O4=4294967296,O0=SL(0),R4=SL(1),RB=SL(16777216);Ur=Ns.prototype;Ur.ea=function(){if(zd(this))return-Mu(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var r=this.D(n);t+=(0<=r?r:O4+r)*e,e*=O4}return t};Ur.toString=function(t){if(t=t||10,2>t||36<t)throw Error("radix out of range: "+t);if(rg(this))return"0";if(zd(this))return"-"+Mu(this).toString(t);for(var e=gm(Math.pow(t,6)),n=this,r="";;){var s=nT(n,e).g;n=tT(n,s.R(e));var l=((0<n.g.length?n.g[0]:n.h)>>>0).toString(t);if(n=s,rg(n))return l+r;for(;6>l.length;)l="0"+l;r=l+r}};Ur.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h};function rg(t){if(t.h!=0)return!1;for(var e=0;e<t.g.length;e++)if(t.g[e]!=0)return!1;return!0}function zd(t){return t.h==-1}Ur.X=function(t){return t=tT(this,t),zd(t)?-1:rg(t)?0:1};function Mu(t){for(var e=t.g.length,n=[],r=0;r<e;r++)n[r]=~t.g[r];return new Ns(n,~t.h).add(R4)}Ur.abs=function(){return zd(this)?Mu(this):this};Ur.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0,s=0;s<=e;s++){var l=r+(this.D(s)&65535)+(t.D(s)&65535),f=(l>>>16)+(this.D(s)>>>16)+(t.D(s)>>>16);r=f>>>16,l&=65535,f&=65535,n[s]=f<<16|l}return new Ns(n,n[n.length-1]&-2147483648?-1:0)};function tT(t,e){return t.add(Mu(e))}Ur.R=function(t){if(rg(this)||rg(t))return O0;if(zd(this))return zd(t)?Mu(this).R(Mu(t)):Mu(Mu(this).R(t));if(zd(t))return Mu(this.R(Mu(t)));if(0>this.X(RB)&&0>t.X(RB))return gm(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],r=0;r<2*e;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var s=0;s<t.g.length;s++){var l=this.D(r)>>>16,f=this.D(r)&65535,i=t.D(s)>>>16,x=t.D(s)&65535;n[2*r+2*s]+=f*x,$S(n,2*r+2*s),n[2*r+2*s+1]+=l*x,$S(n,2*r+2*s+1),n[2*r+2*s+1]+=f*i,$S(n,2*r+2*s+1),n[2*r+2*s+2]+=l*i,$S(n,2*r+2*s+2)}for(r=0;r<e;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=e;r<2*e;r++)n[r]=0;return new Ns(n,0)};function $S(t,e){for(;(t[e]&65535)!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function tx(t,e){this.g=t,this.h=e}function nT(t,e){if(rg(e))throw Error("division by zero");if(rg(t))return new tx(O0,O0);if(zd(t))return e=nT(Mu(t),e),new tx(Mu(e.g),Mu(e.h));if(zd(e))return e=nT(t,Mu(e)),new tx(Mu(e.g),e.h);if(30<t.g.length){if(zd(t)||zd(e))throw Error("slowDivide_ only works with positive integers.");for(var n=R4,r=e;0>=r.X(t);)n=DB(n),r=DB(r);var s=s0(n,1),l=s0(r,1);for(r=s0(r,2),n=s0(n,2);!rg(r);){var f=l.add(r);0>=f.X(t)&&(s=s.add(n),l=f),r=s0(r,1),n=s0(n,1)}return e=tT(t,s.R(e)),new tx(s,e)}for(s=O0;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),r=Math.ceil(Math.log(n)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),l=gm(n),f=l.R(e);zd(f)||0<f.X(t);)n-=r,l=gm(n),f=l.R(e);rg(l)&&(l=R4),s=s.add(l),t=tT(t,f)}return new tx(s,t)}Ur.gb=function(t){return nT(this,t).h};Ur.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)&t.D(r);return new Ns(n,this.h&t.h)};Ur.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)|t.D(r);return new Ns(n,this.h|t.h)};Ur.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)^t.D(r);return new Ns(n,this.h^t.h)};function DB(t){for(var e=t.g.length+1,n=[],r=0;r<e;r++)n[r]=t.D(r)<<1|t.D(r-1)>>>31;return new Ns(n,t.h)}function s0(t,e){var n=e>>5;e%=32;for(var r=t.g.length-n,s=[],l=0;l<r;l++)s[l]=0<e?t.D(l+n)>>>e|t.D(l+n+1)<<32-e:t.D(l+n);return new Ns(s,t.h)}eT.prototype.createWebChannel=eT.prototype.g;cd.prototype.send=cd.prototype.u;cd.prototype.open=cd.prototype.m;cd.prototype.close=cd.prototype.close;O5.NO_ERROR=0;O5.TIMEOUT=8;O5.HTTP_ERROR=6;aG.COMPLETE="complete";sG.EventType=e2;e2.OPEN="a";e2.CLOSE="b";e2.ERROR="c";e2.MESSAGE="d";tu.prototype.listen=tu.prototype.O;xl.prototype.listenOnce=xl.prototype.P;xl.prototype.getLastError=xl.prototype.Sa;xl.prototype.getLastErrorCode=xl.prototype.Ia;xl.prototype.getStatus=xl.prototype.da;xl.prototype.getResponseJson=xl.prototype.Wa;xl.prototype.getResponseText=xl.prototype.ja;xl.prototype.send=xl.prototype.ha;xl.prototype.setWithCredentials=xl.prototype.Oa;Ip.prototype.digest=Ip.prototype.l;Ip.prototype.reset=Ip.prototype.reset;Ip.prototype.update=Ip.prototype.j;Ns.prototype.add=Ns.prototype.add;Ns.prototype.multiply=Ns.prototype.R;Ns.prototype.modulo=Ns.prototype.gb;Ns.prototype.compare=Ns.prototype.X;Ns.prototype.toNumber=Ns.prototype.ea;Ns.prototype.toString=Ns.prototype.toString;Ns.prototype.getBits=Ns.prototype.D;Ns.fromNumber=gm;Ns.fromString=UG;var Nse=function(){return new eT},zse=function(){return P5()},wM=O5,Bse=aG,jse=hv,LB={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Fse=r2,HS=sG,Use=xl,qse=Ip,R0=Ns;const kB="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sh=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};sh.UNAUTHENTICATED=new sh(null),sh.GOOGLE_CREDENTIALS=new sh("google-credentials-uid"),sh.FIRST_PARTY=new sh("first-party-uid"),sh.MOCK_USER=new sh("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let R1="9.23.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ev=new HD("@firebase/firestore");function NB(){return ev.logLevel}function hi(t,...e){if(ev.logLevel<=hs.DEBUG){const n=e.map(AL);ev.debug(`Firestore (${R1}): ${t}`,...n)}}function pg(t,...e){if(ev.logLevel<=hs.ERROR){const n=e.map(AL);ev.error(`Firestore (${R1}): ${t}`,...n)}}function W0(t,...e){if(ev.logLevel<=hs.WARN){const n=e.map(AL);ev.warn(`Firestore (${R1}): ${t}`,...n)}}function AL(t){if(typeof t=="string")return t;try{return e=t,JSON.stringify(e)}catch{return t}/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qi(t="Unexpected state"){const e=`FIRESTORE (${R1}) INTERNAL ASSERTION FAILED: `+t;throw pg(e),new Error(e)}function Po(t,e){t||Qi()}function da(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};let $r=class extends Sg{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let lg=class{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let qG=class{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Vse=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(sh.UNAUTHENTICATED))}shutdown(){}},$se=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}},Hse=class{constructor(e){this.t=e,this.currentUser=sh.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){let r=this.i;const s=x=>this.i!==r?(r=this.i,n(x)):Promise.resolve();let l=new lg;this.o=()=>{this.i++,this.currentUser=this.u(),l.resolve(),l=new lg,e.enqueueRetryable(()=>s(this.currentUser))};const f=()=>{const x=l;e.enqueueRetryable(async()=>{await x.promise,await s(this.currentUser)})},i=x=>{hi("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=x,this.auth.addAuthTokenListener(this.o),f()};this.t.onInit(x=>i(x)),setTimeout(()=>{if(!this.auth){const x=this.t.getImmediate({optional:!0});x?i(x):(hi("FirebaseAuthCredentialsProvider","Auth not yet detected"),l.resolve(),l=new lg)}},0),f()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(hi("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Po(typeof r.accessToken=="string"),new qG(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Po(e===null||typeof e=="string"),new sh(e)}},Gse=class{constructor(e,n,r){this.h=e,this.l=n,this.m=r,this.type="FirstParty",this.user=sh.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);const e=this.p();return e&&this.g.set("Authorization",e),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}},Wse=class{constructor(e,n,r){this.h=e,this.l=n,this.m=r}getToken(){return Promise.resolve(new Gse(this.h,this.l,this.m))}start(e,n){e.enqueueRetryable(()=>n(sh.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Kse=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Yse=class{constructor(e){this.I=e,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(e,n){const r=l=>{l.error!=null&&hi("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${l.error.message}`);const f=l.token!==this.T;return this.T=l.token,hi("FirebaseAppCheckTokenProvider",`Received ${f?"new":"existing"} token.`),f?n(l.token):Promise.resolve()};this.o=l=>{e.enqueueRetryable(()=>r(l))};const s=l=>{hi("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=l,this.appCheck.addTokenListener(this.o)};this.I.onInit(l=>s(l)),setTimeout(()=>{if(!this.appCheck){const l=this.I.getImmediate({optional:!0});l?s(l):hi("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(Po(typeof n.token=="string"),this.T=n.token,new Kse(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xse(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let VG=class{static A(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=Xse(40);for(let l=0;l<s.length;++l)r.length<20&&s[l]<n&&(r+=e.charAt(s[l]%e.length))}return r}};function gs(t,e){return t<e?-1:t>e?1:0}function K0(t,e,n){return t.length===e.length&&t.every((r,s)=>n(r,e[s]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Xh=class xA{constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new $r(nr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new $r(nr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<-62135596800)throw new $r(nr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new $r(nr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return xA.fromMillis(Date.now())}static fromDate(e){return xA.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*n));return new xA(n,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?gs(this.nanoseconds,e.nanoseconds):gs(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Aa=class wA{constructor(e){this.timestamp=e}static fromTimestamp(e){return new wA(e)}static min(){return new wA(new Xh(0,0))}static max(){return new wA(new Xh(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let $G=class D4{constructor(e,n,r){n===void 0?n=0:n>e.length&&Qi(),r===void 0?r=e.length-n:r>e.length-n&&Qi(),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return D4.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof D4?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let s=0;s<r;s++){const l=e.get(s),f=n.get(s);if(l<f)return-1;if(l>f)return 1}return e.length<n.length?-1:e.length>n.length?1:0}},kl=class SA extends $G{construct(e,n,r){return new SA(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new $r(nr.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(s=>s.length>0))}return new SA(n)}static emptyPath(){return new SA([])}};const Zse=/^[_a-zA-Z][_a-zA-Z0-9]*$/;let Em=class p0 extends $G{construct(e,n,r){return new p0(e,n,r)}static isValidIdentifier(e){return Zse.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),p0.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new p0(["__name__"])}static fromServerFormat(e){const n=[];let r="",s=0;const l=()=>{if(r.length===0)throw new $r(nr.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let f=!1;for(;s<e.length;){const i=e[s];if(i==="\\"){if(s+1===e.length)throw new $r(nr.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const x=e[s+1];if(x!=="\\"&&x!=="."&&x!=="`")throw new $r(nr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=x,s+=2}else i==="`"?(f=!f,s++):i!=="."||f?(r+=i,s++):(l(),s++)}if(l(),f)throw new $r(nr.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new p0(n)}static emptyPath(){return new p0([])}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ki=class bx{constructor(e){this.path=e}static fromPath(e){return new bx(kl.fromString(e))}static fromName(e){return new bx(kl.fromString(e).popFirst(5))}static empty(){return new bx(kl.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&kl.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return kl.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new bx(new kl(e.slice()))}};function Jse(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=Aa.fromTimestamp(r===1e9?new Xh(n+1,0):new Xh(n,r));return new Qx(s,Ki.empty(),e)}function Qse(t){return new Qx(t.readTime,t.key,-1)}let Qx=class L4{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new L4(Aa.min(),Ki.empty(),-1)}static max(){return new L4(Aa.max(),Ki.empty(),-1)}};function eoe(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=Ki.comparator(t.documentKey,e.documentKey),n!==0?n:gs(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const toe="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";let noe=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function s2(t){if(t.code!==nr.FAILED_PRECONDITION||t.message!==toe)throw t;hi("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let kr=class xf{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Qi(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new xf((r,s)=>{this.nextCallback=l=>{this.wrapSuccess(e,l).next(r,s)},this.catchCallback=l=>{this.wrapFailure(n,l).next(r,s)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof xf?n:xf.resolve(n)}catch(n){return xf.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):xf.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):xf.reject(n)}static resolve(e){return new xf((n,r)=>{n(e)})}static reject(e){return new xf((n,r)=>{r(e)})}static waitFor(e){return new xf((n,r)=>{let s=0,l=0,f=!1;e.forEach(i=>{++s,i.next(()=>{++l,f&&l===s&&n()},x=>r(x))}),f=!0,l===s&&n()})}static or(e){let n=xf.resolve(!1);for(const r of e)n=n.next(s=>s?xf.resolve(s):r());return n}static forEach(e,n){const r=[];return e.forEach((s,l)=>{r.push(n.call(this,s,l))}),this.waitFor(r)}static mapArray(e,n){return new xf((r,s)=>{const l=e.length,f=new Array(l);let i=0;for(let x=0;x<l;x++){const S=x;n(e[S]).next(I=>{f[S]=I,++i,i===l&&r(f)},I=>s(I))}})}static doWhile(e,n){return new xf((r,s)=>{const l=()=>{e()===!0?n().next(()=>{l()},s):r()};l()})}};function o2(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let TL=class{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ot(r),this.ut=r=>n.writeSequenceNumber(r))}ot(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ut&&this.ut(e),e}};TL.ct=-1;function j5(t){return t==null}function rT(t){return t===0&&1/t==-1/0}function roe(t){return typeof t=="number"&&Number.isInteger(t)&&!rT(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zB(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function fv(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function HG(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let oc=class k4{constructor(e,n){this.comparator=e,this.root=n||Eu.EMPTY}insert(e,n){return new k4(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Eu.BLACK,null,null))}remove(e){return new k4(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Eu.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return n+r.left.size;s<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new GS(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new GS(this.root,e,this.comparator,!1)}getReverseIterator(){return new GS(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new GS(this.root,e,this.comparator,!0)}};class GS{constructor(e,n,r,s){this.isReverse=s,this.nodeStack=[];let l=1;for(;!e.isEmpty();)if(l=n?r(e.key,n):1,n&&s&&(l*=-1),l<0)e=this.isReverse?e.left:e.right;else{if(l===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Eu{constructor(e,n,r,s,l){this.key=e,this.value=n,this.color=r??Eu.RED,this.left=s??Eu.EMPTY,this.right=l??Eu.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,s,l){return new Eu(e??this.key,n??this.value,r??this.color,s??this.left,l??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const l=r(e,s.key);return s=l<0?s.copy(null,null,null,s.left.insert(e,n,r),null):l===0?s.copy(null,n,null,null,null):s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Eu.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,s=this;if(n(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),n(e,s.key)===0){if(s.right.isEmpty())return Eu.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Eu.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Eu.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Qi();const e=this.left.check();if(e!==this.right.check())throw Qi();return e+(this.isRed()?0:1)}}Eu.EMPTY=null,Eu.RED=!0,Eu.BLACK=!1;Eu.EMPTY=new class{constructor(){this.size=0}get key(){throw Qi()}get value(){throw Qi()}get color(){throw Qi()}get left(){throw Qi()}get right(){throw Qi()}copy(t,e,n,r,s){return this}insert(t,e,n){return new Eu(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dh{constructor(e){this.comparator=e,this.data=new oc(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;n(s.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new BB(this.data.getIterator())}getIteratorFrom(e){return new BB(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof dh)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const s=n.getNext().key,l=r.getNext().key;if(this.comparator(s,l)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new dh(this.comparator);return n.data=e,n}}class BB{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rd{constructor(e){this.fields=e,e.sort(Em.comparator)}static empty(){return new rd([])}unionWith(e){let n=new dh(Em.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new rd(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return K0(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GG extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mh{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(r){try{return atob(r)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new GG("Invalid base64 string: "+s):s}}(e);return new mh(n)}static fromUint8Array(e){const n=function(r){let s="";for(let l=0;l<r.length;++l)s+=String.fromCharCode(r[l]);return s}(e);return new mh(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return gs(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}mh.EMPTY_BYTE_STRING=new mh("");const ioe=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ey(t){if(Po(!!t),typeof t=="string"){let e=0;const n=ioe.exec(t);if(Po(!!n),n[1]){let s=n[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ic(t.seconds),nanos:ic(t.nanos)}}function ic(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function tv(t){return typeof t=="string"?mh.fromBase64String(t):mh.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EL(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function ML(t){const e=t.mapValue.fields.__previous_value__;return EL(e)?ML(e):e}function ew(t){const e=Ey(t.mapValue.fields.__local_write_time__.timestampValue);return new Xh(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aoe{constructor(e,n,r,s,l,f,i,x,S){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=s,this.ssl=l,this.forceLongPolling=f,this.autoDetectLongPolling=i,this.longPollingOptions=x,this.useFetchStreams=S}}class tw{constructor(e,n){this.projectId=e,this.database=n||"(default)"}static empty(){return new tw("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof tw&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WS={mapValue:{}};function nv(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?EL(t)?4:soe(t)?9007199254740991:10:Qi()}function Mm(t,e){if(t===e)return!0;const n=nv(t);if(n!==nv(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return ew(t).isEqual(ew(e));case 3:return function(r,s){if(typeof r.timestampValue=="string"&&typeof s.timestampValue=="string"&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;const l=Ey(r.timestampValue),f=Ey(s.timestampValue);return l.seconds===f.seconds&&l.nanos===f.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(r,s){return tv(r.bytesValue).isEqual(tv(s.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(r,s){return ic(r.geoPointValue.latitude)===ic(s.geoPointValue.latitude)&&ic(r.geoPointValue.longitude)===ic(s.geoPointValue.longitude)}(t,e);case 2:return function(r,s){if("integerValue"in r&&"integerValue"in s)return ic(r.integerValue)===ic(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){const l=ic(r.doubleValue),f=ic(s.doubleValue);return l===f?rT(l)===rT(f):isNaN(l)&&isNaN(f)}return!1}(t,e);case 9:return K0(t.arrayValue.values||[],e.arrayValue.values||[],Mm);case 10:return function(r,s){const l=r.mapValue.fields||{},f=s.mapValue.fields||{};if(zB(l)!==zB(f))return!1;for(const i in l)if(l.hasOwnProperty(i)&&(f[i]===void 0||!Mm(l[i],f[i])))return!1;return!0}(t,e);default:return Qi()}}function nw(t,e){return(t.values||[]).find(n=>Mm(n,e))!==void 0}function Y0(t,e){if(t===e)return 0;const n=nv(t),r=nv(e);if(n!==r)return gs(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return gs(t.booleanValue,e.booleanValue);case 2:return function(s,l){const f=ic(s.integerValue||s.doubleValue),i=ic(l.integerValue||l.doubleValue);return f<i?-1:f>i?1:f===i?0:isNaN(f)?isNaN(i)?0:-1:1}(t,e);case 3:return jB(t.timestampValue,e.timestampValue);case 4:return jB(ew(t),ew(e));case 5:return gs(t.stringValue,e.stringValue);case 6:return function(s,l){const f=tv(s),i=tv(l);return f.compareTo(i)}(t.bytesValue,e.bytesValue);case 7:return function(s,l){const f=s.split("/"),i=l.split("/");for(let x=0;x<f.length&&x<i.length;x++){const S=gs(f[x],i[x]);if(S!==0)return S}return gs(f.length,i.length)}(t.referenceValue,e.referenceValue);case 8:return function(s,l){const f=gs(ic(s.latitude),ic(l.latitude));return f!==0?f:gs(ic(s.longitude),ic(l.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(s,l){const f=s.values||[],i=l.values||[];for(let x=0;x<f.length&&x<i.length;++x){const S=Y0(f[x],i[x]);if(S)return S}return gs(f.length,i.length)}(t.arrayValue,e.arrayValue);case 10:return function(s,l){if(s===WS.mapValue&&l===WS.mapValue)return 0;if(s===WS.mapValue)return 1;if(l===WS.mapValue)return-1;const f=s.fields||{},i=Object.keys(f),x=l.fields||{},S=Object.keys(x);i.sort(),S.sort();for(let I=0;I<i.length&&I<S.length;++I){const R=gs(i[I],S[I]);if(R!==0)return R;const F=Y0(f[i[I]],x[S[I]]);if(F!==0)return F}return gs(i.length,S.length)}(t.mapValue,e.mapValue);default:throw Qi()}}function jB(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return gs(t,e);const n=Ey(t),r=Ey(e),s=gs(n.seconds,r.seconds);return s!==0?s:gs(n.nanos,r.nanos)}function X0(t){return N4(t)}function N4(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(r){const s=Ey(r);return`time(${s.seconds},${s.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?tv(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,Ki.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(r){let s="[",l=!0;for(const f of r.values||[])l?l=!1:s+=",",s+=N4(f);return s+"]"}(t.arrayValue):"mapValue"in t?function(r){const s=Object.keys(r.fields||{}).sort();let l="{",f=!0;for(const i of s)f?f=!1:l+=",",l+=`${i}:${N4(r.fields[i])}`;return l+"}"}(t.mapValue):Qi();var e,n}function FB(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function z4(t){return!!t&&"integerValue"in t}function CL(t){return!!t&&"arrayValue"in t}function UB(t){return!!t&&"nullValue"in t}function qB(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function AA(t){return!!t&&"mapValue"in t}function Ix(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return fv(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=Ix(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Ix(t.arrayValue.values[n]);return e}return Object.assign({},t)}function soe(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Af{constructor(e){this.value=e}static empty(){return new Af({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!AA(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ix(n)}setAll(e){let n=Em.emptyPath(),r={},s=[];e.forEach((f,i)=>{if(!n.isImmediateParentOf(i)){const x=this.getFieldsMap(n);this.applyChanges(x,r,s),r={},s=[],n=i.popLast()}f?r[i.lastSegment()]=Ix(f):s.push(i.lastSegment())});const l=this.getFieldsMap(n);this.applyChanges(l,r,s)}delete(e){const n=this.field(e.popLast());AA(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Mm(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=n.mapValue.fields[e.get(r)];AA(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=s),n=s}return n.mapValue.fields}applyChanges(e,n,r){fv(n,(s,l)=>e[s]=l);for(const s of r)delete e[s]}clone(){return new Af(Ix(this.value))}}function WG(t){const e=[];return fv(t.fields,(n,r)=>{const s=new Em([n]);if(AA(r)){const l=WG(r.mapValue).fields;if(l.length===0)e.push(s);else for(const f of l)e.push(s.child(f))}else e.push(s)}),new rd(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oh{constructor(e,n,r,s,l,f,i){this.key=e,this.documentType=n,this.version=r,this.readTime=s,this.createTime=l,this.data=f,this.documentState=i}static newInvalidDocument(e){return new oh(e,0,Aa.min(),Aa.min(),Aa.min(),Af.empty(),0)}static newFoundDocument(e,n,r,s){return new oh(e,1,n,Aa.min(),r,s,0)}static newNoDocument(e,n){return new oh(e,2,n,Aa.min(),Aa.min(),Af.empty(),0)}static newUnknownDocument(e,n){return new oh(e,3,n,Aa.min(),Aa.min(),Af.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(Aa.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Af.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Af.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Aa.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof oh&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new oh(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iT{constructor(e,n){this.position=e,this.inclusive=n}}function VB(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const l=e[s],f=t.position[s];if(l.field.isKeyField()?r=Ki.comparator(Ki.fromName(f.referenceValue),n.key):r=Y0(f,n.data.field(l.field)),l.dir==="desc"&&(r*=-1),r!==0)break}return r}function $B(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Mm(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D0{constructor(e,n="asc"){this.field=e,this.dir=n}}function ooe(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KG{}class ac extends KG{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new coe(e,n,r):n==="array-contains"?new foe(e,r):n==="in"?new doe(e,r):n==="not-in"?new poe(e,r):n==="array-contains-any"?new moe(e,r):new ac(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new uoe(e,r):new hoe(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison(Y0(n,this.value)):n!==null&&nv(this.value)===nv(n)&&this.matchesComparison(Y0(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Qi()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class Pp extends KG{constructor(e,n){super(),this.filters=e,this.op=n,this.lt=null}static create(e,n){return new Pp(e,n)}matches(e){return YG(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.lt!==null||(this.lt=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.lt}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.ft(n=>n.isInequality());return e!==null?e.field:null}ft(e){for(const n of this.getFlattenedFilters())if(e(n))return n;return null}}function YG(t){return t.op==="and"}function XG(t){return loe(t)&&YG(t)}function loe(t){for(const e of t.filters)if(e instanceof Pp)return!1;return!0}function B4(t){if(t instanceof ac)return t.field.canonicalString()+t.op.toString()+X0(t.value);if(XG(t))return t.filters.map(e=>B4(e)).join(",");{const e=t.filters.map(n=>B4(n)).join(",");return`${t.op}(${e})`}}function ZG(t,e){return t instanceof ac?function(n,r){return r instanceof ac&&n.op===r.op&&n.field.isEqual(r.field)&&Mm(n.value,r.value)}(t,e):t instanceof Pp?function(n,r){return r instanceof Pp&&n.op===r.op&&n.filters.length===r.filters.length?n.filters.reduce((s,l,f)=>s&&ZG(l,r.filters[f]),!0):!1}(t,e):void Qi()}function JG(t){return t instanceof ac?function(e){return`${e.field.canonicalString()} ${e.op} ${X0(e.value)}`}(t):t instanceof Pp?function(e){return e.op.toString()+" {"+e.getFilters().map(JG).join(" ,")+"}"}(t):"Filter"}class coe extends ac{constructor(e,n,r){super(e,n,r),this.key=Ki.fromName(r.referenceValue)}matches(e){const n=Ki.comparator(e.key,this.key);return this.matchesComparison(n)}}class uoe extends ac{constructor(e,n){super(e,"in",n),this.keys=QG("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class hoe extends ac{constructor(e,n){super(e,"not-in",n),this.keys=QG("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function QG(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>Ki.fromName(r.referenceValue))}class foe extends ac{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return CL(n)&&nw(n.arrayValue,this.value)}}class doe extends ac{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&nw(this.value.arrayValue,n)}}class poe extends ac{constructor(e,n){super(e,"not-in",n)}matches(e){if(nw(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&!nw(this.value.arrayValue,n)}}class moe extends ac{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!CL(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>nw(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class goe{constructor(e,n=null,r=[],s=[],l=null,f=null,i=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=s,this.limit=l,this.startAt=f,this.endAt=i,this.dt=null}}function HB(t,e=null,n=[],r=[],s=null,l=null,f=null){return new goe(t,e,n,r,s,l,f)}function IL(t){const e=da(t);if(e.dt===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>B4(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),j5(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>X0(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>X0(r)).join(",")),e.dt=n}return e.dt}function PL(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!ooe(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!ZG(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!$B(t.startAt,e.startAt)&&$B(t.endAt,e.endAt)}function j4(t){return Ki.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D1{constructor(e,n=null,r=[],s=[],l=null,f="F",i=null,x=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=s,this.limit=l,this.limitType=f,this.startAt=i,this.endAt=x,this.wt=null,this._t=null,this.startAt,this.endAt}}function yoe(t,e,n,r,s,l,f,i){return new D1(t,e,n,r,s,l,f,i)}function F5(t){return new D1(t)}function GB(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function OL(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function U5(t){for(const e of t.filters){const n=e.getFirstInequalityField();if(n!==null)return n}return null}function eW(t){return t.collectionGroup!==null}function L0(t){const e=da(t);if(e.wt===null){e.wt=[];const n=U5(e),r=OL(e);if(n!==null&&r===null)n.isKeyField()||e.wt.push(new D0(n)),e.wt.push(new D0(Em.keyField(),"asc"));else{let s=!1;for(const l of e.explicitOrderBy)e.wt.push(l),l.field.isKeyField()&&(s=!0);if(!s){const l=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.wt.push(new D0(Em.keyField(),l))}}}return e.wt}function mg(t){const e=da(t);if(!e._t)if(e.limitType==="F")e._t=HB(e.path,e.collectionGroup,L0(e),e.filters,e.limit,e.startAt,e.endAt);else{const n=[];for(const l of L0(e)){const f=l.dir==="desc"?"asc":"desc";n.push(new D0(l.field,f))}const r=e.endAt?new iT(e.endAt.position,e.endAt.inclusive):null,s=e.startAt?new iT(e.startAt.position,e.startAt.inclusive):null;e._t=HB(e.path,e.collectionGroup,n,e.filters,e.limit,r,s)}return e._t}function F4(t,e){e.getFirstInequalityField(),U5(t);const n=t.filters.concat([e]);return new D1(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function U4(t,e,n){return new D1(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function q5(t,e){return PL(mg(t),mg(e))&&t.limitType===e.limitType}function tW(t){return`${IL(mg(t))}|lt:${t.limitType}`}function q4(t){return`Query(target=${function(e){let n=e.path.canonicalString();return e.collectionGroup!==null&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=`, filters: [${e.filters.map(r=>JG(r)).join(", ")}]`),j5(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=`, orderBy: [${e.orderBy.map(r=>function(s){return`${s.field.canonicalString()} (${s.dir})`}(r)).join(", ")}]`),e.startAt&&(n+=", startAt: ",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>X0(r)).join(",")),e.endAt&&(n+=", endAt: ",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>X0(r)).join(",")),`Target(${n})`}(mg(t))}; limitType=${t.limitType})`}function V5(t,e){return e.isFoundDocument()&&function(n,r){const s=r.key.path;return n.collectionGroup!==null?r.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):Ki.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(t,e)&&function(n,r){for(const s of L0(n))if(!s.field.isKeyField()&&r.data.field(s.field)===null)return!1;return!0}(t,e)&&function(n,r){for(const s of n.filters)if(!s.matches(r))return!1;return!0}(t,e)&&function(n,r){return!(n.startAt&&!function(s,l,f){const i=VB(s,l,f);return s.inclusive?i<=0:i<0}(n.startAt,L0(n),r)||n.endAt&&!function(s,l,f){const i=VB(s,l,f);return s.inclusive?i>=0:i>0}(n.endAt,L0(n),r))}(t,e)}function _oe(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function nW(t){return(e,n)=>{let r=!1;for(const s of L0(t)){const l=voe(s,e,n);if(l!==0)return l;r=r||s.field.isKeyField()}return 0}}function voe(t,e,n){const r=t.field.isKeyField()?Ki.comparator(e.key,n.key):function(s,l,f){const i=l.data.field(s),x=f.data.field(s);return i!==null&&x!==null?Y0(i,x):Qi()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Qi()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L1{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[s,l]of r)if(this.equalsFn(s,e))return l}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let l=0;l<s.length;l++)if(this.equalsFn(s[l][0],e))return void(s[l]=[e,n]);s.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[n]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){fv(this.inner,(n,r)=>{for(const[s,l]of r)e(s,l)})}isEmpty(){return HG(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const boe=new oc(Ki.comparator);function gg(){return boe}const rW=new oc(Ki.comparator);function xx(...t){let e=rW;for(const n of t)e=e.insert(n.key,n);return e}function iW(t){let e=rW;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function z_(){return Px()}function aW(){return Px()}function Px(){return new L1(t=>t.toString(),(t,e)=>t.isEqual(e))}const xoe=new oc(Ki.comparator),woe=new dh(Ki.comparator);function ja(...t){let e=woe;for(const n of t)e=e.add(n);return e}const Soe=new dh(gs);function Aoe(){return Soe}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sW(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:rT(e)?"-0":e}}function oW(t){return{integerValue:""+t}}function Toe(t,e){return roe(e)?oW(e):sW(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $5{constructor(){this._=void 0}}function Eoe(t,e,n){return t instanceof aT?function(r,s){const l={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&EL(s)&&(s=ML(s)),s&&(l.fields.__previous_value__=s),{mapValue:l}}(n,e):t instanceof rw?cW(t,e):t instanceof iw?uW(t,e):function(r,s){const l=lW(r,s),f=WB(l)+WB(r.gt);return z4(l)&&z4(r.gt)?oW(f):sW(r.serializer,f)}(t,e)}function Moe(t,e,n){return t instanceof rw?cW(t,e):t instanceof iw?uW(t,e):n}function lW(t,e){return t instanceof sT?z4(n=e)||function(r){return!!r&&"doubleValue"in r}(n)?e:{integerValue:0}:null;var n}class aT extends $5{}class rw extends $5{constructor(e){super(),this.elements=e}}function cW(t,e){const n=hW(e);for(const r of t.elements)n.some(s=>Mm(s,r))||n.push(r);return{arrayValue:{values:n}}}class iw extends $5{constructor(e){super(),this.elements=e}}function uW(t,e){let n=hW(e);for(const r of t.elements)n=n.filter(s=>!Mm(s,r));return{arrayValue:{values:n}}}class sT extends $5{constructor(e,n){super(),this.serializer=e,this.gt=n}}function WB(t){return ic(t.integerValue||t.doubleValue)}function hW(t){return CL(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function Coe(t,e){return t.field.isEqual(e.field)&&function(n,r){return n instanceof rw&&r instanceof rw||n instanceof iw&&r instanceof iw?K0(n.elements,r.elements,Mm):n instanceof sT&&r instanceof sT?Mm(n.gt,r.gt):n instanceof aT&&r instanceof aT}(t.transform,e.transform)}class Ioe{constructor(e,n){this.version=e,this.transformResults=n}}class Ef{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new Ef}static exists(e){return new Ef(void 0,e)}static updateTime(e){return new Ef(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function TA(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class H5{}function fW(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new G5(t.key,Ef.none()):new l2(t.key,t.data,Ef.none());{const n=t.data,r=Af.empty();let s=new dh(Em.comparator);for(let l of e.fields)if(!s.has(l)){let f=n.field(l);f===null&&l.length>1&&(l=l.popLast(),f=n.field(l)),f===null?r.delete(l):r.set(l,f),s=s.add(l)}return new Dy(t.key,r,new rd(s.toArray()),Ef.none())}}function Poe(t,e,n){t instanceof l2?function(r,s,l){const f=r.value.clone(),i=YB(r.fieldTransforms,s,l.transformResults);f.setAll(i),s.convertToFoundDocument(l.version,f).setHasCommittedMutations()}(t,e,n):t instanceof Dy?function(r,s,l){if(!TA(r.precondition,s))return void s.convertToUnknownDocument(l.version);const f=YB(r.fieldTransforms,s,l.transformResults),i=s.data;i.setAll(dW(r)),i.setAll(f),s.convertToFoundDocument(l.version,i).setHasCommittedMutations()}(t,e,n):function(r,s,l){s.convertToNoDocument(l.version).setHasCommittedMutations()}(0,e,n)}function Ox(t,e,n,r){return t instanceof l2?function(s,l,f,i){if(!TA(s.precondition,l))return f;const x=s.value.clone(),S=XB(s.fieldTransforms,i,l);return x.setAll(S),l.convertToFoundDocument(l.version,x).setHasLocalMutations(),null}(t,e,n,r):t instanceof Dy?function(s,l,f,i){if(!TA(s.precondition,l))return f;const x=XB(s.fieldTransforms,i,l),S=l.data;return S.setAll(dW(s)),S.setAll(x),l.convertToFoundDocument(l.version,S).setHasLocalMutations(),f===null?null:f.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(I=>I.field))}(t,e,n,r):function(s,l,f){return TA(s.precondition,l)?(l.convertToNoDocument(l.version).setHasLocalMutations(),null):f}(t,e,n)}function Ooe(t,e){let n=null;for(const r of t.fieldTransforms){const s=e.data.field(r.field),l=lW(r.transform,s||null);l!=null&&(n===null&&(n=Af.empty()),n.set(r.field,l))}return n||null}function KB(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(n,r){return n===void 0&&r===void 0||!(!n||!r)&&K0(n,r,(s,l)=>Coe(s,l))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class l2 extends H5{constructor(e,n,r,s=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Dy extends H5{constructor(e,n,r,s,l=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=s,this.fieldTransforms=l,this.type=1}getFieldMask(){return this.fieldMask}}function dW(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function YB(t,e,n){const r=new Map;Po(t.length===n.length);for(let s=0;s<n.length;s++){const l=t[s],f=l.transform,i=e.data.field(l.field);r.set(l.field,Moe(f,i,n[s]))}return r}function XB(t,e,n){const r=new Map;for(const s of t){const l=s.transform,f=n.data.field(s.field);r.set(s.field,Eoe(l,f,e))}return r}class G5 extends H5{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Roe extends H5{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Doe{constructor(e,n,r,s){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let s=0;s<this.mutations.length;s++){const l=this.mutations[s];l.key.isEqual(e.key)&&Poe(l,e,r[s])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=Ox(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=Ox(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=aW();return this.mutations.forEach(s=>{const l=e.get(s.key),f=l.overlayedDocument;let i=this.applyToLocalView(f,l.mutatedFields);i=n.has(s.key)?null:i;const x=fW(f,i);x!==null&&r.set(s.key,x),f.isValidDocument()||f.convertToNoDocument(Aa.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),ja())}isEqual(e){return this.batchId===e.batchId&&K0(this.mutations,e.mutations,(n,r)=>KB(n,r))&&K0(this.baseMutations,e.baseMutations,(n,r)=>KB(n,r))}}class RL{constructor(e,n,r,s){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=s}static from(e,n,r){Po(e.mutations.length===r.length);let s=xoe;const l=e.mutations;for(let f=0;f<l.length;f++)s=s.insert(l[f].key,r[f].version);return new RL(e,n,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Loe{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class koe{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nc,ts;function Noe(t){switch(t){default:return Qi();case nr.CANCELLED:case nr.UNKNOWN:case nr.DEADLINE_EXCEEDED:case nr.RESOURCE_EXHAUSTED:case nr.INTERNAL:case nr.UNAVAILABLE:case nr.UNAUTHENTICATED:return!1;case nr.INVALID_ARGUMENT:case nr.NOT_FOUND:case nr.ALREADY_EXISTS:case nr.PERMISSION_DENIED:case nr.FAILED_PRECONDITION:case nr.ABORTED:case nr.OUT_OF_RANGE:case nr.UNIMPLEMENTED:case nr.DATA_LOSS:return!0}}function pW(t){if(t===void 0)return pg("GRPC error has no .code"),nr.UNKNOWN;switch(t){case nc.OK:return nr.OK;case nc.CANCELLED:return nr.CANCELLED;case nc.UNKNOWN:return nr.UNKNOWN;case nc.DEADLINE_EXCEEDED:return nr.DEADLINE_EXCEEDED;case nc.RESOURCE_EXHAUSTED:return nr.RESOURCE_EXHAUSTED;case nc.INTERNAL:return nr.INTERNAL;case nc.UNAVAILABLE:return nr.UNAVAILABLE;case nc.UNAUTHENTICATED:return nr.UNAUTHENTICATED;case nc.INVALID_ARGUMENT:return nr.INVALID_ARGUMENT;case nc.NOT_FOUND:return nr.NOT_FOUND;case nc.ALREADY_EXISTS:return nr.ALREADY_EXISTS;case nc.PERMISSION_DENIED:return nr.PERMISSION_DENIED;case nc.FAILED_PRECONDITION:return nr.FAILED_PRECONDITION;case nc.ABORTED:return nr.ABORTED;case nc.OUT_OF_RANGE:return nr.OUT_OF_RANGE;case nc.UNIMPLEMENTED:return nr.UNIMPLEMENTED;case nc.DATA_LOSS:return nr.DATA_LOSS;default:return Qi()}}(ts=nc||(nc={}))[ts.OK=0]="OK",ts[ts.CANCELLED=1]="CANCELLED",ts[ts.UNKNOWN=2]="UNKNOWN",ts[ts.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ts[ts.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ts[ts.NOT_FOUND=5]="NOT_FOUND",ts[ts.ALREADY_EXISTS=6]="ALREADY_EXISTS",ts[ts.PERMISSION_DENIED=7]="PERMISSION_DENIED",ts[ts.UNAUTHENTICATED=16]="UNAUTHENTICATED",ts[ts.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ts[ts.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ts[ts.ABORTED=10]="ABORTED",ts[ts.OUT_OF_RANGE=11]="OUT_OF_RANGE",ts[ts.UNIMPLEMENTED=12]="UNIMPLEMENTED",ts[ts.INTERNAL=13]="INTERNAL",ts[ts.UNAVAILABLE=14]="UNAVAILABLE",ts[ts.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DL{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return KS}static getOrCreateInstance(){return KS===null&&(KS=new DL),KS}onExistenceFilterMismatch(e){const n=Symbol();return this.onExistenceFilterMismatchCallbacks.set(n,e),()=>this.onExistenceFilterMismatchCallbacks.delete(n)}notifyOnExistenceFilterMismatch(e){this.onExistenceFilterMismatchCallbacks.forEach(n=>n(e))}}let KS=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zoe(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Boe=new R0([4294967295,4294967295],0);function ZB(t){const e=zoe().encode(t),n=new qse;return n.update(e),new Uint8Array(n.digest())}function JB(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),l=e.getUint32(12,!0);return[new R0([n,r],0),new R0([s,l],0)]}class LL{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new wx(`Invalid padding: ${n}`);if(r<0)throw new wx(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new wx(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new wx(`Invalid padding when bitmap length is 0: ${n}`);this.It=8*e.length-n,this.Tt=R0.fromNumber(this.It)}Et(e,n,r){let s=e.add(n.multiply(R0.fromNumber(r)));return s.compare(Boe)===1&&(s=new R0([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Tt).toNumber()}At(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}vt(e){if(this.It===0)return!1;const n=ZB(e),[r,s]=JB(n);for(let l=0;l<this.hashCount;l++){const f=this.Et(r,s,l);if(!this.At(f))return!1}return!0}static create(e,n,r){const s=e%8==0?0:8-e%8,l=new Uint8Array(Math.ceil(e/8)),f=new LL(l,s,n);return r.forEach(i=>f.insert(i)),f}insert(e){if(this.It===0)return;const n=ZB(e),[r,s]=JB(n);for(let l=0;l<this.hashCount;l++){const f=this.Et(r,s,l);this.Rt(f)}}Rt(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class wx extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W5{constructor(e,n,r,s,l){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=l}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const s=new Map;return s.set(e,c2.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new W5(Aa.min(),s,new oc(gs),gg(),ja())}}class c2{constructor(e,n,r,s,l){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=l}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new c2(r,n,ja(),ja(),ja())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EA{constructor(e,n,r,s){this.Pt=e,this.removedTargetIds=n,this.key=r,this.bt=s}}let mW=class{constructor(e,n){this.targetId=e,this.Vt=n}};class gW{constructor(e,n,r=mh.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=s}}class QB{constructor(){this.St=0,this.Dt=tj(),this.Ct=mh.EMPTY_BYTE_STRING,this.xt=!1,this.Nt=!0}get current(){return this.xt}get resumeToken(){return this.Ct}get kt(){return this.St!==0}get Mt(){return this.Nt}$t(e){e.approximateByteSize()>0&&(this.Nt=!0,this.Ct=e)}Ot(){let e=ja(),n=ja(),r=ja();return this.Dt.forEach((s,l)=>{switch(l){case 0:e=e.add(s);break;case 2:n=n.add(s);break;case 1:r=r.add(s);break;default:Qi()}}),new c2(this.Ct,this.xt,e,n,r)}Ft(){this.Nt=!1,this.Dt=tj()}Bt(e,n){this.Nt=!0,this.Dt=this.Dt.insert(e,n)}Lt(e){this.Nt=!0,this.Dt=this.Dt.remove(e)}qt(){this.St+=1}Ut(){this.St-=1}Kt(){this.Nt=!0,this.xt=!0}}class joe{constructor(e){this.Gt=e,this.Qt=new Map,this.jt=gg(),this.zt=ej(),this.Wt=new oc(gs)}Ht(e){for(const n of e.Pt)e.bt&&e.bt.isFoundDocument()?this.Jt(n,e.bt):this.Yt(n,e.key,e.bt);for(const n of e.removedTargetIds)this.Yt(n,e.key,e.bt)}Xt(e){this.forEachTarget(e,n=>{const r=this.Zt(n);switch(e.state){case 0:this.te(n)&&r.$t(e.resumeToken);break;case 1:r.Ut(),r.kt||r.Ft(),r.$t(e.resumeToken);break;case 2:r.Ut(),r.kt||this.removeTarget(n);break;case 3:this.te(n)&&(r.Kt(),r.$t(e.resumeToken));break;case 4:this.te(n)&&(this.ee(n),r.$t(e.resumeToken));break;default:Qi()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.Qt.forEach((r,s)=>{this.te(s)&&n(s)})}ne(e){var n;const r=e.targetId,s=e.Vt.count,l=this.se(r);if(l){const f=l.target;if(j4(f))if(s===0){const i=new Ki(f.path);this.Yt(r,i,oh.newNoDocument(i,Aa.min()))}else Po(s===1);else{const i=this.ie(r);if(i!==s){const x=this.re(e,i);if(x!==0){this.ee(r);const S=x===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Wt=this.Wt.insert(r,S)}(n=DL.instance)===null||n===void 0||n.notifyOnExistenceFilterMismatch(function(S,I,R){var F,j,H,G,W,J;const ie={localCacheCount:I,existenceFilterCount:R.count},he=R.unchangedNames;return he&&(ie.bloomFilter={applied:S===0,hashCount:(F=he==null?void 0:he.hashCount)!==null&&F!==void 0?F:0,bitmapLength:(G=(H=(j=he==null?void 0:he.bits)===null||j===void 0?void 0:j.bitmap)===null||H===void 0?void 0:H.length)!==null&&G!==void 0?G:0,padding:(J=(W=he==null?void 0:he.bits)===null||W===void 0?void 0:W.padding)!==null&&J!==void 0?J:0}),ie}(x,i,e.Vt))}}}}re(e,n){const{unchangedNames:r,count:s}=e.Vt;if(!r||!r.bits)return 1;const{bits:{bitmap:l="",padding:f=0},hashCount:i=0}=r;let x,S;try{x=tv(l).toUint8Array()}catch(I){if(I instanceof GG)return W0("Decoding the base64 bloom filter in existence filter failed ("+I.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw I}try{S=new LL(x,f,i)}catch(I){return W0(I instanceof wx?"BloomFilter error: ":"Applying bloom filter failed: ",I),1}return S.It===0?1:s!==n-this.oe(e.targetId,S)?2:0}oe(e,n){const r=this.Gt.getRemoteKeysForTarget(e);let s=0;return r.forEach(l=>{const f=this.Gt.ue(),i=`projects/${f.projectId}/databases/${f.database}/documents/${l.path.canonicalString()}`;n.vt(i)||(this.Yt(e,l,null),s++)}),s}ce(e){const n=new Map;this.Qt.forEach((l,f)=>{const i=this.se(f);if(i){if(l.current&&j4(i.target)){const x=new Ki(i.target.path);this.jt.get(x)!==null||this.ae(f,x)||this.Yt(f,x,oh.newNoDocument(x,e))}l.Mt&&(n.set(f,l.Ot()),l.Ft())}});let r=ja();this.zt.forEach((l,f)=>{let i=!0;f.forEachWhile(x=>{const S=this.se(x);return!S||S.purpose==="TargetPurposeLimboResolution"||(i=!1,!1)}),i&&(r=r.add(l))}),this.jt.forEach((l,f)=>f.setReadTime(e));const s=new W5(e,n,this.Wt,this.jt,r);return this.jt=gg(),this.zt=ej(),this.Wt=new oc(gs),s}Jt(e,n){if(!this.te(e))return;const r=this.ae(e,n.key)?2:0;this.Zt(e).Bt(n.key,r),this.jt=this.jt.insert(n.key,n),this.zt=this.zt.insert(n.key,this.he(n.key).add(e))}Yt(e,n,r){if(!this.te(e))return;const s=this.Zt(e);this.ae(e,n)?s.Bt(n,1):s.Lt(n),this.zt=this.zt.insert(n,this.he(n).delete(e)),r&&(this.jt=this.jt.insert(n,r))}removeTarget(e){this.Qt.delete(e)}ie(e){const n=this.Zt(e).Ot();return this.Gt.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}qt(e){this.Zt(e).qt()}Zt(e){let n=this.Qt.get(e);return n||(n=new QB,this.Qt.set(e,n)),n}he(e){let n=this.zt.get(e);return n||(n=new dh(gs),this.zt=this.zt.insert(e,n)),n}te(e){const n=this.se(e)!==null;return n||hi("WatchChangeAggregator","Detected inactive target",e),n}se(e){const n=this.Qt.get(e);return n&&n.kt?null:this.Gt.le(e)}ee(e){this.Qt.set(e,new QB),this.Gt.getRemoteKeysForTarget(e).forEach(n=>{this.Yt(e,n,null)})}ae(e,n){return this.Gt.getRemoteKeysForTarget(e).has(n)}}function ej(){return new oc(Ki.comparator)}function tj(){return new oc(Ki.comparator)}const Foe={asc:"ASCENDING",desc:"DESCENDING"},Uoe={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},qoe={and:"AND",or:"OR"};class Voe{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function V4(t,e){return t.useProto3Json||j5(e)?e:{value:e}}function oT(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function yW(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function $oe(t,e){return oT(t,e.toTimestamp())}function wm(t){return Po(!!t),Aa.fromTimestamp(function(e){const n=Ey(e);return new Xh(n.seconds,n.nanos)}(t))}function kL(t,e){return function(n){return new kl(["projects",n.projectId,"databases",n.database])}(t).child("documents").child(e).canonicalString()}function _W(t){const e=kl.fromString(t);return Po(wW(e)),e}function $4(t,e){return kL(t.databaseId,e.path)}function SM(t,e){const n=_W(e);if(n.get(1)!==t.databaseId.projectId)throw new $r(nr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new $r(nr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Ki(vW(n))}function H4(t,e){return kL(t.databaseId,e)}function Hoe(t){const e=_W(t);return e.length===4?kl.emptyPath():vW(e)}function G4(t){return new kl(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function vW(t){return Po(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function nj(t,e,n){return{name:$4(t,e),fields:n.value.mapValue.fields}}function Goe(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(x){return x==="NO_CHANGE"?0:x==="ADD"?1:x==="REMOVE"?2:x==="CURRENT"?3:x==="RESET"?4:Qi()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],l=function(x,S){return x.useProto3Json?(Po(S===void 0||typeof S=="string"),mh.fromBase64String(S||"")):(Po(S===void 0||S instanceof Uint8Array),mh.fromUint8Array(S||new Uint8Array))}(t,e.targetChange.resumeToken),f=e.targetChange.cause,i=f&&function(x){const S=x.code===void 0?nr.UNKNOWN:pW(x.code);return new $r(S,x.message||"")}(f);n=new gW(r,s,l,i||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=SM(t,r.document.name),l=wm(r.document.updateTime),f=r.document.createTime?wm(r.document.createTime):Aa.min(),i=new Af({mapValue:{fields:r.document.fields}}),x=oh.newFoundDocument(s,l,f,i),S=r.targetIds||[],I=r.removedTargetIds||[];n=new EA(S,I,x.key,x)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=SM(t,r.document),l=r.readTime?wm(r.readTime):Aa.min(),f=oh.newNoDocument(s,l),i=r.removedTargetIds||[];n=new EA([],i,f.key,f)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=SM(t,r.document),l=r.removedTargetIds||[];n=new EA([],l,s,null)}else{if(!("filter"in e))return Qi();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:l}=r,f=new koe(s,l),i=r.targetId;n=new mW(i,f)}}return n}function Woe(t,e){let n;if(e instanceof l2)n={update:nj(t,e.key,e.value)};else if(e instanceof G5)n={delete:$4(t,e.key)};else if(e instanceof Dy)n={update:nj(t,e.key,e.data),updateMask:nle(e.fieldMask)};else{if(!(e instanceof Roe))return Qi();n={verify:$4(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(s,l){const f=l.transform;if(f instanceof aT)return{fieldPath:l.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(f instanceof rw)return{fieldPath:l.field.canonicalString(),appendMissingElements:{values:f.elements}};if(f instanceof iw)return{fieldPath:l.field.canonicalString(),removeAllFromArray:{values:f.elements}};if(f instanceof sT)return{fieldPath:l.field.canonicalString(),increment:f.gt};throw Qi()}(0,r))),e.precondition.isNone||(n.currentDocument=function(r,s){return s.updateTime!==void 0?{updateTime:$oe(r,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:Qi()}(t,e.precondition)),n}function Koe(t,e){return t&&t.length>0?(Po(e!==void 0),t.map(n=>function(r,s){let l=r.updateTime?wm(r.updateTime):wm(s);return l.isEqual(Aa.min())&&(l=wm(s)),new Ioe(l,r.transformResults||[])}(n,e))):[]}function Yoe(t,e){return{documents:[H4(t,e.path)]}}function Xoe(t,e){const n={structuredQuery:{}},r=e.path;e.collectionGroup!==null?(n.parent=H4(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=H4(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const s=function(x){if(x.length!==0)return xW(Pp.create(x,"and"))}(e.filters);s&&(n.structuredQuery.where=s);const l=function(x){if(x.length!==0)return x.map(S=>function(I){return{field:m0(I.field),direction:Qoe(I.dir)}}(S))}(e.orderBy);l&&(n.structuredQuery.orderBy=l);const f=V4(t,e.limit);var i;return f!==null&&(n.structuredQuery.limit=f),e.startAt&&(n.structuredQuery.startAt={before:(i=e.startAt).inclusive,values:i.position}),e.endAt&&(n.structuredQuery.endAt=function(x){return{before:!x.inclusive,values:x.position}}(e.endAt)),n}function Zoe(t){let e=Hoe(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){Po(r===1);const I=n.from[0];I.allDescendants?s=I.collectionId:e=e.child(I.collectionId)}let l=[];n.where&&(l=function(I){const R=bW(I);return R instanceof Pp&&XG(R)?R.getFilters():[R]}(n.where));let f=[];n.orderBy&&(f=n.orderBy.map(I=>function(R){return new D0(g0(R.field),function(F){switch(F){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(R.direction))}(I)));let i=null;n.limit&&(i=function(I){let R;return R=typeof I=="object"?I.value:I,j5(R)?null:R}(n.limit));let x=null;n.startAt&&(x=function(I){const R=!!I.before,F=I.values||[];return new iT(F,R)}(n.startAt));let S=null;return n.endAt&&(S=function(I){const R=!I.before,F=I.values||[];return new iT(F,R)}(n.endAt)),yoe(e,s,f,l,i,"F",x,S)}function Joe(t,e){const n=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Qi()}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function bW(t){return t.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":const n=g0(e.unaryFilter.field);return ac.create(n,"==",{doubleValue:NaN});case"IS_NULL":const r=g0(e.unaryFilter.field);return ac.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=g0(e.unaryFilter.field);return ac.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const l=g0(e.unaryFilter.field);return ac.create(l,"!=",{nullValue:"NULL_VALUE"});default:return Qi()}}(t):t.fieldFilter!==void 0?function(e){return ac.create(g0(e.fieldFilter.field),function(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Qi()}}(e.fieldFilter.op),e.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(e){return Pp.create(e.compositeFilter.filters.map(n=>bW(n)),function(n){switch(n){case"AND":return"and";case"OR":return"or";default:return Qi()}}(e.compositeFilter.op))}(t):Qi()}function Qoe(t){return Foe[t]}function ele(t){return Uoe[t]}function tle(t){return qoe[t]}function m0(t){return{fieldPath:t.canonicalString()}}function g0(t){return Em.fromServerFormat(t.fieldPath)}function xW(t){return t instanceof ac?function(e){if(e.op==="=="){if(qB(e.value))return{unaryFilter:{field:m0(e.field),op:"IS_NAN"}};if(UB(e.value))return{unaryFilter:{field:m0(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(qB(e.value))return{unaryFilter:{field:m0(e.field),op:"IS_NOT_NAN"}};if(UB(e.value))return{unaryFilter:{field:m0(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:m0(e.field),op:ele(e.op),value:e.value}}}(t):t instanceof Pp?function(e){const n=e.getFilters().map(r=>xW(r));return n.length===1?n[0]:{compositeFilter:{op:tle(e.op),filters:n}}}(t):Qi()}function nle(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function wW(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yy{constructor(e,n,r,s,l=Aa.min(),f=Aa.min(),i=mh.EMPTY_BYTE_STRING,x=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=l,this.lastLimboFreeSnapshotVersion=f,this.resumeToken=i,this.expectedCount=x}withSequenceNumber(e){return new yy(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new yy(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new yy(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new yy(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rle{constructor(e){this.fe=e}}function ile(t){const e=Zoe({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?U4(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ale{constructor(){this.rn=new sle}addToCollectionParentIndex(e,n){return this.rn.add(n),kr.resolve()}getCollectionParents(e,n){return kr.resolve(this.rn.getEntries(n))}addFieldIndex(e,n){return kr.resolve()}deleteFieldIndex(e,n){return kr.resolve()}getDocumentsMatchingTarget(e,n){return kr.resolve(null)}getIndexType(e,n){return kr.resolve(0)}getFieldIndexes(e,n){return kr.resolve([])}getNextCollectionGroupToUpdate(e){return kr.resolve(null)}getMinOffset(e,n){return kr.resolve(Qx.min())}getMinOffsetFromCollectionGroup(e,n){return kr.resolve(Qx.min())}updateCollectionGroup(e,n,r){return kr.resolve()}updateIndexEntries(e,n){return kr.resolve()}}class sle{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n]||new dh(kl.comparator),l=!s.has(r);return this.index[n]=s.add(r),l}has(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n];return s&&s.has(r)}getEntries(e){return(this.index[e]||new dh(kl.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z0{constructor(e){this.Nn=e}next(){return this.Nn+=2,this.Nn}static kn(){return new Z0(0)}static Mn(){return new Z0(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ole{constructor(){this.changes=new L1(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,oh.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?kr.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lle{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cle{constructor(e,n,r,s){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,n))).next(s=>(r!==null&&Ox(r.mutation,s,rd.empty(),Xh.now()),s))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,ja()).next(()=>r))}getLocalViewOfDocuments(e,n,r=ja()){const s=z_();return this.populateOverlays(e,s,n).next(()=>this.computeViews(e,n,s,r).next(l=>{let f=xx();return l.forEach((i,x)=>{f=f.insert(i,x.overlayedDocument)}),f}))}getOverlayedDocuments(e,n){const r=z_();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,ja()))}populateOverlays(e,n,r){const s=[];return r.forEach(l=>{n.has(l)||s.push(l)}),this.documentOverlayCache.getOverlays(e,s).next(l=>{l.forEach((f,i)=>{n.set(f,i)})})}computeViews(e,n,r,s){let l=gg();const f=Px(),i=Px();return n.forEach((x,S)=>{const I=r.get(S.key);s.has(S.key)&&(I===void 0||I.mutation instanceof Dy)?l=l.insert(S.key,S):I!==void 0?(f.set(S.key,I.mutation.getFieldMask()),Ox(I.mutation,S,I.mutation.getFieldMask(),Xh.now())):f.set(S.key,rd.empty())}),this.recalculateAndSaveOverlays(e,l).next(x=>(x.forEach((S,I)=>f.set(S,I)),n.forEach((S,I)=>{var R;return i.set(S,new lle(I,(R=f.get(S))!==null&&R!==void 0?R:null))}),i))}recalculateAndSaveOverlays(e,n){const r=Px();let s=new oc((f,i)=>f-i),l=ja();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(f=>{for(const i of f)i.keys().forEach(x=>{const S=n.get(x);if(S===null)return;let I=r.get(x)||rd.empty();I=i.applyToLocalView(S,I),r.set(x,I);const R=(s.get(i.batchId)||ja()).add(x);s=s.insert(i.batchId,R)})}).next(()=>{const f=[],i=s.getReverseIterator();for(;i.hasNext();){const x=i.getNext(),S=x.key,I=x.value,R=aW();I.forEach(F=>{if(!l.has(F)){const j=fW(n.get(F),r.get(F));j!==null&&R.set(F,j),l=l.add(F)}}),f.push(this.documentOverlayCache.saveOverlays(e,S,R))}return kr.waitFor(f)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r){return function(s){return Ki.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):eW(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r):this.getDocumentsMatchingCollectionQuery(e,n,r)}getNextDocuments(e,n,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,s).next(l=>{const f=s-l.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,s-l.size):kr.resolve(z_());let i=-1,x=l;return f.next(S=>kr.forEach(S,(I,R)=>(i<R.largestBatchId&&(i=R.largestBatchId),l.get(I)?kr.resolve():this.remoteDocumentCache.getEntry(e,I).next(F=>{x=x.insert(I,F)}))).next(()=>this.populateOverlays(e,S,l)).next(()=>this.computeViews(e,x,S,ja())).next(I=>({batchId:i,changes:iW(I)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new Ki(n)).next(r=>{let s=xx();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,n,r){const s=n.collectionGroup;let l=xx();return this.indexManager.getCollectionParents(e,s).next(f=>kr.forEach(f,i=>{const x=function(S,I){return new D1(I,null,S.explicitOrderBy.slice(),S.filters.slice(),S.limit,S.limitType,S.startAt,S.endAt)}(n,i.child(s));return this.getDocumentsMatchingCollectionQuery(e,x,r).next(S=>{S.forEach((I,R)=>{l=l.insert(I,R)})})}).next(()=>l))}getDocumentsMatchingCollectionQuery(e,n,r){let s;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(l=>(s=l,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,s))).next(l=>{s.forEach((i,x)=>{const S=x.getKey();l.get(S)===null&&(l=l.insert(S,oh.newInvalidDocument(S)))});let f=xx();return l.forEach((i,x)=>{const S=s.get(i);S!==void 0&&Ox(S.mutation,x,rd.empty(),Xh.now()),V5(n,x)&&(f=f.insert(i,x))}),f})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ule{constructor(e){this.serializer=e,this.cs=new Map,this.hs=new Map}getBundleMetadata(e,n){return kr.resolve(this.cs.get(n))}saveBundleMetadata(e,n){var r;return this.cs.set(n.id,{id:(r=n).id,version:r.version,createTime:wm(r.createTime)}),kr.resolve()}getNamedQuery(e,n){return kr.resolve(this.hs.get(n))}saveNamedQuery(e,n){return this.hs.set(n.name,function(r){return{name:r.name,query:ile(r.bundledQuery),readTime:wm(r.readTime)}}(n)),kr.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hle{constructor(){this.overlays=new oc(Ki.comparator),this.ls=new Map}getOverlay(e,n){return kr.resolve(this.overlays.get(n))}getOverlays(e,n){const r=z_();return kr.forEach(n,s=>this.getOverlay(e,s).next(l=>{l!==null&&r.set(s,l)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((s,l)=>{this.we(e,n,l)}),kr.resolve()}removeOverlaysForBatchId(e,n,r){const s=this.ls.get(r);return s!==void 0&&(s.forEach(l=>this.overlays=this.overlays.remove(l)),this.ls.delete(r)),kr.resolve()}getOverlaysForCollection(e,n,r){const s=z_(),l=n.length+1,f=new Ki(n.child("")),i=this.overlays.getIteratorFrom(f);for(;i.hasNext();){const x=i.getNext().value,S=x.getKey();if(!n.isPrefixOf(S.path))break;S.path.length===l&&x.largestBatchId>r&&s.set(x.getKey(),x)}return kr.resolve(s)}getOverlaysForCollectionGroup(e,n,r,s){let l=new oc((S,I)=>S-I);const f=this.overlays.getIterator();for(;f.hasNext();){const S=f.getNext().value;if(S.getKey().getCollectionGroup()===n&&S.largestBatchId>r){let I=l.get(S.largestBatchId);I===null&&(I=z_(),l=l.insert(S.largestBatchId,I)),I.set(S.getKey(),S)}}const i=z_(),x=l.getIterator();for(;x.hasNext()&&(x.getNext().value.forEach((S,I)=>i.set(S,I)),!(i.size()>=s)););return kr.resolve(i)}we(e,n,r){const s=this.overlays.get(r.key);if(s!==null){const f=this.ls.get(s.largestBatchId).delete(r.key);this.ls.set(s.largestBatchId,f)}this.overlays=this.overlays.insert(r.key,new Loe(n,r));let l=this.ls.get(n);l===void 0&&(l=ja(),this.ls.set(n,l)),this.ls.set(n,l.add(r.key))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NL{constructor(){this.fs=new dh(Zc.ds),this.ws=new dh(Zc._s)}isEmpty(){return this.fs.isEmpty()}addReference(e,n){const r=new Zc(e,n);this.fs=this.fs.add(r),this.ws=this.ws.add(r)}gs(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.ys(new Zc(e,n))}ps(e,n){e.forEach(r=>this.removeReference(r,n))}Is(e){const n=new Ki(new kl([])),r=new Zc(n,e),s=new Zc(n,e+1),l=[];return this.ws.forEachInRange([r,s],f=>{this.ys(f),l.push(f.key)}),l}Ts(){this.fs.forEach(e=>this.ys(e))}ys(e){this.fs=this.fs.delete(e),this.ws=this.ws.delete(e)}Es(e){const n=new Ki(new kl([])),r=new Zc(n,e),s=new Zc(n,e+1);let l=ja();return this.ws.forEachInRange([r,s],f=>{l=l.add(f.key)}),l}containsKey(e){const n=new Zc(e,0),r=this.fs.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class Zc{constructor(e,n){this.key=e,this.As=n}static ds(e,n){return Ki.comparator(e.key,n.key)||gs(e.As,n.As)}static _s(e,n){return gs(e.As,n.As)||Ki.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fle{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.vs=1,this.Rs=new dh(Zc.ds)}checkEmpty(e){return kr.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,s){const l=this.vs;this.vs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const f=new Doe(l,n,r,s);this.mutationQueue.push(f);for(const i of s)this.Rs=this.Rs.add(new Zc(i.key,l)),this.indexManager.addToCollectionParentIndex(e,i.key.path.popLast());return kr.resolve(f)}lookupMutationBatch(e,n){return kr.resolve(this.Ps(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=this.bs(r),l=s<0?0:s;return kr.resolve(this.mutationQueue.length>l?this.mutationQueue[l]:null)}getHighestUnacknowledgedBatchId(){return kr.resolve(this.mutationQueue.length===0?-1:this.vs-1)}getAllMutationBatches(e){return kr.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new Zc(n,0),s=new Zc(n,Number.POSITIVE_INFINITY),l=[];return this.Rs.forEachInRange([r,s],f=>{const i=this.Ps(f.As);l.push(i)}),kr.resolve(l)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new dh(gs);return n.forEach(s=>{const l=new Zc(s,0),f=new Zc(s,Number.POSITIVE_INFINITY);this.Rs.forEachInRange([l,f],i=>{r=r.add(i.As)})}),kr.resolve(this.Vs(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1;let l=r;Ki.isDocumentKey(l)||(l=l.child(""));const f=new Zc(new Ki(l),0);let i=new dh(gs);return this.Rs.forEachWhile(x=>{const S=x.key.path;return!!r.isPrefixOf(S)&&(S.length===s&&(i=i.add(x.As)),!0)},f),kr.resolve(this.Vs(i))}Vs(e){const n=[];return e.forEach(r=>{const s=this.Ps(r);s!==null&&n.push(s)}),n}removeMutationBatch(e,n){Po(this.Ss(n.batchId,"removed")===0),this.mutationQueue.shift();let r=this.Rs;return kr.forEach(n.mutations,s=>{const l=new Zc(s.key,n.batchId);return r=r.delete(l),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Rs=r})}Cn(e){}containsKey(e,n){const r=new Zc(n,0),s=this.Rs.firstAfterOrEqual(r);return kr.resolve(n.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,kr.resolve()}Ss(e,n){return this.bs(e)}bs(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Ps(e){const n=this.bs(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dle{constructor(e){this.Ds=e,this.docs=new oc(Ki.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,s=this.docs.get(r),l=s?s.size:0,f=this.Ds(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:f}),this.size+=f-l,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return kr.resolve(r?r.document.mutableCopy():oh.newInvalidDocument(n))}getEntries(e,n){let r=gg();return n.forEach(s=>{const l=this.docs.get(s);r=r.insert(s,l?l.document.mutableCopy():oh.newInvalidDocument(s))}),kr.resolve(r)}getDocumentsMatchingQuery(e,n,r,s){let l=gg();const f=n.path,i=new Ki(f.child("")),x=this.docs.getIteratorFrom(i);for(;x.hasNext();){const{key:S,value:{document:I}}=x.getNext();if(!f.isPrefixOf(S.path))break;S.path.length>f.length+1||eoe(Qse(I),r)<=0||(s.has(I.key)||V5(n,I))&&(l=l.insert(I.key,I.mutableCopy()))}return kr.resolve(l)}getAllFromCollectionGroup(e,n,r,s){Qi()}Cs(e,n){return kr.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new ple(this)}getSize(e){return kr.resolve(this.size)}}class ple extends ole{constructor(e){super(),this.os=e}applyChanges(e){const n=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?n.push(this.os.addEntry(e,s)):this.os.removeEntry(r)}),kr.waitFor(n)}getFromCache(e,n){return this.os.getEntry(e,n)}getAllFromCache(e,n){return this.os.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mle{constructor(e){this.persistence=e,this.xs=new L1(n=>IL(n),PL),this.lastRemoteSnapshotVersion=Aa.min(),this.highestTargetId=0,this.Ns=0,this.ks=new NL,this.targetCount=0,this.Ms=Z0.kn()}forEachTarget(e,n){return this.xs.forEach((r,s)=>n(s)),kr.resolve()}getLastRemoteSnapshotVersion(e){return kr.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return kr.resolve(this.Ns)}allocateTargetId(e){return this.highestTargetId=this.Ms.next(),kr.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.Ns&&(this.Ns=n),kr.resolve()}Fn(e){this.xs.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.Ms=new Z0(n),this.highestTargetId=n),e.sequenceNumber>this.Ns&&(this.Ns=e.sequenceNumber)}addTargetData(e,n){return this.Fn(n),this.targetCount+=1,kr.resolve()}updateTargetData(e,n){return this.Fn(n),kr.resolve()}removeTargetData(e,n){return this.xs.delete(n.target),this.ks.Is(n.targetId),this.targetCount-=1,kr.resolve()}removeTargets(e,n,r){let s=0;const l=[];return this.xs.forEach((f,i)=>{i.sequenceNumber<=n&&r.get(i.targetId)===null&&(this.xs.delete(f),l.push(this.removeMatchingKeysForTargetId(e,i.targetId)),s++)}),kr.waitFor(l).next(()=>s)}getTargetCount(e){return kr.resolve(this.targetCount)}getTargetData(e,n){const r=this.xs.get(n)||null;return kr.resolve(r)}addMatchingKeys(e,n,r){return this.ks.gs(n,r),kr.resolve()}removeMatchingKeys(e,n,r){this.ks.ps(n,r);const s=this.persistence.referenceDelegate,l=[];return s&&n.forEach(f=>{l.push(s.markPotentiallyOrphaned(e,f))}),kr.waitFor(l)}removeMatchingKeysForTargetId(e,n){return this.ks.Is(n),kr.resolve()}getMatchingKeysForTargetId(e,n){const r=this.ks.Es(n);return kr.resolve(r)}containsKey(e,n){return kr.resolve(this.ks.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gle{constructor(e,n){this.$s={},this.overlays={},this.Os=new TL(0),this.Fs=!1,this.Fs=!0,this.referenceDelegate=e(this),this.Bs=new mle(this),this.indexManager=new ale,this.remoteDocumentCache=function(r){return new dle(r)}(r=>this.referenceDelegate.Ls(r)),this.serializer=new rle(n),this.qs=new ule(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Fs=!1,Promise.resolve()}get started(){return this.Fs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new hle,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.$s[e.toKey()];return r||(r=new fle(n,this.referenceDelegate),this.$s[e.toKey()]=r),r}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.qs}runTransaction(e,n,r){hi("MemoryPersistence","Starting transaction:",e);const s=new yle(this.Os.next());return this.referenceDelegate.Us(),r(s).next(l=>this.referenceDelegate.Ks(s).next(()=>l)).toPromise().then(l=>(s.raiseOnCommittedEvent(),l))}Gs(e,n){return kr.or(Object.values(this.$s).map(r=>()=>r.containsKey(e,n)))}}class yle extends noe{constructor(e){super(),this.currentSequenceNumber=e}}class zL{constructor(e){this.persistence=e,this.Qs=new NL,this.js=null}static zs(e){return new zL(e)}get Ws(){if(this.js)return this.js;throw Qi()}addReference(e,n,r){return this.Qs.addReference(r,n),this.Ws.delete(r.toString()),kr.resolve()}removeReference(e,n,r){return this.Qs.removeReference(r,n),this.Ws.add(r.toString()),kr.resolve()}markPotentiallyOrphaned(e,n){return this.Ws.add(n.toString()),kr.resolve()}removeTarget(e,n){this.Qs.Is(n.targetId).forEach(s=>this.Ws.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(s=>{s.forEach(l=>this.Ws.add(l.toString()))}).next(()=>r.removeTargetData(e,n))}Us(){this.js=new Set}Ks(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return kr.forEach(this.Ws,r=>{const s=Ki.fromPath(r);return this.Hs(e,s).next(l=>{l||n.removeEntry(s,Aa.min())})}).next(()=>(this.js=null,n.apply(e)))}updateLimboDocument(e,n){return this.Hs(e,n).next(r=>{r?this.Ws.delete(n.toString()):this.Ws.add(n.toString())})}Ls(e){return 0}Hs(e,n){return kr.or([()=>kr.resolve(this.Qs.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Gs(e,n)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BL{constructor(e,n,r,s){this.targetId=e,this.fromCache=n,this.Fi=r,this.Bi=s}static Li(e,n){let r=ja(),s=ja();for(const l of n.docChanges)switch(l.type){case 0:r=r.add(l.doc.key);break;case 1:s=s.add(l.doc.key)}return new BL(e,n.fromCache,r,s)}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _le{constructor(){this.qi=!1}initialize(e,n){this.Ui=e,this.indexManager=n,this.qi=!0}getDocumentsMatchingQuery(e,n,r,s){return this.Ki(e,n).next(l=>l||this.Gi(e,n,s,r)).next(l=>l||this.Qi(e,n))}Ki(e,n){if(GB(n))return kr.resolve(null);let r=mg(n);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(n.limit!==null&&s===1&&(n=U4(n,null,"F"),r=mg(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(l=>{const f=ja(...l);return this.Ui.getDocuments(e,f).next(i=>this.indexManager.getMinOffset(e,r).next(x=>{const S=this.ji(n,i);return this.zi(n,S,f,x.readTime)?this.Ki(e,U4(n,null,"F")):this.Wi(e,S,n,x)}))})))}Gi(e,n,r,s){return GB(n)||s.isEqual(Aa.min())?this.Qi(e,n):this.Ui.getDocuments(e,r).next(l=>{const f=this.ji(n,l);return this.zi(n,f,r,s)?this.Qi(e,n):(NB()<=hs.DEBUG&&hi("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),q4(n)),this.Wi(e,f,n,Jse(s,-1)))})}ji(e,n){let r=new dh(nW(e));return n.forEach((s,l)=>{V5(e,l)&&(r=r.add(l))}),r}zi(e,n,r,s){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const l=e.limitType==="F"?n.last():n.first();return!!l&&(l.hasPendingWrites||l.version.compareTo(s)>0)}Qi(e,n){return NB()<=hs.DEBUG&&hi("QueryEngine","Using full collection scan to execute query:",q4(n)),this.Ui.getDocumentsMatchingQuery(e,n,Qx.min())}Wi(e,n,r,s){return this.Ui.getDocumentsMatchingQuery(e,r,s).next(l=>(n.forEach(f=>{l=l.insert(f.key,f)}),l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vle{constructor(e,n,r,s){this.persistence=e,this.Hi=n,this.serializer=s,this.Ji=new oc(gs),this.Yi=new L1(l=>IL(l),PL),this.Xi=new Map,this.Zi=e.getRemoteDocumentCache(),this.Bs=e.getTargetCache(),this.qs=e.getBundleCache(),this.tr(r)}tr(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new cle(this.Zi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Zi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.Ji))}}function ble(t,e,n,r){return new vle(t,e,n,r)}async function SW(t,e){const n=da(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let s;return n.mutationQueue.getAllMutationBatches(r).next(l=>(s=l,n.tr(e),n.mutationQueue.getAllMutationBatches(r))).next(l=>{const f=[],i=[];let x=ja();for(const S of s){f.push(S.batchId);for(const I of S.mutations)x=x.add(I.key)}for(const S of l){i.push(S.batchId);for(const I of S.mutations)x=x.add(I.key)}return n.localDocuments.getDocuments(r,x).next(S=>({er:S,removedBatchIds:f,addedBatchIds:i}))})})}function xle(t,e){const n=da(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),l=n.Zi.newChangeBuffer({trackRemovals:!0});return function(f,i,x,S){const I=x.batch,R=I.keys();let F=kr.resolve();return R.forEach(j=>{F=F.next(()=>S.getEntry(i,j)).next(H=>{const G=x.docVersions.get(j);Po(G!==null),H.version.compareTo(G)<0&&(I.applyToRemoteDocument(H,x),H.isValidDocument()&&(H.setReadTime(x.commitVersion),S.addEntry(H)))})}),F.next(()=>f.mutationQueue.removeMutationBatch(i,I))}(n,r,e,l).next(()=>l.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(f){let i=ja();for(let x=0;x<f.mutationResults.length;++x)f.mutationResults[x].transformResults.length>0&&(i=i.add(f.batch.mutations[x].key));return i}(e))).next(()=>n.localDocuments.getDocuments(r,s))})}function AW(t){const e=da(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Bs.getLastRemoteSnapshotVersion(n))}function wle(t,e){const n=da(t),r=e.snapshotVersion;let s=n.Ji;return n.persistence.runTransaction("Apply remote event","readwrite-primary",l=>{const f=n.Zi.newChangeBuffer({trackRemovals:!0});s=n.Ji;const i=[];e.targetChanges.forEach((I,R)=>{const F=s.get(R);if(!F)return;i.push(n.Bs.removeMatchingKeys(l,I.removedDocuments,R).next(()=>n.Bs.addMatchingKeys(l,I.addedDocuments,R)));let j=F.withSequenceNumber(l.currentSequenceNumber);e.targetMismatches.get(R)!==null?j=j.withResumeToken(mh.EMPTY_BYTE_STRING,Aa.min()).withLastLimboFreeSnapshotVersion(Aa.min()):I.resumeToken.approximateByteSize()>0&&(j=j.withResumeToken(I.resumeToken,r)),s=s.insert(R,j),function(H,G,W){return H.resumeToken.approximateByteSize()===0||G.snapshotVersion.toMicroseconds()-H.snapshotVersion.toMicroseconds()>=3e8?!0:W.addedDocuments.size+W.modifiedDocuments.size+W.removedDocuments.size>0}(F,j,I)&&i.push(n.Bs.updateTargetData(l,j))});let x=gg(),S=ja();if(e.documentUpdates.forEach(I=>{e.resolvedLimboDocuments.has(I)&&i.push(n.persistence.referenceDelegate.updateLimboDocument(l,I))}),i.push(Sle(l,f,e.documentUpdates).next(I=>{x=I.nr,S=I.sr})),!r.isEqual(Aa.min())){const I=n.Bs.getLastRemoteSnapshotVersion(l).next(R=>n.Bs.setTargetsMetadata(l,l.currentSequenceNumber,r));i.push(I)}return kr.waitFor(i).next(()=>f.apply(l)).next(()=>n.localDocuments.getLocalViewOfDocuments(l,x,S)).next(()=>x)}).then(l=>(n.Ji=s,l))}function Sle(t,e,n){let r=ja(),s=ja();return n.forEach(l=>r=r.add(l)),e.getEntries(t,r).next(l=>{let f=gg();return n.forEach((i,x)=>{const S=l.get(i);x.isFoundDocument()!==S.isFoundDocument()&&(s=s.add(i)),x.isNoDocument()&&x.version.isEqual(Aa.min())?(e.removeEntry(i,x.readTime),f=f.insert(i,x)):!S.isValidDocument()||x.version.compareTo(S.version)>0||x.version.compareTo(S.version)===0&&S.hasPendingWrites?(e.addEntry(x),f=f.insert(i,x)):hi("LocalStore","Ignoring outdated watch update for ",i,". Current version:",S.version," Watch version:",x.version)}),{nr:f,sr:s}})}function Ale(t,e){const n=da(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Tle(t,e){const n=da(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return n.Bs.getTargetData(r,e).next(l=>l?(s=l,kr.resolve(s)):n.Bs.allocateTargetId(r).next(f=>(s=new yy(e,f,"TargetPurposeListen",r.currentSequenceNumber),n.Bs.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=n.Ji.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.Ji=n.Ji.insert(r.targetId,r),n.Yi.set(e,r.targetId)),r})}async function W4(t,e,n){const r=da(t),s=r.Ji.get(e),l=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",l,f=>r.persistence.referenceDelegate.removeTarget(f,s))}catch(f){if(!o2(f))throw f;hi("LocalStore",`Failed to update sequence numbers for target ${e}: ${f}`)}r.Ji=r.Ji.remove(e),r.Yi.delete(s.target)}function rj(t,e,n){const r=da(t);let s=Aa.min(),l=ja();return r.persistence.runTransaction("Execute query","readonly",f=>function(i,x,S){const I=da(i),R=I.Yi.get(S);return R!==void 0?kr.resolve(I.Ji.get(R)):I.Bs.getTargetData(x,S)}(r,f,mg(e)).next(i=>{if(i)return s=i.lastLimboFreeSnapshotVersion,r.Bs.getMatchingKeysForTargetId(f,i.targetId).next(x=>{l=x})}).next(()=>r.Hi.getDocumentsMatchingQuery(f,e,n?s:Aa.min(),n?l:ja())).next(i=>(Ele(r,_oe(e),i),{documents:i,ir:l})))}function Ele(t,e,n){let r=t.Xi.get(e)||Aa.min();n.forEach((s,l)=>{l.readTime.compareTo(r)>0&&(r=l.readTime)}),t.Xi.set(e,r)}class ij{constructor(){this.activeTargetIds=Aoe()}lr(e){this.activeTargetIds=this.activeTargetIds.add(e)}dr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}hr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Mle{constructor(){this.Hr=new ij,this.Jr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e){return this.Hr.lr(e),this.Jr[e]||"not-current"}updateQueryState(e,n,r){this.Jr[e]=n}removeLocalQueryTarget(e){this.Hr.dr(e)}isLocalQueryTarget(e){return this.Hr.activeTargetIds.has(e)}clearQueryState(e){delete this.Jr[e]}getAllActiveQueryTargets(){return this.Hr.activeTargetIds}isActiveQueryTarget(e){return this.Hr.activeTargetIds.has(e)}start(){return this.Hr=new ij,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cle{Yr(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aj{constructor(){this.Xr=()=>this.Zr(),this.eo=()=>this.no(),this.so=[],this.io()}Yr(e){this.so.push(e)}shutdown(){window.removeEventListener("online",this.Xr),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Xr),window.addEventListener("offline",this.eo)}Zr(){hi("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.so)e(0)}no(){hi("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.so)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let YS=null;function AM(){return YS===null?YS=268435456+Math.round(2147483648*Math.random()):YS++,"0x"+YS.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ile={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ple{constructor(e){this.ro=e.ro,this.oo=e.oo}uo(e){this.co=e}ao(e){this.ho=e}onMessage(e){this.lo=e}close(){this.oo()}send(e){this.ro(e)}fo(){this.co()}wo(e){this.ho(e)}_o(e){this.lo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eh="WebChannelConnection";class Ole extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http";this.mo=n+"://"+e.host,this.yo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get po(){return!1}Io(e,n,r,s,l){const f=AM(),i=this.To(e,n);hi("RestConnection",`Sending RPC '${e}' ${f}:`,i,r);const x={};return this.Eo(x,s,l),this.Ao(e,i,x,r).then(S=>(hi("RestConnection",`Received RPC '${e}' ${f}: `,S),S),S=>{throw W0("RestConnection",`RPC '${e}' ${f} failed with error: `,S,"url: ",i,"request:",r),S})}vo(e,n,r,s,l,f){return this.Io(e,n,r,s,l)}Eo(e,n,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+R1,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,l)=>e[l]=s),r&&r.headers.forEach((s,l)=>e[l]=s)}To(e,n){const r=Ile[e];return`${this.mo}/v1/${n}:${r}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Ao(e,n,r,s){const l=AM();return new Promise((f,i)=>{const x=new Use;x.setWithCredentials(!0),x.listenOnce(Bse.COMPLETE,()=>{try{switch(x.getLastErrorCode()){case wM.NO_ERROR:const I=x.getResponseJson();hi(eh,`XHR for RPC '${e}' ${l} received:`,JSON.stringify(I)),f(I);break;case wM.TIMEOUT:hi(eh,`RPC '${e}' ${l} timed out`),i(new $r(nr.DEADLINE_EXCEEDED,"Request time out"));break;case wM.HTTP_ERROR:const R=x.getStatus();if(hi(eh,`RPC '${e}' ${l} failed with status:`,R,"response text:",x.getResponseText()),R>0){let F=x.getResponseJson();Array.isArray(F)&&(F=F[0]);const j=F==null?void 0:F.error;if(j&&j.status&&j.message){const H=function(G){const W=G.toLowerCase().replace(/_/g,"-");return Object.values(nr).indexOf(W)>=0?W:nr.UNKNOWN}(j.status);i(new $r(H,j.message))}else i(new $r(nr.UNKNOWN,"Server responded with status "+x.getStatus()))}else i(new $r(nr.UNAVAILABLE,"Connection failed."));break;default:Qi()}}finally{hi(eh,`RPC '${e}' ${l} completed.`)}});const S=JSON.stringify(s);hi(eh,`RPC '${e}' ${l} sending request:`,s),x.send(n,"POST",S,r,15)})}Ro(e,n,r){const s=AM(),l=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],f=Nse(),i=zse(),x={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},S=this.longPollingOptions.timeoutSeconds;S!==void 0&&(x.longPollingTimeout=Math.round(1e3*S)),this.useFetchStreams&&(x.xmlHttpFactory=new Fse({})),this.Eo(x.initMessageHeaders,n,r),x.encodeInitMessageHeaders=!0;const I=l.join("");hi(eh,`Creating RPC '${e}' stream ${s}: ${I}`,x);const R=f.createWebChannel(I,x);let F=!1,j=!1;const H=new Ple({ro:W=>{j?hi(eh,`Not sending because RPC '${e}' stream ${s} is closed:`,W):(F||(hi(eh,`Opening RPC '${e}' stream ${s} transport.`),R.open(),F=!0),hi(eh,`RPC '${e}' stream ${s} sending:`,W),R.send(W))},oo:()=>R.close()}),G=(W,J,ie)=>{W.listen(J,he=>{try{ie(he)}catch(ge){setTimeout(()=>{throw ge},0)}})};return G(R,HS.EventType.OPEN,()=>{j||hi(eh,`RPC '${e}' stream ${s} transport opened.`)}),G(R,HS.EventType.CLOSE,()=>{j||(j=!0,hi(eh,`RPC '${e}' stream ${s} transport closed`),H.wo())}),G(R,HS.EventType.ERROR,W=>{j||(j=!0,W0(eh,`RPC '${e}' stream ${s} transport errored:`,W),H.wo(new $r(nr.UNAVAILABLE,"The operation could not be completed")))}),G(R,HS.EventType.MESSAGE,W=>{var J;if(!j){const ie=W.data[0];Po(!!ie);const he=ie,ge=he.error||((J=he[0])===null||J===void 0?void 0:J.error);if(ge){hi(eh,`RPC '${e}' stream ${s} received error:`,ge);const fe=ge.status;let ye=function(be){const Ae=nc[be];if(Ae!==void 0)return pW(Ae)}(fe),pe=ge.message;ye===void 0&&(ye=nr.INTERNAL,pe="Unknown error status: "+fe+" with message "+ge.message),j=!0,H.wo(new $r(ye,pe)),R.close()}else hi(eh,`RPC '${e}' stream ${s} received:`,ie),H._o(ie)}}),G(i,jse.STAT_EVENT,W=>{W.stat===LB.PROXY?hi(eh,`RPC '${e}' stream ${s} detected buffering proxy`):W.stat===LB.NOPROXY&&hi(eh,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{H.fo()},0),H}}function TM(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K5(t){return new Voe(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TW{constructor(e,n,r=1e3,s=1.5,l=6e4){this.ii=e,this.timerId=n,this.Po=r,this.bo=s,this.Vo=l,this.So=0,this.Do=null,this.Co=Date.now(),this.reset()}reset(){this.So=0}xo(){this.So=this.Vo}No(e){this.cancel();const n=Math.floor(this.So+this.ko()),r=Math.max(0,Date.now()-this.Co),s=Math.max(0,n-r);s>0&&hi("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.So} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.Do=this.ii.enqueueAfterDelay(this.timerId,s,()=>(this.Co=Date.now(),e())),this.So*=this.bo,this.So<this.Po&&(this.So=this.Po),this.So>this.Vo&&(this.So=this.Vo)}Mo(){this.Do!==null&&(this.Do.skipDelay(),this.Do=null)}cancel(){this.Do!==null&&(this.Do.cancel(),this.Do=null)}ko(){return(Math.random()-.5)*this.So}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EW{constructor(e,n,r,s,l,f,i,x){this.ii=e,this.$o=r,this.Oo=s,this.connection=l,this.authCredentialsProvider=f,this.appCheckCredentialsProvider=i,this.listener=x,this.state=0,this.Fo=0,this.Bo=null,this.Lo=null,this.stream=null,this.qo=new TW(e,n)}Uo(){return this.state===1||this.state===5||this.Ko()}Ko(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Go()}async stop(){this.Uo()&&await this.close(0)}Qo(){this.state=0,this.qo.reset()}jo(){this.Ko()&&this.Bo===null&&(this.Bo=this.ii.enqueueAfterDelay(this.$o,6e4,()=>this.zo()))}Wo(e){this.Ho(),this.stream.send(e)}async zo(){if(this.Ko())return this.close(0)}Ho(){this.Bo&&(this.Bo.cancel(),this.Bo=null)}Jo(){this.Lo&&(this.Lo.cancel(),this.Lo=null)}async close(e,n){this.Ho(),this.Jo(),this.qo.cancel(),this.Fo++,e!==4?this.qo.reset():n&&n.code===nr.RESOURCE_EXHAUSTED?(pg(n.toString()),pg("Using maximum backoff delay to prevent overloading the backend."),this.qo.xo()):n&&n.code===nr.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.Yo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.ao(n)}Yo(){}auth(){this.state=1;const e=this.Xo(this.Fo),n=this.Fo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Fo===n&&this.Zo(r,s)},r=>{e(()=>{const s=new $r(nr.UNKNOWN,"Fetching auth token failed: "+r.message);return this.tu(s)})})}Zo(e,n){const r=this.Xo(this.Fo);this.stream=this.eu(e,n),this.stream.uo(()=>{r(()=>(this.state=2,this.Lo=this.ii.enqueueAfterDelay(this.Oo,1e4,()=>(this.Ko()&&(this.state=3),Promise.resolve())),this.listener.uo()))}),this.stream.ao(s=>{r(()=>this.tu(s))}),this.stream.onMessage(s=>{r(()=>this.onMessage(s))})}Go(){this.state=5,this.qo.No(async()=>{this.state=0,this.start()})}tu(e){return hi("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Xo(e){return n=>{this.ii.enqueueAndForget(()=>this.Fo===e?n():(hi("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Rle extends EW{constructor(e,n,r,s,l,f){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,s,f),this.serializer=l}eu(e,n){return this.connection.Ro("Listen",e,n)}onMessage(e){this.qo.reset();const n=Goe(this.serializer,e),r=function(s){if(!("targetChange"in s))return Aa.min();const l=s.targetChange;return l.targetIds&&l.targetIds.length?Aa.min():l.readTime?wm(l.readTime):Aa.min()}(e);return this.listener.nu(n,r)}su(e){const n={};n.database=G4(this.serializer),n.addTarget=function(s,l){let f;const i=l.target;if(f=j4(i)?{documents:Yoe(s,i)}:{query:Xoe(s,i)},f.targetId=l.targetId,l.resumeToken.approximateByteSize()>0){f.resumeToken=yW(s,l.resumeToken);const x=V4(s,l.expectedCount);x!==null&&(f.expectedCount=x)}else if(l.snapshotVersion.compareTo(Aa.min())>0){f.readTime=oT(s,l.snapshotVersion.toTimestamp());const x=V4(s,l.expectedCount);x!==null&&(f.expectedCount=x)}return f}(this.serializer,e);const r=Joe(this.serializer,e);r&&(n.labels=r),this.Wo(n)}iu(e){const n={};n.database=G4(this.serializer),n.removeTarget=e,this.Wo(n)}}class Dle extends EW{constructor(e,n,r,s,l,f){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,s,f),this.serializer=l,this.ru=!1}get ou(){return this.ru}start(){this.ru=!1,this.lastStreamToken=void 0,super.start()}Yo(){this.ru&&this.uu([])}eu(e,n){return this.connection.Ro("Write",e,n)}onMessage(e){if(Po(!!e.streamToken),this.lastStreamToken=e.streamToken,this.ru){this.qo.reset();const n=Koe(e.writeResults,e.commitTime),r=wm(e.commitTime);return this.listener.cu(r,n)}return Po(!e.writeResults||e.writeResults.length===0),this.ru=!0,this.listener.au()}hu(){const e={};e.database=G4(this.serializer),this.Wo(e)}uu(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>Woe(this.serializer,r))};this.Wo(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lle extends class{}{constructor(e,n,r,s){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=s,this.lu=!1}fu(){if(this.lu)throw new $r(nr.FAILED_PRECONDITION,"The client has already been terminated.")}Io(e,n,r){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,l])=>this.connection.Io(e,n,r,s,l)).catch(s=>{throw s.name==="FirebaseError"?(s.code===nr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new $r(nr.UNKNOWN,s.toString())})}vo(e,n,r,s){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([l,f])=>this.connection.vo(e,n,r,l,f,s)).catch(l=>{throw l.name==="FirebaseError"?(l.code===nr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new $r(nr.UNKNOWN,l.toString())})}terminate(){this.lu=!0}}class kle{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.wu=0,this._u=null,this.mu=!0}gu(){this.wu===0&&(this.yu("Unknown"),this._u=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._u=null,this.pu("Backend didn't respond within 10 seconds."),this.yu("Offline"),Promise.resolve())))}Iu(e){this.state==="Online"?this.yu("Unknown"):(this.wu++,this.wu>=1&&(this.Tu(),this.pu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.yu("Offline")))}set(e){this.Tu(),this.wu=0,e==="Online"&&(this.mu=!1),this.yu(e)}yu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}pu(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.mu?(pg(n),this.mu=!1):hi("OnlineStateTracker",n)}Tu(){this._u!==null&&(this._u.cancel(),this._u=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nle{constructor(e,n,r,s,l){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Eu=[],this.Au=new Map,this.vu=new Set,this.Ru=[],this.Pu=l,this.Pu.Yr(f=>{r.enqueueAndForget(async()=>{dv(this)&&(hi("RemoteStore","Restarting streams for network reachability change."),await async function(i){const x=da(i);x.vu.add(4),await u2(x),x.bu.set("Unknown"),x.vu.delete(4),await Y5(x)}(this))})}),this.bu=new kle(r,s)}}async function Y5(t){if(dv(t))for(const e of t.Ru)await e(!0)}async function u2(t){for(const e of t.Ru)await e(!1)}function MW(t,e){const n=da(t);n.Au.has(e.targetId)||(n.Au.set(e.targetId,e),UL(n)?FL(n):k1(n).Ko()&&jL(n,e))}function CW(t,e){const n=da(t),r=k1(n);n.Au.delete(e),r.Ko()&&IW(n,e),n.Au.size===0&&(r.Ko()?r.jo():dv(n)&&n.bu.set("Unknown"))}function jL(t,e){if(t.Vu.qt(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Aa.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}k1(t).su(e)}function IW(t,e){t.Vu.qt(e),k1(t).iu(e)}function FL(t){t.Vu=new joe({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),le:e=>t.Au.get(e)||null,ue:()=>t.datastore.serializer.databaseId}),k1(t).start(),t.bu.gu()}function UL(t){return dv(t)&&!k1(t).Uo()&&t.Au.size>0}function dv(t){return da(t).vu.size===0}function PW(t){t.Vu=void 0}async function zle(t){t.Au.forEach((e,n)=>{jL(t,e)})}async function Ble(t,e){PW(t),UL(t)?(t.bu.Iu(e),FL(t)):t.bu.set("Unknown")}async function jle(t,e,n){if(t.bu.set("Online"),e instanceof gW&&e.state===2&&e.cause)try{await async function(r,s){const l=s.cause;for(const f of s.targetIds)r.Au.has(f)&&(await r.remoteSyncer.rejectListen(f,l),r.Au.delete(f),r.Vu.removeTarget(f))}(t,e)}catch(r){hi("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await lT(t,r)}else if(e instanceof EA?t.Vu.Ht(e):e instanceof mW?t.Vu.ne(e):t.Vu.Xt(e),!n.isEqual(Aa.min()))try{const r=await AW(t.localStore);n.compareTo(r)>=0&&await function(s,l){const f=s.Vu.ce(l);return f.targetChanges.forEach((i,x)=>{if(i.resumeToken.approximateByteSize()>0){const S=s.Au.get(x);S&&s.Au.set(x,S.withResumeToken(i.resumeToken,l))}}),f.targetMismatches.forEach((i,x)=>{const S=s.Au.get(i);if(!S)return;s.Au.set(i,S.withResumeToken(mh.EMPTY_BYTE_STRING,S.snapshotVersion)),IW(s,i);const I=new yy(S.target,i,x,S.sequenceNumber);jL(s,I)}),s.remoteSyncer.applyRemoteEvent(f)}(t,n)}catch(r){hi("RemoteStore","Failed to raise snapshot:",r),await lT(t,r)}}async function lT(t,e,n){if(!o2(e))throw e;t.vu.add(1),await u2(t),t.bu.set("Offline"),n||(n=()=>AW(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{hi("RemoteStore","Retrying IndexedDB access"),await n(),t.vu.delete(1),await Y5(t)})}function OW(t,e){return e().catch(n=>lT(t,n,e))}async function X5(t){const e=da(t),n=My(e);let r=e.Eu.length>0?e.Eu[e.Eu.length-1].batchId:-1;for(;Fle(e);)try{const s=await Ale(e.localStore,r);if(s===null){e.Eu.length===0&&n.jo();break}r=s.batchId,Ule(e,s)}catch(s){await lT(e,s)}RW(e)&&DW(e)}function Fle(t){return dv(t)&&t.Eu.length<10}function Ule(t,e){t.Eu.push(e);const n=My(t);n.Ko()&&n.ou&&n.uu(e.mutations)}function RW(t){return dv(t)&&!My(t).Uo()&&t.Eu.length>0}function DW(t){My(t).start()}async function qle(t){My(t).hu()}async function Vle(t){const e=My(t);for(const n of t.Eu)e.uu(n.mutations)}async function $le(t,e,n){const r=t.Eu.shift(),s=RL.from(r,e,n);await OW(t,()=>t.remoteSyncer.applySuccessfulWrite(s)),await X5(t)}async function Hle(t,e){e&&My(t).ou&&await async function(n,r){if(s=r.code,Noe(s)&&s!==nr.ABORTED){const l=n.Eu.shift();My(n).Qo(),await OW(n,()=>n.remoteSyncer.rejectFailedWrite(l.batchId,r)),await X5(n)}var s}(t,e),RW(t)&&DW(t)}async function sj(t,e){const n=da(t);n.asyncQueue.verifyOperationInProgress(),hi("RemoteStore","RemoteStore received new credentials");const r=dv(n);n.vu.add(3),await u2(n),r&&n.bu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.vu.delete(3),await Y5(n)}async function Gle(t,e){const n=da(t);e?(n.vu.delete(2),await Y5(n)):e||(n.vu.add(2),await u2(n),n.bu.set("Unknown"))}function k1(t){return t.Su||(t.Su=function(e,n,r){const s=da(e);return s.fu(),new Rle(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(t.datastore,t.asyncQueue,{uo:zle.bind(null,t),ao:Ble.bind(null,t),nu:jle.bind(null,t)}),t.Ru.push(async e=>{e?(t.Su.Qo(),UL(t)?FL(t):t.bu.set("Unknown")):(await t.Su.stop(),PW(t))})),t.Su}function My(t){return t.Du||(t.Du=function(e,n,r){const s=da(e);return s.fu(),new Dle(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(t.datastore,t.asyncQueue,{uo:qle.bind(null,t),ao:Hle.bind(null,t),au:Vle.bind(null,t),cu:$le.bind(null,t)}),t.Ru.push(async e=>{e?(t.Du.Qo(),await X5(t)):(await t.Du.stop(),t.Eu.length>0&&(hi("RemoteStore",`Stopping write stream with ${t.Eu.length} pending writes`),t.Eu=[]))})),t.Du}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qL{constructor(e,n,r,s,l){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=s,this.removalCallback=l,this.deferred=new lg,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(f=>{})}static createAndSchedule(e,n,r,s,l){const f=Date.now()+r,i=new qL(e,n,f,s,l);return i.start(r),i}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new $r(nr.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function VL(t,e){if(pg("AsyncQueue",`${e}: ${t}`),o2(t))return new $r(nr.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k0{constructor(e){this.comparator=e?(n,r)=>e(n,r)||Ki.comparator(n.key,r.key):(n,r)=>Ki.comparator(n.key,r.key),this.keyedMap=xx(),this.sortedSet=new oc(this.comparator)}static emptySet(e){return new k0(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof k0)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const s=n.getNext().key,l=r.getNext().key;if(!s.isEqual(l))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new k0;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oj{constructor(){this.Cu=new oc(Ki.comparator)}track(e){const n=e.doc.key,r=this.Cu.get(n);r?e.type!==0&&r.type===3?this.Cu=this.Cu.insert(n,e):e.type===3&&r.type!==1?this.Cu=this.Cu.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.Cu=this.Cu.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.Cu=this.Cu.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.Cu=this.Cu.remove(n):e.type===1&&r.type===2?this.Cu=this.Cu.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.Cu=this.Cu.insert(n,{type:2,doc:e.doc}):Qi():this.Cu=this.Cu.insert(n,e)}xu(){const e=[];return this.Cu.inorderTraversal((n,r)=>{e.push(r)}),e}}class J0{constructor(e,n,r,s,l,f,i,x,S){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=l,this.fromCache=f,this.syncStateChanged=i,this.excludesMetadataChanges=x,this.hasCachedResults=S}static fromInitialDocuments(e,n,r,s,l){const f=[];return n.forEach(i=>{f.push({type:0,doc:i})}),new J0(e,n,k0.emptySet(n),f,r,s,!0,!1,l)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&q5(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let s=0;s<n.length;s++)if(n[s].type!==r[s].type||!n[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wle{constructor(){this.Nu=void 0,this.listeners=[]}}class Kle{constructor(){this.queries=new L1(e=>tW(e),q5),this.onlineState="Unknown",this.ku=new Set}}async function $L(t,e){const n=da(t),r=e.query;let s=!1,l=n.queries.get(r);if(l||(s=!0,l=new Wle),s)try{l.Nu=await n.onListen(r)}catch(f){const i=VL(f,`Initialization of query '${q4(e.query)}' failed`);return void e.onError(i)}n.queries.set(r,l),l.listeners.push(e),e.Mu(n.onlineState),l.Nu&&e.$u(l.Nu)&&GL(n)}async function HL(t,e){const n=da(t),r=e.query;let s=!1;const l=n.queries.get(r);if(l){const f=l.listeners.indexOf(e);f>=0&&(l.listeners.splice(f,1),s=l.listeners.length===0)}if(s)return n.queries.delete(r),n.onUnlisten(r)}function Yle(t,e){const n=da(t);let r=!1;for(const s of e){const l=s.query,f=n.queries.get(l);if(f){for(const i of f.listeners)i.$u(s)&&(r=!0);f.Nu=s}}r&&GL(n)}function Xle(t,e,n){const r=da(t),s=r.queries.get(e);if(s)for(const l of s.listeners)l.onError(n);r.queries.delete(e)}function GL(t){t.ku.forEach(e=>{e.next()})}class WL{constructor(e,n,r){this.query=e,this.Ou=n,this.Fu=!1,this.Bu=null,this.onlineState="Unknown",this.options=r||{}}$u(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new J0(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Fu?this.Lu(e)&&(this.Ou.next(e),n=!0):this.qu(e,this.onlineState)&&(this.Uu(e),n=!0),this.Bu=e,n}onError(e){this.Ou.error(e)}Mu(e){this.onlineState=e;let n=!1;return this.Bu&&!this.Fu&&this.qu(this.Bu,e)&&(this.Uu(this.Bu),n=!0),n}qu(e,n){if(!e.fromCache)return!0;const r=n!=="Offline";return(!this.options.Ku||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Lu(e){if(e.docChanges.length>0)return!0;const n=this.Bu&&this.Bu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}Uu(e){e=J0.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Fu=!0,this.Ou.next(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LW{constructor(e){this.key=e}}class kW{constructor(e){this.key=e}}class Zle{constructor(e,n){this.query=e,this.Yu=n,this.Xu=null,this.hasCachedResults=!1,this.current=!1,this.Zu=ja(),this.mutatedKeys=ja(),this.tc=nW(e),this.ec=new k0(this.tc)}get nc(){return this.Yu}sc(e,n){const r=n?n.ic:new oj,s=n?n.ec:this.ec;let l=n?n.mutatedKeys:this.mutatedKeys,f=s,i=!1;const x=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,S=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((I,R)=>{const F=s.get(I),j=V5(this.query,R)?R:null,H=!!F&&this.mutatedKeys.has(F.key),G=!!j&&(j.hasLocalMutations||this.mutatedKeys.has(j.key)&&j.hasCommittedMutations);let W=!1;F&&j?F.data.isEqual(j.data)?H!==G&&(r.track({type:3,doc:j}),W=!0):this.rc(F,j)||(r.track({type:2,doc:j}),W=!0,(x&&this.tc(j,x)>0||S&&this.tc(j,S)<0)&&(i=!0)):!F&&j?(r.track({type:0,doc:j}),W=!0):F&&!j&&(r.track({type:1,doc:F}),W=!0,(x||S)&&(i=!0)),W&&(j?(f=f.add(j),l=G?l.add(I):l.delete(I)):(f=f.delete(I),l=l.delete(I)))}),this.query.limit!==null)for(;f.size>this.query.limit;){const I=this.query.limitType==="F"?f.last():f.first();f=f.delete(I.key),l=l.delete(I.key),r.track({type:1,doc:I})}return{ec:f,ic:r,zi:i,mutatedKeys:l}}rc(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r){const s=this.ec;this.ec=e.ec,this.mutatedKeys=e.mutatedKeys;const l=e.ic.xu();l.sort((S,I)=>function(R,F){const j=H=>{switch(H){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Qi()}};return j(R)-j(F)}(S.type,I.type)||this.tc(S.doc,I.doc)),this.oc(r);const f=n?this.uc():[],i=this.Zu.size===0&&this.current?1:0,x=i!==this.Xu;return this.Xu=i,l.length!==0||x?{snapshot:new J0(this.query,e.ec,s,l,e.mutatedKeys,i===0,x,!1,!!r&&r.resumeToken.approximateByteSize()>0),cc:f}:{cc:f}}Mu(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({ec:this.ec,ic:new oj,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{cc:[]}}ac(e){return!this.Yu.has(e)&&!!this.ec.has(e)&&!this.ec.get(e).hasLocalMutations}oc(e){e&&(e.addedDocuments.forEach(n=>this.Yu=this.Yu.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Yu=this.Yu.delete(n)),this.current=e.current)}uc(){if(!this.current)return[];const e=this.Zu;this.Zu=ja(),this.ec.forEach(r=>{this.ac(r.key)&&(this.Zu=this.Zu.add(r.key))});const n=[];return e.forEach(r=>{this.Zu.has(r)||n.push(new kW(r))}),this.Zu.forEach(r=>{e.has(r)||n.push(new LW(r))}),n}hc(e){this.Yu=e.ir,this.Zu=ja();const n=this.sc(e.documents);return this.applyChanges(n,!0)}lc(){return J0.fromInitialDocuments(this.query,this.ec,this.mutatedKeys,this.Xu===0,this.hasCachedResults)}}class Jle{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class Qle{constructor(e){this.key=e,this.fc=!1}}class ece{constructor(e,n,r,s,l,f){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=s,this.currentUser=l,this.maxConcurrentLimboResolutions=f,this.dc={},this.wc=new L1(i=>tW(i),q5),this._c=new Map,this.mc=new Set,this.gc=new oc(Ki.comparator),this.yc=new Map,this.Ic=new NL,this.Tc={},this.Ec=new Map,this.Ac=Z0.Mn(),this.onlineState="Unknown",this.vc=void 0}get isPrimaryClient(){return this.vc===!0}}async function tce(t,e){const n=hce(t);let r,s;const l=n.wc.get(e);if(l)r=l.targetId,n.sharedClientState.addLocalQueryTarget(r),s=l.view.lc();else{const f=await Tle(n.localStore,mg(e)),i=n.sharedClientState.addLocalQueryTarget(f.targetId);r=f.targetId,s=await nce(n,e,r,i==="current",f.resumeToken),n.isPrimaryClient&&MW(n.remoteStore,f)}return s}async function nce(t,e,n,r,s){t.Rc=(R,F,j)=>async function(H,G,W,J){let ie=G.view.sc(W);ie.zi&&(ie=await rj(H.localStore,G.query,!1).then(({documents:fe})=>G.view.sc(fe,ie)));const he=J&&J.targetChanges.get(G.targetId),ge=G.view.applyChanges(ie,H.isPrimaryClient,he);return cj(H,G.targetId,ge.cc),ge.snapshot}(t,R,F,j);const l=await rj(t.localStore,e,!0),f=new Zle(e,l.ir),i=f.sc(l.documents),x=c2.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",s),S=f.applyChanges(i,t.isPrimaryClient,x);cj(t,n,S.cc);const I=new Jle(e,n,f);return t.wc.set(e,I),t._c.has(n)?t._c.get(n).push(e):t._c.set(n,[e]),S.snapshot}async function rce(t,e){const n=da(t),r=n.wc.get(e),s=n._c.get(r.targetId);if(s.length>1)return n._c.set(r.targetId,s.filter(l=>!q5(l,e))),void n.wc.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await W4(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),CW(n.remoteStore,r.targetId),K4(n,r.targetId)}).catch(s2)):(K4(n,r.targetId),await W4(n.localStore,r.targetId,!0))}async function ice(t,e,n){const r=fce(t);try{const s=await function(l,f){const i=da(l),x=Xh.now(),S=f.reduce((F,j)=>F.add(j.key),ja());let I,R;return i.persistence.runTransaction("Locally write mutations","readwrite",F=>{let j=gg(),H=ja();return i.Zi.getEntries(F,S).next(G=>{j=G,j.forEach((W,J)=>{J.isValidDocument()||(H=H.add(W))})}).next(()=>i.localDocuments.getOverlayedDocuments(F,j)).next(G=>{I=G;const W=[];for(const J of f){const ie=Ooe(J,I.get(J.key).overlayedDocument);ie!=null&&W.push(new Dy(J.key,ie,WG(ie.value.mapValue),Ef.exists(!0)))}return i.mutationQueue.addMutationBatch(F,x,W,f)}).next(G=>{R=G;const W=G.applyToLocalDocumentSet(I,H);return i.documentOverlayCache.saveOverlays(F,G.batchId,W)})}).then(()=>({batchId:R.batchId,changes:iW(I)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(l,f,i){let x=l.Tc[l.currentUser.toKey()];x||(x=new oc(gs)),x=x.insert(f,i),l.Tc[l.currentUser.toKey()]=x}(r,s.batchId,n),await h2(r,s.changes),await X5(r.remoteStore)}catch(s){const l=VL(s,"Failed to persist write");n.reject(l)}}async function NW(t,e){const n=da(t);try{const r=await wle(n.localStore,e);e.targetChanges.forEach((s,l)=>{const f=n.yc.get(l);f&&(Po(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?f.fc=!0:s.modifiedDocuments.size>0?Po(f.fc):s.removedDocuments.size>0&&(Po(f.fc),f.fc=!1))}),await h2(n,r,e)}catch(r){await s2(r)}}function lj(t,e,n){const r=da(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const s=[];r.wc.forEach((l,f)=>{const i=f.view.Mu(e);i.snapshot&&s.push(i.snapshot)}),function(l,f){const i=da(l);i.onlineState=f;let x=!1;i.queries.forEach((S,I)=>{for(const R of I.listeners)R.Mu(f)&&(x=!0)}),x&&GL(i)}(r.eventManager,e),s.length&&r.dc.nu(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function ace(t,e,n){const r=da(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.yc.get(e),l=s&&s.key;if(l){let f=new oc(Ki.comparator);f=f.insert(l,oh.newNoDocument(l,Aa.min()));const i=ja().add(l),x=new W5(Aa.min(),new Map,new oc(gs),f,i);await NW(r,x),r.gc=r.gc.remove(l),r.yc.delete(e),KL(r)}else await W4(r.localStore,e,!1).then(()=>K4(r,e,n)).catch(s2)}async function sce(t,e){const n=da(t),r=e.batch.batchId;try{const s=await xle(n.localStore,e);BW(n,r,null),zW(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await h2(n,s)}catch(s){await s2(s)}}async function oce(t,e,n){const r=da(t);try{const s=await function(l,f){const i=da(l);return i.persistence.runTransaction("Reject batch","readwrite-primary",x=>{let S;return i.mutationQueue.lookupMutationBatch(x,f).next(I=>(Po(I!==null),S=I.keys(),i.mutationQueue.removeMutationBatch(x,I))).next(()=>i.mutationQueue.performConsistencyCheck(x)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(x,S,f)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(x,S)).next(()=>i.localDocuments.getDocuments(x,S))})}(r.localStore,e);BW(r,e,n),zW(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await h2(r,s)}catch(s){await s2(s)}}function zW(t,e){(t.Ec.get(e)||[]).forEach(n=>{n.resolve()}),t.Ec.delete(e)}function BW(t,e,n){const r=da(t);let s=r.Tc[r.currentUser.toKey()];if(s){const l=s.get(e);l&&(n?l.reject(n):l.resolve(),s=s.remove(e)),r.Tc[r.currentUser.toKey()]=s}}function K4(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t._c.get(e))t.wc.delete(r),n&&t.dc.Pc(r,n);t._c.delete(e),t.isPrimaryClient&&t.Ic.Is(e).forEach(r=>{t.Ic.containsKey(r)||jW(t,r)})}function jW(t,e){t.mc.delete(e.path.canonicalString());const n=t.gc.get(e);n!==null&&(CW(t.remoteStore,n),t.gc=t.gc.remove(e),t.yc.delete(n),KL(t))}function cj(t,e,n){for(const r of n)r instanceof LW?(t.Ic.addReference(r.key,e),lce(t,r)):r instanceof kW?(hi("SyncEngine","Document no longer in limbo: "+r.key),t.Ic.removeReference(r.key,e),t.Ic.containsKey(r.key)||jW(t,r.key)):Qi()}function lce(t,e){const n=e.key,r=n.path.canonicalString();t.gc.get(n)||t.mc.has(r)||(hi("SyncEngine","New document in limbo: "+n),t.mc.add(r),KL(t))}function KL(t){for(;t.mc.size>0&&t.gc.size<t.maxConcurrentLimboResolutions;){const e=t.mc.values().next().value;t.mc.delete(e);const n=new Ki(kl.fromString(e)),r=t.Ac.next();t.yc.set(r,new Qle(n)),t.gc=t.gc.insert(n,r),MW(t.remoteStore,new yy(mg(F5(n.path)),r,"TargetPurposeLimboResolution",TL.ct))}}async function h2(t,e,n){const r=da(t),s=[],l=[],f=[];r.wc.isEmpty()||(r.wc.forEach((i,x)=>{f.push(r.Rc(x,e,n).then(S=>{if((S||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(x.targetId,S!=null&&S.fromCache?"not-current":"current"),S){s.push(S);const I=BL.Li(x.targetId,S);l.push(I)}}))}),await Promise.all(f),r.dc.nu(s),await async function(i,x){const S=da(i);try{await S.persistence.runTransaction("notifyLocalViewChanges","readwrite",I=>kr.forEach(x,R=>kr.forEach(R.Fi,F=>S.persistence.referenceDelegate.addReference(I,R.targetId,F)).next(()=>kr.forEach(R.Bi,F=>S.persistence.referenceDelegate.removeReference(I,R.targetId,F)))))}catch(I){if(!o2(I))throw I;hi("LocalStore","Failed to update sequence numbers: "+I)}for(const I of x){const R=I.targetId;if(!I.fromCache){const F=S.Ji.get(R),j=F.snapshotVersion,H=F.withLastLimboFreeSnapshotVersion(j);S.Ji=S.Ji.insert(R,H)}}}(r.localStore,l))}async function cce(t,e){const n=da(t);if(!n.currentUser.isEqual(e)){hi("SyncEngine","User change. New user:",e.toKey());const r=await SW(n.localStore,e);n.currentUser=e,function(s,l){s.Ec.forEach(f=>{f.forEach(i=>{i.reject(new $r(nr.CANCELLED,l))})}),s.Ec.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await h2(n,r.er)}}function uce(t,e){const n=da(t),r=n.yc.get(e);if(r&&r.fc)return ja().add(r.key);{let s=ja();const l=n._c.get(e);if(!l)return s;for(const f of l){const i=n.wc.get(f);s=s.unionWith(i.view.nc)}return s}}function hce(t){const e=da(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=NW.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=uce.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=ace.bind(null,e),e.dc.nu=Yle.bind(null,e.eventManager),e.dc.Pc=Xle.bind(null,e.eventManager),e}function fce(t){const e=da(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=sce.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=oce.bind(null,e),e}class uj{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=K5(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,n){return null}createIndexBackfillerScheduler(e,n){return null}createLocalStore(e){return ble(this.persistence,new _le,e.initialUser,this.serializer)}createPersistence(e){return new gle(zL.zs,this.serializer)}createSharedClientState(e){return new Mle}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class dce{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>lj(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=cce.bind(null,this.syncEngine),await Gle(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Kle}createDatastore(e){const n=K5(e.databaseInfo.databaseId),r=(s=e.databaseInfo,new Ole(s));var s;return function(l,f,i,x){return new Lle(l,f,i,x)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return n=this.localStore,r=this.datastore,s=e.asyncQueue,l=i=>lj(this.syncEngine,i,0),f=aj.D()?new aj:new Cle,new Nle(n,r,s,l,f);var n,r,s,l,f}createSyncEngine(e,n){return function(r,s,l,f,i,x,S){const I=new ece(r,s,l,f,i,x);return S&&(I.vc=!0),I}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}terminate(){return async function(e){const n=da(e);hi("RemoteStore","RemoteStore shutting down."),n.vu.add(5),await u2(n),n.Pu.shutdown(),n.bu.set("Unknown")}(this.remoteStore)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YL{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Sc(this.observer.next,e)}error(e){this.observer.error?this.Sc(this.observer.error,e):pg("Uncaught Error in snapshot listener:",e.toString())}Dc(){this.muted=!0}Sc(e,n){this.muted||setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pce{constructor(e,n,r,s){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=s,this.user=sh.UNAUTHENTICATED,this.clientId=VG.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,async l=>{hi("FirestoreClient","Received user=",l.uid),await this.authCredentialListener(l),this.user=l}),this.appCheckCredentials.start(r,l=>(hi("FirestoreClient","Received new app check token=",l),this.appCheckCredentialListener(l,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new $r(nr.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new lg;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=VL(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function EM(t,e){t.asyncQueue.verifyOperationInProgress(),hi("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async s=>{r.isEqual(s)||(await SW(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function hj(t,e){t.asyncQueue.verifyOperationInProgress();const n=await gce(t);hi("FirestoreClient","Initializing OnlineComponentProvider");const r=await t.getConfiguration();await e.initialize(n,r),t.setCredentialChangeListener(s=>sj(e.remoteStore,s)),t.setAppCheckTokenChangeListener((s,l)=>sj(e.remoteStore,l)),t._onlineComponents=e}function mce(t){return t.name==="FirebaseError"?t.code===nr.FAILED_PRECONDITION||t.code===nr.UNIMPLEMENTED:!(typeof DOMException<"u"&&t instanceof DOMException)||t.code===22||t.code===20||t.code===11}async function gce(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){hi("FirestoreClient","Using user provided OfflineComponentProvider");try{await EM(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!mce(n))throw n;W0("Error using user provided cache. Falling back to memory cache: "+n),await EM(t,new uj)}}else hi("FirestoreClient","Using default OfflineComponentProvider"),await EM(t,new uj);return t._offlineComponents}async function FW(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(hi("FirestoreClient","Using user provided OnlineComponentProvider"),await hj(t,t._uninitializedComponentsProvider._online)):(hi("FirestoreClient","Using default OnlineComponentProvider"),await hj(t,new dce))),t._onlineComponents}function yce(t){return FW(t).then(e=>e.syncEngine)}async function cT(t){const e=await FW(t),n=e.eventManager;return n.onListen=tce.bind(null,e.syncEngine),n.onUnlisten=rce.bind(null,e.syncEngine),n}function _ce(t,e,n={}){const r=new lg;return t.asyncQueue.enqueueAndForget(async()=>function(s,l,f,i,x){const S=new YL({next:R=>{l.enqueueAndForget(()=>HL(s,I));const F=R.docs.has(f);!F&&R.fromCache?x.reject(new $r(nr.UNAVAILABLE,"Failed to get document because the client is offline.")):F&&R.fromCache&&i&&i.source==="server"?x.reject(new $r(nr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):x.resolve(R)},error:R=>x.reject(R)}),I=new WL(F5(f.path),S,{includeMetadataChanges:!0,Ku:!0});return $L(s,I)}(await cT(t),t.asyncQueue,e,n,r)),r.promise}function vce(t,e,n={}){const r=new lg;return t.asyncQueue.enqueueAndForget(async()=>function(s,l,f,i,x){const S=new YL({next:R=>{l.enqueueAndForget(()=>HL(s,I)),R.fromCache&&i.source==="server"?x.reject(new $r(nr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):x.resolve(R)},error:R=>x.reject(R)}),I=new WL(f,S,{includeMetadataChanges:!0,Ku:!0});return $L(s,I)}(await cT(t),t.asyncQueue,e,n,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UW(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fj=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qW(t,e,n){if(!n)throw new $r(nr.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function bce(t,e,n,r){if(e===!0&&r===!0)throw new $r(nr.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function dj(t){if(!Ki.isDocumentKey(t))throw new $r(nr.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function pj(t){if(Ki.isDocumentKey(t))throw new $r(nr.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Z5(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(n){return n.constructor?n.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Qi()}function ad(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new $r(nr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Z5(t);throw new $r(nr.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mj{constructor(e){var n,r;if(e.host===void 0){if(e.ssl!==void 0)throw new $r(nr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.cache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new $r(nr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}bce("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=UW((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new $r(nr.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new $r(nr.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new $r(nr.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(n=this.experimentalLongPollingOptions,r=e.experimentalLongPollingOptions,n.timeoutSeconds===r.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var n,r}}class J5{constructor(e,n,r,s){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new mj({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new $r(nr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new $r(nr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new mj(e),e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new Vse;switch(n.type){case"firstParty":return new Wse(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new $r(nr.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const n=fj.get(e);n&&(hi("ComponentProvider","Removing Datastore"),fj.delete(e),n.terminate())}(this),Promise.resolve()}}function xce(t,e,n,r={}){var s;const l=(t=ad(t,J5))._getSettings(),f=`${e}:${n}`;if(l.host!=="firestore.googleapis.com"&&l.host!==f&&W0("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},l),{host:f,ssl:!1})),r.mockUserToken){let i,x;if(typeof r.mockUserToken=="string")i=r.mockUserToken,x=sh.MOCK_USER;else{i=fne(r.mockUserToken,(s=t._app)===null||s===void 0?void 0:s.options.projectId);const S=r.mockUserToken.sub||r.mockUserToken.user_id;if(!S)throw new $r(nr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");x=new sh(S)}t._authCredentials=new $se(new qG(i,x))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zh{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ay(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Zh(this.firestore,e,this._key)}}class Ly{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Ly(this.firestore,e,this._query)}}class Ay extends Ly{constructor(e,n,r){super(e,n,F5(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Zh(this.firestore,null,new Ki(e))}withConverter(e){return new Ay(this.firestore,e,this._path)}}function ca(t,e,...n){if(t=kc(t),qW("collection","path",e),t instanceof J5){const r=kl.fromString(e,...n);return pj(r),new Ay(t,null,r)}{if(!(t instanceof Zh||t instanceof Ay))throw new $r(nr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(kl.fromString(e,...n));return pj(r),new Ay(t.firestore,null,r)}}function ol(t,e,...n){if(t=kc(t),arguments.length===1&&(e=VG.A()),qW("doc","path",e),t instanceof J5){const r=kl.fromString(e,...n);return dj(r),new Zh(t,null,new Ki(r))}{if(!(t instanceof Zh||t instanceof Ay))throw new $r(nr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(kl.fromString(e,...n));return dj(r),new Zh(t.firestore,t instanceof Ay?t.converter:null,new Ki(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wce{constructor(){this.Gc=Promise.resolve(),this.Qc=[],this.jc=!1,this.zc=[],this.Wc=null,this.Hc=!1,this.Jc=!1,this.Yc=[],this.qo=new TW(this,"async_queue_retry"),this.Xc=()=>{const n=TM();n&&hi("AsyncQueue","Visibility state changed to "+n.visibilityState),this.qo.Mo()};const e=TM();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Xc)}get isShuttingDown(){return this.jc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Zc(),this.ta(e)}enterRestrictedMode(e){if(!this.jc){this.jc=!0,this.Jc=e||!1;const n=TM();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.Xc)}}enqueue(e){if(this.Zc(),this.jc)return new Promise(()=>{});const n=new lg;return this.ta(()=>this.jc&&this.Jc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Qc.push(e),this.ea()))}async ea(){if(this.Qc.length!==0){try{await this.Qc[0](),this.Qc.shift(),this.qo.reset()}catch(e){if(!o2(e))throw e;hi("AsyncQueue","Operation failed with retryable error: "+e)}this.Qc.length>0&&this.qo.No(()=>this.ea())}}ta(e){const n=this.Gc.then(()=>(this.Hc=!0,e().catch(r=>{this.Wc=r,this.Hc=!1;const s=function(l){let f=l.message||"";return l.stack&&(f=l.stack.includes(l.message)?l.stack:l.message+`
`+l.stack),f}(r);throw pg("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.Hc=!1,r))));return this.Gc=n,n}enqueueAfterDelay(e,n,r){this.Zc(),this.Yc.indexOf(e)>-1&&(n=0);const s=qL.createAndSchedule(this,e,n,r,l=>this.na(l));return this.zc.push(s),s}Zc(){this.Wc&&Qi()}verifyOperationInProgress(){}async sa(){let e;do e=this.Gc,await e;while(e!==this.Gc)}ia(e){for(const n of this.zc)if(n.timerId===e)return!0;return!1}ra(e){return this.sa().then(()=>{this.zc.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.zc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.sa()})}oa(e){this.Yc.push(e)}na(e){const n=this.zc.indexOf(e);this.zc.splice(n,1)}}function gj(t){return function(e,n){if(typeof e!="object"||e===null)return!1;const r=e;for(const s of n)if(s in r&&typeof r[s]=="function")return!0;return!1}(t,["next","error","complete"])}class yg extends J5{constructor(e,n,r,s){super(e,n,r,s),this.type="firestore",this._queue=new wce,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||VW(this),this._firestoreClient.terminate()}}function Sce(t,e){const n=typeof t=="object"?t:aH(),r=typeof t=="string"?t:"(default)",s=WD(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const l=une("firestore");l&&xce(s,...l)}return s}function f2(t){return t._firestoreClient||VW(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function VW(t){var e,n,r;const s=t._freezeSettings(),l=function(f,i,x,S){return new aoe(f,i,x,S.host,S.ssl,S.experimentalForceLongPolling,S.experimentalAutoDetectLongPolling,UW(S.experimentalLongPollingOptions),S.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,s);t._firestoreClient=new pce(t._authCredentials,t._appCheckCredentials,t._queue,l),!((n=s.cache)===null||n===void 0)&&n._offlineComponentProvider&&(!((r=s.cache)===null||r===void 0)&&r._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:s.cache.kind,_offline:s.cache._offlineComponentProvider,_online:s.cache._onlineComponentProvider})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q0{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Q0(mh.fromBase64String(e))}catch(n){throw new $r(nr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Q0(mh.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d2{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new $r(nr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Em(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XL{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZL{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new $r(nr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new $r(nr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return gs(this._lat,e._lat)||gs(this._long,e._long)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ace=/^__.*__$/;class Tce{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Dy(e,this.data,this.fieldMask,n,this.fieldTransforms):new l2(e,this.data,n,this.fieldTransforms)}}class $W{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Dy(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function HW(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Qi()}}class JL{constructor(e,n,r,s,l,f){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=s,l===void 0&&this.ua(),this.fieldTransforms=l||[],this.fieldMask=f||[]}get path(){return this.settings.path}get ca(){return this.settings.ca}aa(e){return new JL(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ha(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),s=this.aa({path:r,la:!1});return s.fa(e),s}da(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),s=this.aa({path:r,la:!1});return s.ua(),s}wa(e){return this.aa({path:void 0,la:!0})}_a(e){return uT(e,this.settings.methodName,this.settings.ma||!1,this.path,this.settings.ga)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}ua(){if(this.path)for(let e=0;e<this.path.length;e++)this.fa(this.path.get(e))}fa(e){if(e.length===0)throw this._a("Document fields must not be empty");if(HW(this.ca)&&Ace.test(e))throw this._a('Document fields cannot begin and end with "__"')}}class Ece{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||K5(e)}ya(e,n,r,s=!1){return new JL({ca:e,methodName:n,ga:r,path:Em.emptyPath(),la:!1,ma:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Q5(t){const e=t._freezeSettings(),n=K5(t._databaseId);return new Ece(t._databaseId,!!e.ignoreUndefinedProperties,n)}function GW(t,e,n,r,s,l={}){const f=t.ya(l.merge||l.mergeFields?2:0,e,n,s);QL("Data must be an object, but it was:",f,r);const i=YW(r,f);let x,S;if(l.merge)x=new rd(f.fieldMask),S=f.fieldTransforms;else if(l.mergeFields){const I=[];for(const R of l.mergeFields){const F=Y4(e,R,n);if(!f.contains(F))throw new $r(nr.INVALID_ARGUMENT,`Field '${F}' is specified in your field mask but missing from your input data.`);ZW(I,F)||I.push(F)}x=new rd(I),S=f.fieldTransforms.filter(R=>x.covers(R.field))}else x=null,S=f.fieldTransforms;return new Tce(new Af(i),x,S)}class eE extends XL{_toFieldTransform(e){if(e.ca!==2)throw e.ca===1?e._a(`${this._methodName}() can only appear at the top level of your update data`):e._a(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof eE}}function WW(t,e,n,r){const s=t.ya(1,e,n);QL("Data must be an object, but it was:",s,r);const l=[],f=Af.empty();fv(r,(x,S)=>{const I=ek(e,x,n);S=kc(S);const R=s.da(I);if(S instanceof eE)l.push(I);else{const F=p2(S,R);F!=null&&(l.push(I),f.set(I,F))}});const i=new rd(l);return new $W(f,i,s.fieldTransforms)}function KW(t,e,n,r,s,l){const f=t.ya(1,e,n),i=[Y4(e,r,n)],x=[s];if(l.length%2!=0)throw new $r(nr.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let F=0;F<l.length;F+=2)i.push(Y4(e,l[F])),x.push(l[F+1]);const S=[],I=Af.empty();for(let F=i.length-1;F>=0;--F)if(!ZW(S,i[F])){const j=i[F];let H=x[F];H=kc(H);const G=f.da(j);if(H instanceof eE)S.push(j);else{const W=p2(H,G);W!=null&&(S.push(j),I.set(j,W))}}const R=new rd(S);return new $W(I,R,f.fieldTransforms)}function Mce(t,e,n,r=!1){return p2(n,t.ya(r?4:3,e))}function p2(t,e){if(XW(t=kc(t)))return QL("Unsupported field value:",e,t),YW(t,e);if(t instanceof XL)return function(n,r){if(!HW(r.ca))throw r._a(`${n._methodName}() can only be used with update() and set()`);if(!r.path)throw r._a(`${n._methodName}() is not currently supported inside arrays`);const s=n._toFieldTransform(r);s&&r.fieldTransforms.push(s)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.la&&e.ca!==4)throw e._a("Nested arrays are not supported");return function(n,r){const s=[];let l=0;for(const f of n){let i=p2(f,r.wa(l));i==null&&(i={nullValue:"NULL_VALUE"}),s.push(i),l++}return{arrayValue:{values:s}}}(t,e)}return function(n,r){if((n=kc(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return Toe(r.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const s=Xh.fromDate(n);return{timestampValue:oT(r.serializer,s)}}if(n instanceof Xh){const s=new Xh(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:oT(r.serializer,s)}}if(n instanceof ZL)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Q0)return{bytesValue:yW(r.serializer,n._byteString)};if(n instanceof Zh){const s=r.databaseId,l=n.firestore._databaseId;if(!l.isEqual(s))throw r._a(`Document reference is for database ${l.projectId}/${l.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:kL(n.firestore._databaseId||r.databaseId,n._key.path)}}throw r._a(`Unsupported field value: ${Z5(n)}`)}(t,e)}function YW(t,e){const n={};return HG(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):fv(t,(r,s)=>{const l=p2(s,e.ha(r));l!=null&&(n[r]=l)}),{mapValue:{fields:n}}}function XW(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Xh||t instanceof ZL||t instanceof Q0||t instanceof Zh||t instanceof XL)}function QL(t,e,n){if(!XW(n)||!function(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}(n)){const r=Z5(n);throw r==="an object"?e._a(t+" a custom object"):e._a(t+" "+r)}}function Y4(t,e,n){if((e=kc(e))instanceof d2)return e._internalPath;if(typeof e=="string")return ek(t,e);throw uT("Field path arguments must be of type string or ",t,!1,void 0,n)}const Cce=new RegExp("[~\\*/\\[\\]]");function ek(t,e,n){if(e.search(Cce)>=0)throw uT(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new d2(...e.split("."))._internalPath}catch{throw uT(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function uT(t,e,n,r,s){const l=r&&!r.isEmpty(),f=s!==void 0;let i=`Function ${e}() called with invalid data`;n&&(i+=" (via `toFirestore()`)"),i+=". ";let x="";return(l||f)&&(x+=" (found",l&&(x+=` in field ${r}`),f&&(x+=` in document ${s}`),x+=")"),new $r(nr.INVALID_ARGUMENT,i+t+x)}function ZW(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JW{constructor(e,n,r,s,l){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=s,this._converter=l}get id(){return this._key.path.lastSegment()}get ref(){return new Zh(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Ice(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(tE("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class Ice extends JW{data(){return super.data()}}function tE(t,e){return typeof e=="string"?ek(t,e):e instanceof d2?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QW(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new $r(nr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class tk{}class eK extends tk{}function x0(t,e,...n){let r=[];e instanceof tk&&r.push(e),r=r.concat(n),function(s){const l=s.filter(i=>i instanceof nk).length,f=s.filter(i=>i instanceof nE).length;if(l>1||l>0&&f>0)throw new $r(nr.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)t=s._apply(t);return t}class nE extends eK{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new nE(e,n,r)}_apply(e){const n=this._parse(e);return nK(e._query,n),new Ly(e.firestore,e.converter,F4(e._query,n))}_parse(e){const n=Q5(e.firestore);return function(s,l,f,i,x,S,I){let R;if(x.isKeyField()){if(S==="array-contains"||S==="array-contains-any")throw new $r(nr.INVALID_ARGUMENT,`Invalid Query. You can't perform '${S}' queries on documentId().`);if(S==="in"||S==="not-in"){_j(I,S);const F=[];for(const j of I)F.push(yj(i,s,j));R={arrayValue:{values:F}}}else R=yj(i,s,I)}else S!=="in"&&S!=="not-in"&&S!=="array-contains-any"||_j(I,S),R=Mce(f,l,I,S==="in"||S==="not-in");return ac.create(x,S,R)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function XS(t,e,n){const r=e,s=tE("where",t);return nE._create(s,r,n)}class nk extends tk{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new nk(e,n)}_parse(e){const n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:Pp.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(r,s){let l=r;const f=s.getFlattenedFilters();for(const i of f)nK(l,i),l=F4(l,i)}(e._query,n),new Ly(e.firestore,e.converter,F4(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class rk extends eK{constructor(e,n){super(),this._field=e,this._direction=n,this.type="orderBy"}static _create(e,n){return new rk(e,n)}_apply(e){const n=function(r,s,l){if(r.startAt!==null)throw new $r(nr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new $r(nr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const f=new D0(s,l);return function(i,x){if(OL(i)===null){const S=U5(i);S!==null&&rK(i,S,x.field)}}(r,f),f}(e._query,this._field,this._direction);return new Ly(e.firestore,e.converter,function(r,s){const l=r.explicitOrderBy.concat([s]);return new D1(r.path,r.collectionGroup,l,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,n))}}function tK(t,e="asc"){const n=e,r=tE("orderBy",t);return rk._create(r,n)}function yj(t,e,n){if(typeof(n=kc(n))=="string"){if(n==="")throw new $r(nr.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!eW(e)&&n.indexOf("/")!==-1)throw new $r(nr.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(kl.fromString(n));if(!Ki.isDocumentKey(r))throw new $r(nr.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return FB(t,new Ki(r))}if(n instanceof Zh)return FB(t,n._key);throw new $r(nr.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Z5(n)}.`)}function _j(t,e){if(!Array.isArray(t)||t.length===0)throw new $r(nr.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function nK(t,e){if(e.isInequality()){const r=U5(t),s=e.field;if(r!==null&&!r.isEqual(s))throw new $r(nr.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${s.toString()}'`);const l=OL(t);l!==null&&rK(t,s,l)}const n=function(r,s){for(const l of r)for(const f of l.getFlattenedFilters())if(s.indexOf(f.op)>=0)return f.op;return null}(t.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new $r(nr.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new $r(nr.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}function rK(t,e,n){if(!n.isEqual(e))throw new $r(nr.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class Pce{convertValue(e,n="none"){switch(nv(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ic(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(tv(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 10:return this.convertObject(e.mapValue,n);default:throw Qi()}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return fv(e,(s,l)=>{r[s]=this.convertValue(l,n)}),r}convertGeoPoint(e){return new ZL(ic(e.latitude),ic(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=ML(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(ew(e));default:return null}}convertTimestamp(e){const n=Ey(e);return new Xh(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=kl.fromString(e);Po(wW(r));const s=new tw(r.get(1),r.get(3)),l=new Ki(r.popFirst(5));return s.isEqual(n)||pg(`Document ${l} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iK(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sx{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class aK extends JW{constructor(e,n,r,s,l,f){super(e,n,r,s,f),this._firestore=e,this._firestoreImpl=e,this.metadata=l}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new MA(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(tE("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}}class MA extends aK{data(e={}){return super.data(e)}}class sK{constructor(e,n,r,s){this._firestore=e,this._userDataWriter=n,this._snapshot=s,this.metadata=new Sx(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new MA(this._firestore,this._userDataWriter,r.key,r,new Sx(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new $r(nr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(r,s){if(r._snapshot.oldDocs.isEmpty()){let l=0;return r._snapshot.docChanges.map(f=>{const i=new MA(r._firestore,r._userDataWriter,f.doc.key,f.doc,new Sx(r._snapshot.mutatedKeys.has(f.doc.key),r._snapshot.fromCache),r.query.converter);return f.doc,{type:"added",doc:i,oldIndex:-1,newIndex:l++}})}{let l=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(f=>s||f.type!==3).map(f=>{const i=new MA(r._firestore,r._userDataWriter,f.doc.key,f.doc,new Sx(r._snapshot.mutatedKeys.has(f.doc.key),r._snapshot.fromCache),r.query.converter);let x=-1,S=-1;return f.type!==0&&(x=l.indexOf(f.doc.key),l=l.delete(f.doc.key)),f.type!==1&&(l=l.add(f.doc),S=l.indexOf(f.doc.key)),{type:Oce(f.type),doc:i,oldIndex:x,newIndex:S}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}}function Oce(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Qi()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w0(t){t=ad(t,Zh);const e=ad(t.firestore,yg);return _ce(f2(e),t._key).then(n=>lK(e,t,n))}class ik extends Pce{constructor(e){super(),this.firestore=e}convertBytes(e){return new Q0(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Zh(this.firestore,null,n)}}function fs(t){t=ad(t,Ly);const e=ad(t.firestore,yg),n=f2(e),r=new ik(e);return QW(t._query),vce(n,t._query).then(s=>new sK(e,r,t,s))}function ed(t,e,n,...r){t=ad(t,Zh);const s=ad(t.firestore,yg),l=Q5(s);let f;return f=typeof(e=kc(e))=="string"||e instanceof d2?KW(l,"updateDoc",t._key,e,n,r):WW(l,"updateDoc",t._key,e),rE(s,[f.toMutation(t._key,Ef.exists(!0))])}function oK(t){return rE(ad(t.firestore,yg),[new G5(t._key,Ef.none())])}function ak(t,e){const n=ad(t.firestore,yg),r=ol(t),s=iK(t.converter,e);return rE(n,[GW(Q5(t.firestore),"addDoc",r._key,s,t.converter!==null,{}).toMutation(r._key,Ef.exists(!1))]).then(()=>r)}function Qm(t,...e){var n,r,s;t=kc(t);let l={includeMetadataChanges:!1},f=0;typeof e[f]!="object"||gj(e[f])||(l=e[f],f++);const i={includeMetadataChanges:l.includeMetadataChanges};if(gj(e[f])){const R=e[f];e[f]=(n=R.next)===null||n===void 0?void 0:n.bind(R),e[f+1]=(r=R.error)===null||r===void 0?void 0:r.bind(R),e[f+2]=(s=R.complete)===null||s===void 0?void 0:s.bind(R)}let x,S,I;if(t instanceof Zh)S=ad(t.firestore,yg),I=F5(t._key.path),x={next:R=>{e[f]&&e[f](lK(S,t,R))},error:e[f+1],complete:e[f+2]};else{const R=ad(t,Ly);S=ad(R.firestore,yg),I=R._query;const F=new ik(S);x={next:j=>{e[f]&&e[f](new sK(S,F,R,j))},error:e[f+1],complete:e[f+2]},QW(t._query)}return function(R,F,j,H){const G=new YL(H),W=new WL(F,G,j);return R.asyncQueue.enqueueAndForget(async()=>$L(await cT(R),W)),()=>{G.Dc(),R.asyncQueue.enqueueAndForget(async()=>HL(await cT(R),W))}}(f2(S),I,i,x)}function rE(t,e){return function(n,r){const s=new lg;return n.asyncQueue.enqueueAndForget(async()=>ice(await yce(n),r,s)),s.promise}(f2(t),e)}function lK(t,e,n){const r=n.docs.get(e._key),s=new ik(t);return new aK(t,s,e._key,r,new Sx(n.hasPendingWrites,n.fromCache),e.converter)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rce{constructor(e,n){this._firestore=e,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=Q5(e)}set(e,n,r){this._verifyNotCommitted();const s=MM(e,this._firestore),l=iK(s.converter,n,r),f=GW(this._dataReader,"WriteBatch.set",s._key,l,s.converter!==null,r);return this._mutations.push(f.toMutation(s._key,Ef.none())),this}update(e,n,r,...s){this._verifyNotCommitted();const l=MM(e,this._firestore);let f;return f=typeof(n=kc(n))=="string"||n instanceof d2?KW(this._dataReader,"WriteBatch.update",l._key,n,r,s):WW(this._dataReader,"WriteBatch.update",l._key,n),this._mutations.push(f.toMutation(l._key,Ef.exists(!0))),this}delete(e){this._verifyNotCommitted();const n=MM(e,this._firestore);return this._mutations=this._mutations.concat(new G5(n._key,Ef.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new $r(nr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function MM(t,e){if((t=kc(t)).firestore!==e)throw new $r(nr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dce(t){return f2(t=ad(t,yg)),new Rce(t,e=>rE(t,e))}(function(t,e=!0){(function(n){R1=n})(M1),$0(new Z_("firestore",(n,{instanceIdentifier:r,options:s})=>{const l=n.getProvider("app").getImmediate(),f=new yg(new Hse(n.getProvider("auth-internal")),new Yse(n.getProvider("app-check-internal")),function(i,x){if(!Object.prototype.hasOwnProperty.apply(i.options,["projectId"]))throw new $r(nr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new tw(i.options.projectId,x)}(l,r),l);return s=Object.assign({useFetchStreams:e},s),f._setSettings(s),f},"PUBLIC").setMultipleInstances(!0)),Sy(kB,"3.13.0",t),Sy(kB,"3.13.0","esm2017")})();const Lce={apiKey:"AIzaSyAqEefB5cZ1jVzeqdhxfRYHUzOqgyUqieo",authDomain:"ecp-caps.firebaseapp.com",projectId:"ecp-caps",storageBucket:"ecp-caps.firebasestorage.app",messagingSenderId:"1040391525167",appId:"1:1040391525167:web:c4b9bff139a86daacf47da"},cK=iH(Lce),m2=Nae(cK),Yr=Sce(cK);var uK={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},vj=kt.createContext&&kt.createContext(uK),kce=["attr","size","title"];function Nce(t,e){if(t==null)return{};var n=zce(t,e),r,s;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(s=0;s<l.length;s++)r=l[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function zce(t,e){if(t==null)return{};var n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;n[r]=t[r]}return n}function hT(){return hT=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},hT.apply(this,arguments)}function bj(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function fT(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?bj(Object(n),!0).forEach(function(r){Bce(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):bj(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Bce(t,e,n){return e=jce(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function jce(t){var e=Fce(t,"string");return typeof e=="symbol"?e:e+""}function Fce(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function hK(t){return t&&t.map((e,n)=>kt.createElement(e.tag,fT({key:n},e.attr),hK(e.child)))}function Nc(t){return e=>kt.createElement(Uce,hT({attr:fT({},t.attr)},e),hK(t.child))}function Uce(t){var e=n=>{var{attr:r,size:s,title:l}=t,f=Nce(t,kce),i=s||n.size||"1em",x;return n.className&&(x=n.className),t.className&&(x=(x?x+" ":"")+t.className),kt.createElement("svg",hT({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,r,f,{className:x,style:fT(fT({color:t.color||n.color},n.style),t.style),height:i,width:i,xmlns:"http://www.w3.org/2000/svg"}),l&&kt.createElement("title",null,l),t.children)};return vj!==void 0?kt.createElement(vj.Consumer,null,n=>e(n)):e(uK)}function qce(t){return Nc({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224 512c35.32 0 63.97-28.65 63.97-64H160.03c0 35.35 28.65 64 63.97 64zm215.39-149.71c-19.32-20.76-55.47-51.99-55.47-154.29 0-77.7-54.48-139.9-127.94-155.16V32c0-17.67-14.32-32-31.98-32s-31.98 14.33-31.98 32v20.84C118.56 68.1 64.08 130.3 64.08 208c0 102.3-36.15 133.53-55.47 154.29-6 6.45-8.66 14.16-8.61 21.71.11 16.4 12.98 32 32.1 32h383.8c19.12 0 32-15.6 32.1-32 .05-7.55-2.61-15.27-8.61-21.71z"},child:[]}]})(t)}function Vce(t){return Nc({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"},child:[]}]})(t)}function $ce(t){return Nc({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M34.52 239.03L228.87 44.69c9.37-9.37 24.57-9.37 33.94 0l22.67 22.67c9.36 9.36 9.37 24.52.04 33.9L131.49 256l154.02 154.75c9.34 9.38 9.32 24.54-.04 33.9l-22.67 22.67c-9.37 9.37-24.57 9.37-33.94 0L34.52 272.97c-9.37-9.37-9.37-24.57 0-33.94z"},child:[]}]})(t)}function Hce(t){return Nc({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"},child:[]}]})(t)}function N0(t){return Nc({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"},child:[]}]})(t)}function Gce(t){return Nc({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 255.531c.253 136.64-111.18 248.372-247.82 248.468-59.015.042-113.223-20.53-155.822-54.911-11.077-8.94-11.905-25.541-1.839-35.607l11.267-11.267c8.609-8.609 22.353-9.551 31.891-1.984C173.062 425.135 212.781 440 256 440c101.705 0 184-82.311 184-184 0-101.705-82.311-184-184-184-48.814 0-93.149 18.969-126.068 49.932l50.754 50.754c10.08 10.08 2.941 27.314-11.313 27.314H24c-8.837 0-16-7.163-16-16V38.627c0-14.254 17.234-21.393 27.314-11.314l49.372 49.372C129.209 34.136 189.552 8 256 8c136.81 0 247.747 110.78 248 247.531zm-180.912 78.784l9.823-12.63c8.138-10.463 6.253-25.542-4.21-33.679L288 256.349V152c0-13.255-10.745-24-24-24h-16c-13.255 0-24 10.745-24 24v135.651l65.409 50.874c10.463 8.137 25.541 6.253 33.679-4.21z"},child:[]}]})(t)}function sk(t){return Nc({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"},child:[]}]})(t)}function Wce(t){return Nc({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"},child:[]}]})(t)}function fK(t){return Nc({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M32 464a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V128H32zm272-256a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zM432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16z"},child:[]}]})(t)}function xj(t){return Nc({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M296 384h-80c-13.3 0-24-10.7-24-24V192h-87.7c-17.8 0-26.7-21.5-14.1-34.1L242.3 5.7c7.5-7.5 19.8-7.5 27.3 0l152.2 152.2c12.6 12.6 3.7 34.1-14.1 34.1H320v168c0 13.3-10.7 24-24 24zm216-8v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h136v8c0 30.9 25.1 56 56 56h80c30.9 0 56-25.1 56-56v-8h136c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"},child:[]}]})(t)}const g2=()=>{const[t,e]=st.useState("Loading..."),[n,r]=st.useState([]),[s,l]=st.useState(!1),[f,i]=st.useState(0),x="https://ecorideupload.s3.ap-southeast-2.amazonaws.com/uploads/profile/1742829316204_image.png";st.useEffect(()=>{const j=ca(Yr,"notifications"),H=x0(j,tK("timestamp","desc")),G=Qm(H,W=>{const J=[];W.forEach(ie=>{J.push({id:ie.id,...ie.data()})}),r(J),i(J.filter(ie=>!ie.read).length)});return()=>G()},[]),st.useEffect(()=>{const j=m2.onAuthStateChanged(async H=>{if(H)try{const G=ol(Yr,"users",H.uid),W=await w0(G);W.exists()?e(W.data().name):e("Super Admin")}catch(G){console.error("Error fetching user data:",G)}else e("Unknown User")});return()=>j()},[]);const S=()=>{l(!s)},I=async()=>{try{const j=Dce(Yr);n.filter(H=>!H.read).forEach(H=>{const G=ol(Yr,"notifications",H.id);j.update(G,{read:!0})}),await j.commit(),r(n.map(H=>({...H,read:!0}))),i(0)}catch(j){console.error("Error marking notifications as read:",j)}},R=j=>{if(!j)return"";const H=j.toDate();return new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(H)},F=j=>{switch(j.type){case"status_update":return ne.jsxs("div",{className:"notification-message",children:[ne.jsx("p",{children:j.message}),ne.jsx("span",{className:`status-badge ${j.status.toLowerCase().replace(" ","-")}`,children:j.status})]});case"battery_update":return ne.jsxs("div",{className:"notification-message",children:[ne.jsx("p",{children:j.message}),ne.jsx("div",{className:"battery-indicator",children:ne.jsx("span",{className:"battery-level",style:{width:`${j.batteryLevel}%`}})})]});default:return ne.jsx("p",{children:j.message})}};return ne.jsx("div",{className:"header",children:ne.jsxs("div",{className:"user-profile",children:[ne.jsxs("div",{className:"profile",children:[ne.jsx("img",{src:x,alt:"Profile",className:"profile-img"}),ne.jsxs("div",{className:"profile-name",children:[ne.jsx("p",{children:t}),ne.jsx("small",{children:"Super Admin"})]})]}),ne.jsxs("div",{className:"notification-container",children:[ne.jsx(qce,{className:"icon",onClick:S}),f>0&&ne.jsx("span",{className:"notification-badge",children:f}),s&&ne.jsxs("div",{className:"notifications-modal",children:[ne.jsxs("div",{className:"notifications-header",children:[ne.jsx("h3",{children:"Notifications"}),ne.jsx("button",{className:"mark-all-read",onClick:I,disabled:f===0,children:"Mark all as read"})]}),ne.jsx("div",{className:"notifications-list",children:n.length>0?n.map(j=>ne.jsx("div",{className:`notification-item ${j.read?"":"unread"}`,children:ne.jsxs("div",{className:"notification-content",children:[F(j),ne.jsx("span",{className:"notification-time",children:R(j.timestamp)})]})},j.id)):ne.jsx("p",{className:"no-notifications",children:"No notifications"})})]})]})]})})};function Kce(t){return Nc({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M19 2H6c-1.206 0-3 .799-3 3v14c0 2.201 1.794 3 3 3h15v-2H6.012C5.55 19.988 5 19.806 5 19s.55-.988 1.012-1H21V4c0-1.103-.897-2-2-2zm0 14H5V5c0-.806.55-.988 1-1h13v12z"},child:[]}]})(t)}function Yce(t){return Nc({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M11 15.414V20h2v-4.586c0-.526-.214-1.042-.586-1.414l-2-2L13 9.414l2 2c.372.372.888.586 1.414.586H20v-2h-3.586l-3.707-3.707a.999.999 0 0 0-1.414 0L8 9.586c-.378.378-.586.88-.586 1.414s.208 1.036.586 1.414l3 3z"},child:[]},{tag:"circle",attr:{cx:"16",cy:"5",r:"2"},child:[]},{tag:"path",attr:{d:"M18 14c-2.206 0-4 1.794-4 4s1.794 4 4 4 4-1.794 4-4-1.794-4-4-4zm0 6c-1.103 0-2-.897-2-2s.897-2 2-2 2 .897 2 2-.897 2-2 2zM6 22c2.206 0 4-1.794 4-4s-1.794-4-4-4-4 1.794-4 4 1.794 4 4 4zm0-6c1.103 0 2 .897 2 2s-.897 2-2 2-2-.897-2-2 .897-2 2-2z"},child:[]}]})(t)}function Xce(t){return Nc({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M3 13h1v7c0 1.103.897 2 2 2h12c1.103 0 2-.897 2-2v-7h1a1 1 0 0 0 .707-1.707l-9-9a.999.999 0 0 0-1.414 0l-9 9A1 1 0 0 0 3 13zm7 7v-5h4v5h-4zm2-15.586 6 6V15l.001 5H16v-5c0-1.103-.897-2-2-2h-4c-1.103 0-2 .897-2 2v5H6v-9.586l6-6z"},child:[]}]})(t)}function Zce(t){return Nc({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M16 13v-2H7V8l-5 4 5 4v-3z"},child:[]},{tag:"path",attr:{d:"M20 3h-9c-1.103 0-2 .897-2 2v4h2V5h9v14h-9v-4H9v4c0 1.103.897 2 2 2h9c1.103 0 2-.897 2-2V5c0-1.103-.897-2-2-2z"},child:[]}]})(t)}function Jce(t){return Nc({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M20 12a2 2 0 0 0-.703.133l-2.398-1.963c.059-.214.101-.436.101-.67C17 8.114 15.886 7 14.5 7S12 8.114 12 9.5c0 .396.1.765.262 1.097l-2.909 3.438A2.06 2.06 0 0 0 9 14c-.179 0-.348.03-.512.074l-2.563-2.563C5.97 11.348 6 11.179 6 11c0-1.108-.892-2-2-2s-2 .892-2 2 .892 2 2 2c.179 0 .348-.03.512-.074l2.563 2.563A1.906 1.906 0 0 0 7 16c0 1.108.892 2 2 2s2-.892 2-2c0-.237-.048-.46-.123-.671l2.913-3.442c.227.066.462.113.71.113a2.48 2.48 0 0 0 1.133-.281l2.399 1.963A2.077 2.077 0 0 0 18 14c0 1.108.892 2 2 2s2-.892 2-2-.892-2-2-2z"},child:[]}]})(t)}function Qce(t){return Nc({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M4 21h15.893c1.103 0 2-.897 2-2V5c0-1.103-.897-2-2-2H4c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2zm0-2v-5h4v5H4zM14 7v5h-4V7h4zM8 7v5H4V7h4zm2 12v-5h4v5h-4zm6 0v-5h3.894v5H16zm3.893-7H16V7h3.893v5z"},child:[]}]})(t)}function eue(t){return Nc({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M5 22h14c1.103 0 2-.897 2-2V5c0-1.103-.897-2-2-2h-2a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1H5c-1.103 0-2 .897-2 2v15c0 1.103.897 2 2 2zM5 5h2v2h10V5h2v15H5V5z"},child:[]},{tag:"path",attr:{d:"m11 13.586-1.793-1.793-1.414 1.414L11 16.414l5.207-5.207-1.414-1.414z"},child:[]}]})(t)}function tue(t){return Nc({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M20.29 8.29 16 12.58l-1.3-1.29-1.41 1.42 2.7 2.7 5.72-5.7zM4 8a3.91 3.91 0 0 0 4 4 3.91 3.91 0 0 0 4-4 3.91 3.91 0 0 0-4-4 3.91 3.91 0 0 0-4 4zm6 0a1.91 1.91 0 0 1-2 2 1.91 1.91 0 0 1-2-2 1.91 1.91 0 0 1 2-2 1.91 1.91 0 0 1 2 2zM4 18a3 3 0 0 1 3-3h2a3 3 0 0 1 3 3v1h2v-1a5 5 0 0 0-5-5H7a5 5 0 0 0-5 5v1h2z"},child:[]}]})(t)}function nue(t){return Nc({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"m20 8-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8zM9 19H7v-9h2v9zm4 0h-2v-6h2v6zm4 0h-2v-3h2v3zM14 9h-1V4l5 5h-4z"},child:[]}]})(t)}const dK=()=>{const t=jD(),e=Py(),n=async()=>{try{await m2.signOut(),t("/login")}catch(s){console.error("Error signing out: ",s.message)}},r=s=>e.pathname===s;return ne.jsxs("div",{className:"sidebar",children:[ne.jsx("div",{className:"logo",children:ne.jsx("img",{src:"/ecpcaps/assets/ecoridelogo2.png",alt:"EcoRide Logo",style:{width:"100%",maxWidth:"100px",height:"auto"}})}),ne.jsxs("div",{className:"menu-list",children:[ne.jsxs("div",{className:`menu-item ${r("/dashboard")?"active":""}`,onClick:()=>t("/dashboard"),children:[ne.jsx(Xce,{}),ne.jsx("span",{children:"Dashboard"})]}),ne.jsxs("div",{className:`menu-item ${r("/stations")?"active":""}`,onClick:()=>t("/stations"),children:[ne.jsx(Kce,{}),ne.jsx("span",{children:"Manage Stations"})]}),ne.jsxs("div",{className:`menu-item ${r("/user-management")?"active":""}`,onClick:()=>t("/user-management"),children:[ne.jsx(tue,{}),ne.jsx("span",{children:"Manage User"})]}),ne.jsxs("div",{className:`menu-item ${r("/admin-management")?"active":""}`,onClick:()=>t("/admin-management"),children:[ne.jsx(nue,{}),ne.jsx("span",{children:"Manage & Create Admin"})]}),ne.jsxs("div",{className:`menu-item ${r("/bike-management")?"active":""}`,onClick:()=>t("/bike-management"),children:[ne.jsx(Yce,{}),ne.jsx("span",{children:"Manage Bikes"})]}),ne.jsxs("div",{className:`menu-item ${r("/rate-management")?"active":""}`,onClick:()=>t("/rate-management"),children:[ne.jsx(eue,{}),ne.jsx("span",{children:"Rate Management"})]}),ne.jsxs("div",{className:`menu-item ${r("/system-analytics")?"active":""}`,onClick:()=>t("/system-analytics"),children:[ne.jsx(Jce,{}),ne.jsx("span",{children:"System Analytics"})]}),ne.jsxs("div",{className:`menu-item ${r("/ride-details")?"active":""}`,onClick:()=>t("/ride-details"),children:[ne.jsx(Qce,{}),ne.jsx("span",{children:"Ride Details"})]}),ne.jsxs("div",{className:"menu-item logout",onClick:n,children:[ne.jsx(Zce,{}),ne.jsx("span",{children:"Logout"})]})]})]})};var CA={exports:{}},rue=CA.exports,wj;function iue(){return wj||(wj=1,function(t,e){(function(n,r){t.exports=r()})(rue,function(){var n,r,s;function l(i,x){if(!n)n=x;else if(!r)r=x;else{var S="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+n+")(sharedChunk); ("+r+")(sharedChunk); self.onerror = null;",I={};n(I),s=x(I),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(s.workerUrl=window.URL.createObjectURL(new Blob([S],{type:"text/javascript"})))}}l(["exports"],function(i){function x(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var S,I={},R={};function F(){if(S)return R;S=1,Object.defineProperty(R,"__esModule",{value:!0}),R.setMatrixArrayType=function(g){R.ARRAY_TYPE=a=g},R.toRadian=function(g){return g*d},R.equals=function(g,m){return Math.abs(g-m)<=h*Math.max(1,Math.abs(g),Math.abs(m))},R.RANDOM=R.ARRAY_TYPE=R.EPSILON=void 0;var h=1e-6;R.EPSILON=h;var a=typeof Float32Array<"u"?Float32Array:Array;R.ARRAY_TYPE=a;var c=Math.random;R.RANDOM=c;var d=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var g=0,m=arguments.length;m--;)g+=arguments[m]*arguments[m];return Math.sqrt(g)}),R}var j,H={};function G(){if(j)return H;function h(m){return h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(v){return typeof v}:function(v){return v&&typeof Symbol=="function"&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v},h(m)}j=1,Object.defineProperty(H,"__esModule",{value:!0}),H.create=function(){var m=new a.ARRAY_TYPE(4);return a.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m},H.clone=function(m){var v=new a.ARRAY_TYPE(4);return v[0]=m[0],v[1]=m[1],v[2]=m[2],v[3]=m[3],v},H.copy=function(m,v){return m[0]=v[0],m[1]=v[1],m[2]=v[2],m[3]=v[3],m},H.identity=function(m){return m[0]=1,m[1]=0,m[2]=0,m[3]=1,m},H.fromValues=function(m,v,E,P){var L=new a.ARRAY_TYPE(4);return L[0]=m,L[1]=v,L[2]=E,L[3]=P,L},H.set=function(m,v,E,P,L){return m[0]=v,m[1]=E,m[2]=P,m[3]=L,m},H.transpose=function(m,v){if(m===v){var E=v[1];m[1]=v[2],m[2]=E}else m[0]=v[0],m[1]=v[2],m[2]=v[1],m[3]=v[3];return m},H.invert=function(m,v){var E=v[0],P=v[1],L=v[2],A=v[3],O=E*A-L*P;return O?(m[0]=A*(O=1/O),m[1]=-P*O,m[2]=-L*O,m[3]=E*O,m):null},H.adjoint=function(m,v){var E=v[0];return m[0]=v[3],m[1]=-v[1],m[2]=-v[2],m[3]=E,m},H.determinant=function(m){return m[0]*m[3]-m[2]*m[1]},H.multiply=d,H.rotate=function(m,v,E){var P=v[0],L=v[1],A=v[2],O=v[3],N=Math.sin(E),D=Math.cos(E);return m[0]=P*D+A*N,m[1]=L*D+O*N,m[2]=P*-N+A*D,m[3]=L*-N+O*D,m},H.scale=function(m,v,E){var P=v[1],L=v[2],A=v[3],O=E[0],N=E[1];return m[0]=v[0]*O,m[1]=P*O,m[2]=L*N,m[3]=A*N,m},H.fromRotation=function(m,v){var E=Math.sin(v),P=Math.cos(v);return m[0]=P,m[1]=E,m[2]=-E,m[3]=P,m},H.fromScaling=function(m,v){return m[0]=v[0],m[1]=0,m[2]=0,m[3]=v[1],m},H.str=function(m){return"mat2("+m[0]+", "+m[1]+", "+m[2]+", "+m[3]+")"},H.frob=function(m){return Math.hypot(m[0],m[1],m[2],m[3])},H.LDU=function(m,v,E,P){return m[2]=P[2]/P[0],E[0]=P[0],E[1]=P[1],E[3]=P[3]-m[2]*E[1],[m,v,E]},H.add=function(m,v,E){return m[0]=v[0]+E[0],m[1]=v[1]+E[1],m[2]=v[2]+E[2],m[3]=v[3]+E[3],m},H.subtract=g,H.exactEquals=function(m,v){return m[0]===v[0]&&m[1]===v[1]&&m[2]===v[2]&&m[3]===v[3]},H.equals=function(m,v){var E=m[0],P=m[1],L=m[2],A=m[3],O=v[0],N=v[1],D=v[2],k=v[3];return Math.abs(E-O)<=a.EPSILON*Math.max(1,Math.abs(E),Math.abs(O))&&Math.abs(P-N)<=a.EPSILON*Math.max(1,Math.abs(P),Math.abs(N))&&Math.abs(L-D)<=a.EPSILON*Math.max(1,Math.abs(L),Math.abs(D))&&Math.abs(A-k)<=a.EPSILON*Math.max(1,Math.abs(A),Math.abs(k))},H.multiplyScalar=function(m,v,E){return m[0]=v[0]*E,m[1]=v[1]*E,m[2]=v[2]*E,m[3]=v[3]*E,m},H.multiplyScalarAndAdd=function(m,v,E,P){return m[0]=v[0]+E[0]*P,m[1]=v[1]+E[1]*P,m[2]=v[2]+E[2]*P,m[3]=v[3]+E[3]*P,m},H.sub=H.mul=void 0;var a=function(m,v){if(m&&m.__esModule)return m;if(m===null||h(m)!=="object"&&typeof m!="function")return{default:m};var E=c(void 0);if(E&&E.has(m))return E.get(m);var P={},L=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var A in m)if(A!=="default"&&Object.prototype.hasOwnProperty.call(m,A)){var O=L?Object.getOwnPropertyDescriptor(m,A):null;O&&(O.get||O.set)?Object.defineProperty(P,A,O):P[A]=m[A]}return P.default=m,E&&E.set(m,P),P}(F());function c(m){if(typeof WeakMap!="function")return null;var v=new WeakMap,E=new WeakMap;return(c=function(P){return P?E:v})(m)}function d(m,v,E){var P=v[0],L=v[1],A=v[2],O=v[3],N=E[0],D=E[1],k=E[2],U=E[3];return m[0]=P*N+A*D,m[1]=L*N+O*D,m[2]=P*k+A*U,m[3]=L*k+O*U,m}function g(m,v,E){return m[0]=v[0]-E[0],m[1]=v[1]-E[1],m[2]=v[2]-E[2],m[3]=v[3]-E[3],m}return H.mul=d,H.sub=g,H}var W,J={};function ie(){if(W)return J;function h(m){return h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(v){return typeof v}:function(v){return v&&typeof Symbol=="function"&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v},h(m)}W=1,Object.defineProperty(J,"__esModule",{value:!0}),J.create=function(){var m=new a.ARRAY_TYPE(6);return a.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0,m[4]=0,m[5]=0),m[0]=1,m[3]=1,m},J.clone=function(m){var v=new a.ARRAY_TYPE(6);return v[0]=m[0],v[1]=m[1],v[2]=m[2],v[3]=m[3],v[4]=m[4],v[5]=m[5],v},J.copy=function(m,v){return m[0]=v[0],m[1]=v[1],m[2]=v[2],m[3]=v[3],m[4]=v[4],m[5]=v[5],m},J.identity=function(m){return m[0]=1,m[1]=0,m[2]=0,m[3]=1,m[4]=0,m[5]=0,m},J.fromValues=function(m,v,E,P,L,A){var O=new a.ARRAY_TYPE(6);return O[0]=m,O[1]=v,O[2]=E,O[3]=P,O[4]=L,O[5]=A,O},J.set=function(m,v,E,P,L,A,O){return m[0]=v,m[1]=E,m[2]=P,m[3]=L,m[4]=A,m[5]=O,m},J.invert=function(m,v){var E=v[0],P=v[1],L=v[2],A=v[3],O=v[4],N=v[5],D=E*A-P*L;return D?(m[0]=A*(D=1/D),m[1]=-P*D,m[2]=-L*D,m[3]=E*D,m[4]=(L*N-A*O)*D,m[5]=(P*O-E*N)*D,m):null},J.determinant=function(m){return m[0]*m[3]-m[1]*m[2]},J.multiply=d,J.rotate=function(m,v,E){var P=v[0],L=v[1],A=v[2],O=v[3],N=v[4],D=v[5],k=Math.sin(E),U=Math.cos(E);return m[0]=P*U+A*k,m[1]=L*U+O*k,m[2]=P*-k+A*U,m[3]=L*-k+O*U,m[4]=N,m[5]=D,m},J.scale=function(m,v,E){var P=v[1],L=v[2],A=v[3],O=v[4],N=v[5],D=E[0],k=E[1];return m[0]=v[0]*D,m[1]=P*D,m[2]=L*k,m[3]=A*k,m[4]=O,m[5]=N,m},J.translate=function(m,v,E){var P=v[0],L=v[1],A=v[2],O=v[3],N=v[4],D=v[5],k=E[0],U=E[1];return m[0]=P,m[1]=L,m[2]=A,m[3]=O,m[4]=P*k+A*U+N,m[5]=L*k+O*U+D,m},J.fromRotation=function(m,v){var E=Math.sin(v),P=Math.cos(v);return m[0]=P,m[1]=E,m[2]=-E,m[3]=P,m[4]=0,m[5]=0,m},J.fromScaling=function(m,v){return m[0]=v[0],m[1]=0,m[2]=0,m[3]=v[1],m[4]=0,m[5]=0,m},J.fromTranslation=function(m,v){return m[0]=1,m[1]=0,m[2]=0,m[3]=1,m[4]=v[0],m[5]=v[1],m},J.str=function(m){return"mat2d("+m[0]+", "+m[1]+", "+m[2]+", "+m[3]+", "+m[4]+", "+m[5]+")"},J.frob=function(m){return Math.hypot(m[0],m[1],m[2],m[3],m[4],m[5],1)},J.add=function(m,v,E){return m[0]=v[0]+E[0],m[1]=v[1]+E[1],m[2]=v[2]+E[2],m[3]=v[3]+E[3],m[4]=v[4]+E[4],m[5]=v[5]+E[5],m},J.subtract=g,J.multiplyScalar=function(m,v,E){return m[0]=v[0]*E,m[1]=v[1]*E,m[2]=v[2]*E,m[3]=v[3]*E,m[4]=v[4]*E,m[5]=v[5]*E,m},J.multiplyScalarAndAdd=function(m,v,E,P){return m[0]=v[0]+E[0]*P,m[1]=v[1]+E[1]*P,m[2]=v[2]+E[2]*P,m[3]=v[3]+E[3]*P,m[4]=v[4]+E[4]*P,m[5]=v[5]+E[5]*P,m},J.exactEquals=function(m,v){return m[0]===v[0]&&m[1]===v[1]&&m[2]===v[2]&&m[3]===v[3]&&m[4]===v[4]&&m[5]===v[5]},J.equals=function(m,v){var E=m[0],P=m[1],L=m[2],A=m[3],O=m[4],N=m[5],D=v[0],k=v[1],U=v[2],X=v[3],Q=v[4],le=v[5];return Math.abs(E-D)<=a.EPSILON*Math.max(1,Math.abs(E),Math.abs(D))&&Math.abs(P-k)<=a.EPSILON*Math.max(1,Math.abs(P),Math.abs(k))&&Math.abs(L-U)<=a.EPSILON*Math.max(1,Math.abs(L),Math.abs(U))&&Math.abs(A-X)<=a.EPSILON*Math.max(1,Math.abs(A),Math.abs(X))&&Math.abs(O-Q)<=a.EPSILON*Math.max(1,Math.abs(O),Math.abs(Q))&&Math.abs(N-le)<=a.EPSILON*Math.max(1,Math.abs(N),Math.abs(le))},J.sub=J.mul=void 0;var a=function(m,v){if(m&&m.__esModule)return m;if(m===null||h(m)!=="object"&&typeof m!="function")return{default:m};var E=c(void 0);if(E&&E.has(m))return E.get(m);var P={},L=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var A in m)if(A!=="default"&&Object.prototype.hasOwnProperty.call(m,A)){var O=L?Object.getOwnPropertyDescriptor(m,A):null;O&&(O.get||O.set)?Object.defineProperty(P,A,O):P[A]=m[A]}return P.default=m,E&&E.set(m,P),P}(F());function c(m){if(typeof WeakMap!="function")return null;var v=new WeakMap,E=new WeakMap;return(c=function(P){return P?E:v})(m)}function d(m,v,E){var P=v[0],L=v[1],A=v[2],O=v[3],N=v[4],D=v[5],k=E[0],U=E[1],X=E[2],Q=E[3],le=E[4],oe=E[5];return m[0]=P*k+A*U,m[1]=L*k+O*U,m[2]=P*X+A*Q,m[3]=L*X+O*Q,m[4]=P*le+A*oe+N,m[5]=L*le+O*oe+D,m}function g(m,v,E){return m[0]=v[0]-E[0],m[1]=v[1]-E[1],m[2]=v[2]-E[2],m[3]=v[3]-E[3],m[4]=v[4]-E[4],m[5]=v[5]-E[5],m}return J.mul=d,J.sub=g,J}var he,ge={};function fe(){if(he)return ge;function h(m){return h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(v){return typeof v}:function(v){return v&&typeof Symbol=="function"&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v},h(m)}he=1,Object.defineProperty(ge,"__esModule",{value:!0}),ge.create=function(){var m=new a.ARRAY_TYPE(9);return a.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0,m[3]=0,m[5]=0,m[6]=0,m[7]=0),m[0]=1,m[4]=1,m[8]=1,m},ge.fromMat4=function(m,v){return m[0]=v[0],m[1]=v[1],m[2]=v[2],m[3]=v[4],m[4]=v[5],m[5]=v[6],m[6]=v[8],m[7]=v[9],m[8]=v[10],m},ge.clone=function(m){var v=new a.ARRAY_TYPE(9);return v[0]=m[0],v[1]=m[1],v[2]=m[2],v[3]=m[3],v[4]=m[4],v[5]=m[5],v[6]=m[6],v[7]=m[7],v[8]=m[8],v},ge.copy=function(m,v){return m[0]=v[0],m[1]=v[1],m[2]=v[2],m[3]=v[3],m[4]=v[4],m[5]=v[5],m[6]=v[6],m[7]=v[7],m[8]=v[8],m},ge.fromValues=function(m,v,E,P,L,A,O,N,D){var k=new a.ARRAY_TYPE(9);return k[0]=m,k[1]=v,k[2]=E,k[3]=P,k[4]=L,k[5]=A,k[6]=O,k[7]=N,k[8]=D,k},ge.set=function(m,v,E,P,L,A,O,N,D,k){return m[0]=v,m[1]=E,m[2]=P,m[3]=L,m[4]=A,m[5]=O,m[6]=N,m[7]=D,m[8]=k,m},ge.identity=function(m){return m[0]=1,m[1]=0,m[2]=0,m[3]=0,m[4]=1,m[5]=0,m[6]=0,m[7]=0,m[8]=1,m},ge.transpose=function(m,v){if(m===v){var E=v[1],P=v[2],L=v[5];m[1]=v[3],m[2]=v[6],m[3]=E,m[5]=v[7],m[6]=P,m[7]=L}else m[0]=v[0],m[1]=v[3],m[2]=v[6],m[3]=v[1],m[4]=v[4],m[5]=v[7],m[6]=v[2],m[7]=v[5],m[8]=v[8];return m},ge.invert=function(m,v){var E=v[0],P=v[1],L=v[2],A=v[3],O=v[4],N=v[5],D=v[6],k=v[7],U=v[8],X=U*O-N*k,Q=-U*A+N*D,le=k*A-O*D,oe=E*X+P*Q+L*le;return oe?(m[0]=X*(oe=1/oe),m[1]=(-U*P+L*k)*oe,m[2]=(N*P-L*O)*oe,m[3]=Q*oe,m[4]=(U*E-L*D)*oe,m[5]=(-N*E+L*A)*oe,m[6]=le*oe,m[7]=(-k*E+P*D)*oe,m[8]=(O*E-P*A)*oe,m):null},ge.adjoint=function(m,v){var E=v[0],P=v[1],L=v[2],A=v[3],O=v[4],N=v[5],D=v[6],k=v[7],U=v[8];return m[0]=O*U-N*k,m[1]=L*k-P*U,m[2]=P*N-L*O,m[3]=N*D-A*U,m[4]=E*U-L*D,m[5]=L*A-E*N,m[6]=A*k-O*D,m[7]=P*D-E*k,m[8]=E*O-P*A,m},ge.determinant=function(m){var v=m[3],E=m[4],P=m[5],L=m[6],A=m[7],O=m[8];return m[0]*(O*E-P*A)+m[1]*(-O*v+P*L)+m[2]*(A*v-E*L)},ge.multiply=d,ge.translate=function(m,v,E){var P=v[0],L=v[1],A=v[2],O=v[3],N=v[4],D=v[5],k=v[6],U=v[7],X=v[8],Q=E[0],le=E[1];return m[0]=P,m[1]=L,m[2]=A,m[3]=O,m[4]=N,m[5]=D,m[6]=Q*P+le*O+k,m[7]=Q*L+le*N+U,m[8]=Q*A+le*D+X,m},ge.rotate=function(m,v,E){var P=v[0],L=v[1],A=v[2],O=v[3],N=v[4],D=v[5],k=v[6],U=v[7],X=v[8],Q=Math.sin(E),le=Math.cos(E);return m[0]=le*P+Q*O,m[1]=le*L+Q*N,m[2]=le*A+Q*D,m[3]=le*O-Q*P,m[4]=le*N-Q*L,m[5]=le*D-Q*A,m[6]=k,m[7]=U,m[8]=X,m},ge.scale=function(m,v,E){var P=E[0],L=E[1];return m[0]=P*v[0],m[1]=P*v[1],m[2]=P*v[2],m[3]=L*v[3],m[4]=L*v[4],m[5]=L*v[5],m[6]=v[6],m[7]=v[7],m[8]=v[8],m},ge.fromTranslation=function(m,v){return m[0]=1,m[1]=0,m[2]=0,m[3]=0,m[4]=1,m[5]=0,m[6]=v[0],m[7]=v[1],m[8]=1,m},ge.fromRotation=function(m,v){var E=Math.sin(v),P=Math.cos(v);return m[0]=P,m[1]=E,m[2]=0,m[3]=-E,m[4]=P,m[5]=0,m[6]=0,m[7]=0,m[8]=1,m},ge.fromScaling=function(m,v){return m[0]=v[0],m[1]=0,m[2]=0,m[3]=0,m[4]=v[1],m[5]=0,m[6]=0,m[7]=0,m[8]=1,m},ge.fromMat2d=function(m,v){return m[0]=v[0],m[1]=v[1],m[2]=0,m[3]=v[2],m[4]=v[3],m[5]=0,m[6]=v[4],m[7]=v[5],m[8]=1,m},ge.fromQuat=function(m,v){var E=v[0],P=v[1],L=v[2],A=v[3],O=E+E,N=P+P,D=L+L,k=E*O,U=P*O,X=P*N,Q=L*O,le=L*N,oe=L*D,re=A*O,me=A*N,Se=A*D;return m[0]=1-X-oe,m[3]=U-Se,m[6]=Q+me,m[1]=U+Se,m[4]=1-k-oe,m[7]=le-re,m[2]=Q-me,m[5]=le+re,m[8]=1-k-X,m},ge.normalFromMat4=function(m,v){var E=v[0],P=v[1],L=v[2],A=v[3],O=v[4],N=v[5],D=v[6],k=v[7],U=v[8],X=v[9],Q=v[10],le=v[11],oe=v[12],re=v[13],me=v[14],Se=v[15],Me=E*N-P*O,We=E*D-L*O,$e=E*k-A*O,He=P*D-L*N,ht=P*k-A*N,Ke=L*k-A*D,pt=U*re-X*oe,Et=U*me-Q*oe,wt=U*Se-le*oe,Ot=X*me-Q*re,It=X*Se-le*re,jt=Q*Se-le*me,Dt=Me*jt-We*It+$e*Ot+He*wt-ht*Et+Ke*pt;return Dt?(m[0]=(N*jt-D*It+k*Ot)*(Dt=1/Dt),m[1]=(D*wt-O*jt-k*Et)*Dt,m[2]=(O*It-N*wt+k*pt)*Dt,m[3]=(L*It-P*jt-A*Ot)*Dt,m[4]=(E*jt-L*wt+A*Et)*Dt,m[5]=(P*wt-E*It-A*pt)*Dt,m[6]=(re*Ke-me*ht+Se*He)*Dt,m[7]=(me*$e-oe*Ke-Se*We)*Dt,m[8]=(oe*ht-re*$e+Se*Me)*Dt,m):null},ge.projection=function(m,v,E){return m[0]=2/v,m[1]=0,m[2]=0,m[3]=0,m[4]=-2/E,m[5]=0,m[6]=-1,m[7]=1,m[8]=1,m},ge.str=function(m){return"mat3("+m[0]+", "+m[1]+", "+m[2]+", "+m[3]+", "+m[4]+", "+m[5]+", "+m[6]+", "+m[7]+", "+m[8]+")"},ge.frob=function(m){return Math.hypot(m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7],m[8])},ge.add=function(m,v,E){return m[0]=v[0]+E[0],m[1]=v[1]+E[1],m[2]=v[2]+E[2],m[3]=v[3]+E[3],m[4]=v[4]+E[4],m[5]=v[5]+E[5],m[6]=v[6]+E[6],m[7]=v[7]+E[7],m[8]=v[8]+E[8],m},ge.subtract=g,ge.multiplyScalar=function(m,v,E){return m[0]=v[0]*E,m[1]=v[1]*E,m[2]=v[2]*E,m[3]=v[3]*E,m[4]=v[4]*E,m[5]=v[5]*E,m[6]=v[6]*E,m[7]=v[7]*E,m[8]=v[8]*E,m},ge.multiplyScalarAndAdd=function(m,v,E,P){return m[0]=v[0]+E[0]*P,m[1]=v[1]+E[1]*P,m[2]=v[2]+E[2]*P,m[3]=v[3]+E[3]*P,m[4]=v[4]+E[4]*P,m[5]=v[5]+E[5]*P,m[6]=v[6]+E[6]*P,m[7]=v[7]+E[7]*P,m[8]=v[8]+E[8]*P,m},ge.exactEquals=function(m,v){return m[0]===v[0]&&m[1]===v[1]&&m[2]===v[2]&&m[3]===v[3]&&m[4]===v[4]&&m[5]===v[5]&&m[6]===v[6]&&m[7]===v[7]&&m[8]===v[8]},ge.equals=function(m,v){var E=m[0],P=m[1],L=m[2],A=m[3],O=m[4],N=m[5],D=m[6],k=m[7],U=m[8],X=v[0],Q=v[1],le=v[2],oe=v[3],re=v[4],me=v[5],Se=v[6],Me=v[7],We=v[8];return Math.abs(E-X)<=a.EPSILON*Math.max(1,Math.abs(E),Math.abs(X))&&Math.abs(P-Q)<=a.EPSILON*Math.max(1,Math.abs(P),Math.abs(Q))&&Math.abs(L-le)<=a.EPSILON*Math.max(1,Math.abs(L),Math.abs(le))&&Math.abs(A-oe)<=a.EPSILON*Math.max(1,Math.abs(A),Math.abs(oe))&&Math.abs(O-re)<=a.EPSILON*Math.max(1,Math.abs(O),Math.abs(re))&&Math.abs(N-me)<=a.EPSILON*Math.max(1,Math.abs(N),Math.abs(me))&&Math.abs(D-Se)<=a.EPSILON*Math.max(1,Math.abs(D),Math.abs(Se))&&Math.abs(k-Me)<=a.EPSILON*Math.max(1,Math.abs(k),Math.abs(Me))&&Math.abs(U-We)<=a.EPSILON*Math.max(1,Math.abs(U),Math.abs(We))},ge.sub=ge.mul=void 0;var a=function(m,v){if(m&&m.__esModule)return m;if(m===null||h(m)!=="object"&&typeof m!="function")return{default:m};var E=c(void 0);if(E&&E.has(m))return E.get(m);var P={},L=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var A in m)if(A!=="default"&&Object.prototype.hasOwnProperty.call(m,A)){var O=L?Object.getOwnPropertyDescriptor(m,A):null;O&&(O.get||O.set)?Object.defineProperty(P,A,O):P[A]=m[A]}return P.default=m,E&&E.set(m,P),P}(F());function c(m){if(typeof WeakMap!="function")return null;var v=new WeakMap,E=new WeakMap;return(c=function(P){return P?E:v})(m)}function d(m,v,E){var P=v[0],L=v[1],A=v[2],O=v[3],N=v[4],D=v[5],k=v[6],U=v[7],X=v[8],Q=E[0],le=E[1],oe=E[2],re=E[3],me=E[4],Se=E[5],Me=E[6],We=E[7],$e=E[8];return m[0]=Q*P+le*O+oe*k,m[1]=Q*L+le*N+oe*U,m[2]=Q*A+le*D+oe*X,m[3]=re*P+me*O+Se*k,m[4]=re*L+me*N+Se*U,m[5]=re*A+me*D+Se*X,m[6]=Me*P+We*O+$e*k,m[7]=Me*L+We*N+$e*U,m[8]=Me*A+We*D+$e*X,m}function g(m,v,E){return m[0]=v[0]-E[0],m[1]=v[1]-E[1],m[2]=v[2]-E[2],m[3]=v[3]-E[3],m[4]=v[4]-E[4],m[5]=v[5]-E[5],m[6]=v[6]-E[6],m[7]=v[7]-E[7],m[8]=v[8]-E[8],m}return ge.mul=d,ge.sub=g,ge}var ye,pe={};function be(){if(ye)return pe;function h(A){return h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(O){return typeof O}:function(O){return O&&typeof Symbol=="function"&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O},h(A)}ye=1,Object.defineProperty(pe,"__esModule",{value:!0}),pe.create=function(){var A=new a.ARRAY_TYPE(16);return a.ARRAY_TYPE!=Float32Array&&(A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[11]=0,A[12]=0,A[13]=0,A[14]=0),A[0]=1,A[5]=1,A[10]=1,A[15]=1,A},pe.clone=function(A){var O=new a.ARRAY_TYPE(16);return O[0]=A[0],O[1]=A[1],O[2]=A[2],O[3]=A[3],O[4]=A[4],O[5]=A[5],O[6]=A[6],O[7]=A[7],O[8]=A[8],O[9]=A[9],O[10]=A[10],O[11]=A[11],O[12]=A[12],O[13]=A[13],O[14]=A[14],O[15]=A[15],O},pe.copy=function(A,O){return A[0]=O[0],A[1]=O[1],A[2]=O[2],A[3]=O[3],A[4]=O[4],A[5]=O[5],A[6]=O[6],A[7]=O[7],A[8]=O[8],A[9]=O[9],A[10]=O[10],A[11]=O[11],A[12]=O[12],A[13]=O[13],A[14]=O[14],A[15]=O[15],A},pe.fromValues=function(A,O,N,D,k,U,X,Q,le,oe,re,me,Se,Me,We,$e){var He=new a.ARRAY_TYPE(16);return He[0]=A,He[1]=O,He[2]=N,He[3]=D,He[4]=k,He[5]=U,He[6]=X,He[7]=Q,He[8]=le,He[9]=oe,He[10]=re,He[11]=me,He[12]=Se,He[13]=Me,He[14]=We,He[15]=$e,He},pe.set=function(A,O,N,D,k,U,X,Q,le,oe,re,me,Se,Me,We,$e,He){return A[0]=O,A[1]=N,A[2]=D,A[3]=k,A[4]=U,A[5]=X,A[6]=Q,A[7]=le,A[8]=oe,A[9]=re,A[10]=me,A[11]=Se,A[12]=Me,A[13]=We,A[14]=$e,A[15]=He,A},pe.identity=d,pe.transpose=function(A,O){if(A===O){var N=O[1],D=O[2],k=O[3],U=O[6],X=O[7],Q=O[11];A[1]=O[4],A[2]=O[8],A[3]=O[12],A[4]=N,A[6]=O[9],A[7]=O[13],A[8]=D,A[9]=U,A[11]=O[14],A[12]=k,A[13]=X,A[14]=Q}else A[0]=O[0],A[1]=O[4],A[2]=O[8],A[3]=O[12],A[4]=O[1],A[5]=O[5],A[6]=O[9],A[7]=O[13],A[8]=O[2],A[9]=O[6],A[10]=O[10],A[11]=O[14],A[12]=O[3],A[13]=O[7],A[14]=O[11],A[15]=O[15];return A},pe.invert=function(A,O){var N=O[0],D=O[1],k=O[2],U=O[3],X=O[4],Q=O[5],le=O[6],oe=O[7],re=O[8],me=O[9],Se=O[10],Me=O[11],We=O[12],$e=O[13],He=O[14],ht=O[15],Ke=N*Q-D*X,pt=N*le-k*X,Et=N*oe-U*X,wt=D*le-k*Q,Ot=D*oe-U*Q,It=k*oe-U*le,jt=re*$e-me*We,Dt=re*He-Se*We,Vt=re*ht-Me*We,_n=me*He-Se*$e,gn=me*ht-Me*$e,Zn=Se*ht-Me*He,Cn=Ke*Zn-pt*gn+Et*_n+wt*Vt-Ot*Dt+It*jt;return Cn?(A[0]=(Q*Zn-le*gn+oe*_n)*(Cn=1/Cn),A[1]=(k*gn-D*Zn-U*_n)*Cn,A[2]=($e*It-He*Ot+ht*wt)*Cn,A[3]=(Se*Ot-me*It-Me*wt)*Cn,A[4]=(le*Vt-X*Zn-oe*Dt)*Cn,A[5]=(N*Zn-k*Vt+U*Dt)*Cn,A[6]=(He*Et-We*It-ht*pt)*Cn,A[7]=(re*It-Se*Et+Me*pt)*Cn,A[8]=(X*gn-Q*Vt+oe*jt)*Cn,A[9]=(D*Vt-N*gn-U*jt)*Cn,A[10]=(We*Ot-$e*Et+ht*Ke)*Cn,A[11]=(me*Et-re*Ot-Me*Ke)*Cn,A[12]=(Q*Dt-X*_n-le*jt)*Cn,A[13]=(N*_n-D*Dt+k*jt)*Cn,A[14]=($e*pt-We*wt-He*Ke)*Cn,A[15]=(re*wt-me*pt+Se*Ke)*Cn,A):null},pe.adjoint=function(A,O){var N=O[0],D=O[1],k=O[2],U=O[3],X=O[4],Q=O[5],le=O[6],oe=O[7],re=O[8],me=O[9],Se=O[10],Me=O[11],We=O[12],$e=O[13],He=O[14],ht=O[15];return A[0]=Q*(Se*ht-Me*He)-me*(le*ht-oe*He)+$e*(le*Me-oe*Se),A[1]=-(D*(Se*ht-Me*He)-me*(k*ht-U*He)+$e*(k*Me-U*Se)),A[2]=D*(le*ht-oe*He)-Q*(k*ht-U*He)+$e*(k*oe-U*le),A[3]=-(D*(le*Me-oe*Se)-Q*(k*Me-U*Se)+me*(k*oe-U*le)),A[4]=-(X*(Se*ht-Me*He)-re*(le*ht-oe*He)+We*(le*Me-oe*Se)),A[5]=N*(Se*ht-Me*He)-re*(k*ht-U*He)+We*(k*Me-U*Se),A[6]=-(N*(le*ht-oe*He)-X*(k*ht-U*He)+We*(k*oe-U*le)),A[7]=N*(le*Me-oe*Se)-X*(k*Me-U*Se)+re*(k*oe-U*le),A[8]=X*(me*ht-Me*$e)-re*(Q*ht-oe*$e)+We*(Q*Me-oe*me),A[9]=-(N*(me*ht-Me*$e)-re*(D*ht-U*$e)+We*(D*Me-U*me)),A[10]=N*(Q*ht-oe*$e)-X*(D*ht-U*$e)+We*(D*oe-U*Q),A[11]=-(N*(Q*Me-oe*me)-X*(D*Me-U*me)+re*(D*oe-U*Q)),A[12]=-(X*(me*He-Se*$e)-re*(Q*He-le*$e)+We*(Q*Se-le*me)),A[13]=N*(me*He-Se*$e)-re*(D*He-k*$e)+We*(D*Se-k*me),A[14]=-(N*(Q*He-le*$e)-X*(D*He-k*$e)+We*(D*le-k*Q)),A[15]=N*(Q*Se-le*me)-X*(D*Se-k*me)+re*(D*le-k*Q),A},pe.determinant=function(A){var O=A[0],N=A[1],D=A[2],k=A[3],U=A[4],X=A[5],Q=A[6],le=A[7],oe=A[8],re=A[9],me=A[10],Se=A[11],Me=A[12],We=A[13],$e=A[14],He=A[15];return(O*X-N*U)*(me*He-Se*$e)-(O*Q-D*U)*(re*He-Se*We)+(O*le-k*U)*(re*$e-me*We)+(N*Q-D*X)*(oe*He-Se*Me)-(N*le-k*X)*(oe*$e-me*Me)+(D*le-k*Q)*(oe*We-re*Me)},pe.multiply=g,pe.translate=function(A,O,N){var D,k,U,X,Q,le,oe,re,me,Se,Me,We,$e=N[0],He=N[1],ht=N[2];return O===A?(A[12]=O[0]*$e+O[4]*He+O[8]*ht+O[12],A[13]=O[1]*$e+O[5]*He+O[9]*ht+O[13],A[14]=O[2]*$e+O[6]*He+O[10]*ht+O[14],A[15]=O[3]*$e+O[7]*He+O[11]*ht+O[15]):(k=O[1],U=O[2],X=O[3],Q=O[4],le=O[5],oe=O[6],re=O[7],me=O[8],Se=O[9],Me=O[10],We=O[11],A[0]=D=O[0],A[1]=k,A[2]=U,A[3]=X,A[4]=Q,A[5]=le,A[6]=oe,A[7]=re,A[8]=me,A[9]=Se,A[10]=Me,A[11]=We,A[12]=D*$e+Q*He+me*ht+O[12],A[13]=k*$e+le*He+Se*ht+O[13],A[14]=U*$e+oe*He+Me*ht+O[14],A[15]=X*$e+re*He+We*ht+O[15]),A},pe.scale=function(A,O,N){var D=N[0],k=N[1],U=N[2];return A[0]=O[0]*D,A[1]=O[1]*D,A[2]=O[2]*D,A[3]=O[3]*D,A[4]=O[4]*k,A[5]=O[5]*k,A[6]=O[6]*k,A[7]=O[7]*k,A[8]=O[8]*U,A[9]=O[9]*U,A[10]=O[10]*U,A[11]=O[11]*U,A[12]=O[12],A[13]=O[13],A[14]=O[14],A[15]=O[15],A},pe.rotate=function(A,O,N,D){var k,U,X,Q,le,oe,re,me,Se,Me,We,$e,He,ht,Ke,pt,Et,wt,Ot,It,jt,Dt,Vt,_n,gn=D[0],Zn=D[1],Cn=D[2],Ln=Math.hypot(gn,Zn,Cn);return Ln<a.EPSILON?null:(gn*=Ln=1/Ln,Zn*=Ln,Cn*=Ln,k=Math.sin(N),U=Math.cos(N),le=O[1],oe=O[2],re=O[3],Se=O[5],Me=O[6],We=O[7],He=O[9],ht=O[10],Ke=O[11],pt=gn*gn*(X=1-U)+U,Ot=gn*Zn*X-Cn*k,It=Zn*Zn*X+U,jt=Cn*Zn*X+gn*k,Dt=gn*Cn*X+Zn*k,Vt=Zn*Cn*X-gn*k,_n=Cn*Cn*X+U,A[0]=(Q=O[0])*pt+(me=O[4])*(Et=Zn*gn*X+Cn*k)+($e=O[8])*(wt=Cn*gn*X-Zn*k),A[1]=le*pt+Se*Et+He*wt,A[2]=oe*pt+Me*Et+ht*wt,A[3]=re*pt+We*Et+Ke*wt,A[4]=Q*Ot+me*It+$e*jt,A[5]=le*Ot+Se*It+He*jt,A[6]=oe*Ot+Me*It+ht*jt,A[7]=re*Ot+We*It+Ke*jt,A[8]=Q*Dt+me*Vt+$e*_n,A[9]=le*Dt+Se*Vt+He*_n,A[10]=oe*Dt+Me*Vt+ht*_n,A[11]=re*Dt+We*Vt+Ke*_n,O!==A&&(A[12]=O[12],A[13]=O[13],A[14]=O[14],A[15]=O[15]),A)},pe.rotateX=function(A,O,N){var D=Math.sin(N),k=Math.cos(N),U=O[4],X=O[5],Q=O[6],le=O[7],oe=O[8],re=O[9],me=O[10],Se=O[11];return O!==A&&(A[0]=O[0],A[1]=O[1],A[2]=O[2],A[3]=O[3],A[12]=O[12],A[13]=O[13],A[14]=O[14],A[15]=O[15]),A[4]=U*k+oe*D,A[5]=X*k+re*D,A[6]=Q*k+me*D,A[7]=le*k+Se*D,A[8]=oe*k-U*D,A[9]=re*k-X*D,A[10]=me*k-Q*D,A[11]=Se*k-le*D,A},pe.rotateY=function(A,O,N){var D=Math.sin(N),k=Math.cos(N),U=O[0],X=O[1],Q=O[2],le=O[3],oe=O[8],re=O[9],me=O[10],Se=O[11];return O!==A&&(A[4]=O[4],A[5]=O[5],A[6]=O[6],A[7]=O[7],A[12]=O[12],A[13]=O[13],A[14]=O[14],A[15]=O[15]),A[0]=U*k-oe*D,A[1]=X*k-re*D,A[2]=Q*k-me*D,A[3]=le*k-Se*D,A[8]=U*D+oe*k,A[9]=X*D+re*k,A[10]=Q*D+me*k,A[11]=le*D+Se*k,A},pe.rotateZ=function(A,O,N){var D=Math.sin(N),k=Math.cos(N),U=O[0],X=O[1],Q=O[2],le=O[3],oe=O[4],re=O[5],me=O[6],Se=O[7];return O!==A&&(A[8]=O[8],A[9]=O[9],A[10]=O[10],A[11]=O[11],A[12]=O[12],A[13]=O[13],A[14]=O[14],A[15]=O[15]),A[0]=U*k+oe*D,A[1]=X*k+re*D,A[2]=Q*k+me*D,A[3]=le*k+Se*D,A[4]=oe*k-U*D,A[5]=re*k-X*D,A[6]=me*k-Q*D,A[7]=Se*k-le*D,A},pe.fromTranslation=function(A,O){return A[0]=1,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=1,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[10]=1,A[11]=0,A[12]=O[0],A[13]=O[1],A[14]=O[2],A[15]=1,A},pe.fromScaling=function(A,O){return A[0]=O[0],A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=O[1],A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[10]=O[2],A[11]=0,A[12]=0,A[13]=0,A[14]=0,A[15]=1,A},pe.fromRotation=function(A,O,N){var D,k,U,X=N[0],Q=N[1],le=N[2],oe=Math.hypot(X,Q,le);return oe<a.EPSILON?null:(X*=oe=1/oe,Q*=oe,le*=oe,D=Math.sin(O),k=Math.cos(O),A[0]=X*X*(U=1-k)+k,A[1]=Q*X*U+le*D,A[2]=le*X*U-Q*D,A[3]=0,A[4]=X*Q*U-le*D,A[5]=Q*Q*U+k,A[6]=le*Q*U+X*D,A[7]=0,A[8]=X*le*U+Q*D,A[9]=Q*le*U-X*D,A[10]=le*le*U+k,A[11]=0,A[12]=0,A[13]=0,A[14]=0,A[15]=1,A)},pe.fromXRotation=function(A,O){var N=Math.sin(O),D=Math.cos(O);return A[0]=1,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=D,A[6]=N,A[7]=0,A[8]=0,A[9]=-N,A[10]=D,A[11]=0,A[12]=0,A[13]=0,A[14]=0,A[15]=1,A},pe.fromYRotation=function(A,O){var N=Math.sin(O),D=Math.cos(O);return A[0]=D,A[1]=0,A[2]=-N,A[3]=0,A[4]=0,A[5]=1,A[6]=0,A[7]=0,A[8]=N,A[9]=0,A[10]=D,A[11]=0,A[12]=0,A[13]=0,A[14]=0,A[15]=1,A},pe.fromZRotation=function(A,O){var N=Math.sin(O),D=Math.cos(O);return A[0]=D,A[1]=N,A[2]=0,A[3]=0,A[4]=-N,A[5]=D,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[10]=1,A[11]=0,A[12]=0,A[13]=0,A[14]=0,A[15]=1,A},pe.fromRotationTranslation=m,pe.fromQuat2=function(A,O){var N=new a.ARRAY_TYPE(3),D=-O[0],k=-O[1],U=-O[2],X=O[3],Q=O[4],le=O[5],oe=O[6],re=O[7],me=D*D+k*k+U*U+X*X;return me>0?(N[0]=2*(Q*X+re*D+le*U-oe*k)/me,N[1]=2*(le*X+re*k+oe*D-Q*U)/me,N[2]=2*(oe*X+re*U+Q*k-le*D)/me):(N[0]=2*(Q*X+re*D+le*U-oe*k),N[1]=2*(le*X+re*k+oe*D-Q*U),N[2]=2*(oe*X+re*U+Q*k-le*D)),m(A,O,N),A},pe.getTranslation=function(A,O){return A[0]=O[12],A[1]=O[13],A[2]=O[14],A},pe.getScaling=v,pe.getRotation=function(A,O){var N=new a.ARRAY_TYPE(3);v(N,O);var D=1/N[0],k=1/N[1],U=1/N[2],X=O[0]*D,Q=O[1]*k,le=O[2]*U,oe=O[4]*D,re=O[5]*k,me=O[6]*U,Se=O[8]*D,Me=O[9]*k,We=O[10]*U,$e=X+re+We,He=0;return $e>0?(He=2*Math.sqrt($e+1),A[3]=.25*He,A[0]=(me-Me)/He,A[1]=(Se-le)/He,A[2]=(Q-oe)/He):X>re&&X>We?(He=2*Math.sqrt(1+X-re-We),A[3]=(me-Me)/He,A[0]=.25*He,A[1]=(Q+oe)/He,A[2]=(Se+le)/He):re>We?(He=2*Math.sqrt(1+re-X-We),A[3]=(Se-le)/He,A[0]=(Q+oe)/He,A[1]=.25*He,A[2]=(me+Me)/He):(He=2*Math.sqrt(1+We-X-re),A[3]=(Q-oe)/He,A[0]=(Se+le)/He,A[1]=(me+Me)/He,A[2]=.25*He),A},pe.fromRotationTranslationScale=function(A,O,N,D){var k=O[0],U=O[1],X=O[2],Q=O[3],le=k+k,oe=U+U,re=X+X,me=k*le,Se=k*oe,Me=k*re,We=U*oe,$e=U*re,He=X*re,ht=Q*le,Ke=Q*oe,pt=Q*re,Et=D[0],wt=D[1],Ot=D[2];return A[0]=(1-(We+He))*Et,A[1]=(Se+pt)*Et,A[2]=(Me-Ke)*Et,A[3]=0,A[4]=(Se-pt)*wt,A[5]=(1-(me+He))*wt,A[6]=($e+ht)*wt,A[7]=0,A[8]=(Me+Ke)*Ot,A[9]=($e-ht)*Ot,A[10]=(1-(me+We))*Ot,A[11]=0,A[12]=N[0],A[13]=N[1],A[14]=N[2],A[15]=1,A},pe.fromRotationTranslationScaleOrigin=function(A,O,N,D,k){var U=O[0],X=O[1],Q=O[2],le=O[3],oe=U+U,re=X+X,me=Q+Q,Se=U*oe,Me=U*re,We=U*me,$e=X*re,He=X*me,ht=Q*me,Ke=le*oe,pt=le*re,Et=le*me,wt=D[0],Ot=D[1],It=D[2],jt=k[0],Dt=k[1],Vt=k[2],_n=(1-($e+ht))*wt,gn=(Me+Et)*wt,Zn=(We-pt)*wt,Cn=(Me-Et)*Ot,Ln=(1-(Se+ht))*Ot,bn=(He+Ke)*Ot,_r=(We+pt)*It,Kn=(He-Ke)*It,lr=(1-(Se+$e))*It;return A[0]=_n,A[1]=gn,A[2]=Zn,A[3]=0,A[4]=Cn,A[5]=Ln,A[6]=bn,A[7]=0,A[8]=_r,A[9]=Kn,A[10]=lr,A[11]=0,A[12]=N[0]+jt-(_n*jt+Cn*Dt+_r*Vt),A[13]=N[1]+Dt-(gn*jt+Ln*Dt+Kn*Vt),A[14]=N[2]+Vt-(Zn*jt+bn*Dt+lr*Vt),A[15]=1,A},pe.fromQuat=function(A,O){var N=O[0],D=O[1],k=O[2],U=O[3],X=N+N,Q=D+D,le=k+k,oe=N*X,re=D*X,me=D*Q,Se=k*X,Me=k*Q,We=k*le,$e=U*X,He=U*Q,ht=U*le;return A[0]=1-me-We,A[1]=re+ht,A[2]=Se-He,A[3]=0,A[4]=re-ht,A[5]=1-oe-We,A[6]=Me+$e,A[7]=0,A[8]=Se+He,A[9]=Me-$e,A[10]=1-oe-me,A[11]=0,A[12]=0,A[13]=0,A[14]=0,A[15]=1,A},pe.frustum=function(A,O,N,D,k,U,X){var Q=1/(N-O),le=1/(k-D),oe=1/(U-X);return A[0]=2*U*Q,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=2*U*le,A[6]=0,A[7]=0,A[8]=(N+O)*Q,A[9]=(k+D)*le,A[10]=(X+U)*oe,A[11]=-1,A[12]=0,A[13]=0,A[14]=X*U*2*oe,A[15]=0,A},pe.perspectiveNO=E,pe.perspectiveZO=function(A,O,N,D,k){var U,X=1/Math.tan(O/2);return A[0]=X/N,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=X,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[11]=-1,A[12]=0,A[13]=0,A[15]=0,k!=null&&k!==1/0?(A[10]=k*(U=1/(D-k)),A[14]=k*D*U):(A[10]=-1,A[14]=-D),A},pe.perspectiveFromFieldOfView=function(A,O,N,D){var k=Math.tan(O.upDegrees*Math.PI/180),U=Math.tan(O.downDegrees*Math.PI/180),X=Math.tan(O.leftDegrees*Math.PI/180),Q=Math.tan(O.rightDegrees*Math.PI/180),le=2/(X+Q),oe=2/(k+U);return A[0]=le,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=oe,A[6]=0,A[7]=0,A[8]=-(X-Q)*le*.5,A[9]=(k-U)*oe*.5,A[10]=D/(N-D),A[11]=-1,A[12]=0,A[13]=0,A[14]=D*N/(N-D),A[15]=0,A},pe.orthoNO=P,pe.orthoZO=function(A,O,N,D,k,U,X){var Q=1/(O-N),le=1/(D-k),oe=1/(U-X);return A[0]=-2*Q,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=-2*le,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[10]=oe,A[11]=0,A[12]=(O+N)*Q,A[13]=(k+D)*le,A[14]=U*oe,A[15]=1,A},pe.lookAt=function(A,O,N,D){var k,U,X,Q,le,oe,re,me,Se,Me,We=O[0],$e=O[1],He=O[2],ht=D[0],Ke=D[1],pt=D[2],Et=N[0],wt=N[1],Ot=N[2];return Math.abs(We-Et)<a.EPSILON&&Math.abs($e-wt)<a.EPSILON&&Math.abs(He-Ot)<a.EPSILON?d(A):(re=We-Et,me=$e-wt,Se=He-Ot,k=Ke*(Se*=Me=1/Math.hypot(re,me,Se))-pt*(me*=Me),U=pt*(re*=Me)-ht*Se,X=ht*me-Ke*re,(Me=Math.hypot(k,U,X))?(k*=Me=1/Me,U*=Me,X*=Me):(k=0,U=0,X=0),Q=me*X-Se*U,le=Se*k-re*X,oe=re*U-me*k,(Me=Math.hypot(Q,le,oe))?(Q*=Me=1/Me,le*=Me,oe*=Me):(Q=0,le=0,oe=0),A[0]=k,A[1]=Q,A[2]=re,A[3]=0,A[4]=U,A[5]=le,A[6]=me,A[7]=0,A[8]=X,A[9]=oe,A[10]=Se,A[11]=0,A[12]=-(k*We+U*$e+X*He),A[13]=-(Q*We+le*$e+oe*He),A[14]=-(re*We+me*$e+Se*He),A[15]=1,A)},pe.targetTo=function(A,O,N,D){var k=O[0],U=O[1],X=O[2],Q=D[0],le=D[1],oe=D[2],re=k-N[0],me=U-N[1],Se=X-N[2],Me=re*re+me*me+Se*Se;Me>0&&(re*=Me=1/Math.sqrt(Me),me*=Me,Se*=Me);var We=le*Se-oe*me,$e=oe*re-Q*Se,He=Q*me-le*re;return(Me=We*We+$e*$e+He*He)>0&&(We*=Me=1/Math.sqrt(Me),$e*=Me,He*=Me),A[0]=We,A[1]=$e,A[2]=He,A[3]=0,A[4]=me*He-Se*$e,A[5]=Se*We-re*He,A[6]=re*$e-me*We,A[7]=0,A[8]=re,A[9]=me,A[10]=Se,A[11]=0,A[12]=k,A[13]=U,A[14]=X,A[15]=1,A},pe.str=function(A){return"mat4("+A[0]+", "+A[1]+", "+A[2]+", "+A[3]+", "+A[4]+", "+A[5]+", "+A[6]+", "+A[7]+", "+A[8]+", "+A[9]+", "+A[10]+", "+A[11]+", "+A[12]+", "+A[13]+", "+A[14]+", "+A[15]+")"},pe.frob=function(A){return Math.hypot(A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12],A[13],A[14],A[15])},pe.add=function(A,O,N){return A[0]=O[0]+N[0],A[1]=O[1]+N[1],A[2]=O[2]+N[2],A[3]=O[3]+N[3],A[4]=O[4]+N[4],A[5]=O[5]+N[5],A[6]=O[6]+N[6],A[7]=O[7]+N[7],A[8]=O[8]+N[8],A[9]=O[9]+N[9],A[10]=O[10]+N[10],A[11]=O[11]+N[11],A[12]=O[12]+N[12],A[13]=O[13]+N[13],A[14]=O[14]+N[14],A[15]=O[15]+N[15],A},pe.subtract=L,pe.multiplyScalar=function(A,O,N){return A[0]=O[0]*N,A[1]=O[1]*N,A[2]=O[2]*N,A[3]=O[3]*N,A[4]=O[4]*N,A[5]=O[5]*N,A[6]=O[6]*N,A[7]=O[7]*N,A[8]=O[8]*N,A[9]=O[9]*N,A[10]=O[10]*N,A[11]=O[11]*N,A[12]=O[12]*N,A[13]=O[13]*N,A[14]=O[14]*N,A[15]=O[15]*N,A},pe.multiplyScalarAndAdd=function(A,O,N,D){return A[0]=O[0]+N[0]*D,A[1]=O[1]+N[1]*D,A[2]=O[2]+N[2]*D,A[3]=O[3]+N[3]*D,A[4]=O[4]+N[4]*D,A[5]=O[5]+N[5]*D,A[6]=O[6]+N[6]*D,A[7]=O[7]+N[7]*D,A[8]=O[8]+N[8]*D,A[9]=O[9]+N[9]*D,A[10]=O[10]+N[10]*D,A[11]=O[11]+N[11]*D,A[12]=O[12]+N[12]*D,A[13]=O[13]+N[13]*D,A[14]=O[14]+N[14]*D,A[15]=O[15]+N[15]*D,A},pe.exactEquals=function(A,O){return A[0]===O[0]&&A[1]===O[1]&&A[2]===O[2]&&A[3]===O[3]&&A[4]===O[4]&&A[5]===O[5]&&A[6]===O[6]&&A[7]===O[7]&&A[8]===O[8]&&A[9]===O[9]&&A[10]===O[10]&&A[11]===O[11]&&A[12]===O[12]&&A[13]===O[13]&&A[14]===O[14]&&A[15]===O[15]},pe.equals=function(A,O){var N=A[0],D=A[1],k=A[2],U=A[3],X=A[4],Q=A[5],le=A[6],oe=A[7],re=A[8],me=A[9],Se=A[10],Me=A[11],We=A[12],$e=A[13],He=A[14],ht=A[15],Ke=O[0],pt=O[1],Et=O[2],wt=O[3],Ot=O[4],It=O[5],jt=O[6],Dt=O[7],Vt=O[8],_n=O[9],gn=O[10],Zn=O[11],Cn=O[12],Ln=O[13],bn=O[14],_r=O[15];return Math.abs(N-Ke)<=a.EPSILON*Math.max(1,Math.abs(N),Math.abs(Ke))&&Math.abs(D-pt)<=a.EPSILON*Math.max(1,Math.abs(D),Math.abs(pt))&&Math.abs(k-Et)<=a.EPSILON*Math.max(1,Math.abs(k),Math.abs(Et))&&Math.abs(U-wt)<=a.EPSILON*Math.max(1,Math.abs(U),Math.abs(wt))&&Math.abs(X-Ot)<=a.EPSILON*Math.max(1,Math.abs(X),Math.abs(Ot))&&Math.abs(Q-It)<=a.EPSILON*Math.max(1,Math.abs(Q),Math.abs(It))&&Math.abs(le-jt)<=a.EPSILON*Math.max(1,Math.abs(le),Math.abs(jt))&&Math.abs(oe-Dt)<=a.EPSILON*Math.max(1,Math.abs(oe),Math.abs(Dt))&&Math.abs(re-Vt)<=a.EPSILON*Math.max(1,Math.abs(re),Math.abs(Vt))&&Math.abs(me-_n)<=a.EPSILON*Math.max(1,Math.abs(me),Math.abs(_n))&&Math.abs(Se-gn)<=a.EPSILON*Math.max(1,Math.abs(Se),Math.abs(gn))&&Math.abs(Me-Zn)<=a.EPSILON*Math.max(1,Math.abs(Me),Math.abs(Zn))&&Math.abs(We-Cn)<=a.EPSILON*Math.max(1,Math.abs(We),Math.abs(Cn))&&Math.abs($e-Ln)<=a.EPSILON*Math.max(1,Math.abs($e),Math.abs(Ln))&&Math.abs(He-bn)<=a.EPSILON*Math.max(1,Math.abs(He),Math.abs(bn))&&Math.abs(ht-_r)<=a.EPSILON*Math.max(1,Math.abs(ht),Math.abs(_r))},pe.sub=pe.mul=pe.ortho=pe.perspective=void 0;var a=function(A,O){if(A&&A.__esModule)return A;if(A===null||h(A)!=="object"&&typeof A!="function")return{default:A};var N=c(void 0);if(N&&N.has(A))return N.get(A);var D={},k=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var U in A)if(U!=="default"&&Object.prototype.hasOwnProperty.call(A,U)){var X=k?Object.getOwnPropertyDescriptor(A,U):null;X&&(X.get||X.set)?Object.defineProperty(D,U,X):D[U]=A[U]}return D.default=A,N&&N.set(A,D),D}(F());function c(A){if(typeof WeakMap!="function")return null;var O=new WeakMap,N=new WeakMap;return(c=function(D){return D?N:O})(A)}function d(A){return A[0]=1,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=1,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[10]=1,A[11]=0,A[12]=0,A[13]=0,A[14]=0,A[15]=1,A}function g(A,O,N){var D=O[0],k=O[1],U=O[2],X=O[3],Q=O[4],le=O[5],oe=O[6],re=O[7],me=O[8],Se=O[9],Me=O[10],We=O[11],$e=O[12],He=O[13],ht=O[14],Ke=O[15],pt=N[0],Et=N[1],wt=N[2],Ot=N[3];return A[0]=pt*D+Et*Q+wt*me+Ot*$e,A[1]=pt*k+Et*le+wt*Se+Ot*He,A[2]=pt*U+Et*oe+wt*Me+Ot*ht,A[3]=pt*X+Et*re+wt*We+Ot*Ke,A[4]=(pt=N[4])*D+(Et=N[5])*Q+(wt=N[6])*me+(Ot=N[7])*$e,A[5]=pt*k+Et*le+wt*Se+Ot*He,A[6]=pt*U+Et*oe+wt*Me+Ot*ht,A[7]=pt*X+Et*re+wt*We+Ot*Ke,A[8]=(pt=N[8])*D+(Et=N[9])*Q+(wt=N[10])*me+(Ot=N[11])*$e,A[9]=pt*k+Et*le+wt*Se+Ot*He,A[10]=pt*U+Et*oe+wt*Me+Ot*ht,A[11]=pt*X+Et*re+wt*We+Ot*Ke,A[12]=(pt=N[12])*D+(Et=N[13])*Q+(wt=N[14])*me+(Ot=N[15])*$e,A[13]=pt*k+Et*le+wt*Se+Ot*He,A[14]=pt*U+Et*oe+wt*Me+Ot*ht,A[15]=pt*X+Et*re+wt*We+Ot*Ke,A}function m(A,O,N){var D=O[0],k=O[1],U=O[2],X=O[3],Q=D+D,le=k+k,oe=U+U,re=D*Q,me=D*le,Se=D*oe,Me=k*le,We=k*oe,$e=U*oe,He=X*Q,ht=X*le,Ke=X*oe;return A[0]=1-(Me+$e),A[1]=me+Ke,A[2]=Se-ht,A[3]=0,A[4]=me-Ke,A[5]=1-(re+$e),A[6]=We+He,A[7]=0,A[8]=Se+ht,A[9]=We-He,A[10]=1-(re+Me),A[11]=0,A[12]=N[0],A[13]=N[1],A[14]=N[2],A[15]=1,A}function v(A,O){var N=O[4],D=O[5],k=O[6],U=O[8],X=O[9],Q=O[10];return A[0]=Math.hypot(O[0],O[1],O[2]),A[1]=Math.hypot(N,D,k),A[2]=Math.hypot(U,X,Q),A}function E(A,O,N,D,k){var U,X=1/Math.tan(O/2);return A[0]=X/N,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=X,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[11]=-1,A[12]=0,A[13]=0,A[15]=0,k!=null&&k!==1/0?(A[10]=(k+D)*(U=1/(D-k)),A[14]=2*k*D*U):(A[10]=-1,A[14]=-2*D),A}function P(A,O,N,D,k,U,X){var Q=1/(O-N),le=1/(D-k),oe=1/(U-X);return A[0]=-2*Q,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=-2*le,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[10]=2*oe,A[11]=0,A[12]=(O+N)*Q,A[13]=(k+D)*le,A[14]=(X+U)*oe,A[15]=1,A}function L(A,O,N){return A[0]=O[0]-N[0],A[1]=O[1]-N[1],A[2]=O[2]-N[2],A[3]=O[3]-N[3],A[4]=O[4]-N[4],A[5]=O[5]-N[5],A[6]=O[6]-N[6],A[7]=O[7]-N[7],A[8]=O[8]-N[8],A[9]=O[9]-N[9],A[10]=O[10]-N[10],A[11]=O[11]-N[11],A[12]=O[12]-N[12],A[13]=O[13]-N[13],A[14]=O[14]-N[14],A[15]=O[15]-N[15],A}return pe.perspective=E,pe.ortho=P,pe.mul=g,pe.sub=L,pe}var Ae,Oe={},ue={};function we(){if(Ae)return ue;function h(k){return h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(U){return typeof U}:function(U){return U&&typeof Symbol=="function"&&U.constructor===Symbol&&U!==Symbol.prototype?"symbol":typeof U},h(k)}Ae=1,Object.defineProperty(ue,"__esModule",{value:!0}),ue.create=d,ue.clone=function(k){var U=new a.ARRAY_TYPE(3);return U[0]=k[0],U[1]=k[1],U[2]=k[2],U},ue.length=g,ue.fromValues=function(k,U,X){var Q=new a.ARRAY_TYPE(3);return Q[0]=k,Q[1]=U,Q[2]=X,Q},ue.copy=function(k,U){return k[0]=U[0],k[1]=U[1],k[2]=U[2],k},ue.set=function(k,U,X,Q){return k[0]=U,k[1]=X,k[2]=Q,k},ue.add=function(k,U,X){return k[0]=U[0]+X[0],k[1]=U[1]+X[1],k[2]=U[2]+X[2],k},ue.subtract=m,ue.multiply=v,ue.divide=E,ue.ceil=function(k,U){return k[0]=Math.ceil(U[0]),k[1]=Math.ceil(U[1]),k[2]=Math.ceil(U[2]),k},ue.floor=function(k,U){return k[0]=Math.floor(U[0]),k[1]=Math.floor(U[1]),k[2]=Math.floor(U[2]),k},ue.min=function(k,U,X){return k[0]=Math.min(U[0],X[0]),k[1]=Math.min(U[1],X[1]),k[2]=Math.min(U[2],X[2]),k},ue.max=function(k,U,X){return k[0]=Math.max(U[0],X[0]),k[1]=Math.max(U[1],X[1]),k[2]=Math.max(U[2],X[2]),k},ue.round=function(k,U){return k[0]=Math.round(U[0]),k[1]=Math.round(U[1]),k[2]=Math.round(U[2]),k},ue.scale=function(k,U,X){return k[0]=U[0]*X,k[1]=U[1]*X,k[2]=U[2]*X,k},ue.scaleAndAdd=function(k,U,X,Q){return k[0]=U[0]+X[0]*Q,k[1]=U[1]+X[1]*Q,k[2]=U[2]+X[2]*Q,k},ue.distance=P,ue.squaredDistance=L,ue.squaredLength=A,ue.negate=function(k,U){return k[0]=-U[0],k[1]=-U[1],k[2]=-U[2],k},ue.inverse=function(k,U){return k[0]=1/U[0],k[1]=1/U[1],k[2]=1/U[2],k},ue.normalize=function(k,U){var X=U[0],Q=U[1],le=U[2],oe=X*X+Q*Q+le*le;return oe>0&&(oe=1/Math.sqrt(oe)),k[0]=U[0]*oe,k[1]=U[1]*oe,k[2]=U[2]*oe,k},ue.dot=O,ue.cross=function(k,U,X){var Q=U[0],le=U[1],oe=U[2],re=X[0],me=X[1],Se=X[2];return k[0]=le*Se-oe*me,k[1]=oe*re-Q*Se,k[2]=Q*me-le*re,k},ue.lerp=function(k,U,X,Q){var le=U[0],oe=U[1],re=U[2];return k[0]=le+Q*(X[0]-le),k[1]=oe+Q*(X[1]-oe),k[2]=re+Q*(X[2]-re),k},ue.hermite=function(k,U,X,Q,le,oe){var re=oe*oe,me=re*(2*oe-3)+1,Se=re*(oe-2)+oe,Me=re*(oe-1),We=re*(3-2*oe);return k[0]=U[0]*me+X[0]*Se+Q[0]*Me+le[0]*We,k[1]=U[1]*me+X[1]*Se+Q[1]*Me+le[1]*We,k[2]=U[2]*me+X[2]*Se+Q[2]*Me+le[2]*We,k},ue.bezier=function(k,U,X,Q,le,oe){var re=1-oe,me=re*re,Se=oe*oe,Me=me*re,We=3*oe*me,$e=3*Se*re,He=Se*oe;return k[0]=U[0]*Me+X[0]*We+Q[0]*$e+le[0]*He,k[1]=U[1]*Me+X[1]*We+Q[1]*$e+le[1]*He,k[2]=U[2]*Me+X[2]*We+Q[2]*$e+le[2]*He,k},ue.random=function(k,U){U=U||1;var X=2*a.RANDOM()*Math.PI,Q=2*a.RANDOM()-1,le=Math.sqrt(1-Q*Q)*U;return k[0]=Math.cos(X)*le,k[1]=Math.sin(X)*le,k[2]=Q*U,k},ue.transformMat4=function(k,U,X){var Q=U[0],le=U[1],oe=U[2],re=X[3]*Q+X[7]*le+X[11]*oe+X[15];return k[0]=(X[0]*Q+X[4]*le+X[8]*oe+X[12])/(re=re||1),k[1]=(X[1]*Q+X[5]*le+X[9]*oe+X[13])/re,k[2]=(X[2]*Q+X[6]*le+X[10]*oe+X[14])/re,k},ue.transformMat3=function(k,U,X){var Q=U[0],le=U[1],oe=U[2];return k[0]=Q*X[0]+le*X[3]+oe*X[6],k[1]=Q*X[1]+le*X[4]+oe*X[7],k[2]=Q*X[2]+le*X[5]+oe*X[8],k},ue.transformQuat=function(k,U,X){var Q=X[0],le=X[1],oe=X[2],re=U[0],me=U[1],Se=U[2],Me=le*Se-oe*me,We=oe*re-Q*Se,$e=Q*me-le*re,He=le*$e-oe*We,ht=oe*Me-Q*$e,Ke=Q*We-le*Me,pt=2*X[3];return We*=pt,$e*=pt,ht*=2,Ke*=2,k[0]=re+(Me*=pt)+(He*=2),k[1]=me+We+ht,k[2]=Se+$e+Ke,k},ue.rotateX=function(k,U,X,Q){var le=[],oe=[];return le[0]=U[0]-X[0],le[1]=U[1]-X[1],le[2]=U[2]-X[2],oe[0]=le[0],oe[1]=le[1]*Math.cos(Q)-le[2]*Math.sin(Q),oe[2]=le[1]*Math.sin(Q)+le[2]*Math.cos(Q),k[0]=oe[0]+X[0],k[1]=oe[1]+X[1],k[2]=oe[2]+X[2],k},ue.rotateY=function(k,U,X,Q){var le=[],oe=[];return le[0]=U[0]-X[0],le[1]=U[1]-X[1],le[2]=U[2]-X[2],oe[0]=le[2]*Math.sin(Q)+le[0]*Math.cos(Q),oe[1]=le[1],oe[2]=le[2]*Math.cos(Q)-le[0]*Math.sin(Q),k[0]=oe[0]+X[0],k[1]=oe[1]+X[1],k[2]=oe[2]+X[2],k},ue.rotateZ=function(k,U,X,Q){var le=[],oe=[];return le[0]=U[0]-X[0],le[1]=U[1]-X[1],le[2]=U[2]-X[2],oe[0]=le[0]*Math.cos(Q)-le[1]*Math.sin(Q),oe[1]=le[0]*Math.sin(Q)+le[1]*Math.cos(Q),oe[2]=le[2],k[0]=oe[0]+X[0],k[1]=oe[1]+X[1],k[2]=oe[2]+X[2],k},ue.angle=function(k,U){var X=k[0],Q=k[1],le=k[2],oe=U[0],re=U[1],me=U[2],Se=Math.sqrt(X*X+Q*Q+le*le)*Math.sqrt(oe*oe+re*re+me*me),Me=Se&&O(k,U)/Se;return Math.acos(Math.min(Math.max(Me,-1),1))},ue.zero=function(k){return k[0]=0,k[1]=0,k[2]=0,k},ue.str=function(k){return"vec3("+k[0]+", "+k[1]+", "+k[2]+")"},ue.exactEquals=function(k,U){return k[0]===U[0]&&k[1]===U[1]&&k[2]===U[2]},ue.equals=function(k,U){var X=k[0],Q=k[1],le=k[2],oe=U[0],re=U[1],me=U[2];return Math.abs(X-oe)<=a.EPSILON*Math.max(1,Math.abs(X),Math.abs(oe))&&Math.abs(Q-re)<=a.EPSILON*Math.max(1,Math.abs(Q),Math.abs(re))&&Math.abs(le-me)<=a.EPSILON*Math.max(1,Math.abs(le),Math.abs(me))},ue.forEach=ue.sqrLen=ue.len=ue.sqrDist=ue.dist=ue.div=ue.mul=ue.sub=void 0;var a=function(k,U){if(k&&k.__esModule)return k;if(k===null||h(k)!=="object"&&typeof k!="function")return{default:k};var X=c(void 0);if(X&&X.has(k))return X.get(k);var Q={},le=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var oe in k)if(oe!=="default"&&Object.prototype.hasOwnProperty.call(k,oe)){var re=le?Object.getOwnPropertyDescriptor(k,oe):null;re&&(re.get||re.set)?Object.defineProperty(Q,oe,re):Q[oe]=k[oe]}return Q.default=k,X&&X.set(k,Q),Q}(F());function c(k){if(typeof WeakMap!="function")return null;var U=new WeakMap,X=new WeakMap;return(c=function(Q){return Q?X:U})(k)}function d(){var k=new a.ARRAY_TYPE(3);return a.ARRAY_TYPE!=Float32Array&&(k[0]=0,k[1]=0,k[2]=0),k}function g(k){return Math.hypot(k[0],k[1],k[2])}function m(k,U,X){return k[0]=U[0]-X[0],k[1]=U[1]-X[1],k[2]=U[2]-X[2],k}function v(k,U,X){return k[0]=U[0]*X[0],k[1]=U[1]*X[1],k[2]=U[2]*X[2],k}function E(k,U,X){return k[0]=U[0]/X[0],k[1]=U[1]/X[1],k[2]=U[2]/X[2],k}function P(k,U){return Math.hypot(U[0]-k[0],U[1]-k[1],U[2]-k[2])}function L(k,U){var X=U[0]-k[0],Q=U[1]-k[1],le=U[2]-k[2];return X*X+Q*Q+le*le}function A(k){var U=k[0],X=k[1],Q=k[2];return U*U+X*X+Q*Q}function O(k,U){return k[0]*U[0]+k[1]*U[1]+k[2]*U[2]}ue.sub=m,ue.mul=v,ue.div=E,ue.dist=P,ue.sqrDist=L,ue.len=g,ue.sqrLen=A;var N,D=(N=d(),function(k,U,X,Q,le,oe){var re,me;for(U||(U=3),X||(X=0),me=Q?Math.min(Q*U+X,k.length):k.length,re=X;re<me;re+=U)N[0]=k[re],N[1]=k[re+1],N[2]=k[re+2],le(N,N,oe),k[re]=N[0],k[re+1]=N[1],k[re+2]=N[2];return k});return ue.forEach=D,ue}var ke,De,je={};function ze(){if(ke)return je;function h(D){return h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(k){return typeof k}:function(k){return k&&typeof Symbol=="function"&&k.constructor===Symbol&&k!==Symbol.prototype?"symbol":typeof k},h(D)}ke=1,Object.defineProperty(je,"__esModule",{value:!0}),je.create=d,je.clone=function(D){var k=new a.ARRAY_TYPE(4);return k[0]=D[0],k[1]=D[1],k[2]=D[2],k[3]=D[3],k},je.fromValues=function(D,k,U,X){var Q=new a.ARRAY_TYPE(4);return Q[0]=D,Q[1]=k,Q[2]=U,Q[3]=X,Q},je.copy=function(D,k){return D[0]=k[0],D[1]=k[1],D[2]=k[2],D[3]=k[3],D},je.set=function(D,k,U,X,Q){return D[0]=k,D[1]=U,D[2]=X,D[3]=Q,D},je.add=function(D,k,U){return D[0]=k[0]+U[0],D[1]=k[1]+U[1],D[2]=k[2]+U[2],D[3]=k[3]+U[3],D},je.subtract=g,je.multiply=m,je.divide=v,je.ceil=function(D,k){return D[0]=Math.ceil(k[0]),D[1]=Math.ceil(k[1]),D[2]=Math.ceil(k[2]),D[3]=Math.ceil(k[3]),D},je.floor=function(D,k){return D[0]=Math.floor(k[0]),D[1]=Math.floor(k[1]),D[2]=Math.floor(k[2]),D[3]=Math.floor(k[3]),D},je.min=function(D,k,U){return D[0]=Math.min(k[0],U[0]),D[1]=Math.min(k[1],U[1]),D[2]=Math.min(k[2],U[2]),D[3]=Math.min(k[3],U[3]),D},je.max=function(D,k,U){return D[0]=Math.max(k[0],U[0]),D[1]=Math.max(k[1],U[1]),D[2]=Math.max(k[2],U[2]),D[3]=Math.max(k[3],U[3]),D},je.round=function(D,k){return D[0]=Math.round(k[0]),D[1]=Math.round(k[1]),D[2]=Math.round(k[2]),D[3]=Math.round(k[3]),D},je.scale=function(D,k,U){return D[0]=k[0]*U,D[1]=k[1]*U,D[2]=k[2]*U,D[3]=k[3]*U,D},je.scaleAndAdd=function(D,k,U,X){return D[0]=k[0]+U[0]*X,D[1]=k[1]+U[1]*X,D[2]=k[2]+U[2]*X,D[3]=k[3]+U[3]*X,D},je.distance=E,je.squaredDistance=P,je.length=L,je.squaredLength=A,je.negate=function(D,k){return D[0]=-k[0],D[1]=-k[1],D[2]=-k[2],D[3]=-k[3],D},je.inverse=function(D,k){return D[0]=1/k[0],D[1]=1/k[1],D[2]=1/k[2],D[3]=1/k[3],D},je.normalize=function(D,k){var U=k[0],X=k[1],Q=k[2],le=k[3],oe=U*U+X*X+Q*Q+le*le;return oe>0&&(oe=1/Math.sqrt(oe)),D[0]=U*oe,D[1]=X*oe,D[2]=Q*oe,D[3]=le*oe,D},je.dot=function(D,k){return D[0]*k[0]+D[1]*k[1]+D[2]*k[2]+D[3]*k[3]},je.cross=function(D,k,U,X){var Q=U[0]*X[1]-U[1]*X[0],le=U[0]*X[2]-U[2]*X[0],oe=U[0]*X[3]-U[3]*X[0],re=U[1]*X[2]-U[2]*X[1],me=U[1]*X[3]-U[3]*X[1],Se=U[2]*X[3]-U[3]*X[2],Me=k[0],We=k[1],$e=k[2],He=k[3];return D[0]=We*Se-$e*me+He*re,D[1]=-Me*Se+$e*oe-He*le,D[2]=Me*me-We*oe+He*Q,D[3]=-Me*re+We*le-$e*Q,D},je.lerp=function(D,k,U,X){var Q=k[0],le=k[1],oe=k[2],re=k[3];return D[0]=Q+X*(U[0]-Q),D[1]=le+X*(U[1]-le),D[2]=oe+X*(U[2]-oe),D[3]=re+X*(U[3]-re),D},je.random=function(D,k){var U,X,Q,le,oe,re;k=k||1;do oe=(U=2*a.RANDOM()-1)*U+(X=2*a.RANDOM()-1)*X;while(oe>=1);do re=(Q=2*a.RANDOM()-1)*Q+(le=2*a.RANDOM()-1)*le;while(re>=1);var me=Math.sqrt((1-oe)/re);return D[0]=k*U,D[1]=k*X,D[2]=k*Q*me,D[3]=k*le*me,D},je.transformMat4=function(D,k,U){var X=k[0],Q=k[1],le=k[2],oe=k[3];return D[0]=U[0]*X+U[4]*Q+U[8]*le+U[12]*oe,D[1]=U[1]*X+U[5]*Q+U[9]*le+U[13]*oe,D[2]=U[2]*X+U[6]*Q+U[10]*le+U[14]*oe,D[3]=U[3]*X+U[7]*Q+U[11]*le+U[15]*oe,D},je.transformQuat=function(D,k,U){var X=k[0],Q=k[1],le=k[2],oe=U[0],re=U[1],me=U[2],Se=U[3],Me=Se*X+re*le-me*Q,We=Se*Q+me*X-oe*le,$e=Se*le+oe*Q-re*X,He=-oe*X-re*Q-me*le;return D[0]=Me*Se+He*-oe+We*-me-$e*-re,D[1]=We*Se+He*-re+$e*-oe-Me*-me,D[2]=$e*Se+He*-me+Me*-re-We*-oe,D[3]=k[3],D},je.zero=function(D){return D[0]=0,D[1]=0,D[2]=0,D[3]=0,D},je.str=function(D){return"vec4("+D[0]+", "+D[1]+", "+D[2]+", "+D[3]+")"},je.exactEquals=function(D,k){return D[0]===k[0]&&D[1]===k[1]&&D[2]===k[2]&&D[3]===k[3]},je.equals=function(D,k){var U=D[0],X=D[1],Q=D[2],le=D[3],oe=k[0],re=k[1],me=k[2],Se=k[3];return Math.abs(U-oe)<=a.EPSILON*Math.max(1,Math.abs(U),Math.abs(oe))&&Math.abs(X-re)<=a.EPSILON*Math.max(1,Math.abs(X),Math.abs(re))&&Math.abs(Q-me)<=a.EPSILON*Math.max(1,Math.abs(Q),Math.abs(me))&&Math.abs(le-Se)<=a.EPSILON*Math.max(1,Math.abs(le),Math.abs(Se))},je.forEach=je.sqrLen=je.len=je.sqrDist=je.dist=je.div=je.mul=je.sub=void 0;var a=function(D,k){if(D&&D.__esModule)return D;if(D===null||h(D)!=="object"&&typeof D!="function")return{default:D};var U=c(void 0);if(U&&U.has(D))return U.get(D);var X={},Q=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var le in D)if(le!=="default"&&Object.prototype.hasOwnProperty.call(D,le)){var oe=Q?Object.getOwnPropertyDescriptor(D,le):null;oe&&(oe.get||oe.set)?Object.defineProperty(X,le,oe):X[le]=D[le]}return X.default=D,U&&U.set(D,X),X}(F());function c(D){if(typeof WeakMap!="function")return null;var k=new WeakMap,U=new WeakMap;return(c=function(X){return X?U:k})(D)}function d(){var D=new a.ARRAY_TYPE(4);return a.ARRAY_TYPE!=Float32Array&&(D[0]=0,D[1]=0,D[2]=0,D[3]=0),D}function g(D,k,U){return D[0]=k[0]-U[0],D[1]=k[1]-U[1],D[2]=k[2]-U[2],D[3]=k[3]-U[3],D}function m(D,k,U){return D[0]=k[0]*U[0],D[1]=k[1]*U[1],D[2]=k[2]*U[2],D[3]=k[3]*U[3],D}function v(D,k,U){return D[0]=k[0]/U[0],D[1]=k[1]/U[1],D[2]=k[2]/U[2],D[3]=k[3]/U[3],D}function E(D,k){return Math.hypot(k[0]-D[0],k[1]-D[1],k[2]-D[2],k[3]-D[3])}function P(D,k){var U=k[0]-D[0],X=k[1]-D[1],Q=k[2]-D[2],le=k[3]-D[3];return U*U+X*X+Q*Q+le*le}function L(D){return Math.hypot(D[0],D[1],D[2],D[3])}function A(D){var k=D[0],U=D[1],X=D[2],Q=D[3];return k*k+U*U+X*X+Q*Q}je.sub=g,je.mul=m,je.div=v,je.dist=E,je.sqrDist=P,je.len=L,je.sqrLen=A;var O,N=(O=d(),function(D,k,U,X,Q,le){var oe,re;for(k||(k=4),U||(U=0),re=X?Math.min(X*k+U,D.length):D.length,oe=U;oe<re;oe+=k)O[0]=D[oe],O[1]=D[oe+1],O[2]=D[oe+2],O[3]=D[oe+3],Q(O,O,le),D[oe]=O[0],D[oe+1]=O[1],D[oe+2]=O[2],D[oe+3]=O[3];return D});return je.forEach=N,je}function Ue(){if(De)return Oe;function h(Ke){return h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(pt){return typeof pt}:function(pt){return pt&&typeof Symbol=="function"&&pt.constructor===Symbol&&pt!==Symbol.prototype?"symbol":typeof pt},h(Ke)}De=1,Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.create=E,Oe.identity=function(Ke){return Ke[0]=0,Ke[1]=0,Ke[2]=0,Ke[3]=1,Ke},Oe.setAxisAngle=P,Oe.getAxisAngle=function(Ke,pt){var Et=2*Math.acos(pt[3]),wt=Math.sin(Et/2);return wt>a.EPSILON?(Ke[0]=pt[0]/wt,Ke[1]=pt[1]/wt,Ke[2]=pt[2]/wt):(Ke[0]=1,Ke[1]=0,Ke[2]=0),Et},Oe.getAngle=function(Ke,pt){var Et=U(Ke,pt);return Math.acos(2*Et*Et-1)},Oe.multiply=L,Oe.rotateX=function(Ke,pt,Et){Et*=.5;var wt=pt[0],Ot=pt[1],It=pt[2],jt=pt[3],Dt=Math.sin(Et),Vt=Math.cos(Et);return Ke[0]=wt*Vt+jt*Dt,Ke[1]=Ot*Vt+It*Dt,Ke[2]=It*Vt-Ot*Dt,Ke[3]=jt*Vt-wt*Dt,Ke},Oe.rotateY=function(Ke,pt,Et){Et*=.5;var wt=pt[0],Ot=pt[1],It=pt[2],jt=pt[3],Dt=Math.sin(Et),Vt=Math.cos(Et);return Ke[0]=wt*Vt-It*Dt,Ke[1]=Ot*Vt+jt*Dt,Ke[2]=It*Vt+wt*Dt,Ke[3]=jt*Vt-Ot*Dt,Ke},Oe.rotateZ=function(Ke,pt,Et){Et*=.5;var wt=pt[0],Ot=pt[1],It=pt[2],jt=pt[3],Dt=Math.sin(Et),Vt=Math.cos(Et);return Ke[0]=wt*Vt+Ot*Dt,Ke[1]=Ot*Vt-wt*Dt,Ke[2]=It*Vt+jt*Dt,Ke[3]=jt*Vt-It*Dt,Ke},Oe.calculateW=function(Ke,pt){var Et=pt[0],wt=pt[1],Ot=pt[2];return Ke[0]=Et,Ke[1]=wt,Ke[2]=Ot,Ke[3]=Math.sqrt(Math.abs(1-Et*Et-wt*wt-Ot*Ot)),Ke},Oe.exp=A,Oe.ln=O,Oe.pow=function(Ke,pt,Et){return O(Ke,pt),k(Ke,Ke,Et),A(Ke,Ke),Ke},Oe.slerp=N,Oe.random=function(Ke){var pt=a.RANDOM(),Et=a.RANDOM(),wt=a.RANDOM(),Ot=Math.sqrt(1-pt),It=Math.sqrt(pt);return Ke[0]=Ot*Math.sin(2*Math.PI*Et),Ke[1]=Ot*Math.cos(2*Math.PI*Et),Ke[2]=It*Math.sin(2*Math.PI*wt),Ke[3]=It*Math.cos(2*Math.PI*wt),Ke},Oe.invert=function(Ke,pt){var Et=pt[0],wt=pt[1],Ot=pt[2],It=pt[3],jt=Et*Et+wt*wt+Ot*Ot+It*It,Dt=jt?1/jt:0;return Ke[0]=-Et*Dt,Ke[1]=-wt*Dt,Ke[2]=-Ot*Dt,Ke[3]=It*Dt,Ke},Oe.conjugate=function(Ke,pt){return Ke[0]=-pt[0],Ke[1]=-pt[1],Ke[2]=-pt[2],Ke[3]=pt[3],Ke},Oe.fromMat3=D,Oe.fromEuler=function(Ke,pt,Et,wt){var Ot=.5*Math.PI/180;pt*=Ot,Et*=Ot,wt*=Ot;var It=Math.sin(pt),jt=Math.cos(pt),Dt=Math.sin(Et),Vt=Math.cos(Et),_n=Math.sin(wt),gn=Math.cos(wt);return Ke[0]=It*Vt*gn-jt*Dt*_n,Ke[1]=jt*Dt*gn+It*Vt*_n,Ke[2]=jt*Vt*_n-It*Dt*gn,Ke[3]=jt*Vt*gn+It*Dt*_n,Ke},Oe.str=function(Ke){return"quat("+Ke[0]+", "+Ke[1]+", "+Ke[2]+", "+Ke[3]+")"},Oe.setAxes=Oe.sqlerp=Oe.rotationTo=Oe.equals=Oe.exactEquals=Oe.normalize=Oe.sqrLen=Oe.squaredLength=Oe.len=Oe.length=Oe.lerp=Oe.dot=Oe.scale=Oe.mul=Oe.add=Oe.set=Oe.copy=Oe.fromValues=Oe.clone=void 0;var a=v(F()),c=v(fe()),d=v(we()),g=v(ze());function m(Ke){if(typeof WeakMap!="function")return null;var pt=new WeakMap,Et=new WeakMap;return(m=function(wt){return wt?Et:pt})(Ke)}function v(Ke,pt){if(Ke&&Ke.__esModule)return Ke;if(Ke===null||h(Ke)!=="object"&&typeof Ke!="function")return{default:Ke};var Et=m(pt);if(Et&&Et.has(Ke))return Et.get(Ke);var wt={},Ot=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var It in Ke)if(It!=="default"&&Object.prototype.hasOwnProperty.call(Ke,It)){var jt=Ot?Object.getOwnPropertyDescriptor(Ke,It):null;jt&&(jt.get||jt.set)?Object.defineProperty(wt,It,jt):wt[It]=Ke[It]}return wt.default=Ke,Et&&Et.set(Ke,wt),wt}function E(){var Ke=new a.ARRAY_TYPE(4);return a.ARRAY_TYPE!=Float32Array&&(Ke[0]=0,Ke[1]=0,Ke[2]=0),Ke[3]=1,Ke}function P(Ke,pt,Et){Et*=.5;var wt=Math.sin(Et);return Ke[0]=wt*pt[0],Ke[1]=wt*pt[1],Ke[2]=wt*pt[2],Ke[3]=Math.cos(Et),Ke}function L(Ke,pt,Et){var wt=pt[0],Ot=pt[1],It=pt[2],jt=pt[3],Dt=Et[0],Vt=Et[1],_n=Et[2],gn=Et[3];return Ke[0]=wt*gn+jt*Dt+Ot*_n-It*Vt,Ke[1]=Ot*gn+jt*Vt+It*Dt-wt*_n,Ke[2]=It*gn+jt*_n+wt*Vt-Ot*Dt,Ke[3]=jt*gn-wt*Dt-Ot*Vt-It*_n,Ke}function A(Ke,pt){var Et=pt[0],wt=pt[1],Ot=pt[2],It=pt[3],jt=Math.sqrt(Et*Et+wt*wt+Ot*Ot),Dt=Math.exp(It),Vt=jt>0?Dt*Math.sin(jt)/jt:0;return Ke[0]=Et*Vt,Ke[1]=wt*Vt,Ke[2]=Ot*Vt,Ke[3]=Dt*Math.cos(jt),Ke}function O(Ke,pt){var Et=pt[0],wt=pt[1],Ot=pt[2],It=pt[3],jt=Math.sqrt(Et*Et+wt*wt+Ot*Ot),Dt=jt>0?Math.atan2(jt,It)/jt:0;return Ke[0]=Et*Dt,Ke[1]=wt*Dt,Ke[2]=Ot*Dt,Ke[3]=.5*Math.log(Et*Et+wt*wt+Ot*Ot+It*It),Ke}function N(Ke,pt,Et,wt){var Ot,It,jt,Dt,Vt,_n=pt[0],gn=pt[1],Zn=pt[2],Cn=pt[3],Ln=Et[0],bn=Et[1],_r=Et[2],Kn=Et[3];return(It=_n*Ln+gn*bn+Zn*_r+Cn*Kn)<0&&(It=-It,Ln=-Ln,bn=-bn,_r=-_r,Kn=-Kn),1-It>a.EPSILON?(Ot=Math.acos(It),jt=Math.sin(Ot),Dt=Math.sin((1-wt)*Ot)/jt,Vt=Math.sin(wt*Ot)/jt):(Dt=1-wt,Vt=wt),Ke[0]=Dt*_n+Vt*Ln,Ke[1]=Dt*gn+Vt*bn,Ke[2]=Dt*Zn+Vt*_r,Ke[3]=Dt*Cn+Vt*Kn,Ke}function D(Ke,pt){var Et,wt=pt[0]+pt[4]+pt[8];if(wt>0)Et=Math.sqrt(wt+1),Ke[3]=.5*Et,Ke[0]=(pt[5]-pt[7])*(Et=.5/Et),Ke[1]=(pt[6]-pt[2])*Et,Ke[2]=(pt[1]-pt[3])*Et;else{var Ot=0;pt[4]>pt[0]&&(Ot=1),pt[8]>pt[3*Ot+Ot]&&(Ot=2);var It=(Ot+1)%3,jt=(Ot+2)%3;Et=Math.sqrt(pt[3*Ot+Ot]-pt[3*It+It]-pt[3*jt+jt]+1),Ke[Ot]=.5*Et,Ke[3]=(pt[3*It+jt]-pt[3*jt+It])*(Et=.5/Et),Ke[It]=(pt[3*It+Ot]+pt[3*Ot+It])*Et,Ke[jt]=(pt[3*jt+Ot]+pt[3*Ot+jt])*Et}return Ke}Oe.clone=g.clone,Oe.fromValues=g.fromValues,Oe.copy=g.copy,Oe.set=g.set,Oe.add=g.add,Oe.mul=L;var k=g.scale;Oe.scale=k;var U=g.dot;Oe.dot=U,Oe.lerp=g.lerp;var X=g.length;Oe.length=X,Oe.len=X;var Q=g.squaredLength;Oe.squaredLength=Q,Oe.sqrLen=Q;var le=g.normalize;Oe.normalize=le,Oe.exactEquals=g.exactEquals,Oe.equals=g.equals;var oe,re,me,Se=(oe=d.create(),re=d.fromValues(1,0,0),me=d.fromValues(0,1,0),function(Ke,pt,Et){var wt=d.dot(pt,Et);return wt<-.999999?(d.cross(oe,re,pt),d.len(oe)<1e-6&&d.cross(oe,me,pt),d.normalize(oe,oe),P(Ke,oe,Math.PI),Ke):wt>.999999?(Ke[0]=0,Ke[1]=0,Ke[2]=0,Ke[3]=1,Ke):(d.cross(oe,pt,Et),Ke[0]=oe[0],Ke[1]=oe[1],Ke[2]=oe[2],Ke[3]=1+wt,le(Ke,Ke))});Oe.rotationTo=Se;var Me,We,$e=(Me=E(),We=E(),function(Ke,pt,Et,wt,Ot,It){return N(Me,pt,Ot,It),N(We,Et,wt,It),N(Ke,Me,We,2*It*(1-It)),Ke});Oe.sqlerp=$e;var He,ht=(He=c.create(),function(Ke,pt,Et,wt){return He[0]=Et[0],He[3]=Et[1],He[6]=Et[2],He[1]=wt[0],He[4]=wt[1],He[7]=wt[2],He[2]=-pt[0],He[5]=-pt[1],He[8]=-pt[2],le(Ke,D(Ke,He))});return Oe.setAxes=ht,Oe}var Fe,Qe={};function Be(){if(Fe)return Qe;function h(N){return h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},h(N)}Fe=1,Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.create=function(){var N=new a.ARRAY_TYPE(8);return a.ARRAY_TYPE!=Float32Array&&(N[0]=0,N[1]=0,N[2]=0,N[4]=0,N[5]=0,N[6]=0,N[7]=0),N[3]=1,N},Qe.clone=function(N){var D=new a.ARRAY_TYPE(8);return D[0]=N[0],D[1]=N[1],D[2]=N[2],D[3]=N[3],D[4]=N[4],D[5]=N[5],D[6]=N[6],D[7]=N[7],D},Qe.fromValues=function(N,D,k,U,X,Q,le,oe){var re=new a.ARRAY_TYPE(8);return re[0]=N,re[1]=D,re[2]=k,re[3]=U,re[4]=X,re[5]=Q,re[6]=le,re[7]=oe,re},Qe.fromRotationTranslationValues=function(N,D,k,U,X,Q,le){var oe=new a.ARRAY_TYPE(8);oe[0]=N,oe[1]=D,oe[2]=k,oe[3]=U;var re=.5*X,me=.5*Q,Se=.5*le;return oe[4]=re*U+me*k-Se*D,oe[5]=me*U+Se*N-re*k,oe[6]=Se*U+re*D-me*N,oe[7]=-re*N-me*D-Se*k,oe},Qe.fromRotationTranslation=v,Qe.fromTranslation=function(N,D){return N[0]=0,N[1]=0,N[2]=0,N[3]=1,N[4]=.5*D[0],N[5]=.5*D[1],N[6]=.5*D[2],N[7]=0,N},Qe.fromRotation=function(N,D){return N[0]=D[0],N[1]=D[1],N[2]=D[2],N[3]=D[3],N[4]=0,N[5]=0,N[6]=0,N[7]=0,N},Qe.fromMat4=function(N,D){var k=c.create();d.getRotation(k,D);var U=new a.ARRAY_TYPE(3);return d.getTranslation(U,D),v(N,k,U),N},Qe.copy=E,Qe.identity=function(N){return N[0]=0,N[1]=0,N[2]=0,N[3]=1,N[4]=0,N[5]=0,N[6]=0,N[7]=0,N},Qe.set=function(N,D,k,U,X,Q,le,oe,re){return N[0]=D,N[1]=k,N[2]=U,N[3]=X,N[4]=Q,N[5]=le,N[6]=oe,N[7]=re,N},Qe.getDual=function(N,D){return N[0]=D[4],N[1]=D[5],N[2]=D[6],N[3]=D[7],N},Qe.setDual=function(N,D){return N[4]=D[0],N[5]=D[1],N[6]=D[2],N[7]=D[3],N},Qe.getTranslation=function(N,D){var k=D[4],U=D[5],X=D[6],Q=D[7],le=-D[0],oe=-D[1],re=-D[2],me=D[3];return N[0]=2*(k*me+Q*le+U*re-X*oe),N[1]=2*(U*me+Q*oe+X*le-k*re),N[2]=2*(X*me+Q*re+k*oe-U*le),N},Qe.translate=function(N,D,k){var U=D[0],X=D[1],Q=D[2],le=D[3],oe=.5*k[0],re=.5*k[1],me=.5*k[2],Se=D[4],Me=D[5],We=D[6],$e=D[7];return N[0]=U,N[1]=X,N[2]=Q,N[3]=le,N[4]=le*oe+X*me-Q*re+Se,N[5]=le*re+Q*oe-U*me+Me,N[6]=le*me+U*re-X*oe+We,N[7]=-U*oe-X*re-Q*me+$e,N},Qe.rotateX=function(N,D,k){var U=-D[0],X=-D[1],Q=-D[2],le=D[3],oe=D[4],re=D[5],me=D[6],Se=D[7],Me=oe*le+Se*U+re*Q-me*X,We=re*le+Se*X+me*U-oe*Q,$e=me*le+Se*Q+oe*X-re*U,He=Se*le-oe*U-re*X-me*Q;return c.rotateX(N,D,k),N[4]=Me*(le=N[3])+He*(U=N[0])+We*(Q=N[2])-$e*(X=N[1]),N[5]=We*le+He*X+$e*U-Me*Q,N[6]=$e*le+He*Q+Me*X-We*U,N[7]=He*le-Me*U-We*X-$e*Q,N},Qe.rotateY=function(N,D,k){var U=-D[0],X=-D[1],Q=-D[2],le=D[3],oe=D[4],re=D[5],me=D[6],Se=D[7],Me=oe*le+Se*U+re*Q-me*X,We=re*le+Se*X+me*U-oe*Q,$e=me*le+Se*Q+oe*X-re*U,He=Se*le-oe*U-re*X-me*Q;return c.rotateY(N,D,k),N[4]=Me*(le=N[3])+He*(U=N[0])+We*(Q=N[2])-$e*(X=N[1]),N[5]=We*le+He*X+$e*U-Me*Q,N[6]=$e*le+He*Q+Me*X-We*U,N[7]=He*le-Me*U-We*X-$e*Q,N},Qe.rotateZ=function(N,D,k){var U=-D[0],X=-D[1],Q=-D[2],le=D[3],oe=D[4],re=D[5],me=D[6],Se=D[7],Me=oe*le+Se*U+re*Q-me*X,We=re*le+Se*X+me*U-oe*Q,$e=me*le+Se*Q+oe*X-re*U,He=Se*le-oe*U-re*X-me*Q;return c.rotateZ(N,D,k),N[4]=Me*(le=N[3])+He*(U=N[0])+We*(Q=N[2])-$e*(X=N[1]),N[5]=We*le+He*X+$e*U-Me*Q,N[6]=$e*le+He*Q+Me*X-We*U,N[7]=He*le-Me*U-We*X-$e*Q,N},Qe.rotateByQuatAppend=function(N,D,k){var U=k[0],X=k[1],Q=k[2],le=k[3],oe=D[0],re=D[1],me=D[2],Se=D[3];return N[0]=oe*le+Se*U+re*Q-me*X,N[1]=re*le+Se*X+me*U-oe*Q,N[2]=me*le+Se*Q+oe*X-re*U,N[3]=Se*le-oe*U-re*X-me*Q,N[4]=(oe=D[4])*le+(Se=D[7])*U+(re=D[5])*Q-(me=D[6])*X,N[5]=re*le+Se*X+me*U-oe*Q,N[6]=me*le+Se*Q+oe*X-re*U,N[7]=Se*le-oe*U-re*X-me*Q,N},Qe.rotateByQuatPrepend=function(N,D,k){var U=D[0],X=D[1],Q=D[2],le=D[3],oe=k[0],re=k[1],me=k[2],Se=k[3];return N[0]=U*Se+le*oe+X*me-Q*re,N[1]=X*Se+le*re+Q*oe-U*me,N[2]=Q*Se+le*me+U*re-X*oe,N[3]=le*Se-U*oe-X*re-Q*me,N[4]=U*(Se=k[7])+le*(oe=k[4])+X*(me=k[6])-Q*(re=k[5]),N[5]=X*Se+le*re+Q*oe-U*me,N[6]=Q*Se+le*me+U*re-X*oe,N[7]=le*Se-U*oe-X*re-Q*me,N},Qe.rotateAroundAxis=function(N,D,k,U){if(Math.abs(U)<a.EPSILON)return E(N,D);var X=Math.hypot(k[0],k[1],k[2]);U*=.5;var Q=Math.sin(U),le=Q*k[0]/X,oe=Q*k[1]/X,re=Q*k[2]/X,me=Math.cos(U),Se=D[0],Me=D[1],We=D[2],$e=D[3];N[0]=Se*me+$e*le+Me*re-We*oe,N[1]=Me*me+$e*oe+We*le-Se*re,N[2]=We*me+$e*re+Se*oe-Me*le,N[3]=$e*me-Se*le-Me*oe-We*re;var He=D[4],ht=D[5],Ke=D[6],pt=D[7];return N[4]=He*me+pt*le+ht*re-Ke*oe,N[5]=ht*me+pt*oe+Ke*le-He*re,N[6]=Ke*me+pt*re+He*oe-ht*le,N[7]=pt*me-He*le-ht*oe-Ke*re,N},Qe.add=function(N,D,k){return N[0]=D[0]+k[0],N[1]=D[1]+k[1],N[2]=D[2]+k[2],N[3]=D[3]+k[3],N[4]=D[4]+k[4],N[5]=D[5]+k[5],N[6]=D[6]+k[6],N[7]=D[7]+k[7],N},Qe.multiply=P,Qe.scale=function(N,D,k){return N[0]=D[0]*k,N[1]=D[1]*k,N[2]=D[2]*k,N[3]=D[3]*k,N[4]=D[4]*k,N[5]=D[5]*k,N[6]=D[6]*k,N[7]=D[7]*k,N},Qe.lerp=function(N,D,k,U){var X=1-U;return L(D,k)<0&&(U=-U),N[0]=D[0]*X+k[0]*U,N[1]=D[1]*X+k[1]*U,N[2]=D[2]*X+k[2]*U,N[3]=D[3]*X+k[3]*U,N[4]=D[4]*X+k[4]*U,N[5]=D[5]*X+k[5]*U,N[6]=D[6]*X+k[6]*U,N[7]=D[7]*X+k[7]*U,N},Qe.invert=function(N,D){var k=O(D);return N[0]=-D[0]/k,N[1]=-D[1]/k,N[2]=-D[2]/k,N[3]=D[3]/k,N[4]=-D[4]/k,N[5]=-D[5]/k,N[6]=-D[6]/k,N[7]=D[7]/k,N},Qe.conjugate=function(N,D){return N[0]=-D[0],N[1]=-D[1],N[2]=-D[2],N[3]=D[3],N[4]=-D[4],N[5]=-D[5],N[6]=-D[6],N[7]=D[7],N},Qe.normalize=function(N,D){var k=O(D);if(k>0){k=Math.sqrt(k);var U=D[0]/k,X=D[1]/k,Q=D[2]/k,le=D[3]/k,oe=D[4],re=D[5],me=D[6],Se=D[7],Me=U*oe+X*re+Q*me+le*Se;N[0]=U,N[1]=X,N[2]=Q,N[3]=le,N[4]=(oe-U*Me)/k,N[5]=(re-X*Me)/k,N[6]=(me-Q*Me)/k,N[7]=(Se-le*Me)/k}return N},Qe.str=function(N){return"quat2("+N[0]+", "+N[1]+", "+N[2]+", "+N[3]+", "+N[4]+", "+N[5]+", "+N[6]+", "+N[7]+")"},Qe.exactEquals=function(N,D){return N[0]===D[0]&&N[1]===D[1]&&N[2]===D[2]&&N[3]===D[3]&&N[4]===D[4]&&N[5]===D[5]&&N[6]===D[6]&&N[7]===D[7]},Qe.equals=function(N,D){var k=N[0],U=N[1],X=N[2],Q=N[3],le=N[4],oe=N[5],re=N[6],me=N[7],Se=D[0],Me=D[1],We=D[2],$e=D[3],He=D[4],ht=D[5],Ke=D[6],pt=D[7];return Math.abs(k-Se)<=a.EPSILON*Math.max(1,Math.abs(k),Math.abs(Se))&&Math.abs(U-Me)<=a.EPSILON*Math.max(1,Math.abs(U),Math.abs(Me))&&Math.abs(X-We)<=a.EPSILON*Math.max(1,Math.abs(X),Math.abs(We))&&Math.abs(Q-$e)<=a.EPSILON*Math.max(1,Math.abs(Q),Math.abs($e))&&Math.abs(le-He)<=a.EPSILON*Math.max(1,Math.abs(le),Math.abs(He))&&Math.abs(oe-ht)<=a.EPSILON*Math.max(1,Math.abs(oe),Math.abs(ht))&&Math.abs(re-Ke)<=a.EPSILON*Math.max(1,Math.abs(re),Math.abs(Ke))&&Math.abs(me-pt)<=a.EPSILON*Math.max(1,Math.abs(me),Math.abs(pt))},Qe.sqrLen=Qe.squaredLength=Qe.len=Qe.length=Qe.dot=Qe.mul=Qe.setReal=Qe.getReal=void 0;var a=m(F()),c=m(Ue()),d=m(be());function g(N){if(typeof WeakMap!="function")return null;var D=new WeakMap,k=new WeakMap;return(g=function(U){return U?k:D})(N)}function m(N,D){if(N&&N.__esModule)return N;if(N===null||h(N)!=="object"&&typeof N!="function")return{default:N};var k=g(D);if(k&&k.has(N))return k.get(N);var U={},X=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Q in N)if(Q!=="default"&&Object.prototype.hasOwnProperty.call(N,Q)){var le=X?Object.getOwnPropertyDescriptor(N,Q):null;le&&(le.get||le.set)?Object.defineProperty(U,Q,le):U[Q]=N[Q]}return U.default=N,k&&k.set(N,U),U}function v(N,D,k){var U=.5*k[0],X=.5*k[1],Q=.5*k[2],le=D[0],oe=D[1],re=D[2],me=D[3];return N[0]=le,N[1]=oe,N[2]=re,N[3]=me,N[4]=U*me+X*re-Q*oe,N[5]=X*me+Q*le-U*re,N[6]=Q*me+U*oe-X*le,N[7]=-U*le-X*oe-Q*re,N}function E(N,D){return N[0]=D[0],N[1]=D[1],N[2]=D[2],N[3]=D[3],N[4]=D[4],N[5]=D[5],N[6]=D[6],N[7]=D[7],N}function P(N,D,k){var U=D[0],X=D[1],Q=D[2],le=D[3],oe=k[4],re=k[5],me=k[6],Se=k[7],Me=D[4],We=D[5],$e=D[6],He=D[7],ht=k[0],Ke=k[1],pt=k[2],Et=k[3];return N[0]=U*Et+le*ht+X*pt-Q*Ke,N[1]=X*Et+le*Ke+Q*ht-U*pt,N[2]=Q*Et+le*pt+U*Ke-X*ht,N[3]=le*Et-U*ht-X*Ke-Q*pt,N[4]=U*Se+le*oe+X*me-Q*re+Me*Et+He*ht+We*pt-$e*Ke,N[5]=X*Se+le*re+Q*oe-U*me+We*Et+He*Ke+$e*ht-Me*pt,N[6]=Q*Se+le*me+U*re-X*oe+$e*Et+He*pt+Me*Ke-We*ht,N[7]=le*Se-U*oe-X*re-Q*me+He*Et-Me*ht-We*Ke-$e*pt,N}Qe.getReal=c.copy,Qe.setReal=c.copy,Qe.mul=P;var L=c.dot;Qe.dot=L;var A=c.length;Qe.length=A,Qe.len=A;var O=c.squaredLength;return Qe.squaredLength=O,Qe.sqrLen=O,Qe}var bt,xe,Le={};function Xe(){if(bt)return Le;function h(D){return h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(k){return typeof k}:function(k){return k&&typeof Symbol=="function"&&k.constructor===Symbol&&k!==Symbol.prototype?"symbol":typeof k},h(D)}bt=1,Object.defineProperty(Le,"__esModule",{value:!0}),Le.create=d,Le.clone=function(D){var k=new a.ARRAY_TYPE(2);return k[0]=D[0],k[1]=D[1],k},Le.fromValues=function(D,k){var U=new a.ARRAY_TYPE(2);return U[0]=D,U[1]=k,U},Le.copy=function(D,k){return D[0]=k[0],D[1]=k[1],D},Le.set=function(D,k,U){return D[0]=k,D[1]=U,D},Le.add=function(D,k,U){return D[0]=k[0]+U[0],D[1]=k[1]+U[1],D},Le.subtract=g,Le.multiply=m,Le.divide=v,Le.ceil=function(D,k){return D[0]=Math.ceil(k[0]),D[1]=Math.ceil(k[1]),D},Le.floor=function(D,k){return D[0]=Math.floor(k[0]),D[1]=Math.floor(k[1]),D},Le.min=function(D,k,U){return D[0]=Math.min(k[0],U[0]),D[1]=Math.min(k[1],U[1]),D},Le.max=function(D,k,U){return D[0]=Math.max(k[0],U[0]),D[1]=Math.max(k[1],U[1]),D},Le.round=function(D,k){return D[0]=Math.round(k[0]),D[1]=Math.round(k[1]),D},Le.scale=function(D,k,U){return D[0]=k[0]*U,D[1]=k[1]*U,D},Le.scaleAndAdd=function(D,k,U,X){return D[0]=k[0]+U[0]*X,D[1]=k[1]+U[1]*X,D},Le.distance=E,Le.squaredDistance=P,Le.length=L,Le.squaredLength=A,Le.negate=function(D,k){return D[0]=-k[0],D[1]=-k[1],D},Le.inverse=function(D,k){return D[0]=1/k[0],D[1]=1/k[1],D},Le.normalize=function(D,k){var U=k[0],X=k[1],Q=U*U+X*X;return Q>0&&(Q=1/Math.sqrt(Q)),D[0]=k[0]*Q,D[1]=k[1]*Q,D},Le.dot=function(D,k){return D[0]*k[0]+D[1]*k[1]},Le.cross=function(D,k,U){var X=k[0]*U[1]-k[1]*U[0];return D[0]=D[1]=0,D[2]=X,D},Le.lerp=function(D,k,U,X){var Q=k[0],le=k[1];return D[0]=Q+X*(U[0]-Q),D[1]=le+X*(U[1]-le),D},Le.random=function(D,k){k=k||1;var U=2*a.RANDOM()*Math.PI;return D[0]=Math.cos(U)*k,D[1]=Math.sin(U)*k,D},Le.transformMat2=function(D,k,U){var X=k[0],Q=k[1];return D[0]=U[0]*X+U[2]*Q,D[1]=U[1]*X+U[3]*Q,D},Le.transformMat2d=function(D,k,U){var X=k[0],Q=k[1];return D[0]=U[0]*X+U[2]*Q+U[4],D[1]=U[1]*X+U[3]*Q+U[5],D},Le.transformMat3=function(D,k,U){var X=k[0],Q=k[1];return D[0]=U[0]*X+U[3]*Q+U[6],D[1]=U[1]*X+U[4]*Q+U[7],D},Le.transformMat4=function(D,k,U){var X=k[0],Q=k[1];return D[0]=U[0]*X+U[4]*Q+U[12],D[1]=U[1]*X+U[5]*Q+U[13],D},Le.rotate=function(D,k,U,X){var Q=k[0]-U[0],le=k[1]-U[1],oe=Math.sin(X),re=Math.cos(X);return D[0]=Q*re-le*oe+U[0],D[1]=Q*oe+le*re+U[1],D},Le.angle=function(D,k){var U=D[0],X=D[1],Q=k[0],le=k[1],oe=Math.sqrt(U*U+X*X)*Math.sqrt(Q*Q+le*le);return Math.acos(Math.min(Math.max(oe&&(U*Q+X*le)/oe,-1),1))},Le.zero=function(D){return D[0]=0,D[1]=0,D},Le.str=function(D){return"vec2("+D[0]+", "+D[1]+")"},Le.exactEquals=function(D,k){return D[0]===k[0]&&D[1]===k[1]},Le.equals=function(D,k){var U=D[0],X=D[1],Q=k[0],le=k[1];return Math.abs(U-Q)<=a.EPSILON*Math.max(1,Math.abs(U),Math.abs(Q))&&Math.abs(X-le)<=a.EPSILON*Math.max(1,Math.abs(X),Math.abs(le))},Le.forEach=Le.sqrLen=Le.sqrDist=Le.dist=Le.div=Le.mul=Le.sub=Le.len=void 0;var a=function(D,k){if(D&&D.__esModule)return D;if(D===null||h(D)!=="object"&&typeof D!="function")return{default:D};var U=c(void 0);if(U&&U.has(D))return U.get(D);var X={},Q=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var le in D)if(le!=="default"&&Object.prototype.hasOwnProperty.call(D,le)){var oe=Q?Object.getOwnPropertyDescriptor(D,le):null;oe&&(oe.get||oe.set)?Object.defineProperty(X,le,oe):X[le]=D[le]}return X.default=D,U&&U.set(D,X),X}(F());function c(D){if(typeof WeakMap!="function")return null;var k=new WeakMap,U=new WeakMap;return(c=function(X){return X?U:k})(D)}function d(){var D=new a.ARRAY_TYPE(2);return a.ARRAY_TYPE!=Float32Array&&(D[0]=0,D[1]=0),D}function g(D,k,U){return D[0]=k[0]-U[0],D[1]=k[1]-U[1],D}function m(D,k,U){return D[0]=k[0]*U[0],D[1]=k[1]*U[1],D}function v(D,k,U){return D[0]=k[0]/U[0],D[1]=k[1]/U[1],D}function E(D,k){return Math.hypot(k[0]-D[0],k[1]-D[1])}function P(D,k){var U=k[0]-D[0],X=k[1]-D[1];return U*U+X*X}function L(D){return Math.hypot(D[0],D[1])}function A(D){var k=D[0],U=D[1];return k*k+U*U}Le.len=L,Le.sub=g,Le.mul=m,Le.div=v,Le.dist=E,Le.sqrDist=P,Le.sqrLen=A;var O,N=(O=d(),function(D,k,U,X,Q,le){var oe,re;for(k||(k=2),U||(U=0),re=X?Math.min(X*k+U,D.length):D.length,oe=U;oe<re;oe+=k)O[0]=D[oe],O[1]=D[oe+1],Q(O,O,le),D[oe]=O[0],D[oe+1]=O[1];return D});return Le.forEach=N,Le}function ct(){if(xe)return I;function h(D){return h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(k){return typeof k}:function(k){return k&&typeof Symbol=="function"&&k.constructor===Symbol&&k!==Symbol.prototype?"symbol":typeof k},h(D)}xe=1,Object.defineProperty(I,"__esModule",{value:!0}),I.vec4=I.vec3=I.vec2=I.quat2=I.quat=I.mat4=I.mat3=I.mat2d=I.mat2=I.glMatrix=void 0;var a=N(F());I.glMatrix=a;var c=N(G());I.mat2=c;var d=N(ie());I.mat2d=d;var g=N(fe());I.mat3=g;var m=N(be());I.mat4=m;var v=N(Ue());I.quat=v;var E=N(Be());I.quat2=E;var P=N(Xe());I.vec2=P;var L=N(we());I.vec3=L;var A=N(ze());function O(D){if(typeof WeakMap!="function")return null;var k=new WeakMap,U=new WeakMap;return(O=function(X){return X?U:k})(D)}function N(D,k){if(D&&D.__esModule)return D;if(D===null||h(D)!=="object"&&typeof D!="function")return{default:D};var U=O(k);if(U&&U.has(D))return U.get(D);var X={},Q=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var le in D)if(le!=="default"&&Object.prototype.hasOwnProperty.call(D,le)){var oe=Q?Object.getOwnPropertyDescriptor(D,le):null;oe&&(oe.get||oe.set)?Object.defineProperty(X,le,oe):X[le]=D[le]}return X.default=D,U&&U.set(D,X),X}return I.vec4=A,I}var vt,Nt,mt,yt,_e=ct(),on=function(){if(Nt)return vt;function h(a,c,d,g){this.cx=3*a,this.bx=3*(d-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*c,this.by=3*(g-c)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=c,this.p2x=d,this.p2y=g}return Nt=1,vt=h,h.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,c){if(c===void 0&&(c=1e-6),a<0)return 0;if(a>1)return 1;for(var d=a,g=0;g<8;g++){var m=this.sampleCurveX(d)-a;if(Math.abs(m)<c)return d;var v=this.sampleCurveDerivativeX(d);if(Math.abs(v)<1e-6)break;d-=m/v}var E=0,P=1;for(d=a,g=0;g<20&&(m=this.sampleCurveX(d),!(Math.abs(m-a)<c));g++)a>m?E=d:P=d,d=.5*(P-E)+E;return d},solve:function(a,c){return this.sampleCurveY(this.solveCurveX(a,c))}},vt}(),Kt=x(on);function Pn(){if(yt)return mt;function h(a,c){this.x=a,this.y=c}return yt=1,mt=h,h.prototype={clone:function(){return new h(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,c){return this.clone()._rotateAround(a,c)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var c=a.x-this.x,d=a.y-this.y;return c*c+d*d},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,c){return Math.atan2(this.x*c-this.y*a,this.x*a+this.y*c)},_matMult:function(a){var c=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=c,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var c=Math.cos(a),d=Math.sin(a),g=d*this.x+c*this.y;return this.x=c*this.x-d*this.y,this.y=g,this},_rotateAround:function(a,c){var d=Math.cos(a),g=Math.sin(a),m=c.y+g*(this.x-c.x)+d*(this.y-c.y);return this.x=c.x+d*(this.x-c.x)-g*(this.y-c.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},h.convert=function(a){return a instanceof h?a:Array.isArray(a)?new h(a[0],a[1]):a},mt}var Ut=x(Pn());function cn(h,a){if(Array.isArray(h)){if(!Array.isArray(a)||h.length!==a.length)return!1;for(let c=0;c<h.length;c++)if(!cn(h[c],a[c]))return!1;return!0}if(typeof h=="object"&&h!==null&&a!==null){if(typeof a!="object"||Object.keys(h).length!==Object.keys(a).length)return!1;for(const c in h)if(!cn(h[c],a[c]))return!1;return!0}return h===a}const At=Math.PI/180,xr=180/Math.PI;function Rn(h){return h*At}function Dn(h){return h*xr}const ar=[[0,0],[1,0],[1,1],[0,1]];function hr(h){if(h<=0)return 0;if(h>=1)return 1;const a=h*h,c=a*h;return 4*(h<.5?c:3*(h-a)+c-.75)}function ur(h,a,c,d){const g=new Kt(h,a,c,d);return function(m){return g.solve(m)}}const Ir=ur(.25,.1,.25,1);function Un(h,a,c){return Math.min(c,Math.max(a,h))}function Vr(h,a,c){return(c=Un((c-h)/(a-h),0,1))*c*(3-2*c)}function pi(h,a,c){const d=c-a,g=((h-a)%d+d)%d+a;return g===a?c:g}function Li(h,a,c){if(!h.length)return c(null,[]);let d=h.length;const g=new Array(h.length);let m=null;h.forEach((v,E)=>{a(v,(P,L)=>{P&&(m=P),g[E]=L,--d==0&&c(m,g)})})}function wi(h,...a){for(const c of a)for(const d in c)h[d]=c[d];return h}let xn=1;function Xn(){return xn++}function hn(h){return h<=1?1:Math.pow(2,Math.ceil(Math.log(h)/Math.LN2))}function er(h,a){h.forEach(c=>{a[c]&&(a[c]=a[c].bind(a))})}function yr(h,a,c){const d={};for(const g in h)d[g]=a.call(this,h[g],g,h);return d}function Vi(h,a,c){const d={};for(const g in h)a.call(this,h[g],g,h)&&(d[g]=h[g]);return d}function ki(h){return Array.isArray(h)?h.map(ki):typeof h=="object"&&h?yr(h,ki):h}const mi={};function ti(h){mi[h]||(typeof console<"u"&&console.warn(h),mi[h]=!0)}function Pr(h,a,c){return(c.y-h.y)*(a.x-h.x)>(a.y-h.y)*(c.x-h.x)}function ys(h){let a=0;for(let c,d,g=0,m=h.length,v=m-1;g<m;v=g++)c=h[g],d=h[v],a+=(d.x-c.x)*(c.y+d.y);return a}function Fa([h,a,c]){const d=Rn(a+90),g=Rn(c);return{x:h*Math.cos(d)*Math.sin(g),y:h*Math.sin(d)*Math.sin(g),z:h*Math.cos(g),azimuthal:a,polar:c}}function Za(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Oo(h){const a={};if(h.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,d,g,m)=>{const v=g||m;return a[d]=!v||v.toLowerCase(),""}),a["max-age"]){const c=parseInt(a["max-age"],10);isNaN(c)?delete a["max-age"]:a["max-age"]=c}return a}let Ia=null;function fi(h,a){return[h[4*a],h[4*a+1],h[4*a+2],h[4*a+3]]}function la(h,a,c,d){for(;a<c;){const g=a+c>>1;h[g]<d?a=g+1:c=g}return a}function Iu(h,a,c,d){for(;a<c;){const g=a+c>>1;h[g]<=d?a=g+1:c=g}return a}function zs(h){return h>0?1/(1.001-h):1+h}function Zt(h){return h>0?1-1/(1.001-h):-h}const Ee={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Ee.API_URL)return null;try{const h=new URL(Ee.API_URL);return h.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":h.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Re(h){return Ee.API_URL_REGEX.test(h)}function tt(h){return Ee.API_SPRITE_REGEX.test(h)}let gt,ft,Tt,Ft,Ct,Ht;function Gt(){return gt==null&&(gt=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),gt}const $t={now:()=>Ft!==void 0?Ft:performance.now(),setNow(h){Ft=h},restoreNow(){Ft=void 0},frame(h){const a=requestAnimationFrame(h);return{cancel:()=>cancelAnimationFrame(a)}},getImageData(h,a=0){const{width:c,height:d}=h;Ct||(Ct=document.createElement("canvas"));const g=Ct.getContext("2d",{willReadFrequently:!0});if(!g)throw new Error("failed to create canvas 2d context");return(c>Ct.width||d>Ct.height)&&(Ct.width=c,Ct.height=d),g.clearRect(-a,-a,c+2*a,d+2*a),g.drawImage(h,0,0,c,d),g.getImageData(-a,-a,c+2*a,d+2*a)},resolveURL:h=>(ft||(ft=document.createElement("a")),ft.href=h,ft.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Tt==null&&(Tt=window.matchMedia("(prefers-reduced-motion: reduce)")),Tt.matches)},hasCanvasFingerprintNoise(){if(Ht!==void 0)return Ht;if(!Gt())return Ht=!1,!1;const h=new OffscreenCanvas(85,1),a=h.getContext("2d",{willReadFrequently:!0});let c=0;for(let g=0;g<h.width;++g)a.fillStyle=`rgba(${c++},${c++},${c++}, 255)`,a.fillRect(g,0,1,1);const d=a.getImageData(0,0,h.width,h.height);c=0;for(let g=0;g<d.data.length;++g)if(g%4!=3&&c++!==d.data[g])return Ht=!0,!0;return Ht=!1,!1}};function Sn(h,a){const c=h.indexOf("?");if(c<0)return`${h}?${new URLSearchParams(a).toString()}`;const d=new URLSearchParams(h.slice(c));for(const g in a)d.set(g,a[g]);return`${h.slice(0,c)}?${d.toString()}`}function Nn(h,a={persistentParams:[]}){const c=h.indexOf("?");if(c<0)return h;const d=new URLSearchParams,g=new URLSearchParams(h.slice(c));for(const v of a.persistentParams){const E=g.get(v);E&&d.set(v,E)}const m=d.toString();return`${h.slice(0,c)}${m.length>0?`?${m}`:""}`}const qn="mapbox-tiles";let vr=500,Or=50;const Rr=["language","worldview","jobid"];let qr,Ri;function Xi(){try{return caches}catch{}}function Hr(){const h=Xi();h&&qr==null&&(qr=h.open(qn))}let gi=1/0;const Gr={supported:!1,testSupport:function(h){!Ua&&Pa&&(_s?Ro(h):Ni=h)}};let Ni,Pa,Ua=!1,_s=!1;const vs=typeof self<"u"?self:{};function Ro(h){const a=h.createTexture();h.bindTexture(h.TEXTURE_2D,a);try{if(h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,Pa),h.isContextLost())return;Gr.supported=!0}catch{}h.deleteTexture(a),Ua=!0}vs.document&&(Pa=vs.document.createElement("img"),Pa.onload=function(){Ni&&Ro(Ni),Ni=null,_s=!0},Pa.onerror=function(){Ua=!0,Ni=null},Pa.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const bs={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(bs);class Bs extends Error{constructor(a,c,d){c===401&&Re(d)&&(a+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(a),this.status=c,this.url=d}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const iu=Za()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Wo=function(h,a){if(!(/^file:/.test(c=h.url)||/^file:/.test(iu())&&!/^\w+:/.test(c))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(d,g){const m=new AbortController,v=new Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,referrer:iu(),referrerPolicy:d.referrerPolicy,signal:m.signal});let E=!1,P=!1;const L=(A=v.url).indexOf("sku=")>0&&Re(A);var A;d.type==="json"&&v.headers.set("Accept","application/json");const O=(D,k,U)=>{if(P)return;if(D&&D.message!=="SecurityError"&&ti(D.toString()),k&&U)return N(k);const X=Date.now();fetch(v).then(Q=>{if(Q.ok){const le=L?Q.clone():null;return N(Q,le,X)}return g(new Bs(Q.statusText,Q.status,d.url))}).catch(Q=>{Q.name!=="AbortError"&&g(new Error(`${Q.message} ${d.url}`))})},N=(D,k,U)=>{(d.type==="arrayBuffer"?D.arrayBuffer():d.type==="json"?D.json():D.text()).then(X=>{P||(k&&U&&function(Q,le,oe){if(Hr(),qr==null)return;const re=Oo(le.headers.get("Cache-Control")||"");if(re["no-store"])return;const me={status:le.status,statusText:le.statusText,headers:new Headers};le.headers.forEach((We,$e)=>me.headers.set($e,We)),re["max-age"]&&me.headers.set("Expires",new Date(oe+1e3*re["max-age"]).toUTCString());const Se=me.headers.get("Expires");if(!Se||new Date(Se).getTime()-oe<42e4)return;let Me=Nn(Q.url,{persistentParams:Rr});if(le.status===206){const We=Q.headers.get("Range");if(!We)return;me.status=200,Me=Sn(Me,{range:We})}(function(We,$e){if(Ri===void 0)try{new Response(new ReadableStream),Ri=!0}catch{Ri=!1}Ri?$e(We.body):We.blob().then($e)})(le,We=>{const $e=new Response((He=le.status)!==200&&He!==404&&[101,103,204,205,304].includes(He)?null:We,me);var He;Hr(),qr!=null&&qr.then(ht=>ht.put(Me,$e)).catch(ht=>ti(ht.message))})}(v,k,U),E=!0,g(null,X,D.headers.get("Cache-Control"),D.headers.get("Expires")))}).catch(X=>{P||g(new Error(X.message))})};return L?function(D,k){if(Hr(),qr==null)return k(null);qr.then(U=>{let X=Nn(D.url,{persistentParams:Rr});const Q=D.headers.get("Range");Q&&(X=Sn(X,{range:Q})),U.match(X).then(le=>{const oe=function(re){if(!re)return!1;const me=new Date(re.headers.get("Expires")||0),Se=Oo(re.headers.get("Cache-Control")||"");return me>Date.now()&&!Se["no-cache"]}(le);U.delete(X),oe&&U.put(X,le.clone()),k(null,le,oe)}).catch(k)}).catch(k)}(v,O):O(null,null),{cancel:()=>{P=!0,E||m.abort()}}}(h,a);if(Za()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",h,a,void 0,!0)}var c;return function(d,g){const m=new XMLHttpRequest;m.open(d.method||"GET",d.url,!0),d.type==="arrayBuffer"&&(m.responseType="arraybuffer");for(const v in d.headers)m.setRequestHeader(v,d.headers[v]);return d.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=d.credentials==="include",m.onerror=()=>{g(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let v=m.response;if(d.type==="json")try{v=JSON.parse(m.response)}catch(E){return g(E)}g(null,v,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else g(new Bs(m.statusText,m.status,d.url))},m.send(d.body),{cancel:()=>m.abort()}}(h,a)},Oa=function(h,a){return Wo(wi(h,{type:"arrayBuffer"}),a)};function Fl(h){const a=document.createElement("a");return a.href=h,a.protocol===location.protocol&&a.host===location.host}const Do="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let gh,Pu;gh=[],Pu=0;const Jh=function(h,a){if(Gr.supported&&(h.headers||(h.headers={}),h.headers.accept="image/webp,*/*"),Pu>=Ee.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:h,callback:a,cancelled:!1,cancel(){this.cancelled=!0}};return gh.push(m),m}Pu++;let c=!1;const d=()=>{if(!c)for(c=!0,Pu--;gh.length&&Pu<Ee.MAX_PARALLEL_IMAGE_REQUESTS;){const m=gh.shift(),{requestParameters:v,callback:E,cancelled:P}=m;P||(m.cancel=Jh(v,E).cancel)}},g=Oa(h,(m,v,E,P)=>{d(),m?a(m):v&&(self.createImageBitmap?function(L,A){const O=new Blob([new Uint8Array(L)],{type:"image/png"});createImageBitmap(O).then(N=>{A(null,N)}).catch(N=>{A(new Error(`Could not load image because of ${N.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(v,(L,A)=>a(L,A,E,P)):function(L,A){const O=new Image;O.onload=()=>{A(null,O),URL.revokeObjectURL(O.src),O.onload=null,requestAnimationFrame(()=>{O.src=Do})},O.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const N=new Blob([new Uint8Array(L)],{type:"image/png"});O.src=L.byteLength?URL.createObjectURL(N):Do}(v,(L,A)=>a(L,A,E,P)))});return{cancel:()=>{g.cancel(),d()}}};var lc,Ou,cl,Ys={exports:{}},Lo={exports:{}},Ul={exports:{}},cc=function(){if(cl)return Ys.exports;cl=1;var h=(lc||(lc=1,Lo.exports=function(c,d){var g,m,v,E,P,L,A,O;for(m=c.length-(g=3&c.length),v=d,P=3432918353,L=461845907,O=0;O<m;)A=255&c.charCodeAt(O)|(255&c.charCodeAt(++O))<<8|(255&c.charCodeAt(++O))<<16|(255&c.charCodeAt(++O))<<24,++O,v=27492+(65535&(E=5*(65535&(v=(v^=A=(65535&(A=(A=(65535&A)*P+(((A>>>16)*P&65535)<<16)&4294967295)<<15|A>>>17))*L+(((A>>>16)*L&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(E>>>16)&65535)<<16);switch(A=0,g){case 3:A^=(255&c.charCodeAt(O+2))<<16;case 2:A^=(255&c.charCodeAt(O+1))<<8;case 1:v^=A=(65535&(A=(A=(65535&(A^=255&c.charCodeAt(O)))*P+(((A>>>16)*P&65535)<<16)&4294967295)<<15|A>>>17))*L+(((A>>>16)*L&65535)<<16)&4294967295}return v^=c.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0}),Lo.exports),a=(Ou||(Ou=1,Ul.exports=function(c,d){for(var g,m=c.length,v=d^m,E=0;m>=4;)g=1540483477*(65535&(g=255&c.charCodeAt(E)|(255&c.charCodeAt(++E))<<8|(255&c.charCodeAt(++E))<<16|(255&c.charCodeAt(++E))<<24))+((1540483477*(g>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(g=1540483477*(65535&(g^=g>>>24))+((1540483477*(g>>>16)&65535)<<16)),m-=4,++E;switch(m){case 3:v^=(255&c.charCodeAt(E+2))<<16;case 2:v^=(255&c.charCodeAt(E+1))<<8;case 1:v=1540483477*(65535&(v^=255&c.charCodeAt(E)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0}),Ul.exports);return Ys.exports=h,Ys.exports.murmur3=h,Ys.exports.murmur2=a,Ys.exports}(),so=x(cc);class ko{constructor(a,...c){wi(this,c[0]||{}),this.type=a}}class yh extends ko{constructor(a,c={}){super("error",wi({error:a},c))}}function Bc(h,a,c){c[h]&&c[h].indexOf(a)!==-1||(c[h]=c[h]||[],c[h].push(a))}function ud(h,a,c){if(c&&c[h]){const d=c[h].indexOf(a);d!==-1&&c[h].splice(d,1)}}class ql{on(a,c){return this._listeners=this._listeners||{},Bc(a,c,this._listeners),this}off(a,c){return ud(a,c,this._listeners),ud(a,c,this._oneTimeListeners),this}once(a,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},Bc(a,c,this._oneTimeListeners),this):new Promise(d=>{this.once(a,d)})}fire(a,c){const d=typeof a=="string"?new ko(a,c):a,g=d.type;if(this.listens(g)){d.target=this;const m=this._listeners&&this._listeners[g]?this._listeners[g].slice():[];for(const P of m)P.call(this,d);const v=this._oneTimeListeners&&this._oneTimeListeners[g]?this._oneTimeListeners[g].slice():[];for(const P of v)ud(g,P,this._oneTimeListeners),P.call(this,d);const E=this._eventedParent;E&&(wi(d,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),E.fire(d))}else d instanceof yh&&console.error(d.error);return this}listens(a){return!!(this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a))}setEventedParent(a,c){return this._eventedParent=a,this._eventedParentData=c,this}}class No{constructor(a){typeof a=="string"?this.name=a:(this.name=a.name,this.iconsetId=a.iconsetId)}static from(a){return new No(a)}static toString(a){return a.iconsetId?`${a.name}${a.iconsetId}`:a.name}static parse(a){const[c,d]=a.split("");return new No({name:c,iconsetId:d})}static isEqual(a,c){return a.name===c.name&&a.iconsetId===c.iconsetId}toString(){return No.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var jc,Qh={},Ko=function(){if(jc)return Qh;jc=1;var h={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function a(m){return(m=Math.round(m))<0?0:m>255?255:m}function c(m){return a(m[m.length-1]==="%"?parseFloat(m)/100*255:parseInt(m))}function d(m){return(v=m[m.length-1]==="%"?parseFloat(m)/100:parseFloat(m))<0?0:v>1?1:v;var v}function g(m,v,E){return E<0?E+=1:E>1&&(E-=1),6*E<1?m+(v-m)*E*6:2*E<1?v:3*E<2?m+(v-m)*(2/3-E)*6:m}try{Qh.parseCSSColor=function(m){var v,E=m.replace(/ /g,"").toLowerCase();if(E in h)return h[E].slice();if(E[0]==="#")return E.length===4?(v=parseInt(E.substr(1),16))>=0&&v<=4095?[(3840&v)>>4|(3840&v)>>8,240&v|(240&v)>>4,15&v|(15&v)<<4,1]:null:E.length===7&&(v=parseInt(E.substr(1),16))>=0&&v<=16777215?[(16711680&v)>>16,(65280&v)>>8,255&v,1]:null;var P=E.indexOf("("),L=E.indexOf(")");if(P!==-1&&L+1===E.length){var A=E.substr(0,P),O=E.substr(P+1,L-(P+1)).split(","),N=1;switch(A){case"rgba":if(O.length!==4)return null;N=d(O.pop());case"rgb":return O.length!==3?null:[c(O[0]),c(O[1]),c(O[2]),N];case"hsla":if(O.length!==4)return null;N=d(O.pop());case"hsl":if(O.length!==3)return null;var D=(parseFloat(O[0])%360+360)%360/360,k=d(O[1]),U=d(O[2]),X=U<=.5?U*(k+1):U+k-U*k,Q=2*U-X;return[a(255*g(Q,X,D+1/3)),a(255*g(Q,X,D)),a(255*g(Q,X,D-1/3)),N];default:return null}}return null}}catch{}return Qh}();class Ei{constructor(a,c,d,g=1){this.r=a,this.g=c,this.b=d,this.a=g}static parse(a){if(!a)return;if(a instanceof Ei)return a;if(typeof a!="string")return;const c=Ko.parseCSSColor(a);return c?new Ei(c[0]/255*c[3],c[1]/255*c[3],c[2]/255*c[3],c[3]):void 0}toStringPremultipliedAlpha(){const[a,c,d,g]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(a)},${Math.round(c)},${Math.round(d)},${g})`}toString(){const[a,c,d,g]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*a)},${Math.round(255*c)},${Math.round(255*d)},${g})`}toRenderColor(a){const{r:c,g:d,b:g,a:m}=this;return new oo(a,c,d,g,m)}clone(){return new Ei(this.r,this.g,this.b,this.a)}}class oo{constructor(a,c,d,g,m){if(a){const v=a.image.height,E=v*v;c=m===0?0:c/m*(v-1),d=m===0?0:d/m*(v-1),g=m===0?0:g/m*(v-1);const P=Math.floor(c),L=Math.floor(d),A=Math.floor(g),O=Math.ceil(c),N=Math.ceil(d),D=Math.ceil(g),k=c-P,U=d-L,X=g-A,Q=a.image.data,le=4*(P+L*E+A*v),oe=4*(P+L*E+D*v),re=4*(P+N*E+A*v),me=4*(P+N*E+D*v),Se=4*(O+L*E+A*v),Me=4*(O+L*E+D*v),We=4*(O+N*E+A*v),$e=4*(O+N*E+D*v);if(le<0||$e>=Q.length)throw new Error("out of range");this.r=dr(dr(dr(Q[le],Q[oe],X),dr(Q[re],Q[me],X),U),dr(dr(Q[Se],Q[Me],X),dr(Q[We],Q[$e],X),U),k)/255*m,this.g=dr(dr(dr(Q[le+1],Q[oe+1],X),dr(Q[re+1],Q[me+1],X),U),dr(dr(Q[Se+1],Q[Me+1],X),dr(Q[We+1],Q[$e+1],X),U),k)/255*m,this.b=dr(dr(dr(Q[le+2],Q[oe+2],X),dr(Q[re+2],Q[me+2],X),U),dr(dr(Q[Se+2],Q[Me+2],X),dr(Q[We+2],Q[$e+2],X),U),k)/255*m,this.a=m}else this.r=c,this.g=d,this.b=g,this.a=m}toArray(){const{r:a,g:c,b:d,a:g}=this;return g===0?[0,0,0,0]:[255*a/g,255*c/g,255*d/g,g]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:a,g:c,b:d,a:g}=this,m=Math.min(Math.max(a/g,0),1),v=Math.min(Math.max(c/g,0),1),E=Math.min(Math.max(d/g,0),1),P=Math.min(m,v,E),L=Math.max(m,v,E),A=(P+L)/2;if(P===L)return[0,0,100*A,g];const O=L-P,N=A>.5?O/(2-L-P):O/(L+P);let D=0;return L===m?D=(v-E)/O+(v<E?6:0):L===v?D=(E-m)/O+2:L===E&&(D=(m-v)/O+4),D*=60,[Math.min(Math.max(D,0),360),Math.min(Math.max(100*N,0),100),Math.min(Math.max(100*A,0),100),g]}toArray01(){const{r:a,g:c,b:d,a:g}=this;return g===0?[0,0,0,0]:[a/g,c/g,d/g,g]}toArray01Scaled(a){const{r:c,g:d,b:g,a:m}=this;return m===0?[0,0,0]:[c/m*a,d/m*a,g/m*a]}toArray01PremultipliedAlpha(){const{r:a,g:c,b:d,a:g}=this;return[a,c,d,g]}toArray01Linear(){const{r:a,g:c,b:d,a:g}=this;return g===0?[0,0,0,0]:[Math.pow(a/g,2.2),Math.pow(c/g,2.2),Math.pow(d/g,2.2),g]}}function dr(h,a,c){return h*(1-c)+a*c}function Ru(h,a,c){return h.map((d,g)=>dr(d,a[g],c))}function yi(h){return h*h*h*h*h}Ei.black=new Ei(0,0,0,1),Ei.white=new Ei(1,1,1,1),Ei.transparent=new Ei(0,0,0,0),Ei.red=new Ei(1,0,0,1),Ei.blue=new Ei(0,0,1,1);var ef=Object.freeze({__proto__:null,array:Ru,color:function(h,a,c){return new Ei(dr(h.r,a.r,c),dr(h.g,a.g,c),dr(h.b,a.b,c),dr(h.a,a.a,c))},easeIn:yi,number:dr});function Si(h,...a){for(const c of a)for(const d in c)h[d]=c[d];return h}class js extends Error{constructor(a,c){super(c),this.message=c,this.key=a}}class au{constructor(a,c=[]){this.parent=a,this.bindings={};for(const[d,g]of c)this.bindings[d]=g}concat(a){return new au(this,a)}get(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(`${a} not found in scope.`)}has(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)}}const su={kind:"null"},Jn={kind:"number"},ri={kind:"string"},_i={kind:"boolean"},Fs={kind:"color"},_h={kind:"object"},li={kind:"value"},zo={kind:"collator"},uc={kind:"formatted"},xs={kind:"resolvedImage"};function za(h,a){return{kind:"array",itemType:h,N:a}}function Ta(h){if(h.kind==="array"){const a=Ta(h.itemType);return typeof h.N=="number"?`array<${a}, ${h.N}>`:h.itemType.kind==="value"?"array":`array<${a}>`}return h.kind}const lo=[su,Jn,ri,_i,Fs,uc,_h,za(li),xs];function vh(h,a){if(a.kind==="error")return null;if(h.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!vh(h.itemType,a.itemType))&&(typeof h.N!="number"||h.N===a.N))return null}else{if(h.kind===a.kind)return null;if(h.kind==="value"){for(const c of lo)if(!vh(c,a))return null}}return`Expected ${Ta(h)} but found ${Ta(a)} instead.`}function tf(h,a){return a.some(c=>c.kind===h.kind)}function ou(h,a){return a.some(c=>c==="null"?h===null:c==="array"?Array.isArray(h):c==="object"?h&&!Array.isArray(h)&&typeof h=="object":c===typeof h)}class lu{constructor(a,c,d){this.sensitivity=a?c?"variant":"case":c?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(a,c){return this.collator.compare(a,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Yo{constructor(a,c,d,g,m){this.text=a.normalize?a.normalize():a,this.image=c,this.scale=d,this.fontStack=g,this.textColor=m}}class os{constructor(a){this.sections=a}static fromString(a){return new os([new Yo(a,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(a=>a.text.length!==0||!!a.image&&a.image.hasPrimary())}static factory(a){return a instanceof os?a:os.fromString(a)}toString(){return this.sections.length===0?"":this.sections.map(a=>a.text).join("")}serialize(){const a=["format"];for(const c of this.sections){if(c.image){const g=c.image.getPrimary().id.toString();a.push(["image",g]);continue}a.push(c.text);const d={};c.fontStack&&(d["text-font"]=["literal",c.fontStack.split(",")]),c.scale&&(d["font-scale"]=c.scale),c.textColor&&(d["text-color"]=["rgba"].concat(c.textColor.toRenderColor(null).toArray())),a.push(d)}return a}}class Fc{constructor(a,c={}){if(this.id=No.from(a),this.options=Object.assign({},c),c.transform){const{a:d,b:g,c:m,d:v,e:E,f:P}=c.transform;this.options.transform=new DOMMatrix([d,g,m,v,E,P])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a,b:c,c:d,d:g,e:m,f:v}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a,b:c,c:d,d:g,e:m,f:v}})}static parse(a){let c,d,g,m;try{({name:c,iconsetId:d,params:g,transform:m}=JSON.parse(a)||{})}catch{return null}if(!c)return null;const{a:v,b:E,c:P,d:L,e:A,f:O}=m||{};return new Fc({name:c,iconsetId:d},{params:g,transform:new DOMMatrix([v,E,P,L,A,O])})}scaleSelf(a){return this.options.transform.scaleSelf(a),this}}class ws{constructor(a,c,d,g,m=!1){this.primaryId=No.from(a),this.primaryOptions=c,d&&(this.secondaryId=No.from(d)),this.secondaryOptions=g,this.available=m}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Fc(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Fc(this.secondaryId,this.secondaryOptions):null}static from(a){return typeof a=="string"?ws.build({name:a}):a}static build(a,c,d,g){return!a||typeof a=="object"&&!("name"in a)?null:new ws(a,d,c,g)}}function wl(h,a,c,d){return typeof h=="number"&&h>=0&&h<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof c=="number"&&c>=0&&c<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:`Invalid rgba value [${[h,a,c,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof d=="number"?[h,a,c,d]:[h,a,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Xo(h){if(h===null||typeof h=="string"||typeof h=="boolean"||typeof h=="number"||h instanceof Ei||h instanceof lu||h instanceof os||h instanceof ws)return!0;if(Array.isArray(h)){for(const a of h)if(!Xo(a))return!1;return!0}if(typeof h=="object"){for(const a in h)if(!Xo(h[a]))return!1;return!0}return!1}function qa(h){if(h===null)return su;if(typeof h=="string")return ri;if(typeof h=="boolean")return _i;if(typeof h=="number")return Jn;if(h instanceof Ei)return Fs;if(h instanceof lu)return zo;if(h instanceof os)return uc;if(h instanceof ws)return xs;if(Array.isArray(h)){const a=h.length;let c;for(const d of h){const g=qa(d);if(c){if(c===g)continue;c=li;break}c=g}return za(c||li,a)}return _h}function Us(h){const a=typeof h;return h===null?"":a==="string"||a==="number"||a==="boolean"?String(h):h instanceof Ei?h.toStringPremultipliedAlpha():h instanceof os||h instanceof ws?h.toString():JSON.stringify(h)}class Vl{constructor(a,c){this.type=a,this.value=c}static parse(a,c){if(a.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${a.length-1} instead.`);if(!Xo(a[1]))return c.error("invalid value");const d=a[1];let g=qa(d);const m=c.expectedType;return g.kind!=="array"||g.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(g=m),new Vl(g,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ei?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof os?this.value.serialize():this.value}}class ns{constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}}const Pf={string:ri,number:Jn,boolean:_i,object:_h};class Bo{constructor(a,c){this.type=a,this.args=c}static parse(a,c){if(a.length<2)return c.error("Expected at least one argument.");let d,g=1;const m=a[0];if(m==="array"){let E,P;if(a.length>2){const L=a[1];if(typeof L!="string"||!(L in Pf)||L==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);E=Pf[L],g++}else E=li;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return c.error('The length argument to "array" must be a positive integer literal',2);P=a[2],g++}d=za(E,P)}else d=Pf[m];const v=[];for(;g<a.length;g++){const E=c.parse(a[g],g,li);if(!E)return null;v.push(E)}return new Bo(d,v)}evaluate(a){for(let c=0;c<this.args.length;c++){const d=this.args[c].evaluate(a);if(!vh(this.type,qa(d)))return d;if(c===this.args.length-1)throw new ns(`The expression ${JSON.stringify(this.args[c].serialize())} evaluated to ${Ta(qa(d))} but was expected to be of type ${Ta(this.type)}.`)}return null}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}serialize(){const a=this.type,c=[a.kind];if(a.kind==="array"){const d=a.itemType;if(d.kind==="string"||d.kind==="number"||d.kind==="boolean"){c.push(d.kind);const g=a.N;(typeof g=="number"||this.args.length>1)&&c.push(g)}}return c.concat(this.args.map(d=>d.serialize()))}}class bh{constructor(a){this.type=uc,this.sections=a}static parse(a,c){if(a.length<2)return c.error("Expected at least one argument.");const d=a[1];if(!Array.isArray(d)&&typeof d=="object")return c.error("First argument must be an image or text section.");const g=[];let m=!1;for(let v=1;v<=a.length-1;++v){const E=a[v];if(m&&typeof E=="object"&&!Array.isArray(E)){m=!1;let P=null;if(E["font-scale"]&&(P=c.parseObjectValue(E["font-scale"],v,"font-scale",Jn),!P))return null;let L=null;if(E["text-font"]&&(L=c.parseObjectValue(E["text-font"],v,"text-font",za(ri)),!L))return null;let A=null;if(E["text-color"]&&(A=c.parseObjectValue(E["text-color"],v,"text-color",Fs),!A))return null;const O=g[g.length-1];O.scale=P,O.font=L,O.textColor=A}else{const P=c.parse(a[v],v,li);if(!P)return null;const L=P.type.kind;if(L!=="string"&&L!=="value"&&L!=="null"&&L!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,g.push({content:P,scale:null,font:null,textColor:null})}}return new bh(g)}evaluate(a){return new os(this.sections.map(c=>{const d=c.content.evaluate(a);return qa(d)===xs?new Yo("",d,null,null,null):new Yo(Us(d),null,c.scale?c.scale.evaluate(a):null,c.font?c.font.evaluate(a).join(","):null,c.textColor?c.textColor.evaluate(a):null)}))}eachChild(a){for(const c of this.sections)a(c.content),c.scale&&a(c.scale),c.font&&a(c.font),c.textColor&&a(c.textColor)}outputDefined(){return!1}serialize(){const a=["format"];for(const c of this.sections){a.push(c.content.serialize());const d={};c.scale&&(d["font-scale"]=c.scale.serialize()),c.font&&(d["text-font"]=c.font.serialize()),c.textColor&&(d["text-color"]=c.textColor.serialize()),a.push(d)}return a}}class hc{constructor(a,c,d,g){this._imageWarnHistory={},this.type=xs,this.namePrimary=a,this.nameSecondary=c,d&&(this.paramsPrimary=d.params,this.iconsetIdPrimary=d.iconset?d.iconset.id:void 0),g&&(this.paramsSecondary=g.params,this.iconsetIdSecondary=g.iconset?g.iconset.id:void 0)}static parse(a,c){if(a.length<2)return c.error("Expected two or more arguments.");let d=1;const g=[];function m(){if(d<a.length){const E=c.parse(a[d],d++,ri);return E?(g.push({image:E,options:{}}),!0):(c.error(g.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function v(){if(d<a.length){const P=a[d];if((E=P)===null||typeof E!="object"||Array.isArray(E))return!0;const L=P.params,A=P.iconset,O=c.concat(d);if(!L&&!A)return d++,!0;if(L){if(typeof L!="object"||L.constructor!==Object)return O.error('Image options "params" should be an object'),!1;const N={},D=O.concat(void 0,"params");for(const k in L){if(!k)return D.error("Image parameter name should be non-empty"),!1;const U=D.concat(void 0,k).parse(L[k],void 0,Fs,void 0,{typeAnnotation:"coerce"});if(!U)return!1;N[k]=U}g[g.length-1].options.params=N}if(A){if(typeof A!="object"||A.constructor!==Object)return O.error('Image options "iconset" should be an object'),!1;if(!A.id)return O.error('Image options "iconset" should have an "id" property'),!1;g[g.length-1].options.iconset=A}return d++,!0}var E;return!0}for(let E=0;E<2;E++)if(!m()||!v())return;return new hc(g[0].image,g[1]?g[1].image:void 0,g[0].options,g[1]?g[1].options:void 0)}evaluateParams(a,c){const d={};if(c){for(const g in c)if(c[g])try{d[g]=c[g].evaluate(a)}catch{continue}if(Object.keys(d).length!==0)return{params:d}}}evaluate(a){const c={name:this.namePrimary.evaluate(a),iconsetId:this.iconsetIdPrimary},d=this.nameSecondary?{name:this.nameSecondary.evaluate(a),iconsetId:this.iconsetIdSecondary}:void 0,g=ws.build(c,d,this.paramsPrimary?this.evaluateParams(a,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(a,this.paramsSecondary):void 0);if(g&&a.availableImages){const m=g.getPrimary().id;if(g.available=a.availableImages.some(v=>No.isEqual(v,m)),g.available){const v=g.getSecondary()?g.getSecondary().id:null;v&&(g.available=a.availableImages.some(E=>No.isEqual(E,v)))}}return g}eachChild(a){if(a(this.namePrimary),this.paramsPrimary)for(const c in this.paramsPrimary)this.paramsPrimary[c]&&a(this.paramsPrimary[c]);if(this.nameSecondary&&(a(this.nameSecondary),this.paramsSecondary))for(const c in this.paramsSecondary)this.paramsSecondary[c]&&a(this.paramsSecondary[c])}outputDefined(){return!1}serializeOptions(a,c){const d={};if(c&&(d.iconset={id:c}),a){d.params={};for(const g in a)a[g]&&(d.params[g]=a[g].serialize())}return Object.keys(d).length>0?d:void 0}serialize(){const a=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const c=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);c&&a.push(c)}if(this.nameSecondary&&(a.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const c=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);c&&a.push(c)}return a}}function fc(h){return h instanceof Number?"number":h instanceof String?"string":h instanceof Boolean?"boolean":Array.isArray(h)?"array":h===null?"null":typeof h}const Vd={"to-boolean":_i,"to-color":Fs,"to-number":Jn,"to-string":ri};class $l{constructor(a,c){this.type=a,this.args=c}static parse(a,c){if(a.length<2)return c.error("Expected at least one argument.");const d=a[0],g=[];let m=su;if(d==="to-array"){if(!Array.isArray(a[1]))return null;const v=a[1].length;if(c.expectedType){if(c.expectedType.kind!=="array")return c.error(`Expected ${c.expectedType.kind} but found array.`);m=za(c.expectedType.itemType,v)}else{if(!(v>0&&Xo(a[1][0])))return null;m=za(qa(a[1][0]),v)}for(let E=0;E<v;E++){const P=a[1][E];let L;if(fc(P)==="array")L=c.parse(P,void 0,m.itemType);else{const A=fc(P);if(A!==m.itemType.kind)return c.error(`Expected ${m.itemType.kind} but found ${A}.`);L=c.registry.literal.parse(["literal",P===void 0?null:P],c)}if(!L)return null;g.push(L)}}else{if((d==="to-boolean"||d==="to-string")&&a.length!==2)return c.error("Expected one argument.");m=Vd[d];for(let v=1;v<a.length;v++){const E=c.parse(a[v],v,li);if(!E)return null;g.push(E)}}return new $l(m,g)}evaluate(a){if(this.type.kind==="boolean")return!!this.args[0].evaluate(a);if(this.type.kind==="color"){let c,d;for(const g of this.args){if(c=g.evaluate(a),d=null,c instanceof Ei)return c;if(typeof c=="string"){const m=a.parseColor(c);if(m)return m}else if(Array.isArray(c)&&(d=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:wl(c[0],c[1],c[2],c[3]),!d))return new Ei(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new ns(d||`Could not parse color from value '${typeof c=="string"?c:String(JSON.stringify(c))}'`)}if(this.type.kind==="number"){let c=null;for(const d of this.args){if(c=d.evaluate(a),c===null)return 0;const g=Number(c);if(!isNaN(g))return g}throw new ns(`Could not convert ${JSON.stringify(c)} to number.`)}return this.type.kind==="formatted"?os.fromString(Us(this.args[0].evaluate(a))):this.type.kind==="resolvedImage"?ws.build(Us(this.args[0].evaluate(a))):this.type.kind==="array"?this.args.map(c=>c.evaluate(a)):Us(this.args[0].evaluate(a))}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}serialize(){if(this.type.kind==="formatted")return new bh([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new hc(this.args[0]).serialize();const a=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(c=>{a.push(c.serialize())}),a}}const Dm=["Unknown","Point","LineString","Polygon"];class xh{constructor(a,c){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=a,this.options=c}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Dm[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(a){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const a=this.featureDistanceData.center,c=this.featureDistanceData.scale,{x:d,y:g}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(d*c-a[0])+this.featureDistanceData.bearing[1]*(g*c-a[1])}return 0}parseColor(a){let c=this._parseColorCache[a];return c||(c=this._parseColorCache[a]=Ei.parse(a)),c}getConfig(a){return this.options?this.options.get(a):null}}class qs{constructor(a,c,d,g,m){this.name=a,this.type=c,this._evaluate=d,this.args=g,this._overloadIndex=m}evaluate(a){if(!this._evaluate){const c=qs.definitions[this.name];this._evaluate=Array.isArray(c)?c[2]:c.overloads[this._overloadIndex][1]}return this._evaluate(a,this.args)}eachChild(a){this.args.forEach(a)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(a=>a.serialize()))}static parse(a,c){const d=a[0],g=qs.definitions[d];if(!g)return c.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(g)?g[0]:g.type,v=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,E=[];let P=null,L=-1;for(const[A,O]of v){if(Array.isArray(A)&&A.length!==a.length-1)continue;E.push(A),L++,P=new Yl(c.registry,c.path,null,c.scope,void 0,c._scope,c.options);const N=[];let D=!1;for(let k=1;k<a.length;k++){const U=a[k],X=Array.isArray(A)?A[k-1]:A.type,Q=P.parse(U,1+N.length,X);if(!Q){D=!0;break}N.push(Q)}if(!D)if(Array.isArray(A)&&A.length!==N.length)P.error(`Expected ${A.length} arguments, but found ${N.length} instead.`);else{for(let k=0;k<N.length;k++){const U=Array.isArray(A)?A[k]:A.type,X=N[k];P.concat(k+1).checkSubtype(U,X.type)}if(P.errors.length===0)return new qs(d,m,O,N,L)}}if(E.length===1)c.errors.push(...P.errors);else{const A=(E.length?E:v.map(([N])=>N)).map(hd).join(" | "),O=[];for(let N=1;N<a.length;N++){const D=c.parse(a[N],1+O.length);if(!D)return null;O.push(Ta(D.type))}c.error(`Expected arguments of type ${A}, but found (${O.join(", ")}) instead.`)}return null}static register(a,c){qs.definitions=c;for(const d in c)a[d]=qs}}function hd(h){return Array.isArray(h)?`(${h.map(Ta).join(", ")})`:`(${Ta(h.type)}...)`}class Hl{constructor(a,c,d){this.type=zo,this.locale=d,this.caseSensitive=a,this.diacriticSensitive=c}static parse(a,c){if(a.length!==2)return c.error("Expected one argument.");const d=a[1];if(typeof d!="object"||Array.isArray(d))return c.error("Collator options argument must be an object.");const g=d["case-sensitive"]===void 0?c.parse(!1,1,_i):c.parseObjectValue(d["case-sensitive"],1,"case-sensitive",_i);if(!g)return null;const m=d["diacritic-sensitive"]===void 0?c.parse(!1,1,_i):c.parseObjectValue(d["diacritic-sensitive"],1,"diacritic-sensitive",_i);if(!m)return null;let v=null;return d.locale&&(v=c.parseObjectValue(d.locale,1,"locale",ri),!v)?null:new Hl(g,m,v)}evaluate(a){return new lu(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)}eachChild(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)}outputDefined(){return!1}serialize(){const a={};return a["case-sensitive"]=this.caseSensitive.serialize(),a["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(a.locale=this.locale.serialize()),["collator",a]}}function fd(h,a,c=0,d=h.length-1,g=Ge){for(;d>c;){if(d-c>600){const P=d-c+1,L=a-c+1,A=Math.log(P),O=.5*Math.exp(2*A/3),N=.5*Math.sqrt(A*O*(P-O)/P)*(L-P/2<0?-1:1);fd(h,a,Math.max(c,Math.floor(a-L*O/P+N)),Math.min(d,Math.floor(a+(P-L)*O/P+N)),g)}const m=h[a];let v=c,E=d;for(se(h,c,a),g(h[d],m)>0&&se(h,c,d);v<E;){for(se(h,v,E),v++,E--;g(h[v],m)<0;)v++;for(;g(h[E],m)>0;)E--}g(h[c],m)===0?se(h,c,E):(E++,se(h,E,d)),E<=a&&(c=E+1),a<=E&&(d=E-1)}}function se(h,a,c){const d=h[a];h[a]=h[c],h[c]=d}function Ge(h,a){return h<a?-1:h>a?1:0}function Rt(h){let a=0;for(let c,d,g=0,m=h.length,v=m-1;g<m;v=g++)c=h[g],d=h[v],a+=(d.x-c.x)*(c.y+d.y);return a}function Yt(h,a){h[0]=Math.min(h[0],a[0]),h[1]=Math.min(h[1],a[1]),h[2]=Math.max(h[2],a[0]),h[3]=Math.max(h[3],a[1])}function dn(h,a){return!(h[0]<=a[0]||h[2]>=a[2]||h[1]<=a[1]||h[3]>=a[3])}function kn(h,a,c){const d=h[0]-a[0],g=h[1]-a[1],m=h[0]-c[0],v=h[1]-c[1];return d*v-m*g==0&&d*m<=0&&g*v<=0}function rr(h,a,c=!1){let d=!1;for(let E=0,P=a.length;E<P;E++){const L=a[E];for(let A=0,O=L.length,N=O-1;A<O;N=A++){const D=L[N],k=L[A];if(kn(h,D,k))return c;(m=D)[1]>(g=h)[1]!=(v=k)[1]>g[1]&&g[0]<(v[0]-m[0])*(g[1]-m[1])/(v[1]-m[1])+m[0]&&(d=!d)}}var g,m,v;return d}function wr(h,a,c,d){const g=d[0]-c[0],m=d[1]-c[1],v=(h[0]-c[0])*m-g*(h[1]-c[1]),E=(a[0]-c[0])*m-g*(a[1]-c[1]);return v>0&&E<0||v<0&&E>0}function Wr(h,a,c,d){return(g=[d[0]-c[0],d[1]-c[1]])[0]*(m=[a[0]-h[0],a[1]-h[1]])[1]-g[1]*m[0]!=0&&!(!wr(h,a,c,d)||!wr(c,d,h,a));var g,m}const Ai=8192;function Pi(h,a){const c=(180+h[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h[1]*Math.PI/360)))/360,g=Math.pow(2,a.z);return[Math.round(c*g*Ai),Math.round(d*g*Ai)]}function pa(h,a){for(let c=0;c<a.length;c++)if(rr(h,a[c]))return!0;return!1}function Ss(h,a,c){for(const d of c)for(let g=0,m=d.length,v=m-1;g<m;v=g++)if(Wr(h,a,d[v],d[g]))return!0;return!1}function As(h,a){for(let c=0;c<h.length;++c)if(!rr(h[c],a))return!1;for(let c=0;c<h.length-1;++c)if(Ss(h[c],h[c+1],a))return!1;return!0}function Xs(h,a){for(let c=0;c<a.length;c++)if(As(h,a[c]))return!0;return!1}function Ja(h,a,c){const d=[];for(let g=0;g<h.length;g++){const m=[];for(let v=0;v<h[g].length;v++){const E=Pi(h[g][v],c);Yt(a,E),m.push(E)}d.push(m)}return d}function Mr(h,a,c){const d=[];for(let g=0;g<h.length;g++){const m=Ja(h[g],a,c);d.push(m)}return d}function sr(h,a,c,d){if(h[0]<c[0]||h[0]>c[2]){const g=.5*d;let m=h[0]-c[0]>g?-d:c[0]-h[0]>g?d:0;m===0&&(m=h[0]-c[2]>g?-d:c[2]-h[0]>g?d:0),h[0]+=m}Yt(a,h)}function ul(h,a,c,d){const g=Math.pow(2,d.z)*Ai,m=[d.x*Ai,d.y*Ai],v=[];if(!h)return v;for(const E of h)for(const P of E){const L=[P.x+m[0],P.y+m[1]];sr(L,a,c,g),v.push(L)}return v}function Sr(h,a,c,d){const g=Math.pow(2,d.z)*Ai,m=[d.x*Ai,d.y*Ai],v=[];if(!h)return v;for(const P of h){const L=[];for(const A of P){const O=[A.x+m[0],A.y+m[1]];Yt(a,O),L.push(O)}v.push(L)}if(a[2]-a[0]<=g/2){(E=a)[0]=E[1]=1/0,E[2]=E[3]=-1/0;for(const P of v)for(const L of P)sr(L,a,c,g)}var E;return v}class dc{constructor(a,c){this.type=_i,this.geojson=a,this.geometries=c}static parse(a,c){if(a.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${a.length-1} instead.`);if(Xo(a[1])){const d=a[1];if(d.type==="FeatureCollection")for(let g=0;g<d.features.length;++g){const m=d.features[g].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new dc(d,d.features[g].geometry)}else if(d.type==="Feature"){const g=d.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new dc(d,d.geometry)}else if(d.type==="Polygon"||d.type==="MultiPolygon")return new dc(d,d)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(c,d){const g=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],v=c.canonicalID();if(!v)return!1;if(d.type==="Polygon"){const E=Ja(d.coordinates,m,v),P=ul(c.geometry(),g,m,v);if(!dn(g,m))return!1;for(const L of P)if(!rr(L,E))return!1}if(d.type==="MultiPolygon"){const E=Mr(d.coordinates,m,v),P=ul(c.geometry(),g,m,v);if(!dn(g,m))return!1;for(const L of P)if(!pa(L,E))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(c,d){const g=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],v=c.canonicalID();if(!v)return!1;if(d.type==="Polygon"){const E=Ja(d.coordinates,m,v),P=Sr(c.geometry(),g,m,v);if(!dn(g,m))return!1;for(const L of P)if(!As(L,E))return!1}if(d.type==="MultiPolygon"){const E=Mr(d.coordinates,m,v),P=Sr(c.geometry(),g,m,v);if(!dn(g,m))return!1;for(const L of P)if(!Xs(L,E))return!1}return!0}(a,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Gl={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},br=1/298.257223563,nf=br*(2-br),Wl=Math.PI/180;class cu{static fromTile(a,c,d){const g=Math.PI*(1-2*(a+.5)/Math.pow(2,c)),m=Math.atan(.5*(Math.exp(g)-Math.exp(-g)))/Wl;return new cu(m,d)}static get units(){return Gl}constructor(a,c){if(a===void 0)throw new Error("No latitude given.");if(c&&!Gl[c])throw new Error(`Unknown unit ${c}. Use one of: ${Object.keys(Gl).join(", ")}`);const d=6378.137*Wl*(c?Gl[c]:1),g=Math.cos(a*Wl),m=1/(1-nf*(1-g*g)),v=Math.sqrt(m);this.kx=d*v*g,this.ky=d*v*m*(1-nf)}distance(a,c){const d=ya(a[0]-c[0])*this.kx,g=(a[1]-c[1])*this.ky;return Math.sqrt(d*d+g*g)}bearing(a,c){const d=ya(c[0]-a[0])*this.kx;return Math.atan2(d,(c[1]-a[1])*this.ky)/Wl}destination(a,c,d){const g=d*Wl;return this.offset(a,Math.sin(g)*c,Math.cos(g)*c)}offset(a,c,d){return[a[0]+c/this.kx,a[1]+d/this.ky]}lineDistance(a){let c=0;for(let d=0;d<a.length-1;d++)c+=this.distance(a[d],a[d+1]);return c}area(a){let c=0;for(let d=0;d<a.length;d++){const g=a[d];for(let m=0,v=g.length,E=v-1;m<v;E=m++)c+=ya(g[m][0]-g[E][0])*(g[m][1]+g[E][1])*(d?-1:1)}return Math.abs(c)/2*this.kx*this.ky}along(a,c){let d=0;if(c<=0)return a[0];for(let g=0;g<a.length-1;g++){const m=a[g],v=a[g+1],E=this.distance(m,v);if(d+=E,d>c)return Ts(m,v,(c-(d-E))/E)}return a[a.length-1]}pointToSegmentDistance(a,c,d){let[g,m]=c,v=ya(d[0]-g)*this.kx,E=(d[1]-m)*this.ky;if(v!==0||E!==0){const P=(ya(a[0]-g)*this.kx*v+(a[1]-m)*this.ky*E)/(v*v+E*E);P>1?(g=d[0],m=d[1]):P>0&&(g+=v/this.kx*P,m+=E/this.ky*P)}return v=ya(a[0]-g)*this.kx,E=(a[1]-m)*this.ky,Math.sqrt(v*v+E*E)}pointOnLine(a,c){let d=1/0,g=a[0][0],m=a[0][1],v=0,E=0;for(let P=0;P<a.length-1;P++){let L=a[P][0],A=a[P][1],O=ya(a[P+1][0]-L)*this.kx,N=(a[P+1][1]-A)*this.ky,D=0;O===0&&N===0||(D=(ya(c[0]-L)*this.kx*O+(c[1]-A)*this.ky*N)/(O*O+N*N),D>1?(L=a[P+1][0],A=a[P+1][1]):D>0&&(L+=O/this.kx*D,A+=N/this.ky*D)),O=ya(c[0]-L)*this.kx,N=(c[1]-A)*this.ky;const k=O*O+N*N;k<d&&(d=k,g=L,m=A,v=P,E=D)}return{point:[g,m],index:v,t:Math.max(0,Math.min(1,E))}}lineSlice(a,c,d){let g=this.pointOnLine(d,a),m=this.pointOnLine(d,c);if(g.index>m.index||g.index===m.index&&g.t>m.t){const L=g;g=m,m=L}const v=[g.point],E=g.index+1,P=m.index;!wh(d[E],v[0])&&E<=P&&v.push(d[E]);for(let L=E+1;L<=P;L++)v.push(d[L]);return wh(d[P],m.point)||v.push(m.point),v}lineSliceAlong(a,c,d){let g=0;const m=[];for(let v=0;v<d.length-1;v++){const E=d[v],P=d[v+1],L=this.distance(E,P);if(g+=L,g>a&&m.length===0&&m.push(Ts(E,P,(a-(g-L))/L)),g>=c)return m.push(Ts(E,P,(c-(g-L))/L)),m;g>a&&m.push(P)}return m}bufferPoint(a,c){const d=c/this.ky,g=c/this.kx;return[a[0]-g,a[1]-d,a[0]+g,a[1]+d]}bufferBBox(a,c){const d=c/this.ky,g=c/this.kx;return[a[0]-g,a[1]-d,a[2]+g,a[3]+d]}insideBBox(a,c){return ya(a[0]-c[0])>=0&&ya(a[0]-c[2])<=0&&a[1]>=c[1]&&a[1]<=c[3]}}function wh(h,a){return h[0]===a[0]&&h[1]===a[1]}function Ts(h,a,c){const d=ya(a[0]-h[0]);return[h[0]+d*c,h[1]+(a[1]-h[1])*c]}function ya(h){for(;h<-180;)h+=360;for(;h>180;)h-=360;return h}class uu{constructor(a=[],c=(d,g)=>d<g?-1:d>g?1:0){if(this.data=a,this.length=this.data.length,this.compare=c,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(a){this.data.push(a),this._up(this.length++)}pop(){if(this.length===0)return;const a=this.data[0],c=this.data.pop();return--this.length>0&&(this.data[0]=c,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:c,compare:d}=this,g=c[a];for(;a>0;){const m=a-1>>1,v=c[m];if(d(g,v)>=0)break;c[a]=v,a=m}c[a]=g}_down(a){const{data:c,compare:d}=this,g=this.length>>1,m=c[a];for(;a<g;){let v=1+(a<<1);const E=v+1;if(E<this.length&&d(c[E],c[v])<0&&(v=E),d(c[v],m)>=0)break;c[a]=c[v],a=v}c[a]=m}}var On=8192;function Sh(h,a){return a.dist-h.dist}const Vs=100,co=50;function dd(h){const a=[1/0,1/0,-1/0,-1/0];if(a.length!==h.length)return!1;for(let c=0;c<a.length;c++)if(a[c]!==h[c])return!1;return!0}function Of(h){return h[1]-h[0]+1}function uo(h,a){const c=h[1]>=h[0]&&h[1]<a;return c||console.warn("Distance Expression: Index is out of range"),c}function Rs(h,a){if(h[0]>h[1])return[null,null];const c=Of(h);if(a){if(c===2)return[h,null];const d=Math.floor(c/2);return[[h[0],h[0]+d],[h[0]+d,h[1]]]}{if(c===1)return[h,null];const d=Math.floor(c/2)-1;return[[h[0],h[0]+d],[h[0]+d+1,h[1]]]}}function Sl(h,a){const c=[1/0,1/0,-1/0,-1/0];if(!uo(a,h.length))return c;for(let d=a[0];d<=a[1];++d)Yt(c,h[d]);return c}function Du(h){const a=[1/0,1/0,-1/0,-1/0];for(let c=0;c<h.length;++c)for(let d=0;d<h[c].length;++d)Yt(a,h[c][d]);return a}function Kl(h,a,c){if(dd(h)||dd(a))return NaN;let d=0,g=0;return h[2]<a[0]&&(d=a[0]-h[2]),h[0]>a[2]&&(d=h[0]-a[2]),h[1]>a[3]&&(g=h[1]-a[3]),h[3]<a[1]&&(g=a[1]-h[3]),c.distance([0,0],[d,g])}function rf(h){return 360*h-180}function Al(h){return 360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90}function xo(h,a){const c=Math.pow(2,a.z),d=(h.y/On+a.y)/c;return[rf((h.x/On+a.x)/c),Al(d)]}function Ah(h,a){const c=[];for(let d=0;d<h.length;++d)c.push(xo(h[d],a));return c}function Lu(h,a,c){const d=c.pointOnLine(a,h).point;return c.distance(h,d)}function Tl(h,a,c,d,g){const m=c.slice(d[0],d[1]+1);let v=1/0;for(let E=a[0];E<=a[1];++E)if((v=Math.min(v,Lu(h[E],m,g)))===0)return 0;return v}function hu(h,a,c,d,g){const m=Math.min(g.pointToSegmentDistance(h,c,d),g.pointToSegmentDistance(a,c,d)),v=Math.min(g.pointToSegmentDistance(c,h,a),g.pointToSegmentDistance(d,h,a));return Math.min(m,v)}function pc(h,a,c,d,g){if(!uo(a,h.length)||!uo(d,c.length))return NaN;let m=1/0;for(let v=a[0];v<a[1];++v)for(let E=d[0];E<d[1];++E){if(Wr(h[v],h[v+1],c[E],c[E+1]))return 0;m=Math.min(m,hu(h[v],h[v+1],c[E],c[E+1],g))}return m}function Va(h,a,c,d,g){if(!uo(a,h.length)||!uo(d,c.length))return NaN;let m=1/0;for(let v=a[0];v<=a[1];++v)for(let E=d[0];E<=d[1];++E)if((m=Math.min(m,g.distance(h[v],c[E])))===0)return m;return m}function pd(h,a,c){if(rr(h,a,!0))return 0;let d=1/0;for(const g of a){const m=g.length;if(m<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(g[0]!==g[m-1]&&(d=Math.min(d,c.pointToSegmentDistance(h,g[m-1],g[0])))===0||(d=Math.min(d,Lu(h,g,c)))===0)return d}return d}function Zs(h,a,c,d){if(!uo(a,h.length))return NaN;for(let m=a[0];m<=a[1];++m)if(rr(h[m],c,!0))return 0;let g=1/0;for(let m=a[0];m<a[1];++m)for(const v of c)for(let E=0,P=v.length,L=P-1;E<P;L=E++){if(Wr(h[m],h[m+1],v[L],v[E]))return 0;g=Math.min(g,hu(h[m],h[m+1],v[L],v[E],d))}return g}function ho(h,a){for(const c of h)for(let d=0;d<=c.length-1;++d)if(rr(c[d],a,!0))return!0;return!1}function Th(h,a,c,d=1/0){const g=Du(h),m=Du(a);if(d!==1/0&&Kl(g,m,c)>=d)return d;if(dn(g,m)){if(ho(h,a))return 0}else if(ho(a,h))return 0;let v=d;for(const E of h)for(let P=0,L=E.length,A=L-1;P<L;A=P++)for(const O of a)for(let N=0,D=O.length,k=D-1;N<D;k=N++){if(Wr(E[A],E[P],O[k],O[N]))return 0;v=Math.min(v,hu(E[A],E[P],O[k],O[N],c))}return v}function Eh(h,a,c,d,g,m,v){if(m===null||v===null)return;const E=Kl(Sl(d,m),Sl(g,v),c);E<a&&h.push({dist:E,range1:m,range2:v})}function Js(h,a,c,d,g=1/0){let m=Math.min(d.distance(h[0],c[0][0]),g);if(m===0)return m;const v=new uu([{dist:0,range1:[0,h.length-1],range2:[0,0]}],Sh),E=a?co:Vs,P=Du(c);for(;v.length;){const L=v.pop();if(L.dist>=m)continue;const A=L.range1;if(Of(A)<=E){if(!uo(A,h.length))return NaN;if(a){const O=Zs(h,A,c,d);if((m=Math.min(m,O))===0)return m}else for(let O=A[0];O<=A[1];++O){const N=pd(h[O],c,d);if((m=Math.min(m,N))===0)return m}}else{const O=Rs(A,a);if(O[0]!==null){const N=Kl(Sl(h,O[0]),P,d);N<m&&v.push({dist:N,range1:O[0],range2:[0,0]})}if(O[1]!==null){const N=Kl(Sl(h,O[1]),P,d);N<m&&v.push({dist:N,range1:O[1],range2:[0,0]})}}}return m}function ku(h,a,c,d,g,m=1/0){let v=Math.min(m,g.distance(h[0],c[0]));if(v===0)return v;const E=new uu([{dist:0,range1:[0,h.length-1],range2:[0,c.length-1]}],Sh),P=a?co:Vs,L=d?co:Vs;for(;E.length;){const A=E.pop();if(A.dist>=v)continue;const O=A.range1,N=A.range2;if(Of(O)<=P&&Of(N)<=L){if(!uo(O,h.length)||!uo(N,c.length))return NaN;if(a&&d?v=Math.min(v,pc(h,O,c,N,g)):a||d?a&&!d?v=Math.min(v,Tl(c,N,h,O,g)):!a&&d&&(v=Math.min(v,Tl(h,O,c,N,g))):v=Math.min(v,Va(h,O,c,N,g)),v===0)return v}else{const D=Rs(O,a),k=Rs(N,d);Eh(E,v,g,h,c,D[0],k[0]),Eh(E,v,g,h,c,D[0],k[1]),Eh(E,v,g,h,c,D[1],k[0]),Eh(E,v,g,h,c,D[1],k[1])}}return v}function fu(h,a,c,d,g=1/0){let m=g;const v=Sl(h,[0,h.length-1]);for(const E of c)if(!(m!==1/0&&Kl(v,Sl(E,[0,E.length-1]),d)>=m)&&(m=Math.min(m,ku(h,a,E,!0,d,m)),m===0))return m;return m}function mc(h,a,c,d,g=1/0){let m=g;const v=Sl(h,[0,h.length-1]);for(const E of c){if(m!==1/0&&Kl(v,Du(E),d)>=m)continue;const P=Js(h,a,E,d,m);if(isNaN(P))return P;if((m=Math.min(m,P))===0)return m}return m}function Nu(h){return h==="Point"||h==="MultiPoint"||h==="LineString"||h==="MultiLineString"||h==="Polygon"||h==="MultiPolygon"}class gc{constructor(a,c){this.type=Jn,this.geojson=a,this.geometries=c}static parse(a,c){if(a.length!==2)return c.error(`'distance' expression requires either one argument, but found ' ${a.length-1} instead.`);if(Xo(a[1])){const d=a[1];if(d.type==="FeatureCollection"){for(let g=0;g<d.features.length;++g)if(Nu(d.features[g].geometry.type))return new gc(d,d.features[g].geometry)}else if(d.type==="Feature"){if(Nu(d.geometry.type))return new gc(d,d.geometry)}else if(Nu(d.type))return new gc(d,d)}return c.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(a){const c=a.geometry(),d=a.canonicalID();if(c!=null&&d!=null){if(a.geometryType()==="Point")return function(g,m,v){const E=[];for(const L of g)for(const A of L)E.push(xo(A,m));const P=new cu(E[0][1],"meters");return v.type==="Point"||v.type==="MultiPoint"||v.type==="LineString"?ku(E,!1,v.type==="Point"?[v.coordinates]:v.coordinates,v.type==="LineString",P):v.type==="MultiLineString"?fu(E,!1,v.coordinates,P):v.type==="Polygon"||v.type==="MultiPolygon"?mc(E,!1,v.type==="Polygon"?[v.coordinates]:v.coordinates,P):null}(c,d,this.geometries);if(a.geometryType()==="LineString")return function(g,m,v){const E=[];for(const L of g){const A=[];for(const O of L)A.push(xo(O,m));E.push(A)}const P=new cu(E[0][0][1],"meters");if(v.type==="Point"||v.type==="MultiPoint"||v.type==="LineString")return fu(v.type==="Point"?[v.coordinates]:v.coordinates,v.type==="LineString",E,P);if(v.type==="MultiLineString"){let L=1/0;for(let A=0;A<v.coordinates.length;A++){const O=fu(v.coordinates[A],!0,E,P,L);if(isNaN(O))return O;if((L=Math.min(L,O))===0)return L}return L}if(v.type==="Polygon"||v.type==="MultiPolygon"){let L=1/0;for(let A=0;A<E.length;A++){const O=mc(E[A],!0,v.type==="Polygon"?[v.coordinates]:v.coordinates,P,L);if(isNaN(O))return O;if((L=Math.min(L,O))===0)return L}return L}return null}(c,d,this.geometries);if(a.geometryType()==="Polygon")return function(g,m,v){const E=[];for(const L of function(A,O){const N=A.length;if(N<=1)return[A];const D=[];let k,U;for(let X=0;X<N;X++){const Q=Rt(A[X]);Q!==0&&(A[X].area=Math.abs(Q),U===void 0&&(U=Q<0),U===Q<0?(k&&D.push(k),k=[A[X]]):k.push(A[X]))}return k&&D.push(k),D}(g)){const A=[];for(let O=0;O<L.length;++O)A.push(Ah(L[O],m));E.push(A)}const P=new cu(E[0][0][0][1],"meters");if(v.type==="Point"||v.type==="MultiPoint"||v.type==="LineString")return mc(v.type==="Point"?[v.coordinates]:v.coordinates,v.type==="LineString",E,P);if(v.type==="MultiLineString"){let L=1/0;for(let A=0;A<v.coordinates.length;A++){const O=mc(v.coordinates[A],!0,E,P,L);if(isNaN(O))return O;if((L=Math.min(L,O))===0)return L}return L}return v.type==="Polygon"||v.type==="MultiPolygon"?function(L,A,O){let N=1/0;for(const D of L)for(const k of A){const U=Th(D,k,O,N);if(isNaN(U))return U;if((N=Math.min(N,U))===0)return N}return N}(v.type==="Polygon"?[v.coordinates]:v.coordinates,E,P):null}(c,d,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function zu(h,a){switch(h){case"string":return Us(a);case"number":return+a;case"boolean":return!!a;case"color":return Ei.parse(a);case"formatted":return os.fromString(Us(a));case"resolvedImage":return ws.build(Us(a))}return a}function du(h,a,c,d){return d!==void 0&&(h=d*Math.round(h/d)),a!==void 0&&h<a&&(h=a),c!==void 0&&h>c&&(h=c),h}class Uc{constructor(a,c,d){this.type=a,this.key=c,this.scope=d}static parse(a,c){let d=c.expectedType;if(d==null&&(d=li),a.length<2||a.length>3)return c.error("Invalid number of arguments for 'config' expression.");const g=c.parse(a[1],1);if(!(g instanceof Vl))return c.error("Key name of 'config' expression must be a string literal.");if(a.length>=3){const m=c.parse(a[2],2);return m instanceof Vl?new Uc(d,Us(g.value),Us(m.value)):c.error("Scope of 'config' expression must be a string literal.")}return new Uc(d,Us(g.value))}evaluate(a){const c=[this.key,this.scope,a.scope].filter(Boolean).join(""),d=a.getConfig(c);if(!d)return null;const{type:g,value:m,values:v,minValue:E,maxValue:P,stepValue:L}=d,A=d.default.evaluate(a);let O=A;if(m){const N=a.scope;a.scope=(N||"").split("").slice(1).join(""),O=m.evaluate(a),a.scope=N}return g&&(O=zu(g,O)),O===void 0||E===void 0&&P===void 0&&L===void 0||(typeof O=="number"?O=du(O,E,P,L):Array.isArray(O)&&(O=O.map(N=>typeof N=="number"?du(N,E,P,L):N))),m!==void 0&&O!==void 0&&v&&!v.includes(O)&&(O=A,g&&(O=zu(g,O))),(g&&g!==this.type||O!==void 0&&qa(O)!==this.type)&&(O=zu(this.type.kind,O)),O}eachChild(){}outputDefined(){return!1}serialize(){const a=["config",this.key];return this.scope&&a.concat(this.key),a}}function jo(h){if(h instanceof qs&&(h.name==="get"&&h.args.length===1||h.name==="feature-state"||h.name==="has"&&h.args.length===1||h.name==="properties"||h.name==="geometry-type"||h.name==="id"||/^filter-/.test(h.name))||h instanceof dc||h instanceof gc)return!1;let a=!0;return h.eachChild(c=>{a&&!jo(c)&&(a=!1)}),a}function ls(h){if(h instanceof qs&&h.name==="feature-state")return!1;let a=!0;return h.eachChild(c=>{a&&!ls(c)&&(a=!1)}),a}function Yi(h){if(h instanceof Uc)return new Set([h.key]);let a=new Set;return h.eachChild(c=>{a=new Set([...a,...Yi(c)])}),a}function ea(h,a){if(h instanceof qs&&a.indexOf(h.name)>=0)return!1;let c=!0;return h.eachChild(d=>{c&&!ea(d,a)&&(c=!1)}),c}class $a{constructor(a,c){this.type=c.type,this.name=a,this.boundExpression=c}static parse(a,c){if(a.length!==2||typeof a[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const d=a[1];return c.scope.has(d)?new $a(d,c.scope.get(d)):c.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(a){return this.boundExpression.evaluate(a)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class rs{constructor(a,c=[],d,g=new au,m=[],v,E){this.registry=a,this.path=c,this.key=c.map(P=>typeof P=="string"?`['${P}']`:`[${P}]`).join(""),this.scope=g,this.errors=m,this.expectedType=d,this._scope=v,this.options=E}parse(a,c,d,g,m={}){return c||d?this.concat(c,null,d,g)._parse(a,m):this._parse(a,m)}parseObjectValue(a,c,d,g,m,v={}){return this.concat(c,d,g,m)._parse(a,v)}_parse(a,c){function d(g,m,v){return v==="assert"?new Bo(m,[g]):v==="coerce"?new $l(m,[g]):g}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=typeof a[0]=="string"?this.registry[a[0]]:void 0;if(g){let m=g.parse(a,this);if(!m)return null;if(this.expectedType){const v=this.expectedType,E=m.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||E.kind!=="value")if(v.kind!=="color"&&v.kind!=="formatted"&&v.kind!=="resolvedImage"||E.kind!=="value"&&E.kind!=="string"){if(this.checkSubtype(v,E))return null}else m=d(m,v,c.typeAnnotation||"coerce");else m=d(m,v,c.typeAnnotation||"assert")}if(!(m instanceof Vl)&&m.type.kind!=="resolvedImage"&&Bu(m)){const v=new xh(this._scope,this.options);try{m=new Vl(m.type,m.evaluate(v))}catch(E){return this.error(E.message),null}}return m}return $l.parse(["to-array",a],this)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof a} instead.`)}concat(a,c,d,g){let m=typeof a=="number"?this.path.concat(a):this.path;m=typeof c=="string"?m.concat(c):m;const v=g?this.scope.concat(g):this.scope;return new rs(this.registry,m,d||null,v,this.errors,this._scope,this.options)}error(a,...c){const d=`${this.key}${c.map(g=>`[${g}]`).join("")}`;this.errors.push(new js(d,a))}checkSubtype(a,c){const d=vh(a,c);return d&&this.error(d),d}}var Yl=rs;function Bu(h){if(h instanceof $a)return Bu(h.boundExpression);if(h instanceof qs&&h.name==="error"||h instanceof Hl||h instanceof dc||h instanceof gc||h instanceof Uc)return!1;const a=h instanceof $l||h instanceof Bo;let c=!0;return h.eachChild(d=>{c=a?c&&Bu(d):c&&d instanceof Vl}),!!c&&jo(h)&&ea(h,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Zo(h,a){const c=h.length-1;let d,g,m=0,v=c,E=0;for(;m<=v;)if(E=Math.floor((m+v)/2),d=h[E],g=h[E+1],d<=a){if(E===c||a<g)return E;m=E+1}else{if(!(d>a))throw new ns("Input is not a number.");v=E-1}return 0}class Xl{constructor(a,c,d){this.type=a,this.input=c,this.labels=[],this.outputs=[];for(const[g,m]of d)this.labels.push(g),this.outputs.push(m)}static parse(a,c){if(a.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return c.error("Expected an even number of arguments.");const d=c.parse(a[1],1,Jn);if(!d)return null;const g=[];let m=null;c.expectedType&&c.expectedType.kind!=="value"&&(m=c.expectedType);for(let v=1;v<a.length;v+=2){const E=v===1?-1/0:a[v],P=a[v+1],L=v,A=v+1;if(typeof E!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(g.length&&g[g.length-1][0]>=E)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',L);const O=c.parse(P,A,m);if(!O)return null;m=m||O.type,g.push([E,O])}return new Xl(m,d,g)}evaluate(a){const c=this.labels,d=this.outputs;if(c.length===1)return d[0].evaluate(a);const g=this.input.evaluate(a);if(g<=c[0])return d[0].evaluate(a);const m=c.length;return g>=c[m-1]?d[m-1].evaluate(a):d[Zo(c,g)].evaluate(a)}eachChild(a){a(this.input);for(const c of this.outputs)a(c)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}serialize(){const a=["step",this.input.serialize()];for(let c=0;c<this.labels.length;c++)c>0&&a.push(this.labels[c]),a.push(this.outputs[c].serialize());return a}}const ni=.95047,ju=1.08883,El=4/29,Qa=6/29,pu=3*Qa*Qa,Mh=Qa*Qa*Qa,ua=Math.PI/180,Rf=180/Math.PI;function Jo(h){return h>Mh?Math.pow(h,1/3):h/pu+El}function hl(h){return h>Qa?h*h*h:pu*(h-El)}function Fu(h){return 255*(h<=.0031308?12.92*h:1.055*Math.pow(h,1/2.4)-.055)}function yc(h){return(h/=255)<=.04045?h/12.92:Math.pow((h+.055)/1.055,2.4)}function qc(h){const a=yc(h.r),c=yc(h.g),d=yc(h.b),g=Jo((.4124564*a+.3575761*c+.1804375*d)/ni),m=Jo((.2126729*a+.7151522*c+.072175*d)/1);return{l:116*m-16,a:500*(g-m),b:200*(m-Jo((.0193339*a+.119192*c+.9503041*d)/ju)),alpha:h.a}}function mu(h){let a=(h.l+16)/116,c=isNaN(h.a)?a:a+h.a/500,d=isNaN(h.b)?a:a-h.b/200;return a=1*hl(a),c=ni*hl(c),d=ju*hl(d),new Ei(Fu(3.2404542*c-1.5371385*a-.4985314*d),Fu(-.969266*c+1.8760108*a+.041556*d),Fu(.0556434*c-.2040259*a+1.0572252*d),h.alpha)}function Np(h,a,c){const d=a-h;return h+c*(d>180||d<-180?d-360*Math.round(d/360):d)}const Df={forward:qc,reverse:mu,interpolate:function(h,a,c){return{l:dr(h.l,a.l,c),a:dr(h.a,a.a,c),b:dr(h.b,a.b,c),alpha:dr(h.alpha,a.alpha,c)}}},Lf={forward:function(h){const{l:a,a:c,b:d}=qc(h),g=Math.atan2(d,c)*Rf;return{h:g<0?g+360:g,c:Math.sqrt(c*c+d*d),l:a,alpha:h.a}},reverse:function(h){const a=h.h*ua,c=h.c;return mu({l:h.l,a:Math.cos(a)*c,b:Math.sin(a)*c,alpha:h.alpha})},interpolate:function(h,a,c){return{h:Np(h.h,a.h,c),c:dr(h.c,a.c,c),l:dr(h.l,a.l,c),alpha:dr(h.alpha,a.alpha,c)}}};var Qo=Object.freeze({__proto__:null,hcl:Lf,lab:Df});class Ha{constructor(a,c,d,g,m){this.type=a,this.operator=c,this.interpolation=d,this.input=g,this.labels=[],this.outputs=[];for(const[v,E]of m)this.labels.push(v),this.outputs.push(E)}static interpolationFactor(a,c,d,g){let m=0;if(a.name==="exponential")m=_a(c,a.base,d,g);else if(a.name==="linear")m=_a(c,1,d,g);else if(a.name==="cubic-bezier"){const v=a.controlPoints;m=new Kt(v[0],v[1],v[2],v[3]).solve(_a(c,1,d,g))}return m}static parse(a,c){let[d,g,m,...v]=a;if(!Array.isArray(g)||g.length===0)return c.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const L=g[1];if(typeof L!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:L}}else{if(g[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const L=g.slice(1);if(L.length!==4||L.some(A=>typeof A!="number"||A<0||A>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:L}}}if(a.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if(a.length-1>3&&(a.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(m=c.parse(m,2,Jn),!m)return null;const E=[];let P=null;d==="interpolate-hcl"||d==="interpolate-lab"?P=Fs:c.expectedType&&c.expectedType.kind!=="value"&&(P=c.expectedType);for(let L=0;L<v.length;L+=2){const A=v[L],O=v[L+1],N=L+3,D=L+4;if(typeof A!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(E.length&&E[E.length-1][0]>=A)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',N);const k=c.parse(O,D,P);if(!k)return null;P=P||k.type,E.push([A,k])}return P.kind==="number"||P.kind==="color"||P.kind==="array"&&P.itemType.kind==="number"&&typeof P.N=="number"?new Ha(P,d,g,m,E):c.error(`Type ${Ta(P)} is not interpolatable.`)}evaluate(a){const c=this.labels,d=this.outputs;if(c.length===1)return d[0].evaluate(a);const g=this.input.evaluate(a);if(g<=c[0])return d[0].evaluate(a);const m=c.length;if(g>=c[m-1])return d[m-1].evaluate(a);const v=Zo(c,g),E=Ha.interpolationFactor(this.interpolation,g,c[v],c[v+1]),P=d[v].evaluate(a),L=d[v+1].evaluate(a);return this.operator==="interpolate"?ef[this.type.kind.toLowerCase()](P,L,E):this.operator==="interpolate-hcl"?Lf.reverse(Lf.interpolate(Lf.forward(P),Lf.forward(L),E)):Df.reverse(Df.interpolate(Df.forward(P),Df.forward(L),E))}eachChild(a){a(this.input);for(const c of this.outputs)a(c)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}serialize(){let a;a=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const c=[this.operator,a,this.input.serialize()];for(let d=0;d<this.labels.length;d++)c.push(this.labels[d],this.outputs[d].serialize());return c}}function _a(h,a,c,d){const g=d-c,m=h-c;return g===0?0:a===1?m/g:(Math.pow(a,m)-1)/(Math.pow(a,g)-1)}class Zl{constructor(a,c){this.type=a,this.args=c}static parse(a,c){if(a.length<2)return c.error("Expectected at least one argument.");let d=null;const g=c.expectedType;g&&g.kind!=="value"&&(d=g);const m=[];for(const E of a.slice(1)){const P=c.parse(E,1+m.length,d,void 0,{typeAnnotation:"omit"});if(!P)return null;d=d||P.type,m.push(P)}const v=g&&m.some(E=>vh(g,E.type));return new Zl(v?li:d,m)}evaluate(a){let c,d=null,g=0;for(const m of this.args){if(g++,d=m.evaluate(a),d&&d instanceof ws&&!d.available&&(c||(c=d),d=null,g===this.args.length))return c;if(d!==null)break}return d}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}serialize(){const a=["coalesce"];return this.eachChild(c=>{a.push(c.serialize())}),a}}class _c{constructor(a,c){this.type=c.type,this.bindings=[].concat(a),this.result=c}evaluate(a){return this.result.evaluate(a)}eachChild(a){for(const c of this.bindings)a(c[1]);a(this.result)}static parse(a,c){if(a.length<4)return c.error(`Expected at least 3 arguments, but found ${a.length-1} instead.`);const d=[];for(let m=1;m<a.length-1;m+=2){const v=a[m];if(typeof v!="string")return c.error(`Expected string, but found ${typeof v} instead.`,m);if(/[^a-zA-Z0-9_]/.test(v))return c.error("Variable names must contain only alphanumeric characters or '_'.",m);const E=c.parse(a[m+1],m+1);if(!E)return null;d.push([v,E])}const g=c.parse(a[a.length-1],a.length-1,c.expectedType,d);return g?new _c(d,g):null}outputDefined(){return this.result.outputDefined()}serialize(){const a=["let"];for(const[c,d]of this.bindings)a.push(c,d.serialize());return a.push(this.result.serialize()),a}}class $d{constructor(a,c,d){this.type=a,this.index=c,this.input=d}static parse(a,c){if(a.length!==3)return c.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const d=c.parse(a[1],1,Jn),g=c.parse(a[2],2,za(c.expectedType||li));return d&&g?new $d(g.type.itemType,d,g):null}evaluate(a){const c=this.index.evaluate(a),d=this.input.evaluate(a);if(c<0)throw new ns(`Array index out of bounds: ${c} < 0.`);if(c>=d.length)throw new ns(`Array index out of bounds: ${c} > ${d.length-1}.`);if(c!==Math.floor(c))throw new ns(`Array index must be an integer, but found ${c} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return d[c]}eachChild(a){a(this.index),a(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class gu{constructor(a,c,d){this.type=a,this.index=c,this.input=d}static parse(a,c){if(a.length!==3)return c.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const d=c.parse(a[1],1,Jn),g=c.parse(a[2],2,za(c.expectedType||li));return d&&g?new gu(g.type.itemType,d,g):null}evaluate(a){const c=this.index.evaluate(a),d=this.input.evaluate(a);if(c<0)throw new ns(`Array index out of bounds: ${c} < 0.`);if(c>d.length-1)throw new ns(`Array index out of bounds: ${c} > ${d.length-1}.`);if(c===Math.floor(c))return d[c];const g=Math.floor(c),m=Math.ceil(c),v=d[g],E=d[m];if(typeof v!="number"||typeof E!="number")throw new ns(`Cannot interpolate between non-number values at index ${c}.`);const P=c-g;return v*(1-P)+E*P}eachChild(a){a(this.index),a(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class md{constructor(a,c){this.type=_i,this.needle=a,this.haystack=c}static parse(a,c){if(a.length!==3)return c.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const d=c.parse(a[1],1,li),g=c.parse(a[2],2,li);return d&&g?tf(d.type,[_i,ri,Jn,su,li])?new md(d,g):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ta(d.type)} instead`):null}evaluate(a){const c=this.needle.evaluate(a),d=this.haystack.evaluate(a);if(d==null)return!1;if(!ou(c,["boolean","string","number","null"]))throw new ns(`Expected first argument to be of type boolean, string, number or null, but found ${Ta(qa(c))} instead.`);if(!ou(d,["string","array"]))throw new ns(`Expected second argument to be of type array or string, but found ${Ta(qa(d))} instead.`);return d.indexOf(c)>=0}eachChild(a){a(this.needle),a(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Ch{constructor(a,c,d){this.type=Jn,this.needle=a,this.haystack=c,this.fromIndex=d}static parse(a,c){if(a.length<=2||a.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const d=c.parse(a[1],1,li),g=c.parse(a[2],2,li);if(!d||!g)return null;if(!tf(d.type,[_i,ri,Jn,su,li]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ta(d.type)} instead`);if(a.length===4){const m=c.parse(a[3],3,Jn);return m?new Ch(d,g,m):null}return new Ch(d,g)}evaluate(a){const c=this.needle.evaluate(a),d=this.haystack.evaluate(a);if(!ou(c,["boolean","string","number","null"]))throw new ns(`Expected first argument to be of type boolean, string, number or null, but found ${Ta(qa(c))} instead.`);if(!ou(d,["string","array"]))throw new ns(`Expected second argument to be of type array or string, but found ${Ta(qa(d))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(a);return d.indexOf(c,g)}return d.indexOf(c)}eachChild(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const a=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),a]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class kf{constructor(a,c,d,g,m,v){this.inputType=a,this.type=c,this.input=d,this.cases=g,this.outputs=m,this.otherwise=v}static parse(a,c){if(a.length<5)return c.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if(a.length%2!=1)return c.error("Expected an even number of arguments.");let d,g;c.expectedType&&c.expectedType.kind!=="value"&&(g=c.expectedType);const m={},v=[];for(let L=2;L<a.length-1;L+=2){let A=a[L];const O=a[L+1];Array.isArray(A)||(A=[A]);const N=c.concat(L);if(A.length===0)return N.error("Expected at least one branch label.");for(const k of A){if(typeof k!="number"&&typeof k!="string")return N.error("Branch labels must be numbers or strings.");if(typeof k=="number"&&Math.abs(k)>Number.MAX_SAFE_INTEGER)return N.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof k=="number"&&Math.floor(k)!==k)return N.error("Numeric branch labels must be integer values.");if(d){if(N.checkSubtype(d,qa(k)))return null}else d=qa(k);if(m[String(k)]!==void 0)return N.error("Branch labels must be unique.");m[String(k)]=v.length}const D=c.parse(O,L,g);if(!D)return null;g=g||D.type,v.push(D)}const E=c.parse(a[1],1,li);if(!E)return null;const P=c.parse(a[a.length-1],a.length-1,g);return P?E.type.kind!=="value"&&c.concat(1).checkSubtype(d,E.type)?null:new kf(d,g,E,m,v,P):null}evaluate(a){const c=this.input.evaluate(a);return(qa(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(a)}eachChild(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)}outputDefined(){return this.outputs.every(a=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const a=["match",this.input.serialize()],c=Object.keys(this.cases).sort(),d=[],g={};for(const v of c){const E=g[this.cases[v]];E===void 0?(g[this.cases[v]]=d.length,d.push([this.cases[v],[v]])):d[E][1].push(v)}const m=v=>this.inputType.kind==="number"?Number(v):v;for(const[v,E]of d)a.push(E.length===1?m(E[0]):E.map(m)),a.push(this.outputs[v].serialize());return a.push(this.otherwise.serialize()),a}}class Nf{constructor(a,c,d){this.type=a,this.branches=c,this.otherwise=d}static parse(a,c){if(a.length<4)return c.error(`Expected at least 3 arguments, but found only ${a.length-1}.`);if(a.length%2!=0)return c.error("Expected an odd number of arguments.");let d;c.expectedType&&c.expectedType.kind!=="value"&&(d=c.expectedType);const g=[];for(let v=1;v<a.length-1;v+=2){const E=c.parse(a[v],v,_i);if(!E)return null;const P=c.parse(a[v+1],v+1,d);if(!P)return null;g.push([E,P]),d=d||P.type}const m=c.parse(a[a.length-1],a.length-1,d);return m?new Nf(d,g,m):null}evaluate(a){for(const[c,d]of this.branches)if(c.evaluate(a))return d.evaluate(a);return this.otherwise.evaluate(a)}eachChild(a){for(const[c,d]of this.branches)a(c),a(d);a(this.otherwise)}outputDefined(){return this.branches.every(([a,c])=>c.outputDefined())&&this.otherwise.outputDefined()}serialize(){const a=["case"];return this.eachChild(c=>{a.push(c.serialize())}),a}}class Ih{constructor(a,c,d,g){this.type=a,this.input=c,this.beginIndex=d,this.endIndex=g}static parse(a,c){if(a.length<=2||a.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const d=c.parse(a[1],1,li),g=c.parse(a[2],2,Jn);if(!d||!g)return null;if(!tf(d.type,[za(li),ri,li]))return c.error(`Expected first argument to be of type array or string, but found ${Ta(d.type)} instead`);if(a.length===4){const m=c.parse(a[3],3,Jn);return m?new Ih(d.type,d,g,m):null}return new Ih(d.type,d,g)}evaluate(a){const c=this.input.evaluate(a),d=this.beginIndex.evaluate(a);if(!ou(c,["string","array"]))throw new ns(`Expected first argument to be of type array or string, but found ${Ta(qa(c))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(a);return c.slice(d,g)}return c.slice(d)}eachChild(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const a=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),a]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function gd(h,a){return h==="=="||h==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function Lm(h,a,c,d){return d.compare(a,c)===0}function af(h,a,c){const d=h!=="=="&&h!=="!=";return class pK{constructor(m,v,E){this.type=_i,this.lhs=m,this.rhs=v,this.collator=E,this.hasUntypedArgument=m.type.kind==="value"||v.type.kind==="value"}static parse(m,v){if(m.length!==3&&m.length!==4)return v.error("Expected two or three arguments.");const E=m[0];let P=v.parse(m[1],1,li);if(!P)return null;if(!gd(E,P.type))return v.concat(1).error(`"${E}" comparisons are not supported for type '${Ta(P.type)}'.`);let L=v.parse(m[2],2,li);if(!L)return null;if(!gd(E,L.type))return v.concat(2).error(`"${E}" comparisons are not supported for type '${Ta(L.type)}'.`);if(P.type.kind!==L.type.kind&&P.type.kind!=="value"&&L.type.kind!=="value")return v.error(`Cannot compare types '${Ta(P.type)}' and '${Ta(L.type)}'.`);d&&(P.type.kind==="value"&&L.type.kind!=="value"?P=new Bo(L.type,[P]):P.type.kind!=="value"&&L.type.kind==="value"&&(L=new Bo(P.type,[L])));let A=null;if(m.length===4){if(P.type.kind!=="string"&&L.type.kind!=="string"&&P.type.kind!=="value"&&L.type.kind!=="value")return v.error("Cannot use collator to compare non-string types.");if(A=v.parse(m[3],3,zo),!A)return null}return new pK(P,L,A)}evaluate(m){const v=this.lhs.evaluate(m),E=this.rhs.evaluate(m);if(d&&this.hasUntypedArgument){const P=qa(v),L=qa(E);if(P.kind!==L.kind||P.kind!=="string"&&P.kind!=="number")throw new ns(`Expected arguments for "${h}" to be (string, string) or (number, number), but found (${P.kind}, ${L.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const P=qa(v),L=qa(E);if(P.kind!=="string"||L.kind!=="string")return a(m,v,E)}return this.collator?c(m,v,E,this.collator.evaluate(m)):a(m,v,E)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[h];return this.eachChild(v=>{m.push(v.serialize())}),m}}}const Cg=af("==",function(h,a,c){return a===c},Lm),yu=af("!=",function(h,a,c){return a!==c},function(h,a,c,d){return!Lm(0,a,c,d)}),Vc=af("<",function(h,a,c){return a<c},function(h,a,c,d){return d.compare(a,c)<0}),vc=af(">",function(h,a,c){return a>c},function(h,a,c,d){return d.compare(a,c)>0}),Ig=af("<=",function(h,a,c){return a<=c},function(h,a,c,d){return d.compare(a,c)<=0}),zf=af(">=",function(h,a,c){return a>=c},function(h,a,c,d){return d.compare(a,c)>=0});class fl{constructor(a,c,d,g,m,v){this.type=ri,this.number=a,this.locale=c,this.currency=d,this.unit=g,this.minFractionDigits=m,this.maxFractionDigits=v}static parse(a,c){if(a.length!==3)return c.error("Expected two arguments.");const d=c.parse(a[1],1,Jn);if(!d)return null;const g=a[2];if(typeof g!="object"||Array.isArray(g))return c.error("NumberFormat options argument must be an object.");let m=null;if(g.locale&&(m=c.parseObjectValue(g.locale,2,"locale",ri),!m))return null;let v=null;if(g.currency&&(v=c.parseObjectValue(g.currency,2,"currency",ri),!v))return null;let E=null;if(g.unit&&(E=c.parseObjectValue(g.unit,2,"unit",ri),!E))return null;let P=null;if(g["min-fraction-digits"]&&(P=c.parseObjectValue(g["min-fraction-digits"],2,"min-fraction-digits",Jn),!P))return null;let L=null;return g["max-fraction-digits"]&&(L=c.parseObjectValue(g["max-fraction-digits"],2,"max-fraction-digits",Jn),!L)?null:new fl(d,m,v,E,P,L)}evaluate(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(a):void 0,unit:this.unit?this.unit.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))}eachChild(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.unit&&a(this.unit),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const a={};return this.locale&&(a.locale=this.locale.serialize()),this.currency&&(a.currency=this.currency.serialize()),this.unit&&(a.unit=this.unit.serialize()),this.minFractionDigits&&(a["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(a["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),a]}}class el{constructor(a){this.type=Jn,this.input=a}static parse(a,c){if(a.length!==2)return c.error(`Expected 1 argument, but found ${a.length-1} instead.`);const d=c.parse(a[1],1);return d?d.type.kind!=="array"&&d.type.kind!=="string"&&d.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${Ta(d.type)} instead.`):new el(d):null}evaluate(a){const c=this.input.evaluate(a);if(typeof c=="string"||Array.isArray(c))return c.length;throw new ns(`Expected value to be of type string or array, but found ${Ta(qa(c))} instead.`)}eachChild(a){a(this.input)}outputDefined(){return!1}serialize(){const a=["length"];return this.eachChild(c=>{a.push(c.serialize())}),a}}function Bf(h){return function(){h=1831565813+(h|=0)|0;let a=Math.imul(h^h>>>15,1|h);return a=a+Math.imul(a^a>>>7,61|a)^a,((a^a>>>14)>>>0)/4294967296}}const Ph={"==":Cg,"!=":yu,">":vc,"<":Vc,">=":zf,"<=":Ig,array:Bo,at:$d,"at-interpolated":gu,boolean:Bo,case:Nf,coalesce:Zl,collator:Hl,format:bh,image:hc,in:md,"index-of":Ch,interpolate:Ha,"interpolate-hcl":Ha,"interpolate-lab":Ha,length:el,let:_c,literal:Vl,match:kf,number:Bo,"number-format":fl,object:Bo,slice:Ih,step:Xl,string:Bo,"to-boolean":$l,"to-color":$l,"to-number":$l,"to-string":$l,var:$a,within:dc,distance:gc,config:Uc};function zp(h,[a,c,d,g]){a=a.evaluate(h),c=c.evaluate(h),d=d.evaluate(h);const m=g?g.evaluate(h):1,v=wl(a,c,d,m);if(v)throw new ns(v);return new Ei(a/255*m,c/255*m,d/255*m,m)}function Bp(h,[a,c,d,g]){a=a.evaluate(h),c=c.evaluate(h),d=d.evaluate(h);const m=g?g.evaluate(h):1,v=function(L,A,O,N){return typeof L=="number"&&L>=0&&L<=360?typeof A=="number"&&A>=0&&A<=100&&typeof O=="number"&&O>=0&&O<=100?N===void 0||typeof N=="number"&&N>=0&&N<=1?null:`Invalid hsla value [${[L,A,O,N].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof N=="number"?[L,A,O,N]:[L,A,O]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof N=="number"?[L,A,O,N]:[L,A,O]).join(", ")}]: 'h' must be between 0 and 360.`}(a,c,d,m);if(v)throw new ns(v);const E=`hsla(${a}, ${c}%, ${d}%, ${m})`,P=Ei.parse(E);if(!P)throw new ns(`Failed to parse HSLA color: ${E}`);return P}function Uu(h,a){return h in a}function yd(h,a){const c=a[h];return c===void 0?null:c}function tl(h){return{type:h}}function Oh(h){return{result:"success",value:h}}function bc(h){return{result:"error",value:h}}function Rh(h,a){return!!h&&!!h.parameters&&h.parameters.indexOf(a)>-1}function qu(h){return h["property-type"]==="data-driven"}function Ml(h){return Rh(h.expression,"measure-light")}function $c(h){return Rh(h.expression,"zoom")}function Vu(h){return!!h.expression&&h.expression.interpolated}function Hd(h){return typeof h=="object"&&h!==null&&!Array.isArray(h)}function Dh(h){return h}function $u(h,a){const c=a.type==="color",d=h.stops&&typeof h.stops[0][0]=="object",g=d||!(d||h.property!==void 0),m=h.type||(Vu(a)?"exponential":"interval");if(c&&((h=Si({},h)).stops&&(h.stops=h.stops.map(L=>[L[0],Ei.parse(L[1])])),h.default=Ei.parse(h.default?h.default:a.default)),h.colorSpace&&h.colorSpace!=="rgb"&&!Qo[h.colorSpace])throw new Error(`Unknown color space: ${h.colorSpace}`);let v,E,P;if(m==="exponential")v=_d;else if(m==="interval")v=km;else if(m==="categorical"){v=jp,E=Object.create(null);for(const L of h.stops)E[L[0]]=L[1];P=typeof h.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);v=Fp}if(d){const L={},A=[];for(let D=0;D<h.stops.length;D++){const k=h.stops[D],U=k[0].zoom;L[U]===void 0&&(L[U]={zoom:U,type:h.type,property:h.property,default:h.default,stops:[]},A.push(U)),L[U].stops.push([k[0].value,k[1]])}const O=[];for(const D of A)O.push([L[D].zoom,$u(L[D],a)]);const N={name:"linear"};return{kind:"composite",interpolationType:N,interpolationFactor:Ha.interpolationFactor.bind(void 0,N),zoomStops:O.map(D=>D[0]),evaluate:({zoom:D},k)=>_d({stops:O,base:h.base},a,D).evaluate(D,k)}}if(g){const L=m==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:L,interpolationFactor:Ha.interpolationFactor.bind(void 0,L),zoomStops:h.stops.map(A=>A[0]),evaluate:({zoom:A})=>v(h,a,A,E,P)}}return{kind:"source",evaluate(L,A){const O=A&&A.properties?A.properties[h.property]:void 0;return O===void 0?Ds(h.default,a.default):v(h,a,O,E,P)}}}function Ds(h,a,c){return h!==void 0?h:a!==void 0?a:c!==void 0?c:void 0}function jp(h,a,c,d,g){return Ds(typeof c===g?d[c]:void 0,h.default,a.default)}function km(h,a,c){if(fc(c)!=="number")return Ds(h.default,a.default);const d=h.stops.length;if(d===1||c<=h.stops[0][0])return h.stops[0][1];if(c>=h.stops[d-1][0])return h.stops[d-1][1];const g=Zo(h.stops.map(m=>m[0]),c);return h.stops[g][1]}function _d(h,a,c){const d=h.base!==void 0?h.base:1;if(fc(c)!=="number")return Ds(h.default,a.default);const g=h.stops.length;if(g===1||c<=h.stops[0][0])return h.stops[0][1];if(c>=h.stops[g-1][0])return h.stops[g-1][1];const m=Zo(h.stops.map(A=>A[0]),c),v=function(A,O,N,D){const k=D-N,U=A-N;return k===0?0:O===1?U/k:(Math.pow(O,U)-1)/(Math.pow(O,k)-1)}(c,d,h.stops[m][0],h.stops[m+1][0]),E=h.stops[m][1],P=h.stops[m+1][1];let L=ef[a.type]||Dh;if(h.colorSpace&&h.colorSpace!=="rgb"){const A=Qo[h.colorSpace];L=(O,N)=>A.reverse(A.interpolate(A.forward(O),A.forward(N),v))}return typeof E.evaluate=="function"?{evaluate(...A){const O=E.evaluate.apply(void 0,A),N=P.evaluate.apply(void 0,A);if(O!==void 0&&N!==void 0)return L(O,N,v)}}:L(E,P,v)}function Fp(h,a,c){return a.type==="color"?c=Ei.parse(c):a.type==="formatted"?c=os.fromString(c.toString()):a.type==="resolvedImage"?c=ws.build(c.toString()):fc(c)===a.type||a.type==="enum"&&a.values[c]||(c=void 0),Ds(c,h.default,a.default)}qs.register(Ph,{error:[{kind:"error"},[ri],(h,[a])=>{throw new ns(a.evaluate(h))}],typeof:[ri,[li],(h,[a])=>Ta(qa(a.evaluate(h)))],"to-rgba":[za(Jn,4),[Fs],(h,[a])=>a.evaluate(h).toRenderColor(null).toArray()],"to-hsla":[za(Jn,4),[Fs],(h,[a])=>a.evaluate(h).toRenderColor(null).toHslaArray()],rgb:[Fs,[Jn,Jn,Jn],zp],rgba:[Fs,[Jn,Jn,Jn,Jn],zp],hsl:[Fs,[Jn,Jn,Jn],Bp],hsla:[Fs,[Jn,Jn,Jn,Jn],Bp],has:{type:_i,overloads:[[[ri],(h,[a])=>Uu(a.evaluate(h),h.properties())],[[ri,_h],(h,[a,c])=>Uu(a.evaluate(h),c.evaluate(h))]]},get:{type:li,overloads:[[[ri],(h,[a])=>yd(a.evaluate(h),h.properties())],[[ri,_h],(h,[a,c])=>yd(a.evaluate(h),c.evaluate(h))]]},"feature-state":[li,[ri],(h,[a])=>yd(a.evaluate(h),h.featureState||{})],properties:[_h,[],h=>h.properties()],"geometry-type":[ri,[],h=>h.geometryType()],id:[li,[],h=>h.id()],zoom:[Jn,[],h=>h.globals.zoom],pitch:[Jn,[],h=>h.globals.pitch||0],"distance-from-center":[Jn,[],h=>h.distanceFromCenter()],"measure-light":[Jn,[ri],(h,[a])=>h.measureLight(a.evaluate(h))],"heatmap-density":[Jn,[],h=>h.globals.heatmapDensity||0],"line-progress":[Jn,[],h=>h.globals.lineProgress||0],"raster-value":[Jn,[],h=>h.globals.rasterValue||0],"raster-particle-speed":[Jn,[],h=>h.globals.rasterParticleSpeed||0],"sky-radial-progress":[Jn,[],h=>h.globals.skyRadialProgress||0],accumulated:[li,[],h=>h.globals.accumulated===void 0?null:h.globals.accumulated],"+":[Jn,tl(Jn),(h,a)=>{let c=0;for(const d of a)c+=d.evaluate(h);return c}],"*":[Jn,tl(Jn),(h,a)=>{let c=1;for(const d of a)c*=d.evaluate(h);return c}],"-":{type:Jn,overloads:[[[Jn,Jn],(h,[a,c])=>a.evaluate(h)-c.evaluate(h)],[[Jn],(h,[a])=>-a.evaluate(h)]]},"/":[Jn,[Jn,Jn],(h,[a,c])=>a.evaluate(h)/c.evaluate(h)],"%":[Jn,[Jn,Jn],(h,[a,c])=>a.evaluate(h)%c.evaluate(h)],ln2:[Jn,[],()=>Math.LN2],pi:[Jn,[],()=>Math.PI],e:[Jn,[],()=>Math.E],"^":[Jn,[Jn,Jn],(h,[a,c])=>Math.pow(a.evaluate(h),c.evaluate(h))],sqrt:[Jn,[Jn],(h,[a])=>Math.sqrt(a.evaluate(h))],log10:[Jn,[Jn],(h,[a])=>Math.log(a.evaluate(h))/Math.LN10],ln:[Jn,[Jn],(h,[a])=>Math.log(a.evaluate(h))],log2:[Jn,[Jn],(h,[a])=>Math.log(a.evaluate(h))/Math.LN2],sin:[Jn,[Jn],(h,[a])=>Math.sin(a.evaluate(h))],cos:[Jn,[Jn],(h,[a])=>Math.cos(a.evaluate(h))],tan:[Jn,[Jn],(h,[a])=>Math.tan(a.evaluate(h))],asin:[Jn,[Jn],(h,[a])=>Math.asin(a.evaluate(h))],acos:[Jn,[Jn],(h,[a])=>Math.acos(a.evaluate(h))],atan:[Jn,[Jn],(h,[a])=>Math.atan(a.evaluate(h))],min:[Jn,tl(Jn),(h,a)=>Math.min(...a.map(c=>c.evaluate(h)))],max:[Jn,tl(Jn),(h,a)=>Math.max(...a.map(c=>c.evaluate(h)))],abs:[Jn,[Jn],(h,[a])=>Math.abs(a.evaluate(h))],round:[Jn,[Jn],(h,[a])=>{const c=a.evaluate(h);return c<0?-Math.round(-c):Math.round(c)}],floor:[Jn,[Jn],(h,[a])=>Math.floor(a.evaluate(h))],ceil:[Jn,[Jn],(h,[a])=>Math.ceil(a.evaluate(h))],"filter-==":[_i,[ri,li],(h,[a,c])=>h.properties()[a.value]===c.value],"filter-id-==":[_i,[li],(h,[a])=>h.id()===a.value],"filter-type-==":[_i,[ri],(h,[a])=>h.geometryType()===a.value],"filter-<":[_i,[ri,li],(h,[a,c])=>{const d=h.properties()[a.value],g=c.value;return typeof d==typeof g&&d<g}],"filter-id-<":[_i,[li],(h,[a])=>{const c=h.id(),d=a.value;return typeof c==typeof d&&c<d}],"filter->":[_i,[ri,li],(h,[a,c])=>{const d=h.properties()[a.value],g=c.value;return typeof d==typeof g&&d>g}],"filter-id->":[_i,[li],(h,[a])=>{const c=h.id(),d=a.value;return typeof c==typeof d&&c>d}],"filter-<=":[_i,[ri,li],(h,[a,c])=>{const d=h.properties()[a.value],g=c.value;return typeof d==typeof g&&d<=g}],"filter-id-<=":[_i,[li],(h,[a])=>{const c=h.id(),d=a.value;return typeof c==typeof d&&c<=d}],"filter->=":[_i,[ri,li],(h,[a,c])=>{const d=h.properties()[a.value],g=c.value;return typeof d==typeof g&&d>=g}],"filter-id->=":[_i,[li],(h,[a])=>{const c=h.id(),d=a.value;return typeof c==typeof d&&c>=d}],"filter-has":[_i,[li],(h,[a])=>a.value in h.properties()],"filter-has-id":[_i,[],h=>h.id()!==null&&h.id()!==void 0],"filter-type-in":[_i,[za(ri)],(h,[a])=>a.value.indexOf(h.geometryType())>=0],"filter-id-in":[_i,[za(li)],(h,[a])=>a.value.indexOf(h.id())>=0],"filter-in-small":[_i,[ri,za(li)],(h,[a,c])=>c.value.indexOf(h.properties()[a.value])>=0],"filter-in-large":[_i,[ri,za(li)],(h,[a,c])=>function(d,g,m,v){for(;m<=v;){const E=m+v>>1;if(g[E]===d)return!0;g[E]>d?v=E-1:m=E+1}return!1}(h.properties()[a.value],c.value,0,c.value.length-1)],all:{type:_i,overloads:[[[_i,_i],(h,[a,c])=>a.evaluate(h)&&c.evaluate(h)],[tl(_i),(h,a)=>{for(const c of a)if(!c.evaluate(h))return!1;return!0}]]},any:{type:_i,overloads:[[[_i,_i],(h,[a,c])=>a.evaluate(h)||c.evaluate(h)],[tl(_i),(h,a)=>{for(const c of a)if(c.evaluate(h))return!0;return!1}]]},"!":[_i,[_i],(h,[a])=>!a.evaluate(h)],"is-supported-script":[_i,[ri],(h,[a])=>{const c=h.globals&&h.globals.isSupportedScript;return!c||c(a.evaluate(h))}],upcase:[ri,[ri],(h,[a])=>a.evaluate(h).toUpperCase()],downcase:[ri,[ri],(h,[a])=>a.evaluate(h).toLowerCase()],concat:[ri,tl(li),(h,a)=>a.map(c=>Us(c.evaluate(h))).join("")],"resolved-locale":[ri,[zo],(h,[a])=>a.evaluate(h).resolvedLocale()],random:[Jn,[Jn,Jn,li],(h,a)=>{const[c,d,g]=a.map(v=>v.evaluate(h));if(c>d||c===d)return c;let m;if(typeof g=="string")m=function(v){let E=0;if(v.length===0)return E;for(let P=0;P<v.length;P++)E=(E<<5)-E+v.charCodeAt(P),E|=0;return E}(g);else{if(typeof g!="number")throw new ns(`Invalid seed input: ${g}`);m=g}return c+Bf(m)()*(d-c)}]});class Qs{constructor(a,c,d,g){this.expression=a,this._warningHistory={},this._evaluator=new xh(d,g),this._defaultValue=c?function(m){return m.type==="color"&&(Hd(m.default)||Array.isArray(m.default))?new Ei(0,0,0,0):m.type==="color"?Ei.parse(m.default)||null:m.default===void 0?null:m.default}(c):null,this._enumValues=c&&c.type==="enum"?c.values:null,this.configDependencies=Yi(a)}evaluateWithoutErrorHandling(a,c,d,g,m,v,E,P){return this._evaluator.globals=a,this._evaluator.feature=c,this._evaluator.featureState=d,this._evaluator.canonical=g||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=v,this._evaluator.featureTileCoord=E||null,this._evaluator.featureDistanceData=P||null,this.expression.evaluate(this._evaluator)}evaluate(a,c,d,g,m,v,E,P){this._evaluator.globals=a,this._evaluator.feature=c||null,this._evaluator.featureState=d||null,this._evaluator.canonical=g||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=v||null,this._evaluator.featureTileCoord=E||null,this._evaluator.featureDistanceData=P||null;try{const L=this.expression.evaluate(this._evaluator);if(L==null||typeof L=="number"&&L!=L)return this._defaultValue;if(this._enumValues&&!(L in this._enumValues))throw new ns(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(L)} instead.`);return L}catch(L){return this._warningHistory[L.message]||(this._warningHistory[L.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${L.message}`)),this._defaultValue}}}function jf(h){return Array.isArray(h)&&h.length>0&&typeof h[0]=="string"&&h[0]in Ph}function q(h,a,c,d){const g=new Yl(Ph,[],a?function(v){const E={color:Fs,string:ri,number:Jn,enum:ri,boolean:_i,formatted:uc,resolvedImage:xs};return v.type==="array"?za(E[v.value]||li,v.length):E[v.type]}(a):void 0,void 0,void 0,c,d),m=g.parse(h,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?Oh(new Qs(m,a,c,d)):bc(g.errors)}class Z{constructor(a,c,d,g){this.kind=a,this._styleExpression=c,this.isLightConstant=d,this.isLineProgressConstant=g,this.isStateDependent=a!=="constant"&&!ls(c.expression),this.configDependencies=Yi(c.expression)}evaluateWithoutErrorHandling(a,c,d,g,m,v){return this._styleExpression.evaluateWithoutErrorHandling(a,c,d,g,m,v)}evaluate(a,c,d,g,m,v){return this._styleExpression.evaluate(a,c,d,g,m,v)}}class de{constructor(a,c,d,g,m,v){this.kind=a,this.zoomStops=d,this._styleExpression=c,this.isStateDependent=a!=="camera"&&!ls(c.expression),this.isLightConstant=m,this.isLineProgressConstant=v,this.configDependencies=Yi(c.expression),this.interpolationType=g}evaluateWithoutErrorHandling(a,c,d,g,m,v){return this._styleExpression.evaluateWithoutErrorHandling(a,c,d,g,m,v)}evaluate(a,c,d,g,m,v){return this._styleExpression.evaluate(a,c,d,g,m,v)}interpolationFactor(a,c,d){return this.interpolationType?Ha.interpolationFactor(this.interpolationType,a,c,d):0}}function Ie(h,a,c,d){if((h=q(h,a,c,d)).result==="error")return h;const g=h.value.expression,m=jo(g);if(!m&&!qu(a))return bc([new js("","data expressions not supported")]);const v=ea(g,["zoom","pitch","distance-from-center"]);if(!v&&!$c(a))return bc([new js("","zoom expressions not supported")]);const E=ea(g,["measure-light"]);if(!E&&!Ml(a))return bc([new js("","measure-light expression not supported")]);const P=ea(g,["line-progress"]);if(!P&&!function(O){return Rh(O.expression,"line-progress")}(a))return bc([new js("","line-progress expression not supported")]);const L=a.expression&&a.expression.relaxZoomRestriction,A=Ze(g);return A||v||L?A instanceof js?bc([A]):A instanceof Ha&&!Vu(a)?bc([new js("",'"interpolate" expressions cannot be used with this property')]):Oh(A?new de(m&&P?"camera":"composite",h.value,A.labels,A instanceof Ha?A.interpolation:void 0,E,P):new Z(m&&P?"constant":"source",h.value,E,P)):bc([new js("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Ve{constructor(a,c){this._parameters=a,this._specification=c,Si(this,$u(this._parameters,this._specification))}static deserialize(a){return new Ve(a._parameters,a._specification)}static serialize(a){return{_parameters:a._parameters,_specification:a._specification}}}function Ze(h){let a=null;if(h instanceof _c)a=Ze(h.result);else if(h instanceof Zl){for(const c of h.args)if(a=Ze(c),a)break}else(h instanceof Xl||h instanceof Ha)&&h.input instanceof qs&&h.input.name==="zoom"&&(a=h);return a instanceof js||h.eachChild(c=>{const d=Ze(c);d instanceof js?a=d:a&&d&&a!==d&&(a=new js("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),a}var et,at,ut=function(){if(at)return et;at=1,et=a;var h=3;function a(c,d,g){var m=this.cells=[];if(c instanceof ArrayBuffer){this.arrayBuffer=c;var v=new Int32Array(this.arrayBuffer);c=v[0],this.d=(d=v[1])+2*(g=v[2]);for(var E=0;E<this.d*this.d;E++){var P=v[h+E],L=v[h+E+1];m.push(P===L?null:v.subarray(P,L))}var A=v[h+m.length+1];this.keys=v.subarray(v[h+m.length],A),this.bboxes=v.subarray(A),this.insert=this._insertReadonly}else{this.d=d+2*g;for(var O=0;O<this.d*this.d;O++)m.push([]);this.keys=[],this.bboxes=[]}this.n=d,this.extent=c,this.padding=g,this.scale=d/c,this.uid=0;var N=g/d*c;this.min=-N,this.max=c+N}return a.prototype.insert=function(c,d,g,m,v){this._forEachCell(d,g,m,v,this._insertCell,this.uid++),this.keys.push(c),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(m),this.bboxes.push(v)},a.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},a.prototype._insertCell=function(c,d,g,m,v,E){this.cells[v].push(E)},a.prototype.query=function(c,d,g,m,v){var E=this.min,P=this.max;if(c<=E&&d<=E&&P<=g&&P<=m&&!v)return Array.prototype.slice.call(this.keys);var L=[];return this._forEachCell(c,d,g,m,this._queryCell,L,{},v),L},a.prototype._queryCell=function(c,d,g,m,v,E,P,L){var A=this.cells[v];if(A!==null)for(var O=this.keys,N=this.bboxes,D=0;D<A.length;D++){var k=A[D];if(P[k]===void 0){var U=4*k;(L?L(N[U+0],N[U+1],N[U+2],N[U+3]):c<=N[U+2]&&d<=N[U+3]&&g>=N[U+0]&&m>=N[U+1])?(P[k]=!0,E.push(O[k])):P[k]=!1}}},a.prototype._forEachCell=function(c,d,g,m,v,E,P,L){for(var A=this._convertToCellCoord(c),O=this._convertToCellCoord(d),N=this._convertToCellCoord(g),D=this._convertToCellCoord(m),k=A;k<=N;k++)for(var U=O;U<=D;U++){var X=this.d*U+k;if((!L||L(this._convertFromCellCoord(k),this._convertFromCellCoord(U),this._convertFromCellCoord(k+1),this._convertFromCellCoord(U+1)))&&v.call(this,c,d,g,m,X,E,P,L))return}},a.prototype._convertFromCellCoord=function(c){return(c-this.padding)/this.scale},a.prototype._convertToCellCoord=function(c){return Math.max(0,Math.min(this.d-1,Math.floor(c*this.scale)+this.padding))},a.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var c=this.cells,d=h+this.cells.length+1+1,g=0,m=0;m<this.cells.length;m++)g+=this.cells[m].length;var v=new Int32Array(d+g+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;for(var E=d,P=0;P<c.length;P++){var L=c[P];v[h+P]=E,v.set(L,E),E+=L.length}return v[h+c.length]=E,v.set(this.keys,E),v[h+c.length+1]=E+=this.keys.length,v.set(this.bboxes,E),E+=this.bboxes.length,v.buffer},et}(),St=x(ut);const Jt={};function Mt(h,a,c={}){Object.defineProperty(h,"_classRegistryKey",{value:a,writable:!1}),Jt[a]={klass:h,omit:c.omit||[]}}Mt(Object,"Object"),St.serialize=function(h,a){const c=h.toArrayBuffer();return a&&a.add(c),{buffer:c}},St.deserialize=function(h){return new St(h.buffer)},Object.defineProperty(St,"name",{value:"Grid"}),Mt(St,"Grid"),typeof DOMMatrix<"u"&&Mt(DOMMatrix,"DOMMatrix"),Mt(Ei,"Color"),Mt(Error,"Error"),Mt(os,"Formatted"),Mt(Yo,"FormattedSection"),Mt(Bs,"AJAXError"),Mt(ws,"ResolvedImage"),Mt(Ve,"StylePropertyFunction"),Mt(Qs,"StyleExpression",{omit:["_evaluator"]}),Mt(No,"ImageId"),Mt(Fc,"ImageVariant"),Mt(de,"ZoomDependentExpression"),Mt(Z,"ZoomConstantExpression"),Mt(qs,"CompoundExpression",{omit:["_evaluate"]});for(const h in Ph)Jt[Ph[h]._classRegistryKey]||Mt(Ph[h],`Expression${h}`);function vn(h){return h&&typeof ArrayBuffer<"u"&&(h instanceof ArrayBuffer||h.constructor&&h.constructor.name==="ArrayBuffer")}function nn(h){return self.ImageBitmap&&h instanceof ImageBitmap}function wn(h,a){if(h==null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||h instanceof Boolean||h instanceof Number||h instanceof String||h instanceof Date||h instanceof RegExp)return h;if(vn(h)||nn(h))return a&&a.add(h),h;if(ArrayBuffer.isView(h))return a&&a.add(h.buffer),h;if(h instanceof ImageData)return a&&a.add(h.data.buffer),h;if(Array.isArray(h)){const c=[];for(const d of h)c.push(wn(d,a));return c}if(h instanceof Map){const c={$name:"Map",entries:[]};for(const[d,g]of h.entries())c.entries.push(wn(d),wn(g));return c}if(h instanceof Set){const c={$name:"Set"};let d=0;for(const g of h.values())c[++d]=wn(g);return c}if(h instanceof DOMMatrix){const c={$name:"DOMMatrix"},d=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const g of d)c[g]=h[g];return c}if(typeof h=="bigint")return{$name:"BigInt",value:h.toString()};if(typeof h=="object"){const c=h.constructor,d=c._classRegistryKey;if(!d)throw new Error(`Can't serialize object of unregistered class "${c.name}".`);const g=c.serialize?c.serialize(h,a):{};if(!c.serialize){for(const m in h)h.hasOwnProperty(m)&&(Jt[d].omit.indexOf(m)>=0||(g[m]=wn(h[m],a)));h instanceof Error&&(g.message=h.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return d!=="Object"&&(g.$name=d),g}throw new Error("can't serialize object of type "+typeof h)}function pn(h){if(h==null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||h instanceof Boolean||h instanceof Number||h instanceof String||h instanceof Date||h instanceof RegExp||vn(h)||nn(h)||ArrayBuffer.isView(h)||h instanceof ImageData)return h;if(Array.isArray(h))return h.map(pn);if(typeof h=="object"){const a=h.$name||"Object";if(a==="Map"){const g=h.entries||[],m=new Map;for(let v=0;v<g.length;v+=2)m.set(pn(g[v]),pn(g[v+1]));return m}if(a==="Set"){const g=new Set;for(const m of Object.keys(h))m!=="$name"&&g.add(pn(h[m]));return g}if(a==="DOMMatrix"){let g;return g=h.is2D?[h.a,h.b,h.c,h.d,h.e,h.f]:[h.m11,h.m12,h.m13,h.m14,h.m21,h.m22,h.m23,h.m24,h.m31,h.m32,h.m33,h.m34,h.m41,h.m42,h.m43,h.m44],new DOMMatrix(g)}if(a==="BigInt")return BigInt(h.value);const{klass:c}=Jt[a];if(!c)throw new Error(`Can't deserialize unregistered class "${a}".`);if(c.deserialize)return c.deserialize(h);const d=Object.create(c.prototype);for(const g of Object.keys(h))g!=="$name"&&(d[g]=pn(h[g]));return d}throw new Error("can't deserialize object of type "+typeof h)}const _t={"Latin-1 Supplement":h=>h>=128&&h<=255,Arabic:h=>h>=1536&&h<=1791,"Arabic Supplement":h=>h>=1872&&h<=1919,"Arabic Extended-A":h=>h>=2208&&h<=2303,"Hangul Jamo":h=>h>=4352&&h<=4607,"Unified Canadian Aboriginal Syllabics":h=>h>=5120&&h<=5759,Khmer:h=>h>=6016&&h<=6143,"Unified Canadian Aboriginal Syllabics Extended":h=>h>=6320&&h<=6399,"General Punctuation":h=>h>=8192&&h<=8303,"Letterlike Symbols":h=>h>=8448&&h<=8527,"Number Forms":h=>h>=8528&&h<=8591,"Miscellaneous Technical":h=>h>=8960&&h<=9215,"Control Pictures":h=>h>=9216&&h<=9279,"Optical Character Recognition":h=>h>=9280&&h<=9311,"Enclosed Alphanumerics":h=>h>=9312&&h<=9471,"Geometric Shapes":h=>h>=9632&&h<=9727,"Miscellaneous Symbols":h=>h>=9728&&h<=9983,"Miscellaneous Symbols and Arrows":h=>h>=11008&&h<=11263,"CJK Radicals Supplement":h=>h>=11904&&h<=12031,"Kangxi Radicals":h=>h>=12032&&h<=12255,"Ideographic Description Characters":h=>h>=12272&&h<=12287,"CJK Symbols and Punctuation":h=>h>=12288&&h<=12351,Hiragana:h=>h>=12352&&h<=12447,Katakana:h=>h>=12448&&h<=12543,Bopomofo:h=>h>=12544&&h<=12591,"Hangul Compatibility Jamo":h=>h>=12592&&h<=12687,Kanbun:h=>h>=12688&&h<=12703,"Bopomofo Extended":h=>h>=12704&&h<=12735,"CJK Strokes":h=>h>=12736&&h<=12783,"Katakana Phonetic Extensions":h=>h>=12784&&h<=12799,"Enclosed CJK Letters and Months":h=>h>=12800&&h<=13055,"CJK Compatibility":h=>h>=13056&&h<=13311,"CJK Unified Ideographs Extension A":h=>h>=13312&&h<=19903,"Yijing Hexagram Symbols":h=>h>=19904&&h<=19967,"CJK Unified Ideographs":h=>h>=19968&&h<=40959,"Yi Syllables":h=>h>=40960&&h<=42127,"Yi Radicals":h=>h>=42128&&h<=42191,"Hangul Jamo Extended-A":h=>h>=43360&&h<=43391,"Hangul Syllables":h=>h>=44032&&h<=55215,"Hangul Jamo Extended-B":h=>h>=55216&&h<=55295,"Private Use Area":h=>h>=57344&&h<=63743,"CJK Compatibility Ideographs":h=>h>=63744&&h<=64255,"Arabic Presentation Forms-A":h=>h>=64336&&h<=65023,"Vertical Forms":h=>h>=65040&&h<=65055,"CJK Compatibility Forms":h=>h>=65072&&h<=65103,"Small Form Variants":h=>h>=65104&&h<=65135,"Arabic Presentation Forms-B":h=>h>=65136&&h<=65279,"Halfwidth and Fullwidth Forms":h=>h>=65280&&h<=65519,Osage:h=>h>=66736&&h<=66815,"CJK Unified Ideographs Extension B":h=>h>=131072&&h<=173791};function en(h){for(const a of h)if(Gn(a.charCodeAt(0)))return!0;return!1}function Vn(h){for(const a of h)if(!Yn(a.charCodeAt(0)))return!1;return!0}function Yn(h){return!(_t.Arabic(h)||_t["Arabic Supplement"](h)||_t["Arabic Extended-A"](h)||_t["Arabic Presentation Forms-A"](h)||_t["Arabic Presentation Forms-B"](h))}function Gn(h){return!(h!==746&&h!==747&&(h<4352||!(_t["Bopomofo Extended"](h)||_t.Bopomofo(h)||_t["CJK Compatibility Forms"](h)&&!(h>=65097&&h<=65103)||_t["CJK Compatibility Ideographs"](h)||_t["CJK Compatibility"](h)||_t["CJK Radicals Supplement"](h)||_t["CJK Strokes"](h)||!(!_t["CJK Symbols and Punctuation"](h)||h>=12296&&h<=12305||h>=12308&&h<=12319||h===12336)||_t["CJK Unified Ideographs Extension A"](h)||_t["CJK Unified Ideographs"](h)||_t["Enclosed CJK Letters and Months"](h)||_t["Hangul Compatibility Jamo"](h)||_t["Hangul Jamo Extended-A"](h)||_t["Hangul Jamo Extended-B"](h)||_t["Hangul Jamo"](h)||_t["Hangul Syllables"](h)||_t.Hiragana(h)||_t["Ideographic Description Characters"](h)||_t.Kanbun(h)||_t["Kangxi Radicals"](h)||_t["Katakana Phonetic Extensions"](h)||_t.Katakana(h)&&h!==12540||!(!_t["Halfwidth and Fullwidth Forms"](h)||h===65288||h===65289||h===65293||h>=65306&&h<=65310||h===65339||h===65341||h===65343||h>=65371&&h<=65503||h===65507||h>=65512&&h<=65519)||!(!_t["Small Form Variants"](h)||h>=65112&&h<=65118||h>=65123&&h<=65126)||_t["Unified Canadian Aboriginal Syllabics"](h)||_t["Unified Canadian Aboriginal Syllabics Extended"](h)||_t["Vertical Forms"](h)||_t["Yijing Hexagram Symbols"](h)||_t["Yi Syllables"](h)||_t["Yi Radicals"](h))))}function Tr(h){return!(Gn(h)||function(a){return!!(_t["Latin-1 Supplement"](a)&&(a===167||a===169||a===174||a===177||a===188||a===189||a===190||a===215||a===247)||_t["General Punctuation"](a)&&(a===8214||a===8224||a===8225||a===8240||a===8241||a===8251||a===8252||a===8258||a===8263||a===8264||a===8265||a===8273)||_t["Letterlike Symbols"](a)||_t["Number Forms"](a)||_t["Miscellaneous Technical"](a)&&(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||a===9003||a>=9085&&a<=9114||a>=9150&&a<=9165||a===9167||a>=9169&&a<=9179||a>=9186&&a<=9215)||_t["Control Pictures"](a)&&a!==9251||_t["Optical Character Recognition"](a)||_t["Enclosed Alphanumerics"](a)||_t["Geometric Shapes"](a)||_t["Miscellaneous Symbols"](a)&&!(a>=9754&&a<=9759)||_t["Miscellaneous Symbols and Arrows"](a)&&(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243)||_t["CJK Symbols and Punctuation"](a)||_t.Katakana(a)||_t["Private Use Area"](a)||_t["CJK Compatibility Forms"](a)||_t["Small Form Variants"](a)||_t["Halfwidth and Fullwidth Forms"](a)||a===8734||a===8756||a===8757||a>=9984&&a<=10087||a>=10102&&a<=10131||a===65532||a===65533)}(h))}function pr(h){return _t.Arabic(h)||_t["Arabic Supplement"](h)||_t["Arabic Extended-A"](h)||_t["Arabic Presentation Forms-A"](h)||_t["Arabic Presentation Forms-B"](h)}function ii(h){return h>=1424&&h<=2303||_t["Arabic Presentation Forms-A"](h)||_t["Arabic Presentation Forms-B"](h)}function cr(h,a){return!(!a&&ii(h)||h>=2304&&h<=3583||h>=3840&&h<=4255||_t.Khmer(h))}function va(h){for(const a of h)if(ii(a.charCodeAt(0)))return!0;return!1}const Ea="deferred",$i="loading",ta="loaded";let Ga=null,Bi="unavailable",vi=null;const cs=function(h){h&&typeof h=="string"&&h.indexOf("NetworkError")>-1&&(Bi="error"),Ga&&Ga(h)};function Ba(){ji.fire(new ko("pluginStateChange",{pluginStatus:Bi,pluginURL:vi}))}const ji=new ql,fo=function(){return Bi},ba=function(){if(Bi!==Ea||!vi)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Bi=$i,Ba(),vi&&Oa({url:vi},h=>{h?cs(h):(Bi=ta,Ba())})},is={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Bi===ta||is.applyArabicShaping!=null,isLoading:()=>Bi===$i,setState(h){Bi=h.pluginStatus,vi=h.pluginURL},isParsed:()=>is.applyArabicShaping!=null&&is.processBidirectionalText!=null&&is.processStyledBidirectionalText!=null,getPluginURL:()=>vi};class bi{constructor(a,c){this.zoom=a,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.transition=c.transition,this.pitch=c.pitch,this.brightness=c.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(a){return function(c,d){for(const g of c)if(!cr(g.charCodeAt(0),d))return!1;return!0}(a,is.isLoaded())}}class ka{constructor(a,c,d,g){this.property=a,this.value=c,this.expression=function(m,v,E,P){if(Hd(m))return new Ve(m,v);if(jf(m)||Array.isArray(m)&&m.length>0){const L=Ie(m,v,E,P);if(L.result==="error")throw new Error(L.value.map(A=>`${A.key}: ${A.message}`).join(", "));return L.value}{let L=m;return typeof m=="string"&&v.type==="color"&&(L=Ei.parse(m)),{kind:"constant",configDependencies:new Set,evaluate:()=>L}}}(c===void 0?a.specification.default:c,a.specification,d,g)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(a,c,d){return this.property.possiblyEvaluate(this,a,c,d)}}class $s{constructor(a,c,d){this.property=a,this.value=new ka(a,void 0,c,d)}transitioned(a,c){return new nl(this.property,this.value,c,wi({},a.transition,this.transition),a.now)}untransitioned(){return new nl(this.property,this.value,null,{},0)}}class wo{constructor(a,c,d){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues),this._scope=c,this._options=d,this.configDependencies=new Set}getValue(a){return ki(this._values[a].value.value)}setValue(a,c){this._values.hasOwnProperty(a)||(this._values[a]=new $s(this._values[a].property,this._scope,this._options)),this._values[a].value=new ka(this._values[a].property,c===null?void 0:ki(c),this._scope,this._options),this._values[a].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[a].value.expression.configDependencies]))}setTransitionOrValue(a,c){c&&(this._options=c);const d=this._properties.properties;if(a)for(const g in a){const m=a[g];if(g.endsWith("-transition")){const v=g.slice(0,-11);d[v]&&this.setTransition(v,m)}else d.hasOwnProperty(g)&&this.setValue(g,m)}}getTransition(a){return ki(this._values[a].transition)}setTransition(a,c){this._values.hasOwnProperty(a)||(this._values[a]=new $s(this._values[a].property)),this._values[a].transition=ki(c)||void 0}serialize(){const a={};for(const c of Object.keys(this._values)){const d=this.getValue(c);d!==void 0&&(a[c]=d);const g=this.getTransition(c);g!==void 0&&(a[`${c}-transition`]=g)}return a}transitioned(a,c){const d=new Cl(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].transitioned(a,c._values[g]);return d}untransitioned(){const a=new Cl(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].untransitioned();return a}}class nl{constructor(a,c,d,g,m){const v=g.delay||0,E=g.duration||0;m=m||0,this.property=a,this.value=c,this.begin=m+v,this.end=this.begin+E,a.specification.transition&&(g.delay||g.duration)&&(this.prior=d)}possiblyEvaluate(a,c,d){const g=a.now||0,m=this.value.possiblyEvaluate(a,c,d),v=this.prior;if(v){if(g>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(g<this.begin)return v.possiblyEvaluate(a,c,d);{const E=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(a,c,d),m,hr(E))}}return m}}class Cl{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)}possiblyEvaluate(a,c,d){const g=new xc(this._properties);for(const m of Object.keys(this._values))g._values[m]=this._values[m].possiblyEvaluate(a,c,d);return g}hasTransition(){for(const a of Object.keys(this._values))if(this._values[a].prior)return!0;return!1}}class Es{constructor(a,c,d){this._properties=a,this._values=Object.create(a.defaultPropertyValues),this._scope=c,this._options=d,this.configDependencies=new Set}getValue(a){return ki(this._values[a].value)}setValue(a,c){this._values[a]=new ka(this._values[a].property,c===null?void 0:ki(c),this._scope,this._options),this._values[a].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[a].expression.configDependencies]))}serialize(){const a={};for(const c of Object.keys(this._values)){const d=this.getValue(c);d!==void 0&&(a[c]=d)}return a}possiblyEvaluate(a,c,d){const g=new xc(this._properties);for(const m of Object.keys(this._values))g._values[m]=this._values[m].possiblyEvaluate(a,c,d);return g}}class Il{constructor(a,c,d){this.property=a,this.value=c,this.parameters=d}isConstant(){return this.value.kind==="constant"}constantOr(a){return this.value.kind==="constant"?this.value.value:a}evaluate(a,c,d,g){return this.property.evaluate(this.value,this.parameters,a,c,d,g)}}class xc{constructor(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)}get(a){return this._values[a]}}class En{constructor(a){this.specification=a}possiblyEvaluate(a,c){return a.expression.evaluate(c)}interpolate(a,c,d){const g=ef[this.specification.type];return g?g(a,c,d):a}}class Fn{constructor(a,c){this.specification=a,this.overrides=c}possiblyEvaluate(a,c,d,g){return new Il(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(c,null,{},d,g)}:a.expression,c)}interpolate(a,c,d){if(a.value.kind!=="constant"||c.value.kind!=="constant")return a;if(a.value.value===void 0||c.value.value===void 0)return new Il(this,{kind:"constant",value:void 0},a.parameters);const g=ef[this.specification.type];return g?new Il(this,{kind:"constant",value:g(a.value.value,c.value.value,d)},a.parameters):a}evaluate(a,c,d,g,m,v){return a.kind==="constant"?a.value:a.evaluate(c,d,g,m,v)}}class Wa{constructor(a){this.specification=a}possiblyEvaluate(a,c,d,g){return!!a.expression.evaluate(c,null,{},d,g)}interpolate(){return!1}}class Ra{constructor(a){this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const c=new bi(0,{});for(const d in a){const g=a[d];g.specification.overridable&&this.overridableProperties.push(d);const m=this.defaultPropertyValues[d]=new ka(g,void 0),v=this.defaultTransitionablePropertyValues[d]=new $s(g);this.defaultTransitioningPropertyValues[d]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[d]=m.possiblyEvaluate(c)}}}Mt(Fn,"DataDrivenProperty"),Mt(En,"DataConstantProperty"),Mt(Wa,"ColorRampProperty");var qt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"iconsets":{"experimental":true,"type":"iconsets"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"experimental":true,"type":"*"},"selectors":{"experimental":true,"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"experimental":true,"type":"string","required":true},"properties":{"experimental":true,"type":"selectorProperty","required":false},"featureNamespace":{"experimental":true,"type":"string","required":false},"_uniqueFeatureID":{"experimental":true,"type":"boolean","private":true,"required":false}},"selectorProperty":{"experimental":true,"*":{"experimental":true,"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"required":true,"type":"enum","values":{"sprite":1}},"url":{"required":true,"type":"string"}},"iconset_source":{"type":{"required":true,"type":"enum","values":{"source":1}},"source":{"required":true,"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","experimental":true,"private":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","experimental":true,"private":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"experimental":true,"private":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"*"}}}');function Up(h){return h instanceof Number||h instanceof String||h instanceof Boolean?h.valueOf():h}function sf(h){if(Array.isArray(h))return h.map(sf);if(h instanceof Object&&!(h instanceof Number||h instanceof String||h instanceof Boolean)){const a={};for(const c in h)a[c]=sf(h[c]);return a}return Up(h)}function of(h){if(h===!0||h===!1)return!0;if(!Array.isArray(h)||h.length===0)return!1;switch(h[0]){case"has":return h.length>=2&&h[1]!=="$id"&&h[1]!=="$type";case"in":return h.length>=3&&(typeof h[1]!="string"||Array.isArray(h[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return h.length!==3||Array.isArray(h[1])||Array.isArray(h[2]);case"any":case"all":for(const a of h.slice(1))if(!of(a)&&typeof a!="boolean")return!1;return!0;default:return!0}}function lf(h,a="",c=null,d="fill"){if(h==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};of(h)||(h=uf(h));const g=h;let m=!0;try{m=function(A){if(!Hc(A))return A;let O=sf(A);return cf(O),O=wc(O),O}(g)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(g,null,2)}
        `)}let v=null,E=null;if(d!=="background"&&d!=="sky"&&d!=="slot"){E=qt[`filter_${d}`];const A=q(m,E,a,c);if(A.result==="error")throw new Error(A.value.map(O=>`${O.key}: ${O.message}`).join(", "));v=(O,N,D)=>A.value.evaluate(O,N,{},D)}let P=null,L=null;if(m!==g){const A=q(g,E,a,c);if(A.result==="error")throw new Error(A.value.map(O=>`${O.key}: ${O.message}`).join(", "));P=(O,N,D,k,U)=>A.value.evaluate(O,N,{},D,void 0,void 0,k,U),L=!jo(A.value.expression)}return{filter:v,dynamicFilter:P||void 0,needGeometry:zm(m),needFeature:!!L}}function wc(h){if(!Array.isArray(h))return h;const a=function(c){if(Nm.has(c[0])){for(let d=1;d<c.length;d++)if(Hc(c[d]))return!0}return c}(h);return a===!0?a:a.map(c=>wc(c))}function cf(h){let a=!1;const c=[];if(h[0]==="case"){for(let d=1;d<h.length-1;d+=2)a=a||Hc(h[d]),c.push(h[d+1]);c.push(h[h.length-1])}else if(h[0]==="match"){a=a||Hc(h[1]);for(let d=2;d<h.length-1;d+=2)c.push(h[d+1]);c.push(h[h.length-1])}else if(h[0]==="step"){a=a||Hc(h[1]);for(let d=1;d<h.length-1;d+=2)c.push(h[d+1])}a&&(h.length=0,h.push("any",...c));for(let d=1;d<h.length;d++)cf(h[d])}function Hc(h){if(!Array.isArray(h))return!1;if((a=h[0])==="pitch"||a==="distance-from-center")return!0;var a;for(let c=1;c<h.length;c++)if(Hc(h[c]))return!0;return!1}const Nm=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Gd(h,a){return h<a?-1:h>a?1:0}function zm(h){if(!Array.isArray(h))return!1;if(h[0]==="within"||h[0]==="distance")return!0;for(let a=1;a<h.length;a++)if(zm(h[a]))return!0;return!1}function uf(h){if(!h)return!0;const a=h[0];return h.length<=1?a!=="any":a==="=="?Pl(h[1],h[2],"=="):a==="!="?Gu(Pl(h[1],h[2],"==")):a==="<"||a===">"||a==="<="||a===">="?Pl(h[1],h[2],a):a==="any"?(c=h.slice(1),["any"].concat(c.map(uf))):a==="all"?["all"].concat(h.slice(1).map(uf)):a==="none"?["all"].concat(h.slice(1).map(uf).map(Gu)):a==="in"?Ff(h[1],h.slice(2)):a==="!in"?Gu(Ff(h[1],h.slice(2))):a==="has"?Hu(h[1]):a!=="!has"||Gu(Hu(h[1]));var c}function Pl(h,a,c){switch(h){case"$type":return[`filter-type-${c}`,a];case"$id":return[`filter-id-${c}`,a];default:return[`filter-${c}`,h,a]}}function Ff(h,a){if(a.length===0)return!1;switch(h){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some(c=>typeof c!=typeof a[0])?["filter-in-large",h,["literal",a.sort(Gd)]]:["filter-in-small",h,["literal",a]]}}function Hu(h){switch(h){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",h]}}function Gu(h){return["!",h]}const Wd="";function Wu(h,a){return a?`${h}${Wd}${a}`:h}const rl="-transition",Bm=new Set(["fill","line","background","hillshade","raster"]);class eo extends ql{constructor(a,c,d,g,m){if(super(),this.id=a.id,this.fqid=Wu(this.id,d),this.type=a.type,this.scope=d,this.lut=g,this.options=m,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,a.type!=="custom"){if(this.metadata=a.metadata,this.minzoom=a.minzoom,this.maxzoom=a.maxzoom,a.type&&a.type!=="background"&&a.type!=="sky"&&a.type!=="slot"){this.source=a.source,this.sourceLayer=a["source-layer"],this.filter=a.filter;const v=q(this.filter,qt[`filter_${a.type}`]);v.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...v.value.configDependencies]))}if(a.slot&&(this.slot=a.slot),c.layout&&(this._unevaluatedLayout=new Es(c.layout,this.scope,m),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),c.paint){this._transitionablePaint=new wo(c.paint,this.scope,m);for(const v in a.paint)this.setPaintProperty(v,a.paint[v]);for(const v in a.layout)this.setLayoutProperty(v,a.layout[v]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new xc(c.paint)}}}onAdd(a){}onRemove(a){}isDraped(a){return!this.is3D(!0)&&Bm.has(this.type)}getLayoutProperty(a){return a==="visibility"?this.visibility:this._unevaluatedLayout.getValue(a)}setLayoutProperty(a,c){if(this.type==="custom"&&a==="visibility")return void(this.visibility=c);const d=this._unevaluatedLayout;d._properties.properties[a]&&(d.setValue(a,c),this.configDependencies=new Set([...this.configDependencies,...d.configDependencies]),a==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(a){return a.endsWith(rl)?this._transitionablePaint.getTransition(a.slice(0,-11)):this._transitionablePaint.getValue(a)}setPaintProperty(a,c){const d=this._transitionablePaint,g=d._properties.properties;if(a.endsWith(rl)){const O=a.slice(0,-11);return g[O]&&d.setTransition(O,c||void 0),!1}if(!g[a])return!1;const m=d._values[a],v=m.value.isDataDriven(),E=m.value;d.setValue(a,c),this.configDependencies=new Set([...this.configDependencies,...d.configDependencies]),this._handleSpecialPaintPropertyUpdate(a);const P=d._values[a].value,L=P.isDataDriven(),A=a.endsWith("pattern")||a==="line-dasharray";return L||v||A||this._handleOverridablePaintPropertyUpdate(a,E,P)}_handleSpecialPaintPropertyUpdate(a){}getProgramIds(){return null}getDefaultProgramParams(a,c,d){return null}_handleOverridablePaintPropertyUpdate(a,c,d){return!1}isHidden(a){return!!(this.minzoom&&a<this.minzoom)||!!(this.maxzoom&&a>=this.maxzoom)||this.visibility==="none"}updateTransitions(a){this._transitioningPaint=this._transitionablePaint.transitioned(a,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(a,c){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(a,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(a,void 0,c)}serialize(){return Vi({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(a,c)=>!(a===void 0||c==="layout"&&!Object.keys(a).length||c==="paint"&&!Object.keys(a).length))}is3D(a){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const a in this.paint._values){const c=this.paint.get(a);if(c instanceof Il&&qu(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1}compileFilter(a){this._filterCompiled||(this._featureFilter=lf(this.filter,this.scope,a),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(a){this._stats&&(a.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(a){}queryIntersectsFeature(a,c,d,g,m,v,E,P,L){}}const Pg={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class hf{constructor(a,c){this._structArray=a,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class na{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(a,c){return a._trim(),c&&(a.isTransferred=!0,c.add(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}}static deserialize(a){const c=Object.create(this.prototype);return c.arrayBuffer=a.arrayBuffer,c.length=a.length,c.capacity=a.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(a){this.reserve(a),this.length=a}reserve(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...a){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...a){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Mi(h,a=1){let c=0,d=0;return{members:h.map(g=>{const m=Pg[g.type].BYTES_PER_ELEMENT,v=c=Kd(c,Math.max(a,m)),E=g.components||1;return d=Math.max(d,m),c+=m*E,{name:g.name,type:g.type,components:E,offset:v}}),size:Kd(c,Math.max(d,a)),alignment:a}}function Kd(h,a){return Math.ceil(h/a)*a}class Sc extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c){const d=this.length;return this.resize(d+1),this.emplace(d,a,c)}emplace(a,c,d){const g=2*a;return this.int16[g+0]=c,this.int16[g+1]=d,a}}Sc.prototype.bytesPerElement=4,Mt(Sc,"StructArrayLayout2i4");class Lh extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,a,c,d)}emplace(a,c,d,g){const m=3*a;return this.int16[m+0]=c,this.int16[m+1]=d,this.int16[m+2]=g,a}}Lh.prototype.bytesPerElement=6,Mt(Lh,"StructArrayLayout3i6");class Ac extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,d,g){const m=this.length;return this.resize(m+1),this.emplace(m,a,c,d,g)}emplace(a,c,d,g,m){const v=4*a;return this.int16[v+0]=c,this.int16[v+1]=d,this.int16[v+2]=g,this.int16[v+3]=m,a}}Ac.prototype.bytesPerElement=8,Mt(Ac,"StructArrayLayout4i8");class Ku extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a){const c=this.length;return this.resize(c+1),this.emplace(c,a)}emplace(a,c){return this.float32[1*a+0]=c,a}}Ku.prototype.bytesPerElement=4,Mt(Ku,"StructArrayLayout1f4");class vd extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,a,c,d)}emplace(a,c,d,g){const m=4*a,v=2*a;return this.int16[m+0]=c,this.int16[m+1]=d,this.float32[v+1]=g,a}}vd.prototype.bytesPerElement=8,Mt(vd,"StructArrayLayout2i1f8");class Uf extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,a,c,d)}emplace(a,c,d,g){const m=4*a;return this.int16[m+0]=c,this.int16[m+1]=d,this.int16[m+2]=g,a}}Uf.prototype.bytesPerElement=8,Mt(Uf,"StructArrayLayout3i8");class Ol extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,d,g,m){const v=this.length;return this.resize(v+1),this.emplace(v,a,c,d,g,m)}emplace(a,c,d,g,m,v){const E=5*a;return this.int16[E+0]=c,this.int16[E+1]=d,this.int16[E+2]=g,this.int16[E+3]=m,this.int16[E+4]=v,a}}Ol.prototype.bytesPerElement=10,Mt(Ol,"StructArrayLayout5i10");class bd extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,d,g,m,v,E){const P=this.length;return this.resize(P+1),this.emplace(P,a,c,d,g,m,v,E)}emplace(a,c,d,g,m,v,E,P){const L=6*a,A=12*a,O=3*a;return this.int16[L+0]=c,this.int16[L+1]=d,this.uint8[A+4]=g,this.uint8[A+5]=m,this.uint8[A+6]=v,this.uint8[A+7]=E,this.float32[O+2]=P,a}}bd.prototype.bytesPerElement=12,Mt(bd,"StructArrayLayout2i4ub1f12");class So extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,a,c,d)}emplace(a,c,d,g){const m=3*a;return this.float32[m+0]=c,this.float32[m+1]=d,this.float32[m+2]=g,a}}So.prototype.bytesPerElement=12,Mt(So,"StructArrayLayout3f12");class kh extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,d,g,m){const v=this.length;return this.resize(v+1),this.emplace(v,a,c,d,g,m)}emplace(a,c,d,g,m,v){const E=6*a,P=3*a;return this.uint16[E+0]=c,this.uint16[E+1]=d,this.uint16[E+2]=g,this.uint16[E+3]=m,this.float32[P+2]=v,a}}kh.prototype.bytesPerElement=12,Mt(kh,"StructArrayLayout4ui1f12");class Yd extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,c,d,g){const m=this.length;return this.resize(m+1),this.emplace(m,a,c,d,g)}emplace(a,c,d,g,m){const v=4*a;return this.uint16[v+0]=c,this.uint16[v+1]=d,this.uint16[v+2]=g,this.uint16[v+3]=m,a}}Yd.prototype.bytesPerElement=8,Mt(Yd,"StructArrayLayout4ui8");class Xd extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,d,g,m,v){const E=this.length;return this.resize(E+1),this.emplace(E,a,c,d,g,m,v)}emplace(a,c,d,g,m,v,E){const P=6*a;return this.int16[P+0]=c,this.int16[P+1]=d,this.int16[P+2]=g,this.int16[P+3]=m,this.int16[P+4]=v,this.int16[P+5]=E,a}}Xd.prototype.bytesPerElement=12,Mt(Xd,"StructArrayLayout6i12");class ff extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,c,d,g,m,v,E,P,L,A,O,N){const D=this.length;return this.resize(D+1),this.emplace(D,a,c,d,g,m,v,E,P,L,A,O,N)}emplace(a,c,d,g,m,v,E,P,L,A,O,N,D){const k=12*a;return this.int16[k+0]=c,this.int16[k+1]=d,this.int16[k+2]=g,this.int16[k+3]=m,this.uint16[k+4]=v,this.uint16[k+5]=E,this.uint16[k+6]=P,this.uint16[k+7]=L,this.int16[k+8]=A,this.int16[k+9]=O,this.int16[k+10]=N,this.int16[k+11]=D,a}}ff.prototype.bytesPerElement=24,Mt(ff,"StructArrayLayout4i4ui4i24");class Yu extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,d,g,m,v){const E=this.length;return this.resize(E+1),this.emplace(E,a,c,d,g,m,v)}emplace(a,c,d,g,m,v,E){const P=10*a,L=5*a;return this.int16[P+0]=c,this.int16[P+1]=d,this.int16[P+2]=g,this.float32[L+2]=m,this.float32[L+3]=v,this.float32[L+4]=E,a}}Yu.prototype.bytesPerElement=20,Mt(Yu,"StructArrayLayout3i3f20");class Xu extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,d,g){const m=this.length;return this.resize(m+1),this.emplace(m,a,c,d,g)}emplace(a,c,d,g,m){const v=4*a;return this.float32[v+0]=c,this.float32[v+1]=d,this.float32[v+2]=g,this.float32[v+3]=m,a}}Xu.prototype.bytesPerElement=16,Mt(Xu,"StructArrayLayout4f16");class Zd extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a){const c=this.length;return this.resize(c+1),this.emplace(c,a)}emplace(a,c){return this.uint32[1*a+0]=c,a}}Zd.prototype.bytesPerElement=4,Mt(Zd,"StructArrayLayout1ul4");class Nh extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,c){const d=this.length;return this.resize(d+1),this.emplace(d,a,c)}emplace(a,c,d){const g=2*a;return this.uint16[g+0]=c,this.uint16[g+1]=d,a}}Nh.prototype.bytesPerElement=4,Mt(Nh,"StructArrayLayout2ui4");class Tc extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,c,d,g,m,v,E,P,L,A,O,N,D){const k=this.length;return this.resize(k+1),this.emplace(k,a,c,d,g,m,v,E,P,L,A,O,N,D)}emplace(a,c,d,g,m,v,E,P,L,A,O,N,D,k){const U=20*a,X=10*a;return this.int16[U+0]=c,this.int16[U+1]=d,this.int16[U+2]=g,this.int16[U+3]=m,this.int16[U+4]=v,this.float32[X+3]=E,this.float32[X+4]=P,this.float32[X+5]=L,this.float32[X+6]=A,this.int16[U+14]=O,this.uint32[X+8]=N,this.uint16[U+18]=D,this.uint16[U+19]=k,a}}Tc.prototype.bytesPerElement=40,Mt(Tc,"StructArrayLayout5i4f1i1ul2ui40");class _u extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,d,g,m,v,E){const P=this.length;return this.resize(P+1),this.emplace(P,a,c,d,g,m,v,E)}emplace(a,c,d,g,m,v,E,P){const L=8*a;return this.int16[L+0]=c,this.int16[L+1]=d,this.int16[L+2]=g,this.int16[L+4]=m,this.int16[L+5]=v,this.int16[L+6]=E,this.int16[L+7]=P,a}}_u.prototype.bytesPerElement=16,Mt(_u,"StructArrayLayout3i2i2i16");class Jl extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,d,g,m){const v=this.length;return this.resize(v+1),this.emplace(v,a,c,d,g,m)}emplace(a,c,d,g,m,v){const E=4*a,P=8*a;return this.float32[E+0]=c,this.float32[E+1]=d,this.float32[E+2]=g,this.int16[P+6]=m,this.int16[P+7]=v,a}}Jl.prototype.bytesPerElement=16,Mt(Jl,"StructArrayLayout2f1f2i16");class vu extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,d,g,m,v){const E=this.length;return this.resize(E+1),this.emplace(E,a,c,d,g,m,v)}emplace(a,c,d,g,m,v,E){const P=20*a,L=5*a;return this.uint8[P+0]=c,this.uint8[P+1]=d,this.float32[L+1]=g,this.float32[L+2]=m,this.float32[L+3]=v,this.float32[L+4]=E,a}}vu.prototype.bytesPerElement=20,Mt(vu,"StructArrayLayout2ub4f20");class Ms extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,a,c,d)}emplace(a,c,d,g){const m=3*a;return this.uint16[m+0]=c,this.uint16[m+1]=d,this.uint16[m+2]=g,a}}Ms.prototype.bytesPerElement=6,Mt(Ms,"StructArrayLayout3ui6");class Ql extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a,c,d,g,m,v,E,P,L,A,O,N,D,k,U,X,Q,le,oe,re,me){const Se=this.length;return this.resize(Se+1),this.emplace(Se,a,c,d,g,m,v,E,P,L,A,O,N,D,k,U,X,Q,le,oe,re,me)}emplace(a,c,d,g,m,v,E,P,L,A,O,N,D,k,U,X,Q,le,oe,re,me,Se){const Me=30*a,We=15*a,$e=60*a;return this.int16[Me+0]=c,this.int16[Me+1]=d,this.int16[Me+2]=g,this.float32[We+2]=m,this.float32[We+3]=v,this.uint16[Me+8]=E,this.uint16[Me+9]=P,this.uint32[We+5]=L,this.uint32[We+6]=A,this.uint32[We+7]=O,this.uint16[Me+16]=N,this.uint16[Me+17]=D,this.uint16[Me+18]=k,this.float32[We+10]=U,this.float32[We+11]=X,this.uint8[$e+48]=Q,this.uint8[$e+49]=le,this.uint8[$e+50]=oe,this.uint32[We+13]=re,this.int16[Me+28]=me,this.uint8[$e+58]=Se,a}}Ql.prototype.bytesPerElement=60,Mt(Ql,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Gc extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a,c,d,g,m,v,E,P,L,A,O,N,D,k,U,X,Q,le,oe,re,me,Se,Me,We,$e,He,ht,Ke,pt,Et,wt,Ot,It){const jt=this.length;return this.resize(jt+1),this.emplace(jt,a,c,d,g,m,v,E,P,L,A,O,N,D,k,U,X,Q,le,oe,re,me,Se,Me,We,$e,He,ht,Ke,pt,Et,wt,Ot,It)}emplace(a,c,d,g,m,v,E,P,L,A,O,N,D,k,U,X,Q,le,oe,re,me,Se,Me,We,$e,He,ht,Ke,pt,Et,wt,Ot,It,jt){const Dt=20*a,Vt=40*a,_n=80*a;return this.float32[Dt+0]=c,this.float32[Dt+1]=d,this.int16[Vt+4]=g,this.int16[Vt+5]=m,this.int16[Vt+6]=v,this.int16[Vt+7]=E,this.int16[Vt+8]=P,this.int16[Vt+9]=L,this.int16[Vt+10]=A,this.int16[Vt+11]=O,this.int16[Vt+12]=N,this.uint16[Vt+13]=D,this.uint16[Vt+14]=k,this.uint16[Vt+15]=U,this.uint16[Vt+16]=X,this.uint16[Vt+17]=Q,this.uint16[Vt+18]=le,this.uint16[Vt+19]=oe,this.uint16[Vt+20]=re,this.uint16[Vt+21]=me,this.uint16[Vt+22]=Se,this.uint16[Vt+23]=Me,this.uint16[Vt+24]=We,this.uint16[Vt+25]=$e,this.uint16[Vt+26]=He,this.uint16[Vt+27]=ht,this.uint32[Dt+14]=Ke,this.float32[Dt+15]=pt,this.float32[Dt+16]=Et,this.float32[Dt+17]=wt,this.float32[Dt+18]=Ot,this.uint8[_n+76]=It,this.uint16[Vt+39]=jt,a}}Gc.prototype.bytesPerElement=80,Mt(Gc,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Hs extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,d,g,m){const v=this.length;return this.resize(v+1),this.emplace(v,a,c,d,g,m)}emplace(a,c,d,g,m,v){const E=5*a;return this.float32[E+0]=c,this.float32[E+1]=d,this.float32[E+2]=g,this.float32[E+3]=m,this.float32[E+4]=v,a}}Hs.prototype.bytesPerElement=20,Mt(Hs,"StructArrayLayout5f20");class Ec extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,d,g,m,v,E){const P=this.length;return this.resize(P+1),this.emplace(P,a,c,d,g,m,v,E)}emplace(a,c,d,g,m,v,E,P){const L=7*a;return this.float32[L+0]=c,this.float32[L+1]=d,this.float32[L+2]=g,this.float32[L+3]=m,this.float32[L+4]=v,this.float32[L+5]=E,this.float32[L+6]=P,a}}Ec.prototype.bytesPerElement=28,Mt(Ec,"StructArrayLayout7f28");class df extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,d,g,m,v,E,P,L,A,O){const N=this.length;return this.resize(N+1),this.emplace(N,a,c,d,g,m,v,E,P,L,A,O)}emplace(a,c,d,g,m,v,E,P,L,A,O,N){const D=11*a;return this.float32[D+0]=c,this.float32[D+1]=d,this.float32[D+2]=g,this.float32[D+3]=m,this.float32[D+4]=v,this.float32[D+5]=E,this.float32[D+6]=P,this.float32[D+7]=L,this.float32[D+8]=A,this.float32[D+9]=O,this.float32[D+10]=N,a}}df.prototype.bytesPerElement=44,Mt(df,"StructArrayLayout11f44");class Jd extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,d,g,m,v,E,P,L){const A=this.length;return this.resize(A+1),this.emplace(A,a,c,d,g,m,v,E,P,L)}emplace(a,c,d,g,m,v,E,P,L,A){const O=9*a;return this.float32[O+0]=c,this.float32[O+1]=d,this.float32[O+2]=g,this.float32[O+3]=m,this.float32[O+4]=v,this.float32[O+5]=E,this.float32[O+6]=P,this.float32[O+7]=L,this.float32[O+8]=A,a}}Jd.prototype.bytesPerElement=36,Mt(Jd,"StructArrayLayout9f36");class qf extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c){const d=this.length;return this.resize(d+1),this.emplace(d,a,c)}emplace(a,c,d){const g=2*a;return this.float32[g+0]=c,this.float32[g+1]=d,a}}qf.prototype.bytesPerElement=8,Mt(qf,"StructArrayLayout2f8");class pf extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,c,d,g){const m=this.length;return this.resize(m+1),this.emplace(m,a,c,d,g)}emplace(a,c,d,g,m){const v=6*a;return this.uint32[3*a+0]=c,this.uint16[v+2]=d,this.uint16[v+3]=g,this.uint16[v+4]=m,a}}pf.prototype.bytesPerElement=12,Mt(pf,"StructArrayLayout1ul3ui12");class zh extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a){const c=this.length;return this.resize(c+1),this.emplace(c,a)}emplace(a,c){return this.uint16[1*a+0]=c,a}}zh.prototype.bytesPerElement=2,Mt(zh,"StructArrayLayout1ui2");class jm extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,d,g,m,v,E,P,L,A,O,N,D,k,U,X){const Q=this.length;return this.resize(Q+1),this.emplace(Q,a,c,d,g,m,v,E,P,L,A,O,N,D,k,U,X)}emplace(a,c,d,g,m,v,E,P,L,A,O,N,D,k,U,X,Q){const le=16*a;return this.float32[le+0]=c,this.float32[le+1]=d,this.float32[le+2]=g,this.float32[le+3]=m,this.float32[le+4]=v,this.float32[le+5]=E,this.float32[le+6]=P,this.float32[le+7]=L,this.float32[le+8]=A,this.float32[le+9]=O,this.float32[le+10]=N,this.float32[le+11]=D,this.float32[le+12]=k,this.float32[le+13]=U,this.float32[le+14]=X,this.float32[le+15]=Q,a}}jm.prototype.bytesPerElement=64,Mt(jm,"StructArrayLayout16f64");class qp extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,d,g,m,v,E){const P=this.length;return this.resize(P+1),this.emplace(P,a,c,d,g,m,v,E)}emplace(a,c,d,g,m,v,E,P){const L=10*a,A=5*a;return this.uint16[L+0]=c,this.uint16[L+1]=d,this.uint16[L+2]=g,this.uint16[L+3]=m,this.float32[A+2]=v,this.float32[A+3]=E,this.float32[A+4]=P,a}}qp.prototype.bytesPerElement=20,Mt(qp,"StructArrayLayout4ui3f20");class Fm extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a){const c=this.length;return this.resize(c+1),this.emplace(c,a)}emplace(a,c){return this.int16[1*a+0]=c,a}}Fm.prototype.bytesPerElement=2,Mt(Fm,"StructArrayLayout1i2");class Og extends na{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(a){const c=this.length;return this.resize(c+1),this.emplace(c,a)}emplace(a,c){return this.uint8[1*a+0]=c,a}}Og.prototype.bytesPerElement=1,Mt(Og,"StructArrayLayout1ub1");class Fy extends hf{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Fy.prototype.size=40;class Vp extends Tc{get(a){return new Fy(this,a)}}Mt(Vp,"CollisionBoxArray");class il extends hf{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(a){this._structArray.uint8[this._pos1+49]=a}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(a){this._structArray.uint8[this._pos1+50]=a}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(a){this._structArray.uint32[this._pos4+13]=a}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(a){this._structArray.uint8[this._pos1+58]=a}}il.prototype.size=60;class dl extends Ql{get(a){return new il(this,a)}}Mt(dl,"PlacedSymbolArray");class Uy extends hf{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(a){this._structArray.uint32[this._pos4+14]=a}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(a){this._structArray.float32[this._pos4+18]=a}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Uy.prototype.size=80;class qy extends Gc{get(a){return new Uy(this,a)}}Mt(qy,"SymbolInstanceArray");class Vy extends Ku{getoffsetX(a){return this.float32[1*a+0]}}Mt(Vy,"GlyphOffsetArray");class $p extends Sc{getx(a){return this.int16[2*a+0]}gety(a){return this.int16[2*a+1]}}Mt($p,"SymbolLineVertexArray");class Hp extends hf{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Hp.prototype.size=12;class pl extends pf{get(a){return new Hp(this,a)}}Mt(pl,"FeatureIndexArray");class Qd extends Nh{geta_centroid_pos0(a){return this.uint16[2*a+0]}geta_centroid_pos1(a){return this.uint16[2*a+1]}}Mt(Qd,"FillExtrusionCentroidArray");class $y extends hf{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}$y.prototype.size=6;class Hy extends Lh{get(a){return new $y(this,a)}}Mt(Hy,"FillExtrusionWallArray");const Sv=Mi([{name:"a_pos",components:2,type:"Int16"}],4),Gy=Mi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Da{constructor(a=[]){this.segments=a}_prepareSegment(a,c,d,g){let m=this.segments[this.segments.length-1];return a>Da.MAX_VERTEX_ARRAY_LENGTH&&ti(`Max vertices per segment is ${Da.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${a}`),(!m||m.vertexLength+a>Da.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==g)&&(m={vertexOffset:c,primitiveOffset:d,vertexLength:0,primitiveLength:0},g!==void 0&&(m.sortKey=g),this.segments.push(m)),m}prepareSegment(a,c,d,g){return this._prepareSegment(a,c.length,d.length,g)}get(){return this.segments}destroy(){for(const a of this.segments)for(const c in a.vaos)a.vaos[c].destroy()}static simpleSegment(a,c,d,g){return new Da([{vertexOffset:a,primitiveOffset:c,vertexLength:d,primitiveLength:g,vaos:{},sortKey:0}])}}function Rg(h,a){return 256*(h=Un(Math.floor(h),0,255))+Un(Math.floor(a),0,255)}Da.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Mt(Da,"SegmentVector");const Dg=Mi([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Wy=Mi([{name:"a_dash",components:4,type:"Uint16"}]);class ep{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(a,c,d,g){this.ids.push(Um(a)),this.positions.push(c,d,g)}eachPosition(a,c){const d=Um(a);let g=0,m=this.ids.length-1;for(;g<m;){const v=g+m>>1;this.ids[v]>=d?m=v:g=v+1}for(;this.ids[g]===d;)c(this.positions[3*g],this.positions[3*g+1],this.positions[3*g+2]),g++}static serialize(a,c){const d=new Float64Array(a.ids),g=new Uint32Array(a.positions);return Gp(d,g,0,d.length-1),c&&(c.add(d.buffer),c.add(g.buffer)),{ids:d,positions:g}}static deserialize(a){const c=new ep;let d;c.ids=a.ids,c.positions=a.positions;for(const g of c.ids)g!==d&&c.uniqueIds.push(g),d=g;return c.indexed=!0,c}}function Um(h){const a=+h;return!isNaN(a)&&Number.MIN_SAFE_INTEGER<=a&&a<=Number.MAX_SAFE_INTEGER?a:so(String(h))}function Gp(h,a,c,d){for(;c<d;){const g=h[c+d>>1];let m=c-1,v=d+1;for(;;){do m++;while(h[m]<g);do v--;while(h[v]>g);if(m>=v)break;Wp(h,m,v),Wp(a,3*m,3*v),Wp(a,3*m+1,3*v+1),Wp(a,3*m+2,3*v+2)}v-c<d-v?(Gp(h,a,c,v),c=v+1):(Gp(h,a,v+1,d),d=v)}}function Wp(h,a,c){const d=h[a];h[a]=h[c],h[c]=d}Mt(ep,"FeaturePositionMap");class Bh{constructor(a){this.gl=a.gl,this.initialized=!1}fetchUniformLocation(a,c){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(a,c),this.initialized=!0),!!this.location}set(a,c,d){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class bu extends Bh{constructor(a){super(a),this.current=0}set(a,c,d){this.fetchUniformLocation(a,c)&&this.current!==d&&(this.current=d,this.gl.uniform1i(this.location,d))}}class ps extends Bh{constructor(a){super(a),this.current=0}set(a,c,d){this.fetchUniformLocation(a,c)&&this.current!==d&&(this.current=d,this.gl.uniform1f(this.location,d))}}class Zu extends Bh{constructor(a){super(a),this.current=[0,0]}set(a,c,d){this.fetchUniformLocation(a,c)&&(d[0]===this.current[0]&&d[1]===this.current[1]||(this.current=d,this.gl.uniform2f(this.location,d[0],d[1])))}}class tp extends Bh{constructor(a){super(a),this.current=[0,0,0]}set(a,c,d){this.fetchUniformLocation(a,c)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]||(this.current=d,this.gl.uniform3f(this.location,d[0],d[1],d[2])))}}class np extends Bh{constructor(a){super(a),this.current=[0,0,0,0]}set(a,c,d){this.fetchUniformLocation(a,c)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]&&d[3]===this.current[3]||(this.current=d,this.gl.uniform4f(this.location,d[0],d[1],d[2],d[3])))}}class xd extends Bh{constructor(a){super(a),this.current=Ei.transparent.toRenderColor(null)}set(a,c,d){this.fetchUniformLocation(a,c)&&(d.r===this.current.r&&d.g===this.current.g&&d.b===this.current.b&&d.a===this.current.a||(this.current=d,this.gl.uniform4f(this.location,d.r,d.g,d.b,d.a)))}}const mf=new Float32Array(16);class Ju extends Bh{constructor(a){super(a),this.current=mf}set(a,c,d){if(this.fetchUniformLocation(a,c)){if(d[12]!==this.current[12]||d[0]!==this.current[0])return this.current=d,void this.gl.uniformMatrix4fv(this.location,!1,d);for(let g=1;g<16;g++)if(d[g]!==this.current[g]){this.current=d,this.gl.uniformMatrix4fv(this.location,!1,d);break}}}}const jh=new Float32Array(9),Ky=new Float32Array(4);class qm extends Bh{constructor(a){super(a),this.current=Ky}set(a,c,d){if(this.fetchUniformLocation(a,c)){for(let g=0;g<4;g++)if(d[g]!==this.current[g]){this.current=d,this.gl.uniformMatrix2fv(this.location,!1,d);break}}}}function rp(h){return[Rg(255*h.r,255*h.g),Rg(255*h.b,255*h.a)]}class wd{constructor(a,c,d,g){this.value=a,this.uniformNames=c.map(m=>`u_${m}`),this.type=d,this.context=g}setUniform(a,c,d,g,m){const v=g.constantOr(this.value);c.set(a,m,v instanceof Ei?v.toRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):v)}getBinding(a,c){return this.type==="color"?new xd(a):new ps(a)}}class xu{constructor(a,c){this.uniformNames=c.map(d=>`u_${d}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(a){this.pixelRatio=a.pixelRatio||1,this.pattern=a.tl.concat(a.br)}setUniform(a,c,d,g,m){const v=m==="u_pattern"||m==="u_dash"?this.pattern:m==="u_pixel_ratio"?this.pixelRatio:null;v&&c.set(a,m,v)}getBinding(a,c){return c==="u_pattern"||c==="u_dash"?new np(a):new ps(a)}}class Gs{constructor(a,c,d,g){this.expression=a,this.type=d,this.maxValue=0,this.paintVertexAttributes=c.map(m=>({name:`a_${m}`,type:"Float32",components:d==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(a,c,d,g,m,v,E){const P=this.paintVertexArray.length,L=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new bi(0,{brightness:v}),c,{},m,g,E):this.expression.kind==="constant"&&this.expression.value,A=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new bi(0,{brightness:v}),c,{},m,g,E):this.lutExpression.value)==="none";this.paintVertexArray.resize(a),this._setPaintValue(P,a,L,A?null:this.context.lut)}updatePaintArray(a,c,d,g,m,v,E){const P=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:E},d,g,void 0,m):this.expression.kind==="constant"&&this.expression.value,L=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new bi(0,{brightness:E}),d,g,void 0,m):this.lutExpression.value)==="none";this._setPaintValue(a,c,P,L?null:this.context.lut)}_setPaintValue(a,c,d,g){if(this.type==="color"){const m=rp(d.toRenderColor(g));for(let v=a;v<c;v++)this.paintVertexArray.emplace(v,m[0],m[1])}else{for(let m=a;m<c;m++)this.paintVertexArray.emplace(m,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Wc{constructor(a,c,d,g,m,v){this.expression=a,this.uniformNames=c.map(E=>`u_${E}_t`),this.type=d,this.useIntegerZoom=g,this.context=m,this.maxValue=0,this.paintVertexAttributes=c.map(E=>({name:`a_${E}`,type:"Float32",components:d==="color"?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(a,c,d,g,m,v,E){const P=this.expression.evaluate(new bi(this.context.zoom,{brightness:v}),c,{},m,g,E),L=this.expression.evaluate(new bi(this.context.zoom+1,{brightness:v}),c,{},m,g,E),A=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new bi(0,{brightness:v}),c,{},m,g,E):this.lutExpression.value)==="none",O=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(O,a,P,L,A?null:this.context.lut)}updatePaintArray(a,c,d,g,m,v,E){const P=this.expression.evaluate({zoom:this.context.zoom,brightness:E},d,g,void 0,m),L=this.expression.evaluate({zoom:this.context.zoom+1,brightness:E},d,g,void 0,m),A=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new bi(0,{brightness:E}),d,g,void 0,m):this.lutExpression.value)==="none";this._setPaintValue(a,c,P,L,A?null:this.context.lut)}_setPaintValue(a,c,d,g,m){if(this.type==="color"){const v=rp(d.toRenderColor(m)),E=rp(d.toRenderColor(m));for(let P=a;P<c;P++)this.paintVertexArray.emplace(P,v[0],v[1],E[0],E[1])}else{for(let v=a;v<c;v++)this.paintVertexArray.emplace(v,d,g);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(g))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(a,c,d,g,m){const v=this.useIntegerZoom?Math.floor(d.zoom):d.zoom,E=Un(this.expression.interpolationFactor(v,this.context.zoom,this.context.zoom+1),0,1);c.set(a,m,E)}getBinding(a,c){return new ps(a)}}class Vf{constructor(a,c,d,g,m){this.expression=a,this.layerId=m,this.paintVertexAttributes=(d==="array"?Wy:Dg).members;for(let v=0;v<c.length;++v);this.paintVertexArray=new g}populatePaintArray(a,c,d,g){const m=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValues(m,a,c.patterns&&c.patterns[this.layerId],d)}updatePaintArray(a,c,d,g,m,v,E){this._setPaintValues(a,c,d.patterns&&d.patterns[this.layerId],v)}_setPaintValues(a,c,d,g){if(!g||!d)return;const m=g[d];if(!m)return;const{tl:v,br:E,pixelRatio:P}=m;for(let L=a;L<c;L++)this.paintVertexArray.emplace(L,v[0],v[1],E[0],E[1],P)}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Kc{constructor(a,c,d=()=>!0){this.binders={},this._buffers=[],this.context=c;const g=[];for(const m in a.paint._values){const v=a.paint.get(m);if(m.endsWith("-use-theme")||!d(m)||!(v instanceof Il&&qu(v.property.specification)))continue;const E=Sd(m,a.type),P=v.value,L=v.property.specification.type,A=!!v.property.useIntegerZoom,O=m==="line-dasharray"||m.endsWith("pattern"),N=a.paint.get(`${m}-use-theme`),D=m==="line-dasharray"&&a.layout.get("line-cap").value.kind!=="constant"||N&&N.value.kind!=="constant";if(P.kind!=="constant"||D)if(P.kind==="source"||D||O){const k=Lg(m,L,"source");this.binders[m]=O?new Vf(P,E,L,k,a.id):new Gs(P,E,L,k),g.push(`/a_${m}`)}else{const k=Lg(m,L,"composite");this.binders[m]=new Wc(P,E,L,A,c,k),g.push(`/z_${m}`)}else this.binders[m]=O?new xu(P.value,E):new wd(P.value,E,L,c),g.push(`/u_${m}`);N&&(this.binders[m].lutExpression=N.value)}this.cacheKey=g.sort().join("")}getMaxValue(a){const c=this.binders[a];return c instanceof Gs||c instanceof Wc?c.maxValue:0}populatePaintArrays(a,c,d,g,m,v,E){for(const P in this.binders){const L=this.binders[P];L.context=this.context,(L instanceof Gs||L instanceof Wc||L instanceof Vf)&&L.populatePaintArray(a,c,d,g,m,v,E)}}setConstantPatternPositions(a){for(const c in this.binders){const d=this.binders[c];d instanceof xu&&d.setConstantPatternPositions(a)}}updatePaintArrays(a,c,d,g,m,v,E,P,L){let A=!1;const O=Object.keys(a),N=O.length!==0&&!P,D=N?O:c.uniqueIds;this.context.lut=m.lut;for(const k in this.binders){const U=this.binders[k];if(U.context=this.context,(U instanceof Gs||U instanceof Wc||U instanceof Vf)&&U.expression&&U.expression.kind&&U.expression.kind!=="constant"&&(U.expression.isStateDependent===!0||U.expression.isLightConstant===!1)){const X=m.paint.get(k);U.expression=X.value;for(const Q of D){const le=a[Q.toString()];c.eachPosition(Q,(oe,re,me)=>{const Se=g.feature(oe);U.updatePaintArray(re,me,Se,le,v,E,L)})}if(!N)for(const Q of d.uniqueIds){const le=a[Q.toString()];d.eachPosition(Q,(oe,re,me)=>{const Se=g.feature(oe);U.updatePaintArray(re,me,Se,le,v,E,L)})}A=!0}}return A}defines(){const a=[];for(const c in this.binders){const d=this.binders[c];(d instanceof wd||d instanceof xu)&&a.push(...d.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return a}getBinderAttributes(){const a=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof Gs||d instanceof Wc||d instanceof Vf)for(let g=0;g<d.paintVertexAttributes.length;g++)a.push(d.paintVertexAttributes[g].name)}return a}getBinderUniforms(){const a=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof wd||d instanceof xu||d instanceof Wc)for(const g of d.uniformNames)a.push(g)}return a}getPaintVertexBuffers(){return this._buffers}getUniforms(a){const c=[];for(const d in this.binders){const g=this.binders[d];if(g instanceof wd||g instanceof xu||g instanceof Wc)for(const m of g.uniformNames)c.push({name:m,property:d,binding:g.getBinding(a,m)})}return c}setUniforms(a,c,d,g,m){for(const{name:v,property:E,binding:P}of d)this.binders[E].setUniform(a,P,m,g.get(E),v)}updatePaintBuffers(){this._buffers=[];for(const a in this.binders){const c=this.binders[a];(c instanceof Gs||c instanceof Wc||c instanceof Vf)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(a){for(const c in this.binders){const d=this.binders[c];(d instanceof Gs||d instanceof Wc||d instanceof Vf)&&d.upload(a)}this.updatePaintBuffers()}destroy(){for(const a in this.binders){const c=this.binders[a];(c instanceof Gs||c instanceof Wc||c instanceof Vf)&&c.destroy()}}}class gf{constructor(a,c,d=()=>!0){this.programConfigurations={};for(const g of a)this.programConfigurations[g.id]=new Kc(g,c,d);this.needsUpload=!1,this._featureMap=new ep,this._featureMapWithoutIds=new ep,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(a,c,d,g,m,v,E,P){for(const L in this.programConfigurations)this.programConfigurations[L].populatePaintArrays(a,c,g,m,v,E,P);c.id!==void 0?this._featureMap.add(c.id,d,this._bufferOffset,a):(this._featureMapWithoutIds.add(this._idlessCounter,d,this._bufferOffset,a),this._idlessCounter+=1),this._bufferOffset=a,this.needsUpload=!0}updatePaintArrays(a,c,d,g,m,v,E){for(const P of d)this.needsUpload=this.programConfigurations[P.id].updatePaintArrays(a,this._featureMap,this._featureMapWithoutIds,c,P,g,m,v,E||0)||this.needsUpload}get(a){return this.programConfigurations[a]}upload(a){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(a);this.needsUpload=!1}}destroy(){for(const a in this.programConfigurations)this.programConfigurations[a].destroy()}}const Yy={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Sd(h,a){return Yy[h]||[h.replace(`${a}-`,"").replace(/-/g,"_")]}const Ad={"line-pattern":{source:kh,composite:kh},"fill-pattern":{source:kh,composite:kh},"fill-extrusion-pattern":{source:kh,composite:kh},"line-dasharray":{source:Yd,composite:Yd}},Td={color:{source:qf,composite:Xu},number:{source:Ku,composite:qf}};function Lg(h,a,c){const d=Ad[h];return d&&d[c]||Td[a][c]}Mt(wd,"ConstantBinder"),Mt(xu,"PatternConstantBinder"),Mt(Gs,"SourceExpressionBinder"),Mt(Vf,"PatternCompositeBinder"),Mt(Wc,"CompositeExpressionBinder"),Mt(Kc,"ProgramConfiguration",{omit:["_buffers"]}),Mt(gf,"ProgramConfigurationSet");const ml=On/Math.PI/2,yf=5,Kp=6,Xy=16383,ip=64,Ed=[ip,32,16],Fo=-ml,Yc=ml;function ap(h,a,c,d=ml){return c=Rn(c),[h*Math.sin(c)*d,-a*d,h*Math.cos(c)*d]}function wu(h,a,c){return ap(Math.cos(Rn(h)),Math.sin(Rn(h)),a,c)}const al=63710088e-1,kg=2*Math.PI*al;class zi{constructor(a,c){if(isNaN(a)||isNaN(c))throw new Error(`Invalid LngLat object: (${a}, ${c})`);if(this.lng=+a,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new zi(pi(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(a){const c=Math.PI/180,d=this.lat*c,g=a.lat*c,m=Math.sin(d)*Math.sin(g)+Math.cos(d)*Math.cos(g)*Math.cos((a.lng-this.lng)*c);return al*Math.acos(Math.min(m,1))}toBounds(a=0){const c=360*a/40075017,d=c/Math.cos(Math.PI/180*this.lat);return new $f({lng:this.lng-d,lat:this.lat-c},{lng:this.lng+d,lat:this.lat+c})}toEcef(a){return wu(this.lat,this.lng,ml+a*ml/al)}static convert(a){if(a instanceof zi)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new zi(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new zi(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class $f{constructor(a,c){if(a)if(c)this.setSouthWest(a).setNorthEast(c);else if(a.length===4){const d=a;this.setSouthWest([d[0],d[1]]).setNorthEast([d[2],d[3]])}else{const d=a;this.setSouthWest(d[0]).setNorthEast(d[1])}}setNorthEast(a){return this._ne=a instanceof zi?new zi(a.lng,a.lat):zi.convert(a),this}setSouthWest(a){return this._sw=a instanceof zi?new zi(a.lng,a.lat):zi.convert(a),this}extend(a){const c=this._sw,d=this._ne;let g,m;if(a instanceof zi)g=a,m=a;else{if(!(a instanceof $f))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend($f.convert(a)):this.extend(zi.convert(a)):typeof a=="object"&&a!==null&&a.hasOwnProperty("lat")&&(a.hasOwnProperty("lon")||a.hasOwnProperty("lng"))?this.extend(zi.convert(a)):this;if(g=a._sw,m=a._ne,!g||!m)return this}return c||d?(c.lng=Math.min(g.lng,c.lng),c.lat=Math.min(g.lat,c.lat),d.lng=Math.max(m.lng,d.lng),d.lat=Math.max(m.lat,d.lat)):(this._sw=new zi(g.lng,g.lat),this._ne=new zi(m.lng,m.lat)),this}getCenter(){return new zi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new zi(this.getWest(),this.getNorth())}getSouthEast(){return new zi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(a){const{lng:c,lat:d}=zi.convert(a);let g=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&g}static convert(a){if(a)return a instanceof $f?a:new $f(a)}}const Zy=0,Jy=25.5;function sp(h){return kg*Math.cos(h*Math.PI/180)}function gl(h){return(180+h)/360}function Ma(h){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h*Math.PI/360)))/360}function Uo(h,a){return h/sp(a)}function Mc(h){return 360*h-180}function xa(h){return 360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90}function Ng(h,a){return h*sp(xa(a))}const Cc=85.051129;function Qy(h){return Math.cos(Rn(Un(h,-85.051129,Cc)))}function Hf(h,a){const c=Un(a,Zy,Jy),d=Math.pow(2,c);return Qy(h)*kg/(512*d)}function qo(h){return 1/Math.cos(h*Math.PI/180)}function y(h,a=0){const c=Math.exp(Math.PI*(1-(h.y+a/On)/(1<<h.z)*2));return 80150034*c/(c*c+1)/On/(1<<h.z)}class o{constructor(a,c,d=0){this.x=+a,this.y=+c,this.z=+d}static fromLngLat(a,c=0){const d=zi.convert(a);return new o(gl(d.lng),Ma(d.lat),Uo(c,d.lat))}toLngLat(){return new zi(Mc(this.x),xa(this.y))}toAltitude(){return Ng(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/kg*qo(xa(this.y))}}function u(h,a,c,d,g,m,v,E,P){const L=(a+d)/2,A=(c+g)/2,O=new Ut(L,A);E(O),function(N,D,k,U,X,Q){const le=k-X,oe=U-Q;return Math.abs((U-D)*le-(k-N)*oe)/Math.hypot(le,oe)}(O.x,O.y,m.x,m.y,v.x,v.y)>=P?(u(h,a,c,L,A,m,O,E,P),u(h,L,A,d,g,O,v,E,P)):h.push(v)}function _(h,a,c){let d=h[0],g=d.x,m=d.y;a(d);const v=[d];for(let E=1;E<h.length;E++){const P=h[E],{x:L,y:A}=P;a(P),u(v,g,m,L,A,d,P,a,c),g=L,m=A,d=P}return v}function w(h,a,c,d){if(d(a,c)){const g=a.add(c)._mult(.5);w(h,a,g,d),w(h,g,c,d)}else h.push(c)}function T(h,a){let c=h[0];const d=[c];for(let g=1;g<h.length;g++){const m=h[g];w(d,c,m,a),c=m}return d}const C=Math.pow(2,14)-1,z=-C-1;function V(h,a){const c=Math.round(h.x*a),d=Math.round(h.y*a);return h.x=Un(c,z,C),h.y=Un(d,z,C),(c<h.x||c>h.x+1||d<h.y||d>h.y+1)&&ti("Geometry exceeds allowed extent, reduce your vector tile buffer size"),h}function $(h,a,c){const d=h.loadGeometry(),g=h.extent,m=On/g;if(a&&c&&c.projection.isReprojectedInTileSpace){const v=1<<a.z,{scale:E,x:P,y:L,projection:A}=c,O=N=>{const D=Mc((a.x+N.x/g)/v),k=xa((a.y+N.y/g)/v),U=A.project(D,k);N.x=(U.x*E-P)*g,N.y=(U.y*E-L)*g};for(let N=0;N<d.length;N++)if(h.type!==1)d[N]=_(d[N],O,1);else{const D=[];for(const k of d[N])k.x<0||k.x>=g||k.y<0||k.y>=g||(O(k),D.push(k));d[N]=D}}for(const v of d)for(const E of v)V(E,m);return d}function K(h,a){return{type:h.type,id:h.id,properties:h.properties,geometry:a?$(h):[]}}function ee(h,a,c,d,g){h.emplaceBack(2*a+(d+1)/2,2*c+(g+1)/2)}function te(h,a,c){h.emplaceBack(a.x,a.y,a.z,c[0]*16384,c[1]*16384,c[2]*16384)}class ce{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=a.index,this.hasPattern=!1,this.projection=a.projection,this.layoutVertexArray=new Sc,this.indexArray=new Ms,this.segments=new Da,this.programConfigurations=new gf(a.layers,{zoom:a.zoom,lut:a.lut}),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}updateFootprints(a,c){}populate(a,c,d,g){const m=this.layers[0],v=[];let E=null;m.type==="circle"&&(E=m.layout.get("circle-sort-key"));for(const{feature:L,id:A,index:O,sourceLayerIndex:N}of a){const D=this.layers[0]._featureFilter.needGeometry,k=K(L,D);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom),k,d))continue;const U=E?E.evaluate(k,{},d):void 0,X={id:A,properties:L.properties,type:L.type,sourceLayerIndex:N,index:O,geometry:D?k.geometry:$(L,d,g),patterns:{},sortKey:U};v.push(X)}E&&v.sort((L,A)=>L.sortKey-A.sortKey);let P=null;g.projection.name==="globe"&&(this.globeExtVertexArray=new Xd,P=g.projection);for(const L of v){const{geometry:A,index:O,sourceLayerIndex:N}=L,D=a[O].feature;this.addFeature(L,A,O,c.availableImages,d,P,c.brightness),c.featureIndex.insert(D,A,O,N,this.index)}}update(a,c,d,g,m,v,E){this.programConfigurations.updatePaintArrays(a,c,m,d,g,v,E)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Sv.members),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=a.createVertexBuffer(this.globeExtVertexArray,Gy.members))),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(a,c,d,g,m,v,E){for(const P of c)for(const L of P){const A=L.x,O=L.y;if(A<0||A>=On||O<0||O>=On)continue;if(v){const k=v.projectTilePoint(A,O,m),U=v.upVector(m,A,O),X=this.globeExtVertexArray;te(X,k,U),te(X,k,U),te(X,k,U),te(X,k,U)}const N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),D=N.vertexLength;ee(this.layoutVertexArray,A,O,-1,-1),ee(this.layoutVertexArray,A,O,1,-1),ee(this.layoutVertexArray,A,O,1,1),ee(this.layoutVertexArray,A,O,-1,1),this.indexArray.emplaceBack(D,D+1,D+2),this.indexArray.emplaceBack(D,D+2,D+3),N.vertexLength+=4,N.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,d,{},g,m,E)}}function Te(h,a){for(let c=0;c<h.length;c++)if(rt(a,h[c]))return!0;for(let c=0;c<a.length;c++)if(rt(h,a[c]))return!0;return!!qe(h,a)}function ve(h,a,c){return!!rt(h,a)||!!Ye(a,h,c)}function Ce(h,a){if(h.length===1)return nt(a,h[0]);for(let c=0;c<a.length;c++){const d=a[c];for(let g=0;g<d.length;g++)if(rt(h,d[g]))return!0}for(let c=0;c<h.length;c++)if(nt(a,h[c]))return!0;for(let c=0;c<a.length;c++)if(qe(h,a[c]))return!0;return!1}function Pe(h,a,c){if(h.length>1){if(qe(h,a))return!0;for(let d=0;d<a.length;d++)if(Ye(a[d],h,c))return!0}for(let d=0;d<h.length;d++)if(Ye(h[d],a,c))return!0;return!1}function qe(h,a){if(h.length===0||a.length===0)return!1;for(let c=0;c<h.length-1;c++){const d=h[c],g=h[c+1];for(let m=0;m<a.length-1;m++)if(Je(d,g,a[m],a[m+1]))return!0}return!1}function Je(h,a,c,d){return Pr(h,c,d)!==Pr(a,c,d)&&Pr(h,a,c)!==Pr(h,a,d)}function Ye(h,a,c){const d=c*c;if(a.length===1)return h.distSqr(a[0])<d;for(let g=1;g<a.length;g++)if(lt(h,a[g-1],a[g])<d)return!0;return!1}function lt(h,a,c){const d=a.distSqr(c);if(d===0)return h.distSqr(a);const g=((h.x-a.x)*(c.x-a.x)+(h.y-a.y)*(c.y-a.y))/d;return h.distSqr(g<0?a:g>1?c:c.sub(a)._mult(g)._add(a))}function nt(h,a){let c,d,g,m=!1;for(let v=0;v<h.length;v++){c=h[v];for(let E=0,P=c.length-1;E<c.length;P=E++)d=c[E],g=c[P],d.y>a.y!=g.y>a.y&&a.x<(g.x-d.x)*(a.y-d.y)/(g.y-d.y)+d.x&&(m=!m)}return m}function rt(h,a){let c=!1;for(let d=0,g=h.length-1;d<h.length;g=d++){const m=h[d],v=h[g];m.y>a.y!=v.y>a.y&&a.x<(v.x-m.x)*(a.y-m.y)/(v.y-m.y)+m.x&&(c=!c)}return c}function it(h,a,c,d,g){for(const v of h)if(a<=v.x&&c<=v.y&&d>=v.x&&g>=v.y)return!0;const m=[new Ut(a,c),new Ut(a,g),new Ut(d,g),new Ut(d,c)];if(h.length>2){for(const v of m)if(rt(h,v))return!0}for(let v=0;v<h.length-1;v++)if(dt(h[v],h[v+1],m))return!0;return!1}function dt(h,a,c){const d=c[0],g=c[2];if(h.x<d.x&&a.x<d.x||h.x>g.x&&a.x>g.x||h.y<d.y&&a.y<d.y||h.y>g.y&&a.y>g.y)return!1;const m=Pr(h,a,c[0]);return m!==Pr(h,a,c[1])||m!==Pr(h,a,c[2])||m!==Pr(h,a,c[3])}function xt(h,a,c,d,g,m){let v=a.y-h.y,E=h.x-a.x;if(m=m||0){const P=v*v+E*E;if(P===0)return!0;const L=Math.sqrt(P);v/=L,E/=L}return!((c.x-h.x)*v+(c.y-h.y)*E-m<0||(d.x-h.x)*v+(d.y-h.y)*E-m<0||(g.x-h.x)*v+(g.y-h.y)*E-m<0)}function Xt(h,a,c,d,g,m,v){return!(xt(h,a,d,g,m,v)||xt(a,c,d,g,m,v)||xt(c,h,d,g,m,v)||xt(d,g,h,a,c,v)||xt(g,m,h,a,c,v)||xt(m,d,h,a,c,v))}function zt(h,a,c){const d=a.paint.get(h).value;return d.kind==="constant"?d.value:c.programConfigurations.get(a.id).getMaxValue(h)}function tn(h){return Math.sqrt(h[0]*h[0]+h[1]*h[1])}function un(h,a,c,d,g){if(!a[0]&&!a[1])return h;const m=Ut.convert(a)._mult(g);c==="viewport"&&m._rotate(-d);const v=[];for(let E=0;E<h.length;E++)v.push(h[E].sub(m));return v}function Tn(h,a,c,d){const g=Ut.convert(h)._mult(d);return a==="viewport"&&g._rotate(-c),g}let Lt,an;Mt(ce,"CircleBucket",{omit:["layers"]});var Pt,sn={exports:{}},Qt=(Pt||(Pt=1,function(h,a){(function(c){function d(m,v,E){var P=g(256*m,256*(v=Math.pow(2,E)-v-1),E),L=g(256*(m+1),256*(v+1),E);return P[0]+","+P[1]+","+L[0]+","+L[1]}function g(m,v,E){var P=2*Math.PI*6378137/256/Math.pow(2,E);return[m*P-2*Math.PI*6378137/2,v*P-2*Math.PI*6378137/2]}c.getURL=function(m,v,E,P,L,A){return A=A||{},m+"?"+["bbox="+d(E,P,L),"format="+(A.format||"image/png"),"service="+(A.service||"WMS"),"version="+(A.version||"1.1.1"),"request="+(A.request||"GetMap"),"srs="+(A.srs||"EPSG:3857"),"width="+(A.width||256),"height="+(A.height||256),"layers="+v].join("&")},c.getTileBBox=d,c.getMercCoords=g,Object.defineProperty(c,"__esModule",{value:!0})})(a)}(0,sn.exports)),sn.exports);class fn{constructor(a,c,d){this.z=a,this.x=c,this.y=d,this.key=zn(0,a,a,c,d)}equals(a){return this.z===a.z&&this.x===a.x&&this.y===a.y}url(a,c){const d=Qt.getTileBBox(this.x,this.y,this.z),g=function(m,v,E){let P,L="";for(let A=m;A>0;A--)P=1<<A-1,L+=(v&P?1:0)+(E&P?2:0);return L}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(c==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",g).replace("{bbox-epsg-3857}",d)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Wt{constructor(a,c){this.wrap=a,this.canonical=c,this.key=zn(a,c.z,c.z,c.x,c.y)}}class mn{constructor(a,c,d,g,m){this.overscaledZ=a,this.wrap=c,this.canonical=new fn(d,+g,+m),this.key=c===0&&a===d?this.canonical.key:zn(c,a,d,g,m)}equals(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)}scaledTo(a){const c=this.canonical.z-a;return a>this.canonical.z?new mn(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new mn(a,this.wrap,a,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(a,c=!0){if(this.overscaledZ===a&&c)return this.key;if(a>this.canonical.z)return zn(this.wrap*+c,a,this.canonical.z,this.canonical.x,this.canonical.y);{const d=this.canonical.z-a;return zn(this.wrap*+c,a,a,this.canonical.x>>d,this.canonical.y>>d)}}isChildOf(a){if(a.wrap!==this.wrap)return!1;const c=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.z<this.canonical.z&&a.canonical.x===this.canonical.x>>c&&a.canonical.y===this.canonical.y>>c}children(a){if(this.overscaledZ>=a)return[new mn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,d=2*this.canonical.x,g=2*this.canonical.y;return[new mn(c,this.wrap,c,d,g),new mn(c,this.wrap,c,d+1,g),new mn(c,this.wrap,c,d,g+1),new mn(c,this.wrap,c,d+1,g+1)]}isLessThan(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))}wrapped(){return new mn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(a){return new mn(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Wt(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function zn(h,a,c,d,g){const m=1<<Math.min(c,22);let v=m*(g%m)+d%m;return h&&c<22&&(v+=m*m*((h<0?-2*h-1:2*h)%(1<<2*(22-c)))),16*(32*v+c)+(a-c)}const Bn=[h=>{let a=h.canonical.x-1,c=h.wrap;return a<0&&(a=(1<<h.canonical.z)-1,c--),new mn(h.overscaledZ,c,h.canonical.z,a,h.canonical.y)},h=>{let a=h.canonical.x+1,c=h.wrap;return a===1<<h.canonical.z&&(a=0,c++),new mn(h.overscaledZ,c,h.canonical.z,a,h.canonical.y)},h=>new mn(h.overscaledZ,h.wrap,h.canonical.z,h.canonical.x,(h.canonical.y===0?1<<h.canonical.z:h.canonical.y)-1),h=>new mn(h.overscaledZ,h.wrap,h.canonical.z,h.canonical.x,h.canonical.y===(1<<h.canonical.z)-1?0:h.canonical.y+1)];Mt(fn,"CanonicalTileID"),Mt(mn,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const In=Mi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:or}=In,Br=Mi([{name:"a_pos_3",components:3,type:"Int16"}]);var mr=Mi([{name:"a_pos",type:"Int16",components:2}]);class Dr{constructor(a,c){this.pos=a,this.dir=c}intersectsPlane(a,c,d){const g=_e.vec2.dot(c,this.dir);if(Math.abs(g)<1e-6)return!1;const m=((a[0]-this.pos[0])*c[0]+(a[1]-this.pos[1])*c[1])/g;return d[0]=this.pos[0]+this.dir[0]*m,d[1]=this.pos[1]+this.dir[1]*m,!0}}class Er{constructor(a,c){this.pos=a,this.dir=c}intersectsPlane(a,c,d){const g=_e.vec3.dot(c,this.dir);if(Math.abs(g)<1e-6)return!1;const m=((a[0]-this.pos[0])*c[0]+(a[1]-this.pos[1])*c[1]+(a[2]-this.pos[2])*c[2])/g;return d[0]=this.pos[0]+this.dir[0]*m,d[1]=this.pos[1]+this.dir[1]*m,d[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(a,c,d){if(_e.vec3.equals(this.pos,a)||c===0)return d[0]=d[1]=d[2]=0,!1;const[g,m,v]=this.dir,E=this.pos[0]-a[0],P=this.pos[1]-a[1],L=this.pos[2]-a[2],A=g*g+m*m+v*v,O=2*(E*g+P*m+L*v),N=O*O-4*A*(E*E+P*P+L*L-c*c);if(N<0){const D=Math.max(-O/2,0),k=E+g*D,U=P+m*D,X=L+v*D,Q=Math.hypot(k,U,X);return d[0]=k*c/Q,d[1]=U*c/Q,d[2]=X*c/Q,!1}{const D=(-O-Math.sqrt(N))/(2*A);if(D<0){const k=Math.hypot(E,P,L);return d[0]=E*c/k,d[1]=P*c/k,d[2]=L*c/k,!1}return d[0]=E+g*D,d[1]=P+m*D,d[2]=L+v*D,!0}}}class Cr{constructor(a,c,d,g,m){this.TL=a,this.TR=c,this.BR=d,this.BL=g,this.horizon=m}static fromInvProjectionMatrix(a,c,d){const g=[-1,1,1],m=[1,1,1],v=[1,-1,1],E=[-1,-1,1],P=_e.vec3.transformMat4(g,g,a),L=_e.vec3.transformMat4(m,m,a),A=_e.vec3.transformMat4(v,v,a),O=_e.vec3.transformMat4(E,E,a);return new Cr(P,L,A,O,c/d)}}function jr(h,a,c){let d=1/0,g=-1/0;const m=[];for(const v of h){_e.vec3.sub(m,v,a);const E=_e.vec3.dot(m,c);d=Math.min(d,E),g=Math.max(g,E)}return[d,g]}function Nr(h,a){let c=!0;for(let d=0;d<h.planes.length;d++){const g=h.planes[d];let m=0;for(let v=0;v<a.length;v++)m+=_e.vec3.dot(g,a[v])+g[3]>=0;if(m===0)return 0;m!==a.length&&(c=!1)}return c?2:1}function fr(h,a){for(const c of h.projections){const d=jr(a,h.points[0],c.axis);if(c.projection[1]<d[0]||c.projection[0]>d[1])return 0}return 1}function ai(h,a){let c=0;const d=[0,0,0,0];for(let g=0;g<h.length;g++)d[0]=h[g][0],d[1]=h[g][1],d[2]=h[g][2],d[3]=1,_e.vec4.dot(d,a)>=0&&c++;return c}class Ar{constructor(a,c){this.points=a||new Array(8).fill([0,0,0]),this.planes=c||new Array(6).fill([0,0,0,0]),this.bounds=tr.fromPoints(this.points),this.projections=[],this.frustumEdges=[_e.vec3.sub([],this.points[2],this.points[3]),_e.vec3.sub([],this.points[0],this.points[3]),_e.vec3.sub([],this.points[4],this.points[0]),_e.vec3.sub([],this.points[5],this.points[1]),_e.vec3.sub([],this.points[6],this.points[2]),_e.vec3.sub([],this.points[7],this.points[3])];for(const d of this.frustumEdges){const g=[0,-d[2],d[1]],m=[d[2],0,-d[0]];this.projections.push({axis:g,projection:jr(this.points,this.points[0],g)}),this.projections.push({axis:m,projection:jr(this.points,this.points[0],m)})}}static fromInvProjectionMatrix(a,c,d,g){const m=Math.pow(2,d),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(L=>{const A=_e.vec4.transformMat4([],L,a),O=1/A[3]/c*m;return _e.vec4.mul(A,A,[O,O,g?1/A[3]:O,O])}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(L=>{const A=_e.vec3.sub([],v[L[0]],v[L[1]]),O=_e.vec3.sub([],v[L[2]],v[L[1]]),N=_e.vec3.normalize([],_e.vec3.cross([],A,O)),D=-_e.vec3.dot(N,v[L[1]]);return N.concat(D)}),P=[];for(let L=0;L<v.length;L++)P.push([v[L][0],v[L][1],v[L][2]]);return new Ar(P,E)}intersectsPrecise(a,c,d){for(let g=0;g<c.length;g++)if(!ai(a,c[g]))return 0;for(let g=0;g<this.planes.length;g++)if(!ai(a,this.planes[g]))return 0;for(const g of d)for(const m of this.frustumEdges){const v=_e.vec3.cross([],g,m),E=_e.vec3.length(v);if(E===0)continue;_e.vec3.scale(v,v,1/E);const P=jr(this.points,this.points[0],v),L=jr(a,this.points[0],v);if(P[0]>L[1]||L[0]>P[1])return 0}return 1}containsPoint(a){for(const c of this.planes){const d=c[3];if(_e.vec3.dot([c[0],c[1],c[2]],a)+d<0)return!1}return!0}}class tr{static fromPoints(a){const c=[1/0,1/0,1/0],d=[-1/0,-1/0,-1/0];for(const g of a)_e.vec3.min(c,c,g),_e.vec3.max(d,d,g);return new tr(c,d)}static fromTileIdAndHeight(a,c,d){const g=1<<a.canonical.z,m=a.canonical.x,v=a.canonical.y;return new tr([m/g,v/g,c],[(m+1)/g,(v+1)/g,d])}static applyTransform(a,c){const d=a.getCorners();for(let g=0;g<d.length;++g)_e.vec3.transformMat4(d[g],d[g],c);return tr.fromPoints(d)}static applyTransformFast(a,c){const d=[c[12],c[13],c[14]],g=[...d];for(let m=0;m<3;m++)for(let v=0;v<3;v++){const E=c[4*v+m],P=E*a.min[v],L=E*a.max[v];d[m]+=Math.min(P,L),g[m]+=Math.max(P,L)}return new tr(d,g)}static projectAabbCorners(a,c){const d=a.getCorners();for(let g=0;g<d.length;++g)_e.vec3.transformMat4(d[g],d[g],c);return d}constructor(a,c){this.min=a,this.max=c,this.center=_e.vec3.scale([],_e.vec3.add([],this.min,this.max),.5)}quadrant(a){const c=[a%2==0,a<2],d=_e.vec3.clone(this.min),g=_e.vec3.clone(this.max);for(let m=0;m<c.length;m++)d[m]=c[m]?this.min[m]:this.center[m],g[m]=c[m]?this.center[m]:this.max[m];return g[2]=this.max[2],new tr(d,g)}distanceX(a){return Math.max(Math.min(this.max[0],a[0]),this.min[0])-a[0]}distanceY(a){return Math.max(Math.min(this.max[1],a[1]),this.min[1])-a[1]}distanceZ(a){return Math.max(Math.min(this.max[2],a[2]),this.min[2])-a[2]}getCorners(){const a=this.min,c=this.max;return[[a[0],a[1],a[2]],[c[0],a[1],a[2]],[c[0],c[1],a[2]],[a[0],c[1],a[2]],[a[0],a[1],c[2]],[c[0],a[1],c[2]],[c[0],c[1],c[2]],[a[0],c[1],c[2]]]}intersects(a){return this.intersectsAabb(a.bounds)?Nr(a,this.getCorners()):0}intersectsFlat(a){return this.intersectsAabb(a.bounds)?Nr(a,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(a,c){return c||this.intersects(a)?fr(a,this.getCorners()):0}intersectsPreciseFlat(a,c){return c||this.intersectsFlat(a)?fr(a,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(a){for(let c=0;c<3;++c)if(this.min[c]>a.max[c]||a.min[c]>this.max[c])return!1;return!0}intersectsAabbXY(a){return!(this.min[0]>a.max[0]||a.min[0]>this.max[0]||this.min[1]>a.max[1]||a.min[1]>this.max[1])}encapsulate(a){for(let c=0;c<3;c++)this.min[c]=Math.min(this.min[c],a.min[c]),this.max[c]=Math.max(this.max[c],a.max[c])}encapsulatePoint(a){for(let c=0;c<3;c++)this.min[c]=Math.min(this.min[c],a[c]),this.max[c]=Math.max(this.max[c],a[c])}closestPoint(a){return[Math.max(Math.min(this.max[0],a[0]),this.min[0]),Math.max(Math.min(this.max[1],a[1]),this.min[1]),Math.max(Math.min(this.max[2],a[2]),this.min[2])]}}function si(h){return h*ml/al}Mt(tr,"Aabb");const Hi=[new tr([Fo,Fo,Fo],[Yc,Yc,Yc]),new tr([Fo,Fo,Fo],[0,0,Yc]),new tr([0,Fo,Fo],[Yc,0,Yc]),new tr([Fo,0,Fo],[0,Yc,Yc]),new tr([0,0,Fo],[Yc,Yc,Yc])];function ci(h,a,c,d=!0){const g=_e.vec3.scale([],h._camera.position,h.worldSize),m=[a,c,1,1];_e.vec4.transformMat4(m,m,h.pixelMatrixInverse),_e.vec4.scale(m,m,1/m[3]);const v=_e.vec3.sub([],m,g),E=_e.vec3.normalize([],v),P=h.globeMatrix,L=[P[12],P[13],P[14]],A=_e.vec3.sub([],L,g),O=_e.vec3.length(A),N=_e.vec3.normalize([],A),D=h.worldSize/(2*Math.PI),k=_e.vec3.dot(N,E),U=Math.asin(D/O);if(U<Math.acos(k)){if(!d)return null;const ht=[],Ke=[];_e.vec3.scale(ht,E,O/k),_e.vec3.normalize(Ke,_e.vec3.sub(Ke,ht,A)),_e.vec3.normalize(E,_e.vec3.add(E,A,_e.vec3.scale(E,Ke,Math.tan(U)*O)))}const X=[];new Er(g,E).closestPointOnSphere(L,D,X);const Q=_e.vec3.normalize([],fi(P,0)),le=_e.vec3.normalize([],fi(P,1)),oe=_e.vec3.normalize([],fi(P,2)),re=_e.vec3.dot(Q,X),me=_e.vec3.dot(le,X),Se=_e.vec3.dot(oe,X),Me=Dn(Math.asin(-me/D));let We=Dn(Math.atan2(re,Se));We=h.center.lng+function(ht,Ke){const pt=(Ke-ht+180)%360-180;return pt<-180?pt+360:pt}(h.center.lng,We);const $e=gl(We),He=Un(Ma(Me),0,1);return new o($e,He)}class Oi{constructor(a,c,d){this.a=_e.vec3.sub([],a,d),this.b=_e.vec3.sub([],c,d),this.center=d;const g=_e.vec3.normalize([],this.a),m=_e.vec3.normalize([],this.b);this.angle=Math.acos(_e.vec3.dot(g,m))}}function Ka(h,a){if(h.angle===0)return null;let c;return c=h.a[a]===0?1/h.angle*.5*Math.PI:1/h.angle*Math.atan(h.b[a]/h.a[a]/Math.sin(h.angle)-1/Math.tan(h.angle)),c<0||c>1?null:function(d,g,m,v){const E=Math.sin(m);return d*(Math.sin((1-v)*m)/E)+g*(Math.sin(v*m)/E)}(h.a[a],h.b[a],h.angle,Un(c,0,1))+h.center[a]}function us(h){if(h.z<=1)return Hi[h.z+2*h.y+h.x];const a=ra(Ti(h));return tr.fromPoints(a)}function to(h,a,c){return _e.vec3.scale(h,h,1-c),_e.vec3.scaleAndAdd(h,h,a,c)}function Ws(h,a,c){for(const d of h)_e.vec3.transformMat4(d,d,a),_e.vec3.scale(d,d,c)}function po(h,a,c,d){const g=a/h.worldSize,m=h.globeMatrix;if(c.z<=1){const $e=us(c).getCorners();return Ws($e,m,g),tr.fromPoints($e)}const v=Ti(c,d),E=ra(v,ml+si(h._tileCoverLift));Ws(E,m,g);const P=Number.MAX_VALUE,L=[-P,-P,-P],A=[P,P,P];if(v.contains(h.center)){for(const ht of E)_e.vec3.min(A,A,ht),_e.vec3.max(L,L,ht);L[2]=0;const $e=h.point,He=[$e.x*g,$e.y*g,0];return _e.vec3.min(A,A,He),_e.vec3.max(L,L,He),new tr(A,L)}if(h._tileCoverLift>0){for(const $e of E)_e.vec3.min(A,A,$e),_e.vec3.max(L,L,$e);return new tr(A,L)}const O=[m[12]*g,m[13]*g,m[14]*g],N=v.getCenter(),D=Un(h.center.lat,-85.051129,Cc),k=Un(N.lat,-85.051129,Cc),U=gl(h.center.lng),X=Ma(D);let Q=U-gl(N.lng);const le=X-Ma(k);Q>.5?Q-=1:Q<-.5&&(Q+=1);let oe=0;if(Math.abs(Q)>Math.abs(le))oe=Q>=0?1:3;else{oe=le>=0?0:2;const $e=[m[4]*g,m[5]*g,m[6]*g],He=-Math.sin(Rn(le>=0?v.getSouth():v.getNorth()))*ml;_e.vec3.scaleAndAdd(O,O,$e,He)}const re=E[oe],me=E[(oe+1)%4],Se=new Oi(re,me,O),Me=[Ka(Se,0)||re[0],Ka(Se,1)||re[1],Ka(Se,2)||re[2]],We=Rl(h.zoom);if(We>0){const $e=function({x:ht,y:Ke,z:pt},Et,wt,Ot,It){const jt=1/(1<<pt);let Dt=ht*jt,Vt=Dt+jt,_n=Ke*jt,gn=_n+jt,Zn=0;const Cn=(Dt+Vt)/2-Ot;return Cn>.5?Zn=-1:Cn<-.5&&(Zn=1),Dt=((Dt+Zn)*Et-(Ot*=Et))*wt+Ot,Vt=((Vt+Zn)*Et-Ot)*wt+Ot,_n=(_n*Et-(It*=Et))*wt+It,gn=(gn*Et-It)*wt+It,[[Dt,gn,0],[Vt,gn,0],[Vt,_n,0],[Dt,_n,0]]}(c,a,h._pixelsPerMercatorPixel,U,X);for(let ht=0;ht<E.length;ht++)to(E[ht],$e[ht],We);const He=_e.vec3.add([],$e[oe],$e[(oe+1)%4]);_e.vec3.scale(He,He,.5),to(Me,He,We)}for(const $e of E)_e.vec3.min(A,A,$e),_e.vec3.max(L,L,$e);return A[2]=Math.min(re[2],me[2]),_e.vec3.min(A,A,Me),_e.vec3.max(L,L,Me),new tr(A,L)}function Ti({x:h,y:a,z:c},d=!1){const g=1/(1<<c),m=new zi(Mc(h*g),a===(1<<c)-1&&d?-90:xa((a+1)*g)),v=new zi(Mc((h+1)*g),a===0&&d?90:xa(a*g));return new $f(m,v)}function ra(h,a=ml){const c=Rn(h.getNorth()),d=Rn(h.getSouth()),g=Math.cos(c),m=Math.cos(d),v=Math.sin(c),E=Math.sin(d),P=h.getWest(),L=h.getEast();return[ap(m,E,P,a),ap(m,E,L,a),ap(g,v,L,a),ap(g,v,P,a)]}function Di(h,a,c,d){const g=1<<c.z,m=(h/On+c.x)/g;return wu(xa((a/On+c.y)/g),Mc(m),d)}function sa({min:h,max:a}){return Xy/Math.max(a[0]-h[0],a[1]-h[1],a[2]-h[2])}const mo=new Float64Array(16);function wa(h){const a=sa(h),c=_e.mat4.fromScaling(mo,[a,a,a]);return _e.mat4.translate(c,c,_e.vec3.negate([],h.min))}function as(h){const a=_e.mat4.fromTranslation(mo,h.min),c=1/sa(h);return _e.mat4.scale(a,a,[c,c,c])}function Su(h){const a=On/(2*Math.PI);return h/(2*Math.PI)/a}function Vo(h,a){return On/(512*Math.pow(2,h))*sa(us(a))}function ec(h,a,c,d,g){const m=Su(c),v=[h,a,-c/(2*Math.PI)],E=_e.mat4.identity(new Float64Array(16));return _e.mat4.translate(E,E,v),_e.mat4.scale(E,E,[m,m,m]),_e.mat4.rotateX(E,E,Rn(-g)),_e.mat4.rotateY(E,E,Rn(-d)),E}function Rl(h){return Vr(yf,Kp,h)}function Xc(h,a){const c=wu(a.lat,a.lng),d=function(m){const v=wu(m._center.lat,m._center.lng),E=_e.vec3.fromValues(0,1,0);let P=_e.vec3.cross([],E,v);const L=_e.mat4.fromRotation([],-m.angle,v);P=_e.vec3.transformMat4(P,P,L),_e.mat4.fromRotation(L,-m._pitch,P);const A=_e.vec3.normalize([],v);return _e.vec3.scale(A,A,si(m.cameraToCenterDistance/m.pixelsPerMeter)),_e.vec3.transformMat4(A,A,L),_e.vec3.add([],v,A)}(h),g=_e.vec3.subtract([],d,c);return _e.vec3.angle(g,c)}function yl(h,a){return Xc(h,a)>Math.PI/2*1.01}const Fh=Rn(85),go=Math.cos(Fh),_f=Math.sin(Fh),Dl=_e.mat4.create(),op=h=>{const a=[];return h.paint.get("circle-pitch-alignment")==="map"&&a.push("PITCH_WITH_MAP"),h.paint.get("circle-pitch-scale")==="map"&&a.push("SCALE_WITH_MAP"),a};function Yp(h,a,c,d,g,m,v,E,P){if(m&&h.queryGeometry.isAboveHorizon)return!1;m&&(P*=h.pixelToTileUnitsFactor);const L=h.tileID.canonical,A=c.projection.upVectorScale(L,c.center.lat,c.worldSize).metersToTile;for(const O of a)for(const N of O){const D=N.add(E),k=g&&c.elevation?c.elevation.exaggeration()*g.getElevationAt(D.x,D.y,!0):0,U=c.projection.projectTilePoint(D.x,D.y,L);if(k>0){const oe=c.projection.upVector(L,D.x,D.y);U.x+=oe[0]*A*k,U.y+=oe[1]*A*k,U.z+=oe[2]*A*k}const X=m?D:zg(U.x,U.y,U.z,d),Q=m?h.tilespaceRays.map(oe=>Av(oe,k)):h.queryGeometry.screenGeometry,le=_e.vec4.transformMat4([],[U.x,U.y,U.z,1],d);if(!v&&m?P*=le[3]/c.cameraToCenterDistance:v&&!m&&(P*=c.cameraToCenterDistance/le[3]),m){const oe=xa((N.y/On+L.y)/(1<<L.z));P/=c.projection.pixelsPerMeter(oe,1)/Uo(1,oe)}if(ve(Q,X,P))return!0}return!1}function zg(h,a,c,d){const g=_e.vec4.transformMat4([],[h,a,c,1],d);return new Ut(g[0]/g[3],g[1]/g[3])}const I2=_e.vec3.fromValues(0,0,0),lp=_e.vec3.fromValues(0,0,1);function Av(h,a){const c=_e.vec3.create();return I2[2]=a,h.intersectsPlane(I2,lp,c),new Ut(c[0],c[1])}class Tv extends ce{}let Vm,G1,W1,K1;function Ev(h,{width:a,height:c},d,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==a*c*d)throw new RangeError("mismatched image size")}else g=new Uint8Array(a*c*d);return h.width=a,h.height=c,h.data=g,h}function Mv(h,a,c){const{width:d,height:g}=a;d===h.width&&g===h.height||(Y1(h,a,{x:0,y:0},{x:0,y:0},{width:Math.min(h.width,d),height:Math.min(h.height,g)},c,null),h.width=d,h.height=g,h.data=a.data)}function Y1(h,a,c,d,g,m,v,E){if(g.width===0||g.height===0)return a;if(g.width>h.width||g.height>h.height||c.x>h.width-g.width||c.y>h.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>a.width||g.height>a.height||d.x>a.width-g.width||d.y>a.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const P=h.data,L=a.data,A=m===4&&E;for(let O=0;O<g.height;O++){const N=((c.y+O)*h.width+c.x)*m,D=((d.y+O)*a.width+d.x)*m;if(A)for(let k=0;k<g.width;k++){const U=N+k*m+3,X=D+k*m;L[X+0]=255,L[X+1]=255,L[X+2]=255,L[X+3]=P[U]}else if(v)for(let k=0;k<g.width;k++){const U=N+k*m,X=D+k*m,Q=P[U+3],le=new Ei(P[U+0]/255*Q,P[U+1]/255*Q,P[U+2]/255*Q,Q).toRenderColor(v).toArray();L[X+0]=le[0],L[X+1]=le[1],L[X+2]=le[2],L[X+3]=le[3]}else for(let k=0;k<g.width*m;k++)L[D+k]=P[N+k]}return a}Mt(Tv,"HeatmapBucket",{omit:["layers"]});class Xp{constructor(a,c){Ev(this,a,1,c)}resize(a){Mv(this,new Xp(a),1)}clone(){return new Xp({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,c,d,g,m){Y1(a,c,d,g,m,1,null)}}class _l{constructor(a,c){Ev(this,a,4,c)}resize(a){Mv(this,new _l(a),4)}replace(a,c){c?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a}clone(){return new _l({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,c,d,g,m,v,E){Y1(a,c,d,g,m,4,v,E)}}class X1{constructor(a,c){this.width=a.width,this.height=a.height,this.data=c instanceof Uint8Array?new Float32Array(c.buffer):c}}function Bg(h){const a={},c=h.resolution||256,d=h.clips?h.clips.length:1,g=h.image||new _l({width:c,height:d}),m=(v,E,P)=>{a[h.evaluationKey]=P;const L=h.expression.evaluate(a);L&&(g.data[v+E+0]=Math.floor(255*L.r/L.a),g.data[v+E+1]=Math.floor(255*L.g/L.a),g.data[v+E+2]=Math.floor(255*L.b/L.a),g.data[v+E+3]=Math.floor(255*L.a))};if(h.clips)for(let v=0,E=0;v<d;++v,E+=4*c)for(let P=0,L=0;P<c;P++,L+=4){const A=P/(c-1),{start:O,end:N}=h.clips[v];m(E,L,O*(1-A)+N*A)}else for(let v=0,E=0;v<c;v++,E+=4)m(0,E,v/(c-1));return g}Mt(Xp,"AlphaImage"),Mt(_l,"RGBAImage");const jg=Mi([{name:"a_pos",components:2,type:"Int16"}],4),Cv=Mi([{name:"a_road_z_offset",components:1,type:"Float32"}],4),P2=Mi([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),O2=Mi([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function e_(h,a,c=2){const d=a&&a.length,g=d?a[0]*c:h.length;let m=Z1(h,0,g,c,!0);const v=[];if(!m||m.next===m.prev)return v;let E,P,L;if(d&&(m=function(A,O,N,D){const k=[];for(let U=0,X=O.length;U<X;U++){const Q=Z1(A,O[U]*D,U<X-1?O[U+1]*D:A.length,D,!1);Q===Q.next&&(Q.steiner=!0),k.push(qg(Q))}k.sort(YE);for(let U=0;U<k.length;U++)N=XE(k[U],N);return N}(h,a,m,c)),h.length>80*c){E=1/0,P=1/0;let A=-1/0,O=-1/0;for(let N=c;N<g;N+=c){const D=h[N],k=h[N+1];D<E&&(E=D),k<P&&(P=k),D>A&&(A=D),k>O&&(O=k)}L=Math.max(A-E,O-P),L=L!==0?32767/L:0}return Fg(m,v,c,E,P,L,0),v}function Z1(h,a,c,d,g){let m;if(g===function(v,E,P,L){let A=0;for(let O=E,N=P-L;O<P;O+=L)A+=(v[N]-v[O])*(v[O+1]+v[N+1]),N=O;return A}(h,a,c,d)>0)for(let v=a;v<c;v+=d)m=eb(v/d|0,h[v],h[v+1],m);else for(let v=c-d;v>=a;v-=d)m=eb(v/d|0,h[v],h[v+1],m);return m&&Md(m,m.next)&&(t_(m),m=m.next),m}function vf(h,a){if(!h)return h;a||(a=h);let c,d=h;do if(c=!1,d.steiner||!Md(d,d.next)&&no(d.prev,d,d.next)!==0)d=d.next;else{if(t_(d),d=a=d.prev,d===d.next)break;c=!0}while(c||d!==a);return a}function Fg(h,a,c,d,g,m,v){if(!h)return;!v&&m&&function(P,L,A,O){let N=P;do N.z===0&&(N.z=Ug(N.x,N.y,L,A,O)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next;while(N!==P);N.prevZ.nextZ=null,N.prevZ=null,function(D){let k,U=1;do{let X,Q=D;D=null;let le=null;for(k=0;Q;){k++;let oe=Q,re=0;for(let Se=0;Se<U&&(re++,oe=oe.nextZ,oe);Se++);let me=U;for(;re>0||me>0&&oe;)re!==0&&(me===0||!oe||Q.z<=oe.z)?(X=Q,Q=Q.nextZ,re--):(X=oe,oe=oe.nextZ,me--),le?le.nextZ=X:D=X,X.prevZ=le,le=X;Q=oe}le.nextZ=null,U*=2}while(k>1)}(N)}(h,d,g,m);let E=h;for(;h.prev!==h.next;){const P=h.prev,L=h.next;if(m?J1(h,d,g,m):Ls(h))a.push(P.i,h.i,L.i),t_(h),h=L.next,E=L.next;else if((h=L)===E){v?v===1?Fg(h=KE(vf(h),a),a,c,d,g,m,2):v===2&&R2(h,a,c,d,g,m):Fg(vf(h),a,c,d,g,m,1);break}}}function Ls(h){const a=h.prev,c=h,d=h.next;if(no(a,c,d)>=0)return!1;const g=a.x,m=c.x,v=d.x,E=a.y,P=c.y,L=d.y,A=g<m?g<v?g:v:m<v?m:v,O=E<P?E<L?E:L:P<L?P:L,N=g>m?g>v?g:v:m>v?m:v,D=E>P?E>L?E:L:P>L?P:L;let k=d.next;for(;k!==a;){if(k.x>=A&&k.x<=N&&k.y>=O&&k.y<=D&&Zp(g,E,m,P,v,L,k.x,k.y)&&no(k.prev,k,k.next)>=0)return!1;k=k.next}return!0}function J1(h,a,c,d){const g=h.prev,m=h,v=h.next;if(no(g,m,v)>=0)return!1;const E=g.x,P=m.x,L=v.x,A=g.y,O=m.y,N=v.y,D=E<P?E<L?E:L:P<L?P:L,k=A<O?A<N?A:N:O<N?O:N,U=E>P?E>L?E:L:P>L?P:L,X=A>O?A>N?A:N:O>N?O:N,Q=Ug(D,k,a,c,d),le=Ug(U,X,a,c,d);let oe=h.prevZ,re=h.nextZ;for(;oe&&oe.z>=Q&&re&&re.z<=le;){if(oe.x>=D&&oe.x<=U&&oe.y>=k&&oe.y<=X&&oe!==g&&oe!==v&&Zp(E,A,P,O,L,N,oe.x,oe.y)&&no(oe.prev,oe,oe.next)>=0||(oe=oe.prevZ,re.x>=D&&re.x<=U&&re.y>=k&&re.y<=X&&re!==g&&re!==v&&Zp(E,A,P,O,L,N,re.x,re.y)&&no(re.prev,re,re.next)>=0))return!1;re=re.nextZ}for(;oe&&oe.z>=Q;){if(oe.x>=D&&oe.x<=U&&oe.y>=k&&oe.y<=X&&oe!==g&&oe!==v&&Zp(E,A,P,O,L,N,oe.x,oe.y)&&no(oe.prev,oe,oe.next)>=0)return!1;oe=oe.prevZ}for(;re&&re.z<=le;){if(re.x>=D&&re.x<=U&&re.y>=k&&re.y<=X&&re!==g&&re!==v&&Zp(E,A,P,O,L,N,re.x,re.y)&&no(re.prev,re,re.next)>=0)return!1;re=re.nextZ}return!0}function KE(h,a){let c=h;do{const d=c.prev,g=c.next.next;!Md(d,g)&&Gf(d,c,c.next,g)&&Vg(d,g)&&Vg(g,d)&&(a.push(d.i,c.i,g.i),t_(c),t_(c.next),c=h=g),c=c.next}while(c!==h);return vf(c)}function R2(h,a,c,d,g,m){let v=h;do{let E=v.next.next;for(;E!==v.prev;){if(v.i!==E.i&&Iv(v,E)){let P=Q1(v,E);return v=vf(v,v.next),P=vf(P,P.next),Fg(v,a,c,d,g,m,0),void Fg(P,a,c,d,g,m,0)}E=E.next}v=v.next}while(v!==h)}function YE(h,a){return h.x-a.x}function XE(h,a){const c=function(g,m){let v=m;const E=g.x,P=g.y;let L,A=-1/0;do{if(P<=v.y&&P>=v.next.y&&v.next.y!==v.y){const U=v.x+(P-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(U<=E&&U>A&&(A=U,L=v.x<v.next.x?v:v.next,U===E))return L}v=v.next}while(v!==m);if(!L)return null;const O=L,N=L.x,D=L.y;let k=1/0;v=L;do{if(E>=v.x&&v.x>=N&&E!==v.x&&Zp(P<D?E:A,P,N,D,P<D?A:E,P,v.x,v.y)){const U=Math.abs(P-v.y)/(E-v.x);Vg(v,g)&&(U<k||U===k&&(v.x>L.x||v.x===L.x&&ZE(L,v)))&&(L=v,k=U)}v=v.next}while(v!==O);return L}(h,a);if(!c)return a;const d=Q1(c,h);return vf(d,d.next),vf(c,c.next)}function ZE(h,a){return no(h.prev,h,a.prev)<0&&no(a.next,h,h.next)<0}function Ug(h,a,c,d,g){return(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h=(h-c)*g|0)|h<<8))|h<<4))|h<<2))|h<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-d)*g|0)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function qg(h){let a=h,c=h;do(a.x<c.x||a.x===c.x&&a.y<c.y)&&(c=a),a=a.next;while(a!==h);return c}function Zp(h,a,c,d,g,m,v,E){return(g-v)*(a-E)>=(h-v)*(m-E)&&(h-v)*(d-E)>=(c-v)*(a-E)&&(c-v)*(m-E)>=(g-v)*(d-E)}function Iv(h,a){return h.next.i!==a.i&&h.prev.i!==a.i&&!function(c,d){let g=c;do{if(g.i!==c.i&&g.next.i!==c.i&&g.i!==d.i&&g.next.i!==d.i&&Gf(g,g.next,c,d))return!0;g=g.next}while(g!==c);return!1}(h,a)&&(Vg(h,a)&&Vg(a,h)&&function(c,d){let g=c,m=!1;const v=(c.x+d.x)/2,E=(c.y+d.y)/2;do g.y>E!=g.next.y>E&&g.next.y!==g.y&&v<(g.next.x-g.x)*(E-g.y)/(g.next.y-g.y)+g.x&&(m=!m),g=g.next;while(g!==c);return m}(h,a)&&(no(h.prev,h,a.prev)||no(h,a.prev,a))||Md(h,a)&&no(h.prev,h,h.next)>0&&no(a.prev,a,a.next)>0)}function no(h,a,c){return(a.y-h.y)*(c.x-a.x)-(a.x-h.x)*(c.y-a.y)}function Md(h,a){return h.x===a.x&&h.y===a.y}function Gf(h,a,c,d){const g=Pv(no(h,a,c)),m=Pv(no(h,a,d)),v=Pv(no(c,d,h)),E=Pv(no(c,d,a));return g!==m&&v!==E||!(g!==0||!Jp(h,c,a))||!(m!==0||!Jp(h,d,a))||!(v!==0||!Jp(c,h,d))||!(E!==0||!Jp(c,a,d))}function Jp(h,a,c){return a.x<=Math.max(h.x,c.x)&&a.x>=Math.min(h.x,c.x)&&a.y<=Math.max(h.y,c.y)&&a.y>=Math.min(h.y,c.y)}function Pv(h){return h>0?1:h<0?-1:0}function Vg(h,a){return no(h.prev,h,h.next)<0?no(h,a,h.next)>=0&&no(h,h.prev,a)>=0:no(h,a,h.prev)<0||no(h,h.next,a)<0}function Q1(h,a){const c=n_(h.i,h.x,h.y),d=n_(a.i,a.x,a.y),g=h.next,m=a.prev;return h.next=a,a.prev=h,c.next=g,g.prev=c,d.next=c,c.prev=d,m.next=d,d.prev=m,d}function eb(h,a,c,d){const g=n_(h,a,c);return d?(g.next=d.next,g.prev=d,d.next.prev=g,d.next=g):(g.prev=g,g.next=g),g}function t_(h){h.next.prev=h.prev,h.prev.next=h.next,h.prevZ&&(h.prevZ.nextZ=h.nextZ),h.nextZ&&(h.nextZ.prevZ=h.prevZ)}function n_(h,a,c){return{i:h,x:a,y:c,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function r_(h,a){const c=h.length;if(c<=1)return[h];const d=[];let g,m;for(let v=0;v<c;v++){const E=ys(h[v]);E!==0&&(h[v].area=Math.abs(E),m===void 0&&(m=E<0),m===E<0?(g&&d.push(g),g=[h[v]]):g.push(h[v]))}if(g&&d.push(g),a>1)for(let v=0;v<d.length;v++)d[v].length<=a||(fd(d[v],a,1,d[v].length-1,D2),d[v]=d[v].slice(0,a));return d}function D2(h,a){return a.area-h.area}function L2(h,a,c=1){if(!h)return null;const d=typeof h=="string"?ws.from(h).getPrimary():h.getPrimary(),g=d.id.toString();return a.has(g)||a.set(g,[]),d.scaleSelf(c),a.get(g).push(d),d.toString()}function i_(h,a,c,d){const g=d.patternDependencies;let m=!1;for(const v of a){const E=v.paint.get(`${h}-pattern`);E.isConstant()||(m=!0),L2(E.constantOr(null),g,c)&&(m=!0)}return m}function a_(h,a,c,d,g,m){const v=m.patternDependencies;for(const E of a){const P=E.paint.get(`${h}-pattern`).value;if(P.kind!=="constant"){let L=P.evaluate({zoom:d},c,{},m.availableImages);L=L&&L.name?L.name:L;const A=L2(L,v,g);A&&(c.patterns[E.id]=A)}}return c}var tb,k2,$m,N2,Ov,La,Rv,Hm={};function Dv(){if(k2)return tb;k2=1;var h=Pn();function a(g,m,v,E,P){this.properties={},this.extent=v,this.type=0,this._pbf=g,this._geometry=-1,this._keys=E,this._values=P,g.readFields(c,this,m)}function c(g,m,v){g==1?m.id=v.readVarint():g==2?function(E,P){for(var L=E.readVarint()+E.pos;E.pos<L;){var A=P._keys[E.readVarint()],O=P._values[E.readVarint()];P.properties[A]=O}}(v,m):g==3?m.type=v.readVarint():g==4&&(m._geometry=v.pos)}function d(g){for(var m,v,E=0,P=0,L=g.length,A=L-1;P<L;A=P++)E+=((v=g[A]).x-(m=g[P]).x)*(m.y+v.y);return E}return tb=a,a.types=["Unknown","Point","LineString","Polygon"],a.prototype.loadGeometry=function(){var g=this._pbf;g.pos=this._geometry;for(var m,v=g.readVarint()+g.pos,E=1,P=0,L=0,A=0,O=[];g.pos<v;){if(P<=0){var N=g.readVarint();E=7&N,P=N>>3}if(P--,E===1||E===2)L+=g.readSVarint(),A+=g.readSVarint(),E===1&&(m&&O.push(m),m=[]),m.push(new h(L,A));else{if(E!==7)throw new Error("unknown command "+E);m&&m.push(m[0].clone())}}return m&&O.push(m),O},a.prototype.bbox=function(){var g=this._pbf;g.pos=this._geometry;for(var m=g.readVarint()+g.pos,v=1,E=0,P=0,L=0,A=1/0,O=-1/0,N=1/0,D=-1/0;g.pos<m;){if(E<=0){var k=g.readVarint();v=7&k,E=k>>3}if(E--,v===1||v===2)(P+=g.readSVarint())<A&&(A=P),P>O&&(O=P),(L+=g.readSVarint())<N&&(N=L),L>D&&(D=L);else if(v!==7)throw new Error("unknown command "+v)}return[A,N,O,D]},a.prototype.toGeoJSON=function(g,m,v){var E,P,L=this.extent*Math.pow(2,v),A=this.extent*g,O=this.extent*m,N=this.loadGeometry(),D=a.types[this.type];function k(Q){for(var le=0;le<Q.length;le++){var oe=Q[le];Q[le]=[360*(oe.x+A)/L-180,360/Math.PI*Math.atan(Math.exp((180-360*(oe.y+O)/L)*Math.PI/180))-90]}}switch(this.type){case 1:var U=[];for(E=0;E<N.length;E++)U[E]=N[E][0];k(N=U);break;case 2:for(E=0;E<N.length;E++)k(N[E]);break;case 3:for(N=function(Q){var le=Q.length;if(le<=1)return[Q];for(var oe,re,me=[],Se=0;Se<le;Se++){var Me=d(Q[Se]);Me!==0&&(re===void 0&&(re=Me<0),re===Me<0?(oe&&me.push(oe),oe=[Q[Se]]):oe.push(Q[Se]))}return oe&&me.push(oe),me}(N),E=0;E<N.length;E++)for(P=0;P<N[E].length;P++)k(N[E][P])}N.length===1?N=N[0]:D="Multi"+D;var X={type:"Feature",geometry:{type:D,coordinates:N},properties:this.properties};return"id"in this&&(X.id=this.id),X},tb}function nb(){if(N2)return $m;N2=1;var h=Dv();function a(d,g){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=d,this._keys=[],this._values=[],this._features=[],d.readFields(c,this,g),this.length=this._features.length}function c(d,g,m){d===15?g.version=m.readVarint():d===1?g.name=m.readString():d===5?g.extent=m.readVarint():d===2?g._features.push(m.pos):d===3?g._keys.push(m.readString()):d===4&&g._values.push(function(v){for(var E=null,P=v.readVarint()+v.pos;v.pos<P;){var L=v.readVarint()>>3;E=L===1?v.readString():L===2?v.readFloat():L===3?v.readDouble():L===4?v.readVarint64():L===5?v.readVarint():L===6?v.readSVarint():L===7?v.readBoolean():null}return E}(m))}return $m=a,a.prototype.feature=function(d){if(d<0||d>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[d];var g=this._pbf.readVarint()+this._pbf.pos;return new h(this._pbf,g,this.extent,this._keys,this._values)},$m}function Lv(){return Rv||(Rv=1,Hm.VectorTile=function(){if(La)return Ov;La=1;var h=nb();function a(c,d,g){if(c===3){var m=new h(g,g.readVarint()+g.pos);m.length&&(d[m.name]=m)}}return Ov=function(c,d){this.layers=c.readFields(a,{},d)},Ov}(),Hm.VectorTileFeature=Dv(),Hm.VectorTileLayer=nb()),Hm}var bf=Lv();const Cd="3d_elevation_id",Gm="level";class z2{constructor(){this._valid=!1}reset(a){return this.feature=a,this._valid=!0,this._geometry=a.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(a,c){return this._valid&&a(c(this._geometry)),this}require(a,c,d){return this.get(a,!0,c,d)}optional(a,c,d){return this.get(a,!1,c,d)}success(){return this._valid}get(a,c,d,g){const m=this.feature.properties.hasOwnProperty(a)?+this.feature.properties[a]:void 0;return this._valid&&m!==void 0?d(g?g(m):m):c&&(this._valid=!1),this}}class B2{constructor(a,c){this.featureFunc=a,this.vertexFunc=c}parseFeature(a,c,d){return this.featureFunc(a,c,d)}parseVertex(a,c,d){return this.vertexFunc(a,c,d)}}const JE=new B2((h,a,c)=>h.reset(a).require(Cd,d=>{c.id=d}).optional("fixed_height_relative",d=>{c.constantHeight=d},Id.decodeRelativeHeight).geometry(d=>{c.bounds=d},Id.computeBounds).success(),(h,a,c)=>h.reset(a).require(Cd,d=>{c.id=d}).require("elevation_idx",d=>{c.idx=d}).require("extent",d=>{c.extent=d}).require("height_relative",d=>{c.height=d},Id.decodeRelativeHeight).geometry(d=>{c.position=d},Id.getPoint).success()),j2=new B2((h,a,c)=>h.reset(a).require(Cd,d=>{c.id=d}).optional("fixed_height",d=>{c.constantHeight=d},Id.decodeMetricHeight).geometry(d=>{c.bounds=d},Id.computeBounds).success(),(h,a,c)=>h.reset(a).require(Cd,d=>{c.id=d}).require("elevation_idx",d=>{c.idx=d}).require("extent",d=>{c.extent=d}).require("height",d=>{c.height=d},Id.decodeMetricHeight).geometry(d=>{c.position=d},Id.getPoint).success());class Id{static computeBounds(a){const c=new Ut(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),d=new Ut(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const g of a[0])c.x>g.x&&(c.x=g.x),c.y>g.y&&(c.y=g.y),d.x<g.x&&(d.x=g.x),d.y<g.y&&(d.y=g.y);return{min:c,max:d}}static getPoint(a){return _e.vec2.fromValues(a[0][0].x,a[0][0].y)}static decodeRelativeHeight(a){return 1e-4*a*5}static decodeMetricHeight(a){return 1e-4*a}static parse(a){const c=[],d=[],g=a.length,m=new z2;for(let E=0;E<g;E++){const P=a.feature(E),L=P.properties.hasOwnProperty("version")?String(P.properties.version):void 0,A=(v=L)?v==="1.0.1"?j2:void 0:JE;if(A===void 0){ti(`Unknown elevation feature version number ${L||"(unknown)"}`);continue}const O=P.properties.hasOwnProperty("type")?P.properties.type:void 0;if(O){if(bf.VectorTileFeature.types[P.type]==="Point"&&O==="curve_point"){const N={};A.parseVertex(m,P,N)&&c.push(N)}else if(bf.VectorTileFeature.types[P.type]==="Polygon"&&O==="curve_meta"){const N={};A.parseFeature(m,P,N)&&d.push(N)}}}var v;return{vertices:c,features:d}}}class $g{constructor(a,c,d,g,m,v){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=a,this.heightRange={min:d,max:d},this.safeArea=c,this.constantHeight=d,this.constantHeight==null&&(this.constantHeight!=null||g.length!==0)){this.vertices=g,this.edges=m,this.edges=this.edges.filter(E=>E.a<this.vertices.length&&E.b<this.vertices.length&&!_e.vec2.exactEquals(this.vertices[E.a].position,this.vertices[E.b].position)),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const E of this.vertices)this.vertexProps.push({dir:_e.vec2.fromValues(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,E.height),this.heightRange.max=Math.max(this.heightRange.max,E.height);for(const E of this.edges){const P=this.vertices[E.a].position,L=this.vertices[E.b].position,A=_e.vec2.subtract(_e.vec2.create(),L,P),O=_e.vec2.length(A),N=_e.vec2.scale(_e.vec2.create(),A,1/O);this.edgeProps.push({vec:A,dir:N,len:O});const D=this.vertexProps[E.a].dir,k=this.vertexProps[E.b].dir;_e.vec2.add(D,D,N),_e.vec2.add(k,k,N)}for(const E of this.vertexProps)E.dir[0]===0&&E.dir[1]===0||_e.vec2.normalize(E.dir,E.dir);this.tessellate(v)}}pointElevation(a){if(this.constantHeight!=null)return this.constantHeight;const c=this.getClosestEdge(a);if(c==null)return 0;const[d,g]=c;return((m,v,E)=>(1-E)*m+E*v)(this.vertices[this.edges[d].a].height,this.vertices[this.edges[d].b].height,g)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(a){if(this.edges.length===0)return;let c=0,d=Number.POSITIVE_INFINITY,g=0;const m=_e.vec2.fromValues(a.x,a.y);for(let v=0;v<this.edges.length;v++){const E=this.edges[v],P=this.edgeProps[v].dir,L=new Dr(m,this.edgeProps[v].dir),A=this.vertices[E.a].position,O=this.vertices[E.b].position,N=_e.vec2.create(),D=_e.vec2.create(),k=L.intersectsPlane(A,this.vertexProps[E.a].dir,N),U=L.intersectsPlane(O,this.vertexProps[E.b].dir,D);if(!k||!U)continue;const X=_e.vec2.subtract(_e.vec2.create(),D,N),Q=_e.vec2.subtract(_e.vec2.create(),m,N),le=_e.vec2.dot(X,X),oe=le>0?_e.vec2.dot(Q,X)/le:0,re=Un(oe,0,1),me=Math.abs((oe-re)*this.edgeProps[v].len),Se=_e.vec2.subtract(_e.vec2.create(),m,A),Me=me+Math.abs(_e.vec2.dot(Se,_e.vec2.fromValues(P[1],-P[0])));Me<d&&(c=v,d=Me,g=re)}return[c,g]}tessellate(a){for(let c=this.edges.length-1;c>=0;--c){const d=this.edges[c].a,g=this.edges[c].b,{position:m,height:v,extent:E}=this.vertices[d],{position:P,height:L,extent:A}=this.vertices[g],O=this.vertexProps[d].dir,N=this.vertexProps[g].dir,D=_e.vec3.fromValues(m[0]/a,m[1]/a,v),k=_e.vec3.fromValues(P[0]/a,P[1]/a,L),U=_e.vec3.fromValues(O[1],-O[0],0);_e.vec3.scale(U,U,E);const X=_e.vec3.fromValues(N[1],-N[0],0);if(_e.vec3.scale(X,X,A),this.distSqLines(_e.vec3.fromValues(D[0]+.5*U[0],D[1]+.5*U[1],D[2]+.5*U[2]),_e.vec3.fromValues(k[0]-.5*X[0],k[1]-.5*X[1],k[2]-.5*X[2]),_e.vec3.fromValues(D[0]-.5*U[0],D[1]-.5*U[1],D[2]-.5*U[2]),_e.vec3.fromValues(k[0]+.5*X[0],k[1]+.5*X[1],k[2]+.5*X[2]))<=.05*.05)continue;const Q=this.vertices.length,le=_e.vec2.add(_e.vec2.create(),m,P);this.vertices.push({position:_e.vec2.scale(le,le,.5),height:.5*(v+L),extent:.5*(E+A)});const oe=_e.vec2.add(_e.vec2.create(),O,N);this.vertexProps.push({dir:_e.vec2.normalize(oe,oe)}),this.edges.splice(c,1),this.edgeProps.splice(c,1),this.edges.push({a:d,b:Q}),this.edges.push({a:Q,b:g});const re=_e.vec2.subtract(_e.vec2.create(),this.vertices[Q].position,m),me=_e.vec2.length(re),Se={vec:re,dir:_e.vec2.scale(_e.vec2.create(),re,1/me),len:me};this.edgeProps.push(Se),this.edgeProps.push(Se)}}distSqLines(a,c,d,g){const m=_e.vec3.subtract(_e.vec3.create(),c,a),v=_e.vec3.subtract(_e.vec3.create(),g,d),E=_e.vec3.subtract(_e.vec3.create(),a,d),P=_e.vec3.dot(m,m),L=_e.vec3.dot(m,v),A=_e.vec3.dot(m,E),O=_e.vec3.dot(v,v),N=_e.vec3.dot(v,E),D=P*O-L*L;if(D===0){const le=_e.vec3.dot(E,v)/_e.vec3.dot(v,v),oe=_e.vec3.lerp(_e.vec3.create(),d,g,le);return _e.vec3.squaredDistance(oe,a)}const k=(L*N-A*O)/D,U=(P*N-L*A)/D,X=_e.vec3.lerp(_e.vec3.create(),a,c,k),Q=_e.vec3.lerp(_e.vec3.create(),d,g,U);return _e.vec3.squaredDistance(X,Q)}}class Cs{constructor(a,c){this.zScale=1,this.xOffset=0,this.yOffset=0,a.equals(c)||(this.zScale=Math.pow(2,c.z-a.z),this.xOffset=(a.x*this.zScale-c.x)*On,this.yOffset=(a.y*this.zScale-c.y)*On)}constantElevation(a,c){if(a.constantHeight!=null)return this.computeBiasedHeight(a.constantHeight,c)}pointElevation(a,c,d){const g=this.constantElevation(c,d);return g??(a.x=a.x*this.zScale+this.xOffset,a.y=a.y*this.zScale+this.yOffset,this.computeBiasedHeight(c.pointElevation(a),d))}computeBiasedHeight(a,c){return c<=0?a:a+c*Vr(0,c,a>=0?a:Math.abs(.5*a))}}Mt($g,"ElevationFeature");class kv{constructor(){this.polygons=new Map}add(a,...c){this.polygons.has(a)?this.polygons.get(a).push(...c):this.polygons.set(a,c)}merge(a){for(const[c,d]of a.polygons)this.add(c,...d)}}class Ao{constructor(){this.portals=[]}static evaluate(a){if(a.length===0)return new Ao;let c=[];for(const L of a)c.push(...L.portals);if(c.length===0)return new Ao;const d=(L,A)=>L<=0&&A<=0||L>=On&&A>=On;for(const L of c){const A=L.va,O=L.vb;(d(A.x,O.x)||d(A.y,O.y))&&(L.type="border")}const g=c.filter(L=>L.type!=="unevaluated"),m=c.filter(L=>L.type==="unevaluated");if(m.length===0)return new Ao;m.sort((L,A)=>L.hash===A.hash?L.isTunnel===A.isTunnel?0:L.isTunnel?-1:1:L.hash<A.hash?1:-1),c=g.concat(m);let v=g.length,E=v,P=v;do if(E++,E===c.length||c[v].hash!==c[E].hash){if(E-v==2){P<v&&(c[P]=c[v],c[v]=null);const L=c[P],A=c[E-1];L.type=L.isTunnel!==A.isTunnel?"tunnel":"polygon",L.connection={a:L.connection.a,b:A.connection.a},P++}v=E}while(v!==c.length);return c.splice(P),c.sort((L,A)=>L.hash<A.hash?1:-1),{portals:c}}}Mt(Ao,"ElevationPortalGraph"),Mt(kv,"ElevationPolygons");class QE{constructor(a,c,d){this.outPositions=a,this.outNormals=c,this.outIndices=d,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(a,c,d){let g=a[2];d!=null&&(g*=d);const m=this.getVec3Bits(a)<<96n|this.getVec3Bits(c),v=this.vertexLookup.get(m);if(v!=null)return v;const E=this.outPositions.length;this.vertexLookup.set(m,E);const P=Math.trunc(16384*c[0]),L=Math.trunc(16384*c[1]),A=Math.trunc(16384*c[2]);return this.outPositions.emplaceBack(a[0],a[1],g),this.outNormals.emplaceBack(P,L,A),E}addVertices(a,c,...d){const g=[];for(const m of d){const v=this.addVertex(m,a,c);g.push(v)}return g}addTriangles(a,c,d){if(c&&d){const g=d.length===1,m=_e.vec3.fromValues(0,0,0);for(let v=0;v<a.length;v+=3){const E=c[a[v+0]],P=c[a[v+1]],L=c[a[v+2]],A=g?d[0]:d[a[v+1]],O=g?d[0]:d[a[v+2]],N=this.addVertex(_e.vec3.fromValues(E.x,E.y,g?d[0]:d[a[v+0]]),m),D=this.addVertex(_e.vec3.fromValues(P.x,P.y,A),m),k=this.addVertex(_e.vec3.fromValues(L.x,L.y,O),m);this.outIndices.emplaceBack(N,D,k)}}else for(let g=0;g<a.length;g+=3)this.outIndices.emplaceBack(a[g+0],a[g+1],a[g+2])}addQuad(a,c){const d=this.addVertices(c,void 0,...a.map(P=>_e.vec3.fromValues(P.coord.x,P.coord.y,P.height))),[g,m,v,E]=d;this.addTriangles([g,m,v,v,E,g])}getBits(a){return this.view.setFloat32(0,a),BigInt(this.view.getUint32(0))}getVec3Bits(a){return this.getBits(a[0])<<64n|this.getBits(a[1])<<32n|this.getBits(a[2])}}class Uh{constructor(a){this.unevaluatedPortals=new Ao,this.portalPolygons=new kv,this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new vd,this.vertexNormals=new Uf,this.indexArray=new Ms,this.tileToMeters=y(a)}addVertices(a,c){const d=this.unevalVertices.length;for(let g=0;g<a.length;g++)this.unevalVertices.push(a[g]),this.unevalHeights.push(c[g]);return d}addTriangles(a,c,d){const g=d?this.unevalTunnelTriangles:this.unevalTriangles;for(const m of a)g.push(m+c)}addRenderableRing(a,c,d,g,m){const v=[new Ut(m.min.x,m.min.y),new Ut(m.max.x,m.min.y),new Ut(m.max.x,m.max.y),new Ut(m.min.x,m.max.y)];for(let E=0;E<d-1;E++){const P=c+E,L=P+1,A=this.unevalVertices[P],O=this.unevalVertices[L];if(!(A.x>=m.min.x&&A.x<=m.max.x&&A.y>=m.min.y&&A.y<=m.max.y||O.x>=m.min.x&&O.x<=m.max.x&&O.y>=m.min.y&&O.y<=m.max.y||dt(A,O,v))||this.isOnBorder(A.x,O.x)||this.isOnBorder(A.y,O.y))continue;const N=Uh.computeEdgeHash(this.unevalVertices[P],this.unevalVertices[L]);let D,k=this.vertexHashLookup.get(Uh.computePosHash(A));k!=null?D=k.next:(k=this.vertexHashLookup.get(Uh.computePosHash(O)),D=k!=null?k.prev:N),this.unevalEdges.push({polygonIdx:a,a:P,b:L,hash:N,portalHash:D,isTunnel:g,type:"unevaluated"})}}addPortalCandidates(a,c,d,g,m){if(c.length===0)return;this.portalPolygons.add(a,{geometry:c,zLevel:m});const v=c[0];this.vertexHashLookup.clear();let E=Uh.computeEdgeHash(v[v.length-2],v[v.length-1]);for(let P=0;P<v.length-1;P++){const L=v[P+0],A=v[P+1],O=_e.vec2.fromValues(A.x-L.x,A.y-L.y),N=_e.vec2.length(O);if(N===0)continue;let D="unevaluated";const k=g.pointElevation(L),U=g.pointElevation(A);Math.abs(k)<.01&&Math.abs(U)<.01?D="entrance":(this.isOnBorder(L.x,A.x)||this.isOnBorder(L.y,A.y))&&(D="border");const X=Uh.computeEdgeHash(L,A);this.unevaluatedPortals.portals.push({connection:{a,b:void 0},va:L,vb:A,vab:O,length:N,hash:X,isTunnel:d,type:D});const Q=Uh.computePosHash(L);this.vertexHashLookup.set(Q,{prev:E,next:X}),E=X}}construct(a){if(this.unevalVertices.length===0)return;const c=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),d=O=>{O.primitiveLength=this.indexArray.length-O.primitiveOffset},g=new QE(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(a.portals,this.unevalEdges);const m=c(),v=c(),E=c(),P=(O,N)=>{O.sort((k,U)=>k.type===N&&U.type!==N?-1:k.type!==N&&U.type===N?1:0);const D=O.findIndex(k=>k.type!==N);return D>=0?D:O.length};let L=0;this.unevalEdges.length>0&&(L=P(this.unevalEdges,"none"),this.constructBridgeStructures(g,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:L},this.tileToMeters));const A=c();if(this.unevalEdges.length>0){const O=this.unevalEdges.splice(L),N=P(O,"tunnel")+L;this.unevalEdges.push(...O),this.constructTunnelStructures(g,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:L},{min:L,max:N})}d(E),g.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),d(A),g.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),d(v),g.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),d(m),this.maskSegments=Da.simpleSegment(0,A.primitiveOffset,0,A.primitiveLength),this.depthSegments=Da.simpleSegment(0,v.primitiveOffset,0,v.primitiveLength),this.renderableSegments=Da.simpleSegment(0,E.primitiveOffset,0,E.primitiveLength),this.shadowCasterSegments=Da.simpleSegment(0,m.primitiveOffset,0,m.primitiveLength)}upload(a){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=a.createVertexBuffer(this.vertexPositions,P2.members),this.vertexBufferNormal=a.createVertexBuffer(this.vertexNormals,O2.members),this.indexBuffer=a.createIndexBuffer(this.indexArray))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableSegments.destroy(),this.shadowCasterSegments.destroy())}computeVertexConnections(a,c,d,g){const m=new Map;for(let v=d;v<g;v++){const E=c[v],P=E.a,L=E.b;m.has(P)||m.set(P,{}),m.has(L)||m.set(L,{});const A=m.get(P),O=m.get(L);a[L]>0&&(A.to=L),a[P]>0&&(O.from=P)}return m}constructBridgeStructures(a,c,d,g,m,v){const E=this.computeVertexConnections(d,g,m.min,m.max),P=1/v,L=.5*P,A=N=>_e.vec3.fromValues(c[N].x,c[N].y,d[N]*P),O=N=>{const D=E.get(N),k=D.from,U=D.to;if(!k||!U)return;const X=A(k),Q=A(N),le=A(U),oe=_e.vec3.fromValues(0,0,0);if(!_e.vec3.exactEquals(X,Q)){const me=_e.vec3.sub(_e.vec3.create(),Q,X);_e.vec3.add(oe,oe,_e.vec3.normalize(me,me))}if(!_e.vec3.exactEquals(le,Q)){const me=_e.vec3.sub(_e.vec3.create(),le,Q);_e.vec3.add(oe,oe,_e.vec3.normalize(me,me))}const re=_e.vec3.len(oe);return re>0?_e.vec3.scale(oe,oe,1/re):void 0};for(let N=m.min;N<m.max;N++){const D=g[N],k=this.prepareEdgePoints(c,d,D,(bn,_r)=>bn>=_r);if(k==null)continue;const U=k[0],X=k[1],Q=_e.vec3.fromValues(U.coord.x,U.coord.y,P*U.height),le=_e.vec3.fromValues(X.coord.x,X.coord.y,P*X.height);if(_e.vec3.exactEquals(Q,le))continue;const oe=_e.vec3.sub(_e.vec3.create(),le,Q);_e.vec3.normalize(oe,oe);const re=bn=>_e.vec3.normalize(bn,bn),me=O(D.a)||oe,Se=O(D.b)||oe,Me=re(_e.vec3.fromValues(me[1],-me[0],0)),We=re(_e.vec3.fromValues(Se[1],-Se[0],0)),$e=re(_e.vec3.cross(_e.vec3.create(),Me,me)),He=re(_e.vec3.cross(_e.vec3.create(),We,Se)),ht=_e.vec3.create(),Ke=[_e.vec3.add(_e.vec3.create(),Q,_e.vec3.scale(ht,_e.vec3.sub(ht,Me,$e),L)),_e.vec3.add(_e.vec3.create(),Q,_e.vec3.scale(ht,_e.vec3.add(ht,Me,$e),L)),_e.vec3.add(_e.vec3.create(),Q,_e.vec3.scale(ht,$e,L)),Q],pt=[_e.vec3.add(_e.vec3.create(),le,_e.vec3.scale(ht,_e.vec3.sub(ht,We,He),L)),_e.vec3.add(_e.vec3.create(),le,_e.vec3.scale(ht,_e.vec3.add(ht,We,He),L)),_e.vec3.add(_e.vec3.create(),le,_e.vec3.scale(ht,He,L)),le],[Et,wt]=a.addVertices(Me,v,Ke[0],Ke[1]),[Ot,It]=a.addVertices(We,v,pt[0],pt[1]);a.addTriangles([Et,wt,Ot,wt,It,Ot]);const[jt,Dt]=a.addVertices($e,v,Ke[1],Ke[2]),[Vt,_n]=a.addVertices(He,v,pt[1],pt[2]);a.addTriangles([jt,Dt,Vt,Dt,_n,Vt]);const[gn,Zn]=a.addVertices(_e.vec3.negate(Me,Me),v,Ke[2],Ke[3]),[Cn,Ln]=a.addVertices(_e.vec3.negate(We,We),v,pt[2],pt[3]);a.addTriangles([gn,Zn,Cn,Zn,Ln,Cn])}}constructTunnelStructures(a,c,d,g,m,v){const E=P=>_e.vec3.normalize(P,P);for(let P=m.min;P<m.max;P++){const L=this.prepareEdgePoints(c,d,g[P],(D,k)=>D<=k);if(L==null)continue;const[A,O]=L,N=E(_e.vec3.fromValues(O.coord.y-A.coord.y,-(O.coord.x-A.coord.x),0));a.addQuad([A,O,{coord:O.coord,height:g[P].isTunnel?-.1:0},{coord:A.coord,height:g[P].isTunnel?-.1:0}],N)}for(let P=v.min;P<v.max;P++){const L=g[P],A=c[L.a],O=c[L.b],N=E(_e.vec3.fromValues(O.y-A.y,-(O.x-A.x),0));a.addQuad([{coord:O,height:0},{coord:A,height:0},{coord:A,height:d[L.a]+4},{coord:O,height:d[L.b]+4}],N),a.addQuad([{coord:A,height:0},{coord:O,height:0},{coord:O,height:d[L.b]+4},{coord:A,height:d[L.a]+4}],N)}}prepareEdgePoints(a,c,d,g){const m=a[d.a],v=a[d.b];let E=c[d.a],P=c[d.b];if(!(E!==0&&g(E,0)||P!==0&&g(P,0)))return;const L=m.clone(),A=v.clone();if(g(E,0)){if(!g(P,0)){const O=P/(P-E);A.x=dr(A.x,L.x,O),A.y=dr(A.y,L.y,O),P=dr(P,E,O)}}else{const O=E/(E-P);L.x=dr(L.x,A.x,O),L.y=dr(L.y,A.y,O),E=dr(E,P,O)}return[{coord:L,height:E},{coord:A,height:P}]}prepareEdges(a,c){if(c.length===0)return;c.sort((E,P)=>E.hash===P.hash?P.polygonIdx-E.polygonIdx:P.hash>E.hash?1:-1);let d=0,g=0,m=0,v=c[d].polygonIdx;do g++,(g===c.length||c[d].hash!==c[g].hash)&&((g-d==1||c[g-1].polygonIdx!==v)&&(m<d&&(c[m]=c[d],c[d]=null),c[m].type="none",m++),d=g,d!==c.length&&(v=c[d].polygonIdx));while(d!==c.length);if(c.splice(m),c.length!==0&&a.length!==0){c.sort((L,A)=>L.hash<A.hash?1:-1);let E=0,P=0;for(;E!==c.length&&P!==a.length;){const L=c[E],A=a[P];L.portalHash>A.hash?E++:A.hash>L.portalHash?P++:(L.type=A.type,E++)}}}isOnBorder(a,c){return a<=0&&c<=0||a>=On&&c>=On}static computeEdgeHash(a,c){return(a.y===c.y&&a.x>c.x||a.y>c.y)&&([a,c]=[c,a]),BigInt(Uh.computePosHash(a))<<32n|BigInt(Uh.computePosHash(c))}static computePosHash(a){return((65535&a.x)<<16|65535&a.y)>>>0}}class s_{constructor(a,c){this.layoutVertexArray=new Sc,this.indexArray=new Ms,this.lineIndexArray=new Nh,this.triangleSegments=new Da,this.lineSegments=new Da,this.programConfigurations=new gf(a.layers,{zoom:a.zoom,lut:a.lut}),this.uploaded=!1,c&&(this.elevatedLayoutVertexArray=new Ku)}update(a,c,d,g,m,v,E){this.programConfigurations.updatePaintArrays(a,c,m,d,g,v,E)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,jg.members),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.lineIndexBuffer=a.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=a.createVertexBuffer(this.elevatedLayoutVertexArray,Cv.members))),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(a,c,d,g,m,v){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,d,g,m,v)}}class Hg{constructor(a){this.zoom=a.zoom,this.pixelRatio=a.pixelRatio,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.bufferData=new s_(a,!1),this.elevationBufferData=new s_(a,!0),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.projection=a.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference")}updateFootprints(a,c){}populate(a,c,d,g){this.hasPattern=i_("fill",this.layers,this.pixelRatio,c);const m=this.layers[0].layout.get("fill-sort-key"),v=[];for(const{feature:E,id:P,index:L,sourceLayerIndex:A}of a){const O=this.layers[0]._featureFilter.needGeometry,N=K(E,O);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom),N,d))continue;const D=m?m.evaluate(N,{},d,c.availableImages):void 0,k={id:P,properties:E.properties,type:E.type,sourceLayerIndex:A,index:L,geometry:O?N.geometry:$(E,d,g),patterns:{},sortKey:D};v.push(k)}m&&v.sort((E,P)=>E.sortKey-P.sortKey);for(const E of v){const{geometry:P,index:L,sourceLayerIndex:A}=E;if(this.hasPattern){const O=a_("fill",this.layers,E,this.zoom,this.pixelRatio,c);this.patternFeatures.push(O)}else this.addFeature(E,P,L,d,{},c.availableImages,c.brightness,c.elevationFeatures);c.featureIndex.insert(a[L].feature,P,L,A,this.index)}}update(a,c,d,g,m,v,E){this.bufferData.update(a,c,d,g,m,v,E),this.elevationBufferData.update(a,c,d,g,m,v,E)}addFeatures(a,c,d,g,m,v){for(const E of this.patternFeatures)this.addFeature(E,E.geometry,E.index,c,d,g,v,a.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(a){this.bufferData.upload(a),this.elevationBufferData.upload(a),this.elevatedStructures&&this.elevatedStructures.upload(a)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(a,c,d,g,m,v=[],E,P){const L=r_(c,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(a,L,g,d,P):this.addGeometry(L,this.bufferData),this.bufferData.populatePaintArrays(a,d,m,v,g,E),this.elevationBufferData.populatePaintArrays(a,d,m,v,g,E)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(a){this.elevatedStructures&&this.elevatedStructures.construct(a)}addElevatedRoadFeature(a,c,d,g,m){const v=new Array,E=this.getElevationFeature(a,m);if(E){v.push({polygons:c,elevationFeature:E,elevationTileID:d});for(const P of v)if(P.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Uh(P.elevationTileID));const A=P.elevationFeature.isTunnel();let O=0;a.properties.hasOwnProperty(Gm)&&(O=+a.properties[Gm]);for(const N of P.polygons)this.elevatedStructures.addPortalCandidates(P.elevationFeature.id,N,A,P.elevationFeature,O)}const L=new Cs(d,P.elevationTileID);this.addElevatedGeometry(P.polygons,L,P.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,g)}}else this.addGeometry(c,this.bufferData)}addElevatedGeometry(a,c,d,g,m){const v={elevation:d,elevationSampler:c,bias:g,index:m},[E,P]=this.addGeometry(a,this.elevationBufferData,v);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:E,max:P}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,E),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,P))}addGeometry(a,c,d){let g=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,v=null;d&&(v=d.elevationSampler.constantElevation(d.elevation,d.bias),v!=null&&(g=v,m=v));const E=(P,L,A)=>{if(d!=null)if(L.push(P),v!=null)c.elevatedLayoutVertexArray.emplaceBack(v),A.push(v);else{const O=d.elevationSampler.pointElevation(P,d.elevation,d.bias);c.elevatedLayoutVertexArray.emplaceBack(O),A.push(O),g=Math.min(g,O),m=Math.max(m,O)}};for(const P of a){let L=0;for(const oe of P)L+=oe.length;const A=c.triangleSegments.prepareSegment(L,c.layoutVertexArray,c.indexArray),O=A.vertexLength,N=[],D=[],k=[],U=[],X=[],Q=c.layoutVertexArray.length;for(const oe of P){if(oe.length===0)continue;oe!==P[0]&&D.push(N.length/2);const re=c.lineSegments.prepareSegment(oe.length,c.layoutVertexArray,c.lineIndexArray),me=re.vertexLength;d&&X.push(c.layoutVertexArray.length-Q),E(oe[0],k,U),c.layoutVertexArray.emplaceBack(oe[0].x,oe[0].y),c.lineIndexArray.emplaceBack(me+oe.length-1,me),N.push(oe[0].x),N.push(oe[0].y);for(let Se=1;Se<oe.length;Se++)E(oe[Se],k,U),c.layoutVertexArray.emplaceBack(oe[Se].x,oe[Se].y),c.lineIndexArray.emplaceBack(me+Se-1,me+Se),N.push(oe[Se].x),N.push(oe[Se].y);re.vertexLength+=oe.length,re.primitiveLength+=oe.length}const le=e_(N,D);for(let oe=0;oe<le.length;oe+=3)c.indexArray.emplaceBack(O+le[oe],O+le[oe+1],O+le[oe+2]);if(d&&this.elevationMode==="hd-road-base"){const oe=d.elevation.isTunnel(),re=d.elevation.safeArea,me=this.elevatedStructures.addVertices(k,U);this.elevatedStructures.addTriangles(le,me,oe);const Se=X.length;if(Se>0){for(let Me=0;Me<Se-1;Me++)this.elevatedStructures.addRenderableRing(d.index,X[Me]+me,X[Me+1]-X[Me],oe,re);this.elevatedStructures.addRenderableRing(d.index,X[Se-1]+me,k.length-X[Se-1],oe,re)}}A.vertexLength+=L,A.primitiveLength+=le.length/3}return[g,m]}getElevationFeature(a,c){if(!c)return;const d=+a.properties[Cd];return d!=null?c.find(g=>g.id===d):void 0}}let rb,ib,Nv,zv;Mt(Hg,"FillBucket",{omit:["layers","patternFeatures"]}),Mt(s_,"FillBufferData"),Mt(Uh,"ElevatedStructures");class ab{constructor(a,c,d,g){if(this.triangleCount=c.length/3,this.min=new Ut(0,0),this.max=new Ut(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||a.length===0)return;const[m,v]=[a[0].clone(),a[0].clone()];for(let O=1;O<a.length;++O){const N=a[O];m.x=Math.min(m.x,N.x),m.y=Math.min(m.y,N.y),v.x=Math.max(v.x,N.x),v.y=Math.max(v.y,N.y)}if(g){const O=Math.ceil(Math.max(v.x-m.x,v.y-m.y)/g);d=Math.max(d,O)}if(d===0)return;this.min=m,this.max=v;const E=this.max.sub(this.min);E.x=Math.max(E.x,1),E.y=Math.max(E.y,1);const P=Math.max(E.x,E.y)/d;this.cellsX=Math.max(1,Math.ceil(E.x/P)),this.cellsY=Math.max(1,Math.ceil(E.y/P)),this.xScale=1/P,this.yScale=1/P;const L=[];for(let O=0;O<this.triangleCount;O++){const N=a[c[3*O+0]].sub(this.min),D=a[c[3*O+1]].sub(this.min),k=a[c[3*O+2]].sub(this.min),U=Wf(Math.floor(Math.min(N.x,D.x,k.x)),this.xScale,this.cellsX),X=Wf(Math.floor(Math.max(N.x,D.x,k.x)),this.xScale,this.cellsX),Q=Wf(Math.floor(Math.min(N.y,D.y,k.y)),this.yScale,this.cellsY),le=Wf(Math.floor(Math.max(N.y,D.y,k.y)),this.yScale,this.cellsY),oe=new Ut(0,0),re=new Ut(0,0),me=new Ut(0,0),Se=new Ut(0,0);for(let Me=Q;Me<=le;++Me){oe.y=re.y=Me*P,me.y=Se.y=(Me+1)*P;for(let We=U;We<=X;++We)oe.x=me.x=We*P,re.x=Se.x=(We+1)*P,(Xt(N,D,k,oe,re,Se)||Xt(N,D,k,oe,Se,me))&&L.push({cellIdx:Me*this.cellsX+We,triIdx:O})}}if(L.length===0)return;L.sort((O,N)=>O.cellIdx-N.cellIdx||O.triIdx-N.triIdx);let A=0;for(;A<L.length;){const O=L[A].cellIdx,N={start:this.payload.length,len:0};for(;A<L.length&&L[A].cellIdx===O;)++N.len,this.payload.push(L[A++].triIdx);this.cells[O]=N}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(a,c){if(this.triangleCount===0||this.cells.length===0||a.x>this.max.x||this.min.x>a.x||a.y>this.max.y||this.min.y>a.y)return;const d=Wf(a.x-this.min.x,this.xScale,this.cellsX),g=Wf(a.y-this.min.y,this.yScale,this.cellsY),m=this.cells[g*this.cellsX+d];if(m){this._lazyInitLookup();for(let v=0;v<m.len;v++){const E=this.payload[m.start+v],P=Math.floor(E/8),L=1<<E%8;if(!(this.lookup[P]&L)&&(this.lookup[P]|=L,c.push(E),c.length===this.triangleCount))return}}}query(a,c,d){if(this.triangleCount===0||this.cells.length===0||a.x>this.max.x||this.min.x>c.x||a.y>this.max.y||this.min.y>c.y)return;this._lazyInitLookup();const g=Wf(a.x-this.min.x,this.xScale,this.cellsX),m=Wf(c.x-this.min.x,this.xScale,this.cellsX),v=Wf(a.y-this.min.y,this.yScale,this.cellsY),E=Wf(c.y-this.min.y,this.yScale,this.cellsY);for(let P=v;P<=E;P++)for(let L=g;L<=m;L++){const A=this.cells[P*this.cellsX+L];if(A)for(let O=0;O<A.len;O++){const N=this.payload[A.start+O],D=Math.floor(N/8),k=1<<N%8;if(!(this.lookup[D]&k)&&(this.lookup[D]|=k,d.push(N),d.length===this.triangleCount))return}}}}function Wf(h,a,c){return Math.max(0,Math.min(c-1,Math.floor(h*a)))}Mt(ab,"TriangleGridIndex");class F2{constructor(a){this.zoom=a.zoom,this.layers=a.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=a.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.footprints=[]}updateFootprints(a,c){for(const d of this.footprints)c.push({footprint:d,id:a})}populate(a,c,d,g){const m=[];for(const{feature:v,id:E,index:P,sourceLayerIndex:L}of a){const A=this.layers[0]._featureFilter.needGeometry,O=K(v,A);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom),O,d))continue;const N={id:E,properties:v.properties,type:v.type,sourceLayerIndex:L,index:P,geometry:A?O.geometry:$(v,d,g),patterns:{}};m.push(N)}for(const v of m){const{geometry:E,index:P,sourceLayerIndex:L}=v;this.addFeature(v,E,P,d,{},c.availableImages,c.brightness),c.featureIndex.insert(a[P].feature,E,P,L,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(a){}update(a,c,d,g,m,v,E){}destroy(){}addFeature(a,c,d,g,m,v=[],E){for(const P of r_(c,2)){const L=[],A=[],O=[],N=new Ut(1/0,1/0),D=new Ut(-1/0,-1/0);for(const X of P)if(X.length!==0){X!==P[0]&&O.push(A.length/2);for(let Q=0;Q<X.length;Q++)A.push(X[Q].x),A.push(X[Q].y),L.push(X[Q]),N.x=Math.min(N.x,X[Q].x),N.y=Math.min(N.y,X[Q].y),D.x=Math.max(D.x,X[Q].x),D.y=Math.max(D.y,X[Q].y)}const k=e_(A,O),U=new ab(L,k,8,256);this.footprints.push({vertices:L,indices:k,grid:U,min:N,max:D})}}}Mt(F2,"ClipBucket",{omit:["layers"]});const U2=Mi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),e3=Mi([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),t3=Mi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),sb=Mi([{name:"a_join_normal_inside",components:3,type:"Int16"}]),ob=Mi([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),n3=Mi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:r3}=U2;class Ic extends Ut{constructor(a,c,d){super(a,c),this.z=d}}class lb extends Ic{constructor(a,c,d,g){super(a,c,d),this.w=g}}function o_(h,a,c,d){const g=[],m=d===0?(v,E,P,L,A,O)=>{v.push(new Ut(O,P+(O-E)/(L-E)*(A-P)))}:(v,E,P,L,A,O)=>{v.push(new Ut(E+(O-P)/(A-P)*(L-E),O))};for(const v of h){const E=[];for(const P of v){if(P.length<=2)continue;const L=[];for(let N=0;N<P.length-1;N++){const D=P[N].x,k=P[N].y,U=P[N+1].x,X=P[N+1].y,Q=d===0?D:k,le=d===0?U:X;Q<a?le>a&&m(L,D,k,U,X,a):Q>c?le<c&&m(L,D,k,U,X,c):L.push(P[N]),le<a&&Q>=a&&m(L,D,k,U,X,a),le>c&&Q<=c&&m(L,D,k,U,X,c)}let A=P[P.length-1];const O=d===0?A.x:A.y;O>=a&&O<=c&&L.push(A),L.length&&(A=L[L.length-1],L[0].x===A.x&&L[0].y===A.y||L.push(L[0]),E.push(L))}E.length&&g.push(E)}return g}function qh(h,a,c,d){const g=c==="x"?"y":"x",m=(d-h[c])/(a[c]-h[c]);h[g]=h[g]+(a[g]-h[g])*m,h[c]=d,h.hasOwnProperty("z")&&(h.z=dr(h.z,a.z,m)),h.hasOwnProperty("w")&&(h.w=dr(h.w,a.w,m))}function cb(h,a,c,d){const g=c,m=d;for(const v of["x","y"]){let E=h,P=a;E[v]>=P[v]&&(E=a,P=h),E[v]<g&&P[v]>g&&qh(E,P,v,g),E[v]<m&&P[v]>m&&qh(P,E,v,m)}}const Wm=Number.MAX_SAFE_INTEGER;function Pd(h,a,c,d){return h.order<a||h.order===Wm||!(h.clipMask&c)||function(g,m){return m.length!==0&&m.find(v=>v===g)===void 0}(d,h.clipScope)}function Bv(h,a){return h.x-a.x||h.y-a.y}function q2(h,a){return Bv(h.min,a.min)===0&&Bv(h.max,a.max)===0}function Qp(h,a){return!(h.min.x>a.max.x||h.max.x<a.min.x||h.min.y>a.max.y||h.max.y<a.min.y)}function jv(h,a){if(h.length!==a.length)return!1;for(let c=0;c<h.length;c++)if(h[c].sourceId!==a[c].sourceId||!q2(h[c],a[c])||h[c].order!==a[c].order||h[c].clipMask!==a[c].clipMask||!cn(h[c].clipScope,a[c].clipScope))return!1;return!0}function V2(h,a,c){const d=1/On,g=1/(1<<c.canonical.z),m=(a.x*d+c.canonical.x)*g+c.wrap,v=(a.y*d+c.canonical.y)*g;return{min:new Ut((h.x*d+c.canonical.x)*g+c.wrap,(h.y*d+c.canonical.y)*g),max:new Ut(m,v)}}function i3(h,a,c){const d=1<<c.canonical.z,g=((a.x-c.wrap)*d-c.canonical.x)*On,m=(a.y*d-c.canonical.y)*On;return{min:new Ut(((h.x-c.wrap)*d-c.canonical.x)*On,(h.y*d-c.canonical.y)*On),max:new Ut(g,m)}}function $2(h,a,c,d,g,m,v){const E=h.indices,P=h.vertices,L=[];for(let A=d;A<d+g;A+=3){const O=a[c[A+0]+m],N=a[c[A+1]+m],D=a[c[A+2]+m],k=Math.min(O.x,N.x,D.x),U=Math.max(O.x,N.x,D.x),X=Math.min(O.y,N.y,D.y),Q=Math.max(O.y,N.y,D.y);L.length=0,h.grid.query(new Ut(k,X),new Ut(U,Q),L);for(let le=0;le<L.length;le++){const oe=L[le];if(Xt(P[E[3*oe+0]],P[E[3*oe+1]],P[E[3*oe+2]],O,N,D,v))return!0}}return!1}function H2(h,a,c,d){if(!h||!c)return!1;let g=h.vertices;if(!a.canonical.equals(d.canonical)||a.wrap!==d.wrap){if(c.vertices.length<h.vertices.length)return H2(c,d,h,a);const m=a.canonical,v=d.canonical,E=Math.pow(2,v.z-m.z);g=h.vertices.map(P=>new Ut((P.x+m.x*On)*E-v.x*On,(P.y+m.y*On)*E-v.y*On))}return $2(c,g,h.indices,0,h.indices.length,0,0)}function G2(h,a,c,d){const g=Math.pow(2,d.z-c.z);return new Ut((h+c.x*On)*g-d.x*On,(a+c.y*On)*g-d.y*On)}function W2(h,a){const c=[];a.grid.queryPoint(h,c);const d=a.indices,g=a.vertices;for(let m=0;m<c.length;m++){const v=c[m];if(rt([g[d[3*v+0]],g[d[3*v+1]],g[d[3*v+2]]],h))return!0}return!1}const ub=[new Ut(0,0),new Ut(On,0),new Ut(On,On),new Ut(0,On)];function hb(h,a){const c=[];let d=[];if(!a||h.length<2)return[h];if(h.length===2)return dt(h[0],h[1],ub)?[h]:[];for(let g=0;g<h.length+2;g++){const m=h[g%h.length],v=h[(g+1)%h.length],E=dt(g===0?h[h.length-1]:h[(g-1)%h.length],m,ub),P=dt(m,v,ub),L=E||P;L&&d.push(m),L&&P||d.length>0&&(d.length>1&&c.push(d),d=[])}return d.length>1&&c.push(d),c}const em=bf.VectorTileFeature.types,l_=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],K2=["fill-extrusion-flood-light-ground-radius"],a3=Math.pow(2,13),Gg=Math.pow(2,15)-1,Wg=new Ut(0,1),cp=2147483648;function tm(h,a,c,d,g,m,v,E){h.emplaceBack((a<<1)+v,(c<<1)+m,(Math.floor(d*a3)<<1)+g,Math.round(E))}function Km(h,a,c){h.emplaceBack(a.x*On,a.y*On,c?1:0)}function Kg(h,a,c,d,g,m){h.emplaceBack(a.x,a.y,(c.x<<1)+d,(c.y<<1)+g,m)}function nm(h,a,c){h.emplaceBack(a.x,a.y,a.z,c[0]*16384,c[1]*16384,c[2]*16384)}class fb{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class db{constructor(){this.centroidXY=new Ut(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ut(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ut(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Ut(this.max.x-this.min.x,this.max.y-this.min.y)}}class Y2{constructor(){this.acc=new Ut(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(a,c){a.min.x===Number.MAX_VALUE&&(a.min.x=a.max.x=c.x,a.min.y=a.max.y=c.y)}appendEdge(a,c,d){this.accCount++,this.acc._add(c);let g=!!this.borders;c.x<a.min.x?(a.min.x=c.x,g=!0):c.x>a.max.x&&(a.max.x=c.x,g=!0),c.y<a.min.y?(a.min.y=c.y,g=!0):c.y>a.max.y&&(a.max.y=c.y,g=!0),((c.x===0||c.x===On)&&c.x===d.x)!=((c.y===0||c.y===On)&&c.y===d.y)&&this.processBorderOverlap(c,d),g&&this.checkBorderIntersection(c,d)}checkBorderIntersection(a,c){c.x<0!=a.x<0&&this.addBorderIntersection(0,dr(c.y,a.y,(0-c.x)/(a.x-c.x))),c.x>On!=a.x>On&&this.addBorderIntersection(1,dr(c.y,a.y,(On-c.x)/(a.x-c.x))),c.y<0!=a.y<0&&this.addBorderIntersection(2,dr(c.x,a.x,(0-c.y)/(a.y-c.y))),c.y>On!=a.y>On&&this.addBorderIntersection(3,dr(c.x,a.x,(On-c.y)/(a.y-c.y)))}addBorderIntersection(a,c){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const d=this.borders[a];c<d[0]&&(d[0]=c),c>d[1]&&(d[1]=c)}processBorderOverlap(a,c){if(a.x===c.x){if(a.y===c.y)return;const d=a.x===0?0:1;this.addBorderIntersection(d,c.y),this.addBorderIntersection(d,a.y)}else{const d=a.y===0?2:3;this.addBorderIntersection(d,c.x),this.addBorderIntersection(d,a.x)}}centroid(){return this.accCount===0?new Ut(0,0):new Ut(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((a,c)=>a+ +(c[0]!==Number.MAX_VALUE),0):0}}function pb(h,a){const c=h.add(a)._unit(),d=Un(h.x*c.x+h.y*c.y,-1,1);var g,m,v;return v=Math.acos(d),Math.min(4,Math.max(-4,Math.tan(v)))/4*Gg*((g=h).x*(m=a).y-g.y*m.x<0?-1:1)}const c_=[h=>h.x<0,h=>h.x>On,h=>h.y<0,h=>h.y>On];function s3(h,a,c,d){const g=[4];if(d===0)return g;c._mult(d);const m=h.sub(c),v=a.sub(c),E=[h,a,m,v];for(let P=0;P<4;P++)for(const L of E)if(c_[P](L)){g.push(P);break}return g}class X2{constructor(a){this.vertexArray=new Ol,this.indexArray=new Ms,this.programConfigurations=new gf(a.layers,{zoom:a.zoom,lut:a.lut},c=>K2.includes(c)),this._segments=new Da,this.hiddenByLandmarkVertexArray=new Og,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Da}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(a,c,d,g=!1){const m=a.length;if(m>2){let v=Math.max(0,this._segments.get().length-1);const E=this._segments._prepareSegment(4*m,this.vertexArray.length,2*this._segmentToGroundQuads[v].length);let P;v!==this._segments.get().length-1&&(v++,this._segmentToGroundQuads[v]=[],this._segmentToRegionTriCounts[v]=[0,0,0,0,0]);{const L=a[0],A=a[1];P=pb(L.sub(a[m-1])._perp()._unit(),A.sub(L)._perp()._unit())}for(let L=0;L<m;L++){const A=L===m-1?0:L+1,O=a[L],N=a[A],D=a[A===m-1?0:A+1],k=N.sub(O)._perp()._unit(),U=pb(k,D.sub(N)._perp()._unit()),X=P,Q=U;if(mb(O,N,c)||g&&Yg(O,c)&&Yg(N,c)){P=U;continue}const le=E.vertexLength;Kg(this.vertexArray,O,N,1,1,X),Kg(this.vertexArray,O,N,1,0,X),Kg(this.vertexArray,O,N,0,1,Q),Kg(this.vertexArray,O,N,0,0,Q),E.vertexLength+=4;const oe=s3(O,N,k,d);for(const re of oe)this._segmentToGroundQuads[v].push({id:le,region:re}),this._segmentToRegionTriCounts[v][re]+=2,E.primitiveLength+=2;P=U}}}prepareBorderSegments(){if(!this.hasData())return;const a=this._segments.get(),c=a.length;for(let d=0;d<c;d++)this._segmentToGroundQuads[d].sort((g,m)=>g.region-m.region);for(let d=0;d<c;d++){const g=this._segmentToGroundQuads[d],m=a[d],v=this._segmentToRegionTriCounts[d];v.reduce((P,L)=>P+L,0);let E=0;for(let P=0;P<=4;P++){const L=v[P];if(L!==0){let A=this.regionSegments[P];A||(A=this.regionSegments[P]=new Da);const O={vertexOffset:m.vertexOffset,primitiveOffset:m.primitiveOffset+E,vertexLength:m.vertexLength,primitiveLength:L};A.get().push(O)}E+=L}for(let P=0;P<g.length;P++){const L=g[P].id;this.indexArray.emplaceBack(L,L+1,L+3),this.indexArray.emplaceBack(L,L+3,L+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(a,c,d,g,m,v){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,a,c,d,g,m,v)}upload(a){this.hasData()&&(this.vertexBuffer=a.createVertexBuffer(this.vertexArray,e3.members),this.indexBuffer=a.createIndexBuffer(this.indexArray))}uploadPaintProperties(a){this.hasData()&&this.programConfigurations.upload(a)}update(a,c,d,g,m,v,E){this.hasData()&&this.programConfigurations.updatePaintArrays(a,c,d,g,m,v,E)}updateHiddenByLandmark(a){if(!this.hasData())return;const c=a.groundVertexCount+a.groundVertexArrayOffset;if(a.groundVertexCount===0)return;const d=a.flags&cp?1:0;for(let g=a.groundVertexArrayOffset;g<c;++g)this.hiddenByLandmarkVertexArray.emplace(g,d);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(a){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=a.createVertexBuffer(this.hiddenByLandmarkVertexArray,ob.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let a=0;a<=4;a++){const c=this.regionSegments[a];c&&c.destroy()}}}}class Fv{constructor(a){this.zoom=a.zoom,this.canonical=a.canonical,this.overscaling=a.overscaling,this.layers=a.layers,this.pixelRatio=a.pixelRatio,this.layerIds=this.layers.map(c=>c.fqid),this.index=a.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=a.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Ms,this.footprintVertices=new Sc,this.footprintSegments=[],this.layoutVertexArray=new Ac,this.centroidVertexArray=new Qd,this.wallVertexArray=new Hy,this.indexArray=new Ms,this.programConfigurations=new gf(a.layers,{zoom:a.zoom,lut:a.lut},c=>l_.includes(c)),this.segments=new Da,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.groundEffect=new X2(a),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(a,c){}populate(a,c,d,g){this.features=[],this.hasPattern=i_("fill-extrusion",this.layers,this.pixelRatio,c),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=y(d),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:m,id:v,index:E,sourceLayerIndex:P}of a){const L=this.layers[0]._featureFilter.needGeometry,A=K(m,L);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom),A,d))continue;const O={id:v,sourceLayerIndex:P,index:E,geometry:L?A.geometry:$(m,d,g),properties:m.properties,type:m.type,patterns:{}},N=this.layoutVertexArray.length,D=em[O.type]==="Polygon";if(this.hasPattern)this.features.push(a_("fill-extrusion",this.layers,O,this.zoom,this.pixelRatio,c));else if(this.wallMode)for(const k of O.geometry)for(const U of hb(k,D))this.addFeature(O,[U],E,d,{},c.availableImages,g,c.brightness);else this.addFeature(O,O.geometry,E,d,{},c.availableImages,g,c.brightness);c.featureIndex.insert(m,O.geometry,E,P,this.index,N)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(a,c,d,g,m,v){for(const E of this.features){const P=em[E.type]==="Polygon",{geometry:L}=E;if(this.wallMode)for(const A of L)for(const O of hb(A,P))this.addFeature(E,[O],E.index,c,d,g,m,v);else this.addFeature(E,L,E.index,c,d,g,m,v)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(a,c,d,g,m,v,E){this.programConfigurations.updatePaintArrays(a,c,m,d,g,v,E),this.groundEffect.update(a,c,m,d,g,v,E)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,r3),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.wallVertexBuffer=a.createVertexBuffer(this.wallVertexArray,sb.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=a.createVertexBuffer(this.layoutVertexExtArray,n3.members,!0)),this.groundEffect.upload(a)),this.groundEffect.uploadPaintProperties(a),this.programConfigurations.upload(a),this.uploaded=!0}uploadCentroid(a){this.groundEffect.uploadHiddenByLandmark(a),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=a.createVertexBuffer(this.centroidVertexArray,t3.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(a,c,d,g,m,v,E,P){const L=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(a,{})/this.tileToMeter,A=[new Ut(0,0),new Ut(On,On)],O=E.projection,N=O.name==="globe",D=this.wallMode||em[a.type]==="Polygon",k=new Y2;k.centroidDataIndex=this.centroidData.length;const U=new db,X=this.layers[0].paint.get("fill-extrusion-base").evaluate(a,{},g)<=0,Q=this.layers[0].paint.get("fill-extrusion-height").evaluate(a,{},g);let le;if(U.height=Q,U.vertexArrayOffset=this.layoutVertexArray.length,U.groundVertexArrayOffset=this.groundEffect.vertexArray.length,N&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Xd),this.wallMode){if(N)return void ti("Non zero fill-extrusion-line-width is not yet supported on globe.");if(c.length!==1)return;le=function(He){const ht=He[0].x===He[He.length-1].x&&He[0].y===He[He.length-1].y;(function(Ln){let bn=0;const _r=Ln.length;for(let Kn=0;Kn<_r;Kn++)bn+=(Ln[(Kn+1)%_r].x-Ln[Kn].x)*(Ln[(Kn+1)%_r].y+Ln[Kn].y);return bn>=0})(He)||(He=He.reverse());const pt={geometry:[],joinNormals:[],indices:[]},Et=[],wt=[],Ot=[];let It=He.length;for(;It>=2&&He[It-1].equals(He[It-2]);)It--;if(It<(ht?3:2))return pt;let jt,Dt,Vt,_n,gn,Zn=0;for(;Zn<It-1&&He[Zn].equals(He[Zn+1]);)Zn++;ht&&(jt=He[It-2],gn=He[Zn].sub(jt)._unit()._perp());for(let Ln=Zn;Ln<It;Ln++){if(Vt=Ln===It-1?ht?He[Zn+1]:void 0:He[Ln+1],Vt&&He[Ln].equals(Vt))continue;gn&&(_n=gn),jt&&(Dt=jt),jt=He[Ln],gn=Vt?Vt.sub(jt)._unit()._perp():_n,_n=_n||gn;let bn=_n.add(gn);bn.x===0&&bn.y===0||bn._unit();const _r=bn.x*gn.x+bn.y*gn.y,Kn=_r!==0?1/_r:1/0,lr=_n.x*gn.y-_n.y*gn.x>0;let Lr="miter";const Qr=2;Lr==="miter"&&Kn>Qr&&(Lr="bevel"),Lr==="bevel"&&(Kn>100&&(Lr="flipbevel"),Kn<Qr&&(Lr="miter"));const Fr=(ui,Jr,xi,Gi)=>{const Ca=new Ut(ui.x,ui.y),zr=new Ut(ui.x,ui.y);Ca.x+=Jr.x*Gi,Ca.y+=Jr.y*Gi,zr.x-=Jr.x*Math.max(xi,1),zr.y-=Jr.y*Math.max(xi,1),Ot.push(Jr),Et.push(Ca),wt.push(zr)};if(Lr==="miter")bn._mult(Kn),Fr(jt,bn,0,0);else if(Lr==="flipbevel")bn=gn.mult(-1),Fr(jt,bn,0,0),Fr(jt,bn.mult(-1),0,0);else{const ui=-Math.sqrt(Kn*Kn-1),Jr=lr?ui:0,xi=lr?0:ui;Dt&&Fr(jt,_n,Jr,xi),Vt&&Fr(jt,gn,Jr,xi)}}pt.geometry=[...Et,...wt.reverse(),Et[0]],pt.joinNormals=[...Ot,...Ot.reverse(),Ot[Ot.length-1]];const Cn=pt.geometry.length-1;for(let Ln=0;Ln<Cn/2;Ln++)if(Ln+1<Cn/2){let bn=Ln,_r=Ln+1,Kn=Cn-1-Ln,lr=Cn-2-Ln;bn=bn===0?Cn-1:bn-1,_r=_r===0?Cn-1:_r-1,Kn=Kn===0?Cn-1:Kn-1,lr=lr===0?Cn-1:lr-1,pt.indices.push(Kn),pt.indices.push(_r),pt.indices.push(bn),pt.indices.push(Kn),pt.indices.push(lr),pt.indices.push(_r)}return pt}(c[0]),c=[le.geometry]}const oe=(He,ht)=>He<(ht.length-1)/2||He===ht.length-1,re=this.wallMode?[c]:r_(c,500);for(let He=re.length-1;He>=0;He--){const ht=re[He];(ht.length===0||(me=ht[0]).every(Ke=>Ke.x<=0)||me.every(Ke=>Ke.x>=On)||me.every(Ke=>Ke.y<=0)||me.every(Ke=>Ke.y>=On))&&re.splice(He,1)}var me;let Se;if(N)Se=_b(re,A,g);else{Se=[];for(const He of re)Se.push({polygon:He,bounds:A})}const Me=D?this.edgeRadius:0,We=Me>0&&this.zoom<17,$e=(He,ht)=>{if(He.length===0)return!1;const Ke=He[He.length-1];return ht.x===Ke.x&&ht.y===Ke.y};for(const{polygon:He,bounds:ht}of Se){let Ke=0,pt=0;for(const It of He)D&&!It[0].equals(It[It.length-1])&&It.push(It[0]),pt+=D?It.length-1:It.length;const Et=this.segments.prepareSegment((D?5:4)*pt,this.layoutVertexArray,this.indexArray);U.footprintSegIdx<0&&(U.footprintSegIdx=this.footprintSegments.length),U.polygonSegIdx<0&&(U.polygonSegIdx=this.polygonSegments.length);const wt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ot=new fb;if(Ot.vertexOffset=this.footprintVertices.length,Ot.indexOffset=3*this.footprintIndices.length,Ot.ringIndices=[],D){const It=[],jt=[];Ke=Et.vertexLength;for(let Vt=0;Vt<He.length;Vt++){const _n=He[Vt];_n.length&&Vt!==0&&jt.push(It.length/2);const gn=[];let Zn,Cn;Zn=_n[1].sub(_n[0])._perp()._unit(),Ot.ringIndices.push(_n.length-1);for(let Ln=1;Ln<_n.length;Ln++){const bn=_n[Ln],_r=_n[Ln===_n.length-1?1:Ln+1],Kn=bn.clone();if(Me){Cn=_r.sub(bn)._perp()._unit();const lr=Zn.add(Cn)._unit(),Lr=Me*Math.min(4,1/(Zn.x*lr.x+Zn.y*lr.y));Kn.x+=Lr*lr.x,Kn.y+=Lr*lr.y,Kn.x=Math.round(Kn.x),Kn.y=Math.round(Kn.y),Zn=Cn}if(!X||Me!==0&&!We||$e(gn,Kn)||gn.push(Kn),tm(this.layoutVertexArray,Kn.x,Kn.y,0,0,1,1,0),this.wallMode){const lr=oe(Ln,_n);Km(this.wallVertexArray,le.joinNormals[Ln],!lr)}Et.vertexLength++,this.footprintVertices.emplaceBack(bn.x,bn.y),It.push(bn.x,bn.y),N&&nm(this.layoutVertexExtArray,O.projectTilePoint(Kn.x,Kn.y,g),O.upVector(g,Kn.x,Kn.y))}X&&(Me===0||We)&&(gn.length!==0&&$e(gn,gn[0])&&gn.pop(),this.groundEffect.addData(gn,ht,L))}const Dt=this.wallMode?le.indices:e_(It,jt);for(let Vt=0;Vt<Dt.length;Vt+=3)this.footprintIndices.emplaceBack(Ot.vertexOffset+Dt[Vt+0],Ot.vertexOffset+Dt[Vt+1],Ot.vertexOffset+Dt[Vt+2]),this.indexArray.emplaceBack(Ke+Dt[Vt],Ke+Dt[Vt+2],Ke+Dt[Vt+1]),Et.primitiveLength++;Ot.indexCount+=Dt.length,Ot.vertexCount+=this.footprintVertices.length-Ot.vertexOffset}for(let It=0;It<He.length;It++){const jt=He[It];k.startRing(U,jt[0]);let Dt=jt.length>4&&Z2(jt[jt.length-2],jt[0],jt[1]),Vt=Me?Uv(jt[jt.length-2],jt[0],jt[1],Me):0;const _n=[];let gn,Zn,Cn;Zn=jt[1].sub(jt[0])._perp()._unit();let Ln=!0;for(let bn=1,_r=0;bn<jt.length;bn++){let Kn=jt[bn-1],lr=jt[bn];const Lr=jt[bn===jt.length-1?1:bn+1];if(k.appendEdge(U,lr,Kn),mb(lr,Kn,ht)){Me&&(Zn=Lr.sub(lr)._perp()._unit(),Ln=!Ln);continue}const Qr=lr.sub(Kn)._perp(),Fr=Qr.x/(Math.abs(Qr.x)+Math.abs(Qr.y)),ui=Qr.y>0?1:0,Jr=Kn.dist(lr);if(_r+Jr>32768&&(_r=0),Me){Cn=Lr.sub(lr)._perp()._unit();let zr=qv(Kn,lr,Lr,u_(Zn,Cn),Me);isNaN(zr)&&(zr=0);const Ii=lr.sub(Kn)._unit();Kn=Kn.add(Ii.mult(Vt))._round(),lr=lr.add(Ii.mult(-zr))._round(),Vt=zr,Zn=Cn,X&&this.zoom>=17&&($e(_n,Kn)||_n.push(Kn),$e(_n,lr)||_n.push(lr))}const xi=Et.vertexLength,Gi=jt.length>4&&Z2(Kn,lr,Lr);let Ca=gb(_r,Dt,Ln);if(tm(this.layoutVertexArray,Kn.x,Kn.y,Fr,ui,0,0,Ca),tm(this.layoutVertexArray,Kn.x,Kn.y,Fr,ui,0,1,Ca),this.wallMode){const zr=oe(bn-1,jt),Ii=le.joinNormals[bn-1];Km(this.wallVertexArray,Ii,zr),Km(this.wallVertexArray,Ii,zr)}if(_r+=Jr,Ca=gb(_r,Gi,!Ln),Dt=Gi,tm(this.layoutVertexArray,lr.x,lr.y,Fr,ui,0,0,Ca),tm(this.layoutVertexArray,lr.x,lr.y,Fr,ui,0,1,Ca),this.wallMode){const zr=oe(bn,jt),Ii=le.joinNormals[bn];Km(this.wallVertexArray,Ii,zr),Km(this.wallVertexArray,Ii,zr)}if(Et.vertexLength+=4,this.indexArray.emplaceBack(xi+0,xi+1,xi+2),this.indexArray.emplaceBack(xi+1,xi+3,xi+2),Et.primitiveLength+=2,Me){const zr=Ke+(bn===1?jt.length-2:bn-2),Ii=bn===1?Ke:zr+1;if(this.indexArray.emplaceBack(xi+1,zr,xi+3),this.indexArray.emplaceBack(zr,Ii,xi+3),Et.primitiveLength+=2,gn===void 0&&(gn=xi),!mb(Lr,jt[bn],ht)){const Ya=bn===jt.length-1?gn:Et.vertexLength;this.indexArray.emplaceBack(xi+2,xi+3,Ya),this.indexArray.emplaceBack(xi+3,Ya+1,Ya),this.indexArray.emplaceBack(xi+3,Ii,Ya+1),Et.primitiveLength+=3}Ln=!Ln}if(N){const zr=this.layoutVertexExtArray,Ii=O.projectTilePoint(Kn.x,Kn.y,g),Ya=O.projectTilePoint(lr.x,lr.y,g),ss=O.upVector(g,Kn.x,Kn.y),ms=O.upVector(g,lr.x,lr.y);nm(zr,Ii,ss),nm(zr,Ii,ss),nm(zr,Ya,ms),nm(zr,Ya,ms)}}D&&(Ke+=jt.length-1),X&&Me&&this.zoom>=17&&(_n.length!==0&&$e(_n,_n[0])&&_n.pop(),this.groundEffect.addData(_n,ht,L,Me>0))}this.footprintSegments.push(Ot),wt.triangleCount=this.indexArray.length-wt.triangleArrayOffset,this.polygonSegments.push(wt),++U.footprintSegLen,++U.polygonSegLen}if(U.vertexCount=this.layoutVertexArray.length-U.vertexArrayOffset,U.groundVertexCount=this.groundEffect.vertexArray.length-U.groundVertexArrayOffset,U.vertexCount!==0){if(U.centroidXY=k.borders?Wg:this.encodeCentroid(k,U),this.centroidData.push(U),k.borders){this.featuresOnBorder.push(k);const He=this.featuresOnBorder.length-1;for(let ht=0;ht<k.borders.length;ht++)k.borders[ht][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[ht].push(He)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,d,m,v,g,P),this.groundEffect.addPaintPropertiesData(a,d,m,v,g,P),this.maxHeight=Math.max(this.maxHeight,Q)}}sortBorders(){for(let a=0;a<this.borderFeatureIndices.length;a++)this.borderFeatureIndices[a].sort((c,d)=>this.featuresOnBorder[c].borders[a][0]-this.featuresOnBorder[d].borders[a][0])}splitToSubtiles(){const a=[];for(let E=0;E<this.centroidData.length;E++){const P=this.centroidData[E],L=+(P.min.y+P.max.y>On),A=2*L+(+(P.min.x+P.max.x>On)^L);for(let O=0;O<P.polygonSegLen;O++){const N=P.polygonSegIdx+O;a.push({centroidIdx:E,subtile:A,polygonSegmentIdx:N,triangleSegmentIdx:this.polygonSegments[N].triangleSegIdx})}}const c=new Ms;a.sort((E,P)=>E.triangleSegmentIdx===P.triangleSegmentIdx?E.subtile-P.subtile:E.triangleSegmentIdx-P.triangleSegmentIdx);let d=0,g=0,m=0;for(const E of a){if(E.triangleSegmentIdx!==d)break;m++}const v=a.length;for(;g!==a.length;){d=a[g].triangleSegmentIdx;let E=0,P=g,L=g;for(let A=P;A<m&&a[A].subtile===E;A++)L++;for(;P!==m;){const A=a[P];E=A.subtile;const O=this.centroidData[A.centroidIdx].min.clone(),N=this.centroidData[A.centroidIdx].max.clone(),D={vertexOffset:this.segments.segments[d].vertexOffset,primitiveOffset:c.length,vertexLength:this.segments.segments[d].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let k=P;k<L;k++){const U=a[k],X=this.polygonSegments[U.polygonSegmentIdx],Q=this.centroidData[U.centroidIdx].min,le=this.centroidData[U.centroidIdx].max,oe=this.indexArray.uint16;for(let re=X.triangleArrayOffset;re<X.triangleArrayOffset+X.triangleCount;re++)c.emplaceBack(oe[3*re],oe[3*re+1],oe[3*re+2]);D.primitiveLength+=X.triangleCount,O.x=Math.min(O.x,Q.x),O.y=Math.min(O.y,Q.y),N.x=Math.max(N.x,le.x),N.y=Math.max(N.y,le.y)}D.primitiveLength>0&&this.triangleSubSegments.push({segment:D,min:O,max:N}),P=L;for(let k=P;k<m&&a[k].subtile===a[P].subtile;k++)L++}g=m;for(let A=g;A<v&&a[A].triangleSegmentIdx===a[g].triangleSegmentIdx;A++)m++}c._trim(),this.indexArray=c}getVisibleSegments(a,c,d){const g=new Da;if(this.wallMode){for(const U of this.triangleSubSegments)g.segments.push(U.segment);return g}let m=0,v=0;const E=1<<a.canonical.z;if(c){const U=c.getMinMaxForTile(a);U&&(m=U.min,v=U.max)}v+=this.maxHeight;const P=a.toUnwrapped();let L;const A=[P.canonical.x/E+P.wrap,P.canonical.y/E],O=[(P.canonical.x+1)/E+P.wrap,(P.canonical.y+1)/E],N=(U,X,Q)=>[U[0]*(1-Q[0])+X[0]*Q[0],U[1]*(1-Q[1])+X[1]*Q[1]],D=[],k=[];for(const U of this.triangleSubSegments){D[0]=U.min.x/On,D[1]=U.min.y/On,k[0]=U.max.x/On,k[1]=U.max.y/On;const X=N(A,O,D),Q=N(A,O,k);if(new tr([X[0],X[1],m],[Q[0],Q[1],v]).intersectsPrecise(d)===0){L&&(g.segments.push(L),L=void 0);continue}const le=U.segment;L&&L.vertexOffset!==le.vertexOffset&&(g.segments.push(L),L=void 0),L?(L.vertexLength+=le.vertexLength,L.primitiveLength+=le.primitiveLength):L={vertexOffset:le.vertexOffset,primitiveLength:le.primitiveLength,vertexLength:le.vertexLength,primitiveOffset:le.primitiveOffset,sortKey:void 0,vaos:{}}}return L&&g.segments.push(L),g}encodeCentroid(a,c){const d=a.centroid(),g=c.span(),m=Math.min(7,Math.round(g.x*this.tileToMeter/10)),v=Math.min(7,Math.round(g.y*this.tileToMeter/10));return new Ut(Un(d.x,1,On-1)<<3|m,Un(d.y,1,On-1)<<3|v)}encodeBorderCentroid(a){if(!a.borders)return new Ut(0,0);const c=a.borders,d=Number.MAX_VALUE;if(c[0][0]!==d||c[1][0]!==d){const g=c[0][0]!==d?0:1;return new Ut(6|(c[0][0]!==d?0:65528),(c[g][0]+c[g][1])/2<<3|6)}{const g=c[2][0]!==d?2:3;return new Ut((c[g][0]+c[g][1])/2<<3|6,6|(c[2][0]!==d?0:65528))}}showCentroid(a){const c=this.centroidData[a.centroidDataIndex];c.flags&=cp,c.centroidXY.x=0,c.centroidXY.y=0,this.writeCentroidToBuffer(c)}writeCentroidToBuffer(a){this.groundEffect.updateHiddenByLandmark(a);const c=a.vertexArrayOffset,d=a.vertexCount+a.vertexArrayOffset,g=a.flags&cp?Wg:a.centroidXY,m=this.centroidVertexArray.geta_centroid_pos0(c);if(this.centroidVertexArray.geta_centroid_pos1(c)!==g.y||m!==g.x){for(let v=c;v<d;++v)this.centroidVertexArray.emplace(v,g.x,g.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const a of this.centroidData)this.writeCentroidToBuffer(a)}updateReplacement(a,c,d){if(c.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=c.updateTime;const g=c.getReplacementRegionsForTile(a.toUnwrapped());if(jv(this.activeReplacements,g))return;if(this.activeReplacements=g,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const v of this.centroidData)v.flags&=2147483647;const m=[];for(const v of this.activeReplacements){if(v.order<d)continue;const E=Math.max(1,Math.pow(2,v.footprintTileId.canonical.z-a.canonical.z));for(const P of this.centroidData)if(!(P.flags&cp||v.min.x>P.max.x||P.min.x>v.max.x||v.min.y>P.max.y||P.min.y>v.max.y))for(let L=0;L<P.footprintSegLen;L++){const A=this.footprintSegments[P.footprintSegIdx+L];if(m.length=0,J2(this.footprintVertices,A.vertexOffset,A.vertexCount,v.footprintTileId.canonical,a.canonical,m),$2(v.footprint,m,this.footprintIndices.uint16,A.indexOffset,A.indexCount,-A.vertexOffset,-E)){P.flags|=cp;break}}}for(const v of this.centroidData)this.writeCentroidToBuffer(v);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(a,c,d){let g=!1;for(let m=0;m<d.footprintSegLen;m++){const v=this.footprintSegments[d.footprintSegIdx+m];let E=0;for(const P of v.ringIndices){for(let L=E,A=P+E-1;L<P+E;A=L++){const O=this.footprintVertices.int16[2*(L+v.vertexOffset)+0],N=this.footprintVertices.int16[2*(L+v.vertexOffset)+1],D=this.footprintVertices.int16[2*(A+v.vertexOffset)+1];N>c!=D>c&&a<(this.footprintVertices.int16[2*(A+v.vertexOffset)+0]-O)*(c-N)/(D-N)+O&&(g=!g)}E=P}}return g}getHeightAtTileCoord(a,c){let d=Number.NEGATIVE_INFINITY,g=!0;const m=4*(a+On)*On+(c+On);if(this.partLookup.hasOwnProperty(m)){const v=this.partLookup[m];return v?{height:v.height,hidden:!!(v.flags&cp)}:void 0}for(const v of this.centroidData)a>v.max.x||v.min.x>a||c>v.max.y||v.min.y>c||this.footprintContainsPoint(a,c,v)&&v&&v.height>d&&(d=v.height,this.partLookup[m]=v,g=!!(v.flags&cp));if(d!==Number.NEGATIVE_INFINITY)return{height:d,hidden:g};this.partLookup[m]=void 0}}function u_(h,a){const c=h.add(a)._unit();return h.x*c.x+h.y*c.y}function Uv(h,a,c,d){const g=a.sub(h)._perp()._unit(),m=c.sub(a)._perp()._unit();return qv(h,a,c,u_(g,m),d)}function qv(h,a,c,d,g){const m=Math.sqrt(1-d*d);return Math.min(h.dist(a)/3,a.dist(c)/3,g*m/d)}function mb(h,a,c){return h.x<c[0].x&&a.x<c[0].x||h.x>c[1].x&&a.x>c[1].x||h.y<c[0].y&&a.y<c[0].y||h.y>c[1].y&&a.y>c[1].y}function Yg(h,a){return h.x<a[0].x||h.x>a[1].x||h.y<a[0].y||h.y>a[1].y}function Z2(h,a,c){if(h.x<0||h.x>=On||a.x<0||a.x>=On||c.x<0||c.x>=On)return!1;const d=c.sub(a),g=d.perp(),m=h.sub(a);return(d.x*m.x+d.y*m.y)/Math.sqrt((d.x*d.x+d.y*d.y)*(m.x*m.x+m.y*m.y))>-.866&&g.x*m.x+g.y*m.y<0}function gb(h,a,c){const d=a?2|h:-3&h;return c?1|d:-2&d}function yb(){const h=Math.PI/32,a=Math.tan(h),c=al;return c*Math.sqrt(1+2*a*a)-c}function _b(h,a,c){const d=1<<c.z,g=Mc(c.x/d),m=Mc((c.x+1)/d),v=xa(c.y/d),E=xa((c.y+1)/d);return function(P,L,A,O,N=0,D){const k=[];if(!P.length||!A||!O)return k;const U=(Se,Me)=>{for(const We of Se)k.push({polygon:We,bounds:Me})},X=Math.ceil(Math.log2(A)),Q=Math.ceil(Math.log2(O)),le=X-Q,oe=[];for(let Se=0;Se<Math.abs(le);Se++)oe.push(le>0?0:1);for(let Se=0;Se<Math.min(X,Q);Se++)oe.push(0),oe.push(1);let re=P;if(re=o_(re,L[0].y-N,L[1].y+N,1),re=o_(re,L[0].x-N,L[1].x+N,0),!re.length)return k;const me=[];for(oe.length?me.push({polygons:re,bounds:L,depth:0}):U(re,L);me.length;){const Se=me.pop(),Me=Se.depth,We=oe[Me],$e=Se.bounds[0],He=Se.bounds[1],ht=We===0?$e.x:$e.y,Ke=We===0?He.x:He.y,pt=D?D(We,ht,Ke):.5*(ht+Ke),Et=o_(Se.polygons,ht-N,pt+N,We),wt=o_(Se.polygons,pt-N,Ke+N,We);if(Et.length){const Ot=[$e,new Ut(We===0?pt:He.x,We===1?pt:He.y)];oe.length>Me+1?me.push({polygons:Et,bounds:Ot,depth:Me+1}):U(Et,Ot)}if(wt.length){const Ot=[new Ut(We===0?pt:$e.x,We===1?pt:$e.y),He];oe.length>Me+1?me.push({polygons:wt,bounds:Ot,depth:Me+1}):U(wt,Ot)}}return k}(h,a,Math.ceil((m-g)/11.25),Math.ceil((v-E)/11.25),1,(P,L,A)=>{if(P===0)return .5*(L+A);{const O=xa((c.y+L/On)/d);return(Ma(.5*(xa((c.y+A/On)/d)+O))*d-c.y)*On}})}function J2(h,a,c,d,g,m){const v=Math.pow(2,d.z-g.z);for(let E=0;E<c;E++){let P=h.int16[2*(E+a)+0],L=h.int16[2*(E+a)+1];P=(P+g.x*On)*v-d.x*On,L=(L+g.y*On)*v-d.y*On,m.push(new Ut(P,L))}}let Vv,vb;function rm(h,a){return h.x*a.x+h.y*a.y}function Q2(h,a){if(h.length===1){let c=0;const d=a[c++];let g;for(;!g||d.equals(g);)if(g=a[c++],!g)return 1/0;for(;c<a.length;c++){const m=a[c],v=h[0],E=g.sub(d),P=m.sub(d),L=v.sub(d),A=rm(E,E),O=rm(E,P),N=rm(P,P),D=rm(L,E),k=rm(L,P),U=A*N-O*O,X=(N*D-O*k)/U,Q=(A*k-O*D)/U,le=d.z*(1-X-Q)+g.z*X+m.z*Q;if(isFinite(le))return le}return 1/0}{let c=1/0;for(const d of a)c=Math.min(c,d.z);return c}}function eS(h,a,c,d,g,m,v,E){const P=v*g.getElevationAt(h,a,!0,!0),L=m[0]!==0,A=L?m[1]===0?v*(m[0]/7-450):v*function(O,N,D){const k=Math.floor(N[0]/8),U=Math.floor(N[1]/8),X=10*(N[0]-8*k),Q=10*(N[1]-8*U),le=O.getElevationAt(k,U,!0,!0),oe=O.getMeterToDEM(D),re=Math.floor(.5*(X*oe-1)),me=Math.floor(.5*(Q*oe-1)),Se=O.tileCoordToPixel(k,U),Me=2*re+1,We=2*me+1,$e=function(wt,Ot,It,jt,Dt){return[wt.getElevationAtPixel(Ot,It,!0),wt.getElevationAtPixel(Ot+Dt,It,!0),wt.getElevationAtPixel(Ot,It+Dt,!0),wt.getElevationAtPixel(Ot+jt,It+Dt,!0)]}(O,Se.x-re,Se.y-me,Me,We),He=Math.abs($e[0]-$e[1]),ht=Math.abs($e[2]-$e[3]),Ke=Math.abs($e[0]-$e[2])+Math.abs($e[1]-$e[3]),pt=Math.min(.25,.5*oe*(He+ht)/Me),Et=Math.min(.25,.5*oe*Ke/We);return le+Math.max(pt*X,Et*Q)}(g,m,E):P;return{base:P+(c===0?-1:c),top:L?Math.max(A+d,P+c+2):P+d}}Mt(Fv,"FillExtrusionBucket",{omit:["layers","features"]}),Mt(db,"PartData"),Mt(fb,"FootprintSegment"),Mt(Y2,"BorderCentroidData"),Mt(X2,"GroundEffect");const bb=Mi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),xb=Mi([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:$v}=bb,wb=Mi([{name:"a_packed",components:3,type:"Float32"}]),{members:tS}=wb,Sb=Mi([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:im}=Sb;class up{constructor(a,c){this.width=a,this.height=c,this.nextRow=0,this.image=new Xp({width:a,height:c}),this.positions={},this.uploaded=!1}getDash(a,c){const d=this.getKey(a,c);return this.positions[d]}trim(){const a=this.width,c=this.height=hn(this.nextRow);this.image.resize({width:a,height:c})}getKey(a,c){return a.join(",")+c}getDashRanges(a,c,d){const g=[];let m=a.length%2==1?-a[a.length-1]*d:0,v=a[0]*d,E=!0;g.push({left:m,right:v,isDash:E,zeroLength:a[0]===0});let P=a[0];for(let L=1;L<a.length;L++){E=!E;const A=a[L];m=P*d,P+=A,v=P*d,g.push({left:m,right:v,isDash:E,zeroLength:A===0})}return g}addRoundDash(a,c,d){const g=c/2;for(let m=-d;m<=d;m++){const v=this.width*(this.nextRow+d+m);let E=0,P=a[E];for(let L=0;L<this.width;L++){L/P.right>1&&(P=a[++E]);const A=Math.abs(L-P.left),O=Math.abs(L-P.right),N=Math.min(A,O);let D;const k=m/d*(g+1);if(P.isDash){const U=g-Math.abs(k);D=Math.sqrt(N*N+U*U)}else D=g-Math.sqrt(N*N+k*k);this.image.data[v+L]=Math.max(0,Math.min(255,D+128))}}}addRegularDash(a,c){for(let P=a.length-1;P>=0;--P){const L=a[P],A=a[P+1];L.zeroLength?a.splice(P,1):A&&A.isDash===L.isDash&&(A.left=L.left,a.splice(P,1))}const d=a[0],g=a[a.length-1];d.isDash===g.isDash&&(d.left=g.left-this.width,g.right=d.right+this.width);const m=this.width*this.nextRow;let v=0,E=a[v];for(let P=0;P<this.width;P++){P/E.right>1&&(E=a[++v]);const L=Math.abs(P-E.left),A=Math.abs(P-E.right),O=Math.min(L,A);this.image.data[m+P]=Math.max(0,Math.min(255,(E.isDash?O:-O)+c+128))}}addDash(a,c){const d=this.getKey(a,c);if(this.positions[d])return this.positions[d];const g=c==="round",m=g?7:0,v=2*m+1;if(this.nextRow+v>this.height)return ti("LineAtlas out of space"),null;a.length===0&&a.push(1);let E=0;for(let A=0;A<a.length;A++)a[A]<0&&(ti("Negative value is found in line dasharray, replacing values with 0"),a[A]=0),E+=a[A];if(E!==0){const A=this.width/E,O=this.getDashRanges(a,this.width,A);g?this.addRoundDash(O,A,m):this.addRegularDash(O,c==="square"?.5*A:0)}const P=this.nextRow+m;this.nextRow+=v;const L={tl:[P,m],br:[E,0]};return this.positions[d]=L,L}}Mt(up,"LineAtlas");const am=bf.VectorTileFeature.types,h_=Math.cos(Math.PI/180*37.5),f_=Math.cos(Math.PI/180*5);class Od{constructor(a){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=a.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=a.overscaling,this.pixelRatio=a.pixelRatio,this.layers=a.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=a.index,this.projection=a.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new bd,this.layoutVertexArray2=new So,this.patternVertexArray=new So,this.indexArray=new Ms,this.programConfigurations=new gf(a.layers,{zoom:a.zoom,lut:a.lut}),this.segments=new Da,this.maxLineLength=0,this.zOffsetVertexArray=new So,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.tessellationStep=a.tessellationStep?a.tessellationStep:On/64}updateFootprints(a,c){}populate(a,c,d,g){this.hasPattern=i_("line",this.layers,this.pixelRatio,c);const m=this.layers[0].layout.get("line-sort-key");this.tileToMeter=y(d);const v=this.layers[0].layout.get("line-z-offset"),E=v.isConstant()&&!v.constantOr(0),P=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset=P==="sea"||P==="ground"||!E&&P==="none",this.hasZOffset&&P==="none"&&ti(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const L=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&L!==void 0;const A=[];for(const{feature:k,id:U,index:X,sourceLayerIndex:Q}of a){const le=this.layers[0]._featureFilter.needGeometry,oe=K(k,le);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom),oe,d))continue;const re=m?m.evaluate(oe,{},d):void 0,me={id:U,properties:k.properties,type:k.type,sourceLayerIndex:Q,index:X,geometry:le?oe.geometry:$(k,d,g),patterns:{},sortKey:re};A.push(me)}m&&A.sort((k,U)=>k.sortKey-U.sortKey);const{lineAtlas:O,featureIndex:N}=c,D=this.addConstantDashes(O);for(const k of A){const{geometry:U,index:X,sourceLayerIndex:Q}=k;if(D&&this.addFeatureDashes(k,O),this.hasPattern){const le=a_("line",this.layers,k,this.zoom,this.pixelRatio,c);this.patternFeatures.push(le)}else this.addFeature(k,U,X,d,O.positions,c.availableImages,c.brightness);N.insert(a[X].feature,U,X,Q,this.index)}}addConstantDashes(a){let c=!1;for(const d of this.layers){const g=d.paint.get("line-dasharray").value,m=d.layout.get("line-cap").value;if(g.kind!=="constant"||m.kind!=="constant")c=!0;else{const v=m.value,E=g.value;if(!E)continue;a.addDash(E,v)}}return c}addFeatureDashes(a,c){const d=this.zoom;for(const g of this.layers){const m=g.paint.get("line-dasharray").value,v=g.layout.get("line-cap").value;if(m.kind==="constant"&&v.kind==="constant")continue;let E,P;if(m.kind==="constant"){if(E=m.value,!E)continue}else E=m.evaluate({zoom:d},a);P=v.kind==="constant"?v.value:v.evaluate({zoom:d},a),c.addDash(E,P),a.patterns[g.id]=c.getKey(E,P)}}update(a,c,d,g,m,v,E){this.programConfigurations.updatePaintArrays(a,c,m,d,g,v,E)}addFeatures(a,c,d,g,m,v){for(const E of this.patternFeatures)this.addFeature(E,E.geometry,E.index,c,d,g,v)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,tS)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=a.createVertexBuffer(this.patternVertexArray,im)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=a.createVertexBuffer(this.zOffsetVertexArray,xb.members,!0)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,$v),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(a){if(a.properties&&a.properties.hasOwnProperty("mapbox_clip_start")&&a.properties.hasOwnProperty("mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}}addFeature(a,c,d,g,m,v,E){const P=this.layers[0].layout,L=P.get("line-join").evaluate(a,{}),A=P.get("line-cap").evaluate(a,{}),O=P.get("line-miter-limit"),N=P.get("line-round-limit");this.lineClips=this.lineFeatureClips(a),this.lineFeature=a,this.zOffsetValue=P.get("line-z-offset").value;const D=this.layers[0].paint.get("line-width").value;D.kind!=="constant"&&D.isLineProgressConstant===!1&&(this.variableWidthValue=D);for(const k of c)this.addLine(k,a,g,L,A,O,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,d,m,v,g,E)}addLine(a,c,d,g,m,v,E){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const P=g==="none";if(this.patternJoinNone=this.hasPattern&&P,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let oe=0;oe<a.length-1;oe++)this.totalDistance+=a[oe].dist(a[oe+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const L=am[c.type]==="Polygon";let A=a.length;for(;A>=2&&a[A-1].equals(a[A-2]);)A--;let O=0;for(;O<A-1&&a[O].equals(a[O+1]);)O++;if(A<(L?3:2))return;g==="bevel"&&(v=1.05);const N=this.segments.prepareSegment(10*A,this.layoutVertexArray,this.indexArray);let D,k,U,X,Q,le;this.e1=this.e2=-1,L&&(D=a[A-2],Q=a[O].sub(D)._unit()._perp());for(let oe=O;oe<A;oe++){if(U=oe===A-1?L?a[O+1]:void 0:a[oe+1],U&&a[oe].equals(U))continue;Q&&(X=Q),D&&(k=D),D=a[oe],le=this.evaluateLineProgressFeatures(k?k.dist(D):0),Q=U?U.sub(D)._unit()._perp():X,X=X||Q;const re=k&&U;let me=re?g:L||P?"butt":m;const Se=X.x*Q.x+X.y*Q.y;if(P){const Et=function(wt){if(wt.patternJoinNone){const Ot=wt.segmentPoints.length/2,It=wt.lineSoFar-wt.segmentStart;for(let jt=0;jt<Ot;++jt){const Dt=wt.segmentPoints[2*jt+1],Vt=Math.round(wt.segmentPoints[2*jt])+.5+.25*Dt;wt.patternVertexArray.emplaceBack(Vt,It,wt.segmentStart),wt.patternVertexArray.emplaceBack(Vt,It,wt.segmentStart)}wt.segmentPoints.length=0}wt.e1=wt.e2=-1};if(re&&Se<f_){this.updateDistance(k,D),this.addCurrentVertex(D,X,1,1,N,le),Et(this),this.addCurrentVertex(D,Q,-1,-1,N,le);continue}if(k){if(!U){this.updateDistance(k,D),this.addCurrentVertex(D,X,1,1,N,le),Et(this);continue}me="miter"}}let Me=X.add(Q);Me.x===0&&Me.y===0||Me._unit();const We=Me.x*Q.x+Me.y*Q.y,$e=We!==0?1/We:1/0,He=2*Math.sqrt(2-2*We),ht=We<h_&&k&&U,Ke=X.x*Q.y-X.y*Q.x>0,pt=this.overscaling<=16?15*On/(512*this.overscaling):0;if(re&&me==="round"){if($e<E)me="miter";else if($e<=2){const Et=Ab(D,-10,On+10);me=this.hasZOffset&&(Et||this.hasCrossSlope)?"miter":"fakeround"}}if(me==="miter"&&$e>v&&(me="bevel"),me==="bevel"&&($e>2&&(me="flipbevel"),$e<v&&(me="miter")),k&&!(me==="miter"&&ht)&&this.updateDistance(k,D),me==="miter")if(ht){const Et=D.dist(k);if(Et>2*pt){const Ot=D.sub(D.sub(k)._mult(pt/Et)._round());this.updateDistance(k,Ot),this.addCurrentVertex(Ot,X,0,0,N,le),k=Ot}this.updateDistance(k,D),Me._mult($e),this.addCurrentVertex(D,Me,0,0,N,le);const wt=D.dist(U);if(wt>2*pt){const Ot=D.add(U.sub(D)._mult(pt/wt)._round());this.updateDistance(D,Ot),this.addCurrentVertex(Ot,Q,0,0,N,le),D=Ot}}else Me._mult($e),this.addCurrentVertex(D,Me,0,0,N,le);else if(me==="flipbevel"){if($e>100)Me=Q.mult(-1);else{const Et=$e*X.add(Q).mag()/X.sub(Q).mag();Me._perp()._mult(Et*(Ke?-1:1))}this.addCurrentVertex(D,Me,0,0,N,le),this.addCurrentVertex(D,Me.mult(-1),0,0,N,le)}else if(me==="bevel"||me==="fakeround"){le!=null&&k&&this.addCurrentVertex(D,X,-1,-1,N,le);const Et=D.dist(k)<=2*pt&&me!=="bevel",wt=Me.mult(Ke?1:-1);wt._mult($e);const Ot=Q.mult(Ke?-1:1),It=X.mult(Ke?-1:1),jt=this.evaluateLineProgressFeatures(this.distance);if(le==null&&(this.addHalfVertex(D,wt.x,wt.y,!1,!Ke,0,N,jt),Et||this.addHalfVertex(D,wt.x+2*It.x,wt.y+2*It.y,!1,Ke,0,N,jt)),me==="fakeround"){const Dt=Math.round(180*He/Math.PI/20);this.addHalfVertex(D,It.x,It.y,!1,Ke,0,N,jt);for(let Vt=0;Vt<Dt;Vt++){let _n=Vt/Dt;if(_n!==.5){const Zn=_n-.5;_n+=_n*Zn*(_n-1)*((1.0904+Se*(Se*(3.55645-1.43519*Se)-3.2452))*Zn*Zn+(.848013+Se*(.215638*Se-1.06021)))}const gn=Ot.sub(It)._mult(_n)._add(It)._unit();this.addHalfVertex(D,gn.x,gn.y,!1,Ke,0,N,jt)}this.addHalfVertex(D,Ot.x,Ot.y,!1,Ke,0,N,jt)}Et||le!=null||this.addHalfVertex(D,wt.x+2*Ot.x,wt.y+2*Ot.y,!1,Ke,0,N,jt),le!=null&&U&&this.addCurrentVertex(D,Q,1,1,N,le)}else me==="butt"?this.addCurrentVertex(D,Me,0,0,N,le):me==="square"?(k||this.addCurrentVertex(D,Me,-1,-1,N,le),this.addCurrentVertex(D,Me,0,0,N,le),k&&this.addCurrentVertex(D,Me,1,1,N,le)):me==="round"&&(k&&(this.addCurrentVertex(D,X,0,0,N,le),this.addCurrentVertex(D,X,1,1,N,le,!0)),U&&(this.addCurrentVertex(D,Q,-1,-1,N,le,!0),this.addCurrentVertex(D,Q,0,0,N,le)))}}addVerticesTo(a,c,d,g,m,v,E,P,L,A){const O=(c.w-a.w)/this.tessellationStep|0;let N=0;const D=this.scaledDistance;if(O>1){this.lineSoFar=a.w;const U=(c.x-a.x)/O,X=(c.y-a.y)/O,Q=(c.z-a.z)/O,le=(c.w-a.w)/O;for(let oe=1;oe<O;++oe){a.x+=U,a.y+=X,a.z+=Q,this.lineSoFar+=le,N+=le;const re=this.evaluateLineProgressFeatures(this.prevDistance+N);this.scaledDistance=(this.prevDistance+N)/this.totalDistance,this.addHalfVertex(a,d,g,A,!1,E,L,re),this.addHalfVertex(a,m,v,A,!0,-P,L,re)}}this.lineSoFar=c.w,this.scaledDistance=D;const k=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(c,d,g,A,!1,E,L,k),this.addHalfVertex(c,m,v,A,!0,-P,L,k)}evaluateLineProgressFeatures(a){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+a)/this.totalFeatureLength):ti(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let c=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(c=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:c}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:c}:{zOffset:0,variableWidth:c}}addCurrentVertex(a,c,d,g,m,v,E=!1){const P=c.x+c.y*d,L=c.y-c.x*d,A=c.y*g-c.x,O=-c.y-c.x*g;if(v!=null){const N=this.hasZOffset,D=-10,k=On+10,U=v.zOffset,X=new lb(a.x,a.y,U,this.lineSoFar),Q=!!N&&Ab(a,D,k),le=this.lineSoFar,oe=this.distance;if(this.currentVertex)if(Q){const re=this.currentVertexIsOutside,me=this.currentVertex,Se=new lb(a.x,a.y,U,this.lineSoFar);if(cb(me,Se,D,k),!Ab(Se,D,k)){if(re){this.e1=this.e2=-1,this.distance-=me.dist(X),this.lineSoFar=me.w;const Me=this.evaluateLineProgressFeatures(me.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(me,P,L,E,!1,d,m,Me),this.addHalfVertex(me,A,O,E,!0,-g,m,Me),this.prevDistance=this.distance}this.distance=this.prevDistance+me.dist(Se),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(me,Se,P,L,A,O,d,g,m,E),this.distance=oe,this.scaledDistance=this.distance/this.totalDistance}}else{const re=this.currentVertex;if(this.currentVertexIsOutside){cb(re,X,D,k),this.e1=this.e2=-1,this.distance-=re.dist(X),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=re.w;const me=this.evaluateLineProgressFeatures(re.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(re,P,L,E,!1,d,m,me),this.addHalfVertex(re,A,O,E,!0,-g,m,me),this.prevDistance=this.distance,this.distance=oe,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(re,X,P,L,A,O,d,g,m,E)}else Q||(this.addHalfVertex(a,P,L,E,!1,d,m,v),this.addHalfVertex(a,A,O,E,!0,-g,m,v));this.currentVertex=X,this.currentVertexIsOutside=Q,this.lineSoFar=le}else this.addHalfVertex(a,P,L,E,!1,d,m,v),this.addHalfVertex(a,A,O,E,!0,-g,m,v)}addHalfVertex({x:a,y:c},d,g,m,v,E,P,L){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),v||this.segmentPoints.push(this.lineSoFar-this.segmentStart,E)),this.layoutVertexArray.emplaceBack((a<<1)+(m?1:0),(c<<1)+(v?1:0),Math.round(63*d)+128,Math.round(63*g)+128,1+(E===0?0:E<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const O=dr(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,O)}const A=P.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,A),P.primitiveLength++),v?this.e2=A:this.e1=A,L!=null&&this.zOffsetVertexArray.emplaceBack(L.zOffset,L.variableWidth,L.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(a,c){this.prevDistance=this.distance,this.distance+=a.dist(c),this.updateScaledDistance()}}function Ab(h,a,c){return h.x<a||h.x>c||h.y<a||h.y>c}let Tb,Xg;function nS(h,a,c){return a*(On/(h.tileSize*Math.pow(2,c-h.tileID.overscaledZ)))}Mt(Od,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Eb=(h,a,c)=>(1-c)*h+c*a;function d_(h,a){return 1/nS(h,1,a.tileZoom)}function Mb(h,a,c,d){return h.translatePosMatrix(d||a.tileID.projMatrix,a,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}const rS=h=>{const a=[];p_(h)&&a.push("RENDER_LINE_DASH"),h.paint.get("line-gradient")&&a.push("RENDER_LINE_GRADIENT");const c=h.paint.get("line-trim-offset");c[0]===0&&c[1]===0||a.push("RENDER_LINE_TRIM_OFFSET"),h.paint.get("line-border-width").constantOr(1)!==0&&a.push("RENDER_LINE_BORDER");const d=h.layout.get("line-join").constantOr("miter")==="none",g=!!h.paint.get("line-pattern").constantOr(1);return d&&g&&a.push("LINE_JOIN_NONE"),a};function p_(h){const a=h.paint.get("line-dasharray").value;return a.value||a.kind!=="constant"}let Zg;const Cb=()=>Zg||(Zg={layout:Tb||(Tb=new Ra({"line-cap":new Fn(qt.layout_line["line-cap"]),"line-join":new Fn(qt.layout_line["line-join"]),"line-miter-limit":new En(qt.layout_line["line-miter-limit"]),"line-round-limit":new En(qt.layout_line["line-round-limit"]),"line-sort-key":new Fn(qt.layout_line["line-sort-key"]),"line-z-offset":new Fn(qt.layout_line["line-z-offset"]),"line-elevation-reference":new En(qt.layout_line["line-elevation-reference"]),"line-cross-slope":new En(qt.layout_line["line-cross-slope"]),visibility:new En(qt.layout_line.visibility),"line-width-unit":new En(qt.layout_line["line-width-unit"])})),paint:Xg||(Xg=new Ra({"line-opacity":new Fn(qt.paint_line["line-opacity"]),"line-color":new Fn(qt.paint_line["line-color"]),"line-translate":new En(qt.paint_line["line-translate"]),"line-translate-anchor":new En(qt.paint_line["line-translate-anchor"]),"line-width":new Fn(qt.paint_line["line-width"]),"line-gap-width":new Fn(qt.paint_line["line-gap-width"]),"line-offset":new Fn(qt.paint_line["line-offset"]),"line-blur":new Fn(qt.paint_line["line-blur"]),"line-dasharray":new Fn(qt.paint_line["line-dasharray"]),"line-pattern":new Fn(qt.paint_line["line-pattern"]),"line-gradient":new Wa(qt.paint_line["line-gradient"]),"line-trim-offset":new En(qt.paint_line["line-trim-offset"]),"line-trim-fade-range":new En(qt.paint_line["line-trim-fade-range"]),"line-trim-color":new En(qt.paint_line["line-trim-color"]),"line-emissive-strength":new En(qt.paint_line["line-emissive-strength"]),"line-border-width":new Fn(qt.paint_line["line-border-width"]),"line-border-color":new Fn(qt.paint_line["line-border-color"]),"line-occlusion-opacity":new En(qt.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Fn({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Fn({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Fn({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Fn({type:"string",default:"default","property-type":"data-driven"})}))},Zg);class m_ extends Fn{possiblyEvaluate(a,c){return c=new bi(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,transition:c.transition}),super.possiblyEvaluate(a,c)}evaluate(a,c,d,g){return c=wi({},c,{zoom:Math.floor(c.zoom)}),super.evaluate(a,c,d,g)}}let Ym;function g_(h,a){return a>0?a+2*h:h}const iS=Mi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),o3=Mi([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Hv=Mi([{name:"a_projected_pos",components:4,type:"Float32"}],4);Mi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const p=Mi([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),b=Mi([{name:"a_texb",components:2,type:"Uint16"}]),M=Mi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),B=Mi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Mi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Y=Mi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ae=Mi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Mi([{name:"triangle",components:3,type:"Uint16"}]),Mi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Mi([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Mi([{type:"Float32",name:"offsetX"}]),Mi([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Ne=24;const ot=128;function Bt(h,a,c,d,g){if(h.kind==="camera")return h.maxSize;if(h.kind==="composite"){const m=a.possiblyEvaluate(new bi(h.maxZoom),c).evaluate(g,{},c),v=a.possiblyEvaluate(new bi(h.minZoom),c).evaluate(g,{},c);return Math.max(m,v)}return a.possiblyEvaluate(new bi(d)).evaluate(g,{},c)}function ln(h,a){const{expression:c}=a;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new bi(h+1))};if(c.kind==="source")return{kind:"source"};{const{zoomStops:d,interpolationType:g}=c;let m=0;for(;m<d.length&&d[m]<=h;)m++;m=Math.max(0,m-1);let v=m;for(;v<d.length&&d[v]<h+1;)v++;v=Math.min(d.length-1,v);const E=d[m],P=d[v];return c.kind==="composite"?{kind:"composite",minZoom:E,maxZoom:P,interpolationType:g}:{kind:"camera",minZoom:E,maxZoom:P,minSize:c.evaluate(new bi(E)),maxSize:c.evaluate(new bi(P)),interpolationType:g}}}function $n(h,{uSize:a,uSizeT:c},{lowerSize:d,upperSize:g}){return h.kind==="source"?d/ot:h.kind==="composite"?dr(d/ot,g/ot,c):a}function ir(h,a,c=1){let d=0,g=0;if(h.kind==="constant")g=h.layoutSize*c;else if(h.kind!=="source"){const{interpolationType:m,minZoom:v,maxZoom:E}=h,P=m?Un(Ha.interpolationFactor(m,a,v,E),0,1):0;h.kind==="camera"?g=dr(h.minSize,h.maxSize,P)*c:d=P*c}return{uSizeT:d,uSize:g}}var Mn=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:ot,evaluateSizeForFeature:$n,evaluateSizeForZoom:ir,getRasterizedIconSize:Bt,getSizeData:ln});function Hn(h,a,c){return h.sections.forEach(d=>{d.text=function(g,m,v){const E=m.layout.get("text-transform").evaluate(v,{});return E==="uppercase"?g=g.toLocaleUpperCase():E==="lowercase"&&(g=g.toLocaleLowerCase()),is.applyArabicShaping&&(g=is.applyArabicShaping(g)),g}(d.text,a,c)}),h}const Zr={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function Zi(h){return h==="︶"||h==="﹈"||h==="︸"||h==="﹄"||h==="﹂"||h==="︾"||h==="︼"||h==="︺"||h==="︘"||h==="﹀"||h==="︐"||h==="︓"||h==="︔"||h==="｀"||h==="￣"||h==="︑"||h==="︒"}function $o(h){return h==="︵"||h==="﹇"||h==="︷"||h==="﹃"||h==="﹁"||h==="︽"||h==="︻"||h==="︹"||h==="︗"||h==="︿"}var yn,rn,An,Qn={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Kr(){return yn||(yn=1,Qn.read=function(h,a,c,d,g){var m,v,E=8*g-d-1,P=(1<<E)-1,L=P>>1,A=-7,O=c?g-1:0,N=c?-1:1,D=h[a+O];for(O+=N,m=D&(1<<-A)-1,D>>=-A,A+=E;A>0;m=256*m+h[a+O],O+=N,A-=8);for(v=m&(1<<-A)-1,m>>=-A,A+=d;A>0;v=256*v+h[a+O],O+=N,A-=8);if(m===0)m=1-L;else{if(m===P)return v?NaN:1/0*(D?-1:1);v+=Math.pow(2,d),m-=L}return(D?-1:1)*v*Math.pow(2,m-d)},Qn.write=function(h,a,c,d,g,m){var v,E,P,L=8*m-g-1,A=(1<<L)-1,O=A>>1,N=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,D=d?0:m-1,k=d?1:-1,U=a<0||a===0&&1/a<0?1:0;for(a=Math.abs(a),isNaN(a)||a===1/0?(E=isNaN(a)?1:0,v=A):(v=Math.floor(Math.log(a)/Math.LN2),a*(P=Math.pow(2,-v))<1&&(v--,P*=2),(a+=v+O>=1?N/P:N*Math.pow(2,1-O))*P>=2&&(v++,P/=2),v+O>=A?(E=0,v=A):v+O>=1?(E=(a*P-1)*Math.pow(2,g),v+=O):(E=a*Math.pow(2,O-1)*Math.pow(2,g),v=0));g>=8;h[c+D]=255&E,D+=k,E/=256,g-=8);for(v=v<<g|E,L+=g;L>0;h[c+D]=255&v,D+=k,v/=256,L-=8);h[c+D-k]|=128*U}),Qn}function ma(){if(An)return rn;An=1,rn=a;var h=Kr();function a(re){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(re)?re:new Uint8Array(re||0),this.pos=0,this.type=0,this.length=this.buf.length}a.Varint=0,a.Fixed64=1,a.Bytes=2,a.Fixed32=5;var c=4294967296,d=1/c,g=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function m(re){return re.type===a.Bytes?re.readVarint()+re.pos:re.pos+1}function v(re,me,Se){return Se?4294967296*me+(re>>>0):4294967296*(me>>>0)+(re>>>0)}function E(re,me,Se){var Me=me<=16383?1:me<=2097151?2:me<=268435455?3:Math.floor(Math.log(me)/(7*Math.LN2));Se.realloc(Me);for(var We=Se.pos-1;We>=re;We--)Se.buf[We+Me]=Se.buf[We]}function P(re,me){for(var Se=0;Se<re.length;Se++)me.writeVarint(re[Se])}function L(re,me){for(var Se=0;Se<re.length;Se++)me.writeSVarint(re[Se])}function A(re,me){for(var Se=0;Se<re.length;Se++)me.writeFloat(re[Se])}function O(re,me){for(var Se=0;Se<re.length;Se++)me.writeDouble(re[Se])}function N(re,me){for(var Se=0;Se<re.length;Se++)me.writeBoolean(re[Se])}function D(re,me){for(var Se=0;Se<re.length;Se++)me.writeFixed32(re[Se])}function k(re,me){for(var Se=0;Se<re.length;Se++)me.writeSFixed32(re[Se])}function U(re,me){for(var Se=0;Se<re.length;Se++)me.writeFixed64(re[Se])}function X(re,me){for(var Se=0;Se<re.length;Se++)me.writeSFixed64(re[Se])}function Q(re,me){return(re[me]|re[me+1]<<8|re[me+2]<<16)+16777216*re[me+3]}function le(re,me,Se){re[Se]=me,re[Se+1]=me>>>8,re[Se+2]=me>>>16,re[Se+3]=me>>>24}function oe(re,me){return(re[me]|re[me+1]<<8|re[me+2]<<16)+(re[me+3]<<24)}return a.prototype={destroy:function(){this.buf=null},readFields:function(re,me,Se){for(Se=Se||this.length;this.pos<Se;){var Me=this.readVarint(),We=Me>>3,$e=this.pos;this.type=7&Me,re(We,me,this),this.pos===$e&&this.skip(Me)}return me},readMessage:function(re,me){return this.readFields(re,me,this.readVarint()+this.pos)},readFixed32:function(){var re=Q(this.buf,this.pos);return this.pos+=4,re},readSFixed32:function(){var re=oe(this.buf,this.pos);return this.pos+=4,re},readFixed64:function(){var re=Q(this.buf,this.pos)+Q(this.buf,this.pos+4)*c;return this.pos+=8,re},readSFixed64:function(){var re=Q(this.buf,this.pos)+oe(this.buf,this.pos+4)*c;return this.pos+=8,re},readFloat:function(){var re=h.read(this.buf,this.pos,!0,23,4);return this.pos+=4,re},readDouble:function(){var re=h.read(this.buf,this.pos,!0,52,8);return this.pos+=8,re},readVarint:function(re){var me,Se,Me=this.buf;return me=127&(Se=Me[this.pos++]),Se<128?me:(me|=(127&(Se=Me[this.pos++]))<<7,Se<128?me:(me|=(127&(Se=Me[this.pos++]))<<14,Se<128?me:(me|=(127&(Se=Me[this.pos++]))<<21,Se<128?me:function(We,$e,He){var ht,Ke,pt=He.buf;if(ht=(112&(Ke=pt[He.pos++]))>>4,Ke<128||(ht|=(127&(Ke=pt[He.pos++]))<<3,Ke<128)||(ht|=(127&(Ke=pt[He.pos++]))<<10,Ke<128)||(ht|=(127&(Ke=pt[He.pos++]))<<17,Ke<128)||(ht|=(127&(Ke=pt[He.pos++]))<<24,Ke<128)||(ht|=(1&(Ke=pt[He.pos++]))<<31,Ke<128))return v(We,ht,$e);throw new Error("Expected varint not more than 10 bytes")}(me|=(15&(Se=Me[this.pos]))<<28,re,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var re=this.readVarint();return re%2==1?(re+1)/-2:re/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var re=this.readVarint()+this.pos,me=this.pos;return this.pos=re,re-me>=12&&g?function(Se,Me,We){return g.decode(Se.subarray(Me,We))}(this.buf,me,re):function(Se,Me,We){for(var $e="",He=Me;He<We;){var ht,Ke,pt,Et=Se[He],wt=null,Ot=Et>239?4:Et>223?3:Et>191?2:1;if(He+Ot>We)break;Ot===1?Et<128&&(wt=Et):Ot===2?(192&(ht=Se[He+1]))==128&&(wt=(31&Et)<<6|63&ht)<=127&&(wt=null):Ot===3?(Ke=Se[He+2],(192&(ht=Se[He+1]))==128&&(192&Ke)==128&&((wt=(15&Et)<<12|(63&ht)<<6|63&Ke)<=2047||wt>=55296&&wt<=57343)&&(wt=null)):Ot===4&&(Ke=Se[He+2],pt=Se[He+3],(192&(ht=Se[He+1]))==128&&(192&Ke)==128&&(192&pt)==128&&((wt=(15&Et)<<18|(63&ht)<<12|(63&Ke)<<6|63&pt)<=65535||wt>=1114112)&&(wt=null)),wt===null?(wt=65533,Ot=1):wt>65535&&(wt-=65536,$e+=String.fromCharCode(wt>>>10&1023|55296),wt=56320|1023&wt),$e+=String.fromCharCode(wt),He+=Ot}return $e}(this.buf,me,re)},readBytes:function(){var re=this.readVarint()+this.pos,me=this.buf.subarray(this.pos,re);return this.pos=re,me},readPackedVarint:function(re,me){if(this.type!==a.Bytes)return re.push(this.readVarint(me));var Se=m(this);for(re=re||[];this.pos<Se;)re.push(this.readVarint(me));return re},readPackedSVarint:function(re){if(this.type!==a.Bytes)return re.push(this.readSVarint());var me=m(this);for(re=re||[];this.pos<me;)re.push(this.readSVarint());return re},readPackedBoolean:function(re){if(this.type!==a.Bytes)return re.push(this.readBoolean());var me=m(this);for(re=re||[];this.pos<me;)re.push(this.readBoolean());return re},readPackedFloat:function(re){if(this.type!==a.Bytes)return re.push(this.readFloat());var me=m(this);for(re=re||[];this.pos<me;)re.push(this.readFloat());return re},readPackedDouble:function(re){if(this.type!==a.Bytes)return re.push(this.readDouble());var me=m(this);for(re=re||[];this.pos<me;)re.push(this.readDouble());return re},readPackedFixed32:function(re){if(this.type!==a.Bytes)return re.push(this.readFixed32());var me=m(this);for(re=re||[];this.pos<me;)re.push(this.readFixed32());return re},readPackedSFixed32:function(re){if(this.type!==a.Bytes)return re.push(this.readSFixed32());var me=m(this);for(re=re||[];this.pos<me;)re.push(this.readSFixed32());return re},readPackedFixed64:function(re){if(this.type!==a.Bytes)return re.push(this.readFixed64());var me=m(this);for(re=re||[];this.pos<me;)re.push(this.readFixed64());return re},readPackedSFixed64:function(re){if(this.type!==a.Bytes)return re.push(this.readSFixed64());var me=m(this);for(re=re||[];this.pos<me;)re.push(this.readSFixed64());return re},skip:function(re){var me=7&re;if(me===a.Varint)for(;this.buf[this.pos++]>127;);else if(me===a.Bytes)this.pos=this.readVarint()+this.pos;else if(me===a.Fixed32)this.pos+=4;else{if(me!==a.Fixed64)throw new Error("Unimplemented type: "+me);this.pos+=8}},writeTag:function(re,me){this.writeVarint(re<<3|me)},realloc:function(re){for(var me=this.length||16;me<this.pos+re;)me*=2;if(me!==this.length){var Se=new Uint8Array(me);Se.set(this.buf),this.buf=Se,this.length=me}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(re){this.realloc(4),le(this.buf,re,this.pos),this.pos+=4},writeSFixed32:function(re){this.realloc(4),le(this.buf,re,this.pos),this.pos+=4},writeFixed64:function(re){this.realloc(8),le(this.buf,-1&re,this.pos),le(this.buf,Math.floor(re*d),this.pos+4),this.pos+=8},writeSFixed64:function(re){this.realloc(8),le(this.buf,-1&re,this.pos),le(this.buf,Math.floor(re*d),this.pos+4),this.pos+=8},writeVarint:function(re){(re=+re||0)>268435455||re<0?function(me,Se){var Me,We;if(me>=0?(Me=me%4294967296|0,We=me/4294967296|0):(We=~(-me/4294967296),4294967295^(Me=~(-me%4294967296))?Me=Me+1|0:(Me=0,We=We+1|0)),me>=18446744073709552e3||me<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Se.realloc(10),function($e,He,ht){ht.buf[ht.pos++]=127&$e|128,$e>>>=7,ht.buf[ht.pos++]=127&$e|128,$e>>>=7,ht.buf[ht.pos++]=127&$e|128,$e>>>=7,ht.buf[ht.pos++]=127&$e|128,ht.buf[ht.pos]=127&($e>>>=7)}(Me,0,Se),function($e,He){var ht=(7&$e)<<4;He.buf[He.pos++]|=ht|(($e>>>=3)?128:0),$e&&(He.buf[He.pos++]=127&$e|(($e>>>=7)?128:0),$e&&(He.buf[He.pos++]=127&$e|(($e>>>=7)?128:0),$e&&(He.buf[He.pos++]=127&$e|(($e>>>=7)?128:0),$e&&(He.buf[He.pos++]=127&$e|(($e>>>=7)?128:0),$e&&(He.buf[He.pos++]=127&$e)))))}(We,Se)}(re,this):(this.realloc(4),this.buf[this.pos++]=127&re|(re>127?128:0),re<=127||(this.buf[this.pos++]=127&(re>>>=7)|(re>127?128:0),re<=127||(this.buf[this.pos++]=127&(re>>>=7)|(re>127?128:0),re<=127||(this.buf[this.pos++]=re>>>7&127))))},writeSVarint:function(re){this.writeVarint(re<0?2*-re-1:2*re)},writeBoolean:function(re){this.writeVarint(!!re)},writeString:function(re){re=String(re),this.realloc(4*re.length),this.pos++;var me=this.pos;this.pos=function(Me,We,$e){for(var He,ht,Ke=0;Ke<We.length;Ke++){if((He=We.charCodeAt(Ke))>55295&&He<57344){if(!ht){He>56319||Ke+1===We.length?(Me[$e++]=239,Me[$e++]=191,Me[$e++]=189):ht=He;continue}if(He<56320){Me[$e++]=239,Me[$e++]=191,Me[$e++]=189,ht=He;continue}He=ht-55296<<10|He-56320|65536,ht=null}else ht&&(Me[$e++]=239,Me[$e++]=191,Me[$e++]=189,ht=null);He<128?Me[$e++]=He:(He<2048?Me[$e++]=He>>6|192:(He<65536?Me[$e++]=He>>12|224:(Me[$e++]=He>>18|240,Me[$e++]=He>>12&63|128),Me[$e++]=He>>6&63|128),Me[$e++]=63&He|128)}return $e}(this.buf,re,this.pos);var Se=this.pos-me;Se>=128&&E(me,Se,this),this.pos=me-1,this.writeVarint(Se),this.pos+=Se},writeFloat:function(re){this.realloc(4),h.write(this.buf,re,this.pos,!0,23,4),this.pos+=4},writeDouble:function(re){this.realloc(8),h.write(this.buf,re,this.pos,!0,52,8),this.pos+=8},writeBytes:function(re){var me=re.length;this.writeVarint(me),this.realloc(me);for(var Se=0;Se<me;Se++)this.buf[this.pos++]=re[Se]},writeRawMessage:function(re,me){this.pos++;var Se=this.pos;re(me,this);var Me=this.pos-Se;Me>=128&&E(Se,Me,this),this.pos=Se-1,this.writeVarint(Me),this.pos+=Me},writeMessage:function(re,me,Se){this.writeTag(re,a.Bytes),this.writeRawMessage(me,Se)},writePackedVarint:function(re,me){me.length&&this.writeMessage(re,P,me)},writePackedSVarint:function(re,me){me.length&&this.writeMessage(re,L,me)},writePackedBoolean:function(re,me){me.length&&this.writeMessage(re,N,me)},writePackedFloat:function(re,me){me.length&&this.writeMessage(re,A,me)},writePackedDouble:function(re,me){me.length&&this.writeMessage(re,O,me)},writePackedFixed32:function(re,me){me.length&&this.writeMessage(re,D,me)},writePackedSFixed32:function(re,me){me.length&&this.writeMessage(re,k,me)},writePackedFixed64:function(re,me){me.length&&this.writeMessage(re,U,me)},writePackedSFixed64:function(re,me){me.length&&this.writeMessage(re,X,me)},writeBytesField:function(re,me){this.writeTag(re,a.Bytes),this.writeBytes(me)},writeFixed32Field:function(re,me){this.writeTag(re,a.Fixed32),this.writeFixed32(me)},writeSFixed32Field:function(re,me){this.writeTag(re,a.Fixed32),this.writeSFixed32(me)},writeFixed64Field:function(re,me){this.writeTag(re,a.Fixed64),this.writeFixed64(me)},writeSFixed64Field:function(re,me){this.writeTag(re,a.Fixed64),this.writeSFixed64(me)},writeVarintField:function(re,me){this.writeTag(re,a.Varint),this.writeVarint(me)},writeSVarintField:function(re,me){this.writeTag(re,a.Varint),this.writeSVarint(me)},writeStringField:function(re,me){this.writeTag(re,a.Bytes),this.writeString(me)},writeFloatField:function(re,me){this.writeTag(re,a.Fixed32),this.writeFloat(me)},writeDoubleField:function(re,me){this.writeTag(re,a.Fixed64),this.writeDouble(me)},writeBooleanField:function(re,me){this.writeVarintField(re,!!me)}},rn}var oi=x(ma());const Ci=3;function tc(h,a,c){a.glyphs=[],h===1&&c.readMessage(es,a)}function es(h,a,c){if(h===3){const{id:d,bitmap:g,width:m,height:v,left:E,top:P,advance:L}=c.readMessage(sm,{});a.glyphs.push({id:d,bitmap:new Xp({width:m+2*Ci,height:v+2*Ci},g),metrics:{width:m,height:v,left:E,top:P,advance:L}})}else h===4?a.ascender=c.readSVarint():h===5&&(a.descender=c.readSVarint())}function sm(h,a,c){h===1?a.id=c.readVarint():h===2?a.bitmap=c.readBytes():h===3?a.width=c.readVarint():h===4?a.height=c.readVarint():h===5?a.left=c.readSVarint():h===6?a.top=c.readSVarint():h===7&&(a.advance=c.readVarint())}const l3=Ci,Vh={horizontal:1,vertical:2,horizontalOnly:3};class Ib{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(a,c){const d=new Ib;return d.scale=a||1,d.fontStack=c,d}static forImage(a){const c=new Ib;return c.image=a,c}}class Gv{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(a,c,d){const g=new Gv;for(let m=0;m<a.sections.length;m++){const v=a.sections[m];v.image?g.addImageSection(v,d):g.addTextSection(v,c)}return g}length(){return this.text.length}getSection(a){return this.sections[this.sectionIndex[a]]}getSections(){return this.sections}getSectionIndex(a){return this.sectionIndex[a]}getCodePoint(a){return this.text.codePointAt(a)}verticalizePunctuation(a){this.text=function(c,d){let g="";for(let m=0;m<c.length;m++){const v=c.charCodeAt(m+1)||null,E=c.charCodeAt(m-1)||null;g+=!d&&(v&&Tr(v)&&!Zr[c[m+1]]||E&&Tr(E)&&!Zr[c[m-1]])||!Zr[c[m]]?c[m]:Zr[c[m]]}return g}(this.text,a)}trim(){let a=0;for(let d=0;d<this.text.length&&aS[this.text.charCodeAt(d)];d++)a++;let c=this.text.length;for(let d=this.text.length-1;d>=0&&d>=a&&aS[this.text.charCodeAt(d)];d--)c--;this.text=this.text.substring(a,c),this.sectionIndex=this.sectionIndex.slice(a,c)}substring(a,c){const d=new Gv;return d.text=this.text.substring(a,c),d.sectionIndex=this.sectionIndex.slice(a,c),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((a,c)=>Math.max(a,this.sections[c].scale),0)}addTextSection(a,c){this.text+=a.text,this.sections.push(Ib.forText(a.scale,a.fontStack||c));const d=this.sections.length-1;for(let g=0;g<a.text.length;++g)this.sectionIndex.push(d)}addImageSection(a,c){const d=a.image?a.image.getPrimary():null;if(!d)return void ti("Can't add FormattedSection with an empty image.");d.scaleSelf(c);const g=this.getNextImageSectionCharCode();g?(this.text+=String.fromCodePoint(g),this.sections.push(Ib.forImage(d)),this.sectionIndex.push(this.sections.length-1)):ti("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function c3(h,a,c,d,g,m,v,E,P,L,A,O,N,D,k,U=1){const X=Gv.fromFeature(h,g,U);O===Vh.vertical&&X.verticalizePunctuation(N);let Q=[];const le=function(Me,We,$e,He,ht,Ke){if(!Me)return[];const pt=[],Et=function(jt,Dt,Vt,_n,gn,Zn){let Cn=0;for(let Ln=0;Ln<jt.length();Ln++){const bn=jt.getSection(Ln);Cn+=_N(jt.getCodePoint(Ln),bn,_n,gn,Dt,Zn)}return Cn/Math.max(1,Math.ceil(Cn/Vt))}(Me,We,$e,He,ht,Ke),wt=Me.text.indexOf("​")>=0;let Ot=0;for(let jt=0;jt<Me.length();jt++){const Dt=Me.getSection(jt),Vt=Me.getCodePoint(jt);if(aS[Vt]||(Ot+=_N(Vt,Dt,He,ht,We,Ke)),jt<Me.length()-1){const _n=!((It=Vt)<11904||!(_t["Bopomofo Extended"](It)||_t.Bopomofo(It)||_t["CJK Compatibility Forms"](It)||_t["CJK Compatibility Ideographs"](It)||_t["CJK Compatibility"](It)||_t["CJK Radicals Supplement"](It)||_t["CJK Strokes"](It)||_t["CJK Symbols and Punctuation"](It)||_t["CJK Unified Ideographs Extension A"](It)||_t["CJK Unified Ideographs"](It)||_t["Enclosed CJK Letters and Months"](It)||_t["Halfwidth and Fullwidth Forms"](It)||_t.Hiragana(It)||_t["Ideographic Description Characters"](It)||_t["Kangxi Radicals"](It)||_t["Katakana Phonetic Extensions"](It)||_t.Katakana(It)||_t["Vertical Forms"](It)||_t["Yi Radicals"](It)||_t["Yi Syllables"](It)));(kJ[Vt]||_n||Dt.image)&&pt.push(bN(jt+1,Ot,Et,pt,NJ(Vt,Me.getCodePoint(jt+1),_n&&wt),!1))}}var It;return xN(bN(Me.length(),Ot,Et,pt,0,!0))}(X,L,m,a,d,D),{processBidirectionalText:oe,processStyledBidirectionalText:re}=is;if(oe&&X.sections.length===1){const Me=oe(X.toString(),le);for(const We of Me){const $e=new Gv;$e.text=We,$e.sections=X.sections;for(let He=0;He<We.length;He++)$e.sectionIndex.push(0);Q.push($e)}}else if(re){const Me=re(X.text,X.sectionIndex,le);for(const We of Me){const $e=new Gv;$e.text=We[0],$e.sectionIndex=We[1],$e.sections=X.sections,Q.push($e)}}else Q=function(Me,We){const $e=[],He=Me.text;let ht=0;for(const Ke of We)$e.push(Me.substring(ht,Ke)),ht=Ke;return ht<He.length&&$e.push(Me.substring(ht,He.length)),$e}(X,le);const me=[],Se={positionedLines:me,text:X.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:O,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Me,We,$e,He,ht,Ke,pt,Et,wt,Ot,It,jt){let Dt=0,Vt=0,_n=0;const gn=Et==="right"?1:Et==="left"?0:.5;let Zn=!1;for(const lr of ht){const Lr=lr.getSections();for(const Qr of Lr){if(Qr.image)continue;const Fr=We[Qr.fontStack];if(Fr&&(Zn=Fr.ascender!==void 0&&Fr.descender!==void 0,!Zn))break}if(!Zn)break}let Cn=0;for(const lr of ht){lr.trim();const Lr=lr.getMaxScale(),Qr=(Lr-1)*Ne,Fr={positionedGlyphs:[],lineOffset:0};Me.positionedLines[Cn]=Fr;const ui=Fr.positionedGlyphs;let Jr=0;if(!lr.length()){Vt+=Ke,++Cn;continue}let xi=0,Gi=0;for(let zr=0;zr<lr.length();zr++){const Ii=lr.getSection(zr),Ya=lr.getSectionIndex(zr),ss=lr.getCodePoint(zr);let ms=Ii.scale,Is=null,Sa=null,sl=null,Au=Ne,yo=0;wt===Vh.vertical&&((Ln=ss)===12312||Ln===12313||Ln===12316||Ln===12540||Ln===12448)&&(wt=Vh.horizontal);const Eo=!(wt===Vh.horizontal||!It&&!Gn(ss)||It&&(aS[ss]||pr(ss)));if(Ii.image){const Pc=He.get(Ii.image.toString());if(!Pc)continue;sl=Ii.image,Me.iconsInText=Me.iconsInText||!0,Sa=Pc.paddedRect;const Ll=Pc.displaySize;ms=ms*Ne/jt,Is={width:Ll[0],height:Ll[1],left:0,top:-3,advance:Eo?Ll[1]:Ll[0],localGlyph:!1},yo=Zn?-Is.height*ms:Lr*Ne-17-Ll[1]*ms,Au=Is.advance;const Yf=(Eo?Ll[0]:Ll[1])*ms-Ne*Lr;Yf>0&&Yf>Jr&&(Jr=Yf)}else{const Pc=$e[Ii.fontStack];if(!Pc)continue;Pc[ss]&&(Sa=Pc[ss]);const Ll=We[Ii.fontStack];if(!Ll)continue;const Yf=Ll.glyphs[ss];if(!Yf)continue;if(Is=Yf.metrics,Au=ss!==8203?Ne:0,Zn){const ny=Ll.ascender!==void 0?Math.abs(Ll.ascender):0,Dd=Ll.descender!==void 0?Math.abs(Ll.descender):0,mp=(ny+Dd)*ms;xi<mp&&(xi=mp,Gi=(ny-Dd)/2*ms),yo=-ny*ms}else yo=(Lr-ms)*Ne-17}Eo?(Me.verticalizable=!0,ui.push({glyph:ss,image:sl,x:Dt,y:Vt+yo,vertical:Eo,scale:ms,localGlyph:Is.localGlyph,fontStack:Ii.fontStack,sectionIndex:Ya,metrics:Is,rect:Sa}),Dt+=Au*ms+Ot):(ui.push({glyph:ss,image:sl,x:Dt,y:Vt+yo,vertical:Eo,scale:ms,localGlyph:Is.localGlyph,fontStack:Ii.fontStack,sectionIndex:Ya,metrics:Is,rect:Sa}),Dt+=Is.advance*ms+Ot)}ui.length!==0&&(_n=Math.max(Dt-Ot,_n),Zn?wN(ui,gn,Jr,Gi,Ke*Lr/2):wN(ui,gn,Jr,0,Ke/2)),Dt=0;const Ca=Ke*Lr+Jr;Fr.lineOffset=Math.max(Jr,Qr),Vt+=Ca,++Cn}var Ln;const bn=Vt,{horizontalAlign:_r,verticalAlign:Kn}=u3(pt);(function(lr,Lr,Qr,Fr,ui,Jr){const xi=(Lr-Qr)*ui,Gi=-Jr*Fr;for(const Ca of lr)for(const zr of Ca.positionedGlyphs)zr.x+=xi,zr.y+=Gi})(Me.positionedLines,gn,_r,Kn,_n,bn),Me.top+=-Kn*bn,Me.bottom=Me.top+bn,Me.left+=-_r*_n,Me.right=Me.left+_n,Me.hasBaseline=Zn}(Se,a,c,d,Q,v,E,P,O,L,N,k),!function(Me){for(const We of Me)if(We.positionedGlyphs.length!==0)return!1;return!0}(me))return Se}const aS={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},kJ={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function _N(h,a,c,d,g,m){if(a.image){const v=d.get(a.image.toString());return v?v.displaySize[0]*a.scale*Ne/m+g:0}{const v=c[a.fontStack],E=v&&v.glyphs[h];return E?E.metrics.advance*a.scale+g:0}}function vN(h,a,c,d){const g=Math.pow(h-a,2);return d?h<a?g/2:2*g:g+Math.abs(c)*c}function NJ(h,a,c){let d=0;return h===10&&(d-=1e4),c&&(d+=150),h!==40&&h!==65288||(d+=50),a!==41&&a!==65289||(d+=50),d}function bN(h,a,c,d,g,m){let v=null,E=vN(a,c,g,m);for(const P of d){const L=vN(a-P.x,c,g,m)+P.badness;L<=E&&(v=P,E=L)}return{index:h,x:a,priorBreak:v,badness:E}}function xN(h){return h?xN(h.priorBreak).concat(h.index):[]}function u3(h){let a=.5,c=.5;switch(h){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(h){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:a,verticalAlign:c}}function wN(h,a,c,d,g){if(!(a||c||d||g))return;const m=h.length-1,v=h[m],E=(v.x+v.metrics.advance*v.scale)*a;for(let P=0;P<=m;P++)h[P].x-=E,h[P].y+=c+d+g}function zJ(h,a,c,d){const{horizontalAlign:g,verticalAlign:m}=u3(d),v=c[0]-h.displaySize[0]*g,E=c[1]-h.displaySize[1]*m;return{imagePrimary:h,imageSecondary:a,top:E,bottom:E+h.displaySize[1],left:v,right:v+h.displaySize[0]}}function SN(h,a,c,d,g,m){const v=h.imagePrimary;let E;if(v.content){const X=v.content,Q=v.pixelRatio||1;E=[X[0]/Q,X[1]/Q,v.displaySize[0]-X[2]/Q,v.displaySize[1]-X[3]/Q]}const P=a.left*m,L=a.right*m;let A,O,N,D;c==="width"||c==="both"?(D=g[0]+P-d[3],O=g[0]+L+d[1]):(D=g[0]+(P+L-v.displaySize[0])/2,O=D+v.displaySize[0]);const k=a.top*m,U=a.bottom*m;return c==="height"||c==="both"?(A=g[1]+k-d[0],N=g[1]+U+d[2]):(A=g[1]+(k+U-v.displaySize[1])/2,N=A+v.displaySize[1]),{imagePrimary:v,imageSecondary:void 0,top:A,right:O,bottom:N,left:D,collisionPadding:E}}class Xm extends Ut{constructor(a,c,d,g,m){super(a,c),this.angle=g,this.z=d,m!==void 0&&(this.segment=m)}clone(){return new Xm(this.x,this.y,this.z,this.angle,this.segment)}}function AN(h,a,c,d,g){if(a.segment===void 0)return!0;let m=a,v=a.segment+1,E=0;for(;E>-c/2;){if(v--,v<0)return!1;E-=h[v].dist(m),m=h[v]}E+=h[v].dist(h[v+1]),v++;const P=[];let L=0;for(;E<c/2;){const A=h[v],O=h[v+1];if(!O)return!1;let N=h[v-1].angleTo(A)-A.angleTo(O);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:E,angleDelta:N}),L+=N;E-P[0].distance>d;)L-=P.shift().angleDelta;if(L>g)return!1;v++,E+=A.dist(O)}return!0}function TN(h){let a=0;for(let c=0;c<h.length-1;c++)a+=h[c].dist(h[c+1]);return a}function EN(h,a,c){return h?.6*a*c:0}function MN(h,a){return Math.max(h?h.right-h.left:0,a?a.right-a.left:0)}function BJ(h,a,c,d,g,m){const v=EN(c,g,m),E=MN(c,d)*m;let P=0;const L=TN(h)/2;for(let A=0;A<h.length-1;A++){const O=h[A],N=h[A+1],D=O.dist(N);if(P+D>L){const k=(L-P)/D,U=dr(O.x,N.x,k),X=dr(O.y,N.y,k),Q=new Xm(U,X,0,N.angleTo(O),A);return!v||AN(h,Q,E,v,a)?Q:void 0}P+=D}}function jJ(h,a,c,d,g,m,v,E,P){const L=EN(d,m,v),A=MN(d,g),O=A*v,N=h[0].x===0||h[0].x===P||h[0].y===0||h[0].y===P;return a-O<a/4&&(a=O+a/4),CN(h,N?a/2*E%a:(A/2+2*m)*v*E%a,a,L,c,O,N,!1,P)}function CN(h,a,c,d,g,m,v,E,P){const L=m/2,A=TN(h);let O=0,N=a-c,D=[];for(let k=0;k<h.length-1;k++){const U=h[k],X=h[k+1],Q=U.dist(X),le=X.angleTo(U);for(;N+c<O+Q;){N+=c;const oe=(N-O)/Q,re=dr(U.x,X.x,oe),me=dr(U.y,X.y,oe);if(re>=0&&re<P&&me>=0&&me<P&&N-L>=0&&N+L<=A){const Se=new Xm(re,me,0,le,k);d&&!AN(h,Se,m,d,g)||D.push(Se)}}O+=Q}return E||D.length||v||(D=CN(h,O/2,c,d,g,m,v,!0,P)),D}function IN(h,a,c,d,g){const m=[];for(let v=0;v<h.length;v++){const E=h[v];let P;for(let L=0;L<E.length-1;L++){let A=E[L],O=E[L+1];A.x<a&&O.x<a||(A.x<a?A=new Ut(a,A.y+(a-A.x)/(O.x-A.x)*(O.y-A.y))._round():O.x<a&&(O=new Ut(a,A.y+(a-A.x)/(O.x-A.x)*(O.y-A.y))._round()),A.y<c&&O.y<c||(A.y<c?A=new Ut(A.x+(c-A.y)/(O.y-A.y)*(O.x-A.x),c)._round():O.y<c&&(O=new Ut(A.x+(c-A.y)/(O.y-A.y)*(O.x-A.x),c)._round()),A.x>=d&&O.x>=d||(A.x>=d?A=new Ut(d,A.y+(d-A.x)/(O.x-A.x)*(O.y-A.y))._round():O.x>=d&&(O=new Ut(d,A.y+(d-A.x)/(O.x-A.x)*(O.y-A.y))._round()),A.y>=g&&O.y>=g||(A.y>=g?A=new Ut(A.x+(g-A.y)/(O.y-A.y)*(O.x-A.x),g)._round():O.y>=g&&(O=new Ut(A.x+(g-A.y)/(O.y-A.y)*(O.x-A.x),g)._round()),P&&A.equals(P[P.length-1])||(P=[A],m.push(P)),P.push(O)))))}}return m}function PN(h){let a=0,c=0;for(const v of h)a+=v.w*v.h,c=Math.max(c,v.w);h.sort((v,E)=>E.h-v.h);const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),c),h:1/0}];let g=0,m=0;for(const v of h)for(let E=d.length-1;E>=0;E--){const P=d[E];if(!(v.w>P.w||v.h>P.h)){if(v.x=P.x,v.y=P.y,m=Math.max(m,v.y+v.h),g=Math.max(g,v.x+v.w),v.w===P.w&&v.h===P.h){const L=d.pop();E<d.length&&(d[E]=L)}else v.h===P.h?(P.x+=v.w,P.w-=v.w):v.w===P.w?(P.y+=v.h,P.h-=v.h):(d.push({x:P.x+v.w,y:P.y,w:P.w-v.w,h:v.h}),P.y+=v.h,P.h-=v.h);break}}return{w:g,h:m,fill:a/(g*m)||0}}Mt(Xm,"Anchor");const Wv=1;class Pb{static getImagePositionScale(a,c,d){if(c&&a&&a.options&&a.options.transform){const g=a.options.transform;return{x:g.a,y:g.d}}return{x:d,y:d}}constructor(a,c,d,g){this.paddedRect=a;const{pixelRatio:m,version:v,stretchX:E,stretchY:P,content:L,sdf:A,usvg:O}=c;this.pixelRatio=m,this.stretchX=E,this.stretchY=P,this.content=L,this.version=v,this.padding=d,this.sdf=A,this.scale=Pb.getImagePositionScale(g,O,m)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function ON(h,a,c){const d=Fc.parse(h),g=function(m,v,E=[1,1]){return{x:0,y:0,w:(m.data?m.data.width:m.width*E[0])+2*v,h:(m.data?m.data.height:m.height*E[1])+2*v}}(a,c,[d.options.transform.a,d.options.transform.d]);return{bin:g,imagePosition:new Pb(g,a,c,d),imageVariant:d}}class RN{constructor(a,c,d){const g=new Map,m=new Map;this.haveRenderCallbacks=[];const v=[];this.addImages(a,g,Wv,v),this.addImages(c,m,2,v);const{w:E,h:P}=PN(v),L=new _l({width:E||1,height:P||1});for(const[A,O]of a.entries()){const N=g.get(A).paddedRect;_l.copy(O.data,L,{x:0,y:0},{x:N.x+Wv,y:N.y+Wv},O.data,d,O.sdf)}for(const[A,O]of c.entries()){const N=m.get(A),D=N.paddedRect;let k=N.padding;const U=D.x+k,X=D.y+k,Q=O.data.width,le=O.data.height;k=k>1?k-1:k,_l.copy(O.data,L,{x:0,y:0},{x:U,y:X},O.data,d),_l.copy(O.data,L,{x:0,y:le-k},{x:U,y:X-k},{width:Q,height:k},d),_l.copy(O.data,L,{x:0,y:0},{x:U,y:X+le},{width:Q,height:k},d),_l.copy(O.data,L,{x:Q-k,y:0},{x:U-k,y:X},{width:k,height:le},d),_l.copy(O.data,L,{x:0,y:0},{x:U+Q,y:X},{width:k,height:le},d),_l.copy(O.data,L,{x:Q-k,y:le-k},{x:U-k,y:X-k},{width:k,height:k},d),_l.copy(O.data,L,{x:0,y:le-k},{x:U+Q,y:X-k},{width:k,height:k},d),_l.copy(O.data,L,{x:0,y:0},{x:U+Q,y:X+le},{width:k,height:k},d),_l.copy(O.data,L,{x:Q-k,y:0},{x:U-k,y:X+le},{width:k,height:k},d)}this.lut=d,this.image=L,this.iconPositions=g,this.patternPositions=m}addImages(a,c,d,g){for(const[m,v]of a.entries()){const{bin:E,imagePosition:P,imageVariant:L}=ON(m,v,d);c.set(m,P),g.push(E),v.hasRenderCallback&&this.haveRenderCallbacks.push(L.id)}}patchUpdatedImages(a,c,d){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(g=>a.hasImage(g,d)),a.dispatchRenderCallbacks(this.haveRenderCallbacks,d);for(const g of a.getUpdatedImages(d)){for(const m of this.iconPositions.keys()){const v=Fc.parse(m);if(No.isEqual(v.id,g)){const E=a.getImage(g,d);this.patchUpdatedImage(this.iconPositions.get(m),E,c)}}for(const m of this.patternPositions.keys()){const v=Fc.parse(m);if(No.isEqual(v.id,g)){const E=a.getImage(g,d);this.patchUpdatedImage(this.patternPositions.get(m),E,c)}}}}patchUpdatedImage(a,c,d){if(!a||!c||a.version===c.version)return;a.version=c.version;const[g,m]=a.tl,v=a.sdf;if(this.lut||v){const E={width:c.data.width,height:c.data.height},P=new _l(E);_l.copy(c.data,P,{x:0,y:0},{x:0,y:0},E,this.lut,v),d.update(P,{position:{x:g,y:m}})}else d.update(c.data,{position:{x:g,y:m}})}}Mt(Pb,"ImagePosition"),Mt(RN,"ImageAtlas");const sS=1e20;function DN(h,a,c,d,g,m,v,E,P){for(let L=a;L<a+d;L++)LN(h,c*m+L,m,g,v,E,P);for(let L=c;L<c+g;L++)LN(h,L*m+a,1,d,v,E,P)}function LN(h,a,c,d,g,m,v){m[0]=0,v[0]=-1e20,v[1]=sS,g[0]=h[a];for(let E=1,P=0,L=0;E<d;E++){g[E]=h[a+E*c];const A=E*E;do{const O=m[P];L=(g[E]-g[O]+A-O*O)/(E-O)/2}while(L<=v[P]&&--P>-1);P++,m[P]=E,v[P]=L,v[P+1]=sS}for(let E=0,P=0;E<d;E++){for(;v[P+1]<E;)P++;const L=m[P],A=E-L;h[a+E*c]=g[L]+A*A}}const hp=2,h3={none:0,ideographs:1,all:2};class Kv{constructor(a,c,d){this.requestManager=a,this.localGlyphMode=c,this.localFontFamily=d,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(a,c){this.urls[c]=a}getGlyphs(a,c,d){const g=[],m=this.urls[c]||Ee.GLYPHS_URL;for(const v in a)for(const E of a[v])g.push({stack:v,id:E});Li(g,({stack:v,id:E},P)=>{let L=this.entries[v];L||(L=this.entries[v]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let A=L.glyphs[E];if(A!==void 0)return void P(null,{stack:v,id:E,glyph:A});if(A=this._tinySDF(L,v,E),A)return L.glyphs[E]=A,void P(null,{stack:v,id:E,glyph:A});const O=Math.floor(E/256);if(256*O>65535)return ti("glyphs > 65535 not supported"),void P(null,{stack:v,id:E,glyph:A});if(L.ranges[O])return void P(null,{stack:v,id:E,glyph:A});let N=L.requests[O];N||(N=L.requests[O]=[],Kv.loadGlyphRange(v,O,m,this.requestManager,(D,k)=>{if(k){L.ascender=k.ascender,L.descender=k.descender;for(const U in k.glyphs)this._doesCharSupportLocalGlyph(+U)||(L.glyphs[+U]=k.glyphs[+U]);L.ranges[O]=!0}for(const U of N)U(D,k);delete L.requests[O]})),N.push((D,k)=>{D?P(D):k&&P(null,{stack:v,id:E,glyph:k.glyphs[E]||null})})},(v,E)=>{if(v)d(v);else if(E){const P={};for(const{stack:L,id:A,glyph:O}of E)P[L]===void 0&&(P[L]={}),P[L].glyphs===void 0&&(P[L].glyphs={}),P[L].glyphs[A]=O&&{id:O.id,bitmap:O.bitmap.clone(),metrics:O.metrics},P[L].ascender=this.entries[L].ascender,P[L].descender=this.entries[L].descender;d(null,P)}})}_doesCharSupportLocalGlyph(a){return this.localGlyphMode!==h3.none&&(this.localGlyphMode===h3.all?!!this.localFontFamily:!!this.localFontFamily&&(_t["CJK Unified Ideographs"](a)||_t["Hangul Syllables"](a)||_t.Hiragana(a)||_t.Katakana(a)||_t["CJK Symbols and Punctuation"](a)||_t["CJK Unified Ideographs Extension A"](a)||_t["CJK Unified Ideographs Extension B"](a)||_t.Osage(a)))}_tinySDF(a,c,d){const g=this.localFontFamily;if(!g||!this._doesCharSupportLocalGlyph(d))return;let m=a.tinySDF;if(!m){let U="400";/bold/i.test(c)?U="900":/medium/i.test(c)?U="500":/light/i.test(c)&&(U="200"),m=a.tinySDF=new Kv.TinySDF({fontFamily:g,fontWeight:U,fontSize:24*hp,buffer:3*hp,radius:8*hp}),m.fontWeight=U}if(this.localGlyphs[m.fontWeight][d])return this.localGlyphs[m.fontWeight][d];const v=String.fromCodePoint(d),{data:E,width:P,height:L,glyphWidth:A,glyphHeight:O,glyphLeft:N,glyphTop:D,glyphAdvance:k}=m.draw(v);return this.localGlyphs[m.fontWeight][d]={id:d,bitmap:new Xp({width:P,height:L},E),metrics:{width:A/hp,height:O/hp,left:N/hp,top:D/hp-27,advance:k/hp,localGlyph:!0}}}}Kv.loadGlyphRange=function(h,a,c,d,g){const m=256*a,v=m+255,E=d.transformRequest(d.normalizeGlyphsURL(c).replace("{fontstack}",h).replace("{range}",`${m}-${v}`),bs.Glyphs);Oa(E,(P,L)=>{if(P)g(P);else if(L){const A={},O=function(N){return new oi(N).readFields(tc,{})}(L);for(const N of O.glyphs)A[N.id]=N;g(null,{glyphs:A,ascender:O.ascender,descender:O.descender})}})},Kv.TinySDF=class{constructor({fontSize:h=24,buffer:a=3,radius:c=8,cutoff:d=.25,fontFamily:g="sans-serif",fontWeight:m="normal",fontStyle:v="normal"}={}){this.buffer=a,this.cutoff=d,this.radius=c;const E=this.size=h+4*a,P=this._createCanvas(E),L=this.ctx=P.getContext("2d",{willReadFrequently:!0});L.font=`${v} ${m} ${h}px ${g}`,L.textBaseline="alphabetic",L.textAlign="left",L.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(h){const a=document.createElement("canvas");return a.width=a.height=h,a}draw(h){const{width:a,actualBoundingBoxAscent:c,actualBoundingBoxDescent:d,actualBoundingBoxLeft:g,actualBoundingBoxRight:m}=this.ctx.measureText(h),v=Math.ceil(c),E=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-g))),P=Math.min(this.size-this.buffer,v+Math.ceil(d)),L=E+2*this.buffer,A=P+2*this.buffer,O=Math.max(L*A,0),N=new Uint8ClampedArray(O),D={data:N,width:L,height:A,glyphWidth:E,glyphHeight:P,glyphTop:v,glyphLeft:0,glyphAdvance:a};if(E===0||P===0)return D;const{ctx:k,buffer:U,gridInner:X,gridOuter:Q}=this;k.clearRect(U,U,E,P),k.fillText(h,U,U+v);const le=k.getImageData(U,U,E,P);Q.fill(sS,0,O),X.fill(0,0,O);for(let oe=0;oe<P;oe++)for(let re=0;re<E;re++){const me=le.data[4*(oe*E+re)+3]/255;if(me===0)continue;const Se=(oe+U)*L+re+U;if(me===1)Q[Se]=0,X[Se]=sS;else{const Me=.5-me;Q[Se]=Me>0?Me*Me:0,X[Se]=Me<0?Me*Me:0}}DN(Q,0,0,L,A,L,this.f,this.v,this.z),DN(X,U,U,E,P,L,this.f,this.v,this.z);for(let oe=0;oe<O;oe++){const re=Math.sqrt(Q[oe])-Math.sqrt(X[oe]);N[oe]=Math.round(255-255*(re/this.radius+this.cutoff))}return D}};const y_=Wv;function kN(h,a){return h+a[1]-a[0]}function NN(h,a,c,d,g=1){const m=[],v=h.imagePrimary,E=v.pixelRatio,P=v.paddedRect.w-2*y_,L=v.paddedRect.h-2*y_,A=(h.right-h.left)*g,O=(h.bottom-h.top)*g,N=v.stretchX||[[0,P]],D=v.stretchY||[[0,L]],k=N.reduce(kN,0),U=D.reduce(kN,0),X=P-k,Q=L-U;let le=0,oe=k,re=0,me=U,Se=0,Me=X,We=0,$e=Q;if(v.content&&d){const ht=v.content;le=oS(N,0,ht[0]),re=oS(D,0,ht[1]),oe=oS(N,ht[0],ht[2]),me=oS(D,ht[1],ht[3]),Se=ht[0]-le,We=ht[1]-re,Me=ht[2]-ht[0]-oe,$e=ht[3]-ht[1]-me}const He=(ht,Ke,pt,Et)=>{const wt=lS(ht.stretch-le,oe,A,h.left*g),Ot=cS(ht.fixed-Se,Me,ht.stretch,k),It=lS(Ke.stretch-re,me,O,h.top*g),jt=cS(Ke.fixed-We,$e,Ke.stretch,U),Dt=lS(pt.stretch-le,oe,A,h.left*g),Vt=cS(pt.fixed-Se,Me,pt.stretch,k),_n=lS(Et.stretch-re,me,O,h.top*g),gn=cS(Et.fixed-We,$e,Et.stretch,U),Zn=new Ut(wt,It),Cn=new Ut(Dt,It),Ln=new Ut(Dt,_n),bn=new Ut(wt,_n),_r=new Ut(Ot/E,jt/E),Kn=new Ut(Vt/E,gn/E),lr=a*Math.PI/180;if(lr){const xi=Math.sin(lr),Gi=Math.cos(lr),Ca=[Gi,-xi,xi,Gi];Zn._matMult(Ca),Cn._matMult(Ca),bn._matMult(Ca),Ln._matMult(Ca)}const Lr=ht.stretch+ht.fixed,Qr=pt.stretch+pt.fixed,Fr=Ke.stretch+Ke.fixed,ui=Et.stretch+Et.fixed,Jr=h.imageSecondary;return{tl:Zn,tr:Cn,bl:bn,br:Ln,texPrimary:{x:v.paddedRect.x+y_+Lr,y:v.paddedRect.y+y_+Fr,w:Qr-Lr,h:ui-Fr},texSecondary:Jr?{x:Jr.paddedRect.x+y_+Lr,y:Jr.paddedRect.y+y_+Fr,w:Qr-Lr,h:ui-Fr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:_r,pixelOffsetBR:Kn,minFontScaleX:Me/E/A,minFontScaleY:$e/E/O,isSDF:c}};if(d&&(v.stretchX||v.stretchY)){const ht=zN(N,X,k),Ke=zN(D,Q,U);for(let pt=0;pt<ht.length-1;pt++){const Et=ht[pt],wt=ht[pt+1];for(let Ot=0;Ot<Ke.length-1;Ot++)m.push(He(Et,Ke[Ot],wt,Ke[Ot+1]))}}else m.push(He({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:P+1},{fixed:0,stretch:L+1}));return m}function oS(h,a,c){let d=0;for(const g of h)d+=Math.max(a,Math.min(c,g[1]))-Math.max(a,Math.min(c,g[0]));return d}function zN(h,a,c){const d=[{fixed:-1,stretch:0}];for(const[g,m]of h){const v=d[d.length-1];d.push({fixed:g-v.stretch,stretch:v.stretch}),d.push({fixed:g-v.stretch,stretch:v.stretch+(m-g)})}return d.push({fixed:a+y_,stretch:c}),d}function lS(h,a,c,d){return h/a*c+d}function cS(h,a,c,d){return h-a*c/d}function FJ(h,a,c,d){const g=a+h.positionedLines[d].lineOffset;return d===0?c+g/2:c+(g+(a+h.positionedLines[d-1].lineOffset))/2}function UJ(h,a=1,c=!1){let d=1/0,g=1/0,m=-1/0,v=-1/0;const E=h[0];for(let D=0;D<E.length;D++){const k=E[D];(!D||k.x<d)&&(d=k.x),(!D||k.y<g)&&(g=k.y),(!D||k.x>m)&&(m=k.x),(!D||k.y>v)&&(v=k.y)}const P=Math.min(m-d,v-g);let L=P/2;const A=new uu([],qJ);if(P===0)return new Ut(d,g);for(let D=d;D<m;D+=P)for(let k=g;k<v;k+=P)A.push(new Yv(D+L,k+L,L,h));let O=function(D){let k=0,U=0,X=0;const Q=D[0];for(let le=0,oe=Q.length,re=oe-1;le<oe;re=le++){const me=Q[le],Se=Q[re],Me=me.x*Se.y-Se.x*me.y;U+=(me.x+Se.x)*Me,X+=(me.y+Se.y)*Me,k+=3*Me}return new Yv(U/k,X/k,0,D)}(h),N=A.length;for(;A.length;){const D=A.pop();(D.d>O.d||!O.d)&&(O=D,c&&console.log("found best %d after %d probes",Math.round(1e4*D.d)/1e4,N)),D.max-O.d<=a||(L=D.h/2,A.push(new Yv(D.p.x-L,D.p.y-L,L,h)),A.push(new Yv(D.p.x+L,D.p.y-L,L,h)),A.push(new Yv(D.p.x-L,D.p.y+L,L,h)),A.push(new Yv(D.p.x+L,D.p.y+L,L,h)),N+=4)}return c&&(console.log(`num probes: ${N}`),console.log(`best distance: ${O.d}`)),O.p}function qJ(h,a){return a.max-h.max}class Yv{constructor(a,c,d,g){this.p=new Ut(a,c),this.h=d,this.d=function(m,v){let E=!1,P=1/0;for(let L=0;L<v.length;L++){const A=v[L];for(let O=0,N=A.length,D=N-1;O<N;D=O++){const k=A[O],U=A[D];k.y>m.y!=U.y>m.y&&m.x<(U.x-k.x)*(m.y-k.y)/(U.y-k.y)+k.x&&(E=!E),P=Math.min(P,lt(m,k,U))}}return(E?1:-1)*Math.sqrt(P)}(this.p,g),this.max=this.d+this.h*Math.SQRT2}}const f3=Number.POSITIVE_INFINITY,VJ=Math.sqrt(2);function BN(h,[a,c]){let d=0,g=0;if(c===f3){a<0&&(a=0);const m=a/VJ;switch(h){case"top-right":case"top-left":g=m-7;break;case"bottom-right":case"bottom-left":g=7-m;break;case"bottom":g=7-a;break;case"top":g=a-7}switch(h){case"top-right":case"bottom-right":d=-m;break;case"top-left":case"bottom-left":d=m;break;case"left":d=a;break;case"right":d=-a}}else{switch(a=Math.abs(a),c=Math.abs(c),h){case"top-right":case"top-left":case"top":g=c-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-c}switch(h){case"top-right":case"bottom-right":case"right":d=-a;break;case"top-left":case"bottom-left":case"left":d=a}}return[d,g]}function jN(h,a,c,d,g,m,v,E){if(!h)return;const P=Bt(a,c,d,g,m);return h.scaleSelf(P*E*v)}function FN(h,a,c,d,g,m,v,E){return{iconPrimary:jN(h.getPrimary(),a,c,d,g,m,v,E),iconSecondary:jN(h.getSecondary(),a,c,d,g,m,v,E)}}function UN(h,a,c,d){if(!h)return;const g=a.get(c.toString());if(h.imagePrimary=g,d){const m=a.get(d.toString());h.imageSecondary=m}}function $J(h,a){for(const c in h.horizontal)qN(h.horizontal[c],a);qN(h.vertical,a)}function qN(h,a){if(h){for(const c of h.positionedLines)for(const d of c.positionedGlyphs)if(d.image!==null){const g=d.image.toString();d.rect=a.get(g).paddedRect}}}function d3(h){switch(h){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function HJ(h,a,c,d,g,m,v,E,P){const L=p3(m.horizontal)||m.vertical,A=c.get("icon-text-fit-padding").evaluate(d,{},g);let O,N=a;return a&&P!=="none"&&(h.allowVerticalPlacement&&m.vertical&&(O=SN(a,m.vertical,P,A,E,v)),L&&(N=SN(a,L,P,A,E,v))),{defaultShapedIcon:N,verticallyShapedIcon:O}}function GJ(h,a,c,d,g,m,v,E,P,L,A,O,N,D,k,U,X,Q,le,oe){let re=v.textMaxSize.evaluate(a,{},N);re===void 0?re=E*v.textScaleFactor:re*=v.textScaleFactor;const me=h.layers[0].layout,Se=p3(c.horizontal)||c.vertical,Me=D.name==="globe",We=Ne,$e=h.tilePixelRatio*re/We,He=(Ot=h.overscaling,h.zoom>18&&Ot>2&&(Ot>>=1),Math.max(On/(512*Ot),1)*me.get("symbol-spacing")),ht=me.get("text-padding")*h.tilePixelRatio,Ke=me.get("icon-padding")*h.tilePixelRatio,pt=Rn(me.get("text-max-angle")),Et=me.get("icon-rotation-alignment")==="map"&&oe!=="point",wt=He/2;var Ot;h.hasAnyIconTextFit===!1&&X!=="none"&&(h.hasAnyIconTextFit=!0);const It=a.properties?+a.properties[Cd]:null,jt=It&&h.elevationFeatureIdToIndex?h.elevationFeatureIdToIndex.get(It):65535,Dt=(Vt,_n,gn)=>{if(_n.x<0||_n.x>=On||_n.y<0||_n.y>=On)return;let Zn=null;if(Me){const{x:Cn,y:Ln,z:bn}=D.projectTilePoint(_n.x,_n.y,gn);Zn={anchor:new Xm(Cn,Ln,bn,0,void 0),up:D.upVector(gn,_n.x,_n.y)}}(function(Cn,Ln,bn,_r,Kn,lr,Lr,Qr,Fr,ui,Jr,xi,Gi,Ca,zr,Ii,Ya,ss,ms,Is,Sa,sl,Au,yo,Eo,Pc,Ll,Yf,ny){const Dd=Cn.addToLineVertexArray(Ln,_r);let mp,ry,iy,w_,A6,T6,E6,M6=0,C6=0,I6=0,P6=0,W3=-1,K3=-1;const om={};let O6=so("");const S_=bn?bn.anchor:Ln,Y3=Yf!=="none";let X3=0,Z3=0;if(Fr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[X3,Z3]=Fr.layout.get("text-offset").evaluate(Sa,{},Eo).map(Xf=>Xf*Ne):(X3=Fr.layout.get("text-radial-offset").evaluate(Sa,{},Eo)*Ne,Z3=f3),Cn.allowVerticalPlacement&&Kn.vertical){const Xf=Kn.vertical;if(zr)T6=m3(Xf),Qr&&(E6=m3(Qr));else{const $h=Fr.layout.get("text-rotate").evaluate(Sa,{},Eo)+90;iy=uS(ui,S_,Ln,Jr,xi,Gi,Xf,Ca,$h,Ii),Qr&&(w_=uS(ui,S_,Ln,Jr,xi,Gi,Qr,ss,$h))}}if(lr){const Xf=Cn.iconSizeData,$h=Fr.layout.get("icon-rotate").evaluate(Sa,{},Eo),Yb=NN(lr,$h,Au,Y3,sl.iconScaleFactor),Q3=Qr?NN(Qr,$h,Au,Y3,sl.iconScaleFactor):void 0;ry=uS(ui,S_,Ln,Jr,xi,Gi,lr,ss,$h,null),M6=4*Yb.length;let A_=null;Xf.kind==="source"?(A_=[ot*Fr.layout.get("icon-size").evaluate(Sa,{},Eo)*sl.iconScaleFactor],A_[0]>Jg&&ti(`${Cn.layerIds[0]}: Value for "icon-size" is >= ${Ob}. Reduce your "icon-size".`)):Xf.kind==="composite"&&(A_=[ot*sl.compositeIconSizes[0].evaluate(Sa,{},Eo)*sl.iconScaleFactor,ot*sl.compositeIconSizes[1].evaluate(Sa,{},Eo)*sl.iconScaleFactor],(A_[0]>Jg||A_[1]>Jg)&&ti(`${Cn.layerIds[0]}: Value for "icon-size" is >= ${Ob}. Reduce your "icon-size".`)),Cn.addSymbols(Cn.icon,Yb,A_,Is,ms,Sa,!1,bn,Ln,Dd.lineStartIndex,Dd.lineLength,-1,yo,Eo,Pc,Ll),W3=Cn.icon.placedSymbolArray.length-1,Q3&&(C6=4*Q3.length,Cn.addSymbols(Cn.icon,Q3,A_,Is,ms,Sa,Vh.vertical,bn,Ln,Dd.lineStartIndex,Dd.lineLength,-1,yo,Eo,Pc,Ll),K3=Cn.icon.placedSymbolArray.length-1)}for(const Xf in Kn.horizontal){const $h=Kn.horizontal[Xf];mp||(O6=so($h.text),zr?A6=m3($h):mp=uS(ui,S_,Ln,Jr,xi,Gi,$h,Ca,Fr.layout.get("text-rotate").evaluate(Sa,{},Eo),Ii));const Yb=$h.positionedLines.length===1;if(I6+=VN(Cn,bn,Ln,$h,Lr,Fr,zr,Sa,Ii,Dd,Kn.vertical?Vh.horizontal:Vh.horizontalOnly,Yb?Object.keys(Kn.horizontal):[Xf],om,W3,sl,yo,Eo,Pc),Yb)break}Kn.vertical&&(P6+=VN(Cn,bn,Ln,Kn.vertical,Lr,Fr,zr,Sa,Ii,Dd,Vh.vertical,["vertical"],om,K3,sl,yo,Eo,Pc));let ay=-1;const J3=(Xf,$h)=>Xf?Math.max(Xf,$h):$h;ay=J3(A6,ay),ay=J3(T6,ay),ay=J3(E6,ay);const Aee=ay>-1?1:0;Cn.glyphOffsetArray.length>=65535&&ti("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Sa.sortKey!==void 0&&Cn.addToSortKeyRanges(Cn.symbolInstances.length,Sa.sortKey),Cn.symbolInstances.emplaceBack(Ln.x,Ln.y,S_.x,S_.y,S_.z,om.right>=0?om.right:-1,om.center>=0?om.center:-1,om.left>=0?om.left:-1,om.vertical>=0?om.vertical:-1,W3,K3,O6,mp!==void 0?mp:Cn.collisionBoxArray.length,mp!==void 0?mp+1:Cn.collisionBoxArray.length,iy!==void 0?iy:Cn.collisionBoxArray.length,iy!==void 0?iy+1:Cn.collisionBoxArray.length,ry!==void 0?ry:Cn.collisionBoxArray.length,ry!==void 0?ry+1:Cn.collisionBoxArray.length,w_||Cn.collisionBoxArray.length,w_?w_+1:Cn.collisionBoxArray.length,Jr,I6,P6,M6,C6,Aee,0,X3,Z3,ay,0,Y3?1:0,ny)})(h,_n,Zn,Vt,c,d,m,g,h.layers[0],h.collisionBoxArray,a.index,a.sourceLayerIndex,h.index,ht,le,L,0,Ke,Et,Q,a,v,A,O,N,k,U,X,jt)};if(oe==="line")for(const Vt of IN(a.geometry,0,0,On,On)){const _n=jJ(Vt,He,pt,c.vertical||Se,d,We,$e,h.overscaling,On);for(const gn of _n)Se&&WJ(h,Se.text,wt,gn)||Dt(Vt,gn,N)}else if(oe==="line-center"){for(const Vt of a.geometry)if(Vt.length>1){const _n=BJ(Vt,pt,c.vertical||Se,d,We,$e);_n&&Dt(Vt,_n,N)}}else if(a.type==="Polygon")for(const Vt of r_(a.geometry,0)){const _n=UJ(Vt,16);Dt(Vt[0],new Xm(_n.x,_n.y,0,0,void 0),N)}else if(a.type==="LineString")for(const Vt of a.geometry)Dt(Vt,new Xm(Vt[0].x,Vt[0].y,0,0,void 0),N);else if(a.type==="Point")for(const Vt of a.geometry)for(const _n of Vt)Dt([_n],new Xm(_n.x,_n.y,0,0,void 0),N)}const Ob=255,Jg=Ob*ot;function VN(h,a,c,d,g,m,v,E,P,L,A,O,N,D,k,U,X,Q){const le=function(me,Se,Me,We,$e,He,ht,Ke){const pt=[];if(Se.positionedLines.length===0)return pt;const Et=We.layout.get("text-rotate").evaluate(He,{})*Math.PI/180,wt=function(Vt){const _n=Vt[0],gn=Vt[1],Zn=_n*gn;return Zn>0?[_n,-gn]:Zn<0?[-_n,gn]:_n===0?[gn,_n]:[gn,-_n]}(Me);let Ot=Math.abs(Se.top-Se.bottom);for(const Vt of Se.positionedLines)Ot-=Vt.lineOffset;const It=Se.positionedLines.length,jt=Ot/It;let Dt=Se.top-Me[1];for(let Vt=0;Vt<It;++Vt){const _n=Se.positionedLines[Vt];Dt=FJ(Se,jt,Dt,Vt);for(const gn of _n.positionedGlyphs){if(!gn.rect)continue;const Zn=gn.rect||{};let Cn=l3+1,Ln=!0,bn=1,_r=0;if(gn.image){const Sa=ht.get(gn.image.toString());if(!Sa)continue;if(Sa.sdf){ti("SDF images are not supported in formatted text and will be ignored.");continue}Ln=!1,bn=Sa.pixelRatio,Cn=Wv/bn}const Kn=($e||Ke)&&gn.vertical,lr=gn.metrics.advance*gn.scale/2,Lr=gn.metrics,Qr=gn.rect;if(Qr===null)continue;Ke&&Se.verticalizable&&(_r=gn.image?lr-gn.metrics.width*gn.scale/2:0);const Fr=$e?[gn.x+lr,gn.y]:[0,0];let ui=[0,0],Jr=[0,0],xi=!1;$e||(Kn?(Jr=[gn.x+lr+wt[0],gn.y+wt[1]-_r],xi=!0):ui=[gn.x+lr+Me[0],gn.y+Me[1]-_r]);const Gi=Qr.w*gn.scale/(bn*(gn.localGlyph?hp:1)),Ca=Qr.h*gn.scale/(bn*(gn.localGlyph?hp:1));let zr,Ii,Ya,ss;if(Kn){const Sa=gn.y-Dt,sl=new Ut(-lr,lr-Sa),Au=-Math.PI/2,yo=new Ut(...Jr);zr=new Ut(-lr+ui[0],ui[1]),zr._rotateAround(Au,sl)._add(yo),zr.x+=-Sa+lr,zr.y-=(Lr.left-Cn)*gn.scale;const Eo=gn.image?Lr.advance*gn.scale:Ne*gn.scale,Pc=String.fromCodePoint(gn.glyph);Zi(Pc)?zr.x+=(1-Cn)*gn.scale:$o(Pc)?zr.x+=Eo-Lr.height*gn.scale+(-Cn-1)*gn.scale:zr.x+=gn.image||Lr.width+2*Cn===Qr.w&&Lr.height+2*Cn===Qr.h?(Eo-Ca)/2:(Eo-(Lr.height+2*Cn)*gn.scale)/2,Ii=new Ut(zr.x,zr.y-Gi),Ya=new Ut(zr.x+Ca,zr.y),ss=new Ut(zr.x+Ca,zr.y-Gi)}else{const Sa=(Lr.left-Cn)*gn.scale-lr+ui[0],sl=(-Lr.top-Cn)*gn.scale+ui[1],Au=Sa+Gi,yo=sl+Ca;zr=new Ut(Sa,sl),Ii=new Ut(Au,sl),Ya=new Ut(Sa,yo),ss=new Ut(Au,yo)}if(Et){let Sa;Sa=$e?new Ut(0,0):xi?new Ut(wt[0],wt[1]):new Ut(Me[0],Me[1]),zr._rotateAround(Et,Sa),Ii._rotateAround(Et,Sa),Ya._rotateAround(Et,Sa),ss._rotateAround(Et,Sa)}const ms=new Ut(0,0),Is=new Ut(0,0);pt.push({tl:zr,tr:Ii,bl:Ya,br:ss,texPrimary:Zn,texSecondary:void 0,writingMode:Se.writingMode,glyphOffset:Fr,sectionIndex:gn.sectionIndex,isSDF:Ln,pixelOffsetTL:ms,pixelOffsetBR:Is,minFontScaleX:0,minFontScaleY:0})}}return pt}(0,d,P,m,v,E,g,h.allowVerticalPlacement),oe=h.textSizeData;let re=null;oe.kind==="source"?(re=[ot*m.layout.get("text-size").evaluate(E,{},X)*k.textScaleFactor],re[0]>Jg&&ti(`${h.layerIds[0]}: Value for "text-size" is >= ${Ob}. Reduce your "text-size".`)):oe.kind==="composite"&&(re=[ot*k.compositeTextSizes[0].evaluate(E,{},X)*k.textScaleFactor,ot*k.compositeTextSizes[1].evaluate(E,{},X)*k.textScaleFactor],(re[0]>Jg||re[1]>Jg)&&ti(`${h.layerIds[0]}: Value for "text-size" is >= ${Ob}. Reduce your "text-size".`)),h.addSymbols(h.text,le,re,P,v,E,A,a,c,L.lineStartIndex,L.lineLength,D,U,X,Q,!1);for(const me of O)N[me]=h.text.placedSymbolArray.length-1;return 4*le.length}function p3(h){for(const a in h)return h[a];return null}function uS(h,a,c,d,g,m,v,E,P,L){let A=v.top,O=v.bottom,N=v.left,D=v.right;const k=v.collisionPadding;if(k&&(N-=k[0],A-=k[1],D+=k[2],O+=k[3]),P){const U=new Ut(N,A),X=new Ut(D,A),Q=new Ut(N,O),le=new Ut(D,O),oe=Rn(P);let re=new Ut(0,0);L&&(re=new Ut(L[0],L[1])),U._rotateAround(oe,re),X._rotateAround(oe,re),Q._rotateAround(oe,re),le._rotateAround(oe,re),N=Math.min(U.x,X.x,Q.x,le.x),D=Math.max(U.x,X.x,Q.x,le.x),A=Math.min(U.y,X.y,Q.y,le.y),O=Math.max(U.y,X.y,Q.y,le.y)}return h.emplaceBack(a.x,a.y,a.z,c.x,c.y,N,A,D,O,E,d,g,m),h.length-1}function m3(h){h.collisionPadding&&(h.top-=h.collisionPadding[1],h.bottom+=h.collisionPadding[3]);const a=h.bottom-h.top;return a>0?Math.max(10,a):null}function WJ(h,a,c,d){const g=h.compareText;if(a in g){const m=g[a];for(let v=m.length-1;v>=0;v--)if(d.dist(m[v])<c)return!0}else g[a]=[];return g[a].push(d),!1}function $N(h,a){const c=h.fovAboveCenter,d=h.elevation?h.elevation.getMinElevationBelowMSL()*a:0,g=(h._camera.position[2]*h.worldSize-d)/Math.cos(h._pitch),m=Math.sin(c)*g/Math.sin(Math.max(Math.PI/2-h._pitch-c,.01));let v=Math.sin(h._pitch)*m+g;const E=g*(1/h._horizonShift);if(!h.elevation||h.elevation.exaggeration()===0){let P=Math.max(h.zoom-17,0);h.isOrthographic&&(P/=10),v*=1+P}return Math.min(1.01*v,E)}function Rb(h,a){if(!a.isReprojectedInTileSpace)return{scale:1<<h.z,x:h.x,y:h.y,x2:h.x+1,y2:h.y+1,projection:a};const c=Math.pow(2,-h.z),d=h.x*c,g=(h.x+1)*c,m=h.y*c,v=(h.y+1)*c,E=Mc(d),P=Mc(g),L=xa(m),A=xa(v),O=a.project(E,L),N=a.project(P,L),D=a.project(P,A),k=a.project(E,A);let U=Math.min(O.x,N.x,D.x,k.x),X=Math.min(O.y,N.y,D.y,k.y),Q=Math.max(O.x,N.x,D.x,k.x),le=Math.max(O.y,N.y,D.y,k.y);const oe=c/16;function re(Se,Me,We,$e,He,ht){const Ke=(We+He)/2,pt=($e+ht)/2,Et=a.project(Mc(Ke),xa(pt)),wt=Math.max(0,U-Et.x,X-Et.y,Et.x-Q,Et.y-le);U=Math.min(U,Et.x),Q=Math.max(Q,Et.x),X=Math.min(X,Et.y),le=Math.max(le,Et.y),wt>oe&&(re(Se,Et,We,$e,Ke,pt),re(Et,Me,Ke,pt,He,ht))}re(O,N,d,m,g,m),re(N,D,g,m,g,v),re(D,k,g,v,d,v),re(k,O,d,v,d,m),U-=oe,X-=oe,Q+=oe,le+=oe;const me=1/Math.max(Q-U,le-X);return{scale:me,x:U*me,y:X*me,x2:Q*me,y2:le*me,projection:a}}function HN(h,{x:a,y:c},d=0){return new Ut(((a-d)*h.scale-h.x)*On,(c*h.scale-h.y)*On)}const KJ=_e.mat4.identity(new Float32Array(16));class Qg{constructor(a){this.spec=a,this.name=a.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(a,c){return{x:0,y:0,z:0}}unproject(a,c){return new zi(0,0)}projectTilePoint(a,c,d){return{x:a,y:c,z:0}}locationPoint(a,c,d,g=!0){return a._coordinatePoint(a.locationCoordinate(c,d),g)}pixelsPerMeter(a,c){return Uo(1,a)*c}pixelSpaceConversion(a,c,d){return 1}farthestPixelDistance(a){return $N(a,a.pixelsPerMeter)}pointCoordinate(a,c,d,g){const m=a.horizonLineFromTop(!1),v=new Ut(c,Math.max(m,d));return a.rayIntersectionCoordinate(a.pointRayIntersection(v,g))}pointCoordinate3D(a,c,d){const g=new Ut(c,d);if(a.elevation)return a.elevation.pointCoordinate(g);{const m=this.pointCoordinate(a,g.x,g.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(a,c){if(a.elevation&&a.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(a,c.x,c.y);const d=a.horizonLineFromTop();return c.y<d}createInversionMatrix(a,c){return KJ}createTileMatrix(a,c,d){let g,m,v;const E=d.canonical,P=_e.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const L=Rb(E,this);g=1,m=L.x+d.wrap*L.scale,v=L.y,_e.mat4.scale(P,P,[g/L.scale,g/L.scale,a.pixelsPerMeter/c])}else g=c/a.zoomScale(E.z),m=(E.x+Math.pow(2,E.z)*d.wrap)*g,v=E.y*g;return _e.mat4.translate(P,P,[m,v,0]),_e.mat4.scale(P,P,[g/On,g/On,1]),P}upVector(a,c,d){return[0,0,1]}upVectorScale(a,c,d){return{metersToTile:1}}}class YJ extends Qg{constructor(a){super(a),this.range=[4,7],this.center=a.center||[-96,37.5];const[c,d]=this.parallels=a.parallels||[29.5,45.5],g=Math.sin(Rn(c));this.n=(g+Math.sin(Rn(d)))/2,this.c=1+g*(2*this.n-g),this.r0=Math.sqrt(this.c)/this.n}project(a,c){const{n:d,c:g,r0:m}=this,v=Rn(a-this.center[0]),E=Rn(c),P=Math.sqrt(g-2*d*Math.sin(E))/d;return{x:P*Math.sin(v*d),y:P*Math.cos(v*d)-m,z:0}}unproject(a,c){const{n:d,c:g,r0:m}=this,v=m+c;let E=Math.atan2(a,Math.abs(v))*Math.sign(v);v*d<0&&(E-=Math.PI*Math.sign(a)*Math.sign(v));const P=Rn(this.center[0])*d;E=pi(E,-Math.PI-P,Math.PI-P);const L=Un(Dn(E/d)+this.center[0],-180,180),A=Math.asin(Un((g-(a*a+v*v)*d*d)/(2*d),-1,1)),O=Un(Dn(A),-85.051129,Cc);return new zi(L,O)}}const Db=1.340264,Lb=-.081106,kb=893e-6,Nb=.003796,hS=Math.sqrt(3)/2;class XJ extends Qg{project(a,c){c=c/180*Math.PI,a=a/180*Math.PI;const d=Math.asin(hS*Math.sin(c)),g=d*d,m=g*g*g;return{x:.5*(a*Math.cos(d)/(hS*(Db+3*Lb*g+m*(7*kb+9*Nb*g)))/Math.PI+.5),y:1-.5*(d*(Db+Lb*g+m*(kb+Nb*g))/Math.PI+1),z:0}}unproject(a,c){a=(2*a-.5)*Math.PI;let d=c=(2*(1-c)-1)*Math.PI,g=d*d,m=g*g*g;for(let A,O,N,D=0;D<12&&(O=d*(Db+Lb*g+m*(kb+Nb*g))-c,N=Db+3*Lb*g+m*(7*kb+9*Nb*g),A=O/N,d=Un(d-A,-Math.PI/3,Math.PI/3),g=d*d,m=g*g*g,!(Math.abs(A)<1e-12));++D);const v=hS*a*(Db+3*Lb*g+m*(7*kb+9*Nb*g))/Math.cos(d),E=Math.asin(Math.sin(d)/hS),P=Un(180*v/Math.PI,-180,180),L=Un(180*E/Math.PI,-85.051129,Cc);return new zi(P,L)}}class ZJ extends Qg{constructor(a){super(a),this.wrap=!0,this.supportsWorldCopies=!0}project(a,c){return{x:.5+a/360,y:.5-c/360,z:0}}unproject(a,c){const d=360*(a-.5),g=Un(360*(.5-c),-85.051129,Cc);return new zi(d,g)}}const Xv=Math.PI/2;function fS(h){return Math.tan((Xv+h)/2)}class JJ extends Qg{constructor(a){super(a),this.center=a.center||[0,30];const[c,d]=this.parallels=a.parallels||[30,30];let g=Rn(c),m=Rn(d);this.southernCenter=g+m<0,this.southernCenter&&(g=-g,m=-m);const v=Math.cos(g),E=fS(g);this.n=g===m?Math.sin(g):Math.log(v/Math.cos(m))/Math.log(fS(m)/E),this.f=v*Math.pow(fS(g),this.n)/this.n}project(a,c){c=Rn(c),this.southernCenter&&(c=-c),a=Rn(a-this.center[0]);const d=1e-6,{n:g,f:m}=this;m>0?c<-Xv+d&&(c=-Xv+d):c>Xv-d&&(c=Xv-d);const v=m/Math.pow(fS(c),g);let E=v*Math.sin(g*a),P=m-v*Math.cos(g*a);return E=.5*(E/Math.PI+.5),P=.5*(P/Math.PI+.5),{x:E,y:this.southernCenter?P:1-P,z:0}}unproject(a,c){a=(2*a-.5)*Math.PI,this.southernCenter&&(c=1-c),c=(2*(1-c)-.5)*Math.PI;const{n:d,f:g}=this,m=g-c,v=Math.sign(m),E=Math.sign(d)*Math.sqrt(a*a+m*m);let P=Math.atan2(a,Math.abs(m))*v;m*d<0&&(P-=Math.PI*Math.sign(a)*v);const L=Un(Dn(P/d)+this.center[0],-180,180),A=Un(Dn(2*Math.atan(Math.pow(g/E,1/d))-Xv),-85.051129,Cc);return new zi(L,this.southernCenter?-A:A)}}class GN extends Qg{constructor(a){super(a),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(a,c){return{x:gl(a),y:Ma(c),z:0}}unproject(a,c){const d=Mc(a),g=xa(c);return new zi(d,g)}}const WN=Rn(Cc);class QJ extends Qg{project(a,c){const d=(c=Rn(c))*c,g=d*d;return{x:.5*((a=Rn(a))*(.8707-.131979*d+g*(g*(.003971*d-.001529*g)-.013791))/Math.PI+.5),y:1-.5*(c*(1.007226+d*(.015085+g*(.028874*d-.044475-.005916*g)))/Math.PI+1),z:0}}unproject(a,c){a=(2*a-.5)*Math.PI;let d=c=(2*(1-c)-1)*Math.PI,g=25,m=0,v=d*d;do{v=d*d;const L=v*v;m=(d*(1.007226+v*(.015085+L*(.028874*v-.044475-.005916*L)))-c)/(1.007226+v*(.045255+L*(.259866*v-.311325-.005916*11*L))),d=Un(d-m,-WN,WN)}while(Math.abs(m)>1e-6&&--g>0);v=d*d;const E=Un(Dn(a/(.8707+v*(v*(v*v*v*(.003971-.001529*v)-.013791)-.131979))),-180,180),P=Dn(d);return new zi(E,P)}}const KN=Rn(Cc);class eQ extends Qg{project(a,c){c=Rn(c),a=Rn(a);const d=Math.cos(c),g=2/Math.PI,m=Math.acos(d*Math.cos(a/2)),v=Math.sin(m)/m,E=.5*(a*g+2*d*Math.sin(a/2)/v)||0,P=.5*(c+Math.sin(c)/v)||0;return{x:.5*(E/Math.PI+.5),y:1-.5*(P/Math.PI+1),z:0}}unproject(a,c){let d=a=(2*a-.5)*Math.PI,g=c=(2*(1-c)-1)*Math.PI,m=25;const v=1e-6;let E=0,P=0;do{const L=Math.cos(g),A=Math.sin(g),O=2*A*L,N=A*A,D=L*L,k=Math.cos(d/2),U=Math.sin(d/2),X=2*k*U,Q=U*U,le=1-D*k*k,oe=le?1/le:0,re=le?Math.acos(L*k)*Math.sqrt(1/le):0,me=.5*(2*re*L*U+2*d/Math.PI)-a,Se=.5*(re*A+g)-c,Me=.5*oe*(D*Q+re*L*k*N)+1/Math.PI,We=oe*(X*O/4-re*A*U),$e=.125*oe*(O*U-re*A*D*X),He=.5*oe*(N*k+re*Q*L)+.5,ht=We*$e-He*Me;E=(Se*We-me*He)/ht,P=(me*$e-Se*Me)/ht,d=Un(d-E,-Math.PI,Math.PI),g=Un(g-P,-KN,KN)}while((Math.abs(E)>v||Math.abs(P)>v)&&--m>0);return new zi(Dn(d),Dn(g))}}class YN extends Qg{constructor(a){super(a),this.center=a.center||[0,0],this.parallels=a.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Rn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(a,c){const{scale:d,cosPhi:g}=this;return{x:Rn(a)*g*d+.5,y:-Math.sin(Rn(c))/g*d+.5,z:0}}unproject(a,c){const{scale:d,cosPhi:g}=this,m=-(c-.5)/d,v=Un(Dn((a-.5)/d)/g,-180,180),E=Math.asin(Un(m*g,-1,1)),P=Un(Dn(E),-85.051129,Cc);return new zi(v,P)}}class tQ extends GN{constructor(a){super(a),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(a,c,d){const g=Di(a,c,d),m=wa(us(d));return _e.vec3.transformMat4(g,g,m),{x:g[0],y:g[1],z:g[2]}}locationPoint(a,c,d){const g=wu(c.lat,c.lng),m=_e.vec3.normalize([],g),v=d?a._centerAltitude+d:a.elevation?a.elevation.getAtPointOrZero(a.locationCoordinate(c),a._centerAltitude):a._centerAltitude,E=Uo(1,0)*On*v;_e.vec3.scaleAndAdd(g,g,m,E);const P=_e.mat4.identity(new Float64Array(16));return _e.mat4.multiply(P,a.pixelMatrix,a.globeMatrix),_e.vec3.transformMat4(g,g,P),new Ut(g[0],g[1])}pixelsPerMeter(a,c){return Uo(1,0)*c}pixelSpaceConversion(a,c,d){const g=Uo(1,a)*c,m=dr(Uo(1,45)*c,g,d);return this.pixelsPerMeter(a,c)/m}createTileMatrix(a,c,d){const g=as(us(d.canonical));return _e.mat4.multiply(new Float64Array(16),a.globeMatrix,g)}createInversionMatrix(a,c){const{center:d}=a,g=wa(us(c));return _e.mat4.rotateY(g,g,Rn(d.lng)),_e.mat4.rotateX(g,g,Rn(d.lat)),_e.mat4.scale(g,g,[a._pixelsPerMercatorPixel,a._pixelsPerMercatorPixel,1]),Float32Array.from(g)}pointCoordinate(a,c,d,g){return ci(a,c,d,!0)||new o(0,0)}pointCoordinate3D(a,c,d){const g=this.pointCoordinate(a,c,d,0);return[g.x,g.y,g.z]}isPointAboveHorizon(a,c){return!ci(a,c.x,c.y,!1)}farthestPixelDistance(a){const c=function(g,m){const v=g.cameraToCenterDistance,E=g._centerAltitude*m,P=g._camera,L=g._camera.forward(),A=_e.vec3.add([],_e.vec3.scale([],L,-v),[0,0,E]),O=g.worldSize/(2*Math.PI),N=[0,0,-O],D=g.width/g.height,k=Math.tan(g.fovAboveCenter),U=_e.vec3.scale([],P.up(),k),X=_e.vec3.scale([],P.right(),k*D),Q=_e.vec3.normalize([],_e.vec3.add([],_e.vec3.add([],L,U),X)),le=[];let oe;if(new Er(A,Q).closestPointOnSphere(N,O,le)){const re=_e.vec3.add([],le,N),me=_e.vec3.sub([],re,A);oe=Math.cos(g.fovAboveCenter)*_e.vec3.length(me)}else{const re=_e.vec3.sub([],A,N),me=_e.vec3.sub([],N,A);_e.vec3.normalize(me,me);const Se=_e.vec3.length(re)-O;oe=Math.sqrt(Se*(Se+2*O));const Me=Math.acos(oe/(O+Se))-Math.acos(_e.vec3.dot(L,me));oe*=Math.cos(Me)}return 1.01*oe}(a,this.pixelsPerMeter(a.center.lat,a.worldSize)),d=Rl(a.zoom);if(d>0){const g=$N(a,Uo(1,a.center.lat)*a.worldSize),m=a.worldSize/(2*Math.PI),v=Math.max(a.width,a.height)/a.worldSize*Math.PI;return dr(c,g+m*(1-Math.cos(v)),Math.pow(d,10))}return c}upVector(a,c,d){return Di(c,d,a,1)}upVectorScale(a){return{metersToTile:si(sa(us(a)))}}}function XN(h){const a=h.parallels,c=!!a&&Math.abs(a[0]+a[1])<.01;switch(h.name){case"mercator":return new GN(h);case"equirectangular":return new ZJ(h);case"naturalEarth":return new QJ(h);case"equalEarth":return new XJ(h);case"winkelTripel":return new eQ(h);case"albers":return c?new YN(h):new YJ(h);case"lambertConformalConic":return c?new YN(h):new JJ(h);case"globe":return new tQ(h)}throw new Error(`Invalid projection name: ${h.name}`)}const nQ=bf.VectorTileFeature.types,rQ=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function dS(h,a,c,d,g,m,v,E,P,L,A,O,N){const D=E?Math.min(Jg,Math.round(E[0])):0,k=E?Math.min(Jg,Math.round(E[1])):0;h.emplaceBack(a,c,Math.round(32*d),Math.round(32*g),m,v,(D<<1)+(P?1:0),k,16*L,16*A,256*O,256*N)}function pS(h,a,c){h.emplaceBack(a,c)}function mS(h,a,c,d,g,m,v){h.emplaceBack(a,c,d,g,m,v)}function gS(h,a,c,d,g){h.emplaceBack(a,c,d,g),h.emplaceBack(a,c,d,g),h.emplaceBack(a,c,d,g),h.emplaceBack(a,c,d,g)}function iQ(h){for(const a of h.sections)if(va(a.text))return!0;return!1}class g3{constructor(a){this.layoutVertexArray=new ff,this.indexArray=new Ms,this.programConfigurations=a,this.segments=new Da,this.dynamicLayoutVertexArray=new Xu,this.opacityVertexArray=new Zd,this.placedSymbolArray=new dl,this.iconTransitioningVertexArray=new Nh,this.globeExtVertexArray=new Yu,this.zOffsetVertexArray=new Ku}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(a,c,d,g,m){this.isEmpty()||(d&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,iS.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,Hv.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,rQ,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=a.createVertexBuffer(this.iconTransitioningVertexArray,b.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=a.createVertexBuffer(this.globeExtVertexArray,o3.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||m)&&(this.zOffsetVertexBuffer=a.createVertexBuffer(this.zOffsetVertexArray,p.members,!0)),this.opacityVertexBuffer.itemSize=1),(d||g)&&this.programConfigurations.upload(a))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Mt(g3,"SymbolBuffers");class y3{constructor(a,c,d){this.layoutVertexArray=new a,this.layoutAttributes=c,this.indexArray=new d,this.segments=new Da,this.collisionVertexArray=new vu,this.collisionVertexArrayExt=new Xu}upload(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,M.members,!0),this.collisionVertexBufferExt=a.createVertexBuffer(this.collisionVertexArrayExt,B.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Mt(y3,"CollisionBuffers");class yS{constructor(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.lut=a.lut,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(v=>v.fqid),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=_e.mat4.identity([]),this.placementViewportMatrix=_e.mat4.identity([]);const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ln(this.zoom,c["text-size"]),this.iconSizeData=ln(this.zoom,c["icon-size"]);const d=this.layers[0].layout,g=d.get("symbol-sort-key"),m=d.get("symbol-z-order");this.canOverlap=d.get("text-allow-overlap")||d.get("icon-allow-overlap")||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&g.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=d.get("text-writing-mode").map(v=>Vh[v]),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=a.sourceID,this.projection=a.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new g3(new gf(this.layers,{zoom:this.zoom,lut:this.lut},a=>a.startsWith("text")||a.startsWith("symbol"))),this.icon=new g3(new gf(this.layers,{zoom:this.zoom,lut:this.lut},a=>a.startsWith("icon")||a.startsWith("symbol"))),this.glyphOffsetArray=new Vy,this.lineVertexArray=new $p,this.symbolInstances=new qy}calculateGlyphDependencies(a,c,d,g,m){for(const v of a){const E=v.codePointAt(0);if(E===void 0)break;if(c[E]=!0,g&&m&&E<=65535){const P=Zr[v];P&&(c[P.charCodeAt(0)]=!0)}}}updateFootprints(a,c){}updateReplacement(a,c){if(c.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=c.updateTime;const d=c.getReplacementRegionsForTile(a.toUnwrapped(),!0);return!jv(this.activeReplacements,d)&&(this.activeReplacements=d,!0)}populate(a,c,d,g){const m=this.layers[0],v=m.layout,E=this.projection.name==="globe",P=v.get("text-font"),L=v.get("text-field"),A=v.get("icon-image"),[O,N]=v.get("icon-size-scale-range"),D=Un(c.scaleFactor||1,O,N),k=(L.value.kind!=="constant"||L.value.value instanceof os&&!L.value.value.isEmpty()||L.value.value.toString().length>0)&&(P.value.kind!=="constant"||P.value.value.length>0),U=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,X=v.get("symbol-sort-key");if(this.features=[],!k&&!U)return;const Q=c.iconDependencies,le=c.glyphDependencies,oe=c.availableImages,re=new bi(this.zoom);for(const{feature:me,id:Se,index:Me,sourceLayerIndex:We}of a){const $e=m._featureFilter.needGeometry,He=K(me,$e);if(!m._featureFilter.filter(re,He,d))continue;if($e||(He.geometry=$(me,d,g)),E&&me.type!==1&&d.z<=5){const wt=He.geometry,Ot=.98078528056,It=(jt,Dt)=>{const Vt=Di(jt.x,jt.y,d,1),_n=Di(Dt.x,Dt.y,d,1);return _e.vec3.dot(Vt,_n)<Ot};for(let jt=0;jt<wt.length;jt++)wt[jt]=T(wt[jt],It)}let ht,Ke;if(k){const wt=m.getValueAndResolveTokens("text-field",He,d,oe),Ot=os.factory(wt);iQ(Ot)&&(this.hasRTLText=!0),(!this.hasRTLText||fo()==="unavailable"||this.hasRTLText&&is.isParsed())&&(ht=Hn(Ot,m,He))}if(U){const wt=m.getValueAndResolveTokens("icon-image",He,d,oe);Ke=wt instanceof ws?wt:ws.build(wt)}if(!ht&&!Ke)continue;const pt=this.sortFeaturesByKey?X.evaluate(He,{},d):void 0,Et={id:Se,text:ht,icon:Ke,index:Me,sourceLayerIndex:We,geometry:He.geometry,properties:me.properties,type:nQ[me.type],sortKey:pt};if(this.features.push(Et),Ke){const wt=this.layers[0]._unevaluatedLayout._values,{iconPrimary:Ot,iconSecondary:It}=FN(Ke,this.iconSizeData,wt["icon-size"],d,this.zoom,Et,this.pixelRatio,D),jt=Ot.id.toString();if(Q.has(jt)?Q.get(jt).push(Ot):Q.set(jt,[Ot]),It){const Dt=It.id.toString();Q.has(Dt)?Q.get(Dt).push(It):Q.set(Dt,[It])}}if(ht){const wt=P.evaluate(He,{},d).join(","),Ot=v.get("text-rotation-alignment")==="map"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Vh.vertical)>=0;for(const It of ht.sections)if(It.image){const jt=It.image.getPrimary().scaleSelf(this.pixelRatio),Dt=jt.id.toString(),Vt=Q.get(Dt)||[];Vt.push(jt),Q.set(Dt,Vt)}else{const jt=en(ht.toString()),Dt=It.fontStack||wt,Vt=le[Dt]=le[Dt]||{};this.calculateGlyphDependencies(It.text,Vt,Ot,this.allowVerticalPlacement,jt)}}}if(v.get("symbol-placement")==="line"&&(this.features=function(me){const Se={},Me={},We=[];let $e=0;function He(Et){We.push(me[Et]),$e++}function ht(Et,wt,Ot){const It=Me[Et];return delete Me[Et],Me[wt]=It,We[It].geometry[0].pop(),We[It].geometry[0]=We[It].geometry[0].concat(Ot[0]),It}function Ke(Et,wt,Ot){const It=Se[wt];return delete Se[wt],Se[Et]=It,We[It].geometry[0].shift(),We[It].geometry[0]=Ot[0].concat(We[It].geometry[0]),It}function pt(Et,wt,Ot){const It=Ot?wt[0][wt[0].length-1]:wt[0][0];return`${Et}:${It.x}:${It.y}`}for(let Et=0;Et<me.length;Et++){const wt=me[Et],Ot=wt.geometry,It=wt.text?wt.text.toString():null;if(!It){He(Et);continue}const jt=pt(It,Ot),Dt=pt(It,Ot,!0);if(jt in Me&&Dt in Se&&Me[jt]!==Se[Dt]){const Vt=Ke(jt,Dt,Ot),_n=ht(jt,Dt,We[Vt].geometry);delete Se[jt],delete Me[Dt],Me[pt(It,We[_n].geometry,!0)]=_n,We[Vt].geometry=null}else jt in Me?ht(jt,Dt,Ot):Dt in Se?Ke(jt,Dt,Ot):(He(Et),Se[jt]=$e-1,Me[Dt]=$e-1)}return We.filter(Et=>Et.geometry)}(this.features)),v.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",c.elevationFeatures){!this.elevationFeatures&&c.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const me of c.elevationFeatures)this.elevationFeatureIdToIndex.set(me.id,this.elevationFeatures.length),this.elevationFeatures.push(me)}}else v.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((me,Se)=>me.sortKey-Se.sortKey)}update(a,c,d,g,m,v,E){this.text.programConfigurations.updatePaintArrays(a,c,m,d,g,v,E),this.icon.programConfigurations.updatePaintArrays(a,c,m,d,g,v,E)}updateRoadElevation(){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let a=!1;for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c);if(d.elevationFeatureIndex===65535)continue;const g=this.elevationFeatures[d.elevationFeatureIndex];if(g){const m=.05+g.pointElevation(new Ut(d.tileAnchorX,d.tileAnchorY));d.zOffset!==m&&(a=!0,d.zOffset=m)}}a&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const a=(m,v,E)=>{d+=v,d>m.length&&m.resize(d);for(let P=-v;P<0;P++)m.emplace(P+d,E)},c=(m,v,E)=>{g+=v,g>m.length&&m.resize(g);for(let P=-v;P<0;P++)m.emplace(P+g,E)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let d=0,g=0;for(let m=0;m<this.symbolInstances.length;m++){const v=this.symbolInstances.get(m),{numHorizontalGlyphVertices:E,numVerticalGlyphVertices:P,numIconVertices:L}=v,A=v.zOffset,O=L>0;if((E>0||P>0)&&(a(this.text.zOffsetVertexArray,E,A),a(this.text.zOffsetVertexArray,P,A)),O){const{placedIconSymbolIndex:N,verticalPlacedIconSymbolIndex:D}=v;N>=0&&c(this.icon.zOffsetVertexArray,L,A),D>=0&&c(this.icon.zOffsetVertexArray,v.numVerticalIconVertices,A)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=XN(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(a,c){const d=this.lineVertexArray.length;if(a.segment!==void 0)for(const{x:g,y:m}of c)this.lineVertexArray.emplaceBack(g,m);return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(a,c,d,g,m,v,E,P,L,A,O,N,D,k,U,X){const Q=a.indexArray,le=a.layoutVertexArray,oe=a.globeExtVertexArray,re=a.segments.prepareSegment(4*c.length,le,Q,this.canOverlap?v.sortKey:void 0),me=this.glyphOffsetArray.length,Se=re.vertexLength,Me=this.allowVerticalPlacement&&E===Vh.vertical?Math.PI/2:0,We=v.text&&v.text.sections;for(let He=0;He<c.length;He++){const{tl:ht,tr:Ke,bl:pt,br:Et,texPrimary:wt,texSecondary:Ot,pixelOffsetTL:It,pixelOffsetBR:jt,minFontScaleX:Dt,minFontScaleY:Vt,glyphOffset:_n,isSDF:gn,sectionIndex:Zn}=c[He],Cn=re.vertexLength,Ln=_n[1];if(dS(le,L.x,L.y,ht.x,Ln+ht.y,wt.x,wt.y,d,gn,It.x,It.y,Dt,Vt),dS(le,L.x,L.y,Ke.x,Ln+Ke.y,wt.x+wt.w,wt.y,d,gn,jt.x,It.y,Dt,Vt),dS(le,L.x,L.y,pt.x,Ln+pt.y,wt.x,wt.y+wt.h,d,gn,It.x,jt.y,Dt,Vt),dS(le,L.x,L.y,Et.x,Ln+Et.y,wt.x+wt.w,wt.y+wt.h,d,gn,jt.x,jt.y,Dt,Vt),P){const{x:bn,y:_r,z:Kn}=P.anchor,[lr,Lr,Qr]=P.up;mS(oe,bn,_r,Kn,lr,Lr,Qr),mS(oe,bn,_r,Kn,lr,Lr,Qr),mS(oe,bn,_r,Kn,lr,Lr,Qr),mS(oe,bn,_r,Kn,lr,Lr,Qr),gS(a.dynamicLayoutVertexArray,bn,_r,Kn,Me)}else gS(a.dynamicLayoutVertexArray,L.x,L.y,L.z,Me);if(X){const bn=Ot||wt;pS(a.iconTransitioningVertexArray,bn.x,bn.y),pS(a.iconTransitioningVertexArray,bn.x+bn.w,bn.y),pS(a.iconTransitioningVertexArray,bn.x,bn.y+bn.h),pS(a.iconTransitioningVertexArray,bn.x+bn.w,bn.y+bn.h)}Q.emplaceBack(Cn,Cn+1,Cn+2),Q.emplaceBack(Cn+1,Cn+2,Cn+3),re.vertexLength+=4,re.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(_n[0]),He!==c.length-1&&Zn===c[He+1].sectionIndex||a.programConfigurations.populatePaintArrays(le.length,v,v.index,{},D,k,U,We&&We[Zn])}const $e=P?P.anchor:L;a.placedSymbolArray.emplaceBack($e.x,$e.y,$e.z,L.x,L.y,me,this.glyphOffsetArray.length-me,Se,A,O,L.segment,d?d[0]:0,d?d[1]:0,g[0],g[1],E,0,!1,0,N,0)}_commitLayoutVertex(a,c,d,g,m,v,E){a.emplaceBack(c,d,g,m,v,Math.round(E.x),Math.round(E.y))}_addCollisionDebugVertices(a,c,d,g,m,v,E){const P=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),L=P.vertexLength,A=E.tileAnchorX,O=E.tileAnchorY;for(let D=0;D<4;D++)d.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(d.collisionVertexArrayExt,c,a.padding,E.zOffset),this._commitLayoutVertex(d.layoutVertexArray,g,m,v,A,O,new Ut(a.x1,a.y1)),this._commitLayoutVertex(d.layoutVertexArray,g,m,v,A,O,new Ut(a.x2,a.y1)),this._commitLayoutVertex(d.layoutVertexArray,g,m,v,A,O,new Ut(a.x2,a.y2)),this._commitLayoutVertex(d.layoutVertexArray,g,m,v,A,O,new Ut(a.x1,a.y2)),P.vertexLength+=4;const N=d.indexArray;N.emplaceBack(L,L+1),N.emplaceBack(L+1,L+2),N.emplaceBack(L+2,L+3),N.emplaceBack(L+3,L),P.primitiveLength+=4}_addTextDebugCollisionBoxes(a,c,d,g,m,v){for(let E=g;E<m;E++){const P=d.get(E),L=this.getSymbolInstanceTextSize(a,v,c,E);this._addCollisionDebugVertices(P,L,this.textCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,v)}}_addIconDebugCollisionBoxes(a,c,d,g,m,v){for(let E=g;E<m;E++){const P=d.get(E),L=this.getSymbolInstanceIconSize(a,c,v.placedIconSymbolIndex);this._addCollisionDebugVertices(P,L,this.iconCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,v)}}generateCollisionDebugBuffers(a,c,d){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new y3(_u,Y.members,Nh),this.iconCollisionBox=new y3(_u,Y.members,Nh);const g=ir(this.iconSizeData,a),m=ir(this.textSizeData,a,d);for(let v=0;v<this.symbolInstances.length;v++){const E=this.symbolInstances.get(v);this._addTextDebugCollisionBoxes(m,a,c,E.textBoxStartIndex,E.textBoxEndIndex,E),this._addTextDebugCollisionBoxes(m,a,c,E.verticalTextBoxStartIndex,E.verticalTextBoxEndIndex,E),this._addIconDebugCollisionBoxes(g,a,c,E.iconBoxStartIndex,E.iconBoxEndIndex,E),this._addIconDebugCollisionBoxes(g,a,c,E.verticalIconBoxStartIndex,E.verticalIconBoxEndIndex,E)}}getSymbolInstanceTextSize(a,c,d,g){const m=this.text.placedSymbolArray.get(c.rightJustifiedTextSymbolIndex>=0?c.rightJustifiedTextSymbolIndex:c.centerJustifiedTextSymbolIndex>=0?c.centerJustifiedTextSymbolIndex:c.leftJustifiedTextSymbolIndex>=0?c.leftJustifiedTextSymbolIndex:c.verticalPlacedTextSymbolIndex>=0?c.verticalPlacedTextSymbolIndex:g),v=$n(this.textSizeData,a,m)/Ne;return this.tilePixelRatio*v}getSymbolInstanceIconSize(a,c,d){const g=this.icon.placedSymbolArray.get(d),m=$n(this.iconSizeData,a,g);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(a,c,d,g){a.emplaceBack(c,-d,-d,g),a.emplaceBack(c,d,-d,g),a.emplaceBack(c,d,d,g),a.emplaceBack(c,-d,d,g)}_updateTextDebugCollisionBoxes(a,c,d,g,m,v,E){for(let P=g;P<m;P++){const L=d.get(P),A=this.getSymbolInstanceTextSize(a,v,c,P);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,A,L.padding,v.zOffset)}}_updateIconDebugCollisionBoxes(a,c,d,g,m,v,E){for(let P=g;P<m;P++){const L=d.get(P),A=this.getSymbolInstanceIconSize(a,c,v.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,A,L.padding,v.zOffset)}}updateCollisionDebugBuffers(a,c,d,g){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const m=ir(this.iconSizeData,a,g),v=ir(this.textSizeData,a,d);for(let E=0;E<this.symbolInstances.length;E++){const P=this.symbolInstances.get(E);this._updateTextDebugCollisionBoxes(v,a,c,P.textBoxStartIndex,P.textBoxEndIndex,P,d),this._updateTextDebugCollisionBoxes(v,a,c,P.verticalTextBoxStartIndex,P.verticalTextBoxEndIndex,P,d),this._updateIconDebugCollisionBoxes(m,a,c,P.iconBoxStartIndex,P.iconBoxEndIndex,P,g),this._updateIconDebugCollisionBoxes(m,a,c,P.verticalIconBoxStartIndex,P.verticalIconBoxEndIndex,P,g)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(a,c,d,g,m,v,E,P,L){const A={};if(c<d){const{x1:O,y1:N,x2:D,y2:k,padding:U,projectedAnchorX:X,projectedAnchorY:Q,projectedAnchorZ:le,tileAnchorX:oe,tileAnchorY:re,featureIndex:me}=a.get(c);A.textBox={x1:O,y1:N,x2:D,y2:k,padding:U,projectedAnchorX:X,projectedAnchorY:Q,projectedAnchorZ:le,tileAnchorX:oe,tileAnchorY:re},A.textFeatureIndex=me}if(g<m){const{x1:O,y1:N,x2:D,y2:k,padding:U,projectedAnchorX:X,projectedAnchorY:Q,projectedAnchorZ:le,tileAnchorX:oe,tileAnchorY:re,featureIndex:me}=a.get(g);A.verticalTextBox={x1:O,y1:N,x2:D,y2:k,padding:U,projectedAnchorX:X,projectedAnchorY:Q,projectedAnchorZ:le,tileAnchorX:oe,tileAnchorY:re},A.verticalTextFeatureIndex=me}if(v<E){const{x1:O,y1:N,x2:D,y2:k,padding:U,projectedAnchorX:X,projectedAnchorY:Q,projectedAnchorZ:le,tileAnchorX:oe,tileAnchorY:re,featureIndex:me}=a.get(v);A.iconBox={x1:O,y1:N,x2:D,y2:k,padding:U,projectedAnchorX:X,projectedAnchorY:Q,projectedAnchorZ:le,tileAnchorX:oe,tileAnchorY:re},A.iconFeatureIndex=me}if(P<L){const{x1:O,y1:N,x2:D,y2:k,padding:U,projectedAnchorX:X,projectedAnchorY:Q,projectedAnchorZ:le,tileAnchorX:oe,tileAnchorY:re,featureIndex:me}=a.get(P);A.verticalIconBox={x1:O,y1:N,x2:D,y2:k,padding:U,projectedAnchorX:X,projectedAnchorY:Q,projectedAnchorZ:le,tileAnchorX:oe,tileAnchorY:re},A.verticalIconFeatureIndex=me}return A}deserializeCollisionBoxes(a){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(a,c){const d=a.placedSymbolArray.get(c),g=d.vertexStartIndex+4*d.numGlyphs;for(let m=d.vertexStartIndex;m<g;m+=4)a.indexArray.emplaceBack(m,m+1,m+2),a.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(a),d=Math.cos(a),g=[],m=[],v=[];for(let E=0;E<this.symbolInstances.length;++E){v.push(E);const P=this.symbolInstances.get(E);g.push(0|Math.round(c*P.tileAnchorX+d*P.tileAnchorY)),m.push(P.featureIndex)}return v.sort((E,P)=>g[E]-g[P]||m[P]-m[E]),v}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let a=0;a<this.symbolInstances.length;++a)this.symbolInstanceIndexesSortedZOffset.push(a)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((a,c)=>this.symbolInstances.get(c).zOffset-this.symbolInstances.get(a).zOffset)}addToSortKeyRanges(a,c){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===c?d.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:a,symbolInstanceEnd:a+1})}sortFeatures(a){if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const d=this.symbolInstances.get(c);this.featureSortOrder.push(d.featureIndex);const{rightJustifiedTextSymbolIndex:g,centerJustifiedTextSymbolIndex:m,leftJustifiedTextSymbolIndex:v,verticalPlacedTextSymbolIndex:E,placedIconSymbolIndex:P,verticalPlacedIconSymbolIndex:L}=d;g>=0&&this.addIndicesForPlacedSymbol(this.text,g),m>=0&&m!==g&&this.addIndicesForPlacedSymbol(this.text,m),v>=0&&v!==m&&v!==g&&this.addIndicesForPlacedSymbol(this.text,v),E>=0&&this.addIndicesForPlacedSymbol(this.text,E),P>=0&&this.addIndicesForPlacedSymbol(this.icon,P),L>=0&&this.addIndicesForPlacedSymbol(this.icon,L)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let ZN,JN,_3;Mt(yS,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),yS.addDynamicAttributes=gS;class QN{constructor(a){this.type=a.property.overrides?a.property.overrides.runtimeType:su,this.defaultValue=a}evaluate(a){if(a.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(a.formattedSection))return c.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default}eachChild(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Mt(QN,"FormatSectionOverride",{omit:["defaultValue"]});const v3=()=>_3||(_3={layout:ZN||(ZN=new Ra({"symbol-placement":new En(qt.layout_symbol["symbol-placement"]),"symbol-spacing":new En(qt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new En(qt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Fn(qt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new En(qt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new En(qt.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new En(qt.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new En(qt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new En(qt.layout_symbol["icon-ignore-placement"]),"icon-optional":new En(qt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new En(qt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Fn(qt.layout_symbol["icon-size"]),"icon-size-scale-range":new En(qt.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Fn(qt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Fn(qt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Fn(qt.layout_symbol["icon-image"]),"icon-rotate":new Fn(qt.layout_symbol["icon-rotate"]),"icon-padding":new En(qt.layout_symbol["icon-padding"]),"icon-keep-upright":new En(qt.layout_symbol["icon-keep-upright"]),"icon-offset":new Fn(qt.layout_symbol["icon-offset"]),"icon-anchor":new Fn(qt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new En(qt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new En(qt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new En(qt.layout_symbol["text-rotation-alignment"]),"text-field":new Fn(qt.layout_symbol["text-field"]),"text-font":new Fn(qt.layout_symbol["text-font"]),"text-size":new Fn(qt.layout_symbol["text-size"]),"text-size-scale-range":new En(qt.layout_symbol["text-size-scale-range"]),"text-max-width":new Fn(qt.layout_symbol["text-max-width"]),"text-line-height":new Fn(qt.layout_symbol["text-line-height"]),"text-letter-spacing":new Fn(qt.layout_symbol["text-letter-spacing"]),"text-justify":new Fn(qt.layout_symbol["text-justify"]),"text-radial-offset":new Fn(qt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new En(qt.layout_symbol["text-variable-anchor"]),"text-anchor":new Fn(qt.layout_symbol["text-anchor"]),"text-max-angle":new En(qt.layout_symbol["text-max-angle"]),"text-writing-mode":new En(qt.layout_symbol["text-writing-mode"]),"text-rotate":new Fn(qt.layout_symbol["text-rotate"]),"text-padding":new En(qt.layout_symbol["text-padding"]),"text-keep-upright":new En(qt.layout_symbol["text-keep-upright"]),"text-transform":new Fn(qt.layout_symbol["text-transform"]),"text-offset":new Fn(qt.layout_symbol["text-offset"]),"text-allow-overlap":new En(qt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new En(qt.layout_symbol["text-ignore-placement"]),"text-optional":new En(qt.layout_symbol["text-optional"]),visibility:new En(qt.layout_symbol.visibility)})),paint:JN||(JN=new Ra({"icon-opacity":new Fn(qt.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Fn(qt.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Fn(qt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Fn(qt.paint_symbol["text-emissive-strength"]),"icon-color":new Fn(qt.paint_symbol["icon-color"]),"icon-halo-color":new Fn(qt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Fn(qt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Fn(qt.paint_symbol["icon-halo-blur"]),"icon-translate":new En(qt.paint_symbol["icon-translate"]),"icon-translate-anchor":new En(qt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Fn(qt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Fn(qt.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Fn(qt.paint_symbol["text-occlusion-opacity"]),"text-color":new Fn(qt.paint_symbol["text-color"],{runtimeType:Fs,getOverride:h=>h.textColor,hasOverride:h=>!!h.textColor}),"text-halo-color":new Fn(qt.paint_symbol["text-halo-color"]),"text-halo-width":new Fn(qt.paint_symbol["text-halo-width"]),"text-halo-blur":new Fn(qt.paint_symbol["text-halo-blur"]),"text-translate":new En(qt.paint_symbol["text-translate"]),"text-translate-anchor":new En(qt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new En(qt.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new En(qt.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new En(qt.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new En(qt.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Fn(qt.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Fn({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Fn({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Fn({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Fn({type:"string",default:"default","property-type":"data-driven"})}))},_3);class _S extends eo{constructor(a,c,d,g){super(a,v3(),c,d,g),this._colorAdjustmentMatrix=_e.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=a.paint!==void 0&&("icon-occlusion-opacity"in a.paint||"text-occlusion-opacity"in a.paint)}recalculate(a,c){super.recalculate(a,c),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const d=this.layout.get("text-writing-mode");if(d){const g=[];for(const m of d)g.indexOf(m)<0&&g.push(m);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(a,c,d,g){return this._saturation===a&&this._contrast===c&&this._brightnessMin===d&&this._brightnessMax===g||(this._colorAdjustmentMatrix=function(m,v,E,P){m=Zt(m),v=zs(v);const L=_e.mat4.create(),A=m/3,O=1-2*A,N=[O,A,A,0,A,O,A,0,A,A,O,0,0,0,0,1],D=.5-.5*v,k=P-E;return _e.mat4.multiply(L,[k,0,0,0,0,k,0,0,0,0,k,0,E,E,E,1],[v,0,0,0,0,v,0,0,0,0,v,0,D,D,D,1]),_e.mat4.multiply(L,L,N),L}(a,c,d,g),this._saturation=a,this._contrast=c,this._brightnessMin=d,this._brightnessMax=g),this._colorAdjustmentMatrix}getValueAndResolveTokens(a,c,d,g){const m=this.layout.get(a).evaluate(c,{},d,g),v=this._unevaluatedLayout._values[a];return v.isDataDriven()||jf(v.value)||!m?m:function(E,P){return P.replace(/{([^{}]+)}/g,(L,A)=>A in E?String(E[A]):"")}(c.properties,m)}createBucket(a){return new yS(a)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const a of v3().paint.overridableProperties){if(!_S.hasPaintOverride(this.layout,a))continue;const c=this.paint.get(a),d=new QN(c),g=new Qs(d,c.property.specification,this.scope,this.options);let m=null;m=c.value.kind==="constant"||c.value.kind==="source"?new Z("source",g):new de("composite",g,c.value.zoomStops,c.value._interpolationType),this.paint._values[a]=new Il(c.property,m,c.parameters)}}_handleOverridablePaintPropertyUpdate(a,c,d){return!(!this.layout||c.isDataDriven()||d.isDataDriven())&&_S.hasPaintOverride(this.layout,a)}static hasPaintOverride(a,c){const d=a.get("text-field"),g=v3().paint.properties[c];let m=!1;const v=E=>{for(const P of E)if(g.overrides&&g.overrides.hasOverride(P))return void(m=!0)};if(d.value.kind==="constant"&&d.value.value instanceof os)v(d.value.value.sections);else if(d.value.kind==="source"){const E=L=>{m||(L instanceof Vl&&qa(L.value)===uc?v(L.value.sections):L instanceof bh?v(L.sections):L.eachChild(E))},P=d.value;P._styleExpression&&E(P._styleExpression.expression)}return m}getProgramIds(){return["symbol"]}getDefaultProgramParams(a,c,d){return{config:new Kc(this,{zoom:c,lut:d}),overrideFog:!1}}}let ez,tz,nz,rz;var b3=Mi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function x3(h){switch(h){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function w3(h){switch(h){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class S3{constructor(a,c,d,g){this.context=a,this.format=d,this.useMipmap=g&&g.useMipmap,this.texture=a.gl.createTexture(),this.update(c,{premultiply:g&&g.premultiply})}update(a,c){const d=a&&a instanceof HTMLVideoElement&&a.width===0?a.videoWidth:a.width,g=a&&a instanceof HTMLVideoElement&&a.height===0?a.videoHeight:a.height,{context:m}=this,{gl:v}=m,{x:E,y:P}=c&&c.position?c.position:{x:0,y:0},L=E+d,A=P+g;!this.size||this.size[0]===L&&this.size[1]===A||(v.bindTexture(v.TEXTURE_2D,null),v.deleteTexture(this.texture),this.texture=v.createTexture(),this.size=null),v.bindTexture(v.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA8&&(!c||c.premultiply!==!1));const O=a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||ImageBitmap&&a instanceof ImageBitmap;if(!this.size&&L>0&&A>0){const N=this.useMipmap?Math.floor(Math.log2(Math.max(L,A)))+1:1;v.texStorage2D(v.TEXTURE_2D,N,this.format,L,A),this.size=[L,A]}if(this.size)if(O)v.texSubImage2D(v.TEXTURE_2D,0,E,P,x3(this.format),w3(this.format),a);else{const N=a.data;N&&v.texSubImage2D(v.TEXTURE_2D,0,E,P,d,g,x3(this.format),w3(this.format),N)}this.useMipmap&&v.generateMipmap(v.TEXTURE_2D)}bind(a,c,d=!1){const{context:g}=this,{gl:m}=g;m.bindTexture(m.TEXTURE_2D,this.texture),a!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,a),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap&&!d?a===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:a),this.minFilter=a),c!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,c),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,c),this.wrapS=c)}bindExtraParam(a,c,d,g){const{context:m}=this,{gl:v}=m;v.bindTexture(v.TEXTURE_2D,this.texture),c!==this.magFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,c),this.magFilter=c),a!==this.minFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,this.useMipmap?a===v.NEAREST?v.NEAREST_MIPMAP_NEAREST:v.LINEAR_MIPMAP_LINEAR:a),this.minFilter=a),d!==this.wrapS&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,d),this.wrapS=d),g!==this.wrapT&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,g),this.wrapT=g)}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}}class vS{constructor(a,c){this.context=a,this.texture=c}bind(a,c){const{context:d}=this,{gl:g}=d;g.bindTexture(g.TEXTURE_2D,this.texture),a!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,a),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,a),this.minFilter=a),c!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,c),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,c),this.wrapS=c)}}function bS(h,a,c,d,g,m,v,E){const P=[h,a,1,c,d,1,g,m,1],L=[v,E,1],A=_e.mat3.adjoint([],P),[O,N,D]=_e.vec3.transformMat3(L,L,A);return _e.mat3.multiply(P,P,[O,0,0,0,N,0,0,0,D])}function iz(h,a,c,d,g,m,v,E){const P=function(L,A,O,N,D,k,U,X){const Q=bS(0,0,1,0,1,1,0,1),le=bS(L,A,O,N,D,k,U,X),oe=_e.mat3.adjoint([],Q);return _e.mat3.multiply(le,le,oe)}(h,a,c,d,g,m,v,E);return[P[2]/P[8]/On,P[5]/P[8]/On]}function xS(h){return[h[0],Math.min(Math.max(h[1],-85.051129),Cc)]}class az extends ql{constructor(a,c,d,g){super(),this.id=a,this.dispatcher=d,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(g),this.options=c,this._dirty=!1}load(a,c){if(this._loaded=c||!1,this.fire(new ko("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return a&&(this.coordinates=a),this._loaded=!0,void this._finishLoading();this._imageRequest=Jh(this.map._requestManager.transformRequest(this.url,bs.Image),(d,g)=>{this._imageRequest=null,this._loaded=!0,d?this.fire(new yh(d)):g&&(this.image=g instanceof HTMLImageElement?$t.getImageData(g):g,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,a&&(this.coordinates=a),this._finishLoading())})}loaded(){return this._loaded}updateImage(a){return a.url?(this._imageRequest&&a.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=a.url,this.load(a.coordinates,this._loaded),this):this}setTexture(a){if(!(a.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new vS(this.map.painter.context,a.handle),this.width=a.dimensions[0],this.height=a.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new ko("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(a){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof vS||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(a){if(this.coordinates=a,this._boundsArray=void 0,this._unsupportedCoords=!1,!a.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let c=a[0][1],d=a[0][1];for(const m of a)m[1]>d&&(d=m[1]),m[1]<c&&(c=m[1]);const g=(d+c)/2;if(g>Cc?this.onNorthPole=!0:g<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const m=a.map(o.fromLngLat);this.tileID=function(v){let E=1/0,P=1/0,L=-1/0,A=-1/0;for(const U of v)E=Math.min(E,U.x),P=Math.min(P,U.y),L=Math.max(L,U.x),A=Math.max(A,U.y);const O=Math.max(L-E,A-P),N=Math.max(0,Math.floor(-Math.log(O)/Math.LN2)),D=Math.pow(2,N);let k=Math.floor((E+L)/2*D);return k>1&&(k-=1),new fn(N,k,Math.floor((P+A)/2*D))}(m),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new ko("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(a){for(const Q in this.tiles){const le=this.tiles[Q];le.state!=="loaded"&&(le.state="loaded",le.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const c=Rb(new fn(0,0,0),this.map.transform.projection),d=[c.projection.project(this.coordinates[0][0],this.coordinates[0][1]),c.projection.project(this.coordinates[1][0],this.coordinates[1][1]),c.projection.project(this.coordinates[2][0],this.coordinates[2][1]),c.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(Q){const le=Q[1].x-Q[0].x,oe=Q[1].y-Q[0].y,re=Q[2].x-Q[1].x,me=Q[2].y-Q[1].y,Se=Q[3].x-Q[2].x,Me=Q[3].y-Q[2].y,We=Q[0].x-Q[3].x,$e=Q[0].y-Q[3].y,He=le*me-re*oe,ht=re*Me-Se*me,Ke=Se*$e-We*Me,pt=We*oe-le*$e;return He>0&&ht>0&&Ke>0&&pt>0||He<0&&ht<0&&Ke<0&&pt<0}(d))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const g=Rb(this.tileID,this.map.transform.projection),[m,v,E,P]=this.coordinates.map(Q=>{const le=g.projection.project(Q[0],Q[1]);return HN(g,le)._round()});this.perspectiveTransform=iz(m.x,m.y,v.x,v.y,E.x,E.y,P.x,P.y);const L=this._boundsArray=new Ac;L.emplaceBack(m.x,m.y,0,0),L.emplaceBack(v.x,v.y,On,0),L.emplaceBack(P.x,P.y,0,On),L.emplaceBack(E.x,E.y,On,On),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=a.createVertexBuffer(L,b3.members),this.boundsSegments=Da.simpleSegment(0,0,4,2);const A=[],O=[xS((N=this.coordinates)[0]),xS(N[1]),xS(N[2]),xS(N[3])];var N;const[D,k,U,X]=function(Q){let le=Q[0][0],oe=le,re=Q[0][1],me=re;for(let Se=1;Se<Q.length;Se++)Q[Se][0]<le?le=Q[Se][0]:Q[Se][0]>oe&&(oe=Q[Se][0]),Q[Se][1]<re?re=Q[Se][1]:Q[Se][1]>me&&(me=Q[Se][1]);return[le,re,oe-le,me-re]}(O);{const Q=new Ac,[le,oe,re,me]=function(It){let jt=It[0].x,Dt=jt,Vt=It[0].y,_n=Vt;for(let gn=1;gn<It.length;gn++)It[gn].x<jt?jt=It[gn].x:It[gn].x>Dt&&(Dt=It[gn].x),It[gn].y<Vt?Vt=It[gn].y:It[gn].y>_n&&(_n=It[gn].y);return[jt,Vt,Dt-jt,_n-Vt]}(d),Se=It=>[(It.x-le)/re,(It.y-oe)/me],[Me,We,$e,He]=d.map(Se),ht=function(It,jt,Dt,Vt,_n,gn,Zn,Cn){const Ln=bS(0,0,1,0,1,1,0,1),bn=bS(It,jt,Dt,Vt,_n,gn,Zn,Cn),_r=_e.mat3.adjoint([],bn);return _e.mat3.multiply(Ln,Ln,_r)}(Me[0],Me[1],We[0],We[1],$e[0],$e[1],He[0],He[1]);this.elevatedGlobePerspectiveTransform=iz(Me[0],Me[1],We[0],We[1],$e[0],$e[1],He[0],He[1]);const Ke=(It,jt)=>{A.push(It.lng);const Dt=Math.round((It.lng-D)/U*On),Vt=Math.round((It.lat-k)/X*On),_n=Se(jt),gn=_e.vec3.transformMat3([],[_n[0],_n[1],1],ht),Zn=Math.round(gn[0]/gn[2]*On),Cn=Math.round(gn[1]/gn[2]*On);Q.emplaceBack(Dt,Vt,Zn,Cn)},pt=d[3].x-d[0].x,Et=d[3].y-d[0].y,wt=d[2].x-d[1].x,Ot=d[2].y-d[1].y;for(let It=0;It<65;It++){const jt=It/64,Dt=[d[0].x+jt*pt,d[0].y+jt*Et],Vt=[d[1].x+jt*wt,d[1].y+jt*Ot],_n=Vt[0]-Dt[0],gn=Vt[1]-Dt[1];for(let Zn=0;Zn<65;Zn++){const Cn=Zn/64,Ln={x:Dt[0]+_n*Cn,y:Dt[1]+gn*Cn};Ke(c.projection.unproject(Ln.x,Ln.y),Ln)}}this.elevatedGlobeVertexBuffer=a.createVertexBuffer(Q,b3.members)}{this.maxLongitudeTriangleSize=0;let Q=[],le=new Ms;const oe=(re,me,Se)=>{le.emplaceBack(re,me,Se);const Me=A[re],We=A[me],$e=A[Se],He=Math.min(Math.min(Me,We),$e),ht=Math.max(Math.max(Me,We),$e)-He;ht>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=ht),Q.push(He+ht/2)};for(let re=0;re<64;re++)for(let me=0;me<64;me++){const Se=65*re+me,Me=Se+1,We=Se+65,$e=We+1;oe(Se,We,Me),oe(Me,We,$e)}[Q,le]=function(re,me){const Se=Array.from({length:re.length},($e,He)=>He);Se.sort(($e,He)=>re[$e]-re[He]);const Me=[],We=new Ms;for(let $e=0;$e<Se.length;$e++){const He=Se[$e];Me.push(re[He]);const ht=3*He,Ke=ht+1;We.emplaceBack(me.uint16[ht],me.uint16[Ke],me.uint16[Ke+1])}return[Me,We]}(Q,le),this.elevatedGlobeTrianglesCenterLongitudes=Q,this.elevatedGlobeIndexBuffer=a.createIndexBuffer(le)}this.elevatedGlobeSegments=Da.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,U/On,0,X/On,0,0,k,D,0])}prepare(){const a=Object.keys(this.tiles).length!==0;if(this.tileID&&!a)return;const c=this.map.painter.context,d=c.gl;!this._dirty||this.texture instanceof vS||(this.texture?this.texture.update(this.image):(this.texture=new S3(c,this.image,d.RGBA8),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this._dirty=!1),a&&this._prepareData(c)}loadTile(a,c){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},c(null)):(a.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(a){const c=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!c)return null;const d=this.elevatedGlobeTrianglesCenterLongitudes;let g=(m=a+180)+360*Math.round((d[0]-m)/360);var m;const v=new Da,E=(O,N)=>{v.segments.push({vertexOffset:0,primitiveOffset:O,vertexLength:c.segments[0].vertexLength,primitiveLength:N,sortKey:void 0,vaos:{}})},P=.51*this.maxLongitudeTriangleSize;if(Math.abs(d[0]-g)<=P){const O=Iu(d,0,d.length,g+P);return O===d.length||E(O,la(d,O+1,d.length,g+360-P)-O),v}g<d[0]&&(g+=360);const L=la(d,0,d.length,g-P);if(L===d.length)return E(0,d.length),v;E(0,L-0);const A=Iu(d,L+1,d.length,g+P);return A!==d.length&&E(A,d.length-A),v}}const aQ=(Math.pow(256,2)-1)/16907520;class sz extends eo{constructor(a,c,d,g){super(a,{layout:nz||(nz=new Ra({visibility:new En(qt.layout_raster.visibility)})),paint:rz||(rz=new Ra({"raster-opacity":new En(qt.paint_raster["raster-opacity"]),"raster-color":new Wa(qt.paint_raster["raster-color"]),"raster-color-mix":new En(qt.paint_raster["raster-color-mix"]),"raster-color-range":new En(qt.paint_raster["raster-color-range"]),"raster-hue-rotate":new En(qt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new En(qt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new En(qt.paint_raster["raster-brightness-max"]),"raster-saturation":new En(qt.paint_raster["raster-saturation"]),"raster-contrast":new En(qt.paint_raster["raster-contrast"]),"raster-resampling":new En(qt.paint_raster["raster-resampling"]),"raster-fade-duration":new En(qt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new En(qt.paint_raster["raster-emissive-strength"]),"raster-array-band":new En(qt.paint_raster["raster-array-band"]),"raster-elevation":new En(qt.paint_raster["raster-elevation"]),"raster-color-use-theme":new Fn({type:"string",default:"default","property-type":"data-driven"})}))},c,d,g),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(a){return!(a&&a._source instanceof az&&(a._source.onNorthPole||a._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(a){a!=="raster-color"&&a!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(a){if(!this.hasColorMap()||!this._curRampRange)return;const c=this._transitionablePaint._values["raster-color"].value.expression,[d,g]=a||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(d)&&isNaN(g)||d===this._curRampRange[0]&&g===this._curRampRange[1]||(this.colorRamp=Bg({expression:c,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:d,end:g}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[d,g])}}let oz,lz,cz,uz,hz;class fz extends eo{constructor(a,c,d,g){super(a,{layout:oz||(oz=new Ra({visibility:new En(qt["layout_raster-particle"].visibility)})),paint:lz||(lz=new Ra({"raster-particle-array-band":new En(qt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new En(qt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Wa(qt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new En(qt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new En(qt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new En(qt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new En(qt["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new En(qt["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Fn({type:"string",default:"default","property-type":"data-driven"})}))},c,d,g),this._updateColorRamp(),this.lastInvalidatedAt=$t.now()}onRemove(a){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(a){return!1}_handleSpecialPaintPropertyUpdate(a){a!=="raster-particle-color"&&a!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),a==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const a=this._transitionablePaint._values["raster-particle-color"].value.expression,c=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Bg({expression:a,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:c}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=$t.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class sQ extends eo{constructor(a,c){super(a,{},c,null),this.implementation=a,a.slot&&(this.slot=a.slot)}is3D(a){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(a){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(a){this.implementation.onAdd&&this.implementation.onAdd(a,a.painter.context.gl)}onRemove(a){this.implementation.onRemove&&this.implementation.onRemove(a,a.painter.context.gl)}}function A3(h,a,c){const d=[0,0,1],g=_e.quat.identity([]);return _e.quat.rotateY(g,g,c?-Rn(h)+Math.PI:Rn(h)),_e.quat.rotateX(g,g,-Rn(a)),_e.vec3.transformQuat(d,d,g),_e.vec3.normalize(d,d)}function dz(h,a){const c=wS(h.projection,h.zoom,h.width,h.height),d=function(m,v,E,P,L){const A=new zi(E.lng-180*ey,E.lat),O=new zi(E.lng+180*ey,E.lat),N=m.project(A.lng,A.lat),D=m.project(O.lng,O.lat),k=-Math.atan2(D.y-N.y,D.x-N.x),U=o.fromLngLat(E);U.y=Un(U.y,-1+ey,1-ey);const X=U.toLngLat(),Q=m.project(X.lng,X.lat),le=o.fromLngLat(X);le.x+=ey;const oe=le.toLngLat(),re=m.project(oe.lng,oe.lat),me=mz(re.x-Q.x,re.y-Q.y,k),Se=o.fromLngLat(X);Se.y+=ey;const Me=Se.toLngLat(),We=m.project(Me.lng,Me.lat),$e=mz(We.x-Q.x,We.y-Q.y,k),He=Math.abs(me.x)/Math.abs($e.y),ht=_e.mat4.identity([]);_e.mat4.rotateZ(ht,ht,-k*(1-(L?0:P)));const Ke=_e.mat4.identity([]);return _e.mat4.scale(Ke,Ke,[1,1-(1-He)*P,1]),Ke[4]=-$e.x/$e.y*P,_e.mat4.rotateZ(Ke,Ke,k),_e.mat4.multiply(Ke,ht,Ke),Ke}(h.projection,0,h.center,c,a),g=pz(h);return _e.mat4.scale(d,d,[g,g,1]),d}function pz(h){const a=h.projection,c=wS(h.projection,h.zoom,h.width,h.height),d=T3(a,h.center),g=T3(a,zi.convert(a.center));return Math.pow(2,d*c+(1-c)*g)}function wS(h,a,c,d,g=1/0){const m=h.range;if(!m)return 0;const v=Math.min(g,Math.max(c,d)),E=Math.log(v/1024)/Math.LN2;return Vr(m[0]+E,m[1]+E,a)}const ey=1/4e4;function T3(h,a){const c=Un(a.lat,-85.051129,Cc),d=new zi(a.lng-180*ey,c),g=new zi(a.lng+180*ey,c),m=h.project(d.lng,c),v=h.project(g.lng,c),E=o.fromLngLat(d),P=o.fromLngLat(g),L=v.x-m.x,A=v.y-m.y,O=P.x-E.x,N=P.y-E.y,D=Math.sqrt((O*O+N*N)/(L*L+A*A));return Math.log(D)/Math.LN2}function mz(h,a,c){const d=Math.cos(c),g=Math.sin(c);return{x:h*d-a*g,y:h*g+a*d}}function gz(h,a,c){_e.mat4.identity(h),_e.mat4.rotateZ(h,h,Rn(a[2])),_e.mat4.rotateX(h,h,Rn(a[0])),_e.mat4.rotateY(h,h,Rn(a[1])),_e.mat4.scale(h,h,c),_e.mat4.multiply(h,h,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function SS(h,a,c,d,g,m,v,E){const P=[c[0]-a[0],c[1]-a[1],0],L=[d[0]-a[0],d[1]-a[1],0];if(_e.vec3.length(P)<1e-12||_e.vec3.length(L)<1e-12)return _e.quat.identity(h);const A=_e.vec3.cross([],P,L);_e.vec3.normalize(A,A),_e.vec3.subtract(L,d,a),P[2]=(m-g)*E,L[2]=(v-g)*E;const O=P;return _e.vec3.cross(O,P,L),_e.vec3.normalize(O,O),_e.quat.rotationTo(h,A,O)}function E3(h,a,c=!1){const d=Rl(a.zoom),g=function(m,v,E){const P=v.worldSize,L=[m[12],m[13],m[14]],A=xa(L[1]/P),O=Mc(L[0]/P),N=_e.mat4.identity([]),D=Uo(1,A)*P,k=Uo(1,0)*P*Hf(A,v.zoom),U=1/Su(P);let X=k*U;if(E){const re=wS(v.projection,v.zoom,v.width,v.height,1024);X=U*v.projection.pixelSpaceConversion(v.center.lat,P,re)}const Q=wu(A,O);_e.vec3.add(Q,Q,_e.vec3.scale([],_e.vec3.normalize([],Q),D*X*L[2]));const le=function(re){const me=[re[0],re[1],re[2]];let Se=[0,1,0];const Me=_e.vec3.cross([],Se,me);return _e.vec3.cross(Se,me,Me),_e.vec3.squaredLength(Se)===0&&(Se=[0,1,0],_e.vec3.cross(Me,me,Se)),_e.vec3.normalize(Me,Me),_e.vec3.normalize(Se,Se),_e.vec3.normalize(me,me),[Me[0],Me[1],Me[2],0,Se[0],Se[1],Se[2],0,me[0],me[1],me[2],0,re[0],re[1],re[2],1]}(Q);_e.mat4.scale(N,N,[X,X,X*D]),_e.mat4.translate(N,N,[-L[0],-L[1],-L[2]]);const oe=_e.mat4.multiply([],v.globeMatrix,le);return _e.mat4.multiply(oe,oe,N),_e.mat4.multiply(oe,oe,m),oe}(h,a,c);if(d>0){const m=function(v,E){const P=E.worldSize,L=Uo(1,0)*P*Hf(E.center.lat,E.zoom)/Su(P),A=Uo(1,E.center.lat)*P,O=_e.mat4.identity([]);return _e.mat4.rotateY(O,O,Rn(E.center.lng)),_e.mat4.rotateX(O,O,Rn(E.center.lat)),_e.mat4.translate(O,O,[0,0,ml]),_e.mat4.scale(O,O,[L,L,L*A]),_e.mat4.translate(O,O,[E.point.x-.5*P,E.point.y-.5*P,0]),_e.mat4.multiply(O,O,v),_e.mat4.multiply(O,E.globeMatrix,O)}(h,a);return function(v,E,P){const L=(k,U,X)=>{const Q=_e.vec3.length(k),le=_e.vec3.length(U),oe=to(k,U,X);return _e.vec3.scale(oe,oe,1/_e.vec3.length(oe)*dr(Q,le,X))},A=L([v[0],v[1],v[2]],[E[0],E[1],E[2]],P),O=L([v[4],v[5],v[6]],[E[4],E[5],E[6]],P),N=L([v[8],v[9],v[10]],[E[8],E[9],E[10]],P),D=to([v[12],v[13],v[14]],[E[12],E[13],E[14]],P);return[A[0],A[1],A[2],0,O[0],O[1],O[2],0,N[0],N[1],N[2],0,D[0],D[1],D[2],1]}(g,m,d)}return g}function yz(h,a,c,d){const g=tr.projectAabbCorners(d,c);let m=Number.MAX_VALUE,v=-1;for(let L=0;L<g.length;++L){const A=g[L];A[0]=(.5*A[0]+.5)*a.width,A[1]=(.5-.5*A[1])*a.height,A[2]<m&&(v=L,m=A[2])}const E=L=>new Ut(g[L][0],g[L][1]);let P;switch(v){case 0:case 6:P=[E(1),E(5),E(4),E(7),E(3),E(2),E(1)];break;case 1:case 7:P=[E(0),E(4),E(5),E(6),E(2),E(3),E(0)];break;case 3:case 5:P=[E(1),E(0),E(4),E(7),E(6),E(2),E(1)];break;default:P=[E(1),E(5),E(6),E(7),E(3),E(0),E(1)]}if(Te(h,P))return m}const oQ=Mi([{name:"a_pos_3f",components:3,type:"Float32"}]),lQ=Mi([{name:"a_color_3f",components:3,type:"Float32"}]),cQ=Mi([{name:"a_color_4f",components:4,type:"Float32"}]),uQ=Mi([{name:"a_uv_2f",components:2,type:"Float32"}]),hQ=Mi([{name:"a_normal_3f",components:3,type:"Float32"}]),fQ=Mi([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),dQ=Mi([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),_z={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class AS{constructor(a,c,d,g){this.message=(a?`${a}: `:"")+d,g&&(this.identifier=g),c!=null&&c.__line__&&(this.line=c.__line__)}}function vz(h,a){const c=h.indexOf("://")===-1;try{return new URL(h,c&&a?"http://example.com":void 0),!0}catch{return!1}}class bz{constructor(a,c){this.feature=a,this.instancedDataOffset=c,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class xz{constructor(){this.instancedDataArray=new jm,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class M3{constructor(a){this.zoom=a.zoom,this.canonical=a.canonical,this.layers=a.layers,this.layerIds=this.layers.map(c=>c.fqid),this.projection=a.projection,this.index=a.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(a,c){}populate(a,c,d,g){this.tileToMeter=y(d);const m=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:v,id:E,index:P,sourceLayerIndex:L}of a){const A=E??(v.properties&&v.properties.hasOwnProperty("id")?v.properties.id:void 0),O=K(v,m);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom),O,d))continue;const N={id:A,sourceLayerIndex:L,index:P,geometry:m?O.geometry:$(v,d,g),properties:v.properties,type:v.type,patterns:{}},D=this.addFeature(N,N.geometry,O);D&&c.featureIndex.insert(v,N.geometry,P,L,this.index,this.instancesPerModel[D].instancedDataArray.length,On/32)}this.lookup=null}update(a,c,d,g){for(const m in this.instancesPerModel){const v=this.instancesPerModel[m];for(const E in a)v.idToFeaturesIndex.hasOwnProperty(E)&&(this.evaluate(v.features[v.idToFeaturesIndex[E]],a[E],v,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let a=!1;for(const c in this.instancesPerModel){const d=this.instancesPerModel[c];for(const g of d.features){const m=this.layers[0],v=g.feature,E=this.canonical,P=m.paint.get("model-rotation").evaluate(v,{},E),L=m.paint.get("model-scale").evaluate(v,{},E),A=m.paint.get("model-translation").evaluate(v,{},E);_e.vec3.exactEquals(g.rotation,P)&&_e.vec3.exactEquals(g.scale,L)&&_e.vec3.exactEquals(g.translation,A)||(this.evaluate(g,g.featureStates,d,!0),a=!0)}}return a}updateReplacement(a,c,d,g){if(c.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=c.updateTime;const m=c.getReplacementRegionsForTile(a.toUnwrapped(),!0);if(jv(this.activeReplacements,m))return!1;this.activeReplacements=m;let v=!1;for(const E in this.instancesPerModel){const P=this.instancesPerModel[E],L=P.instancedDataArray;for(const A of P.features){const O=A.instancedDataOffset,N=A.instancedDataCount;for(let D=0;D<N;D++){const k=16*(D+O);let U=L.float32[k+0];const X=U>On;U=X?U-On:U;const Q=Math.floor(U),le=L.float32[k+1];let oe=!1;for(const re of this.activeReplacements)if(!Pd(re,d,_z.Model,g)&&!(re.min.x>Q||Q>re.max.x||re.min.y>le||le>re.max.y)&&(oe=W2(G2(Q,le,a.canonical,re.footprintTileId.canonical),re.footprint),oe))break;L.float32[k]=oe?U+On:U,v=v||oe!==X}}}return v}isEmpty(){for(const a in this.instancesPerModel)if(this.instancesPerModel[a].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(a){if(!this.uploaded)for(const c in this.instancesPerModel){const d=this.instancesPerModel[c];d.instancedDataArray.length<0||d.instancedDataArray.length===0||(d.instancedDataBuffer?d.instancedDataBuffer.updateData(d.instancedDataArray):d.instancedDataBuffer=a.createVertexBuffer(d.instancedDataArray,fQ.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const c in this.instancesPerModel){const d=this.instancesPerModel[c];d.instancedDataArray.length!==0&&d.instancedDataBuffer&&d.instancedDataBuffer.destroy()}const a=this.layers[0].modelManager;if(a&&this.modelUris)for(const c of this.modelUris)a.removeModel(c,"")}addFeature(a,c,d){const g=this.layers[0],m=g.layout.get("model-id").evaluate(d,{},this.canonical);if(!m)return ti(`modelId is not evaluated for layer ${g.id} and it is not going to get rendered.`),m;vz(m,!1)&&(this.modelUris.includes(m)||this.modelUris.push(m)),this.instancesPerModel[m]||(this.instancesPerModel[m]=new xz);const v=this.instancesPerModel[m],E=v.instancedDataArray,P=new bz(d,E.length);for(const L of c)for(const A of L){if(A.x<0||A.x>=On||A.y<0||A.y>=On)continue;const O=(this.lookupDim-1)/On,N=this.lookupDim*(A.y*O|0)+A.x*O|0;if(this.lookup){if(this.lookup[N]!==0)continue;this.lookup[N]=1}this.instanceCount++;const D=E.length;E.resize(D+1),v.instancesEvaluatedElevation.push(0),E.float32[16*D]=A.x,E.float32[16*D+1]=A.y}return P.instancedDataCount=v.instancedDataArray.length-P.instancedDataOffset,P.instancedDataCount>0&&(a.id&&(v.idToFeaturesIndex[a.id]=v.features.length),v.features.push(P),this.evaluate(P,{},v,!1)),m}getModelUris(){return this.modelUris}evaluate(a,c,d,g){const m=this.layers[0],v=a.feature,E=this.canonical,P=a.rotation=m.paint.get("model-rotation").evaluate(v,c,E),L=a.scale=m.paint.get("model-scale").evaluate(v,c,E),A=a.translation=m.paint.get("model-translation").evaluate(v,c,E),O=m.paint.get("model-color").evaluate(v,c,E);O.a=m.paint.get("model-color-mix-intensity").evaluate(v,c,E);const N=[];this.maxVerticalOffset<A[2]&&(this.maxVerticalOffset=A[2]),this.maxScale=Math.max(Math.max(this.maxScale,L[0]),Math.max(L[1],L[2])),gz(N,P,L);const D=Math.round(100*O.a)+O.b/1.05;for(let k=0;k<a.instancedDataCount;++k){const U=a.instancedDataOffset+k,X=16*U,Q=d.instancedDataArray.float32;let le=0;g&&(le=Q[X+6]-d.instancesEvaluatedElevation[U]);const oe=0|Q[X+1];Q[X]=(0|Q[X])+O.r/1.05,Q[X+1]=oe+O.g/1.05,Q[X+2]=D,Q[X+3]=1/(E.z>10?this.tileToMeter:y(E,oe)),Q[X+4]=A[0],Q[X+5]=A[1],Q[X+6]=A[2]+le,Q[X+7]=N[0],Q[X+8]=N[1],Q[X+9]=N[2],Q[X+10]=N[4],Q[X+11]=N[5],Q[X+12]=N[6],Q[X+13]=N[8],Q[X+14]=N[9],Q[X+15]=N[10],d.instancesEvaluatedElevation[U]=A[2]}}}let wz,Sz;Mt(M3,"ModelBucket",{omit:["layers"]}),Mt(xz,"PerModelAttributes"),Mt(bz,"ModelFeature");const __=64,Zv={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Az(h,a,c,d,g,m,v,E,P,L=!1){const A=c.zoom,O=c.project(d),N=Hf(d.lat,A),D=1/N;_e.mat4.identity(h),_e.mat4.translate(h,h,[O.x+v[0]*D,O.y+v[1]*D,v[2]]);let k=1,U=1;const X=c.worldSize;if(L){if(c.projection.name==="mercator"){let re=0;c.elevation&&(re=c.elevation.getAtPointOrZero(new o(O.x/X,O.y/X),0));const me=_e.vec4.transformMat4([],[O.x,O.y,re,1],c.projMatrix)[3]/c.cameraToCenterDistance;k=me,U=me*Hf(c.center.lat,A)}else if(c.projection.name==="globe"){const re=E3(h,c),me=_e.mat4.multiply([],c.projMatrix,re),Se=[0,0,0,1];_e.vec4.transformMat4(Se,Se,me);const Me=Se[3]/c.cameraToCenterDistance,We=Rl(A),$e=c.projection.pixelsPerMeter(d.lat,X)*Hf(d.lat,A),He=c.projection.pixelsPerMeter(c.center.lat,X)*Hf(c.center.lat,A);k=Me/dr($e,Qy(c.center.lat),We),U=Me*N/$e,k*=He,U*=He}}else k=D;_e.mat4.scale(h,h,[k,k,U]);const Q=[...h],le=a.orientation,oe=[];if(gz(oe,[le[0]+g[0],le[1]+g[1],le[2]+g[2]],m),_e.mat4.multiply(h,Q,oe),E&&c.elevation){let re=0;const me=[];if(P&&c.elevation){re=function(We,$e,He,ht,Ke){const pt=$e.elevation;if(!pt)return 0;const Et=tr.projectAabbCorners(He,ht),wt=Uo(1,Ke.lat)*$e.worldSize,Ot=function(_r,Kn){const lr=[0,0,1],Lr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Qr of Lr){const Fr=_r[Qr.corners[0]],ui=_r[Qr.corners[1]],Jr=_r[Qr.corners[2]],xi=[ui[0]-Fr[0],ui[1]-Fr[1],Kn*(ui[2]-Fr[2])],Gi=_e.vec3.cross(xi,xi,[Jr[0]-Fr[0],Jr[1]-Fr[1],Kn*(Jr[2]-Fr[2])]);_e.vec3.normalize(Gi,Gi),Qr.dotProductWithUp=_e.vec3.dot(Gi,lr)}return Lr.sort((Qr,Fr)=>Qr.dotProductWithUp-Fr.dotProductWithUp),Lr[0].corners}(Et,wt),It=Et[Ot[0]],jt=Et[Ot[1]],Dt=Et[Ot[2]],Vt=Et[Ot[3]],_n=pt.getAtPointOrZero(new o(It[0]/$e.worldSize,It[1]/$e.worldSize),0),gn=pt.getAtPointOrZero(new o(jt[0]/$e.worldSize,jt[1]/$e.worldSize),0),Zn=pt.getAtPointOrZero(new o(Dt[0]/$e.worldSize,Dt[1]/$e.worldSize),0),Cn=pt.getAtPointOrZero(new o(Vt[0]/$e.worldSize,Vt[1]/$e.worldSize),0),Ln=(_n+Cn)/2,bn=(gn+Zn)/2;return Ln>bn?gn<Zn?SS(We,jt,Vt,It,gn,Cn,_n,wt):SS(We,Dt,It,Vt,Zn,_n,Cn,wt):_n<Cn?SS(We,It,jt,Dt,_n,gn,Zn,wt):SS(We,Vt,Dt,jt,Cn,Zn,gn,wt),Math.max(Ln,bn)}(me,c,a.aabb,h,d);const Se=_e.mat4.fromQuat([],me),Me=_e.mat4.multiply([],Se,oe);_e.mat4.multiply(h,Q,Me)}else re=c.elevation.getAtPointOrZero(new o(O.x/X,O.y/X),0);re!==0&&(h[14]+=re)}}function zb(h,a,c=!1){h.uploaded||(h.gfxTexture=new S3(a,h.image,c?a.gl.R8:a.gl.RGBA8,{useMipmap:h.sampler.minFilter>=a.gl.NEAREST_MIPMAP_NEAREST}),h.uploaded=!0,h.image=null)}function pQ(h,a,c){h.indexBuffer=a.createIndexBuffer(h.indexArray,!1,!0),h.vertexBuffer=a.createVertexBuffer(h.vertexArray,oQ.members,!1,!0),h.normalArray&&(h.normalBuffer=a.createVertexBuffer(h.normalArray,hQ.members,!1,!0)),h.texcoordArray&&(h.texcoordBuffer=a.createVertexBuffer(h.texcoordArray,uQ.members,!1,!0)),h.colorArray&&(h.colorBuffer=a.createVertexBuffer(h.colorArray,(h.colorArray.bytesPerElement===12?lQ:cQ).members,!1,!0)),h.featureArray&&(h.pbrBuffer=a.createVertexBuffer(h.featureArray,dQ.members,!0)),h.segments=Da.simpleSegment(0,0,h.vertexArray.length,h.indexArray.length);const d=h.material;d.pbrMetallicRoughness.baseColorTexture&&zb(d.pbrMetallicRoughness.baseColorTexture,a),d.pbrMetallicRoughness.metallicRoughnessTexture&&zb(d.pbrMetallicRoughness.metallicRoughnessTexture,a),d.normalTexture&&zb(d.normalTexture,a),d.occlusionTexture&&zb(d.occlusionTexture,a,c),d.emissionTexture&&zb(d.emissionTexture,a)}function C3(h,a,c){if(h.meshes)for(const d of h.meshes)pQ(d,a,c);if(h.children)for(const d of h.children)C3(d,a,c)}function TS(h){if(h.meshes)for(const a of h.meshes)a.indexArray.destroy(),a.vertexArray.destroy(),a.colorArray&&a.colorArray.destroy(),a.normalArray&&a.normalArray.destroy(),a.texcoordArray&&a.texcoordArray.destroy(),a.featureArray&&a.featureArray.destroy();if(h.children)for(const a of h.children)TS(a)}function I3(h){if(h.meshes)for(const c of h.meshes)c.vertexBuffer&&(c.vertexBuffer.destroy(),c.indexBuffer.destroy(),c.normalBuffer&&c.normalBuffer.destroy(),c.texcoordBuffer&&c.texcoordBuffer.destroy(),c.colorBuffer&&c.colorBuffer.destroy(),c.pbrBuffer&&c.pbrBuffer.destroy(),c.segments.destroy(),c.material&&((a=c.material).pbrMetallicRoughness.baseColorTexture&&a.pbrMetallicRoughness.baseColorTexture.gfxTexture&&a.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),a.pbrMetallicRoughness.metallicRoughnessTexture&&a.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&a.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),a.normalTexture&&a.normalTexture.gfxTexture&&a.normalTexture.gfxTexture.destroy(),a.emissionTexture&&a.emissionTexture.gfxTexture&&a.emissionTexture.gfxTexture.destroy(),a.occlusionTexture&&a.occlusionTexture.gfxTexture&&a.occlusionTexture.gfxTexture.destroy()));var a;if(h.children)for(const c of h.children)I3(c)}class Jv{constructor(a,c,d){this._demTile=a,this._dem=this._demTile.dem,this._scale=c,this._offset=d}static create(a,c,d){const g=d||a.findDEMTileFor(c);if(!g||!g.dem)return;const m=g.dem,v=g.tileID,E=1<<c.canonical.z-v.canonical.z;return new Jv(g,m.dim/On/E,[(c.canonical.x/E-v.canonical.x)*m.dim,(c.canonical.y/E-v.canonical.y)*m.dim])}tileCoordToPixel(a,c){const d=c*this._scale+this._offset[1],g=Math.floor(a*this._scale+this._offset[0]),m=Math.floor(d);return new Ut(g,m)}getElevationAt(a,c,d,g){const m=a*this._scale+this._offset[0],v=c*this._scale+this._offset[1],E=Math.floor(m),P=Math.floor(v),L=this._dem;return g=!!g,d?dr(dr(L.get(E,P,g),L.get(E,P+1,g),v-P),dr(L.get(E+1,P,g),L.get(E+1,P+1,g),v-P),m-E):L.get(E,P,g)}getElevationAtPixel(a,c,d){return this._dem.get(a,c,!!d)}getMeterToDEM(a){return(1<<this._demTile.tileID.canonical.z)*Uo(1,a)*this._dem.stride}}const P3=new Float32Array(262144),v_=new Uint8Array(262144);function Tz(h){let a=0;if(h.meshes)for(const c of h.meshes)a=Math.max(a,c.aabb.max[2]);if(h.children)for(const c of h.children)a=Math.max(a,Tz(c));return a}function Ez(h,a,c){if(h.meshes)for(const d of h.meshes){if(d.aabb.min[0]===1/0)continue;const g=tr.applyTransform(d.aabb,h.matrix);c.insert(a,g.min[0],g.min[1],g.max[0],g.max[1])}if(h.children)for(const d of h.children)Ez(d,a,c)}const Mz=["","wall","door","roof","window","lamp","logo"];class Cz{constructor(a){this.node=a,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:a.id,geometry:[],properties:{height:Tz(a)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new tr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let a=0;const c=new tr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const d of this.node.meshes)this.node.lightMeshIndex!==a&&(d.transformedAabb=tr.applyTransformFast(d.aabb,this.node.matrix),c.encapsulate(d.transformedAabb)),a++;this.aabb=c}return this.aabb}}class ES{constructor(a,c,d,g,m,v,E){this.id=d,this.layers=a,this.layerIds=this.layers.map(P=>P.fqid),this.stateDependentLayerIds=this.layers.filter(P=>P.isStateDependent()).map(P=>P.id),this.modelTraits|=Zv.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,g&&(this.modelTraits|=Zv.HasMapboxMeshFeatures),m&&(this.modelTraits|=Zv.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=v,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const P of c)this.nodesInfo.push(new Cz(P)),Ez(P,E.featureIndexArray.length,E.grid),E.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,E.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(a,c){for(const d of this.getNodesInfo()){const g=d.node;g.footprint&&c.push({footprint:g.footprint,id:a})}}update(a){const c=Object.keys(a).length!==0;if(c&&!this.stateDependentLayers.length)return;const d=c?this.stateDependentLayers:this.layers;if(!cn(a,this.states))for(const g of d)this.evaluate(g,a);this.states=structuredClone(a)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(a){if(!this.needsUpload)return;const c=this.getNodesInfo();for(const d of c){const g=d.node;this.uploaded?this.updatePbrBuffer(g):C3(g,a,!0)}for(const d of c)TS(d.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(a){let c=!1;if(!a.meshes)return c;for(const d of a.meshes)d.pbrBuffer&&(d.pbrBuffer.updateData(d.featureArray),c=!0);return c}needsReEvaluation(a,c,d){const g=a.transform.projectionOptions,m=a.style.getBrightness(),v=this.brightness!==m;if(!this.uploaded||this.dirty||g.name!==this.projection.name||Bb(d.paint.get("model-color").value,v)||Bb(d.paint.get("model-color-mix-intensity").value,v)||Bb(d.paint.get("model-roughness").value,v)||Bb(d.paint.get("model-emissive-strength").value,v)||Bb(d.paint.get("model-height-based-emissive-strength-multiplier").value,v)){this.projection=g,this.brightness=m;const E=this.getNodesInfo();for(const P of E)P.state=null;return!0}return!1}evaluateScale(a,c){if(a.transform.zoom===this.zoom)return;this.zoom=a.transform.zoom;const d=this.getNodesInfo(),g=this.id.canonical;for(const m of d){const v=m.feature;m.evaluatedScale=c.paint.get("model-scale").evaluate(v,{},g)}}evaluate(a,c){const d=this.getNodesInfo();for(const g of d){if(!g.node.meshes)continue;const m=g.feature,v=c&&c[m.id];if(cn(v,g.state))continue;g.state=structuredClone(v);const E=g.node.meshes&&g.node.meshes[0].featureData,P=g.evaluatedColor[2],L=g.evaluatedRMEA[2],A=this.id.canonical;if(g.hasTranslucentParts=!1,E){for(let O=0;O<Mz.length;O++){const N=Mz[O];N.length&&(m.properties.part=N);const D=a.paint.get("model-color").evaluate(m,v,A).toRenderColor(null),k=a.paint.get("model-color-mix-intensity").evaluate(m,v,A);g.evaluatedColor[O]=[D.r,D.g,D.b,k],g.evaluatedRMEA[O][0]=a.paint.get("model-roughness").evaluate(m,v,A),g.evaluatedRMEA[O][2]=a.paint.get("model-emissive-strength").evaluate(m,v,A),g.evaluatedRMEA[O][3]=D.a,g.emissionHeightBasedParams[O]=a.paint.get("model-height-based-emissive-strength-multiplier").evaluate(m,v,A),!g.hasTranslucentParts&&D.a<1&&(g.hasTranslucentParts=!0)}delete m.properties.part,gQ(g,P!==g.evaluatedColor[2]||L!==g.evaluatedRMEA[2],this.modelTraits)}else g.evaluatedRMEA[0][2]=a.paint.get("model-emissive-strength").evaluate(m,v,A);g.evaluatedScale=a.paint.get("model-scale").evaluate(m,v,A),this.updatePbrBuffer(g.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(a,c,d,g){const m=a.findDEMTileFor(d);if(m&&(m.tileID.canonical!==this.terrainTile||c!==this.terrainExaggeration)){if(m.dem&&m.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=m.tileID.overscaledZ;const v=Jv.create(a,d,m);if(!v)return;this.modelTraits&Zv.HasMapboxMeshFeatures&&this.updateDEM(a,v,d,g);for(const E of this.getNodesInfo()){const P=E.node;if(!P.footprint||!P.footprint.vertices||!P.footprint.vertices.length)continue;const L=P.footprint.vertices;let A=v.getElevationAt(L[0].x,L[0].y,!0,!0);for(let O=1;O<L.length;O++)A=Math.min(A,v.getElevationAt(L[O].x,L[O].y,!0,!0));P.elevation=A}}this.terrainTile=m.tileID.canonical,this.terrainExaggeration=c}}updateDEM(a,c,d,g){let m=c._dem._modifiedForSources[g];if(m===void 0&&(c._dem._modifiedForSources[g]=[],m=c._dem._modifiedForSources[g]),m.includes(d.canonical))return;const v=c._dem.dim;m.push(d.canonical);let E=!1;for(const P of this.getNodesInfo()){const L=P.node;if(!L.footprint||!L.footprint.grid)continue;const A=L.footprint.grid,O=c.tileCoordToPixel(A.min.x,A.min.y),N=c.tileCoordToPixel(A.max.x,A.max.y),D=Math.min(Math.min(v-N.y,O.x),Math.min(O.y,v-N.x));if(D<0)continue;const k=Un(D,2,5);let U=Math.max(0,O.x-k),X=Math.max(0,O.y-k),Q=Math.min(N.x+k,v-1),le=Math.min(N.y+k,v-1);for(let Se=X;Se<=le;++Se)for(let Me=U;Me<=Q;++Me)v_[Se*v+Me]=255;let oe=0,re=0;for(let Se=0;Se<A.cellsY;++Se)for(let Me=0;Me<A.cellsX;++Me){if(!A.cells[Se*A.cellsX+Me])continue;const We=c.tileCoordToPixel(A.min.x+Me/A.xScale,A.min.y+Se/A.yScale),$e=c.tileCoordToPixel(A.min.x+(Me+1)/A.xScale,A.min.y+(Se+1)/A.yScale);for(let He=We.y;He<=Math.min($e.y+1,v-1);++He)for(let ht=We.x;ht<=Math.min($e.x+1,v-1);++ht)v_[He*v+ht]===255&&(v_[He*v+ht]=0,oe+=c.getElevationAtPixel(ht,He),re++)}const me=oe/re;U=Math.max(1,O.x-k),X=Math.max(1,O.y-k),Q=Math.min(N.x+k,v-2),le=Math.min(N.y+k,v-2),E=!0;for(let Se=X;Se<=le;++Se)for(let Me=U;Me<=Q;++Me)v_[Se*v+Me]===0&&(P3[Se*v+Me]=c._dem.set(Me,Se,me));for(let Se=1;Se<k;++Se){U=Math.max(1,O.x-Se),X=Math.max(1,O.y-Se),Q=Math.min(N.x+Se,v-2),le=Math.min(N.y+Se,v-2);for(let Me=X;Me<=le;++Me)for(let We=U;We<=Q;++We){const $e=Me*v+We;if(v_[$e]===255){let He=0,ht=0,Ke=-1,pt=-1;for(let Et=-1;Et<=1;++Et)for(let wt=-1;wt<=1;++wt){const Ot=(Me+Et)*v+We+wt;if(v_[Ot]>=Se)continue;const It=P3[Ot],jt=Math.abs(It);jt>ht&&(He=It,ht=jt,Ke=wt,pt=Et)}if(ht>.1){const Et=1-(Se+.5*Math.abs(Ke*pt))/k;let wt=c._dem.get(We,Me)+He*Et;const Ot=c._dem.get(We+Ke,Me+pt),It=c._dem.get(We-Ke,Me-pt,!0);(wt-Ot)*(wt-It)>0&&(wt=(Ot+It)/2),P3[$e]=c._dem.set(We,Me,wt),v_[$e]=Se}}}}}E&&(c._demTile.needsDEMTextureUpload=!0,c._dem._timestamp=$t.now())}setFilter(a){this.filter=a?lf(a):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(a=>this.filter.filter(new bi(this.id.overscaledZ),a.feature,this.id.canonical)):this.nodesInfo}destroy(){const a=this.getNodesInfo();for(const c of a)TS(c.node),I3(c.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(a,c){if(c.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=c.updateTime;const d=c.getReplacementRegionsForTile(a.toUnwrapped()),g=this.getNodesInfo();for(let m=0;m<this.nodesInfo.length;m++){const v=g[m].node;g[m].hiddenByReplacement=!!v.footprint&&!d.find(E=>E.footprint===v.footprint)}}getHeightAtTileCoord(a,c){const d=this.getNodesInfo(),g=[],m=[0,0,0],v=_e.mat4.identity([]);for(let E=0;E<this.nodesInfo.length;E++){const P=d[E],L=P.node.meshes[0],A=L.transformedAabb;if(a<A.min[0]||c<A.min[1]||a>A.max[0]||c>A.max[1])continue;if(P.node.hidden===!0)return{height:1/0,maxHeight:P.feature.properties.height,hidden:!1,verticalScale:P.evaluatedScale[2]};_e.mat4.invert(v,P.node.matrix),m[0]=a,m[1]=c,_e.vec3.transformMat4(m,m,v);const O=(m[0]-L.aabb.min[0])/(L.aabb.max[0]-L.aabb.min[0])*__|0,N=Math.min(63,(m[1]-L.aabb.min[1])/(L.aabb.max[1]-L.aabb.min[1])*__|0)*__+Math.min(63,O),D=L.heightmap[N];if(!(D<0&&P.node.footprint))return P.hiddenByReplacement?void 0:{height:D,maxHeight:P.feature.properties.height,hidden:!1,verticalScale:P.evaluatedScale[2]};if(P.node.footprint.grid.query(new Ut(a,c),new Ut(a,c),g),g.length>0)return{height:void 0,maxHeight:P.feature.properties.height,hidden:P.hiddenByReplacement,verticalScale:P.evaluatedScale[2]}}}}function Bb(h,a){return!h.isLightConstant&&a}function mQ(h,a,c,d,g,m,v,E){let P=(61440&a|(61440&a)>>4)>>8,L=(3840&a|(3840&a)>>4)>>4,A=240&a|(240&a)>>4;c[3]>0&&(P=dr(P,255*c[0],c[3]),L=dr(L,255*c[1],c[3]),A=dr(A,255*c[2],c[3]));const O=P<<8|L,N=A<<8|Math.floor(255*d[3]),D=function(Se){const Me=Un(Se,0,2);return Math.min(Math.round(.5*Me*255),255)}(d[2])<<8|15*d[0]<<4|15*d[1],k=Un(g[0],0,1),U=Un(g[1],0,1),X=Un(g[2],0,1),Q=Un(g[3],0,1);let le,oe,re,me;if(k!==U&&v!==m&&U!==k){const Se=v-m;oe=1/(Se*(U-k)),re=-(m+Se*k)/(Se*(U-k));const Me=Un(g[4],-1,1);me=Math.pow(10,Me),le=255*X<<8|255*Q}else le=65535,oe=0,re=1,me=1;if(h.emplaceBack(O,N,D,le,oe,re,me),E){const Se=E.length;E.clear();for(let Me=0;Me<Se;Me++)E.emplaceBack(O,N,D,le,oe,re,me)}}function gQ(h,a,c){const d=h.node;let g=0;const m=c&Zv.HasMeshoptCompression;for(const v of d.meshes){if(d.lights&&d.lightMeshIndex===g||!v.featureData)continue;v.featureArray=new qp,v.featureArray.reserve(v.featureData.length);let E=a;for(const P of v.featureData){const L=m?65535&P:P>>16&65535,A=m?P>>16&65535:65535&P,O=(15&A)<8?15&A:0,N=h.evaluatedRMEA[O],D=h.evaluatedColor[O],k=h.emissionHeightBasedParams[O];let U;if(E&&O===2&&d.lights&&(U=new qp,U.resize(10*d.lights.length)),mQ(v.featureArray,L,D,N,k,v.aabb.min[2],v.aabb.max[2],U),U&&E){E=!1;const X=d.meshes[d.lightMeshIndex];X.featureArray=U,X.featureArray._trim()}}v.featureArray._trim(),g++}}function Iz(h,a,c,d){const g=1<<h.z;a.lat=xa((d/On+h.y)/g),a.lng=Mc((c/On+h.x)/g)}Mt(ES,"Tiled3dModelBucket",{omit:["layers"]}),Mt(Cz,"Tiled3dModelFeature");const yQ={circle:class extends eo{constructor(h,a,c,d){super(h,{layout:Lt||(Lt=new Ra({"circle-sort-key":new Fn(qt.layout_circle["circle-sort-key"]),"circle-elevation-reference":new En(qt.layout_circle["circle-elevation-reference"]),visibility:new En(qt.layout_circle.visibility)})),paint:an||(an=new Ra({"circle-radius":new Fn(qt.paint_circle["circle-radius"]),"circle-color":new Fn(qt.paint_circle["circle-color"]),"circle-blur":new Fn(qt.paint_circle["circle-blur"]),"circle-opacity":new Fn(qt.paint_circle["circle-opacity"]),"circle-translate":new En(qt.paint_circle["circle-translate"]),"circle-translate-anchor":new En(qt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new En(qt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new En(qt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Fn(qt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Fn(qt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Fn(qt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new En(qt.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Fn({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Fn({type:"string",default:"default","property-type":"data-driven"})}))},a,c,d)}createBucket(h){return new ce(h)}queryRadius(h){const a=h;return zt("circle-radius",this,a)+zt("circle-stroke-width",this,a)+tn(this.paint.get("circle-translate"))}queryIntersectsFeature(h,a,c,d,g,m,v,E){const P=Tn(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,h.pixelToTileUnitsFactor),L=this.paint.get("circle-radius").evaluate(a,c)+this.paint.get("circle-stroke-width").evaluate(a,c);return Yp(h,d,m,v,E,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",P,L)}getProgramIds(){return["circle"]}getDefaultProgramParams(h,a,c){const d=op(this);return{config:new Kc(this,{zoom:a,lut:c}),defines:d,overrideFog:!1}}},heatmap:class extends eo{createBucket(h){return new Tv(h)}constructor(h,a,c,d){super(h,{layout:Vm||(Vm=new Ra({visibility:new En(qt.layout_heatmap.visibility)})),paint:G1||(G1=new Ra({"heatmap-radius":new Fn(qt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Fn(qt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new En(qt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Wa(qt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new En(qt.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Fn({type:"string",default:"default","property-type":"data-driven"})}))},a,c,d),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(h){h==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Bg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(h){return zt("heatmap-radius",this,h)}queryIntersectsFeature(h,a,c,d,g,m,v,E){const P=this.paint.get("heatmap-radius").evaluate(a,c);return Yp(h,d,m,v,E,!0,!0,new Ut(0,0),P)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(h,a,c){return h==="heatmap"?{config:new Kc(this,{zoom:a,lut:c}),overrideFog:!1}:{}}},hillshade:class extends eo{constructor(h,a,c,d){super(h,{layout:W1||(W1=new Ra({visibility:new En(qt.layout_hillshade.visibility)})),paint:K1||(K1=new Ra({"hillshade-illumination-direction":new En(qt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new En(qt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new En(qt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new En(qt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new En(qt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new En(qt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new En(qt.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Fn({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Fn({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Fn({type:"string",default:"default","property-type":"data-driven"})}))},a,c,d)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(h,a,c){return{overrideFog:!1}}},fill:class extends eo{constructor(h,a,c,d){super(h,{layout:rb||(rb=new Ra({"fill-sort-key":new Fn(qt.layout_fill["fill-sort-key"]),visibility:new En(qt.layout_fill.visibility),"fill-elevation-reference":new En(qt.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Fn(qt.layout_fill["fill-construct-bridge-guard-rail"])})),paint:ib||(ib=new Ra({"fill-antialias":new En(qt.paint_fill["fill-antialias"]),"fill-opacity":new Fn(qt.paint_fill["fill-opacity"]),"fill-color":new Fn(qt.paint_fill["fill-color"]),"fill-outline-color":new Fn(qt.paint_fill["fill-outline-color"]),"fill-translate":new En(qt.paint_fill["fill-translate"]),"fill-translate-anchor":new En(qt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Fn(qt.paint_fill["fill-pattern"]),"fill-emissive-strength":new En(qt.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Fn(qt.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Fn(qt.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Fn(qt.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Fn({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Fn({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Fn({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Fn({type:"string",default:"default","property-type":"data-driven"})}))},a,c,d)}getProgramIds(){const h=this.paint.get("fill-pattern"),a=h&&h.constantOr(1),c=[a?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&c.push(a&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),c}getDefaultProgramParams(h,a,c){return{config:new Kc(this,{zoom:a,lut:c}),overrideFog:!1}}recalculate(h,a){super.recalculate(h,a);const c=this.paint._values["fill-outline-color"];c.value.kind==="constant"&&c.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(h){return new Hg(h)}queryRadius(){return tn(this.paint.get("fill-translate"))}queryIntersectsFeature(h,a,c,d,g,m){return!h.queryGeometry.isAboveHorizon&&Ce(un(h.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,h.pixelToTileUnitsFactor),d)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(h){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const a=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return h!=null?a&&!h:a}},"fill-extrusion":class extends eo{constructor(h,a,c,d){super(h,{layout:Vv||(Vv=new Ra({visibility:new En(qt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new En(qt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:vb||(vb=new Ra({"fill-extrusion-opacity":new En(qt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Fn(qt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new En(qt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new En(qt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Fn(qt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Fn(qt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Fn(qt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new En(qt["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new En(qt["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new En(qt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new En(qt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new En(qt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new En(qt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new En(qt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new En(qt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new En(qt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new En(qt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Fn(qt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Fn(qt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new En(qt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new En(qt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new En(qt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new En(qt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Fn(qt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Fn(qt["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new En(qt["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Fn({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Fn({type:"string",default:"default","property-type":"data-driven"})}))},a,c,d),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(h){return new Fv(h)}queryRadius(){return tn(this.paint.get("fill-extrusion-translate"))}is3D(h){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(h,a,c,d,g,m,v,E,P){const L=Tn(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,h.pixelToTileUnitsFactor),A=this.paint.get("fill-extrusion-height").evaluate(a,c),O=this.paint.get("fill-extrusion-base").evaluate(a,c),N=[0,0],D=E&&m.elevation,k=m.elevation?m.elevation.exaggeration():1,U=h.tile.getBucket(this);if(D&&U instanceof Fv){const re=U.centroidVertexArray,me=P+1;me<re.length&&(N[0]=re.geta_centroid_pos0(me),N[1]=re.geta_centroid_pos1(me))}if(N[0]===0&&N[1]===1)return!1;m.projection.name==="globe"&&(d=_b([d],[new Ut(0,0),new Ut(On,On)],h.tileID.canonical).map(re=>re.polygon).flat());const X=D?E:null,[Q,le]=function(re,me,Se,Me,We,$e,He,ht,Ke,pt,Et){return re.projection.name==="globe"?function(wt,Ot,It,jt,Dt,Vt,_n,gn,Zn,Cn,Ln){const bn=[],_r=[],Kn=wt.projection.upVectorScale(Ln,wt.center.lat,wt.worldSize).metersToTile,lr=[0,0,0,1],Lr=[0,0,0,1],Qr=(ui,Jr,xi,Gi)=>{ui[0]=Jr,ui[1]=xi,ui[2]=Gi,ui[3]=1},Fr=yb();It>0&&(It+=Fr),jt+=Fr;for(const ui of Ot){const Jr=[],xi=[];for(const Gi of ui){const Ca=Gi.x+Dt.x,zr=Gi.y+Dt.y,Ii=wt.projection.projectTilePoint(Ca,zr,Ln),Ya=wt.projection.upVector(Ln,Gi.x,Gi.y);let ss=It,ms=jt;if(_n){const Is=eS(Ca,zr,It,jt,_n,gn,Zn,Cn);ss+=Is.base,ms+=Is.top}It!==0?Qr(lr,Ii.x+Ya[0]*Kn*ss,Ii.y+Ya[1]*Kn*ss,Ii.z+Ya[2]*Kn*ss):Qr(lr,Ii.x,Ii.y,Ii.z),Qr(Lr,Ii.x+Ya[0]*Kn*ms,Ii.y+Ya[1]*Kn*ms,Ii.z+Ya[2]*Kn*ms),_e.vec3.transformMat4(lr,lr,Vt),_e.vec3.transformMat4(Lr,Lr,Vt),Jr.push(new Ic(lr[0],lr[1],lr[2])),xi.push(new Ic(Lr[0],Lr[1],Lr[2]))}bn.push(Jr),_r.push(xi)}return[bn,_r]}(re,me,Se,Me,We,$e,He,ht,Ke,pt,Et):He?function(wt,Ot,It,jt,Dt,Vt,_n,gn,Zn){const Cn=[],Ln=[],bn=[0,0,0,1];for(const _r of wt){const Kn=[],lr=[];for(const Lr of _r){const Qr=Lr.x+jt.x,Fr=Lr.y+jt.y,ui=eS(Qr,Fr,Ot,It,Vt,_n,gn,Zn);bn[0]=Qr,bn[1]=Fr,bn[2]=ui.base,bn[3]=1,_e.vec4.transformMat4(bn,bn,Dt),bn[3]=Math.max(bn[3],1e-5);const Jr=new Ic(bn[0]/bn[3],bn[1]/bn[3],bn[2]/bn[3]);bn[0]=Qr,bn[1]=Fr,bn[2]=ui.top,bn[3]=1,_e.vec4.transformMat4(bn,bn,Dt),bn[3]=Math.max(bn[3],1e-5);const xi=new Ic(bn[0]/bn[3],bn[1]/bn[3],bn[2]/bn[3]);Kn.push(Jr),lr.push(xi)}Cn.push(Kn),Ln.push(lr)}return[Cn,Ln]}(me,Se,Me,We,$e,He,ht,Ke,pt):function(wt,Ot,It,jt,Dt){const Vt=[],_n=[],gn=Dt[8]*Ot,Zn=Dt[9]*Ot,Cn=Dt[10]*Ot,Ln=Dt[11]*Ot,bn=Dt[8]*It,_r=Dt[9]*It,Kn=Dt[10]*It,lr=Dt[11]*It;for(const Lr of wt){const Qr=[],Fr=[];for(const ui of Lr){const Jr=ui.x+jt.x,xi=ui.y+jt.y,Gi=Dt[0]*Jr+Dt[4]*xi+Dt[12],Ca=Dt[1]*Jr+Dt[5]*xi+Dt[13],zr=Dt[2]*Jr+Dt[6]*xi+Dt[14],Ii=Dt[3]*Jr+Dt[7]*xi+Dt[15],Ya=Gi+gn,ss=Ca+Zn,ms=zr+Cn,Is=Math.max(Ii+Ln,1e-5),Sa=Gi+bn,sl=Ca+_r,Au=zr+Kn,yo=Math.max(Ii+lr,1e-5);Qr.push(new Ic(Ya/Is,ss/Is,ms/Is)),Fr.push(new Ic(Sa/yo,sl/yo,Au/yo))}Vt.push(Qr),_n.push(Fr)}return[Vt,_n]}(me,Se,Me,We,$e)}(m,d,O,A,L,v,X,N,k,m.center.lat,h.tileID.canonical),oe=h.queryGeometry;return function(re,me,Se){let Me=1/0;Ce(Se,me)&&(Me=Q2(Se,me[0]));for(let We=0;We<me.length;We++){const $e=me[We],He=re[We];for(let ht=0;ht<$e.length-1;ht++){const Ke=$e[ht],pt=[Ke,$e[ht+1],He[ht+1],He[ht],Ke];Te(Se,pt)&&(Me=Math.min(Me,Q2(Se,pt)))}}return Me!==1/0&&Me}(Q,le,oe.isPointQuery()?oe.screenBounds:oe.screenGeometry)}},line:class extends eo{constructor(h,a,c,d){const g=Cb();super(h,g,a,c,d),g.layout&&(this.layout=new xc(g.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(h){if(h==="line-gradient"){const a=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=a._styleExpression&&a._styleExpression.expression instanceof Xl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(h,a){super.recalculate(h,a),this.paint._values["line-floorwidth"]=(()=>{if(Ym)return Ym;const c=Cb();return Ym=new m_(c.paint.properties["line-width"].specification),Ym.useIntegerZoom=!0,Ym})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,h)}createBucket(h){return new Od(h)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(h,a,c){const d=rS(this);return{config:new Kc(this,{zoom:a,lut:c}),defines:d,overrideFog:!1}}queryRadius(h){const a=h,c=g_(zt("line-width",this,a),zt("line-gap-width",this,a)),d=zt("line-offset",this,a);return c/2+Math.abs(d)+tn(this.paint.get("line-translate"))}queryIntersectsFeature(h,a,c,d,g,m){if(h.queryGeometry.isAboveHorizon)return!1;const v=un(h.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,h.pixelToTileUnitsFactor),E=h.pixelToTileUnitsFactor/2*g_(this.paint.get("line-width").evaluate(a,c),this.paint.get("line-gap-width").evaluate(a,c)),P=this.paint.get("line-offset").evaluate(a,c);return P&&(d=function(L,A){const O=[],N=new Ut(0,0);for(let D=0;D<L.length;D++){const k=L[D],U=[];for(let X=0;X<k.length;X++){const Q=k[X],le=k[X+1],oe=X===0?N:Q.sub(k[X-1])._unit()._perp(),re=X===k.length-1?N:le.sub(Q)._unit()._perp(),me=oe._add(re)._unit();me._mult(1/(me.x*re.x+me.y*re.y)),U.push(me._mult(A)._add(Q))}O.push(U)}return O}(d,P*h.pixelToTileUnitsFactor)),function(L,A,O){for(let N=0;N<A.length;N++){const D=A[N];if(L.length>=3){for(let k=0;k<D.length;k++)if(rt(L,D[k]))return!0}if(Pe(L,D,O))return!0}return!1}(v,d,E)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(h){return!this.hasElevatedBuckets}},symbol:_S,background:class extends eo{constructor(h,a,c,d){super(h,{layout:ez||(ez=new Ra({visibility:new En(qt.layout_background.visibility)})),paint:tz||(tz=new Ra({"background-pitch-alignment":new En(qt.paint_background["background-pitch-alignment"]),"background-color":new En(qt.paint_background["background-color"]),"background-pattern":new En(qt.paint_background["background-pattern"]),"background-opacity":new En(qt.paint_background["background-opacity"]),"background-emissive-strength":new En(qt.paint_background["background-emissive-strength"]),"background-color-use-theme":new Fn({type:"string",default:"default","property-type":"data-driven"})}))},a,c,d)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(h,a,c){return{overrideFog:!1}}is3D(h){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:sz,"raster-particle":fz,sky:class extends eo{constructor(h,a,c,d){super(h,{layout:cz||(cz=new Ra({visibility:new En(qt.layout_sky.visibility)})),paint:uz||(uz=new Ra({"sky-type":new En(qt.paint_sky["sky-type"]),"sky-atmosphere-sun":new En(qt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new En(qt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new En(qt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new En(qt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Wa(qt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new En(qt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new En(qt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new En(qt.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Fn({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Fn({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Fn({type:"string",default:"default","property-type":"data-driven"})}))},a,c,d),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(h){h==="sky-gradient"?this._updateColorRamp():h!=="sky-atmosphere-sun"&&h!=="sky-atmosphere-halo-color"&&h!=="sky-atmosphere-color"&&h!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Bg({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(h){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const a=h.style.light.properties.get("position");return this._lightPosition.azimuthal!==a.azimuthal||this._lightPosition.polar!==a.polar}return!1}getCenter(h,a){if(this.paint.get("sky-type")==="atmosphere"){const d=this.paint.get("sky-atmosphere-sun"),g=!d,m=h.style.light,v=m.properties.get("position");return g&&m.properties.get("anchor")==="viewport"&&ti("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),g?A3(v.azimuthal,90-v.polar,a):A3(d[0],90-d[1],a)}const c=this.paint.get("sky-gradient-center");return A3(c[0],90-c[1],a)}isSky(){return!0}markSkyboxValid(h){this._skyboxInvalidated=!1,this._lightPosition=h.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const h=this.paint.get("sky-type");return h==="atmosphere"?["skyboxCapture","skybox"]:h==="gradient"?["skyboxGradient"]:null}},slot:class extends eo{constructor(h,a,c,d){super(h,{paint:hz||(hz=new Ra({}))},a,null)}},model:class extends eo{constructor(h,a,c,d){super(h,{layout:wz||(wz=new Ra({visibility:new En(qt.layout_model.visibility),"model-id":new Fn(qt.layout_model["model-id"])})),paint:Sz||(Sz=new Ra({"model-opacity":new Fn(qt.paint_model["model-opacity"]),"model-rotation":new Fn(qt.paint_model["model-rotation"]),"model-scale":new Fn(qt.paint_model["model-scale"]),"model-translation":new Fn(qt.paint_model["model-translation"]),"model-color":new Fn(qt.paint_model["model-color"]),"model-color-mix-intensity":new Fn(qt.paint_model["model-color-mix-intensity"]),"model-type":new En(qt.paint_model["model-type"]),"model-cast-shadows":new En(qt.paint_model["model-cast-shadows"]),"model-receive-shadows":new En(qt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new En(qt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Fn(qt.paint_model["model-emissive-strength"]),"model-roughness":new Fn(qt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Fn(qt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new En(qt.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new En(qt.paint_model["model-front-cutoff"]),"model-color-use-theme":new Fn({type:"string",default:"default","property-type":"data-driven"})}))},a,c,d),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(h){return new M3(h)}getProgramIds(){return["model"]}is3D(h){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(h){return h instanceof ES?On-1:0}queryIntersectsFeature(h,a,c,d,g,m){if(!this.modelManager)return!1;const v=this.modelManager,E=h.tile.getBucket(this);if(!(E&&E instanceof M3))return!1;for(const P in E.instancesPerModel){const L=E.instancesPerModel[P],A=a.id!==void 0?a.id:a.properties&&a.properties.hasOwnProperty("id")?a.properties.id:void 0;if(L.idToFeaturesIndex.hasOwnProperty(A)){const O=L.features[L.idToFeaturesIndex[A]],N=v.getModel(P,this.scope);if(!N)return!1;let D=_e.mat4.create();const k=new zi(0,0),U=E.canonical;let X=Number.MAX_VALUE;for(let Q=0;Q<O.instancedDataCount;++Q){const le=16*(O.instancedDataOffset+Q),oe=L.instancedDataArray.float32,re=[oe[le+4],oe[le+5],oe[le+6]];Iz(U,k,oe[le],0|oe[le+1]),Az(D,N,m,k,O.rotation,O.scale,re,!1,!1,!1),m.projection.name==="globe"&&(D=E3(D,m));const me=_e.mat4.multiply([],m.projMatrix,D),Se=h.queryGeometry,Me=yz(Se.isPointQuery()?Se.screenBounds:Se.screenGeometry,m,me,N.aabb);Me!=null&&(X=Math.min(Me,X))}return X!==Number.MAX_VALUE&&X}}return!1}_handleOverridablePaintPropertyUpdate(h,a,c){return!(!this.layout||a.isDataDriven()||c.isDataDriven()||h!=="model-color"&&h!=="model-color-mix-intensity"&&h!=="model-rotation"&&h!=="model-scale"&&h!=="model-translation"&&h!=="model-emissive-strength")}_isPropertyZoomDependent(h){const a=this._transitionablePaint._values[h];return a!=null&&a.value!=null&&a.value.expression!=null&&a.value.expression instanceof de}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends eo{constructor(h,a,c,d){super(h,{layout:Nv||(Nv=new Ra({"clip-layer-types":new En(qt.layout_clip["clip-layer-types"]),"clip-layer-scope":new En(qt.layout_clip["clip-layer-scope"])})),paint:zv||(zv=new Ra({}))},a,c,d)}recalculate(h,a){super.recalculate(h,a)}createBucket(h){return new F2(h)}is3D(h){return!0}}};class _Q{constructor(a){this._callback=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class vQ{constructor(){this.tasks={},this.taskQueue=[],er(["process"],this),this.invoker=new _Q(this.process),this.nextId=0}add(a,c){const d=this.nextId++,g=function({type:m,isSymbolTile:v,zoom:E}){return E=E||0,m==="message"?0:m!=="maybePrepare"||v?m!=="parseTile"||v?m==="parseTile"&&v?300-E:m==="maybePrepare"&&v?400-E:500:200-E:100-E}(c);if(g===0){try{a()}finally{}return null}return this.tasks[d]={fn:a,metadata:c,priority:g,id:d},this.taskQueue.push(d),this.invoker.trigger(),{cancel:()=>{delete this.tasks[d]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(d=>!!this.tasks[d]),!this.taskQueue.length)return;const a=this.pick();if(a===null)return;const c=this.tasks[a];if(delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),!c)return;c.fn()}finally{}}pick(){let a=null,c=1/0;for(let g=0;g<this.taskQueue.length;g++){const m=this.tasks[this.taskQueue[g]];m.priority<c&&(c=m.priority,a=g)}if(a===null)return null;const d=this.taskQueue[a];return this.taskQueue.splice(a,1),d}remove(){this.invoker.remove()}}class Pz{constructor(a,c,d){this.target=a,this.parent=c,this.mapId=d,this.callbacks={},this.cancelCallbacks={},er(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new vQ}send(a,c,d,g,m=!1,v){const E=Math.round(1e18*Math.random()).toString(36).substring(0,10);d&&(d.metadata=v,this.callbacks[E]=d);const P=new Set;return this.target.postMessage({id:E,type:a,hasCallback:!!d,targetMapId:g,mustQueue:m,sourceMapId:this.mapId,data:wn(c,P)},P),{cancel:()=>{d&&delete this.callbacks[E],this.target.postMessage({id:E,type:"<cancel>",targetMapId:g,sourceMapId:this.mapId})}}}receive(a){const c=a.data;if(!c)return;const d=c.id;if(d&&(!c.targetMapId||this.mapId===c.targetMapId))if(c.type==="<cancel>"){const g=this.cancelCallbacks[d];delete this.cancelCallbacks[d],g&&g.cancel()}else if(c.mustQueue||Za()){const g=this.callbacks[d],m=this.scheduler.add(()=>this.processTask(d,c),g&&g.metadata||{type:"message"});m&&(this.cancelCallbacks[d]=m)}else this.processTask(d,c)}processTask(a,c){if(delete this.cancelCallbacks[a],c.type==="<response>"){const d=this.callbacks[a];delete this.callbacks[a],d&&(c.error?d(pn(c.error)):d(null,pn(c.data)))}else{const d=new Set,g=c.hasCallback?(v,E)=>{this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:v?wn(v):null,data:wn(E,d)},d)}:()=>{},m=pn(c.data);if(this.parent[c.type])this.parent[c.type](c.sourceMapId,m,g);else if(this.parent.getWorkerSource){const v=c.type.split(".");this.parent.getWorkerSource(c.sourceMapId,v[0],m.source,m.scope)[v[1]](m,g)}else g(new Error(`Could not find function ${c.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var jb={workerUrl:"",workerClass:null,workerParams:void 0};const O3="mapboxgl_preloaded_worker_pool";class b_{constructor(){this.active={}}acquire(a,c=b_.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<c;)this.workers.push(jb.workerClass!=null?new jb.workerClass:new self.Worker(jb.workerUrl,jb.workerParams));return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],this.workers&&this.numActive()===0&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[O3]}numActive(){return Object.keys(this.active).length}}b_.workerCount=2;class Qv{constructor(a,c,d="Worker",g=b_.workerCount){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=Xn();const m=this.workerPool.acquire(this.id,g);for(let v=0;v<m.length;v++){const E=new Qv.Actor(m[v],c,this.id);E.name=`${d} ${v}`,this.actors.push(E)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(a,c,d){Li(this.actors,(g,m)=>{g.send(a,c,m)},d=d||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(a=>{a.remove()}),this.actors=[],this.workerPool.release(this.id)}}let Fb,R3;function MS(){return Fb||(Fb=new b_),Fb}Qv.Actor=Pz;const D3=new Ei(0,0,0);var L3=(h=>(h[h.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",h[h.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",h[h.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",h))(L3||{}),CS=(h=>(h[h.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",h[h.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",h[h.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",h[h.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",h))(CS||{}),Ub=(h=>(h[h.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",h[h.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",h[h.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",h[h.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",h[h.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",h))(Ub||{}),Oz=(h=>(h[h.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",h[h.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",h[h.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",h))(Oz||{}),e0=(h=>(h[h.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",h[h.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",h[h.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",h[h.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",h[h.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",h[h.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",h))(e0||{}),Rz=(h=>(h[h.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",h[h.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",h[h.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",h))(Rz||{});function bQ(h,a,c){h===1&&a.icons.push(function(d,g){return function(m){if(m.usvg_tree.height||(m.usvg_tree.height=m.usvg_tree.width),!m.metadata)return m;const{metadata:v}=m;if(v.content_area){const{content_area:E}=v;E.top==null&&(E.top=E.left),E.width==null&&(E.width=m.usvg_tree.width),E.height==null&&(E.height=E.width)}return v.stretch_x&&v.stretch_x.length&&Dz(v,"x"),v.stretch_y&&v.stretch_y.length&&Dz(v,"y"),m}(d.readFields(xQ,{name:void 0},g))}(c,c.readVarint()+c.pos))}function Dz(h,a){const c=[],d=h[`stretch_${a}`];let g=null;for(let m=0;m<d.length;m++)g===null?g=c.length===0?d[0]:c[c.length-1][1]+d[m]:(c.push([g,g+d[m]]),g=null);h[`stretch_${a}_areas`]=c}function xQ(h,a,c){h===1?a.name=c.readString():h===2?a.metadata=function(d,g){return d.readFields(wQ,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},g)}(c,c.readVarint()+c.pos):h===3&&(a.usvg_tree=function(d,g){return d.readFields(TQ,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},g)}(c,c.readVarint()+c.pos),a.data="usvg_tree")}function wQ(h,a,c){h===1?a.stretch_x=c.readPackedVarint():h===2?a.stretch_y=c.readPackedVarint():h===3?a.content_area=function(d,g){return d.readFields(SQ,{left:0},g)}(c,c.readVarint()+c.pos):h===4&&a.variables.push(function(d,g){return d.readFields(AQ,{name:void 0},g)}(c,c.readVarint()+c.pos))}function SQ(h,a,c){h===1?a.left=c.readVarint():h===2?a.width=c.readVarint():h===3?a.top=c.readVarint():h===4&&(a.height=c.readVarint())}function AQ(h,a,c){h===1?a.name=c.readString():h===2&&(a.rgb_color=OS(c.readVarint()),a.value="rgb_color")}function TQ(h,a,c){h===1?a.width=a.height=c.readVarint():h===2?a.height=c.readVarint():h===3?a.children.push(IS(c,c.readVarint()+c.pos)):h===4?a.linear_gradients.push(function(d,g){return d.readFields(RQ,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},g)}(c,c.readVarint()+c.pos)):h===5?a.radial_gradients.push(function(d,g){return d.readFields(LQ,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},g)}(c,c.readVarint()+c.pos)):h===7?a.clip_paths.push(function(d,g){return d.readFields(kQ,{children:[]},g)}(c,c.readVarint()+c.pos)):h===8&&a.masks.push(function(d,g){const m=d.readFields(NQ,{left:0,width:20,mask_type:1,children:[]},g);return m.height==null&&(m.height=m.width),m.top==null&&(m.top=m.left),m}(c,c.readVarint()+c.pos))}function IS(h,a){return h.readFields(EQ,{},a)}function EQ(h,a,c){h===1?(a.group=function(d,g){return d.readFields(MQ,{opacity:255,children:[]},g)}(c,c.readVarint()+c.pos),a.node="group"):h===2&&(a.path=function(d,g){return d.readFields(IQ,{paint_order:1,commands:[],step:1,diffs:[],rule:1},g)}(c,c.readVarint()+c.pos),a.node="path")}function MQ(h,a,c){h===1?a.transform=PS(c,c.readVarint()+c.pos):h===2?a.opacity=c.readVarint():h===5?a.clip_path_idx=c.readVarint():h===6?a.mask_idx=c.readVarint():h===7&&a.children.push(IS(c,c.readVarint()+c.pos))}function PS(h,a){return h.readFields(CQ,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},a)}function CQ(h,a,c){h===1?a.sx=c.readFloat():h===2?a.ky=c.readFloat():h===3?a.kx=c.readFloat():h===4?a.sy=c.readFloat():h===5?a.tx=c.readFloat():h===6&&(a.ty=c.readFloat())}function IQ(h,a,c){h===1?a.fill=function(d,g){return d.readFields(PQ,{rgb_color:D3,paint:"rgb_color",opacity:255},g)}(c,c.readVarint()+c.pos):h===2?a.stroke=function(d,g){return d.readFields(OQ,{rgb_color:D3,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},g)}(c,c.readVarint()+c.pos):h===3?a.paint_order=c.readVarint():h===5?c.readPackedVarint(a.commands):h===6?a.step=c.readFloat():h===7?c.readPackedSVarint(a.diffs):h===8&&(a.rule=c.readVarint())}function PQ(h,a,c){h===1?(a.rgb_color=OS(c.readVarint()),a.paint="rgb_color"):h===2?(a.linear_gradient_idx=c.readVarint(),a.paint="linear_gradient_idx"):h===3?(a.radial_gradient_idx=c.readVarint(),a.paint="radial_gradient_idx"):h===5&&(a.opacity=c.readVarint())}function OS(h){return new Ei((h>>16&255)/255,(h>>8&255)/255,(255&h)/255,1)}function OQ(h,a,c){h===1?(a.rgb_color=OS(c.readVarint()),a.paint="rgb_color"):h===2?(a.linear_gradient_idx=c.readVarint(),a.paint="linear_gradient_idx"):h===3?(a.radial_gradient_idx=c.readVarint(),a.paint="radial_gradient_idx"):h===5?c.readPackedFloat(a.dasharray):h===6?a.dashoffset=c.readFloat():h===7?a.miterlimit=c.readFloat():h===8?a.opacity=c.readVarint():h===9?a.width=c.readFloat():h===10?a.linecap=c.readVarint():h===11&&(a.linejoin=c.readVarint())}function RQ(h,a,c){h===1?a.transform=PS(c,c.readVarint()+c.pos):h===2?a.spread_method=c.readVarint():h===3?a.stops.push(Lz(c,c.readVarint()+c.pos)):h===4?a.x1=c.readFloat():h===5?a.y1=c.readFloat():h===6?a.x2=c.readFloat():h===7&&(a.y2=c.readFloat())}function Lz(h,a){return h.readFields(DQ,{offset:0,opacity:255,rgb_color:D3},a)}function DQ(h,a,c){h===1?a.offset=c.readFloat():h===2?a.opacity=c.readVarint():h===3&&(a.rgb_color=OS(c.readVarint()))}function LQ(h,a,c){h===1?a.transform=PS(c,c.readVarint()+c.pos):h===2?a.spread_method=c.readVarint():h===3?a.stops.push(Lz(c,c.readVarint()+c.pos)):h===4?a.cx=c.readFloat():h===5?a.cy=c.readFloat():h===6?a.r=c.readFloat():h===7?a.fx=c.readFloat():h===8?a.fy=c.readFloat():h===9&&(a.fr=c.readFloat())}function kQ(h,a,c){h===1?a.transform=PS(c,c.readVarint()+c.pos):h===2?a.clip_path_idx=c.readVarint():h===3&&a.children.push(IS(c,c.readVarint()+c.pos))}function NQ(h,a,c){h===1?a.left=a.top=c.readFloat():h===2?a.width=a.height=c.readFloat():h===3?a.top=c.readFloat():h===4?a.height=c.readFloat():h===5?a.mask_type=c.readVarint():h===6?a.mask_idx=c.readVarint():h===7&&a.children.push(IS(c,c.readVarint()+c.pos))}class zQ{static calculate(a={},c=[]){const d=new Map,g=new Map;if(Object.keys(a).length===0)return d;c.forEach(m=>{g.set(m.name,m.rgb_color||new Ei(0,0,0))});for(const[m,v]of Object.entries(a))g.has(m)?d.set(g.get(m).toStringPremultipliedAlpha(),v):console.warn(`Ignoring unknown image variable "${m}"`);return d}}function t0(h,a=255,c){const d=a/255,g=h.toStringPremultipliedAlpha(),m=c.has(g)?c.get(g).clone():h.clone();return m.a*=d,m.toString()}function qb(h,a){if(!Gt()){const c=document.createElement("canvas");return c.width=h,c.height=a,c}return new OffscreenCanvas(h,a)}function BQ(h,a){const c=zQ.calculate(a.params,h.metadata?h.metadata.variables:[]),d=h.usvg_tree,g=d.width,m=d.height,v=a.transform?a.transform:new DOMMatrix,E=Math.max(1,Math.round(g*v.a)),P=Math.max(1,Math.round(m*v.d)),L=new DOMMatrix([E/g,0,0,P/m,0,0]),A=qb(E,P).getContext("2d");return k3(A,L,d,d,c),A.getImageData(0,0,E,P)}function k3(h,a,c,d,g){for(const m of d.children)kz(h,a,c,m,g)}function kz(h,a,c,d,g){d.group?(h.save(),function(m,v,E,P,L){const A=P.mask_idx!=null?E.masks[P.mask_idx]:null,O=P.clip_path_idx!=null?E.clip_paths[P.clip_path_idx]:null;if(P.transform&&(v=RS(P.transform).preMultiplySelf(v)),!function(k,U,X){return k.opacity!==255||U||X}(P,O!=null,A!=null))return void k3(m,v,E,P,L);const N=qb(m.canvas.width,m.canvas.height),D=N.getContext("2d");k3(D,v,E,P,L),O&&qz(D,v,E,O),A&&Vz(D,v,E,A,L),m.globalAlpha=P.opacity/255,m.drawImage(N,0,0)}(h,a,c,d.group,g),h.restore()):d.path&&(h.save(),function(m,v,E,P,L){const A=$z(P);m.setTransform(v),P.paint_order===Oz.PAINT_ORDER_FILL_AND_STROKE?(Nz(m,E,P,A,L),Bz(m,E,P,A,L)):(Bz(m,E,P,A,L),Nz(m,E,P,A,L))}(h,a,c,d.path,g),h.restore())}function Nz(h,a,c,d,g){const m=c.fill;if(!m)return;const v=m.opacity/255;switch(m.paint){case"rgb_color":h.fillStyle=t0(m.rgb_color,m.opacity,g);break;case"linear_gradient_idx":h.fillStyle=jz(h,a.linear_gradients[m.linear_gradient_idx],v,g);break;case"radial_gradient_idx":h.fillStyle=Fz(h,a.radial_gradients[m.radial_gradient_idx],v,g)}h.fill(d,zz(c))}function zz(h){return h.rule===L3.PATH_RULE_NON_ZERO?"nonzero":h.rule===L3.PATH_RULE_EVEN_ODD?"evenodd":void 0}function Bz(h,a,c,d,g){const m=c.stroke;if(!m)return;h.lineWidth=m.width,h.miterLimit=m.miterlimit,h.setLineDash(m.dasharray),h.lineDashOffset=m.dashoffset;const v=m.opacity/255;switch(m.paint){case"rgb_color":h.strokeStyle=t0(m.rgb_color,m.opacity,g);break;case"linear_gradient_idx":h.strokeStyle=jz(h,a.linear_gradients[m.linear_gradient_idx],v,g);break;case"radial_gradient_idx":h.strokeStyle=Fz(h,a.radial_gradients[m.radial_gradient_idx],v,g)}switch(m.linejoin){case Ub.LINE_JOIN_MITER_CLIP:case Ub.LINE_JOIN_MITER:h.lineJoin="miter";break;case Ub.LINE_JOIN_ROUND:h.lineJoin="round";break;case Ub.LINE_JOIN_BEVEL:h.lineJoin="bevel"}switch(m.linecap){case CS.LINE_CAP_BUTT:h.lineCap="butt";break;case CS.LINE_CAP_ROUND:h.lineCap="round";break;case CS.LINE_CAP_SQUARE:h.lineCap="square"}h.stroke(d)}function jz(h,a,c,d){if(a.stops.length===1){const N=a.stops[0];return t0(N.rgb_color,N.opacity*c,d)}const g=RS(a.transform),{x1:m,y1:v,x2:E,y2:P}=a,L=g.transformPoint(new DOMPoint(m,v)),A=g.transformPoint(new DOMPoint(E,P)),O=h.createLinearGradient(L.x,L.y,A.x,A.y);for(const N of a.stops)O.addColorStop(N.offset,t0(N.rgb_color,N.opacity*c,d));return O}function Fz(h,a,c,d){if(a.stops.length===1){const N=a.stops[0];return t0(N.rgb_color,N.opacity*c,d)}const g=RS(a.transform),{fx:m,fy:v,cx:E,cy:P}=a,L=g.transformPoint(new DOMPoint(m,v)),A=g.transformPoint(new DOMPoint(E,P)),O=h.createRadialGradient(L.x,L.y,0,A.x,A.y,a.r*((g.a+g.d)/2));for(const N of a.stops)O.addColorStop(N.offset,t0(N.rgb_color,N.opacity*c,d));return O}function Uz(h,a,c,d){const g=d.transform?RS(d.transform).preMultiplySelf(a):a,m=qb(h.canvas.width,h.canvas.height),v=m.getContext("2d");for(const P of d.children)if(P.group)Uz(v,g,c,P.group);else if(P.path){const L=P.path,A=new Path2D;A.addPath($z(L),g),v.fill(A,zz(L))}const E=d.clip_path_idx!=null?c.clip_paths[d.clip_path_idx]:null;E&&qz(v,g,c,E),h.globalCompositeOperation="source-over",h.drawImage(m,0,0)}function qz(h,a,c,d){const g=qb(h.canvas.width,h.canvas.height);Uz(g.getContext("2d"),a,c,d),h.globalCompositeOperation="destination-in",h.drawImage(g,0,0)}function Vz(h,a,c,d,g){if(d.children.length===0)return;const m=d.mask_idx!=null?c.masks[d.mask_idx]:null;m&&Vz(h,a,c,m,g);const v=h.canvas.width,E=h.canvas.height,P=qb(v,E),L=P.getContext("2d"),A=d.width,O=d.height,N=d.left,D=d.top,k=new Path2D,U=new Path2D;U.rect(N,D,A,O),k.addPath(U,a),L.clip(k);for(const le of d.children)kz(L,a,c,le,g);const X=L.getImageData(0,0,v,E),Q=X.data;if(d.mask_type===Rz.MASK_TYPE_LUMINANCE)for(let le=0;le<Q.length;le+=4)Q[le+3]=Q[le+3]/255*(.2126*Q[le]+.7152*Q[le+1]+.0722*Q[le+2]);L.putImageData(X,0,0),h.globalCompositeOperation="destination-in",h.drawImage(P,0,0)}function RS(h){return h?new DOMMatrix([h.sx,h.ky,h.kx,h.sy,h.tx,h.ty]):new DOMMatrix}function $z(h){const a=new Path2D,c=h.step;let d=h.diffs[0]*c,g=h.diffs[1]*c;a.moveTo(d,g);for(let m=0,v=2;m<h.commands.length;m++)switch(h.commands[m]){case e0.PATH_COMMAND_MOVE:d+=h.diffs[v++]*c,g+=h.diffs[v++]*c,a.moveTo(d,g);break;case e0.PATH_COMMAND_LINE:d+=h.diffs[v++]*c,g+=h.diffs[v++]*c,a.lineTo(d,g);break;case e0.PATH_COMMAND_QUAD:{const E=d+h.diffs[v++]*c,P=g+h.diffs[v++]*c;d=E+h.diffs[v++]*c,g=P+h.diffs[v++]*c,a.quadraticCurveTo(E,P,d,g);break}case e0.PATH_COMMAND_CUBIC:{const E=d+h.diffs[v++]*c,P=g+h.diffs[v++]*c,L=E+h.diffs[v++]*c,A=P+h.diffs[v++]*c;d=L+h.diffs[v++]*c,g=A+h.diffs[v++]*c,a.bezierCurveTo(E,P,L,A,d,g);break}case e0.PATH_COMMAND_CLOSE:a.closePath()}return a}class DS{constructor(a){this.capacity=a,this.cache=new Map}get(a){if(!this.cache.has(a))return;const c=this.cache.get(a);return this.cache.delete(a),this.cache.set(a,c),c}put(a,c){this.cache.has(a)?this.cache.delete(a):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(a,c)}delete(a){this.cache.delete(a)}}Mt(DS,"LRUCache");class N3{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(a){return new _l(a,a.data)}getFromCache(a,c,d){return this.cacheMap.has(d)||this.cacheMap.set(d,new DS(150)),this.cacheMap.get(d).get(Wu(a.toString(),c))}setInCache(a,c,d,g){this.cacheDependenciesMap.has(g)||this.cacheDependenciesMap.set(g,new Map),this.cacheMap.has(g)||this.cacheMap.set(g,new DS(150));const m=this.cacheDependenciesMap.get(g),v=Wu(a.id.toString(),d);m.get(v)||m.set(v,new Set);const E=this.cacheMap.get(g),P=a.toString();m.get(v).add(P),E.put(Wu(a.toString(),d),c)}removeImagesFromCacheByIds(a,c,d=0){if(!this.cacheMap.has(d)||!this.cacheDependenciesMap.has(d))return;const g=this.cacheMap.get(d),m=this.cacheDependenciesMap.get(d);for(const v of a){const E=Wu(v.toString(),c);if(m.has(E)){for(const P of m.get(E))g.delete(P);m.delete(E)}}}rasterize(a,c,d,g,m=BQ){const v=this.getFromCache(a,d,g);if(v)return v.clone();const E=m(c.icon,a.options),P=N3._getImage(E);return this.setInCache(a,P,d,g),P.clone()}}class Hz{constructor(a){this.size=a,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(a,c){const d=this.toIdx(a,c);return{min:this.minimums[d],max:this.maximums[d]}}isLeaf(a,c){return this.leaves[this.toIdx(a,c)]}toIdx(a,c){return c*this.size+a}}function Gz(h,a,c,d){let g=0,m=Number.MAX_VALUE;for(let v=0;v<3;v++)if(Math.abs(d[v])<1e-15){if(c[v]<h[v]||c[v]>a[v])return null}else{const E=1/d[v];let P=(h[v]-c[v])*E,L=(a[v]-c[v])*E;if(P>L){const A=P;P=L,L=A}if(P>g&&(g=P),L<m&&(m=L),g>m)return null}return g}function Wz(h,a,c,d,g,m,v,E,P,L,A){const O=d-h,N=g-a,D=m-c,k=v-h,U=E-a,X=P-c,Q=A[1]*X-A[2]*U,le=A[2]*k-A[0]*X,oe=A[0]*U-A[1]*k,re=O*Q+N*le+D*oe;if(Math.abs(re)<1e-15)return null;const me=1/re,Se=L[0]-h,Me=L[1]-a,We=L[2]-c,$e=(Se*Q+Me*le+We*oe)*me;if($e<0||$e>1)return null;const He=Me*D-We*N,ht=We*O-Se*D,Ke=Se*N-Me*O,pt=(A[0]*He+A[1]*ht+A[2]*Ke)*me;return pt<0||$e+pt>1?null:(k*He+U*ht+X*Ke)*me}function Kz(h,a,c){return(h-a)/(c-a)}function Yz(h,a,c,d,g,m,v,E,P){const L=1<<c,A=m-d,O=v-g,N=(h+1)/L*A+d,D=(a+0)/L*O+g,k=(a+1)/L*O+g;E[0]=(h+0)/L*A+d,E[1]=D,P[0]=N,P[1]=k}class Xz{constructor(a){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=a,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const c=function(m){const v=Math.ceil(Math.log2(m.dim/8)),E=[];let P=Math.ceil(Math.pow(2,v));const L=1/P,A=(D,k,U,X,Q)=>{const le=X?1:0,oe=(D+1)*U-le,re=k*U,me=(k+1)*U-le;Q[0]=D*U,Q[1]=re,Q[2]=oe,Q[3]=me};let O=new Hz(P);const N=[];for(let D=0;D<P*P;D++){A(D%P,Math.floor(D/P),L,!1,N);const k=ty(N[0],N[1],m),U=ty(N[2],N[1],m),X=ty(N[2],N[3],m),Q=ty(N[0],N[3],m);O.minimums.push(Math.min(k,U,X,Q)),O.maximums.push(Math.max(k,U,X,Q)),O.leaves.push(1)}for(E.push(O),P/=2;P>=1;P/=2){const D=E[E.length-1];O=new Hz(P);for(let k=0;k<P*P;k++){A(k%P,Math.floor(k/P),2,!0,N);const U=D.getElevation(N[0],N[1]),X=D.getElevation(N[2],N[1]),Q=D.getElevation(N[2],N[3]),le=D.getElevation(N[0],N[3]),oe=D.isLeaf(N[0],N[1]),re=D.isLeaf(N[2],N[1]),me=D.isLeaf(N[2],N[3]),Se=D.isLeaf(N[0],N[3]),Me=Math.min(U.min,X.min,Q.min,le.min),We=Math.max(U.max,X.max,Q.max,le.max),$e=oe&&re&&me&&Se;O.maximums.push(We),O.minimums.push(Me),O.leaves.push(We-Me<=5&&$e?1:0)}E.push(O)}return E}(this.dem),d=c.length-1,g=c[d];this._addNode(g.minimums[0],g.maximums[0],g.leaves[0]),this._construct(c,0,0,d,0)}raycastRoot(a,c,d,g,m,v,E=1){return Gz([a,c,-100],[d,g,this.maximums[0]*E],m,v)}raycast(a,c,d,g,m,v,E=1){if(!this.nodeCount)return null;const P=this.raycastRoot(a,c,d,g,m,v,E);if(P==null)return null;const L=[],A=[],O=[],N=[],D=[{idx:0,t:P,nodex:0,nodey:0,depth:0}];for(;D.length>0;){const{idx:k,t:U,nodex:X,nodey:Q,depth:le}=D.pop();if(this.leaves[k]){Yz(X,Q,le,a,c,d,g,O,N);const re=1<<le,me=(X+0)/re,Se=(X+1)/re,Me=(Q+0)/re,We=(Q+1)/re,$e=ty(me,Me,this.dem)*E,He=ty(Se,Me,this.dem)*E,ht=ty(Se,We,this.dem)*E,Ke=ty(me,We,this.dem)*E,pt=Wz(O[0],O[1],$e,N[0],O[1],He,N[0],N[1],ht,m,v),Et=Wz(N[0],N[1],ht,O[0],N[1],Ke,O[0],O[1],$e,m,v),wt=Math.min(pt!==null?pt:Number.MAX_VALUE,Et!==null?Et:Number.MAX_VALUE);if(wt!==Number.MAX_VALUE)return wt;{const Ot=_e.vec3.scaleAndAdd([],m,v,U);if(Zz($e,He,Ke,ht,Kz(Ot[0],O[0],N[0]),Kz(Ot[1],O[1],N[1]))>=Ot[2])return U}continue}let oe=0;for(let re=0;re<this._siblingOffset.length;re++){Yz((X<<1)+this._siblingOffset[re][0],(Q<<1)+this._siblingOffset[re][1],le+1,a,c,d,g,O,N),O[2]=-100,N[2]=this.maximums[this.childOffsets[k]+re]*E;const me=Gz(O,N,m,v);if(me!=null){const Se=me;L[re]=Se;let Me=!1;for(let We=0;We<oe&&!Me;We++)Se>=L[A[We]]&&(A.splice(We,0,re),Me=!0);Me||(A[oe]=re),oe++}}for(let re=0;re<oe;re++){const me=A[re];D.push({idx:this.childOffsets[k]+me,t:L[me],nodex:(X<<1)+this._siblingOffset[me][0],nodey:(Q<<1)+this._siblingOffset[me][1],depth:le+1})}}return null}_addNode(a,c,d){return this.minimums.push(a),this.maximums.push(c),this.leaves.push(d),this.childOffsets.push(0),this.nodeCount++}_construct(a,c,d,g,m){if(a[g].isLeaf(c,d)===1)return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const v=g-1,E=a[v];let P=0,L=0;for(let A=0;A<this._siblingOffset.length;A++){const O=2*c+this._siblingOffset[A][0],N=2*d+this._siblingOffset[A][1],D=E.getElevation(O,N),k=E.isLeaf(O,N),U=this._addNode(D.min,D.max,k);k&&(P|=1<<A),L||(L=U)}for(let A=0;A<this._siblingOffset.length;A++)P&1<<A||this._construct(a,2*c+this._siblingOffset[A][0],2*d+this._siblingOffset[A][1],v,L+A)}}function Zz(h,a,c,d,g,m){return dr(dr(h,c,m),dr(a,d,m),g)}function ty(h,a,c){const d=c.dim,g=Un(h*d-.5,0,d-1),m=Un(a*d-.5,0,d-1),v=Math.floor(g),E=Math.floor(m),P=Math.min(v+1,d-1),L=Math.min(E+1,d-1);return Zz(c.get(v,E),c.get(P,E),c.get(v,L),c.get(P,L),g-v,m-E)}const jQ={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function FQ(h,a,c){return(256*h*256+256*a+c)/10-1e4}function UQ(h,a,c){return 256*h+a+c/256-32768}class LS{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(a,c,d,g=!1){if(this.uid=a,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(d&&d!=="mapbox"&&d!=="terrarium")return void ti(`"${d}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=c.height;const m=this.dim=c.height-2,v=new Uint32Array(c.data.buffer);if(this.pixels=new Uint8Array(c.data.buffer),this.floatView=new Float32Array(c.data.buffer),this.borderReady=g,this._modifiedForSources={},!g){for(let P=0;P<m;P++)v[this._idx(-1,P)]=v[this._idx(0,P)],v[this._idx(m,P)]=v[this._idx(m-1,P)],v[this._idx(P,-1)]=v[this._idx(P,0)],v[this._idx(P,m)]=v[this._idx(P,m-1)];v[this._idx(-1,-1)]=v[this._idx(0,0)],v[this._idx(m,-1)]=v[this._idx(m-1,0)],v[this._idx(-1,m)]=v[this._idx(0,m-1)],v[this._idx(m,m)]=v[this._idx(m-1,m-1)]}const E=d==="terrarium"?UQ:FQ;for(let P=0;P<v.length;++P){const L=4*P;this.floatView[P]=E(this.pixels[L],this.pixels[L+1],this.pixels[L+2])}this._timestamp=$t.now()}_buildQuadTree(){this._tree=new Xz(this)}get(a,c,d=!1){d&&(a=Un(a,-1,this.dim),c=Un(c,-1,this.dim));const g=this._idx(a,c);return this.floatView[g]}set(a,c,d){const g=this._idx(a,c),m=this.floatView[g];return this.floatView[g]=d,d-m}static getUnpackVector(a){return jQ[a]}_idx(a,c){if(a<-1||a>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(a+1)}static pack(a,c){const d=[0,0,0,0],g=LS.getUnpackVector(c);let m=Math.floor((a+g[3])/g[2]);return d[2]=m%256,m=Math.floor(m/256),d[1]=m%256,m=Math.floor(m/256),d[0]=m,d}getPixels(){return new X1({width:this.stride,height:this.stride},this.pixels)}backfillBorder(a,c,d){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");let g=c*this.dim,m=c*this.dim+this.dim,v=d*this.dim,E=d*this.dim+this.dim;switch(c){case-1:g=m-1;break;case 1:m=g+1}switch(d){case-1:v=E-1;break;case 1:E=v+1}const P=-c*this.dim,L=-d*this.dim;for(let A=v;A<E;A++)for(let O=g;O<m;O++){const N=4*this._idx(O,A),D=4*this._idx(O+P,A+L);this.pixels[N+0]=a.pixels[D+0],this.pixels[N+1]=a.pixels[D+1],this.pixels[N+2]=a.pixels[D+2],this.pixels[N+3]=a.pixels[D+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function qQ(h,a,c){h===1?a.headerLength=c.readFixed32():h===2?a.x=c.readVarint():h===3?a.y=c.readVarint():h===4?a.z=c.readVarint():h===5&&a.layers.push(function(d,g){return d.readFields(WQ,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},g)}(c,c.readVarint()+c.pos))}function VQ(h,a,c){h===1?(a.delta_filter=function(d,g){return d.readFields($Q,{blockSize:0},g)}(c,c.readVarint()+c.pos),a.filter="delta_filter"):h===2?(c.readVarint(),a.filter="zigzag_filter"):h===3?(c.readVarint(),a.filter="bitshuffle_filter"):h===4&&(c.readVarint(),a.filter="byteshuffle_filter")}function $Q(h,a,c){h===1&&(a.blockSize=c.readVarint())}function HQ(h,a,c){h===1?(c.readVarint(),a.codec="gzip_data"):h===2?(c.readVarint(),a.codec="jpeg_image"):h===3?(c.readVarint(),a.codec="webp_image"):h===4&&(c.readVarint(),a.codec="png_image")}function GQ(h,a,c){let d=0,g=0;h===1?a.firstByte=c.readFixed64():h===2?a.lastByte=c.readFixed64():h===3?a.filters.push(function(m,v){return m.readFields(VQ,{},v)}(c,c.readVarint()+c.pos)):h===4?a.codec=function(m,v){return m.readFields(HQ,{},v)}(c,c.readVarint()+c.pos):h===5?g=c.readFloat():h===6?d=c.readFloat():h===7?a.bands.push(c.readString()):h===8?a.offset=c.readDouble():h===9&&(a.scale=c.readDouble()),a.offset===0&&(a.offset=g),a.scale===0&&(a.scale=d)}function WQ(h,a,c){h===1?a.version=c.readVarint():h===2?a.name=c.readString():h===3?a.units=c.readString():h===4?a.tileSize=c.readVarint():h===5?a.buffer=c.readVarint():h===6?a.pixelFormat=c.readVarint():h===7&&a.dataIndex.push(function(d,g){return d.readFields(GQ,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},g)}(c,c.readVarint()+c.pos))}function KQ(h,a,c){if(h===2)(function(d,g,m){d.readFields(YQ,m,g)})(c,c.readVarint()+c.pos,a);else if(h===3)throw new Error("Not implemented")}function YQ(h,a,c){if(h===1){let d=0;const g=c.readVarint()+c.pos;for(;c.pos<g;)a[d++]=c.readVarint()}}function XQ(h,a){if(a.length!==4)throw new Error(`Expected data of dimension 4 but got ${a.length}.`);let c=a[3];for(let d=2;d>=1;d--){const g=d===1?1:0,m=d===2?1:0;for(let v=0;v<a[0];v++){const E=a[1]*v;for(let P=g;P<a[1];P++){const L=a[2]*(P+E);for(let A=m;A<a[2];A++){const O=a[3]*(A+L);for(let N=0;N<a[3];N++){const D=O+N;h[D]+=h[D-c]}}}}c*=a[d]}return h}function ZQ(h){for(let a=0,c=h.length;a<c;a++)h[a]=h[a]>>>1^-(1&h[a]);return h}function JQ(h,a){switch(a){case"uint32":return h;case"uint16":for(let c=0;c<h.length;c+=2){const d=h[c],g=h[c+1];h[c]=(240&d)>>4|(61440&d)>>8|(240&g)<<4|61440&g,h[c+1]=15&d|(3840&d)>>4|(15&g)<<8|(3840&g)<<4}return h;case"uint8":for(let c=0;c<h.length;c+=4){const d=h[c],g=h[c+1],m=h[c+2],v=h[c+3];h[c+0]=(192&d)>>6|(192&g)>>4|(192&m)>>2|192&v,h[c+1]=(48&d)>>4|(48&g)>>2|48&m|(48&v)<<2,h[c+2]=(12&d)>>2|12&g|(12&m)<<2|(12&v)<<4,h[c+3]=3&d|(3&g)<<2|(3&m)<<4|(3&v)<<6}return h;default:throw new Error(`Invalid pixel format, "${a}"`)}}Mt(LS,"DEMData"),Mt(Xz,"DemMinMaxQuadTree",{omit:["dem"]});var Kf=Uint8Array,Vb=Uint16Array,QQ=Int32Array,Jz=new Kf([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Qz=new Kf([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),eee=new Kf([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),e6=function(h,a){for(var c=new Vb(31),d=0;d<31;++d)c[d]=a+=1<<h[d-1];var g=new QQ(c[30]);for(d=1;d<30;++d)for(var m=c[d];m<c[d+1];++m)g[m]=m-c[d]<<5|d;return{b:c,r:g}},t6=e6(Jz,2),n6=t6.b,tee=t6.r;n6[28]=258,tee[258]=28;for(var nee=e6(Qz,0).b,r6=new Vb(32768),To=0;To<32768;++To){var n0=(43690&To)>>1|(21845&To)<<1;r6[To]=((65280&(n0=(61680&(n0=(52428&n0)>>2|(13107&n0)<<2))>>4|(3855&n0)<<4))>>8|(255&n0)<<8)>>1}var $b=function(h,a,c){for(var d=h.length,g=0,m=new Vb(a);g<d;++g)h[g]&&++m[h[g]-1];var v,E=new Vb(a);for(g=1;g<a;++g)E[g]=E[g-1]+m[g-1]<<1;v=new Vb(1<<a);var P=15-a;for(g=0;g<d;++g)if(h[g])for(var L=g<<4|h[g],A=a-h[g],O=E[h[g]-1]++<<A,N=O|(1<<A)-1;O<=N;++O)v[r6[O]>>P]=L;return v},Hb=new Kf(288);for(To=0;To<144;++To)Hb[To]=8;for(To=144;To<256;++To)Hb[To]=9;for(To=256;To<280;++To)Hb[To]=7;for(To=280;To<288;++To)Hb[To]=8;var i6=new Kf(32);for(To=0;To<32;++To)i6[To]=5;var ree=$b(Hb,9),iee=$b(i6,5),z3=function(h){for(var a=h[0],c=1;c<h.length;++c)h[c]>a&&(a=h[c]);return a},fp=function(h,a,c){var d=a/8|0;return(h[d]|h[d+1]<<8)>>(7&a)&c},B3=function(h,a){var c=a/8|0;return(h[c]|h[c+1]<<8|h[c+2]<<16)>>(7&a)},aee=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],dp=function(h,a,c){var d=new Error(a||aee[h]);if(d.code=h,Error.captureStackTrace&&Error.captureStackTrace(d,dp),!c)throw d;return d},see=new Kf(0),oee=typeof TextDecoder<"u"&&new TextDecoder;try{oee.decode(see,{stream:!0})}catch{}const lee={gzip_data:"gzip"};class Rd extends Error{constructor(a){super(a),this.name="MRTError"}}const cee={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},a6={uint32:1,uint16:2,uint8:4},uee={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let j3;class kS{constructor(a=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=a}getLayer(a){const c=this.layers[a];if(!c)throw new Rd(`Layer '${a}' not found`);return c}getHeaderLength(a){const c=new Uint8Array(a),d=new DataView(a);if(c[0]!==13)throw new Rd("File is not a valid MRT.");return d.getUint32(1,!0)}parseHeader(a){const c=new Uint8Array(a),d=this.getHeaderLength(a);if(c.length<d)throw new Rd(`Expected header with length >= ${d} but got buffer of length ${c.length}`);const g=function(m,v){return m.readFields(qQ,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new j3(c.subarray(0,d)));if(!isNaN(this.x)&&(this.x!==g.x||this.y!==g.y||this.z!==g.z))throw new Rd(`Invalid attempt to parse header ${g.z}/${g.x}/${g.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=g.x,this.y=g.y,this.z=g.z;for(const m of g.layers)this.layers[m.name]=new s6(m,{cacheSize:this._cacheSize});return this}createDecodingTask(a){const c=[],d=this.getLayer(a.layerName);for(let g of a.blockIndices){const m=d.dataIndex[g],v=m.firstByte-a.firstByte,E=m.lastByte-a.firstByte;if(d._blocksInProgress.has(g))continue;const P={layerName:d.name,firstByte:v,lastByte:E,pixelFormat:d.pixelFormat,blockIndex:g,blockShape:[m.bands.length].concat(d.bandShape),buffer:d.buffer,codec:m.codec.codec,filters:m.filters.map(L=>L.filter)};d._blocksInProgress.add(g),c.push(P)}return new o6(c,()=>{c.forEach(g=>d._blocksInProgress.delete(g.blockIndex))},(g,m)=>{if(c.forEach(v=>d._blocksInProgress.delete(v.blockIndex)),g)throw g;m.forEach(v=>{this.getLayer(v.layerName).processDecodedData(v)})})}}class s6{constructor({version:a,name:c,units:d,tileSize:g,pixelFormat:m,buffer:v,dataIndex:E},P){if(this.version=a,this.version!==1)throw new Rd(`Cannot parse raster layer encoded with MRT version ${a}`);this.name=c,this.units=d,this.tileSize=g,this.buffer=v,this.pixelFormat=cee[m],this.dataIndex=E,this.bandShape=[g+2*v,g+2*v,a6[this.pixelFormat]],this._decodedBlocks=new DS(P?P.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return a6[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:a})=>a).flat()}processDecodedData(a){const c=a.blockIndex.toString();this._decodedBlocks.get(c)||this._decodedBlocks.put(c,a.data)}getBlockForBand(a){let c=0;switch(typeof a){case"string":for(const[d,g]of this.dataIndex.entries()){for(const[m,v]of g.bands.entries())if(v===a)return{bandIndex:c+m,blockIndex:d,blockBandIndex:m};c+=g.bands.length}break;case"number":for(const[d,g]of this.dataIndex.entries()){if(a>=c&&a<c+g.bands.length)return{bandIndex:a,blockIndex:d,blockBandIndex:a-c};c+=g.bands.length}break;default:throw new Rd(`Invalid band \`${JSON.stringify(a)}\`. Expected string or integer.`)}throw new Rd(`Band not found: ${JSON.stringify(a)}`)}getDataRange(a){let c=1/0,d=-1/0;const g=[],m=new Set;for(const v of a){const{blockIndex:E}=this.getBlockForBand(v);if(E<0)throw new Rd(`Invalid band: ${JSON.stringify(v)}`);const P=this.dataIndex[E];g.includes(E)||g.push(E),m.add(E),c=Math.min(c,P.firstByte),d=Math.max(d,P.lastByte)}if(m.size>this.cacheSize)throw new Rd(`Number of blocks to decode (${m.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:c,lastByte:d,blockIndices:g}}hasBand(a){const{blockIndex:c}=this.getBlockForBand(a);return c>=0}hasDataForBand(a){const{blockIndex:c}=this.getBlockForBand(a);return c>=0&&!!this._decodedBlocks.get(c.toString())}getBandView(a){const{blockIndex:c,blockBandIndex:d}=this.getBlockForBand(a),g=this._decodedBlocks.get(c.toString());if(!g)throw new Rd(`Data for band ${JSON.stringify(a)} of layer "${this.name}" not decoded.`);const m=this.dataIndex[c],v=this.bandShape.reduce((L,A)=>L*A,1),E=d*v,P=g.subarray(E,E+v);return{data:P,bytes:new Uint8Array(P.buffer).subarray(P.byteOffset,P.byteOffset+P.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:m.offset,scale:m.scale}}}kS.setPbf=function(h){j3=h};class o6{constructor(a,c,d){this.tasks=a,this._onCancel=c,this._onComplete=d,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(a,c){this._finalized||(this._onComplete(a,c),this._finalized=!0)}}kS.performDecoding=function(h,a){const c=new Uint8Array(h);return Promise.all(a.tasks.map(d=>{const{layerName:g,firstByte:m,lastByte:v,pixelFormat:E,blockShape:P,blockIndex:L,filters:A,codec:O}=d,N=c.subarray(m,v+1),D=new Uint32Array(P[0]*P[1]*P[2]);let k;if(O!=="gzip_data")throw new Rd(`Unhandled codec: ${O}`);return k=function(U,X){if(!globalThis.DecompressionStream&&X==="gzip_data")return Promise.resolve(((re=function(Me){Me[0]==31&&Me[1]==139&&Me[2]==8||dp(6,"invalid gzip data");var We=Me[3],$e=10;4&We&&($e+=2+(Me[10]|Me[11]<<8));for(var He=(We>>3&1)+(We>>4&1);He>0;He-=!Me[$e++]);return $e+(2&We)}(oe=U))+8>oe.length&&dp(6,"invalid gzip data"),function(Me,We,$e,He){var ht=Me.length;if(!ht||We.f&&!We.l)return $e||new Kf(0);var Ke=!$e,pt=Ke||We.i!=2,Et=We.i;Ke&&($e=new Kf(3*ht));var wt,Ot,It=function(ry){var iy=$e.length;if(ry>iy){var w_=new Kf(Math.max(2*iy,ry));w_.set($e),$e=w_}},jt=We.f||0,Dt=We.p||0,Vt=We.b||0,_n=We.l,gn=We.d,Zn=We.m,Cn=We.n,Ln=8*ht;do{if(!_n){jt=fp(Me,Dt,1);var bn=fp(Me,Dt+1,3);if(Dt+=3,!bn){var _r=Me[(zr=4+((Dt+7)/8|0))-4]|Me[zr-3]<<8,Kn=zr+_r;if(Kn>ht){Et&&dp(0);break}pt&&It(Vt+_r),$e.set(Me.subarray(zr,Kn),Vt),We.b=Vt+=_r,We.p=Dt=8*Kn,We.f=jt;continue}if(bn==1)_n=ree,gn=iee,Zn=9,Cn=5;else if(bn==2){var lr=fp(Me,Dt,31)+257,Lr=fp(Me,Dt+10,15)+4,Qr=lr+fp(Me,Dt+5,31)+1;Dt+=14;for(var Fr=new Kf(Qr),ui=new Kf(19),Jr=0;Jr<Lr;++Jr)ui[eee[Jr]]=fp(Me,Dt+3*Jr,7);Dt+=3*Lr;var xi=z3(ui),Gi=(1<<xi)-1,Ca=$b(ui,xi);for(Jr=0;Jr<Qr;){var zr,Ii=Ca[fp(Me,Dt,Gi)];if(Dt+=15&Ii,(zr=Ii>>4)<16)Fr[Jr++]=zr;else{var Ya=0,ss=0;for(zr==16?(ss=3+fp(Me,Dt,3),Dt+=2,Ya=Fr[Jr-1]):zr==17?(ss=3+fp(Me,Dt,7),Dt+=3):zr==18&&(ss=11+fp(Me,Dt,127),Dt+=7);ss--;)Fr[Jr++]=Ya}}var ms=Fr.subarray(0,lr),Is=Fr.subarray(lr);Zn=z3(ms),Cn=z3(Is),_n=$b(ms,Zn),gn=$b(Is,Cn)}else dp(1);if(Dt>Ln){Et&&dp(0);break}}pt&&It(Vt+131072);for(var Sa=(1<<Zn)-1,sl=(1<<Cn)-1,Au=Dt;;Au=Dt){var yo=(Ya=_n[B3(Me,Dt)&Sa])>>4;if((Dt+=15&Ya)>Ln){Et&&dp(0);break}if(Ya||dp(2),yo<256)$e[Vt++]=yo;else{if(yo==256){Au=Dt,_n=null;break}var Eo=yo-254;yo>264&&(Eo=fp(Me,Dt,(1<<(Yf=Jz[Jr=yo-257]))-1)+n6[Jr],Dt+=Yf);var Pc=gn[B3(Me,Dt)&sl],Ll=Pc>>4;if(Pc||dp(3),Dt+=15&Pc,Is=nee[Ll],Ll>3){var Yf=Qz[Ll];Is+=B3(Me,Dt)&(1<<Yf)-1,Dt+=Yf}if(Dt>Ln){Et&&dp(0);break}pt&&It(Vt+131072);var ny=Vt+Eo;if(Vt<Is){var Dd=0-Is,mp=Math.min(Is,ny);for(Dd+Vt<0&&dp(3);Vt<mp;++Vt)$e[Vt]=(void 0)[Dd+Vt]}for(;Vt<ny;++Vt)$e[Vt]=$e[Vt-Is]}}We.l=_n,We.p=Au,We.b=Vt,We.f=jt,_n&&(jt=1,We.m=Zn,We.d=gn,We.n=Cn)}while(!jt);return Vt!=$e.length&&Ke?(wt=$e,((Ot=Vt)==null||Ot>wt.length)&&(Ot=wt.length),new Kf(wt.subarray(0,Ot))):$e.subarray(0,Vt)}(oe.subarray(re,-8),{i:2},new Kf(((Q=oe)[(le=Q.length)-4]|Q[le-3]<<8|Q[le-2]<<16|Q[le-1]<<24)>>>0))));var Q,le,oe,re;const me=lee[X];if(!me)throw new Error(`Unhandled codec: ${X}`);const Se=new globalThis.DecompressionStream(me);return new Response(new Blob([U]).stream().pipeThrough(Se)).arrayBuffer().then(Me=>new Uint8Array(Me))}(N,O).then(U=>(function(X,Q){X.readFields(KQ,Q)}(new j3(U),D),new uee[E](D.buffer))),k.then(U=>{for(let X=A.length-1;X>=0;X--)switch(A[X]){case"delta_filter":XQ(U,P);break;case"zigzag_filter":ZQ(U);break;case"bitshuffle_filter":JQ(U,E);break;default:throw new Rd(`Unhandled filter "${A[X]}"`)}return{layerName:g,blockIndex:L,data:U}}).catch(U=>{throw U})}))},Mt(o6,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Mt(kS,"MapboxRasterTile"),Mt(s6,"MapboxRasterLayer",{omit:["_blocksInProgress"]});let Gb,F3,pp,r0,U3,i0=null;function l6(){return Za()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:F3||Ee.DRACO_URL}function c6(){if(Za()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(r0)return r0;const h=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return r0=WebAssembly.validate(h)?Ee.MESHOPT_SIMD_URL:Ee.MESHOPT_URL,r0}const NS={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},hee={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Wb={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function u6(h,a,c){const d=c.json.bufferViews.length,g=c.buffers.length;a.bufferView=d,c.json.bufferViews[d]={buffer:g,byteLength:h.byteLength},c.buffers[g]=h}const q3="KHR_draco_mesh_compression";function fee(h,a){const c=h.extensions&&h.extensions[q3];if(!c)return;const d=new pp.Decoder,g=p6(a,c.bufferView),m=new pp.Mesh;if(!d.DecodeArrayToMesh(g,g.byteLength,m))throw new Error("Failed to decode Draco mesh");const v=a.json.accessors[h.indices],E=NS[v.componentType],P=v.count*E.BYTES_PER_ELEMENT,L=pp._malloc(P);E===Uint16Array?d.GetTrianglesUInt16Array(m,P,L):d.GetTrianglesUInt32Array(m,P,L),u6(pp.memory.buffer.slice(L,L+P),v,a),pp._free(L);for(const A of Object.keys(c.attributes)){const O=d.GetAttributeByUniqueId(m,c.attributes[A]),N=a.json.accessors[h.attributes[A]],D=hee[N.componentType],k=N.count*Wb[N.type]*NS[N.componentType].BYTES_PER_ELEMENT,U=pp._malloc(k);d.GetAttributeDataArrayForAllPoints(m,O,pp[D],k,U),u6(pp.memory.buffer.slice(U,U+k),N,a),pp._free(U)}d.destroy(),m.destroy(),delete h.extensions[q3]}const zS="EXT_meshopt_compression";function dee(h,a){if(!h.extensions||!h.extensions[zS])return;const c=h.extensions[zS],d=new Uint8Array(a.buffers[c.buffer],c.byteOffset||0,c.byteLength||0),g=new Uint8Array(c.count*c.byteStride);U3.decodeGltfBuffer(g,c.count,c.byteStride,d,c.mode,c.filter),h.buffer=a.buffers.length,h.byteOffset=0,a.buffers[h.buffer]=g.buffer,delete h.extensions[zS]}const h6=1179937895,f6=new TextDecoder("utf8");function d6(h,a){return new URL(h,a).href}function pee(h,a,c,d){return fetch(d6(h.uri,d)).then(g=>g.arrayBuffer()).then(g=>{a.buffers[c]=g})}function p6(h,a){const c=h.json.bufferViews[a];return new Uint8Array(h.buffers[c.buffer],c.byteOffset||0,c.byteLength)}function mee(h,a,c,d){if(h.uri){const g=d6(h.uri,d);return fetch(g).then(m=>m.blob()).then(m=>createImageBitmap(m)).then(m=>{a.images[c]=m})}if(h.bufferView!==void 0){const g=p6(a,h.bufferView),m=new Blob([g],{type:h.mimeType});return createImageBitmap(m).then(v=>{a.images[c]=v})}}function m6(h,a=0,c){const d={json:null,images:[],buffers:[]};if(new Uint32Array(h,a,1)[0]===h6){const A=new Uint32Array(h,a);let O=2;const N=(A[O++]>>2)-3,D=A[O++]>>2;if(O++,d.json=JSON.parse(f6.decode(A.subarray(O,O+D))),O+=D,O<N){const k=A[O++];O++;const U=a+(O<<2);d.buffers[0]=h.slice(U,U+k)}}else d.json=JSON.parse(f6.decode(new Uint8Array(h,a)));const{buffers:g,images:m,meshes:v,extensionsUsed:E,bufferViews:P}=d.json;let L=Promise.resolve();if(g){const A=[];for(let O=0;O<g.length;O++){const N=g[O];N.uri?A.push(pee(N,d,O,c)):d.buffers[O]||(d.buffers[O]=null)}L=Promise.all(A)}return L.then(()=>{const A=[],O=E&&E.includes(q3),N=E&&E.includes(zS);if(O&&A.push(function(){if(!pp)return Gb??(Gb=function(D){let k,U=null;function X(){k=new Uint8Array(U.buffer)}function Q(){throw new Error("Unexpected Draco error.")}const le={a:{a:Q,d:function(oe,re,me){return k.copyWithin(oe,re,re+me)},c:function(oe){const re=k.length,me=Math.max(oe>>>0,Math.ceil(1.2*re)),Se=Math.ceil((me-re)/65536);try{return U.grow(Se),X(),!0}catch{return!1}},b:Q}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(D,le):D.then(oe=>oe.arrayBuffer()).then(oe=>WebAssembly.instantiate(oe,le))).then(oe=>{const{Rb:re,Qb:me,P:Se,T:Me,X:We,Ja:$e,La:He,Qa:ht,Va:Ke,Wa:pt,eb:Et,jb:wt,f:Ot,e:It,yb:jt,zb:Dt,Ab:Vt,Bb:_n,Db:gn,Gb:Zn}=oe.instance.exports;U=It;const Cn=(()=>{let Ln=0,bn=0,_r=0,Kn=0;return lr=>{_r&&(re(Kn),re(Ln),bn+=_r,_r=Ln=0),Ln||(bn+=128,Ln=me(bn));const Lr=lr.length+7&-8;let Qr=Ln;Lr>=bn&&(_r=Lr,Qr=Kn=me(Lr));for(let Fr=0;Fr<lr.length;Fr++)k[Qr+Fr]=lr[Fr];return Qr}})();return X(),Ot(),{memory:It,_free:re,_malloc:me,Mesh:class{constructor(){this.ptr=Se()}destroy(){Me(this.ptr)}},Decoder:class{constructor(){this.ptr=$e()}destroy(){wt(this.ptr)}DecodeArrayToMesh(Ln,bn,_r){const Kn=Cn(Ln),lr=He(this.ptr,Kn,bn,_r.ptr);return!!We(lr)}GetAttributeByUniqueId(Ln,bn){return{ptr:ht(this.ptr,Ln.ptr,bn)}}GetTrianglesUInt16Array(Ln,bn,_r){Ke(this.ptr,Ln.ptr,bn,_r)}GetTrianglesUInt32Array(Ln,bn,_r){pt(this.ptr,Ln.ptr,bn,_r)}GetAttributeDataArrayForAllPoints(Ln,bn,_r,Kn,lr){Et(this.ptr,Ln.ptr,bn.ptr,_r,Kn,lr)}},DT_INT8:jt(),DT_UINT8:Dt(),DT_INT16:Vt(),DT_UINT16:_n(),DT_UINT32:gn(),DT_FLOAT32:Zn()}})}(fetch(l6())),Gb.then(D=>{pp=D,Gb=void 0}))}()),N&&A.push(function(){if(U3)return;const D=function(k){let U;const X=WebAssembly.instantiateStreaming(k,{}).then(oe=>{U=oe.instance,U.exports.__wasm_call_ctors()}),Q={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},le={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:X,supported:!0,decodeGltfBuffer(oe,re,me,Se,Me,We){(function($e,He,ht,Ke,pt,Et,wt){const Ot=$e.exports.sbrk,It=Ke+3&-4,jt=Ot(It*pt),Dt=Ot(Et.length),Vt=new Uint8Array($e.exports.memory.buffer);Vt.set(Et,Dt);const _n=He(jt,Ke,pt,Dt,Et.length);if(_n===0&&wt&&wt(jt,It,pt),ht.set(Vt.subarray(jt,jt+Ke*pt)),Ot(jt-Ot(0)),_n!==0)throw new Error(`Malformed buffer data: ${_n}`)})(U,U.exports[le[Me]],oe,re,me,Se,U.exports[Q[We]])}}}(fetch(c6()));return D.ready.then(()=>{U3=D})}()),m)for(let D=0;D<m.length;D++)A.push(mee(m[D],d,D,c));return(A.length?Promise.all(A):Promise.resolve()).then(()=>{if(O&&v)for(const{primitives:D}of v)for(const k of D)fee(k,d);if(N&&v&&P)for(const D of P)dee(D,d);return d})})}function x_(h,a){const c=h.json.bufferViews[a.bufferView],d=NS[a.componentType];return new d(h.buffers[c.buffer],(a.byteOffset||0)+(c.byteOffset||0),a.count*(c.byteStride&&c.byteStride!==Wb[a.type]*d.BYTES_PER_ELEMENT?c.byteStride/d.BYTES_PER_ELEMENT:Wb[a.type]))}function V3(h,a,c,d){const g=NS[a.componentType],m=function(A){switch(A){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(g),v=h.json.bufferViews[a.bufferView],E=v.byteStride?v.byteStride/g.BYTES_PER_ELEMENT:Wb[a.type],P=c.float32,L=P.length/c.capacity;for(let A=0,O=0;A<a.count*E;A+=E,O+=L)for(let N=0;N<L;N++)P[O+N]=d[A+N]*m;c._trim()}function gee(h,a,c){const d=h.indices,g=h.attributes,m={};m.indexArray=new Ms;const v=a.json.accessors[d],E=v.count/3;m.indexArray.reserve(E);const P=x_(a,v);for(let N=0;N<E;N++)m.indexArray.emplaceBack(P[3*N],P[3*N+1],P[3*N+2]);m.indexArray._trim(),m.vertexArray=new So;const L=a.json.accessors[g.POSITION];m.vertexArray.reserve(L.count);const A=x_(a,L);for(let N=0;N<L.count;N++)m.vertexArray.emplaceBack(A[3*N],A[3*N+1],A[3*N+2]);if(m.vertexArray._trim(),m.aabb=new tr(L.min,L.max),m.centroid=function(N,D){const k=[0,0,0],U=N.length;if(U>0){for(let X=0;X<U;X++){const Q=3*N[X];k[0]+=D[Q],k[1]+=D[Q+1],k[2]+=D[Q+2]}k[0]/=U,k[1]/=U,k[2]/=U}return k}(P,A),g.COLOR_0!==void 0){const N=a.json.accessors[g.COLOR_0],D=Wb[N.type],k=x_(a,N);m.colorArray=D===3?new So:new Xu,m.colorArray.resize(N.count),V3(a,N,m.colorArray,k)}if(g.NORMAL!==void 0){m.normalArray=new So;const N=a.json.accessors[g.NORMAL];m.normalArray.resize(N.count);const D=x_(a,N);V3(a,N,m.normalArray,D)}if(g.TEXCOORD_0!==void 0&&c.length>0){m.texcoordArray=new qf;const N=a.json.accessors[g.TEXCOORD_0];m.texcoordArray.resize(N.count);const D=x_(a,N);V3(a,N,m.texcoordArray,D)}if(g._FEATURE_ID_RGBA4444!==void 0){const N=a.json.accessors[g._FEATURE_ID_RGBA4444];a.json.extensionsUsed&&a.json.extensionsUsed.includes("EXT_meshopt_compression")&&(m.featureData=x_(a,N))}g._FEATURE_RGBA4444!==void 0&&(m.featureData=new Uint32Array(x_(a,a.json.accessors[g._FEATURE_RGBA4444]).buffer));const O=h.material;return m.material=function(N,D){const{emissiveFactor:k=[0,0,0],alphaMode:U="OPAQUE",alphaCutoff:X=.5,normalTexture:Q,occlusionTexture:le,emissiveTexture:oe,doubleSided:re}=N,{baseColorFactor:me=[1,1,1,1],metallicFactor:Se=1,roughnessFactor:Me=1,baseColorTexture:We,metallicRoughnessTexture:$e}=N.pbrMetallicRoughness||{},He=le?D[le.index]:void 0;if(le&&le.extensions&&le.extensions.KHR_texture_transform&&He){const ht=le.extensions.KHR_texture_transform;He.offsetScale=[ht.offset[0],ht.offset[1],ht.scale[0],ht.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Ei(...me),metallicFactor:Se,roughnessFactor:Me,baseColorTexture:We?D[We.index]:void 0,metallicRoughnessTexture:$e?D[$e.index]:void 0},doubleSided:re,emissiveFactor:k,alphaMode:U,alphaCutoff:X,normalTexture:Q?D[Q.index]:void 0,occlusionTexture:He,emissionTexture:oe?D[oe.index]:void 0,defined:N.defined===void 0}}(O!==void 0?a.json.materials[O]:{defined:!1},c),m}function g6(h,a,c){const{matrix:d,rotation:g,translation:m,scale:v,mesh:E,extras:P,children:L}=h,A={};if(A.matrix=d||_e.mat4.fromRotationTranslationScale([],g||[0,0,0,1],m||[0,0,0],v||[1,1,1]),E!==void 0){A.meshes=c[E];const O=A.anchor=[0,0];for(const N of A.meshes){const{min:D,max:k}=N.aabb;O[0]+=D[0]+k[0],O[1]+=D[1]+k[1]}O[0]=Math.floor(O[0]/A.meshes.length/2),O[1]=Math.floor(O[1]/A.meshes.length/2)}if(P&&(P.id&&(A.id=P.id),P.lights&&(A.lights=function(O){if(!O.length)return[];const N=function(Q){const le=atob(Q),oe=new Uint8Array(le.length);for(let re=0;re<le.length;re++)oe[re]=le.codePointAt(re);return oe}(O),D=[],k=N.length/24,U=new Uint16Array(N.buffer),X=new Float32Array(N.buffer);for(let Q=0;Q<k;Q++){const le=U[2*Q*6]/30,oe=U[2*Q*6+1]/30,re=U[2*Q*6+10]/100,me=X[6*Q+1],Se=X[6*Q+2],Me=X[6*Q+3],We=X[6*Q+4],$e=Me-me,He=We-Se,ht=Math.hypot($e,He);D.push({pos:[me+.5*$e,Se+.5*He,oe],normal:[He/ht,-$e/ht,0],width:ht,height:le,depth:re,points:[me,Se,Me,We]})}return D}(P.lights))),L){const O=[];for(const N of L)O.push(g6(a.json.nodes[N],a,c));A.children=O}return A}function yee(h){if(h.vertices.length===0||h.indices.length===0)return null;const a=new ab(h.vertices,h.indices,8,256),[c,d]=[a.min.clone(),a.max.clone()];return{vertices:h.vertices,indices:h.indices,grid:a,min:c,max:d}}function _ee(h){if(!h.extras||!h.extras.ground)return null;const a=h.extras.ground;if(!a||!Array.isArray(a)||a.length===0)return null;const c=a[0];if(!c||!Array.isArray(c)||c.length===0)return null;const d=[];for(const v of c){if(!Array.isArray(v)||v.length!==2)continue;const E=v[0],P=v[1];typeof E=="number"&&typeof P=="number"&&d.push(new Ut(E,P))}if(d.length<3)return null;d.length>1&&d[d.length-1].equals(d[0])&&d.pop();let g=0;for(let v=0;v<d.length;v++){const E=d[v],P=d[(v+1)%d.length],L=d[(v+2)%d.length];g+=(E.x-P.x)*(L.y-P.y)-(L.x-P.x)*(E.y-P.y)}g>0&&d.reverse();const m=e_(d.flatMap(v=>[v.x,v.y]),[]);return m.length===0?null:{vertices:d,indices:m}}function vee(h,a){const c=[],d=[];let g=0;const m=[];for(const v of h){g=c.length;const E=v.vertexArray.float32,P=v.indexArray.uint16;for(let L=0;L<v.vertexArray.length;L++)m[0]=E[3*L+0],m[1]=E[3*L+1],m[2]=E[3*L+2],_e.vec3.transformMat4(m,m,a),c.push(new Ut(m[0],m[1]));for(let L=0;L<3*v.indexArray.length;L++)d.push(P[L]+g)}if(d.length%3!=0)return null;for(let v=0;v<d.length;v+=3){const E=c[d[v+0]],P=c[d[v+1]],L=c[d[v+2]];(E.x-P.x)*(L.y-P.y)-(L.x-P.x)*(E.y-P.y)>0&&([d[v+1],d[v+2]]=[d[v+2],d[v+1]])}return{vertices:c,indices:d}}function y6(h){const a=function(P,L){const A=[],O=WebGL2RenderingContext;if(P.json.textures)for(const N of P.json.textures){const D={magFilter:O.LINEAR,minFilter:O.NEAREST,wrapS:O.REPEAT,wrapT:O.REPEAT};N.sampler!==void 0&&Object.assign(D,P.json.samplers[N.sampler]),A.push({image:L[N.source],sampler:D,uploaded:!1})}return A}(h,h.images),c=function(P,L){const A=[];for(const O of P.json.meshes){const N=[];for(const D of O.primitives)N.push(gee(D,P,L));A.push(N)}return A}(h,a),{scenes:d,scene:g,nodes:m}=h.json,v=d?d[g||0].nodes:m,E=[];for(const P of v)E.push(g6(m[P],h,c));return function(P,L,A){const O={},N=new Set;for(let D=0;D<P.length;D++){const k=A[L[D]];if(!k.extras)continue;const U=k.extras["mapbox:footprint:version"],X=k.extras["mapbox:footprint:id"];(U||X)&&N.add(D),U==="1.0.0"&&X&&(O[X]=D)}for(let D=0;D<P.length;D++){if(N.has(D))continue;const k=P[D],U=A[L[D]];if(!U.extras)continue;let X=null;k.id in O&&(X=vee(P[O[k.id]].meshes,k.matrix)),X||(X=_ee(U)),X&&(k.footprint=yee(X))}if(N.size>0){const D=Array.from(N.values()).sort((k,U)=>k-U);for(let k=D.length-1;k>=0;k--)P.splice(D[k],1)}}(E,v,h.json.nodes),E}function bee(h){h.heightmap=new Float32Array(4096),h.heightmap.fill(-1);const a=h.vertexArray.float32,c=h.aabb.min[0]-1,d=h.aabb.min[1]-1,g=__/(h.aabb.max[0]-c+2),m=__/(h.aabb.max[1]-d+2);for(let v=0;v<a.length;v+=3){const E=a[v+2],P=(a[v+0]-c)*g|0,L=(a[v+1]-d)*m|0;E>h.heightmap[L*__+P]&&(h.heightmap[L*__+P]=E)}}function xee(h,a){const c={};c.indexArray=new Ms,c.indexArray.reserve(4*h.length),c.vertexArray=new So,c.vertexArray.reserve(10*h.length),c.colorArray=new Xu,c.vertexArray.reserve(10*h.length);let d=0;for(const v of h){const E=Math.min(10,Math.max(4,1.3*v.height))*a,P=[-v.normal[1],v.normal[0],0],L=Math.min(.29,.1*v.width/v.depth),A=v.width-2*v.depth*a*(L+.01),O=_e.vec3.scaleAndAdd([],v.pos,P,A/2),N=_e.vec3.scaleAndAdd([],v.pos,P,-A/2),D=[O[0],O[1],O[2]+v.height],k=[N[0],N[1],N[2]+v.height],U=_e.vec3.scaleAndAdd([],v.normal,P,L);_e.vec3.scale(U,U,E);const X=_e.vec3.scaleAndAdd([],v.normal,P,-L);_e.vec3.scale(X,X,E),_e.vec3.add(U,O,U),_e.vec3.add(X,N,X),O[2]+=.1,N[2]+=.1,c.vertexArray.emplaceBack(U[0],U[1],U[2]),c.vertexArray.emplaceBack(X[0],X[1],X[2]),c.vertexArray.emplaceBack(O[0],O[1],O[2]),c.vertexArray.emplaceBack(N[0],N[1],N[2]),c.vertexArray.emplaceBack(D[0],D[1],D[2]),c.vertexArray.emplaceBack(k[0],k[1],k[2]),c.vertexArray.emplaceBack(O[0],O[1],O[2]),c.vertexArray.emplaceBack(N[0],N[1],N[2]),c.vertexArray.emplaceBack(U[0],U[1],U[2]),c.vertexArray.emplaceBack(X[0],X[1],X[2]);const Q=A/E/2;c.colorArray.emplaceBack(-Q-L,-1,Q,.8),c.colorArray.emplaceBack(Q+L,-1,Q,.8),c.colorArray.emplaceBack(-Q,0,Q,1.3),c.colorArray.emplaceBack(Q,0,Q,1.3),c.colorArray.emplaceBack(Q+L,-.8,Q,.7),c.colorArray.emplaceBack(Q+L,-.8,Q,.7),c.colorArray.emplaceBack(0,0,Q,1.3),c.colorArray.emplaceBack(0,0,Q,1.3),c.colorArray.emplaceBack(Q+L,-1.2,Q,.8),c.colorArray.emplaceBack(Q+L,-1.2,Q,.8),c.indexArray.emplaceBack(6+d,4+d,8+d),c.indexArray.emplaceBack(7+d,9+d,5+d),c.indexArray.emplaceBack(0+d,1+d,2+d),c.indexArray.emplaceBack(1+d,3+d,2+d),d+=10}const g={defined:!0,emissiveFactor:[0,0,0]},m={};return m.baseColorFactor=Ei.white,g.pbrMetallicRoughness=m,c.material=g,c.aabb=new tr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),c}class _6{constructor(a){this._stringToNumber={},this._numberToString=[];for(let c=0;c<a.length;c++){const d=a[c];this._stringToNumber[d]=c,this._numberToString[c]=d}}encode(a){return this._stringToNumber[a]}decode(a){return this._numberToString[a]}}const wee=["id","tile","layer","source","sourceLayer","state"];class a0{constructor(a,c,d,g,m){this.type="Feature",this._vectorTileFeature=a,this._z=c,this._x=d,this._y=g,this.properties=a.properties,this.id=m}clone(){const a=new a0(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(a.state=Object.assign({},this.state)),this.layer&&(a.layer=Object.assign({},this.layer)),this.source&&(a.source=this.source),this.sourceLayer&&(a.sourceLayer=this.sourceLayer),a}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(a){this._geometry=a}toJSON(){const a={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const c of wee)this[c]!==void 0&&(a[c]=this[c]);return a}}class v6{constructor(a,c){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new St(On,16,0),this.featureIndexArray=new pl,this.promoteId=c,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(a,c,d,g,m,v=0,E=0){const P=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,g,m,v);const L=this.grid;for(let A=0;A<c.length;A++){const O=c[A],N=[1/0,1/0,-1/0,-1/0];for(let D=0;D<O.length;D++){const k=O[D];N[0]=Math.min(N[0],k.x),N[1]=Math.min(N[1],k.y),N[2]=Math.max(N[2],k.x),N[3]=Math.max(N[3],k.y)}E!==0&&(N[0]-=E,N[1]-=E,N[2]+=E,N[3]+=E),N[0]<On&&N[1]<On&&N[2]>=0&&N[3]>=0&&L.insert(P,N[0],N[1],N[2],N[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new bf.VectorTile(new oi(this.rawTileData)).layers,this.sourceLayerCoder=new _6(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const a in this.vtLayers)this.vtFeatures[a]=[]}return this.vtLayers}query(a,c){const{tilespaceGeometry:d,transform:g,tileTransform:m,pixelPosMatrix:v,availableImages:E}=c;this.loadVTLayers(),this.serializedLayersCache.clear();const P=d.bufferedTilespaceBounds,L=this.grid.query(P.min.x,P.min.y,P.max.x,P.max.y,(D,k,U,X)=>it(d.bufferedTilespaceGeometry,D,k,U,X));L.sort(See);let A=null;g.elevation&&L.length>0&&(A=Jv.create(g.elevation,this.tileID));const O={};let N;for(let D=0;D<L.length;D++){const k=L[D];if(k===N)continue;N=k;const U=this.featureIndexArray.get(k);let X=null;this.is3DTile?this.loadMatchingModelFeature(O,U,a,d,g):this.loadMatchingFeature(O,U,a,E,(Q,le,oe,re=0)=>(X||(X=$(Q,this.tileID.canonical,m)),le.queryIntersectsFeature(d,Q,oe,X,this.z,g,v,A,re)))}return O}loadMatchingFeature(a,c,d,g,m){const{featureIndex:v,bucketIndex:E,sourceLayerIndex:P,layoutVertexArrayOffset:L}=c,A=this.bucketLayerIDs[E],O=d.layers,N=Object.keys(O);if(N.length&&!function(Q,le){for(let oe=0;oe<Q.length;oe++)if(le.indexOf(Q[oe])>=0)return!0;return!1}(N,A))return;const D=d.sourceCache,k=this.sourceLayerCoder.decode(P),U=this.vtLayers[k].feature(v),X=this.getId(U,k);for(let Q=0;Q<A.length;Q++){const le=A[Q];if(!O[le])continue;const{styleLayer:oe,targets:re}=O[le];let me={};X!==void 0&&(me=D.getFeatureState(oe.sourceLayer,X));const Se=!m||m(U,oe,me,L);if(!Se)continue;const Me=new a0(U,this.z,this.x,this.y,X);Me.tile=this.tileID.canonical,Me.state=me;let We=this.serializedLayersCache.get(le);We||(We=oe.serialize(),We.id=le,this.serializedLayersCache.set(le,We)),Me.source=We.source,Me.sourceLayer=We["source-layer"],Me.layer=wi({},We),Me.layer.paint=b6(We.paint,oe.paint,U,me,g),Me.layer.layout=b6(We.layout,oe.layout,U,me,g);let $e=!1;for(const He of re){this.updateFeatureProperties(Me,He);const{filter:ht}=He;if(ht){if(U.properties=Me.properties,ht.needGeometry){const Ke=K(U,!0);if(!ht.filter(new bi(this.tileID.overscaledZ),Ke,this.tileID.canonical))continue}else if(!ht.filter(new bi(this.tileID.overscaledZ),U))continue}$e=!0,He.targetId&&this.addFeatureVariant(Me,He)}$e&&this.appendToResult(a,le,v,Me,Se)}}loadMatchingModelFeature(a,c,d,g,m){const v=this.bucketLayerIDs[0][0],E=d.layers;if(!E[v])return;const{styleLayer:P,targets:L}=E[v];if(P.type!=="model")return;const A=g.tile,O=c.featureIndex,N=A.getBucket(P);if(!(N&&N instanceof ES))return;const D=function(We,$e,He,ht){const Ke=We.getNodesInfo()[$e];if(Ke.hiddenByReplacement||!Ke.node.meshes)return;let pt=Number.MAX_VALUE;const Et=Ke.node,wt=He.tile,Ot=ht.calculatePosMatrix(wt.tileID.toUnwrapped(),ht.worldSize),It=Ke.evaluatedScale;let jt=0;ht.elevation&&Et.elevation&&(jt=Et.elevation*ht.elevation.exaggeration()),_e.mat4.translate(Ot,Ot,[(Et.anchor?Et.anchor[0]:0)*(It[0]-1),(Et.anchor?Et.anchor[1]:0)*(It[1]-1),jt]),_e.mat4.scale(Ot,Ot,It);const Dt=He.queryGeometry,Vt=Dt.isPointQuery()?Dt.screenBounds:Dt.screenGeometry,_n=function(Zn){const Cn=_e.mat4.multiply([],Ot,Zn.matrix);_e.mat4.multiply(Cn,ht.expandedFarZProjMatrix,Cn);for(let Ln=0;Ln<Zn.meshes.length;++Ln){const bn=Zn.meshes[Ln];if(Ln===Zn.lightMeshIndex)continue;const _r=yz(Vt,ht,Cn,bn.aabb);_r!=null&&(pt=Math.min(_r,pt))}if(Zn.children)for(const Ln of Zn.children)_n(Ln)};if(_n(Et),pt===Number.MAX_VALUE)return;const gn=new zi(0,0);return Iz(wt.tileID.canonical,gn,Ke.node.anchor[0],Ke.node.anchor[1]),{intersectionZ:pt,position:gn,feature:Ke.feature}}(N,O,g,m);if(!D)return;const{z:k,x:U,y:X}=A.tileID.canonical,{feature:Q,intersectionZ:le,position:oe}=D;let re={};Q.id!==void 0&&(re=d.sourceCache.getFeatureState(P.sourceLayer,Q.id));const me=new a0({},k,U,X,Q.id);me.tile=this.tileID.canonical,me.state=re,me.properties=Q.properties,me.geometry={type:"Point",coordinates:[oe.lng,oe.lat]};let Se=this.serializedLayersCache.get(v);Se||(Se=P.serialize(),Se.id=v,this.serializedLayersCache.set(v,Se)),me.source=Se.source,me.sourceLayer=Se["source-layer"],me.layer=wi({},Se);let Me=!1;for(const We of L){this.updateFeatureProperties(me,We);const{filter:$e}=We;if($e){if(Q.properties=me.properties,$e.needGeometry){if(!$e.filter(new bi(this.tileID.overscaledZ),Q,this.tileID.canonical))continue}else if(!$e.filter(new bi(this.tileID.overscaledZ),Q))continue}Me=!0,We.targetId&&this.addFeatureVariant(me,We)}Me&&this.appendToResult(a,v,O,me,le)}updateFeatureProperties(a,c,d){if(c.properties){const g={};for(const m in c.properties){const v=c.properties[m].evaluate({zoom:this.z},a._vectorTileFeature,a.state,a.tile,d);v!=null&&(g[m]=v)}a.properties=g}}addFeatureVariant(a,c,d){const g={target:c.target,namespace:c.namespace,uniqueFeatureID:c.uniqueFeatureID};c.properties&&(g.properties=a.properties),a.variants=a.variants||{},a.variants[c.targetId]=a.variants[c.targetId]||[],a.variants[c.targetId].push(g)}appendToResult(a,c,d,g,m){let v=a[c];v===void 0&&(v=a[c]=[]),v.push({featureIndex:d,feature:g,intersectionZ:m})}lookupSymbolFeatures(a,c,d,g,m){const v={};this.loadVTLayers();for(const E of a)this.loadMatchingFeature(v,{bucketIndex:c,sourceLayerIndex:d,featureIndex:E,layoutVertexArrayOffset:0},g,m);return v}loadFeature(a){const{featureIndex:c,sourceLayerIndex:d}=a;this.loadVTLayers();const g=this.sourceLayerCoder.decode(d),m=this.vtFeatures[g];if(m[c])return m[c];const v=this.vtLayers[g].feature(c);return m[c]=v,v}hasLayer(a){for(const c of this.bucketLayerIDs)for(const d of c)if(a===d)return!0;return!1}getId(a,c){let d=a.id;if(this.promoteId){const g=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[c];if(g!=null)if(Array.isArray(g)){if(!this.promoteIdExpression){const m=q(g);if(m.result!=="success"){const v=m.value.map(E=>`${E.key}: ${E.message}`).join(", ");return void ti(`Failed to create expression for promoteId: ${v}`)}this.promoteIdExpression=m.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new xh),d=this.promoteIdExpression.evaluate({zoom:0},a)}else d=a.properties[g];typeof d=="boolean"&&(d=Number(d))}return d}}function b6(h,a,c,d,g){return yr(h,(m,v)=>{const E=a instanceof xc?a.get(v):null;return E&&E.evaluate?E.evaluate(c,d,g):E})}function See(h,a){return a-h}Mt(v6,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const x6=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class $3{static from(a){if(!(a instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[c,d]=new Uint8Array(a,0,2);if(c!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=d>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const m=x6[15&d];if(!m)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(a,2,1),[E]=new Uint32Array(a,4,1);return new $3(E,v,m,a)}constructor(a,c=64,d=Float64Array,g){if(isNaN(a)||a<0)throw new Error(`Unpexpected numItems value: ${a}.`);this.numItems=+a,this.nodeSize=Math.min(Math.max(+c,2),65535),this.ArrayType=d,this.IndexArrayType=a<65536?Uint16Array:Uint32Array;const m=x6.indexOf(this.ArrayType),v=2*a*this.ArrayType.BYTES_PER_ELEMENT,E=a*this.IndexArrayType.BYTES_PER_ELEMENT,P=(8-E%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${d}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+E+P,2*a),this._pos=2*a,this._finished=!0):(this.data=new ArrayBuffer(8+v+E+P),this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+E+P,2*a),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=c,new Uint32Array(this.data,4,1)[0]=a)}add(a,c){const d=this._pos>>1;return this.ids[d]=d,this.coords[this._pos++]=a,this.coords[this._pos++]=c,d}finish(){const a=this._pos>>1;if(a!==this.numItems)throw new Error(`Added ${a} items when expected ${this.numItems}.`);return H3(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(a,c,d,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:v,nodeSize:E}=this,P=[0,m.length-1,0],L=[];for(;P.length;){const A=P.pop()||0,O=P.pop()||0,N=P.pop()||0;if(O-N<=E){for(let X=N;X<=O;X++){const Q=v[2*X],le=v[2*X+1];Q>=a&&Q<=d&&le>=c&&le<=g&&L.push(m[X])}continue}const D=N+O>>1,k=v[2*D],U=v[2*D+1];k>=a&&k<=d&&U>=c&&U<=g&&L.push(m[D]),(A===0?a<=k:c<=U)&&(P.push(N),P.push(D-1),P.push(1-A)),(A===0?d>=k:g>=U)&&(P.push(D+1),P.push(O),P.push(1-A))}return L}within(a,c,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:m,nodeSize:v}=this,E=[0,g.length-1,0],P=[],L=d*d;for(;E.length;){const A=E.pop()||0,O=E.pop()||0,N=E.pop()||0;if(O-N<=v){for(let X=N;X<=O;X++)S6(m[2*X],m[2*X+1],a,c)<=L&&P.push(g[X]);continue}const D=N+O>>1,k=m[2*D],U=m[2*D+1];S6(k,U,a,c)<=L&&P.push(g[D]),(A===0?a-d<=k:c-d<=U)&&(E.push(N),E.push(D-1),E.push(1-A)),(A===0?a+d>=k:c+d>=U)&&(E.push(D+1),E.push(O),E.push(1-A))}return P}}function H3(h,a,c,d,g,m){if(g-d<=c)return;const v=d+g>>1;w6(h,a,v,d,g,m),H3(h,a,c,d,v-1,1-m),H3(h,a,c,v+1,g,1-m)}function w6(h,a,c,d,g,m){for(;g>d;){if(g-d>600){const L=g-d+1,A=c-d+1,O=Math.log(L),N=.5*Math.exp(2*O/3),D=.5*Math.sqrt(O*N*(L-N)/L)*(A-L/2<0?-1:1);w6(h,a,c,Math.max(d,Math.floor(c-A*N/L+D)),Math.min(g,Math.floor(c+(L-A)*N/L+D)),m)}const v=a[2*c+m];let E=d,P=g;for(Kb(h,a,d,c),a[2*g+m]>v&&Kb(h,a,d,g);E<P;){for(Kb(h,a,E,P),E++,P--;a[2*E+m]<v;)E++;for(;a[2*P+m]>v;)P--}a[2*d+m]===v?Kb(h,a,d,P):(P++,Kb(h,a,P,g)),P<=c&&(d=P+1),c<=P&&(g=P-1)}}function Kb(h,a,c,d){G3(h,c,d),G3(a,2*c,2*d),G3(a,2*c+1,2*d+1)}function G3(h,a,c){const d=h[a];h[a]=h[c],h[c]=d}function S6(h,a,c,d){const g=h-c,m=a-d;return g*g+m*m}i.$=qs,i.A=ko,i.B=Fc,i.C=Wu,i.D=Qv,i.E=ql,i.F=2,i.G=Pb,i.H=PN,i.I=No,i.J=class extends AS{},i.K=fc,i.L=Si,i.M=Up,i.N=Vu,i.O=qu,i.P=Ut,i.Q=$c,i.R=bs,i.S=jf,i.T=S3,i.U=sf,i.V=AS,i.W=Ie,i.X=q,i.Y=ls,i.Z=ea,i._=jo,i.a=function(h){return Ee.API_CDN_URL_REGEX.test(h)},i.a$=K,i.a0=Ko,i.a1=of,i.a2=Hd,i.a3=Ml,i.a4=function(h){const a=h.value;let c=[];if(!a)return c;const d=fc(a);return d!=="string"?(c=c.concat([new AS(h.key,a,`string expected, "${d}" found`)]),c):(vz(a,!0)||(c=c.concat([new AS(h.key,a,`invalid url "${a}"`)])),c)},i.a5=qt,i.a6=wo,i.a7=Ra,i.a8=En,i.a9=class{constructor(h){this.specification=h}possiblyEvaluate(h,a){return Fa(h.expression.evaluate(a))}interpolate(h,a,c){return{x:dr(h.x,a.x,c),y:dr(h.y,a.y,c),z:dr(h.z,a.z,c),azimuthal:dr(h.azimuthal,a.azimuthal,c),polar:dr(h.polar,a.polar,c)}}},i.aA=function(h,a){const c={};for(let d=0;d<a.length;d++){const g=a[d];g in h&&(c[g]=h[g])}return c},i.aB=$f,i.aC=Ma,i.aD=class{constructor(h){this.entries={},this.scheduler=h}request(h,a,c,d){const g=this.entries[h]=this.entries[h]||{callbacks:[]};if(g.result){const[m,v]=g.result;return this.scheduler?this.scheduler.add(()=>{d(m,v)},a):d(m,v),()=>{}}return g.callbacks.push(d),g.cancel||(g.cancel=c((m,v)=>{g.result=[m,v];for(const E of g.callbacks)this.scheduler?this.scheduler.add(()=>{E(m,v)},a):E(m,v);setTimeout(()=>delete this.entries[h],3e3)})),()=>{g.result||(g.callbacks=g.callbacks.filter(m=>m!==d),g.callbacks.length||(g.cancel(),delete this.entries[h]))}}},i.aE=function(h,a,c){const d=JSON.stringify(h.request);return h.data&&(this.deduped.entries[d]={result:[null,h.data]}),this.deduped.request(d,{type:"parseTile",isSymbolTile:h.isSymbolTile,zoom:h.tileZoom},g=>{const m=Oa(h.request,(v,E,P,L)=>{v?g(v):E&&g(null,{vectorTile:c?void 0:new bf.VectorTile(new oi(E)),rawData:E,cacheControl:P,expires:L})});return()=>{m.cancel(),g()}},a)},i.aF=function(h){gi++,gi>Or&&(h.getActor().send("enforceCacheSizeLimit",vr),gi=0)},i.aG=function(h){return h<=1?1:Math.pow(2,Math.floor(Math.log(h)/Math.LN2))},i.aH=mn,i.aI=sz,i.aJ=fz,i.aK=az,i.aL=function(h,a){const c=document.createElement("video");c.muted=!0,c.onloadstart=function(){a(null,c)};for(let d=0;d<h.length;d++){const g=document.createElement("source");Fl(h[d])||(c.crossOrigin="Anonymous"),g.src=h[d],c.appendChild(g)}return{cancel:()=>{}}},i.aM=vS,i.aN=function(h){return fetch(h).then(a=>a.arrayBuffer()).then(a=>m6(a,0,h))},i.aO=y6,i.aP=class{constructor(h,a,c,d){this.id=h,this.position=a!=null?new zi(a[0],a[1]):new zi(0,0),this.orientation=c??[0,0,0],this.nodes=d,this.uploaded=!1,this.aabb=new tr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(h,a){if(_e.mat4.multiply(h.matrix,a,h.matrix),h.meshes)for(const c of h.meshes){const d=tr.applyTransformFast(c.aabb,h.matrix);this.aabb.encapsulate(d)}if(h.children)for(const c of h.children)this._applyTransformations(c,h.matrix)}computeBoundsAndApplyParent(){const h=_e.mat4.identity([]);for(const a of this.nodes)this._applyTransformations(a,h)}computeModelMatrix(h,a,c,d,g,m,v=!1){Az(this.matrix,this,h.transform,this.position,a,c,d,g,m,v)}upload(h){if(!this.uploaded){for(const a of this.nodes)C3(a,h);for(const a of this.nodes)TS(a);this.uploaded=!0}}destroy(){for(const h of this.nodes)I3(h)}},i.aQ=er,i.aR=Rb,i.aS=Mc,i.aT=xa,i.aU=Ac,i.aV=Ms,i.aW=Xn,i.aX=Vp,i.aY=yS,i.aZ=function(){is.isLoading()||is.isLoaded()||fo()!=="deferred"||ba()},i.a_=lf,i.aa=bi,i.ab=de,i.ac=o,i.ad=_e,i.ae=Vr,i.af=xc,i.ag=Rl,i.ah=dr,i.ai=On,i.aj=Ru,i.ak=Rn,i.al=Ei,i.am=class{constructor(h){this.specification=h}possiblyEvaluate(h,a){return function([c,d]){const g=Fa([1,c,d]);return{x:g.x,y:g.y,z:g.z}}(h.expression.evaluate(a))}interpolate(h,a,c){return{x:dr(h.x,a.x,c),y:dr(h.y,a.y,c),z:dr(h.z,a.z,c)}}},i.an=function(h,a,c=0,d=!0){const g=new Ut(c,c),m=h.sub(g),v=a.add(g),E=[m,new Ut(v.x,m.y),v,new Ut(m.x,v.y)];return d&&E.push(m.clone()),E},i.ao=function(h,a){const c=[];for(let d=0;d<h.length;d++){const g=pi(d-1,-1,h.length-1),m=pi(d+1,-1,h.length-1),v=h[d],E=h[m],P=h[g].sub(v).unit(),L=E.sub(v).unit(),A=L.angleWithSep(P.x,P.y),O=P.add(L).unit().mult(-1*a/Math.sin(A/2));c.push(v.add(O))}return c},i.ap=HN,i.aq=it,i.ar=function(h,a,c=0){return _e.vec3.fromValues(((a.x-c)*h.scale-h.x)*On,(a.y*h.scale-h.y)*On,Ng(a.z,a.y))},i.as=Er,i.at=nS,i.au=function(h){let a=1/0,c=1/0,d=-1/0,g=-1/0;for(const m of h)a=Math.min(a,m.x),c=Math.min(c,m.y),d=Math.max(d,m.x),g=Math.max(g,m.y);return{min:new Ut(a,c),max:new Ut(d,g)}},i.av=gl,i.aw=rt,i.ax=_,i.ay=Un,i.az=ml,i.b=function(h){return Ee.API_FONTS_REGEX.test(h)},i.b$=wS,i.b0=a0,i.b1=Oo,i.b2=Od,i.b3=Hg,i.b4=$,i.b5=Sc,i.b6=zh,i.b7=mr,i.b8=Da,i.b9=e_,i.bA=W2,i.bB=d3,i.bC=BN,i.bD=u3,i.bE=$3,i.bF=pi,i.bG=fi,i.bH=Uo,i.bI=function(h,a,c){h[4*a+0]=c[0],h[4*a+1]=c[1],h[4*a+2]=c[2],h[4*a+3]=c[3]},i.bJ=Ju,i.bK=Zu,i.bL=tp,i.bM=ps,i.bN=bu,i.bO=zi,i.bP=XN,i.bQ=Wt,i.bR=Ar,i.bS=pz,i.bT=fn,i.bU=po,i.bV=function(h,a,c,d,g,m,v,E,P){if(P.name==="globe")return po(h,a,new fn(c,d,g),!1);const L=Rb({z:c,x:d,y:g},P);return new tr([(m+L.x/L.scale)*a,a*(L.y/L.scale),v],[(m+L.x2/L.scale)*a,a*(L.y2/L.scale),E])},i.bW=function(h,a,c){let d=0;for(let g=0;g<2;++g)h[g]>0&&(d+=(h[g]-0)*(h[g]-0)),a[g]<0&&(d+=(0-a[g])*(0-a[g]));return d},i.bX=Cc,i.bY=Kp,i.bZ=function(h){const a=_e.mat4.identity(new Float64Array(16));_e.mat4.multiply(a,h.pixelMatrix,h.globeMatrix);const c=[0,Fo,0],d=[0,Yc,0];return _e.vec3.transformMat4(c,c,a),_e.vec3.transformMat4(d,d,a),[c[0]>0&&c[0]<=h.width&&c[1]>0&&c[1]<=h.height&&!yl(h,new zi(h.center.lat,90)),d[0]>0&&d[0]<=h.width&&d[1]>0&&d[1]<=h.height&&!yl(h,new zi(h.center.lat,-90))]},i.b_=function(h,a){const{scale:c}=h.tileTransform,d=c*On/(h.tileSize*Math.pow(2,a.zoom-h.tileID.overscaledZ+h.tileID.canonical.z));return _e.mat2.scale(new Float32Array(4),a.inverseAdjustmentMatrix,[d,d])},i.ba=b3,i.bb=function(h,a){const c=Rl(a.zoom);if(c===0)return us(h);const d=Ti(h),g=ra(d),m=gl(d.getWest())*a.worldSize,v=gl(d.getEast())*a.worldSize,E=Ma(d.getNorth())*a.worldSize,P=Ma(d.getSouth())*a.worldSize,L=[m,E,0],A=[v,E,0],O=[m,P,0],N=[v,P,0],D=_e.mat4.invert([],a.globeMatrix);return _e.vec3.transformMat4(L,L,D),_e.vec3.transformMat4(A,A,D),_e.vec3.transformMat4(O,O,D),_e.vec3.transformMat4(N,N,D),g[0]=to(g[0],O,c),g[1]=to(g[1],N,c),g[2]=to(g[2],A,c),g[3]=to(g[3],L,c),tr.fromPoints(g)},i.bc=wa,i.bd=Di,i.be=to,i.bf=Lh,i.bg=Br,i.bh=kS,i.bi=oi,i.bj=Oa,i.bk=function(h,a){const c=[];for(const d in h)d in a||c.push(d);return c},i.bl=Li,i.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.bn=cn,i.bo=function(h,a){const{x:c,y:d}=h.point,g=ec(c,d,h.worldSize/h._pixelsPerMercatorPixel,0,0);return _e.mat4.multiply(g,g,as(us(a)))},i.bp=ir,i.bq=Vh,i.br=$n,i.bs=function(h,a,c,d,g){const m=5*a+2;h.float32[m+0]=c,h.float32[m+1]=d,h.float32[m+2]=g},i.bt=gS,i.bu=IN,i.bv=Te,i.bw=Ne,i.bx=Pd,i.by=_z,i.bz=G2,i.c=tt,i.c$=rS,i.c0=dz,i.c1=function(h){const a=dz(h,!0);return _e.mat2.invert([],[a[0],a[1],a[4],a[5]])},i.c2=Cr,i.c3=function(h){const{x:a,y:c}=h.point,{lng:d,lat:g}=h._center;return ec(a,c,h.worldSize,d,g)},i.c4=Dn,i.c5=zn,i.c6=yf,i.c7=function(h){const a=Math.round((h+45+360)%360/90)%4;return ar[a]},i.c8=45,i.c9=yi,i.cA=xd,i.cB=class extends Bh{constructor(h){super(h),this.current=jh}set(h,a,c){if(this.fetchUniformLocation(h,a)){for(let d=0;d<9;d++)if(c[d]!==this.current[d]){this.current=c,this.gl.uniformMatrix3fv(this.location,!1,c);break}}}},i.cC=hr,i.cD=function(h,a,c){const d=Rl(c.zoom),g=h.style.map._antialias,m=h.terrain&&h.terrain.exaggeration()>0;return d===0&&!g&&!m},i.cE=function(h){const a=h.pixelsPerMeter,c=a/Uo(1,h.center.lat),d=_e.mat4.identity(new Float64Array(16));return _e.mat4.translate(d,d,[h.point.x,h.point.y,0]),_e.mat4.scale(d,d,[c,c,a]),Float32Array.from(d)},i.cF=Ti,i.cG=function(h){const a=Cc-5;h=Un(h,-80.051129,a)/a*90;const c=Math.pow(Math.abs(Math.sin(Rn(h))),3);return Math.round(c*(Ed.length-1))},i.cH=function(h,a,c,d){const g=a.getNorth(),m=a.getSouth(),v=a.getWest(),E=a.getEast(),P=1<<h.z,L=E-v,A=g-m,O=L/ip,N=-A/Ed[c],D=[0,O,0,N,0,0,g,v,0];if(h.z>0){const k=180/d;_e.mat3.multiply(D,D,[k/L+1,0,0,0,k/A+1,0,-.5*k/O,.5*k/N,1])}return D[2]=P,D[5]=h.x,D[8]=h.y,D},i.cI=us,i.cJ=function(h,a,c){const d=_e.mat4.identity(new Float64Array(16)),g=(a/(1<<h)-.5)*Math.PI*2;return _e.mat4.rotateY(d,c.globeMatrix,g),Float32Array.from(d)},i.cK=class{isDataAvailableAtPoint(h){const a=this._source();if(this.isUsingMockSource()||!a||h.y<0||h.y>1)return!1;const c=a.getSource().maxzoom,d=1<<c,g=Math.floor(h.x),m=Math.floor((h.x-g)*d),v=Math.floor(h.y*d),E=this.findDEMTileFor(new mn(c,g,c,m,v));return!(!E||!E.dem)}getAtPointOrZero(h,a=0){return this.getAtPoint(h,a)||0}getAtPoint(h,a,c=!0){if(this.isUsingMockSource())return null;a==null&&(a=null);const d=this._source();if(!d||h.y<0||h.y>1)return a;const g=d.getSource().maxzoom,m=1<<g,v=Math.floor(h.x),E=h.x-v,P=new mn(g,v,g,Math.floor(E*m),Math.floor(h.y*m)),L=this.findDEMTileFor(P);if(!L||!L.dem)return a;const A=L.dem,O=1<<L.tileID.canonical.z,N=(E*O-L.tileID.canonical.x)*A.dim,D=(h.y*O-L.tileID.canonical.y)*A.dim,k=Math.floor(N),U=Math.floor(D);return(c?this.exaggeration():1)*dr(dr(A.get(k,U),A.get(k,U+1),D-U),dr(A.get(k+1,U),A.get(k+1,U+1),D-U),N-k)}getAtTileOffset(h,a,c){const d=1<<h.canonical.z;return this.getAtPointOrZero(new o(h.wrap+(h.canonical.x+a/On)/d,(h.canonical.y+c/On)/d))}getAtTileOffsetFunc(h,a,c,d){return g=>{const m=this.getAtTileOffset(h,g.x,g.y),v=d.upVector(h.canonical,g.x,g.y),E=d.upVectorScale(h.canonical,a,c).metersToTile;return _e.vec3.scale(v,v,m*E),v}}getForTilePoints(h,a,c,d){if(this.isUsingMockSource())return!1;const g=Jv.create(this,h,d);return!!g&&(a.forEach(m=>{m[2]=this.exaggeration()*g.getElevationAt(m[0],m[1],c)}),!0)}getMinMaxForTile(h){if(this.isUsingMockSource())return null;const a=this.findDEMTileFor(h);if(!a||!a.dem)return null;const c=a.dem.tree,d=a.tileID,g=1<<h.canonical.z-d.canonical.z;let m=h.canonical.x/g-d.canonical.x,v=h.canonical.y/g-d.canonical.y,E=0;for(let P=0;P<h.canonical.z-d.canonical.z&&!c.leaves[E];P++){m*=2,v*=2;const L=2*Math.floor(v)+Math.floor(m);E=c.childOffsets[E]+L,m%=1,v%=1}return{min:this.exaggeration()*c.minimums[E],max:this.exaggeration()*c.maximums[E]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(h,a,c){throw new Error("Pure virtual method called.")}pointCoordinate(h){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(h){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const h=this.visibleDemTiles;if(h.length===0)return null;let a=!1,c=Number.MAX_VALUE,d=Number.MIN_VALUE;for(const g of h){const m=this.getMinMaxForTile(g.tileID);m&&(c=Math.min(c,m.min),d=Math.max(d,m.max),a=!0)}return a?{min:c,max:d}:null}},i.cL=X1,i.cM=si,i.cN=function(h,a){return[Math.pow(h[0],2.2)*a,Math.pow(h[1],2.2)*a,Math.pow(h[2],2.2)*a]},i.cO=Vo,i.cP=Zt,i.cQ=zs,i.cR=256,i.cS=function(h,a){const c=[0,0,0],d=wa(us(a.canonical));return _e.vec3.transformMat4(c,c,d),_e.vec3.transformMat4(c,c,h),c},i.cT=h=>({u_camera_to_center_distance:new ps(h),u_extrude_scale:new qm(h),u_device_pixel_ratio:new ps(h),u_matrix:new Ju(h),u_inv_rot_matrix:new Ju(h),u_merc_center:new Zu(h),u_tile_id:new tp(h),u_zoom_transition:new ps(h),u_up_dir:new tp(h),u_emissive_strength:new ps(h)}),i.cU=h=>({u_matrix:new Ju(h),u_pixels_to_tile_units:new qm(h),u_device_pixel_ratio:new ps(h),u_width_scale:new ps(h),u_floor_width_scale:new ps(h),u_units_to_pixels:new Zu(h),u_dash_image:new bu(h),u_gradient_image:new bu(h),u_image_height:new ps(h),u_texsize:new Zu(h),u_tile_units_to_pixels:new ps(h),u_alpha_discard_threshold:new ps(h),u_trim_offset:new Zu(h),u_trim_fade_range:new Zu(h),u_trim_color:new np(h),u_emissive_strength:new ps(h),u_zbias_factor:new ps(h),u_tile_to_meter:new ps(h)}),i.cV=h=>({u_matrix:new Ju(h),u_texsize:new Zu(h),u_pixels_to_tile_units:new qm(h),u_device_pixel_ratio:new ps(h),u_width_scale:new ps(h),u_floor_width_scale:new ps(h),u_image:new bu(h),u_units_to_pixels:new Zu(h),u_tile_units_to_pixels:new ps(h),u_alpha_discard_threshold:new ps(h),u_trim_offset:new Zu(h),u_trim_fade_range:new Zu(h),u_trim_color:new np(h),u_emissive_strength:new ps(h),u_zbias_factor:new ps(h),u_tile_to_meter:new ps(h)}),i.cW=Jl,i.cX=ae,i.cY=Mn,i.cZ=op,i.c_=(h,a,c,d,g,m)=>{const v=h.transform,E=v.projection.name==="globe";let P;if(m.paint.get("circle-pitch-alignment")==="map")if(E){const A=Vo(v.zoom,a.canonical)*v._pixelsPerMercatorPixel;P=Float32Array.from([A,0,0,A])}else P=v.calculatePixelsToTileUnitsMatrix(c);else P=new Float32Array([v.pixelsToGLUnits[0],0,0,v.pixelsToGLUnits[1]]);const L={u_camera_to_center_distance:h.transform.getCameraToCenterDistance(v.projection),u_matrix:h.translatePosMatrix(a.projMatrix,c,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:$t.devicePixelRatio,u_extrude_scale:P,u_inv_rot_matrix:Dl,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:m.paint.get("circle-emissive-strength")};if(E){L.u_inv_rot_matrix=d,L.u_merc_center=g,L.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],L.u_zoom_transition=Rl(v.zoom);const A=g[0]*On,O=g[1]*On;L.u_up_dir=v.projection.upVector(new fn(0,0,0),A,O)}return L},i.ca=sp,i.cb=np,i.cc=function(h,a,c){const d=Math.sqrt(h*h+a*a+c*c),g=d>0?Math.acos(c/d)*xr:0;let m=h!==0||a!==0?Math.atan2(-a,-h)*xr+90:0;return m<0&&(m+=360),[d,m,g]},i.cd=y,i.ce=tr,i.cf=Fa,i.cg=function(h){return[Math.pow(h[0],1/2.2),Math.pow(h[1],1/2.2),Math.pow(h[2],1/2.2)]},i.ch=function(h,a){return h.readFields(bQ,{icons:[]},a)},i.ci=function(h){return h({pluginStatus:Bi,pluginURL:vi}),ji.on("pluginStateChange",h),h},i.cj=MS,i.ck=Kv,i.cl=h3,i.cm=iu,i.cn=cs,i.co=Nn,i.cp=so,i.cq=ki,i.cr=function(h){const a=h.indexOf(Wd);return a>=0?h.slice(0,a):h},i.cs=function(h){return h.indexOf(Wd)>=0},i.ct=function(h){const a=h.indexOf(Wd);return a>=0?h.slice(a+1):""},i.cu=function(h){const a=[],c=h.id;return c===void 0&&a.push({message:`layers.${c}: missing required property "id"`}),h.render===void 0&&a.push({message:`layers.${c}: missing required method "render"`}),h.renderingMode&&h.renderingMode!=="2d"&&h.renderingMode!=="3d"&&a.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),a},i.cv=function(h,a,c,d){return h.type==="custom"?new sQ(h,a):new yQ[h.type](h,a,c,d)},i.cw=Vi,i.cx=class extends a0{constructor(h,a){super(h._vectorTileFeature,h._z,h._x,h._y,h.id),h.state&&(this.state=Object.assign({},h.state)),this.target=a.target,this.namespace=a.namespace,a.properties&&(this.properties=a.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=h.source,this.sourceLayer=h.sourceLayer,this.layer=h.layer)}toJSON(){const h=super.toJSON();return h.target=this.target,h.namespace=this.namespace,h}},i.cy=ji,i.cz=Wo,i.d=function(h){return Ee.API_TILEJSON_REGEX.test(h)},i.d$=_6,i.d0=ws,i.d1=(h,a,c,d,g,m,v,E)=>{const P=h.transform,L=P.pitch<15?Eb(.07,.7,Un((14-P.zoom)/5,0,1)):.07,A=c.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:Mb(h,a,c,d),u_texsize:a.imageAtlasTexture?a.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:P.calculatePixelsToTileUnitsMatrix(a),u_device_pixel_ratio:g,u_width_scale:m,u_floor_width_scale:v,u_image:0,u_tile_units_to_pixels:d_(a,P),u_units_to_pixels:[1/P.pixelsToGLUnits[0],1/P.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:E,u_trim_fade_range:c.paint.get("line-trim-fade-range"),u_trim_color:c.paint.get("line-trim-color").toRenderColor(A?null:c.lut).toArray01(),u_emissive_strength:c.paint.get("line-emissive-strength"),u_zbias_factor:L,u_tile_to_meter:y(a.tileID.canonical,0)}},i.d2=(h,a,c,d,g,m,v,E,P)=>{const L=h.transform,A=L.calculatePixelsToTileUnitsMatrix(a),O=c.paint.get("line-trim-color-use-theme").constantOr("default")==="none",N=L.pitch<15?Eb(.07,.7,Un((14-L.zoom)/5,0,1)):.07;return{u_matrix:Mb(h,a,c,d),u_pixels_to_tile_units:A,u_device_pixel_ratio:m,u_width_scale:v,u_floor_width_scale:E,u_units_to_pixels:[1/L.pixelsToGLUnits[0],1/L.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:g,u_texsize:p_(c)&&a.lineAtlasTexture?a.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:d_(a,h.transform),u_alpha_discard_threshold:0,u_trim_offset:P,u_trim_fade_range:c.paint.get("line-trim-fade-range"),u_trim_color:c.paint.get("line-trim-color").toRenderColor(O?null:c.lut).toArray01(),u_emissive_strength:c.paint.get("line-emissive-strength"),u_zbias_factor:N,u_tile_to_meter:y(a.tileID.canonical,0)}},i.d3=hn,i.d4=Bg,i.d5=Ng,i.d6=yb,i.d7=Bn,i.d8=Fv,i.d9=cp,i.dA=Wm,i.dB=ur,i.dC=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.dD=Ir,i.dE=qo,i.dF=wu,i.dG=function([h,a,c]){const d=Math.hypot(h,a,c),g=Math.atan2(h,c),m=.5*Math.PI-Math.acos(-a/d);return new zi(Dn(g),Dn(m))},i.dH=T3,i.dI=function(h){const a=h.navigator?h.navigator.userAgent:null;return!!function(c){if(Ia==null){const d=c.navigator?c.navigator.userAgent:null;Ia=!!c.safari||!(!d||!(/\b(iPad|iPhone|iPod)\b/.test(d)||d.match("Safari")&&!d.match("Chrome")))}return Ia}(h)&&a&&(a.match("Version/15.4")||a.match("Version/15.5")||a.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},i.dJ=function(h,a){vr=h,Or=a},i.dK=yl,i.dL=Xc,i.dM=function(h){const a=[0,0,0],c=_e.mat4.identity(new Float64Array(16));return _e.mat4.multiply(c,h.pixelMatrix,h.globeMatrix),_e.vec3.transformMat4(a,a,c),new Ut(a[0],a[1])},i.dN=function(h,a,c=!1){if(Bi===Ea||Bi===$i||Bi===ta)throw new Error("setRTLTextPlugin cannot be called multiple times.");vi=$t.resolveURL(h),Bi=Ea,Ga=a,Ba(),c||ba()},i.dO=fo,i.dP=function(){MS().acquire(O3)},i.dQ=function(){const h=Fb;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(O3),Fb=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.dR=b_,i.dS=function(h){const a=Xi();if(!a)return;const c=a.delete(qn);h&&c.catch(h).then(()=>h())},i.dT=jb,i.dU=l6,i.dV=function(h){F3=$t.resolveURL(h),i0||(i0=new Qv(MS(),new ql)),i0.broadcast("setDracoUrl",F3)},i.dW=c6,i.dX=function(h){r0=$t.resolveURL(h),i0||(i0=new Qv(MS(),new ql)),i0.broadcast("setMeshoptUrl",r0)},i.dY=Mt,i.dZ=Xp,i.d_=hp,i.da=450,i.db=7,i.dc=aQ,i.dd=Mi,i.de=Fm,i.df=256,i.dg=as,i.dh=So,i.di=Hs,i.dj=Ec,i.dk=function(h,a,c,d,g){return Un((h-a)/(c-a)*(g-d)+d,d,g)},i.dl=Bf,i.dm=Hf,i.dn=class{constructor(h,a,c,d){this.context=h,this.format=d,this.size=c,this.texture=h.gl.createTexture();const[g,m,v]=this.size,{gl:E}=h;E.bindTexture(E.TEXTURE_3D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(!1),E.texImage3D(E.TEXTURE_3D,0,this.format,g,m,v,0,x3(this.format),w3(this.format),a.data)}bind(h,a){const{context:c}=this,{gl:d}=c;d.bindTexture(d.TEXTURE_3D,this.texture),h!==this.minFilter&&(d.texParameteri(d.TEXTURE_3D,d.TEXTURE_MAG_FILTER,h),d.texParameteri(d.TEXTURE_3D,d.TEXTURE_MIN_FILTER,h),this.minFilter=h),a!==this.wrapS&&(d.texParameteri(d.TEXTURE_3D,d.TEXTURE_WRAP_S,a),d.texParameteri(d.TEXTURE_3D,d.TEXTURE_WRAP_T,a),this.wrapS=a)}destroy(){const{gl:h}=this.context;h.deleteTexture(this.texture),this.texture=null}},i.dp=E3,i.dq=[1,1,1],i.dr=Jv,i.ds=Zv,i.dt=Nh,i.du=qf,i.dv=al,i.dw=Jd,i.dx=df,i.dy=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ut(1/0,1/0),max:new Ut(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(h,a=!1){const c=V2(new Ut(0,0),new Ut(On,On),h),d=[];if(a&&!Qp(c,this._globalClipBounds))return d;for(const g of this._activeRegions){if(g.hiddenByOverlap||!Qp(c,g))continue;const m=i3(g.min,g.max,h);d.push({min:m.min,max:m.max,sourceId:this._sourceIds[g.priority],footprint:g.footprint,footprintTileId:g.tileId,order:g.order,clipMask:g.clipMask,clipScope:g.clipScope})}return d}setSources(h){this._setSources(h.map(a=>({getSourceId:()=>a.cache.id,getFootprints:()=>{const c=[];for(const d of a.cache.getVisibleCoordinates()){const g=a.cache.getTile(d).buckets[a.layer];g&&g.updateFootprints(d.toUnwrapped(),c)}return c},getOrder:()=>a.order,getClipMask:()=>a.clipMask,getClipScope:()=>a.clipScope})))}_addSource(h){const a=h.getFootprints();if(a.length===0)return;const c=h.getOrder(),d=h.getClipMask(),g=h.getClipScope();for(const m of a){if(!m.footprint)continue;const v=V2(m.footprint.min,m.footprint.max,m.id);this._activeRegions.push({min:v.min,max:v.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:m.id,footprint:m.footprint,order:c,clipMask:d,clipScope:g})}this._sourceIds.push(h.getSourceId())}_computeReplacement(){this._activeRegions.sort((a,c)=>a.priority-c.priority||Bv(a.min,c.min)||Bv(a.max,c.max)||a.order-c.order||a.clipMask-c.clipMask||function(d,g){const m=(v,E)=>v+E;return d.length-g.length||d.reduce(m,"").localeCompare(g.reduce(m,""))}(a.clipScope,c.clipScope));let h=this._activeRegions.length!==this._prevRegions.length;if(!h){let a=0;for(;!h&&a!==this._activeRegions.length;){const c=this._activeRegions[a],d=this._prevRegions[a];h=c.priority!==d.priority||!q2(c,d)||c.order!==d.order||c.clipMask!==d.clipMask||!cn(c.clipScope,d.clipScope),++a}}if(h){++this._updateTime;for(const c of this._activeRegions)c.order!==Wm&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,c.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,c.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,c.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,c.max.y));const a=c=>{const d=this._activeRegions;if(c>=d.length)return c;const g=d[c].priority;for(;c<d.length&&d[c].priority===g;)++c;return c};if(this._sourceIds.length>1){let c=0,d=a(c);for(;c!==d;){let g=c;const m=c;for(;g!==d;){const v=this._activeRegions[g];v.hiddenByOverlap=!1;for(let E=0;E<m;E++){const P=this._activeRegions[E];if(!P.hiddenByOverlap&&v.order===Wm&&Qp(v,P)&&(v.hiddenByOverlap=H2(v.footprint,v.tileId,P.footprint,P.tileId),v.hiddenByOverlap))break}++g}c=d,d=a(c)}}}}_setSources(h){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let a=h.length-1;a>=0;a--)this._addSource(h[a]);this._computeReplacement()}},i.dz=class{constructor(h){this._createGrid(h),this._createPoles(h)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const h of this._poleSegments)h.destroy();for(const h of this._gridSegments)h.withSkirts.destroy(),h.withoutSkirts.destroy()}_fillGridMeshWithLods(h,a){const c=new Sc,d=new Ms,g=[],m=h+1+2,v=a[0]+1,E=a[0]+1+(1+a.length),P=(L,A,O)=>{let N=L===m-1?L-2:L===0?L:L-1;return N+=O?24575:0,[N,A]};for(let L=0;L<m;++L)c.emplaceBack(...P(L,0,!0));for(let L=0;L<v;++L)for(let A=0;A<m;++A)c.emplaceBack(...P(A,L,(A===0||A===m-1)&&!0));for(let L=0;L<a.length;++L){const A=a[L];for(let O=0;O<m;++O)c.emplaceBack(...P(O,A,!0))}for(let L=0;L<a.length;++L){const A=d.length,O=a[L]+1+2,N=new Ms;for(let U=0;U<O-1;U++){const X=U===O-2,Q=X?m*(E-a.length+L-U):m;for(let le=0;le<m-1;le++){const oe=U*m+le;U===0||X||le===0||le===m-2?(N.emplaceBack(oe+1,oe,oe+Q),N.emplaceBack(oe+Q,oe+Q+1,oe+1)):(d.emplaceBack(oe+1,oe,oe+Q),d.emplaceBack(oe+Q,oe+Q+1,oe+1))}}const D=Da.simpleSegment(0,A,c.length,d.length-A);for(let U=0;U<N.uint16.length;U+=3)d.emplaceBack(N.uint16[U],N.uint16[U+1],N.uint16[U+2]);const k=Da.simpleSegment(0,A,c.length,d.length-A);g.push({withoutSkirts:D,withSkirts:k})}return{vertices:c,indices:d,segments:g}}_createGrid(h){const a=this._fillGridMeshWithLods(ip,Ed);this._gridSegments=a.segments,this._gridBuffer=h.createVertexBuffer(a.vertices,mr.members),this._gridIndexBuffer=h.createIndexBuffer(a.indices,!0)}_createPoles(h){const a=new Ms;for(let v=0;v<=ip;v++)a.emplaceBack(0,v+1,v+2);this._poleIndexBuffer=h.createIndexBuffer(a,!0);const c=new Hs,d=new Hs,g=new Hs,m=new Hs;this._poleSegments=[];for(let v=0,E=0;v<yf;v++){const P=360/(1<<v);c.emplaceBack(0,-ml,0,.5,0),d.emplaceBack(0,-ml,0,.5,1),g.emplaceBack(0,-ml,0,.5,.5),m.emplaceBack(0,-ml,0,.5,.5);for(let L=0;L<=ip;L++){let A=L/ip,O=0;const N=dr(0,P,A),[D,k,U]=ap(go,_f,N,ml);c.emplaceBack(D,k,U,A,O),d.emplaceBack(D,k,U,A,1-O);const X=Rn(N);A=.5+.5*Math.sin(X),O=.5+.5*Math.cos(X),g.emplaceBack(D,k,U,A,O),m.emplaceBack(D,k,U,A,1-O)}this._poleSegments.push(Da.simpleSegment(E,0,66,64)),E+=66}this._poleNorthVertexBuffer=h.createVertexBuffer(c,or,!1),this._poleSouthVertexBuffer=h.createVertexBuffer(d,or,!1),this._texturedPoleNorthVertexBuffer=h.createVertexBuffer(g,or,!1),this._texturedPoleSouthVertexBuffer=h.createVertexBuffer(m,or,!1)}getGridBuffers(h,a){return[this._gridBuffer,this._gridIndexBuffer,a?this._gridSegments[h].withSkirts:this._gridSegments[h].withoutSkirts]}getPoleBuffers(h,a){return[a?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,a?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[h]]}},i.e=Ee,i.e0=v6,i.e1=up,i.e2=Cd,i.e3="hd_road_elevation",i.e4=class{static parseFrom(h,a){const c=Id.parse(h);if(!c)return[];let{vertices:d,features:g}=c;const m=1/y(a);g.sort((L,A)=>L.id-A.id),d.sort((L,A)=>L.id-A.id||L.idx-A.idx),d=d.filter((L,A,O)=>A===O.findIndex(N=>N.id===L.id&&N.idx===L.idx));const v=new Array;let E=0;const P=d.length;for(const L of g){if(L.constantHeight){v.push(new $g(L.id,L.bounds,L.constantHeight));continue}for(;E!==P&&d[E].id<L.id;)E++;if(E===P||d[E].id!==L.id)continue;const A=new Array,O=new Array,N=E;for(;E!==P&&d[E].id===L.id;){const D=d[E];if(A.push({position:D.position,height:D.height,extent:D.extent}),E!==N&&d[E-1].idx===D.idx-1){const k=E-N;O.push({a:k-1,b:k})}E++}v.push(new $g(L.id,L.bounds,void 0,A,O,m))}return v}},i.e5=yr,i.e6=Ao,i.e7=ON,i.e8=Wv,i.e9=function(h,a,c,d,g,m,v,E=1,P){h.createArrays(),h.tilePixelRatio=On/(512*h.overscaling),h.compareText={},h.iconsNeedLinear=!1;const L=h.layers[0].layout,A=h.layers[0]._unevaluatedLayout._values,O={};O.scaleFactor=E,O.textSizeScaleRange=L.get("text-size-scale-range"),O.iconSizeScaleRange=L.get("icon-size-scale-range");const[N,D]=O.textSizeScaleRange,[k,U]=O.iconSizeScaleRange;O.textScaleFactor=Un(O.scaleFactor,N,D),O.iconScaleFactor=Un(O.scaleFactor,k,U);const X=A["text-size"],Q=A["icon-size"];if(h.textSizeData.kind==="composite"){const{minZoom:Me,maxZoom:We}=h.textSizeData;O.compositeTextSizes=[X.possiblyEvaluate(new bi(Me),m),X.possiblyEvaluate(new bi(We),m)]}if(h.iconSizeData.kind==="composite"){const{minZoom:Me,maxZoom:We}=h.iconSizeData;O.compositeIconSizes=[Q.possiblyEvaluate(new bi(Me),m),Q.possiblyEvaluate(new bi(We),m)]}O.layoutTextSize=X.possiblyEvaluate(new bi(v+1),m),O.layoutIconSize=Q.possiblyEvaluate(new bi(v+1),m),O.textMaxSize=X.possiblyEvaluate(new bi(18),m);const le=L.get("symbol-placement"),oe=L.get("text-rotation-alignment")==="map"&&le!=="point",re=L.get("text-size");let me=!1;const Se=[];for(const Me of h.features){const We=L.get("text-font").evaluate(Me,{},m).join(","),$e=re.evaluate(Me,{},m)*O.textScaleFactor,He=O.layoutTextSize.evaluate(Me,{},m)*O.textScaleFactor,ht=O.layoutIconSize.evaluate(Me,{},m)*O.iconScaleFactor,Ke={horizontal:{},vertical:void 0},pt=Me.text;let Et,wt=[0,0];if(pt){const bn=pt.toString(),_r=L.get("text-letter-spacing").evaluate(Me,{},m)*Ne,Kn=L.get("text-line-height").evaluate(Me,{},m)*Ne,lr=Vn(bn)?_r:0,Lr=L.get("text-anchor").evaluate(Me,{},m),Qr=L.get("text-variable-anchor");if(!Qr){const Gi=L.get("text-radial-offset").evaluate(Me,{},m);wt=Gi?BN(Lr,[Gi*Ne,f3]):L.get("text-offset").evaluate(Me,{},m).map(Ca=>Ca*Ne)}let Fr=oe?"center":L.get("text-justify").evaluate(Me,{},m);const ui=le==="point",Jr=ui?L.get("text-max-width").evaluate(Me,{},m)*Ne:1/0,xi=Gi=>{h.allowVerticalPlacement&&en(bn)&&(Ke.vertical=c3(pt,a,c,g,We,Jr,Kn,Lr,Gi,lr,wt,Vh.vertical,!0,He,$e,P))};if(!oe&&Qr){const Gi=Fr==="auto"?Qr.map(zr=>d3(zr)):[Fr];let Ca=!1;for(let zr=0;zr<Gi.length;zr++){const Ii=Gi[zr];if(!Ke.horizontal[Ii])if(Ca)Ke.horizontal[Ii]=Ke.horizontal[0];else{const Ya=c3(pt,a,c,g,We,Jr,Kn,"center",Ii,lr,wt,Vh.horizontal,!1,He,$e,P);Ya&&(Ke.horizontal[Ii]=Ya,Ca=Ya.positionedLines.length===1)}}xi("left")}else{if(Fr==="auto"&&(Fr=d3(Lr)),ui||L.get("text-writing-mode").indexOf("horizontal")>=0||!en(bn)){const Gi=c3(pt,a,c,g,We,Jr,Kn,Lr,Fr,lr,wt,Vh.horizontal,!1,He,$e,P);Gi&&(Ke.horizontal[Fr]=Gi)}xi(ui?"left":Fr)}}let Ot,It,jt,Dt,Vt,_n=!1;if(Me.icon&&Me.icon.hasPrimary()){const bn=FN(Me.icon,h.iconSizeData,A["icon-size"],m,h.zoom,Me,P,O.iconScaleFactor);Ot=bn.iconPrimary,It=bn.iconSecondary;const _r=Ot.toString(),Kn=d.get(_r);Kn&&(jt=L.get("icon-offset").evaluate(Me,{},m),Dt=L.get("icon-anchor").evaluate(Me,{},m),Vt=L.get("icon-text-fit").evaluate(Me,{},m),Et=zJ(g.get(_r),It?g.get(It.toString()):void 0,jt,Dt),_n=Kn.sdf,h.sdfIcons===void 0?h.sdfIcons=Kn.sdf:h.sdfIcons!==Kn.sdf&&ti("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Kn.pixelRatio!==h.pixelRatio||L.get("icon-rotate").constantOr(1)!==0)&&(h.iconsNeedLinear=!0))}me=me||!(!Me.icon||!Me.icon.hasSecondary());const gn=p3(Ke.horizontal)||Ke.vertical;h.iconsInText||(h.iconsInText=!!gn&&gn.iconsInText);const Zn=He*O.textScaleFactor/Ne,{defaultShapedIcon:Cn,verticallyShapedIcon:Ln}=HJ(h,Et,L,Me,m,Ke,Zn,jt,Vt);Et=Cn,Se.push({feature:Me,shapedTextOrientations:Ke,shapedText:gn,shapedIcon:Et,iconPrimary:Ot,iconSecondary:It,iconOffset:jt,iconAnchor:Dt,verticallyShapedIcon:Ln,layoutTextSize:He,layoutIconSize:ht,textOffset:wt,isSDFIcon:_n,iconTextFit:Vt})}return{featureData:Se,sizes:O,hasAnySecondaryIcon:me,textAlongLine:oe,symbolPlacement:le}},i.ea=RN,i.eb=function(h,a,c,d,g,m,v,E,P,L){const{featureData:A,hasAnySecondaryIcon:O,sizes:N,textAlongLine:D,symbolPlacement:k}=a;for(const U of A){const{shapedIcon:X,verticallyShapedIcon:Q,feature:le,shapedTextOrientations:oe,shapedText:re,layoutTextSize:me,textOffset:Se,isSDFIcon:Me,iconPrimary:We,iconSecondary:$e,iconTextFit:He,iconOffset:ht}=U;UN(X,L.iconPositions,We,$e),UN(Q,L.iconPositions,We,$e),$J(oe,L.iconPositions),(re||X)&&GJ(h,le,oe,X,Q,P,N,me,0,Se,Me,d,g,v,E,O,He,ht,D,k)}c&&h.generateCollisionDebugBuffers(m,h.collisionBoxArray,N.textScaleFactor)},i.ec=bf,i.ed=LS,i.ee=Pn,i.ef=Lv,i.eg=ma,i.eh=x,i.ei=function(h){let a=0;if(new Uint32Array(h,0,1)[0]!==h6){const c=new Uint32Array(h,0,7),[,,d,g,m,v]=c;a=c.byteLength+g+m+v+m,(d!==h.byteLength||a>=h.byteLength)&&ti("Invalid b3dm header information.")}return m6(h,a)},i.ej=function(h,a){const c=y6(h);for(const d of c){for(const g of d.meshes)bee(g);d.lights&&(d.lightMeshIndex=d.meshes.length,d.meshes.push(xee(d.lights,a)))}return c},i.ek=ES,i.el=Pz,i.em=is,i.en=function(h){Hr(),qr!=null&&qr.then(a=>{a.keys().then(c=>{for(let d=0;d<c.length-h;d++)a.delete(c[d])})})},i.f=function(h){return h.indexOf("mapbox:")===0},i.g=function(h,a){return Wo(wi(h,{method:"GET"}),a)},i.h=Re,i.i=function(h){return Ee.API_STYLE_REGEX.test(h)&&!tt(h)},i.j=function(h){return decodeURIComponent(atob(h).split("").map(a=>"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)).join(""))},i.k=function(h){return btoa(encodeURIComponent(h).replace(/%([0-9A-F]{2})/g,(a,c)=>String.fromCharCode(+("0x"+c))))},i.l=wi,i.m=Gr,i.n=function(h,a){return Wo(wi(h,{type:"json"}),a)},i.o=Jh,i.p=function(h,a){return Wo(wi(h,{method:"POST"}),a)},i.q=$t,i.r=_l,i.s=function(h){try{const a=self[h];return a.setItem("_mapbox_test_",1),a.removeItem("_mapbox_test_"),!0}catch{return!1}},i.t=Gt,i.u=function(){return function h(a){return a?(a^Math.random()*(16>>a/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,h)}()},i.v=function(h){return!!h&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(h)},i.w=ti,i.x=function(){return R3||(R3=new b_),R3},i.y=N3,i.z=yh}),l(["./shared"],function(i){function x(Zt){const Ee=Zt?Zt.url.toString():void 0;return Ee?performance.getEntriesByName(Ee):[]}function S(Zt){if(typeof Zt=="number"||typeof Zt=="boolean"||typeof Zt=="string"||Zt==null)return JSON.stringify(Zt);if(Array.isArray(Zt)){let Re="[";for(const tt of Zt)Re+=`${S(tt)},`;return`${Re}]`}let Ee="{";for(const Re of Object.keys(Zt).sort())Ee+=`${Re}:${S(Zt[Re])},`;return`${Ee}}`}function I(Zt){let Ee="";for(const Re of i.bm)(Zt.type!=="model"||Re!=="minzoom"&&Re!=="maxzoom")&&(Ee+=`/${S(Zt[Re])}`);return Ee}class R{constructor(Ee){this.keyCache={},this._layers={},this._layerConfigs={},Ee&&this.replace(Ee)}replace(Ee,Re){this._layerConfigs={},this._layers={},this.update(Ee,[],Re)}update(Ee,Re,tt){this._options=tt;for(const ft of Ee)this._layerConfigs[ft.id]=ft,(this._layers[ft.id]=i.cv(ft,this.scope,null,this._options)).compileFilter(tt),this.keyCache[ft.id]&&delete this.keyCache[ft.id];for(const ft of Re)delete this.keyCache[ft],delete this._layerConfigs[ft],delete this._layers[ft];this.familiesBySource={};const gt=function(ft,Tt){const Ft={};for(let Ht=0;Ht<ft.length;Ht++){const Gt=ft[Ht];let $t=Tt&&Tt[Gt.id];!$t&&($t=I(Gt),Gt.type==="line"&&Gt.paint)&&function Nn(qn){return typeof qn=="string"&&qn==="line-progress"||(Array.isArray(qn)?qn.some(Nn):!(!qn||typeof qn!="object")&&Object.values(qn).some(Nn))}(Gt.paint["line-width"])&&($t+=`/${S(Gt.paint["line-width"])}`),Tt&&(Tt[Gt.id]=$t);let Sn=Ft[$t];Sn||(Sn=Ft[$t]=[]),Sn.push(Gt)}const Ct=[];for(const Ht in Ft)Ct.push(Ft[Ht]);return Ct}(Object.values(this._layerConfigs),this.keyCache);for(const ft of gt){const Tt=ft.map(Sn=>this._layers[Sn.id]),Ft=Tt[0];if(Ft.visibility==="none")continue;const Ct=Ft.source||"";let Ht=this.familiesBySource[Ct];Ht||(Ht=this.familiesBySource[Ct]={});const Gt=Ft.sourceLayer||"_geojsonTileLayer";let $t=Ht[Gt];$t||($t=Ht[Gt]=[]),$t.push(Tt)}}}const F=1*i.d_;class j{constructor(Ee){const Re={},tt=[];for(const Ft in Ee){const Ct=Ee[Ft],Ht=Re[Ft]={};for(const Gt in Ct.glyphs){const $t=Ct.glyphs[+Gt];if(!$t||$t.bitmap.width===0||$t.bitmap.height===0)continue;const Sn=$t.metrics.localGlyph?F:1,Nn={x:0,y:0,w:$t.bitmap.width+2*Sn,h:$t.bitmap.height+2*Sn};tt.push(Nn),Ht[Gt]=Nn}}const{w:gt,h:ft}=i.H(tt),Tt=new i.dZ({width:gt||1,height:ft||1});for(const Ft in Ee){const Ct=Ee[Ft];for(const Ht in Ct.glyphs){const Gt=Ct.glyphs[+Ht];if(!Gt||Gt.bitmap.width===0||Gt.bitmap.height===0)continue;const $t=Re[Ft][Ht],Sn=Gt.metrics.localGlyph?F:1;i.dZ.copy(Gt.bitmap,Tt,{x:0,y:0},{x:$t.x+Sn,y:$t.y+Sn},Gt.bitmap)}}this.image=Tt,this.positions=Re}}i.dY(j,"GlyphAtlas");class H{constructor(Ee){this.tileID=new i.aH(Ee.tileID.overscaledZ,Ee.tileID.wrap,Ee.tileID.canonical.z,Ee.tileID.canonical.x,Ee.tileID.canonical.y),this.tileZoom=Ee.tileZoom,this.uid=Ee.uid,this.zoom=Ee.zoom,this.lut=Ee.lut,this.canonical=Ee.tileID.canonical,this.pixelRatio=Ee.pixelRatio,this.tileSize=Ee.tileSize,this.source=Ee.source,this.scope=Ee.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Ee.showCollisionBoxes,this.collectResourceTiming=!!Ee.request&&Ee.request.collectResourceTiming,this.promoteId=Ee.promoteId,this.isSymbolTile=Ee.isSymbolTile,this.tileTransform=i.aR(Ee.tileID.canonical,Ee.projection),this.projection=Ee.projection,this.worldview=Ee.worldview,this.localizableLayerIds=Ee.localizableLayerIds,this.brightness=Ee.brightness,this.extraShadowCaster=!!Ee.extraShadowCaster,this.tessellationStep=Ee.tessellationStep,this.scaleFactor=Ee.scaleFactor}parse(Ee,Re,tt,gt,ft){this.status="parsing",this.data=Ee,this.collisionBoxArray=new i.aX;const Tt=new i.d$(Object.keys(Ee.layers).sort()),Ft=new i.e0(this.tileID,this.promoteId);Ft.bucketLayerIDs=[];const Ct={},Ht=new i.e1(256,256),Gt={featureIndex:Ft,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Ht,availableImages:tt,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},$t=Re.familiesBySource[this.source];for(const Hr in $t){const gi=Ee.layers[Hr];if(!gi)continue;let Gr=!1,Ni=!1,Pa=!1;for(const Ro of $t[Hr])Ro[0].type==="symbol"?Gr=!0:Ni=!0,Ro[0].is3D()&&Ro[0].type!=="model"&&(Pa=!0);if(this.extraShadowCaster&&!Pa||this.isSymbolTile===!0&&!Gr||this.isSymbolTile===!1&&!Ni)continue;gi.version===1&&i.w(`Vector tile source "${this.source}" layer "${Hr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ua=Tt.encode(Hr),_s=[];let vs=!1;for(let Ro=0,bs=0;Ro<gi.length;Ro++){const Bs=gi.feature(Ro),iu=Ft.getId(Bs,Hr);if(this.localizableLayerIds&&this.localizableLayerIds.has(Hr)){const Wo=Bs.properties?Bs.properties.worldview:null;if(this.worldview&&typeof Wo=="string")if(Wo==="all")Bs.properties.$localized=!0;else{if(!Wo.split(",").includes(this.worldview))continue;Bs.properties.$localized=!0,Bs.properties.worldview=this.worldview}}!vs&&Bs.properties&&Bs.properties.hasOwnProperty(i.e2)&&(vs=!0),_s.push({feature:Bs,id:iu,index:bs,sourceLayerIndex:Ua}),bs++}vs&&!Gt.elevationFeatures&&Ee.layers.hasOwnProperty(i.e3)&&(Gt.elevationFeatures=i.e4.parseFrom(Ee.layers[i.e3],this.canonical));for(const Ro of $t[Hr]){const bs=Ro[0];(!this.extraShadowCaster||bs.is3D()&&bs.type!=="model")&&(this.isSymbolTile!==void 0&&bs.type==="symbol"!==this.isSymbolTile||bs.minzoom&&this.zoom<Math.floor(bs.minzoom)||bs.maxzoom&&this.zoom>=bs.maxzoom||bs.visibility!=="none"&&(G(Ro,this.zoom,Gt.brightness,tt),(Ct[bs.id]=bs.createBucket({index:Ft.bucketLayerIDs.length,layers:Ro,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ua,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(_s,Gt,this.tileID.canonical,this.tileTransform),Ft.bucketLayerIDs.push(Ro.map(Bs=>i.C(Bs.id,Bs.scope)))))}}let Sn,Nn,qn,vr,Or,Rr;Ht.trim();const qr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ri=()=>{if(Sn)return this.status="done",ft(Sn);if(this.extraShadowCaster)this.status="done",ft(null,{buckets:Object.values(Ct).filter(Hr=>!Hr.isEmpty()),featureIndex:Ft,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Gt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Nn&&qn&&vr){const Hr=new j(Nn),gi=new Map;for(const[Pa,Ua]of qn.entries()){const{imagePosition:_s}=i.e7(Pa,Ua,i.e8);gi.set(Pa,_s)}const Gr={};for(const Pa in Ct){const Ua=Ct[Pa];Ua instanceof i.aY&&(G(Ua.layers,this.zoom,Gt.brightness,tt),Gr[Pa]=i.e9(Ua,Nn,Hr.positions,qn,gi,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio))}const Ni={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(gt,qn,Or,()=>{Ni.iconsPending=!1,Xi(Gr,Hr,Ni)}),this.rasterizeIfNeeded(gt,vr,Rr,()=>{Ni.patternsPending=!1,Xi(Gr,Hr,Ni)})}},Xi=(Hr,gi,Gr,Ni)=>{if(Gr.iconsPending||Gr.patternsPending)return;const Pa=new i.ea(qn,vr,this.lut);for(const Ua in Ct){const _s=Ct[Ua];if(Ua in Hr)i.eb(_s,Hr[Ua],this.showCollisionBoxes,tt,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,qn,Pa);else if(_s.hasPattern&&(_s instanceof i.b2||_s instanceof i.b3||_s instanceof i.d8)){G(_s.layers,this.zoom,Gt.brightness,tt);const vs=Object.fromEntries(Pa.patternPositions);_s.addFeatures(Gt,this.tileID.canonical,vs,tt,this.tileTransform,this.brightness)}}this.status="done",ft(null,{buckets:Object.values(Ct).filter(Ua=>!Ua.isEmpty()),featureIndex:Ft,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:gi.image,lineAtlas:Ht,imageAtlas:Pa,brightness:Gt.brightness})};if(!this.extraShadowCaster){const Hr=i.e5(Gt.glyphDependencies,Ni=>Object.keys(Ni).map(Number));Object.keys(Hr).length?gt.send("getGlyphs",{uid:this.uid,stacks:Hr,scope:this.scope},(Ni,Pa)=>{Sn||(Sn=Ni,Nn=Pa,Ri())},void 0,!1,qr):Nn={};const gi=Array.from(Gt.iconDependencies.keys()).map(Ni=>i.I.parse(Ni));gi.length?gt.send("getImages",{images:gi,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Ni,Pa)=>{Sn||(Sn=Ni,qn=new Map,Or=this.updateImageMapAndGetImageTaskQueue(qn,Pa,Gt.iconDependencies),Ri())},void 0,!1,qr):(qn=new Map,Or=new Map);const Gr=Array.from(Gt.patternDependencies.keys()).map(Ni=>i.I.parse(Ni));Gr.length?gt.send("getImages",{images:Gr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Ni,Pa)=>{Sn||(Sn=Ni,vr=new Map,Rr=this.updateImageMapAndGetImageTaskQueue(vr,Pa,Gt.patternDependencies),Ri())},void 0,!1,qr):(vr=new Map,Rr=new Map)}if(Gt.elevationFeatures&&Gt.elevationFeatures.length>0){const Hr=[];for(const Gr of Object.values(Ct))if(Gr instanceof i.b3){const Ni=Gr.getUnevaluatedPortalGraph();Ni&&Hr.push(Ni)}const gi=i.e6.evaluate(Hr);for(const Gr of Object.values(Ct))Gr instanceof i.b3&&Gr.setEvaluatedPortalGraph(gi)}Ri()}rasterizeIfNeeded(Ee,Re,tt,gt){Array.from(Re.values()).some(ft=>ft.usvg)?this.rasterize(Ee,Re,tt,gt):gt()}updateImageMapAndGetImageTaskQueue(Ee,Re,tt){const gt=new Map;for(const ft of Re.keys()){const Tt=tt.get(ft)||[];for(const Ft of Tt){const Ct=Ft.toString(),Ht=Re.get(Ft.id.toString());Ht.usvg?gt.has(Ct)||(gt.set(Ct,Ft),Ee.set(Ct,Object.assign({},Ht))):Ee.set(Ct,Ht)}}return gt}rasterize(Ee,Re,tt,gt){this.rasterizeTask=Ee.send("rasterizeImages",{scope:this.scope,tasks:tt},(ft,Tt)=>{if(!ft)for(const[Ft,Ct]of Tt.entries()){const Ht=Object.assign(Re.get(Ft),{data:Ct});Re.set(Ft,Ht)}gt()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function G(Zt,Ee,Re,tt){const gt=new i.aa(Ee,{brightness:Re});for(const ft of Zt)ft.recalculate(gt,tt)}class W extends i.E{constructor(Ee,Re,tt,gt,ft,Tt){super(),this.actor=Ee,this.layerIndex=Re,this.availableImages=tt,this.loadVectorData=ft||i.aE,this.loading={},this.loaded={},this.deduped=new i.aD(Ee.scheduler),this.isSpriteLoaded=gt,this.scheduler=Ee.scheduler,this.brightness=Tt}loadTile(Ee,Re){const tt=Ee.uid,gt=Ee&&Ee.request,ft=gt&&gt.collectResourceTiming,Tt=this.loading[tt]=new H(Ee);Tt.abort=this.loadVectorData(Ee,(Ft,Ct)=>{const Ht=!this.loading[tt];if(delete this.loading[tt],Tt.cancelRasterize(),Ht||Ft||!Ct)return Tt.status="done",Ht||(this.loaded[tt]=Tt),Re(Ft);const Gt=Ct.rawData,$t={};Ct.expires&&($t.expires=Ct.expires),Ct.cacheControl&&($t.cacheControl=Ct.cacheControl),Tt.vectorTile=Ct.vectorTile||new i.ec.VectorTile(new i.bi(Gt));const Sn=()=>{Tt.parse(Tt.vectorTile,this.layerIndex,this.availableImages,this.actor,(Nn,qn)=>{if(Nn||!qn)return Re(Nn);const vr={};if(ft){const Or=x(gt);Or.length>0&&(vr.resourceTiming=JSON.parse(JSON.stringify(Or)))}Re(null,i.l({rawTileData:Gt.slice(0)},qn,$t,vr))})};this.isSpriteLoaded?Sn():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Sn,{type:"parseTile",isSymbolTile:Ee.isSymbolTile,zoom:Ee.tileZoom}):Sn()}),this.loaded=this.loaded||{},this.loaded[tt]=Tt})}reloadTile(Ee,Re){const tt=this.loaded,gt=Ee.uid;if(tt&&tt[gt]){const ft=tt[gt];ft.scaleFactor=Ee.scaleFactor,ft.showCollisionBoxes=Ee.showCollisionBoxes,ft.projection=Ee.projection,ft.brightness=Ee.brightness,ft.tileTransform=i.aR(Ee.tileID.canonical,Ee.projection),ft.extraShadowCaster=Ee.extraShadowCaster,ft.lut=Ee.lut;const Tt=(Ft,Ct)=>{const Ht=ft.reloadCallback;Ht&&(delete ft.reloadCallback,ft.parse(ft.vectorTile,this.layerIndex,this.availableImages,this.actor,Ht)),Re(Ft,Ct)};ft.status==="parsing"?ft.reloadCallback=Tt:ft.status==="done"&&(ft.vectorTile?ft.parse(ft.vectorTile,this.layerIndex,this.availableImages,this.actor,Tt):Tt())}else Re(null,void 0)}abortTile(Ee,Re){const tt=Ee.uid,gt=this.loading[tt];gt&&(gt.abort&&gt.abort(),delete this.loading[tt]),Re()}removeTile(Ee,Re){const tt=this.loaded,gt=Ee.uid;tt&&tt[gt]&&delete tt[gt],Re()}}class J{loadTile(Ee,Re){const{uid:tt,encoding:gt,rawImageData:ft,padding:Tt}=Ee,Ft=ImageBitmap&&ft instanceof ImageBitmap?this.getImageData(ft,Tt):ft;Re(null,new i.ed(tt,Ft,gt,Tt<1))}reloadTile(Ee,Re){Re(null,null)}abortTile(Ee,Re){Re()}removeTile(Ee,Re){Re()}getImageData(Ee,Re){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Ee.width,Ee.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Ee.width,this.offscreenCanvas.height=Ee.height,this.offscreenCanvasContext.drawImage(Ee,0,0,Ee.width,Ee.height);const tt=this.offscreenCanvasContext.getImageData(-Re,-Re,Ee.width+2*Re,Ee.height+2*Re);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),tt}}i.bh.setPbf(i.bi);class ie{constructor(Ee){this._mrt=new i.bh(Ee.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=Ee.uid,this.tileID=Ee.tileID,this.source=Ee.source}parse(Ee,Re){const tt=this._mrt;this.status="parsing",this._entireBuffer=Ee;try{tt.parseHeader(Ee),this._isHeaderLoaded=!0;const gt=[];for(const ft in tt.layers){const Tt=tt.getLayer(ft),Ft=Tt.getDataRange(Tt.getBandList()),Ct=tt.createDecodingTask(Ft),Ht=Ee.slice(Ft.firstByte,Ft.lastByte+1),Gt=i.bh.performDecoding(Ht,Ct).then($t=>Ct.complete(null,$t)).catch($t=>Ct.complete($t,null));gt.push(Gt)}Promise.allSettled(gt).then(()=>Re(null,tt))}catch(gt){Re(gt)}}}class he{constructor(Ee){this.actor=Ee,this.loading={},this.loaded={}}loadTile(Ee,Re){const tt=Ee.uid,gt=Ee.request,ft=this.loading[tt]=new ie(Ee),{cancel:Tt}=i.bj(gt,(Ft,Ct,Ht,Gt)=>{const $t=!this.loading[tt];if(delete this.loading[tt],$t||Ft||!Ct)return ft.status="done",$t||(this.loaded[tt]=ft),Re(Ft);ft.parse(Ct,(Sn,Nn)=>{if(Sn||!Nn)return Re(Sn);Re(null,Nn,Ht,Gt)}),this.loaded[tt]=ft});ft.abort=Tt}reloadTile(Ee,Re){Re(null,void 0)}abortTile(Ee,Re){const tt=Ee.uid,gt=this.loading[tt];gt&&(gt.abort&&gt.abort(),delete this.loading[tt]),Re()}removeTile(Ee,Re){const tt=Ee.uid;this.loaded[tt]&&delete this.loaded[tt],Re()}decodeRasterArray({task:Ee,buffer:Re},tt){i.bh.performDecoding(Re,Ee).then(gt=>tt(null,gt)).catch(gt=>tt(gt))}}const ge=i.ec.VectorTileFeature.prototype.toGeoJSON;class fe{constructor(Ee){this._feature=Ee,this.extent=i.ai,this.type=Ee.type,this.properties=Ee.tags,"id"in Ee&&!isNaN(Ee.id)&&(this.id=parseInt(Ee.id,10))}loadGeometry(){if(this._feature.type===1){const Ee=[];for(const Re of this._feature.geometry)Ee.push([new i.P(Re[0],Re[1])]);return Ee}{const Ee=[];for(const Re of this._feature.geometry){const tt=[];for(const gt of Re)tt.push(new i.P(gt[0],gt[1]));Ee.push(tt)}return Ee}}toGeoJSON(Ee,Re,tt){return ge.call(this,Ee,Re,tt)}}class ye{constructor(Ee){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=i.ai,this.length=Ee.length,this._features=Ee}feature(Ee){return new fe(this._features[Ee])}}const pe=64/4096,be=128;class Ae{constructor(){this.features=new Map}clear(){this.features.clear()}load(Ee=[],Re){for(const tt of Ee){const gt=tt.id;if(gt==null)continue;let ft=this.features.get(gt);ft&&this.updateCache(ft,Re),tt.geometry?(ft=ue(tt),this.updateCache(ft,Re),this.features.set(gt,ft)):this.features.delete(gt),this.updateCache(ft,Re)}}updateCache(Ee,Re){for(const{canonical:tt,uid:gt}of Object.values(Re)){const{z:ft,x:Tt,y:Ft}=tt;Oe(Ee,Math.pow(2,ft),Tt,Ft)&&delete Re[gt]}}getTile(Ee,Re,tt){const gt=Math.pow(2,Ee),ft=[];for(const Tt of this.features.values())Oe(Tt,gt,Re,tt)&&ft.push(je(Tt,gt,Re,tt));return{features:ft}}getFeatures(){return[...this.features.values()]}}function Oe({minX:Zt,minY:Ee,maxX:Re,maxY:tt},gt,ft,Tt){return Zt<(ft+1+pe)/gt&&Ee<(Tt+1+pe)/gt&&Re>(ft-pe)/gt&&tt>(Tt-pe)/gt}function ue(Zt){const{id:Ee,geometry:Re,properties:tt}=Zt;if(!Re)return;if(Re.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:gt,coordinates:ft}=Re,Tt={id:Ee,type:1,geometry:[],tags:tt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ft=Tt.geometry;if(gt==="Point")we(ft,Ft,Tt);else if(gt==="MultiPoint")for(const Ct of ft)we(Ct,Ft,Tt);else if(gt==="LineString")Tt.type=2,ke(ft,Ft,Tt);else if(gt==="MultiLineString")Tt.type=2,De(ft,Ft,Tt);else if(gt==="Polygon")Tt.type=3,De(ft,Ft,Tt,!0);else{if(gt!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Tt.type=3;for(const Ct of ft)De(Ct,Ft,Tt,!0)}return Tt}function we([Zt,Ee],Re,tt){const gt=i.av(Zt);let ft=i.aC(Ee);ft=ft<0?0:ft>1?1:ft,Re.push(gt,ft),tt.minX=Math.min(tt.minX,gt),tt.minY=Math.min(tt.minY,ft),tt.maxX=Math.max(tt.maxX,gt),tt.maxY=Math.max(tt.maxY,ft)}function ke(Zt,Ee,Re,tt=!1,gt=!1){const ft=[];for(const Tt of Zt)we(Tt,ft,Re);Ee.push(ft),tt&&function(Tt,Ft){let Ct=0;for(let Ht=0,Gt=Tt.length,$t=Gt-2;Ht<Gt;$t=Ht,Ht+=2)Ct+=(Tt[Ht]-Tt[$t])*(Tt[Ht+1]+Tt[$t+1]);if(Ct>0===Ft)for(let Ht=0,Gt=Tt.length;Ht<Gt/2;Ht+=2){const $t=Tt[Ht],Sn=Tt[Ht+1];Tt[Ht]=Tt[Gt-2-Ht],Tt[Ht+1]=Tt[Gt-1-Ht],Tt[Gt-2-Ht]=$t,Tt[Gt-1-Ht]=Sn}}(ft,gt)}function De(Zt,Ee,Re,tt=!1){for(let gt=0;gt<Zt.length;gt++)ke(Zt[gt],Ee,Re,tt,gt===0)}function je(Zt,Ee,Re,tt){const{id:gt,type:ft,geometry:Tt,tags:Ft}=Zt,Ct=[];if(ft===1)(function(Ht,Gt,$t,Sn,Nn){for(let qn=0;qn<Ht.length;qn+=2){const vr=Math.round(i.ai*(Ht[qn+0]*Gt-$t)),Or=Math.round(i.ai*(Ht[qn+1]*Gt-Sn));Nn.push([vr,Or])}})(Tt,Ee,Re,tt,Ct);else for(const Ht of Tt)ze(Ht,Ee,Re,tt,Ct);return{id:gt,type:ft,geometry:Ct,tags:Ft}}function ze(Zt,Ee,Re,tt,gt){const Tt=i.ai+be;let Ft;for(let Ct=0;Ct<Zt.length-2;Ct+=2){let Ht=Math.round(i.ai*(Zt[Ct+0]*Ee-Re)),Gt=Math.round(i.ai*(Zt[Ct+1]*Ee-tt)),$t=Math.round(i.ai*(Zt[Ct+2]*Ee-Re)),Sn=Math.round(i.ai*(Zt[Ct+3]*Ee-tt));const Nn=$t-Ht,qn=Sn-Gt;Ht<-128&&$t<-128||(Ht<-128?(Gt+=Math.round(qn*((-128-Ht)/Nn)),Ht=-128):$t<-128&&(Sn=Gt+Math.round(qn*((-128-Ht)/Nn)),$t=-128),Gt<-128&&Sn<-128||(Gt<-128?(Ht+=Math.round(Nn*((-128-Gt)/qn)),Gt=-128):Sn<-128&&($t=Ht+Math.round(Nn*((-128-Gt)/qn)),Sn=-128),Ht>=Tt&&$t>=Tt||(Ht>=Tt?(Gt+=Math.round(qn*((Tt-Ht)/Nn)),Ht=Tt):$t>=Tt&&(Sn=Gt+Math.round(qn*((Tt-Ht)/Nn)),$t=Tt),Gt>=Tt&&Sn>=Tt||(Gt>=Tt?(Ht+=Math.round(Nn*((Tt-Gt)/qn)),Gt=Tt):Sn>=Tt&&($t=Ht+Math.round(Nn*((Tt-Gt)/qn)),Sn=Tt),Ft&&Ht===Ft[Ft.length-1][0]&&Gt===Ft[Ft.length-1][1]||(Ft=[[Ht,Gt]],gt.push(Ft)),Ft.push([$t,Sn])))))}}var Ue,Fe,Qe,Be={exports:{}},bt=function(){if(Qe)return Be.exports;Qe=1;var Zt=i.eg(),Ee=function(){if(Fe)return Ue;Fe=1;var Gt=i.ee(),$t=i.ef().VectorTileFeature;function Sn(qn,vr){this.options=vr||{},this.features=qn,this.length=qn.length}function Nn(qn,vr){this.id=typeof qn.id=="number"?qn.id:void 0,this.type=qn.type,this.rawGeometry=qn.type===1?[qn.geometry]:qn.geometry,this.properties=qn.tags,this.extent=vr||4096}return Ue=Sn,Sn.prototype.feature=function(qn){return new Nn(this.features[qn],this.options.extent)},Nn.prototype.loadGeometry=function(){var qn=this.rawGeometry;this.geometry=[];for(var vr=0;vr<qn.length;vr++){for(var Or=qn[vr],Rr=[],qr=0;qr<Or.length;qr++)Rr.push(new Gt(Or[qr][0],Or[qr][1]));this.geometry.push(Rr)}return this.geometry},Nn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var qn=this.geometry,vr=1/0,Or=-1/0,Rr=1/0,qr=-1/0,Ri=0;Ri<qn.length;Ri++)for(var Xi=qn[Ri],Hr=0;Hr<Xi.length;Hr++){var gi=Xi[Hr];vr=Math.min(vr,gi.x),Or=Math.max(Or,gi.x),Rr=Math.min(Rr,gi.y),qr=Math.max(qr,gi.y)}return[vr,Rr,Or,qr]},Nn.prototype.toGeoJSON=$t.prototype.toGeoJSON,Ue}();function Re(Gt){var $t=new Zt;return function(Sn,Nn){for(var qn in Sn.layers)Nn.writeMessage(3,tt,Sn.layers[qn])}(Gt,$t),$t.finish()}function tt(Gt,$t){var Sn;$t.writeVarintField(15,Gt.version||1),$t.writeStringField(1,Gt.name||""),$t.writeVarintField(5,Gt.extent||4096);var Nn={keys:[],values:[],keycache:{},valuecache:{}};for(Sn=0;Sn<Gt.length;Sn++)Nn.feature=Gt.feature(Sn),$t.writeMessage(2,gt,Nn);var qn=Nn.keys;for(Sn=0;Sn<qn.length;Sn++)$t.writeStringField(3,qn[Sn]);var vr=Nn.values;for(Sn=0;Sn<vr.length;Sn++)$t.writeMessage(4,Ht,vr[Sn])}function gt(Gt,$t){var Sn=Gt.feature;Sn.id!==void 0&&$t.writeVarintField(1,Sn.id),$t.writeMessage(2,ft,Gt),$t.writeVarintField(3,Sn.type),$t.writeMessage(4,Ct,Sn)}function ft(Gt,$t){var Sn=Gt.feature,Nn=Gt.keys,qn=Gt.values,vr=Gt.keycache,Or=Gt.valuecache;for(var Rr in Sn.properties){var qr=Sn.properties[Rr],Ri=vr[Rr];if(qr!==null){Ri===void 0&&(Nn.push(Rr),vr[Rr]=Ri=Nn.length-1),$t.writeVarint(Ri);var Xi=typeof qr;Xi!=="string"&&Xi!=="boolean"&&Xi!=="number"&&(qr=JSON.stringify(qr));var Hr=Xi+":"+qr,gi=Or[Hr];gi===void 0&&(qn.push(qr),Or[Hr]=gi=qn.length-1),$t.writeVarint(gi)}}}function Tt(Gt,$t){return($t<<3)+(7&Gt)}function Ft(Gt){return Gt<<1^Gt>>31}function Ct(Gt,$t){for(var Sn=Gt.loadGeometry(),Nn=Gt.type,qn=0,vr=0,Or=Sn.length,Rr=0;Rr<Or;Rr++){var qr=Sn[Rr],Ri=1;Nn===1&&(Ri=qr.length),$t.writeVarint(Tt(1,Ri));for(var Xi=Nn===3?qr.length-1:qr.length,Hr=0;Hr<Xi;Hr++){Hr===1&&Nn!==1&&$t.writeVarint(Tt(2,Xi-1));var gi=qr[Hr].x-qn,Gr=qr[Hr].y-vr;$t.writeVarint(Ft(gi)),$t.writeVarint(Ft(Gr)),qn+=gi,vr+=Gr}Nn===3&&$t.writeVarint(Tt(7,1))}}function Ht(Gt,$t){var Sn=typeof Gt;Sn==="string"?$t.writeStringField(1,Gt):Sn==="boolean"?$t.writeBooleanField(7,Gt):Sn==="number"&&(Gt%1!=0?$t.writeDoubleField(3,Gt):Gt<0?$t.writeSVarintField(6,Gt):$t.writeVarintField(5,Gt))}return Be.exports=Re,Be.exports.fromVectorTileJs=Re,Be.exports.fromGeojsonVt=function(Gt,$t){$t=$t||{};var Sn={};for(var Nn in Gt)Sn[Nn]=new Ee(Gt[Nn].features,$t),Sn[Nn].name=Nn,Sn[Nn].version=$t.version,Sn[Nn].extent=$t.extent;return Re({layers:Sn})},Be.exports.GeoJSONWrapper=Ee,Be.exports}(),xe=i.eh(bt);const Le={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Zt=>Zt},Xe=Math.fround||(ct=new Float32Array(1),Zt=>(ct[0]=+Zt,ct[0]));var ct;const vt=3,Nt=5,mt=6;class yt{constructor(Ee){this.options=Object.assign(Object.create(Le),Ee),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Ee){const{log:Re,minZoom:tt,maxZoom:gt}=this.options;Re&&console.time("total time");const ft=`prepare ${Ee.length} points`;Re&&console.time(ft),this.points=Ee;const Tt=[];for(let Ct=0;Ct<Ee.length;Ct++){const Ht=Ee[Ct];if(!Ht.geometry)continue;const[Gt,$t]=Ht.geometry.coordinates,Sn=Xe(Kt(Gt)),Nn=Xe(Pn($t));Tt.push(Sn,Nn,1/0,Ct,-1,1),this.options.reduce&&Tt.push(0)}let Ft=this.trees[gt+1]=this._createTree(Tt);Re&&console.timeEnd(ft);for(let Ct=gt;Ct>=tt;Ct--){const Ht=+Date.now();Ft=this.trees[Ct]=this._createTree(this._cluster(Ft,Ct)),Re&&console.log("z%d: %d clusters in %dms",Ct,Ft.numItems,+Date.now()-Ht)}return Re&&console.timeEnd("total time"),this}getClusters(Ee,Re){let tt=((Ee[0]+180)%360+360)%360-180;const gt=Math.max(-90,Math.min(90,Ee[1]));let ft=Ee[2]===180?180:((Ee[2]+180)%360+360)%360-180;const Tt=Math.max(-90,Math.min(90,Ee[3]));if(Ee[2]-Ee[0]>=360)tt=-180,ft=180;else if(tt>ft){const $t=this.getClusters([tt,gt,180,Tt],Re),Sn=this.getClusters([-180,gt,ft,Tt],Re);return $t.concat(Sn)}const Ft=this.trees[this._limitZoom(Re)],Ct=Ft.range(Kt(tt),Pn(Tt),Kt(ft),Pn(gt)),Ht=Ft.data,Gt=[];for(const $t of Ct){const Sn=this.stride*$t;Gt.push(Ht[Sn+Nt]>1?_e(Ht,Sn,this.clusterProps):this.points[Ht[Sn+vt]])}return Gt}getChildren(Ee){const Re=this._getOriginId(Ee),tt=this._getOriginZoom(Ee),gt="No cluster with the specified id.",ft=this.trees[tt];if(!ft)throw new Error(gt);const Tt=ft.data;if(Re*this.stride>=Tt.length)throw new Error(gt);const Ft=this.options.radius/(this.options.extent*Math.pow(2,tt-1)),Ct=ft.within(Tt[Re*this.stride],Tt[Re*this.stride+1],Ft),Ht=[];for(const Gt of Ct){const $t=Gt*this.stride;Tt[$t+4]===Ee&&Ht.push(Tt[$t+Nt]>1?_e(Tt,$t,this.clusterProps):this.points[Tt[$t+vt]])}if(Ht.length===0)throw new Error(gt);return Ht}getLeaves(Ee,Re,tt){const gt=[];return this._appendLeaves(gt,Ee,Re=Re||10,tt=tt||0,0),gt}getTile(Ee,Re,tt){const gt=this.trees[this._limitZoom(Ee)],ft=Math.pow(2,Ee),{extent:Tt,radius:Ft}=this.options,Ct=Ft/Tt,Ht=(tt-Ct)/ft,Gt=(tt+1+Ct)/ft,$t={features:[]};return this._addTileFeatures(gt.range((Re-Ct)/ft,Ht,(Re+1+Ct)/ft,Gt),gt.data,Re,tt,ft,$t),Re===0&&this._addTileFeatures(gt.range(1-Ct/ft,Ht,1,Gt),gt.data,ft,tt,ft,$t),Re===ft-1&&this._addTileFeatures(gt.range(0,Ht,Ct/ft,Gt),gt.data,-1,tt,ft,$t),$t.features.length?$t:null}getClusterExpansionZoom(Ee){let Re=this._getOriginZoom(Ee)-1;for(;Re<=this.options.maxZoom;){const tt=this.getChildren(Ee);if(Re++,tt.length!==1)break;Ee=tt[0].properties.cluster_id}return Re}_appendLeaves(Ee,Re,tt,gt,ft){const Tt=this.getChildren(Re);for(const Ft of Tt){const Ct=Ft.properties;if(Ct&&Ct.cluster?ft+Ct.point_count<=gt?ft+=Ct.point_count:ft=this._appendLeaves(Ee,Ct.cluster_id,tt,gt,ft):ft<gt?ft++:Ee.push(Ft),Ee.length===tt)break}return ft}_createTree(Ee){const Re=new i.bE(Ee.length/this.stride|0,this.options.nodeSize,Float32Array);for(let tt=0;tt<Ee.length;tt+=this.stride)Re.add(Ee[tt],Ee[tt+1]);return Re.finish(),Re.data=Ee,Re}_addTileFeatures(Ee,Re,tt,gt,ft,Tt){for(const Ft of Ee){const Ct=Ft*this.stride,Ht=Re[Ct+Nt]>1;let Gt,$t,Sn;if(Ht)Gt=on(Re,Ct,this.clusterProps),$t=Re[Ct],Sn=Re[Ct+1];else{const vr=this.points[Re[Ct+vt]];Gt=vr.properties;const[Or,Rr]=vr.geometry.coordinates;$t=Kt(Or),Sn=Pn(Rr)}const Nn={type:1,geometry:[[Math.round(this.options.extent*($t*ft-tt)),Math.round(this.options.extent*(Sn*ft-gt))]],tags:Gt};let qn;qn=Ht||this.options.generateId?Re[Ct+vt]:this.points[Re[Ct+vt]].id,qn!==void 0&&(Nn.id=qn),Tt.features.push(Nn)}}_limitZoom(Ee){return Math.max(this.options.minZoom,Math.min(Math.floor(+Ee),this.options.maxZoom+1))}_cluster(Ee,Re){const{radius:tt,extent:gt,reduce:ft,minPoints:Tt}=this.options,Ft=tt/(gt*Math.pow(2,Re)),Ct=Ee.data,Ht=[],Gt=this.stride;for(let $t=0;$t<Ct.length;$t+=Gt){if(Ct[$t+2]<=Re)continue;Ct[$t+2]=Re;const Sn=Ct[$t],Nn=Ct[$t+1],qn=Ee.within(Ct[$t],Ct[$t+1],Ft),vr=Ct[$t+Nt];let Or=vr;for(const Rr of qn){const qr=Rr*Gt;Ct[qr+2]>Re&&(Or+=Ct[qr+Nt])}if(Or>vr&&Or>=Tt){let Rr,qr=Sn*vr,Ri=Nn*vr,Xi=-1;const Hr=($t/Gt<<5)+(Re+1)+this.points.length;for(const gi of qn){const Gr=gi*Gt;if(Ct[Gr+2]<=Re)continue;Ct[Gr+2]=Re;const Ni=Ct[Gr+Nt];qr+=Ct[Gr]*Ni,Ri+=Ct[Gr+1]*Ni,Ct[Gr+4]=Hr,ft&&(Rr||(Rr=this._map(Ct,$t,!0),Xi=this.clusterProps.length,this.clusterProps.push(Rr)),ft(Rr,this._map(Ct,Gr)))}Ct[$t+4]=Hr,Ht.push(qr/Or,Ri/Or,1/0,Hr,-1,Or),ft&&Ht.push(Xi)}else{for(let Rr=0;Rr<Gt;Rr++)Ht.push(Ct[$t+Rr]);if(Or>1)for(const Rr of qn){const qr=Rr*Gt;if(!(Ct[qr+2]<=Re)){Ct[qr+2]=Re;for(let Ri=0;Ri<Gt;Ri++)Ht.push(Ct[qr+Ri])}}}}return Ht}_getOriginId(Ee){return Ee-this.points.length>>5}_getOriginZoom(Ee){return(Ee-this.points.length)%32}_map(Ee,Re,tt){if(Ee[Re+Nt]>1){const Tt=this.clusterProps[Ee[Re+mt]];return tt?Object.assign({},Tt):Tt}const gt=this.points[Ee[Re+vt]].properties,ft=this.options.map(gt);return tt&&ft===gt?Object.assign({},ft):ft}}function _e(Zt,Ee,Re){return{type:"Feature",id:Zt[Ee+vt],properties:on(Zt,Ee,Re),geometry:{type:"Point",coordinates:[(tt=Zt[Ee],360*(tt-.5)),Ut(Zt[Ee+1])]}};var tt}function on(Zt,Ee,Re){const tt=Zt[Ee+Nt],gt=tt>=1e4?`${Math.round(tt/1e3)}k`:tt>=1e3?Math.round(tt/100)/10+"k":tt,ft=Zt[Ee+mt],Tt=ft===-1?{}:Object.assign({},Re[ft]);return Object.assign(Tt,{cluster:!0,cluster_id:Zt[Ee+vt],point_count:tt,point_count_abbreviated:gt})}function Kt(Zt){return Zt/360+.5}function Pn(Zt){const Ee=Math.sin(Zt*Math.PI/180),Re=.5-.25*Math.log((1+Ee)/(1-Ee))/Math.PI;return Re<0?0:Re>1?1:Re}function Ut(Zt){const Ee=(180-360*Zt)*Math.PI/180;return 360*Math.atan(Math.exp(Ee))/Math.PI-90}function cn(Zt,Ee,Re,tt){let gt=tt;const ft=Ee+(Re-Ee>>1);let Tt,Ft=Re-Ee;const Ct=Zt[Ee],Ht=Zt[Ee+1],Gt=Zt[Re],$t=Zt[Re+1];for(let Sn=Ee+3;Sn<Re;Sn+=3){const Nn=At(Zt[Sn],Zt[Sn+1],Ct,Ht,Gt,$t);if(Nn>gt)Tt=Sn,gt=Nn;else if(Nn===gt){const qn=Math.abs(Sn-ft);qn<Ft&&(Tt=Sn,Ft=qn)}}gt>tt&&(Tt-Ee>3&&cn(Zt,Ee,Tt,tt),Zt[Tt+2]=gt,Re-Tt>3&&cn(Zt,Tt,Re,tt))}function At(Zt,Ee,Re,tt,gt,ft){let Tt=gt-Re,Ft=ft-tt;if(Tt!==0||Ft!==0){const Ct=((Zt-Re)*Tt+(Ee-tt)*Ft)/(Tt*Tt+Ft*Ft);Ct>1?(Re=gt,tt=ft):Ct>0&&(Re+=Tt*Ct,tt+=Ft*Ct)}return Tt=Zt-Re,Ft=Ee-tt,Tt*Tt+Ft*Ft}function xr(Zt,Ee,Re,tt){const gt={id:Zt??null,type:Ee,geometry:Re,tags:tt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Ee==="Point"||Ee==="MultiPoint"||Ee==="LineString")Rn(gt,Re);else if(Ee==="Polygon")Rn(gt,Re[0]);else if(Ee==="MultiLineString")for(const ft of Re)Rn(gt,ft);else if(Ee==="MultiPolygon")for(const ft of Re)Rn(gt,ft[0]);return gt}function Rn(Zt,Ee){for(let Re=0;Re<Ee.length;Re+=3)Zt.minX=Math.min(Zt.minX,Ee[Re]),Zt.minY=Math.min(Zt.minY,Ee[Re+1]),Zt.maxX=Math.max(Zt.maxX,Ee[Re]),Zt.maxY=Math.max(Zt.maxY,Ee[Re+1])}function Dn(Zt,Ee,Re,tt){if(!Ee.geometry)return;const gt=Ee.geometry.coordinates;if(gt&&gt.length===0)return;const ft=Ee.geometry.type,Tt=Math.pow(Re.tolerance/((1<<Re.maxZoom)*Re.extent),2);let Ft=[],Ct=Ee.id;if(Re.promoteId?Ct=Ee.properties[Re.promoteId]:Re.generateId&&(Ct=tt||0),ft==="Point")ar(gt,Ft);else if(ft==="MultiPoint")for(const Ht of gt)ar(Ht,Ft);else if(ft==="LineString")hr(gt,Ft,Tt,!1);else if(ft==="MultiLineString"){if(Re.lineMetrics){for(const Ht of gt)Ft=[],hr(Ht,Ft,Tt,!1),Zt.push(xr(Ct,"LineString",Ft,Ee.properties));return}ur(gt,Ft,Tt,!1)}else if(ft==="Polygon")ur(gt,Ft,Tt,!0);else{if(ft!=="MultiPolygon"){if(ft==="GeometryCollection"){for(const Ht of Ee.geometry.geometries)Dn(Zt,{id:Ct,geometry:Ht,properties:Ee.properties},Re,tt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ht of gt){const Gt=[];ur(Ht,Gt,Tt,!0),Ft.push(Gt)}}Zt.push(xr(Ct,ft,Ft,Ee.properties))}function ar(Zt,Ee){Ee.push(Ir(Zt[0]),Un(Zt[1]),0)}function hr(Zt,Ee,Re,tt){let gt,ft,Tt=0;for(let Ct=0;Ct<Zt.length;Ct++){const Ht=Ir(Zt[Ct][0]),Gt=Un(Zt[Ct][1]);Ee.push(Ht,Gt,0),Ct>0&&(Tt+=tt?(gt*Gt-Ht*ft)/2:Math.sqrt(Math.pow(Ht-gt,2)+Math.pow(Gt-ft,2))),gt=Ht,ft=Gt}const Ft=Ee.length-3;Ee[2]=1,cn(Ee,0,Ft,Re),Ee[Ft+2]=1,Ee.size=Math.abs(Tt),Ee.start=0,Ee.end=Ee.size}function ur(Zt,Ee,Re,tt){for(let gt=0;gt<Zt.length;gt++){const ft=[];hr(Zt[gt],ft,Re,tt),Ee.push(ft)}}function Ir(Zt){return Zt/360+.5}function Un(Zt){const Ee=Math.sin(Zt*Math.PI/180),Re=.5-.25*Math.log((1+Ee)/(1-Ee))/Math.PI;return Re<0?0:Re>1?1:Re}function Vr(Zt,Ee,Re,tt,gt,ft,Tt,Ft){if(tt/=Ee,ft>=(Re/=Ee)&&Tt<tt)return Zt;if(Tt<Re||ft>=tt)return null;const Ct=[];for(const Ht of Zt){const Gt=Ht.geometry;let $t=Ht.type;const Sn=gt===0?Ht.minX:Ht.minY,Nn=gt===0?Ht.maxX:Ht.maxY;if(Sn>=Re&&Nn<tt){Ct.push(Ht);continue}if(Nn<Re||Sn>=tt)continue;let qn=[];if($t==="Point"||$t==="MultiPoint")pi(Gt,qn,Re,tt,gt);else if($t==="LineString")Li(Gt,qn,Re,tt,gt,!1,Ft.lineMetrics);else if($t==="MultiLineString")xn(Gt,qn,Re,tt,gt,!1);else if($t==="Polygon")xn(Gt,qn,Re,tt,gt,!0);else if($t==="MultiPolygon")for(const vr of Gt){const Or=[];xn(vr,Or,Re,tt,gt,!0),Or.length&&qn.push(Or)}if(qn.length){if(Ft.lineMetrics&&$t==="LineString"){for(const vr of qn)Ct.push(xr(Ht.id,$t,vr,Ht.tags));continue}$t!=="LineString"&&$t!=="MultiLineString"||(qn.length===1?($t="LineString",qn=qn[0]):$t="MultiLineString"),$t!=="Point"&&$t!=="MultiPoint"||($t=qn.length===3?"Point":"MultiPoint"),Ct.push(xr(Ht.id,$t,qn,Ht.tags))}}return Ct.length?Ct:null}function pi(Zt,Ee,Re,tt,gt){for(let ft=0;ft<Zt.length;ft+=3){const Tt=Zt[ft+gt];Tt>=Re&&Tt<=tt&&Xn(Ee,Zt[ft],Zt[ft+1],Zt[ft+2])}}function Li(Zt,Ee,Re,tt,gt,ft,Tt){let Ft=wi(Zt);const Ct=gt===0?hn:er;let Ht,Gt,$t=Zt.start;for(let Or=0;Or<Zt.length-3;Or+=3){const Rr=Zt[Or],qr=Zt[Or+1],Ri=Zt[Or+2],Xi=Zt[Or+3],Hr=Zt[Or+4],gi=gt===0?Rr:qr,Gr=gt===0?Xi:Hr;let Ni=!1;Tt&&(Ht=Math.sqrt(Math.pow(Rr-Xi,2)+Math.pow(qr-Hr,2))),gi<Re?Gr>Re&&(Gt=Ct(Ft,Rr,qr,Xi,Hr,Re),Tt&&(Ft.start=$t+Ht*Gt)):gi>tt?Gr<tt&&(Gt=Ct(Ft,Rr,qr,Xi,Hr,tt),Tt&&(Ft.start=$t+Ht*Gt)):Xn(Ft,Rr,qr,Ri),Gr<Re&&gi>=Re&&(Gt=Ct(Ft,Rr,qr,Xi,Hr,Re),Ni=!0),Gr>tt&&gi<=tt&&(Gt=Ct(Ft,Rr,qr,Xi,Hr,tt),Ni=!0),!ft&&Ni&&(Tt&&(Ft.end=$t+Ht*Gt),Ee.push(Ft),Ft=wi(Zt)),Tt&&($t+=Ht)}let Sn=Zt.length-3;const Nn=Zt[Sn],qn=Zt[Sn+1],vr=gt===0?Nn:qn;vr>=Re&&vr<=tt&&Xn(Ft,Nn,qn,Zt[Sn+2]),Sn=Ft.length-3,ft&&Sn>=3&&(Ft[Sn]!==Ft[0]||Ft[Sn+1]!==Ft[1])&&Xn(Ft,Ft[0],Ft[1],Ft[2]),Ft.length&&Ee.push(Ft)}function wi(Zt){const Ee=[];return Ee.size=Zt.size,Ee.start=Zt.start,Ee.end=Zt.end,Ee}function xn(Zt,Ee,Re,tt,gt,ft){for(const Tt of Zt)Li(Tt,Ee,Re,tt,gt,ft,!1)}function Xn(Zt,Ee,Re,tt){Zt.push(Ee,Re,tt)}function hn(Zt,Ee,Re,tt,gt,ft){const Tt=(ft-Ee)/(tt-Ee);return Xn(Zt,ft,Re+(gt-Re)*Tt,1),Tt}function er(Zt,Ee,Re,tt,gt,ft){const Tt=(ft-Re)/(gt-Re);return Xn(Zt,Ee+(tt-Ee)*Tt,ft,1),Tt}function yr(Zt,Ee){const Re=[];for(let tt=0;tt<Zt.length;tt++){const gt=Zt[tt],ft=gt.type;let Tt;if(ft==="Point"||ft==="MultiPoint"||ft==="LineString")Tt=Vi(gt.geometry,Ee);else if(ft==="MultiLineString"||ft==="Polygon"){Tt=[];for(const Ft of gt.geometry)Tt.push(Vi(Ft,Ee))}else if(ft==="MultiPolygon"){Tt=[];for(const Ft of gt.geometry){const Ct=[];for(const Ht of Ft)Ct.push(Vi(Ht,Ee));Tt.push(Ct)}}Re.push(xr(gt.id,ft,Tt,gt.tags))}return Re}function Vi(Zt,Ee){const Re=[];Re.size=Zt.size,Zt.start!==void 0&&(Re.start=Zt.start,Re.end=Zt.end);for(let tt=0;tt<Zt.length;tt+=3)Re.push(Zt[tt]+Ee,Zt[tt+1],Zt[tt+2]);return Re}function ki(Zt,Ee){if(Zt.transformed)return Zt;const Re=1<<Zt.z,tt=Zt.x,gt=Zt.y;for(const ft of Zt.features){const Tt=ft.geometry,Ft=ft.type;if(ft.geometry=[],Ft===1)for(let Ct=0;Ct<Tt.length;Ct+=2)ft.geometry.push(mi(Tt[Ct],Tt[Ct+1],Ee,Re,tt,gt));else for(let Ct=0;Ct<Tt.length;Ct++){const Ht=[];for(let Gt=0;Gt<Tt[Ct].length;Gt+=2)Ht.push(mi(Tt[Ct][Gt],Tt[Ct][Gt+1],Ee,Re,tt,gt));ft.geometry.push(Ht)}}return Zt.transformed=!0,Zt}function mi(Zt,Ee,Re,tt,gt,ft){return[Math.round(Re*(Zt*tt-gt)),Math.round(Re*(Ee*tt-ft))]}function ti(Zt,Ee,Re,tt,gt){const ft=Ee===gt.maxZoom?0:gt.tolerance/((1<<Ee)*gt.extent),Tt={features:[],numPoints:0,numSimplified:0,numFeatures:Zt.length,source:null,x:Re,y:tt,z:Ee,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ft of Zt)Pr(Tt,Ft,ft,gt);return Tt}function Pr(Zt,Ee,Re,tt){const gt=Ee.geometry,ft=Ee.type,Tt=[];if(Zt.minX=Math.min(Zt.minX,Ee.minX),Zt.minY=Math.min(Zt.minY,Ee.minY),Zt.maxX=Math.max(Zt.maxX,Ee.maxX),Zt.maxY=Math.max(Zt.maxY,Ee.maxY),ft==="Point"||ft==="MultiPoint")for(let Ft=0;Ft<gt.length;Ft+=3)Tt.push(gt[Ft],gt[Ft+1]),Zt.numPoints++,Zt.numSimplified++;else if(ft==="LineString")ys(Tt,gt,Zt,Re,!1,!1);else if(ft==="MultiLineString"||ft==="Polygon")for(let Ft=0;Ft<gt.length;Ft++)ys(Tt,gt[Ft],Zt,Re,ft==="Polygon",Ft===0);else if(ft==="MultiPolygon")for(let Ft=0;Ft<gt.length;Ft++){const Ct=gt[Ft];for(let Ht=0;Ht<Ct.length;Ht++)ys(Tt,Ct[Ht],Zt,Re,!0,Ht===0)}if(Tt.length){let Ft=Ee.tags||null;if(ft==="LineString"&&tt.lineMetrics){Ft={};for(const Ht in Ee.tags)Ft[Ht]=Ee.tags[Ht];Ft.mapbox_clip_start=gt.start/gt.size,Ft.mapbox_clip_end=gt.end/gt.size}const Ct={geometry:Tt,type:ft==="Polygon"||ft==="MultiPolygon"?3:ft==="LineString"||ft==="MultiLineString"?2:1,tags:Ft};Ee.id!==null&&(Ct.id=Ee.id),Zt.features.push(Ct)}}function ys(Zt,Ee,Re,tt,gt,ft){const Tt=tt*tt;if(tt>0&&Ee.size<(gt?Tt:tt))return void(Re.numPoints+=Ee.length/3);const Ft=[];for(let Ct=0;Ct<Ee.length;Ct+=3)(tt===0||Ee[Ct+2]>Tt)&&(Re.numSimplified++,Ft.push(Ee[Ct],Ee[Ct+1])),Re.numPoints++;gt&&function(Ct,Ht){let Gt=0;for(let $t=0,Sn=Ct.length,Nn=Sn-2;$t<Sn;Nn=$t,$t+=2)Gt+=(Ct[$t]-Ct[Nn])*(Ct[$t+1]+Ct[Nn+1]);if(Gt>0===Ht)for(let $t=0,Sn=Ct.length;$t<Sn/2;$t+=2){const Nn=Ct[$t],qn=Ct[$t+1];Ct[$t]=Ct[Sn-2-$t],Ct[$t+1]=Ct[Sn-1-$t],Ct[Sn-2-$t]=Nn,Ct[Sn-1-$t]=qn}}(Ft,ft),Zt.push(Ft)}const Fa={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Za{constructor(Ee,Re){const tt=(Re=this.options=function(ft,Tt){for(const Ft in Tt)ft[Ft]=Tt[Ft];return ft}(Object.create(Fa),Re)).debug;if(tt&&console.time("preprocess data"),Re.maxZoom<0||Re.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Re.promoteId&&Re.generateId)throw new Error("promoteId and generateId cannot be used together.");let gt=function(ft,Tt){const Ft=[];if(ft.type==="FeatureCollection")for(let Ct=0;Ct<ft.features.length;Ct++)Dn(Ft,ft.features[Ct],Tt,Ct);else Dn(Ft,ft.type==="Feature"?ft:{geometry:ft},Tt);return Ft}(Ee,Re);this.tiles={},this.tileCoords=[],tt&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Re.indexMaxZoom,Re.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),gt=function(ft,Tt){const Ft=Tt.buffer/Tt.extent;let Ct=ft;const Ht=Vr(ft,1,-1-Ft,Ft,0,-1,2,Tt),Gt=Vr(ft,1,1-Ft,2+Ft,0,-1,2,Tt);return(Ht||Gt)&&(Ct=Vr(ft,1,-Ft,1+Ft,0,-1,2,Tt)||[],Ht&&(Ct=yr(Ht,1).concat(Ct)),Gt&&(Ct=Ct.concat(yr(Gt,-1)))),Ct}(gt,Re),gt.length&&this.splitTile(gt,0,0,0),tt&&(gt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Ee,Re,tt,gt,ft,Tt,Ft){const Ct=[Ee,Re,tt,gt],Ht=this.options,Gt=Ht.debug;for(;Ct.length;){gt=Ct.pop(),tt=Ct.pop(),Re=Ct.pop(),Ee=Ct.pop();const $t=1<<Re,Sn=Oo(Re,tt,gt);let Nn=this.tiles[Sn];if(!Nn&&(Gt>1&&console.time("creation"),Nn=this.tiles[Sn]=ti(Ee,Re,tt,gt,Ht),this.tileCoords.push({z:Re,x:tt,y:gt}),Gt)){Gt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Re,tt,gt,Nn.numFeatures,Nn.numPoints,Nn.numSimplified),console.timeEnd("creation"));const Ni=`z${Re}`;this.stats[Ni]=(this.stats[Ni]||0)+1,this.total++}if(Nn.source=Ee,ft==null){if(Re===Ht.indexMaxZoom||Nn.numPoints<=Ht.indexMaxPoints)continue}else{if(Re===Ht.maxZoom||Re===ft)continue;if(ft!=null){const Ni=ft-Re;if(tt!==Tt>>Ni||gt!==Ft>>Ni)continue}}if(Nn.source=null,Ee.length===0)continue;Gt>1&&console.time("clipping");const qn=.5*Ht.buffer/Ht.extent,vr=.5-qn,Or=.5+qn,Rr=1+qn;let qr=null,Ri=null,Xi=null,Hr=null,gi=Vr(Ee,$t,tt-qn,tt+Or,0,Nn.minX,Nn.maxX,Ht),Gr=Vr(Ee,$t,tt+vr,tt+Rr,0,Nn.minX,Nn.maxX,Ht);Ee=null,gi&&(qr=Vr(gi,$t,gt-qn,gt+Or,1,Nn.minY,Nn.maxY,Ht),Ri=Vr(gi,$t,gt+vr,gt+Rr,1,Nn.minY,Nn.maxY,Ht),gi=null),Gr&&(Xi=Vr(Gr,$t,gt-qn,gt+Or,1,Nn.minY,Nn.maxY,Ht),Hr=Vr(Gr,$t,gt+vr,gt+Rr,1,Nn.minY,Nn.maxY,Ht),Gr=null),Gt>1&&console.timeEnd("clipping"),Ct.push(qr||[],Re+1,2*tt,2*gt),Ct.push(Ri||[],Re+1,2*tt,2*gt+1),Ct.push(Xi||[],Re+1,2*tt+1,2*gt),Ct.push(Hr||[],Re+1,2*tt+1,2*gt+1)}}getTile(Ee,Re,tt){Ee=+Ee,Re=+Re,tt=+tt;const gt=this.options,{extent:ft,debug:Tt}=gt;if(Ee<0||Ee>24)return null;const Ft=1<<Ee,Ct=Oo(Ee,Re=Re+Ft&Ft-1,tt);if(this.tiles[Ct])return ki(this.tiles[Ct],ft);Tt>1&&console.log("drilling down to z%d-%d-%d",Ee,Re,tt);let Ht,Gt=Ee,$t=Re,Sn=tt;for(;!Ht&&Gt>0;)Gt--,$t>>=1,Sn>>=1,Ht=this.tiles[Oo(Gt,$t,Sn)];return Ht&&Ht.source?(Tt>1&&(console.log("found parent tile z%d-%d-%d",Gt,$t,Sn),console.time("drilling down")),this.splitTile(Ht.source,Gt,$t,Sn,Ee,Re,tt),Tt>1&&console.timeEnd("drilling down"),this.tiles[Ct]?ki(this.tiles[Ct],ft):null):null}}function Oo(Zt,Ee,Re){return 32*((1<<Zt)*Re+Ee)+Zt}function Ia(Zt,Ee){const Re=Zt.tileID.canonical;if(!this._geoJSONIndex)return void Ee(null,null);const tt=this._geoJSONIndex.getTile(Re.z,Re.x,Re.y);if(!tt)return void Ee(null,null);const gt=new ye(tt.features);let ft=xe(gt);ft.byteOffset===0&&ft.byteLength===ft.buffer.byteLength||(ft=new Uint8Array(ft)),Ee(null,{vectorTile:gt,rawData:ft.buffer})}class fi extends W{constructor(Ee,Re,tt,gt,ft,Tt){super(Ee,Re,tt,gt,Ia,Tt),ft&&(this.loadGeoJSON=ft),this._dynamicIndex=new Ae}loadData(Ee,Re){const tt=Ee&&Ee.request,gt=tt&&tt.collectResourceTiming;this.loadGeoJSON(Ee,(ft,Tt)=>{if(ft||!Tt)return Re(ft);if(typeof Tt!="object")return Re(new Error(`Input data given to '${Ee.source}' is not a valid GeoJSON object.`));{try{if(Ee.filter){const Ct=i.X(Ee.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ct.result==="error")throw new Error(Ct.value.map(Ht=>`${Ht.key}: ${Ht.message}`).join(", "));Tt.features=Tt.features.filter(Ht=>Ct.value.evaluate({zoom:0},Ht))}Ee.dynamic?(Tt.type==="Feature"&&(Tt={type:"FeatureCollection",features:[Tt]}),Ee.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Tt.features,this.loaded),Ee.cluster&&(Tt.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=Ee.cluster?new yt(function({superclusterOptions:Ct,clusterProperties:Ht}){if(!Ht||!Ct)return Ct;const Gt={},$t={},Sn={accumulated:null,zoom:0},Nn={properties:null},qn=Object.keys(Ht);for(const vr of qn){const[Or,Rr]=Ht[vr],qr=i.X(Rr),Ri=i.X(typeof Or=="string"?[Or,["accumulated"],["get",vr]]:Or);Gt[vr]=qr.value,$t[vr]=Ri.value}return Ct.map=vr=>{Nn.properties=vr;const Or={};for(const Rr of qn)Or[Rr]=Gt[Rr].evaluate(Sn,Nn);return Or},Ct.reduce=(vr,Or)=>{Nn.properties=Or;for(const Rr of qn)Sn.accumulated=vr[Rr],vr[Rr]=$t[Rr].evaluate(Sn,Nn)},Ct}(Ee)).load(Tt.features):Ee.dynamic?this._dynamicIndex:function(Ct,Ht){return new Za(Ct,Ht)}(Tt,Ee.geojsonVtOptions)}catch(Ct){return Re(Ct)}const Ft={};if(gt){const Ct=x(tt);Ct&&(Ft.resourceTiming={},Ft.resourceTiming[Ee.source]=JSON.parse(JSON.stringify(Ct)))}Re(null,Ft)}})}reloadTile(Ee,Re){const tt=this.loaded;return tt&&tt[Ee.uid]?Ee.partial?Re(null,void 0):super.reloadTile(Ee,Re):this.loadTile(Ee,Re)}loadGeoJSON(Ee,Re){if(Ee.request)i.n(Ee.request,Re);else{if(typeof Ee.data!="string")return Re(new Error(`Input data given to '${Ee.source}' is not a valid GeoJSON object.`));try{return Re(null,JSON.parse(Ee.data))}catch{return Re(new Error(`Input data given to '${Ee.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Ee,Re){try{Re(null,this._geoJSONIndex.getClusterExpansionZoom(Ee.clusterId))}catch(tt){Re(tt)}}getClusterChildren(Ee,Re){try{Re(null,this._geoJSONIndex.getChildren(Ee.clusterId))}catch(tt){Re(tt)}}getClusterLeaves(Ee,Re){try{Re(null,this._geoJSONIndex.getLeaves(Ee.clusterId,Ee.limit,Ee.offset))}catch(tt){Re(tt)}}}class la{constructor(Ee,Re){this.tileID=new i.aH(Ee.tileID.overscaledZ,Ee.tileID.wrap,Ee.tileID.canonical.z,Ee.tileID.canonical.x,Ee.tileID.canonical.y),this.tileZoom=Ee.tileZoom,this.uid=Ee.uid,this.zoom=Ee.zoom,this.canonical=Ee.tileID.canonical,this.pixelRatio=Ee.pixelRatio,this.tileSize=Ee.tileSize,this.source=Ee.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Ee.projection,this.brightness=Re}parse(Ee,Re,tt,gt){this.status="parsing";const ft=new i.aH(tt.tileID.overscaledZ,tt.tileID.wrap,tt.tileID.canonical.z,tt.tileID.canonical.x,tt.tileID.canonical.y),Tt=[],Ft=Re.familiesBySource[tt.source],Ct=new i.e0(ft,tt.promoteId);return Ct.bucketLayerIDs=[],Ct.is3DTile=!0,i.ei(Ee).then(Ht=>{if(!Ht)return gt(new Error("Could not parse tile"));const Gt=i.ej(Ht,1/i.cd(tt.tileID.canonical)),$t=Ht.json.extensionsUsed&&Ht.json.extensionsUsed.includes("MAPBOX_mesh_features")||Ht.json.asset.extras&&Ht.json.asset.extras.MAPBOX_mesh_features,Sn=Ht.json.extensionsUsed&&Ht.json.extensionsUsed.includes("EXT_meshopt_compression"),Nn=new i.aa(this.zoom,{brightness:this.brightness});for(const qn in Ft)for(const vr of Ft[qn]){const Or=vr[0];Ct.bucketLayerIDs.push(vr.map(qr=>i.C(qr.id,qr.scope))),Or.recalculate(Nn,[]);const Rr=new i.ek(vr,Gt,ft,$t,Sn,this.brightness,Ct);$t||(Rr.needsUpload=!0),Tt.push(Rr),Rr.evaluate(Or)}this.status="done",gt(null,{buckets:Tt,featureIndex:Ct,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Ht=>gt(new Error(Ht.message)))}}class Iu{constructor(Ee,Re,tt,gt,ft,Tt){this.actor=Ee,this.layerIndex=Re,this.availableImages=tt,this.brightness=Tt,this.loading={},this.loaded={}}loadTile(Ee,Re){const tt=Ee.uid,gt=this.loading[tt]=new la(Ee,this.brightness);i.bj(Ee.request,(ft,Tt)=>{const Ft=!this.loading[tt];return delete this.loading[tt],Ft||ft?(gt.status="done",Ft||(this.loaded[tt]=gt),Re(ft)):Tt&&Tt.byteLength!==0?void gt.parse(Tt,this.layerIndex,Ee,(Ct,Ht)=>{gt.status="done",this.loaded=this.loaded||{},this.loaded[tt]=gt,Ct||!Ht?Re(Ct):Re(null,Ht)}):(gt.status="done",this.loaded[tt]=gt,Re())})}reloadTile(Ee,Re){const tt=this.loaded,gt=Ee.uid;if(tt&&tt[gt]){const ft=tt[gt];ft.projection=Ee.projection,ft.brightness=Ee.brightness;const Tt=(Ft,Ct)=>{ft.reloadCallback&&(delete ft.reloadCallback,this.loadTile(Ee,Re)),Re(Ft,Ct)};ft.status==="parsing"?ft.reloadCallback=Tt:ft.status==="done"&&this.loadTile(Ee,Re)}}abortTile(Ee,Re){const tt=Ee.uid;this.loading[tt]&&delete this.loading[tt],Re()}removeTile(Ee,Re){const tt=this.loaded,gt=Ee.uid;tt&&tt[gt]&&delete tt[gt],Re()}}class zs{constructor(Ee){this.self=Ee,this.actor=new i.el(Ee,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new i.y,this.projections={},this.defaultProjection=i.bP({name:"mercator"}),this.workerSourceTypes={vector:W,geojson:fi,"raster-dem":J,"raster-array":he,"batched-model":Iu},this.workerSources={},this.self.registerWorkerSource=(Re,tt)=>{if(this.workerSourceTypes[Re])throw new Error(`Worker source with name "${Re}" already registered.`);this.workerSourceTypes[Re]=tt},this.self.registerRTLTextPlugin=Re=>{if(i.em.isParsed())throw new Error("RTL text plugin already registered.");i.em.applyArabicShaping=Re.applyArabicShaping,i.em.processBidirectionalText=Re.processBidirectionalText,i.em.processStyledBidirectionalText=Re.processStyledBidirectionalText}}clearCaches(Ee,Re,tt){delete this.layerIndexes[Ee],delete this.availableImages[Ee],delete this.workerSources[Ee],tt()}checkIfReady(Ee,Re,tt){tt()}setReferrer(Ee,Re){this.referrer=Re}spriteLoaded(Ee,{scope:Re,isLoaded:tt}){if(this.isSpriteLoaded[Ee]||(this.isSpriteLoaded[Ee]={}),this.isSpriteLoaded[Ee][Re]=tt,this.workerSources[Ee]&&this.workerSources[Ee][Re])for(const gt in this.workerSources[Ee][Re]){const ft=this.workerSources[Ee][Re][gt];for(const Tt in ft){const Ft=ft[Tt];Ft instanceof W&&(Ft.isSpriteLoaded=tt,Ft.fire(new i.A("isSpriteLoaded")))}}}setImages(Ee,{scope:Re,images:tt},gt){if(this.availableImages[Ee]||(this.availableImages[Ee]={}),this.availableImages[Ee][Re]=tt,this.workerSources[Ee]&&this.workerSources[Ee][Re]){for(const ft in this.workerSources[Ee][Re]){const Tt=this.workerSources[Ee][Re][ft];for(const Ft in Tt)Tt[Ft].availableImages=tt}gt()}else gt()}setProjection(Ee,Re){this.projections[Ee]=i.bP(Re)}setBrightness(Ee,Re,tt){this.brightness=Re,tt()}setLayers(Ee,Re,tt){this.getLayerIndex(Ee,Re.scope).replace(Re.layers,Re.options),tt()}updateLayers(Ee,Re,tt){this.getLayerIndex(Ee,Re.scope).update(Re.layers,Re.removedIds,Re.options),tt()}loadTile(Ee,Re,tt){Re.projection=this.projections[Ee]||this.defaultProjection,this.getWorkerSource(Ee,Re.type,Re.source,Re.scope).loadTile(Re,tt)}decodeRasterArray(Ee,Re,tt){this.getWorkerSource(Ee,Re.type,Re.source,Re.scope).decodeRasterArray(Re,tt)}reloadTile(Ee,Re,tt){Re.projection=this.projections[Ee]||this.defaultProjection,this.getWorkerSource(Ee,Re.type,Re.source,Re.scope).reloadTile(Re,tt)}abortTile(Ee,Re,tt){this.getWorkerSource(Ee,Re.type,Re.source,Re.scope).abortTile(Re,tt)}removeTile(Ee,Re,tt){this.getWorkerSource(Ee,Re.type,Re.source,Re.scope).removeTile(Re,tt)}removeSource(Ee,Re,tt){if(!(this.workerSources[Ee]&&this.workerSources[Ee][Re.scope]&&this.workerSources[Ee][Re.scope][Re.type]&&this.workerSources[Ee][Re.scope][Re.type][Re.source]))return;const gt=this.workerSources[Ee][Re.scope][Re.type][Re.source];delete this.workerSources[Ee][Re.scope][Re.type][Re.source],gt.removeSource!==void 0?gt.removeSource(Re,tt):tt()}loadWorkerSource(Ee,Re,tt){try{this.self.importScripts(Re.url),tt()}catch(gt){tt(gt.toString())}}syncRTLPluginState(Ee,Re,tt){try{i.em.setState(Re);const gt=i.em.getPluginURL();if(i.em.isLoaded()&&!i.em.isParsed()&&gt!=null){this.self.importScripts(gt);const ft=i.em.isParsed();tt(ft?void 0:new Error(`RTL Text Plugin failed to import scripts from ${gt}`),ft)}}catch(gt){tt(gt.toString())}}setDracoUrl(Ee,Re){this.dracoUrl=Re}getAvailableImages(Ee,Re){this.availableImages[Ee]||(this.availableImages[Ee]={});let tt=this.availableImages[Ee][Re];return tt||(tt=[]),tt}getLayerIndex(Ee,Re){this.layerIndexes[Ee]||(this.layerIndexes[Ee]={});let tt=this.layerIndexes[Ee][Re];return tt||(tt=this.layerIndexes[Ee][Re]=new R,tt.scope=Re),tt}getWorkerSource(Ee,Re,tt,gt){const ft=this.workerSources;return ft[Ee]||(ft[Ee]={}),ft[Ee][gt]||(ft[Ee][gt]={}),ft[Ee][gt][Re]||(ft[Ee][gt][Re]={}),this.isSpriteLoaded[Ee]||(this.isSpriteLoaded[Ee]={}),ft[Ee][gt][Re][tt]||(ft[Ee][gt][Re][tt]=new this.workerSourceTypes[Re]({send:(Tt,Ft,Ct,Ht,Gt,$t)=>{this.actor.send(Tt,Ft,Ct,Ee,Gt,$t)},scheduler:this.actor.scheduler},this.getLayerIndex(Ee,gt),this.getAvailableImages(Ee,gt),this.isSpriteLoaded[Ee][gt],void 0,this.brightness)),ft[Ee][gt][Re][tt]}rasterizeImages(Ee,Re,tt){const gt=new Map;for(const[ft,{image:Tt,imageVariant:Ft}]of Re.tasks.entries()){const Ct=this.imageRasterizer.rasterize(Ft,Tt,Re.scope,Ee);gt.set(ft,Ct)}tt(void 0,gt)}removeRasterizedImages(Ee,Re,tt){this.imageRasterizer.removeImagesFromCacheByIds(Re.imageIds,Re.scope,Ee),tt()}enforceCacheSizeLimit(Ee,Re){i.en(Re)}getWorkerPerformanceMetrics(Ee,Re,tt){tt(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new zs(self)),zs}),l(["./shared"],function(i){var x="3.11.0";const S={create:"create",load:"load",fullLoad:"fullLoad"},I={mark(y){performance.mark(y)},measure(y,o,u){performance.measure(y,o,u)}};function R(y){const o=y.name.split("?")[0];return i.a(o)&&o.includes("mapbox-gl.js")?"javascript":i.a(o)&&o.includes("mapbox-gl.css")?"css":i.b(o)?"fontRange":i.c(o)?"sprite":i.i(o)?"style":i.d(o)?"tilejson":"other"}var F,j={},H=function(){if(F)return j;function y(_){return!o(_)}function o(_){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var T,C,z=new Blob([""],{type:"text/javascript"}),V=URL.createObjectURL(z);try{C=new Worker(V),T=!0}catch{T=!1}return C&&C.terminate(),URL.revokeObjectURL(V),T}()?function(){var T=document.createElement("canvas");T.width=T.height=1;var C=T.getContext("2d");if(!C)return!1;var z=C.getImageData(0,0,1,1);return z&&z.width===T.width}()?(u[w=_&&_.failIfMajorPerformanceCaveat]===void 0&&(u[w]=function(T){var C,z=function(V){var $=document.createElement("canvas"),K=Object.create(y.webGLContextAttributes);return K.failIfMajorPerformanceCaveat=V,$.getContext("webgl2",K)}(T);if(!z)return!1;try{C=z.createShader(z.VERTEX_SHADER)}catch{return!1}return!(!C||z.isContextLost())&&(z.shaderSource(C,"void main() {}"),z.compileShader(C),z.getShaderParameter(C,z.COMPILE_STATUS)===!0)}(w)),u[w]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var w}F=1,j.supported=y,j.notSupportedReason=o;var u={};return y.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},j}();function G(y,o,u){const _=document.createElement(y);return o!=null&&(_.className=o),u&&u.appendChild(_),_}function W(y,o,u){const _=document.createElementNS("http://www.w3.org/2000/svg",y);for(const w of Object.keys(o))_.setAttributeNS(null,w,String(o[w]));return u&&u.appendChild(_),_}const J=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ie=J&&J.userSelect!==void 0?"userSelect":"WebkitUserSelect";let he;function ge(){J&&ie&&(he=J[ie],J[ie]="none")}function fe(){J&&ie&&(J[ie]=he)}function ye(y){y.preventDefault(),y.stopPropagation(),window.removeEventListener("click",ye,!0)}function pe(){window.addEventListener("click",ye,!0),window.setTimeout(()=>{window.removeEventListener("click",ye,!0)},0)}function be(y,o){const u=y.getBoundingClientRect();return ue(y,u,o)}function Ae(y,o){const u=y.getBoundingClientRect(),_=[];for(let w=0;w<o.length;w++)_.push(ue(y,u,o[w]));return _}function Oe(y){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&y.button===2&&y.ctrlKey?0:y.button}function ue(y,o,u){const _=y.offsetWidth===o.width?1:y.offsetWidth/o.width;return new i.P((u.clientX-o.left)*_,(u.clientY-o.top)*_)}const we="01",ke="NO_ACCESS_TOKEN";class De{constructor(o,u,_){this._transformRequestFn=o,this._customAccessToken=u,this._silenceAuthErrors=!!_,this._createSkuToken()}_createSkuToken(){const o=function(){let u="";for(let _=0;_<10;_++)u+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",we,u].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,u){return this._transformRequestFn&&this._transformRequestFn(o,u)||{url:o}}normalizeStyleURL(o,u){if(!i.f(o))return o;const _=ze(o);return _.params.push(`sdk=js-${x}`),_.path=`/styles/v1${_.path}`,this._makeAPIURL(_,this._customAccessToken||u)}normalizeGlyphsURL(o,u){if(!i.f(o))return o;const _=ze(o);return _.path=`/fonts/v1${_.path}`,this._makeAPIURL(_,this._customAccessToken||u)}normalizeModelURL(o,u){if(!i.f(o))return o;const _=ze(o);return _.path=`/models/v1${_.path}`,this._makeAPIURL(_,this._customAccessToken||u)}normalizeSourceURL(o,u,_,w){if(!i.f(o))return o;const T=ze(o);return T.path=`/v4/${T.authority}.json`,T.params.push("secure"),_&&T.params.push(`language=${_}`),w&&T.params.push(`worldview=${w}`),this._makeAPIURL(T,this._customAccessToken||u)}normalizeIconsetURL(o,u){const _=ze(o);return i.f(o)?(_.path=`/styles/v1${_.path}/iconset.pbf`,this._makeAPIURL(_,this._customAccessToken||u)):Ue(_)}normalizeSpriteURL(o,u,_,w){const T=ze(o);return i.f(o)?(T.path=`/styles/v1${T.path}/sprite${u}${_}`,this._makeAPIURL(T,this._customAccessToken||w)):(T.path+=`${u}${_}`,Ue(T))}normalizeTileURL(o,u,_){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!i.f(o))return o;const w=ze(o);w.path=w.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${u||_&&w.authority!=="raster"&&_===512?"@2x":""}${i.m.supported?".webp":"$1"}`),w.authority==="raster"?w.path=`/${i.e.RASTER_URL_PREFIX}${w.path}`:w.authority==="rasterarrays"?w.path=`/${i.e.RASTERARRAYS_URL_PREFIX}${w.path}`:w.authority==="3dtiles"?w.path=`/${i.e.TILES3D_URL_PREFIX}${w.path}`:(w.path=w.path.replace(/^.+\/v4\//,"/"),w.path=`/${i.e.TILE_URL_VERSION}${w.path}`);const T=this._customAccessToken||function(C){for(const z of C){const V=z.match(/^access_token=(.*)$/);if(V)return V[1]}return null}(w.params)||i.e.ACCESS_TOKEN;return i.e.REQUIRE_ACCESS_TOKEN&&T&&this._skuToken&&w.params.push(`sku=${this._skuToken}`),this._makeAPIURL(w,T)}canonicalizeTileURL(o,u){const _=ze(o);if(!_.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!_.path.match(/\.[\w]+$/))return o;let w="mapbox://";_.path.match(/^\/raster\/v1\//)?w+=`raster/${_.path.replace(`/${i.e.RASTER_URL_PREFIX}/`,"")}`:_.path.match(/^\/rasterarrays\/v1\//)?w+=`rasterarrays/${_.path.replace(`/${i.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:w+=`tiles/${_.path.replace(`/${i.e.TILE_URL_VERSION}/`,"")}`;let T=_.params;return u&&(T=T.filter(C=>!C.match(/^access_token=/))),T.length&&(w+=`?${T.join("&")}`),w}canonicalizeTileset(o,u){const _=!!u&&i.f(u),w=[];for(const T of o.tiles||[])i.h(T)?w.push(this.canonicalizeTileURL(T,_)):w.push(T);return w}_makeAPIURL(o,u){const _="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",w=ze(i.e.API_URL);if(o.protocol=w.protocol,o.authority=w.authority,o.protocol==="http"){const T=o.params.indexOf("secure");T>=0&&o.params.splice(T,1)}if(w.path!=="/"&&(o.path=`${w.path}${o.path}`),!i.e.REQUIRE_ACCESS_TOKEN)return Ue(o);if(u=u||i.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!u)throw new Error(`An API access token is required to use Mapbox GL. ${_}`);if(u[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${_}`)}return o.params=o.params.filter(T=>T.indexOf("access_token")===-1),o.params.push(`access_token=${u||""}`),Ue(o)}}const je=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ze(y){const o=y.match(je);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function Ue(y){const o=y.params.length?`?${y.params.join("&")}`:"";return`${y.protocol}://${y.authority}${y.path}${o}`}const Fe="mapbox.eventData";function Qe(y){if(!y)return null;const o=y.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(i.j(o[1]))}catch{return null}}class Be{constructor(o){this.type=o,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){const u=Qe(i.e.ACCESS_TOKEN);let _="";return _=u&&u.u?i.k(u.u):i.e.ACCESS_TOKEN||"",o?`${Fe}.${o}:${_}`:`${Fe}:${_}`}fetchEventData(){const o=i.s("localStorage"),u=this.getStorageKey(),_=this.getStorageKey("uuid");if(o)try{const w=localStorage.getItem(u);w&&(this.eventData=JSON.parse(w));const T=localStorage.getItem(_);T&&(this.anonId=T)}catch{i.w("Unable to read from LocalStorage")}}saveEventData(){const o=i.s("localStorage"),u=this.getStorageKey(),_=this.getStorageKey("uuid"),w=this.anonId;if(o&&w)try{localStorage.setItem(_,w),Object.keys(this.eventData).length>=1&&localStorage.setItem(u,JSON.stringify(this.eventData))}catch{i.w("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,u,_,w){if(!i.e.EVENTS_URL)return;const T=ze(i.e.EVENTS_URL);T.params.push(`access_token=${w||i.e.ACCESS_TOKEN||""}`);const C={event:this.type,created:new Date(o).toISOString()},z=u?i.l(C,u):C,V={url:Ue(T),headers:{"Content-Type":"text/plain"},body:JSON.stringify([z])};this.pendingRequest=i.p(V,$=>{this.pendingRequest=null,_($),this.saveEventData(),this.processRequests(w)})}queueRequest(o,u){this.queue.push(o),this.processRequests(u)}}const bt=new class extends Be{constructor(y){super("appUserTurnstile"),this._customAccessToken=y}postTurnstileEvent(y,o){i.e.EVENTS_URL&&i.e.ACCESS_TOKEN&&Array.isArray(y)&&y.some(u=>i.f(u)||i.h(u))&&this.queueRequest(Date.now(),o)}processRequests(y){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const o=Qe(i.e.ACCESS_TOKEN),u=o?o.u:i.e.ACCESS_TOKEN;let _=u!==this.eventData.tokenU;i.v(this.anonId)||(this.anonId=i.u(),_=!0);const w=this.queue.shift();if(this.eventData.lastSuccess){const T=new Date(this.eventData.lastSuccess),C=new Date(w),z=(w-this.eventData.lastSuccess)/864e5;_=_||z>=1||z<-1||T.getDate()!==C.getDate()}else _=!0;_?this.postEvent(w,{sdkIdentifier:"mapbox-gl-js",sdkVersion:x,skuId:we,"enabled.telemetry":!1,userId:this.anonId},T=>{T||(this.eventData.lastSuccess=w,this.eventData.tokenU=u)},y):this.processRequests()}},xe=bt.postTurnstileEvent.bind(bt),Le=new class extends Be{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(y,o,u,_){this.skuToken=o,this.errorCb=_,i.e.EVENTS_URL&&(u||i.e.ACCESS_TOKEN?this.queueRequest({id:y,timestamp:Date.now()},u):this.errorCb(new Error(ke)))}processRequests(y){if(this.pendingRequest||this.queue.length===0)return;const{id:o,timestamp:u}=this.queue.shift();o&&this.success[o]||(this.anonId||this.fetchEventData(),i.v(this.anonId)||(this.anonId=i.u()),this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:x,skuId:we,skuToken:this.skuToken,userId:this.anonId},_=>{_?this.errorCb(_):o&&(this.success[o]=!0)},y))}remove(){this.errorCb=null}},Xe=Le.postMapLoadEvent.bind(Le),ct=new class extends Be{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(y){let o=this.mapInstanceIdMap.get(y);return o||(o=i.u(),this.mapInstanceIdMap.set(y,o)),o}getEventId(y){const o=this.eventIdPerMapInstanceMap.get(y)||0;return this.eventIdPerMapInstanceMap.set(y,o+1),o}postStyleLoadEvent(y,o){const{map:u,style:_,importedStyles:w}=o;if(!i.e.EVENTS_URL||!y&&!i.e.ACCESS_TOKEN)return;const T=this.getMapInstanceId(u),C={mapInstanceId:T,eventId:this.getEventId(T),style:_};w.length&&(C.importedStyles=w),this.queueRequest({timestamp:Date.now(),payload:C},y)}processRequests(y){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,payload:u}=this.queue.shift();this.postEvent(o,u,()=>{},y)}},vt=ct.postStyleLoadEvent.bind(ct),Nt=new class extends Be{constructor(){super("gljs.performance")}postPerformanceEvent(y,o){i.e.EVENTS_URL&&(y||i.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},y)}processRequests(y){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,performanceData:u}=this.queue.shift(),_=function(w){const T=performance.getEntriesByType("resource"),C=performance.getEntriesByType("mark"),z=function(ce){const Te={};if(ce){for(const ve in ce)if(ve!=="other")for(const Ce of ce[ve]){const Pe=`${ve}ResolveRangeMin`,qe=`${ve}ResolveRangeMax`,Je=`${ve}RequestCount`,Ye=`${ve}RequestCachedCount`;Te[Pe]=Math.min(Te[Pe]||1/0,Ce.startTime),Te[qe]=Math.max(Te[qe]||-1/0,Ce.responseEnd);const lt=nt=>{Te[nt]===void 0&&(Te[nt]=0),++Te[nt]};Ce.transferSize!==void 0&&Ce.transferSize===0&&lt(Ye),lt(Je)}}return Te}(function(ce,Te){const ve={};if(ce)for(const Ce of ce){const Pe=Te(Ce);ve[Pe]===void 0&&(ve[Pe]=[]),ve[Pe].push(Ce)}return ve}(T,R)),V=window.devicePixelRatio,$=navigator.connection||navigator.mozConnection||navigator.webkitConnection,K=$?$.effectiveType:void 0,ee={counters:[],metadata:[],attributes:[]},te=(ce,Te,ve)=>{ve!=null&&ce.push({name:Te,value:ve.toString()})};for(const ce in z)te(ee.counters,ce,z[ce]);if(w.interactionRange[0]!==1/0&&w.interactionRange[1]!==-1/0&&(te(ee.counters,"interactionRangeMin",w.interactionRange[0]),te(ee.counters,"interactionRangeMax",w.interactionRange[1])),C)for(const ce of Object.keys(S)){const Te=S[ce],ve=C.find(Ce=>Ce.name===Te);ve&&te(ee.counters,Te,ve.startTime)}return te(ee.counters,"visibilityHidden",w.visibilityHidden),te(ee.attributes,"style",function(ce){if(ce)for(const Te of ce){const ve=Te.name.split("?")[0];if(i.i(ve)){const Ce=ve.split("/").slice(-2);if(Ce.length===2)return`mapbox://styles/${Ce[0]}/${Ce[1]}`}}}(T)),te(ee.attributes,"terrainEnabled",w.terrainEnabled?"true":"false"),te(ee.attributes,"fogEnabled",w.fogEnabled?"true":"false"),te(ee.attributes,"projection",w.projection),te(ee.attributes,"zoom",w.zoom),te(ee.metadata,"devicePixelRatio",V),te(ee.metadata,"connectionEffectiveType",K),te(ee.metadata,"navigatorUserAgent",navigator.userAgent),te(ee.metadata,"screenWidth",window.screen.width),te(ee.metadata,"screenHeight",window.screen.height),te(ee.metadata,"windowWidth",window.innerWidth),te(ee.metadata,"windowHeight",window.innerHeight),te(ee.metadata,"mapWidth",w.width/V),te(ee.metadata,"mapHeight",w.height/V),te(ee.metadata,"webglRenderer",w.renderer),te(ee.metadata,"webglVendor",w.vendor),te(ee.metadata,"sdkVersion",x),te(ee.metadata,"sdkIdentifier","mapbox-gl-js"),ee}(u);for(const w of _.metadata);for(const w of _.counters);for(const w of _.attributes);this.postEvent(o,_,()=>{},y)}},mt=Nt.postPerformanceEvent.bind(Nt),yt=new class extends Be{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(y,o,u,_){if(!i.e.API_URL||!i.e.SESSION_PATH)return;const w=ze(i.e.API_URL+i.e.SESSION_PATH);w.params.push(`sku=${o||""}`),w.params.push(`access_token=${_||i.e.ACCESS_TOKEN||""}`);const T={url:Ue(w),headers:{"Content-Type":"text/plain"}};this.pendingRequest=i.g(T,C=>{this.pendingRequest=null,u(C),this.saveEventData(),this.processRequests(_)})}getSessionAPI(y,o,u,_){this.skuToken=o,this.errorCb=_,i.e.SESSION_PATH&&i.e.API_URL&&(u||i.e.ACCESS_TOKEN?this.queueRequest({id:y,timestamp:Date.now()},u):this.errorCb(new Error(ke)))}processRequests(y){if(this.pendingRequest||this.queue.length===0)return;const{id:o,timestamp:u}=this.queue.shift();o&&this.success[o]||this.getSession(u,this.skuToken,_=>{_?this.errorCb(_):o&&(this.success[o]=!0)},y)}remove(){this.errorCb=null}},_e=yt.getSessionAPI.bind(yt),on=new Set;function Kt(y,o){o?on.add(y):on.delete(y)}class Pn{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(o,u){this._updatedSourceCaches[o]=u,this.setDirty()}discardSourceCacheUpdate(o){delete this._updatedSourceCaches[o]}updateLayer(o){const u=o.scope;this._updatedLayers[u]=this._updatedLayers[u]||new Set,this._updatedLayers[u].add(o.id),this.setDirty()}removeLayer(o){const u=o.scope;this._removedLayers[u]=this._removedLayers[u]||{},this._updatedLayers[u]=this._updatedLayers[u]||new Set,this._removedLayers[u][o.id]=o,this._updatedLayers[u].delete(o.id),this._updatedPaintProps.delete(o.fqid),this.setDirty()}getRemovedLayer(o){return this._removedLayers[o.scope]?this._removedLayers[o.scope][o.id]:null}discardLayerRemoval(o){this._removedLayers[o.scope]&&delete this._removedLayers[o.scope][o.id]}getLayerUpdatesByScope(){const o={};for(const u in this._updatedLayers)o[u]=o[u]||{},o[u].updatedIds=Array.from(this._updatedLayers[u].values());for(const u in this._removedLayers)o[u]=o[u]||{},o[u].removedIds=Object.keys(this._removedLayers[u]);return o}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(o){this._updatedPaintProps.add(o.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(o){this._updatedImages.add(i.I.toString(o)),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function Ut(y){const{userImage:o}=y;return!!(o&&o.render&&o.render())&&(y.data.replace(new Uint8Array(o.data.buffer)),!0)}class cn extends i.E{constructor(o){super(),this._images={},this._iconsets={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.patternsInFlight=new Set,this.atlasImage={},this.atlasTexture={},this.dirty=!0,this.spriteFormat=o,o!=="raster"&&i.t()&&(this.imageRasterizerDispatcher=new i.D(i.x(),this,"Image Rasterizer Worker",1))}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new i.y),this._imageRasterizer}createScope(o){this._images[o]={},this._iconsets[o]={},this.loaded[o]=!1,this.updatedImages[o]=new Set,this.patterns[o]={},this.callbackDispatchedThisFrame[o]=new Set,this.atlasImage[o]=new i.r({width:1,height:1})}createIconset(o,u){this._iconsets[o][u]={}}isLoaded(){for(const o in this.loaded)if(!this.loaded[o])return!1;return!0}setLoaded(o,u){if(this.loaded[u]!==o&&(this.loaded[u]=o,o)){for(const{ids:_,callback:w}of this.requestors)this._notify(_,u,w);this.requestors=[]}}hasImage(o,u){return!!this.getImage(o,u)}getImage(o,u){return(o.iconsetId?this._iconsets[u][o.iconsetId]:this._images[u])[o.name]}addImage(o,u,_){const w=o.iconsetId?this._iconsets[u][o.iconsetId]:this._images[u];this._validate(o,_)&&(w[o.name]=_)}_validate(o,u){let _=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new i.z(new Error(`Image "${o.name}" has invalid "stretchX" value`))),_=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new i.z(new Error(`Image "${o.name}" has invalid "stretchY" value`))),_=!1),this._validateContent(u.content,u)||(this.fire(new i.z(new Error(`Image "${o.name}" has invalid "content" value`))),_=!1),_}_validateStretch(o,u){if(!o)return!0;let _=0;for(const w of o){if(w[0]<_||w[1]<w[0]||u<w[1])return!1;_=w[1]}return!0}_validateContent(o,u){return o?o.length!==4||!u.usvg&&(o[0]<0||u.data.width<o[0]||o[1]<0||u.data.height<o[1]||o[2]<0||u.data.width<o[2]||o[3]<0||u.data.height<o[3])?!1:!(o[2]<o[0]||o[3]<o[1]):!0}updateImage(o,u,_){const w=o.iconsetId?this._iconsets[u][o.iconsetId]:this._images[u];_.version=w[o.name].version+1,w[o.name]=_,this.updatedImages[u].add(o),this.removeFromImageRasterizerCache(o,u)}clearUpdatedImages(o){this.updatedImages[o].clear()}removeFromImageRasterizerCache(o,u){if(this.spriteFormat!=="raster")if(i.t()){const _={imageIds:[o],scope:u};this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",_)}else this.imageRasterizer.removeImagesFromCacheByIds([o],u)}removeImage(o,u){const _=o.iconsetId?this._iconsets[u][o.iconsetId]:this._images[u],w=_[o.name];delete _[o.name],delete this.patterns[u][o.name],this.removeFromImageRasterizerCache(o,u),w.userImage&&w.userImage.onRemove&&w.userImage.onRemove()}listImages(o){const u=[];for(const _ of Object.keys(this._images[o]))u.push(new i.I(_));for(const _ in this._iconsets[o])for(const w of Object.keys(this._iconsets[o][_]))u.push(new i.I({name:w,iconsetId:_}));return u}getImages(o,u,_){let w=!0;const T=!!this.loaded[u];if(!T)for(const C of o)(C.iconsetId?this._iconsets[u][C.iconsetId]:this._images[u])[C.name]||(w=!1);T||w?this._notify(o,u,_):this.requestors.push({ids:o,scope:u,callback:_})}rasterizeImages({scope:o,tasks:u},_){const w=new Map;for(const[T,C]of u.entries()){const z=this.getImage(C.id,o);z&&w.set(T,{image:z,imageVariant:C})}this._rasterizeImages(o,w,_)}_rasterizeImages(o,u,_){if(i.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{tasks:u,scope:o},_);else{const w=new Map;for(const[T,{image:C,imageVariant:z}]of u.entries())w.set(T,this.imageRasterizer.rasterize(z,C,o,0));_(void 0,w)}}getUpdatedImages(o){return this.updatedImages[o]||new Set}_notify(o,u,_){const w=new Map;for(const T of o){T.iconsetId&&(this._iconsets[u][T.iconsetId]=this._iconsets[u][T.iconsetId]||{});const C=(T.iconsetId?this._iconsets[u][T.iconsetId]:this._images[u])[T.name];if(!C){if(T.iconsetId)continue;i.w(`Image "${T.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`),this.fire(new i.A("styleimagemissing",{id:T.name}));continue}const z={data:C.usvg?null:C.data.clone(),pixelRatio:C.pixelRatio,sdf:C.sdf,usvg:C.usvg,version:C.version,stretchX:C.stretchX,stretchY:C.stretchY,content:C.content,hasRenderCallback:!!(C.userImage&&C.userImage.render)};C.usvg&&Object.assign(z,{width:C.icon.usvg_tree.width,height:C.icon.usvg_tree.height}),w.set(i.I.toString(T),z)}_(null,w)}getPixelSize(o){const{width:u,height:_}=this.atlasImage[o];return{width:u,height:_}}getPattern(o,u,_){const w=this.patterns[u][o.name],T=this.getImage(o,u);if(!T)return null;if(w){if(w.position.version===T.version)return w.position;w.position.version=T.version}else{if(T.usvg&&!T.data){const C=this.getPatternInFlightId(o.toString(),u);if(this.patternsInFlight.has(C))return null;this.patternsInFlight.add(C);const z=new i.B(o).scaleSelf(i.q.devicePixelRatio),V=new Map([[z.toString(),{image:T,imageVariant:z}]]);return this._rasterizeImages(u,V,($,K)=>this.storePatternImage(z,u,T,_,K)),null}this.storePattern(o,u,T)}return this._updatePatternAtlas(u,_),this.patterns[u][o.name].position}getPatternInFlightId(o,u){return i.C(o,u)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(o,u,_,w,T){const C=o.toString(),z=T?T.get(C):void 0;z&&(_.data=z,this.storePattern(o.id,u,_),this._updatePatternAtlas(u,w),this.patternsInFlight.delete(this.getPatternInFlightId(o.id.toString(),u)))}storePattern(o,u,_){const w={w:_.data.width+2*i.F,h:_.data.height+2*i.F,x:0,y:0},T=new i.G(w,_,i.F);this.patterns[u][o.name]={bin:w,position:T}}bind(o,u){const _=o.gl;let w=this.atlasTexture[u];w?this.dirty&&(w.update(this.atlasImage[u]),this.dirty=!1):(w=new i.T(o,this.atlasImage[u],_.RGBA8),this.atlasTexture[u]=w),w.bind(_.LINEAR,_.CLAMP_TO_EDGE)}_updatePatternAtlas(o,u){const _=[];for(const z in this.patterns[o])_.push(this.patterns[o][z].bin);const{w,h:T}=i.H(_),C=this.atlasImage[o];C.resize({width:w||1,height:T||1});for(const z in this.patterns[o]){const{bin:V,position:$}=this.patterns[o][z];let K=$.padding;const ee=V.x+K,te=V.y+K,ce=this._images[o][z].data,Te=ce.width,ve=ce.height;K=K>1?K-1:K,i.r.copy(ce,C,{x:0,y:0},{x:ee,y:te},{width:Te,height:ve},u),i.r.copy(ce,C,{x:0,y:ve-K},{x:ee,y:te-K},{width:Te,height:K},u),i.r.copy(ce,C,{x:0,y:0},{x:ee,y:te+ve},{width:Te,height:K},u),i.r.copy(ce,C,{x:Te-K,y:0},{x:ee-K,y:te},{width:K,height:ve},u),i.r.copy(ce,C,{x:0,y:0},{x:ee+Te,y:te},{width:K,height:ve},u),i.r.copy(ce,C,{x:Te-K,y:ve-K},{x:ee-K,y:te-K},{width:K,height:K},u),i.r.copy(ce,C,{x:0,y:ve-K},{x:ee+Te,y:te-K},{width:K,height:K},u),i.r.copy(ce,C,{x:0,y:0},{x:ee+Te,y:te+ve},{width:K,height:K},u),i.r.copy(ce,C,{x:Te-K,y:0},{x:ee-K,y:te+ve},{width:K,height:K},u)}this.dirty=!0}beginFrame(){for(const o in this._images)this.callbackDispatchedThisFrame[o]=new Set}dispatchRenderCallbacks(o,u){for(const _ of o){if(this.callbackDispatchedThisFrame[u].has(_.toString()))continue;this.callbackDispatchedThisFrame[u].add(_.toString());const w=(_.iconsetId?this._iconsets[u][_.iconsetId]:this._images[u])[_.name];Ut(w)&&this.updateImage(_,u,w)}}}function At(y){const o=y.key,u=y.value,_=y.valueSpec||{},w=y.objectElementValidators||{},T=y.style,C=y.styleSpec;let z=[];const V=i.K(u);if(V!=="object")return[new i.V(o,u,`object expected, ${V} found`)];for(const $ in u){const K=$.split(".")[0];let ee;w[K]?ee=w[K]:_[K]?ee=Pr:w["*"]?ee=w["*"]:_["*"]&&(ee=Pr),ee?z=z.concat(ee({key:(o&&`${o}.`)+$,value:u[$],valueSpec:_[K]||_["*"],style:T,styleSpec:C,object:u,objectKey:$},u)):z.push(new i.J(o,u[$],`unknown property "${$}"`))}for(const $ in _)w[$]||_[$].required&&_[$].default===void 0&&u[$]===void 0&&z.push(new i.V(o,u,`missing required property "${$}"`));return z}function xr(y){const o=y.value,u=y.valueSpec,_=y.style,w=y.styleSpec,T=y.key,C=y.arrayElementValidator||Pr;if(i.K(o)!=="array")return[new i.V(T,o,`array expected, ${i.K(o)} found`)];if(u.length&&o.length!==u.length)return[new i.V(T,o,`array length ${u.length} expected, length ${o.length} found`)];if(u["min-length"]&&o.length<u["min-length"])return[new i.V(T,o,`array length at least ${u["min-length"]} expected, length ${o.length} found`)];let z={type:u.value,values:u.values,minimum:u.minimum,maximum:u.maximum,function:void 0};w.$version<7&&(z.function=u.function),i.K(u.value)==="object"&&(z=u.value);let V=[];for(let $=0;$<o.length;$++)V=V.concat(C({array:o,arrayIndex:$,value:o[$],valueSpec:z,style:_,styleSpec:w,key:`${T}[${$}]`},!0));return V}function Rn(y){const o=y.key,u=y.value,_=y.valueSpec;let w=i.K(u);if(w==="number"&&u!=u&&(w="NaN"),w!=="number")return[new i.V(o,u,`number expected, ${w} found`)];if("minimum"in _){let T=_.minimum;if(i.K(_.minimum)==="array"&&(T=_.minimum[y.arrayIndex]),u<T)return[new i.V(o,u,`${u} is less than the minimum value ${T}`)]}if("maximum"in _){let T=_.maximum;if(i.K(_.maximum)==="array"&&(T=_.maximum[y.arrayIndex]),u>T)return[new i.V(o,u,`${u} is greater than the maximum value ${T}`)]}return[]}function Dn(y){const o=y.valueSpec,u=i.M(y.value.type);let _,w,T,C={};const z=u!=="categorical"&&y.value.property===void 0,V=!z,$=i.K(y.value.stops)==="array"&&i.K(y.value.stops[0])==="array"&&i.K(y.value.stops[0][0])==="object",K=At({key:y.key,value:y.value,valueSpec:y.styleSpec.function,style:y.style,styleSpec:y.styleSpec,objectElementValidators:{stops:function(ce){if(u==="identity")return[new i.V(ce.key,ce.value,'identity function may not have a "stops" property')];let Te=[];const ve=ce.value;return Te=Te.concat(xr({key:ce.key,value:ve,valueSpec:ce.valueSpec,style:ce.style,styleSpec:ce.styleSpec,arrayElementValidator:ee})),i.K(ve)==="array"&&ve.length===0&&Te.push(new i.V(ce.key,ve,"array must have at least one stop")),Te},default:function(ce){return Pr({key:ce.key,value:ce.value,valueSpec:o,style:ce.style,styleSpec:ce.styleSpec})}}});return u==="identity"&&z&&K.push(new i.V(y.key,y.value,'missing required property "property"')),u==="identity"||y.value.stops||K.push(new i.V(y.key,y.value,'missing required property "stops"')),u==="exponential"&&y.valueSpec.expression&&!i.N(y.valueSpec)&&K.push(new i.V(y.key,y.value,"exponential functions not supported")),y.styleSpec.$version>=8&&(V&&!i.O(y.valueSpec)?K.push(new i.V(y.key,y.value,"property functions not supported")):z&&!i.Q(y.valueSpec)&&K.push(new i.V(y.key,y.value,"zoom functions not supported"))),u!=="categorical"&&!$||y.value.property!==void 0||K.push(new i.V(y.key,y.value,'"property" property is required')),K;function ee(ce){let Te=[];const ve=ce.value,Ce=ce.key;if(i.K(ve)!=="array")return[new i.V(Ce,ve,`array expected, ${i.K(ve)} found`)];if(ve.length!==2)return[new i.V(Ce,ve,`array length 2 expected, length ${ve.length} found`)];if($){if(i.K(ve[0])!=="object")return[new i.V(Ce,ve,`object expected, ${i.K(ve[0])} found`)];if(ve[0].zoom===void 0)return[new i.V(Ce,ve,"object stop key must have zoom")];if(ve[0].value===void 0)return[new i.V(Ce,ve,"object stop key must have value")];const Pe=i.M(ve[0].zoom);if(typeof Pe!="number")return[new i.V(Ce,ve[0].zoom,"stop zoom values must be numbers")];if(T&&T>Pe)return[new i.V(Ce,ve[0].zoom,"stop zoom values must appear in ascending order")];Pe!==T&&(T=Pe,w=void 0,C={}),Te=Te.concat(At({key:`${Ce}[0]`,value:ve[0],valueSpec:{zoom:{}},style:ce.style,styleSpec:ce.styleSpec,objectElementValidators:{zoom:Rn,value:te}}))}else Te=Te.concat(te({key:`${Ce}[0]`,value:ve[0],style:ce.style,styleSpec:ce.styleSpec},ve));return i.S(i.U(ve[1]))?Te.concat([new i.V(`${Ce}[1]`,ve[1],"expressions are not allowed in function stops.")]):Te.concat(Pr({key:`${Ce}[1]`,value:ve[1],valueSpec:o,style:ce.style,styleSpec:ce.styleSpec}))}function te(ce,Te){const ve=i.K(ce.value),Ce=i.M(ce.value),Pe=ce.value!==null?ce.value:Te;if(_){if(ve!==_)return[new i.V(ce.key,Pe,`${ve} stop domain type must match previous stop domain type ${_}`)]}else _=ve;if(ve!=="number"&&ve!=="string"&&ve!=="boolean"&&typeof Ce!="number"&&typeof Ce!="string"&&typeof Ce!="boolean")return[new i.V(ce.key,Pe,"stop domain value must be a number, string, or boolean")];if(ve!=="number"&&u!=="categorical"){let qe=`number expected, ${ve} found`;return i.O(o)&&u===void 0&&(qe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i.V(ce.key,Pe,qe)]}return u!=="categorical"||ve!=="number"||typeof Ce=="number"&&isFinite(Ce)&&Math.floor(Ce)===Ce?u!=="categorical"&&ve==="number"&&typeof Ce=="number"&&typeof w=="number"&&w!==void 0&&Ce<w?[new i.V(ce.key,Pe,"stop domain values must appear in ascending order")]:(w=Ce,u==="categorical"&&Ce in C?[new i.V(ce.key,Pe,"stop domain values must be unique")]:(C[Ce]=!0,[])):[new i.V(ce.key,Pe,`integer expected, found ${String(Ce)}`)]}}function ar(y){const o=(y.expressionContext==="property"?i.W:i.X)(i.U(y.value),y.valueSpec);if(o.result==="error")return o.value.map(_=>new i.V(`${y.key}${_.key}`,y.value,_.message));const u=o.value.expression||o.value._styleExpression.expression;if(y.expressionContext==="property"&&y.propertyKey==="text-font"&&!u.outputDefined())return[new i.V(y.key,y.value,`Invalid data expression for "${y.propertyKey}". Output values must be contained as literals within the expression.`)];if(y.expressionContext==="property"&&y.propertyType==="layout"&&!i.Y(u))return[new i.V(y.key,y.value,'"feature-state" data expressions are not supported with layout properties.')];if(y.expressionContext==="filter")return hr(u,y);if(y.expressionContext&&y.expressionContext.indexOf("cluster")===0){if(!i.Z(u,["zoom","feature-state"]))return[new i.V(y.key,y.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(y.expressionContext==="cluster-initial"&&!i._(u))return[new i.V(y.key,y.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function hr(y,o){const u=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(const w of o.valueSpec.expression.parameters)u.delete(w);if(u.size===0)return[];const _=[];return y instanceof i.$&&u.has(y.name)?[new i.V(o.key,o.value,`["${y.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(y.eachChild(w=>{_.push(...hr(w,o))}),_)}function ur(y){const o=y.key,u=y.value,_=y.valueSpec,w=[];return Array.isArray(_.values)?_.values.indexOf(i.M(u))===-1&&w.push(new i.V(o,u,`expected one of [${_.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(_.values).indexOf(i.M(u))===-1&&w.push(new i.V(o,u,`expected one of [${Object.keys(_.values).join(", ")}], ${JSON.stringify(u)} found`)),w}function Ir(y){return i.a1(i.U(y.value))?ar(i.L({},y,{expressionContext:"filter",valueSpec:y.styleSpec[`filter_${y.layerType||"fill"}`]})):Un(y)}function Un(y){const o=y.value,u=y.key;if(i.K(o)!=="array")return[new i.V(u,o,`array expected, ${i.K(o)} found`)];const _=y.styleSpec;let w,T=[];if(o.length<1)return[new i.V(u,o,"filter array must have at least 1 element")];switch(T=T.concat(ur({key:`${u}[0]`,value:o[0],valueSpec:_.filter_operator,style:y.style,styleSpec:y.styleSpec})),i.M(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&i.M(o[1])==="$type"&&T.push(new i.V(u,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":o.length!==3&&T.push(new i.V(u,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(w=i.K(o[1]),w!=="string"&&T.push(new i.V(`${u}[1]`,o[1],`string expected, ${w} found`)));for(let C=2;C<o.length;C++)w=i.K(o[C]),i.M(o[1])==="$type"?T=T.concat(ur({key:`${u}[${C}]`,value:o[C],valueSpec:_.geometry_type,style:y.style,styleSpec:y.styleSpec})):w!=="string"&&w!=="number"&&w!=="boolean"&&T.push(new i.V(`${u}[${C}]`,o[C],`string, number, or boolean expected, ${w} found`));break;case"any":case"all":case"none":for(let C=1;C<o.length;C++)T=T.concat(Un({key:`${u}[${C}]`,value:o[C],style:y.style,styleSpec:y.styleSpec}));break;case"has":case"!has":w=i.K(o[1]),o.length!==2?T.push(new i.V(u,o,`filter array for "${o[0]}" operator must have 2 elements`)):w!=="string"&&T.push(new i.V(`${u}[1]`,o[1],`string expected, ${w} found`))}return T}function Vr(y,o){const u=y.key,_=y.style,w=y.layer,T=y.styleSpec,C=y.value,z=y.objectKey,V=T[`${o}_${y.layerType}`];if(!V)return[];const $=z.match(/^(.*)-use-theme$/);if(o==="paint"&&$&&V[$[1]])return i.S(C)?[].concat(Pr({key:y.key,value:C,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:_,styleSpec:T,expressionContext:"property",propertyType:o,propertyKey:z})):Pr({key:u,value:C,valueSpec:{type:"string"},style:_,styleSpec:T});const K=z.match(/^(.*)-transition$/);if(o==="paint"&&K&&V[K[1]]&&V[K[1]].transition)return Pr({key:u,value:C,valueSpec:T.transition,style:_,styleSpec:T});const ee=y.valueSpec||V[z];if(!ee)return[new i.J(u,C,`unknown property "${z}"`)];let te;if(i.K(C)==="string"&&i.O(ee)&&!ee.tokens&&(te=/^{([^}]+)}$/.exec(C))){const Te=`\`{ "type": "identity", "property": ${te?JSON.stringify(te[1]):'"_"'} }\``;return[new i.V(u,C,`"${z}" does not support interpolation syntax
Use an identity property function instead: ${Te}.`)]}const ce=[];if(y.layerType==="symbol")z!=="text-field"||!_||_.glyphs||_.imports||ce.push(new i.V(u,C,'use of "text-field" requires a style "glyphs" property')),z==="text-font"&&i.a2(i.U(C))&&i.M(C.type)==="identity"&&ce.push(new i.V(u,C,'"text-font" does not support identity functions'));else if(y.layerType==="model"&&o==="paint"&&w&&w.layout&&w.layout.hasOwnProperty("model-id")&&i.O(ee)&&(i.a3(ee)||i.Q(ee))){const Te=i.W(i.U(C),ee),ve=Te.value.expression||Te.value._styleExpression.expression;ve&&!i.Z(ve,["measure-light"])&&(z==="model-emissive-strength"&&i._(ve)&&i.Y(ve)||ce.push(new i.V(u,C,`${z} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return ce.concat(Pr({key:y.key,value:C,valueSpec:ee,style:_,styleSpec:T,expressionContext:"property",propertyType:o,propertyKey:z}))}function pi(y){return Vr(y,"paint")}function Li(y){return Vr(y,"layout")}function wi(y){let o=[];const u=y.value,_=y.key,w=y.style,T=y.styleSpec;u.type||u.ref||o.push(new i.V(_,u,'either "type" or "ref" is required'));let C=i.M(u.type);const z=i.M(u.ref);if(u.id){const V=i.M(u.id);for(let $=0;$<y.arrayIndex;$++){const K=w.layers[$];i.M(K.id)===V&&o.push(new i.V(_,u.id,`duplicate layer id "${u.id}", previously used at line ${K.id.__line__}`))}}if("ref"in u){let V;["type","source","source-layer","filter","layout"].forEach($=>{$ in u&&o.push(new i.V(_,u[$],`"${$}" is prohibited for ref layers`))}),w.layers.forEach($=>{i.M($.id)===z&&(V=$)}),V?V.ref?o.push(new i.V(_,u.ref,"ref cannot reference another ref layer")):C=i.M(V.type):typeof z=="string"&&o.push(new i.V(_,u.ref,`ref layer "${z}" not found`))}else if(C!=="background"&&C!=="sky"&&C!=="slot")if(u.source){const V=w.sources&&w.sources[u.source],$=V&&i.M(V.type);V?$==="vector"&&C==="raster"?o.push(new i.V(_,u.source,`layer "${u.id}" requires a raster source`)):$==="raster"&&C!=="raster"?o.push(new i.V(_,u.source,`layer "${u.id}" requires a vector source`)):$!=="vector"||u["source-layer"]?$==="raster-dem"&&C!=="hillshade"?o.push(new i.V(_,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):$!=="raster-array"||["raster","raster-particle"].includes(C)?C!=="line"||!u.paint||!u.paint["line-gradient"]&&!u.paint["line-trim-offset"]||$==="geojson"&&V.lineMetrics?C==="raster-particle"&&$!=="raster-array"&&o.push(new i.V(_,u.source,`layer "${u.id}" requires a 'raster-array' source.`)):o.push(new i.V(_,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new i.V(_,u.source,"raster-array source can only be used with layer type 'raster'.")):o.push(new i.V(_,u,`layer "${u.id}" must specify a "source-layer"`)):o.push(new i.V(_,u.source,`source "${u.source}" not found`))}else o.push(new i.V(_,u,'missing required property "source"'));return o=o.concat(At({key:_,value:u,valueSpec:T.layer,style:y.style,styleSpec:y.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Pr({key:`${_}.type`,value:u.type,valueSpec:T.layer.type,style:y.style,styleSpec:y.styleSpec,object:u,objectKey:"type"}),filter:V=>Ir(i.L({layerType:C},V)),layout:V=>At({layer:u,key:V.key,value:V.value,valueSpec:{},style:V.style,styleSpec:V.styleSpec,objectElementValidators:{"*":$=>Li(i.L({layerType:C},$))}}),paint:V=>At({layer:u,key:V.key,value:V.value,valueSpec:{},style:V.style,styleSpec:V.styleSpec,objectElementValidators:{"*":$=>pi(i.L({layerType:C,layer:u},$))}})}})),o}function xn(y){const o=y.value,u=y.key,_=i.K(o);return _!=="string"?[new i.V(u,o,`string expected, ${_} found`)]:[]}const Xn={promoteId:function y({key:o,value:u}){if(i.K(u)==="string")return xn({key:o,value:u});if(Array.isArray(u)){const _=[],w=i.U(u),T=i.X(w);return T.result==="error"&&T.value.forEach(C=>{_.push(new i.V(`${o}${C.key}`,null,`${C.message}`))}),i.Z(T.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||_.push(new i.V(`${o}`,null,"promoteId expression should be only feature dependent")),_}{const _=[];for(const w in u)_.push(...y({key:`${o}.${w}`,value:u[w]}));return _}}};function hn(y){const o=y.value,u=y.key,_=y.styleSpec,w=y.style;if(!o.type)return[new i.V(u,o,'"type" is required')];const T=i.M(o.type);let C=[];switch(["vector","raster","raster-dem","raster-array"].includes(T)&&(o.url||o.tiles||C.push(new i.J(u,o,'Either "url" or "tiles" is required.'))),T){case"vector":case"raster":case"raster-dem":case"raster-array":return C=C.concat(At({key:u,value:o,valueSpec:_[`source_${T.replace("-","_")}`],style:y.style,styleSpec:_,objectElementValidators:Xn})),C;case"geojson":if(C=At({key:u,value:o,valueSpec:_.source_geojson,style:w,styleSpec:_,objectElementValidators:Xn}),o.cluster)for(const z in o.clusterProperties){const[V,$]=o.clusterProperties[z],K=typeof V=="string"?[V,["accumulated"],["get",z]]:V;C.push(...ar({key:`${u}.${z}.map`,value:$,expressionContext:"cluster-map"})),C.push(...ar({key:`${u}.${z}.reduce`,value:K,expressionContext:"cluster-reduce"}))}return C;case"video":return At({key:u,value:o,valueSpec:_.source_video,style:w,styleSpec:_});case"image":return At({key:u,value:o,valueSpec:_.source_image,style:w,styleSpec:_});case"canvas":return[new i.V(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ur({key:`${u}.type`,value:o.type,valueSpec:{values:er(_)}})}}function er(y){return y.source.reduce((o,u)=>{const _=y[u];return _.type.type==="enum"&&(o=o.concat(Object.keys(_.type.values))),o},[])}function yr(y){const o=y.value,u=y.styleSpec,_=u.light,w=y.style;let T=[];const C=i.K(o);if(o===void 0)return T;if(C!=="object")return T=T.concat([new i.V("light",o,`object expected, ${C} found`)]),T;for(const z in o){const V=z.match(/^(.*)-transition$/),$=z.match(/^(.*)-use-theme$/);T=T.concat($&&_[$[1]]?Pr({key:z,value:o[z],valueSpec:{type:"string"},style:w,styleSpec:u}):V&&_[V[1]]&&_[V[1]].transition?Pr({key:z,value:o[z],valueSpec:u.transition,style:w,styleSpec:u}):_[z]?Pr({key:z,value:o[z],valueSpec:_[z],style:w,styleSpec:u}):[new i.V(z,o[z],`unknown property "${z}"`)])}return T}function Vi(y){const o=y.value;let u=[];if(!o)return u;const _=i.K(o);if(_!=="object")return u=u.concat([new i.V("light-3d",o,`object expected, ${_} found`)]),u;const w=y.styleSpec,T=w["light-3d"],C=y.key,z=y.style,V=y.style.lights;for(const ee of["type","id"])if(!(ee in o))return u=u.concat([new i.V("light-3d",o,`missing property ${ee} on light`)]),u;if(o.type&&V)for(let ee=0;ee<y.arrayIndex;ee++){const te=i.M(o.type),ce=V[ee];i.M(ce.type)===te&&u.push(new i.V(C,o.id,`duplicate light type "${o.type}", previously defined at line ${ce.id.__line__}`))}const $=`properties_light_${o.type}`;if(!($ in w))return u=u.concat([new i.V("light-3d",o,`Invalid light type ${o.type}`)]),u;const K=w[$];for(const ee in o)if(ee==="properties"){const te=o[ee],ce=i.K(te);if(ce!=="object")return u=u.concat([new i.V("properties",te,`object expected, ${ce} found`)]),u;for(const Te in te)u=u.concat(K[Te]?Pr({key:Te,value:te[Te],valueSpec:K[Te],style:z,styleSpec:w}):[new i.J(y.key,te[Te],`unknown property "${Te}"`)])}else{const te=ee.match(/^(.*)-transition$/),ce=ee.match(/^(.*)-use-theme$/);u=u.concat(ce&&T[ce[1]]?Pr({key:ee,value:o[ee],valueSpec:{type:"string"},style:z,styleSpec:w}):te&&T[te[1]]&&T[te[1]].transition?Pr({key:ee,value:o[ee],valueSpec:w.transition,style:z,styleSpec:w}):T[ee]?Pr({key:ee,value:o[ee],valueSpec:T[ee],style:z,styleSpec:w}):[new i.J(ee,o[ee],`unknown property "${ee}"`)])}return u}function ki(y){const o=y.value,u=y.key,_=y.style,w=y.styleSpec,T=w.terrain;let C=[];const z=i.K(o);if(o===void 0||z==="null")return C;if(z!=="object")return C=C.concat([new i.V("terrain",o,`object expected, ${z} found`)]),C;for(const V in o){const $=V.match(/^(.*)-transition$/),K=V.match(/^(.*)-use-theme$/);C=C.concat(K&&T[K[1]]?Pr({key:V,value:o[V],valueSpec:{type:"string"},style:_,styleSpec:w}):$&&T[$[1]]&&T[$[1]].transition?Pr({key:V,value:o[V],valueSpec:w.transition,style:_,styleSpec:w}):T[V]?Pr({key:V,value:o[V],valueSpec:T[V],style:_,styleSpec:w}):[new i.J(V,o[V],`unknown property "${V}"`)])}if(o.source){const V=_.sources&&_.sources[o.source],$=V&&i.M(V.type);V?$!=="raster-dem"&&C.push(new i.V(u,o.source,`terrain cannot be used with a source of type ${String($)}, it only be used with a "raster-dem" source type`)):C.push(new i.V(u,o.source,`source "${o.source}" not found`))}else C.push(new i.V(u,o,'terrain is missing required property "source"'));return C}function mi(y){const o=y.value,u=y.style,_=y.styleSpec,w=_.fog;let T=[];const C=i.K(o);if(o===void 0)return T;if(C!=="object")return T=T.concat([new i.V("fog",o,`object expected, ${C} found`)]),T;for(const z in o){const V=z.match(/^(.*)-transition$/),$=z.match(/^(.*)-use-theme$/);T=T.concat($&&w[$[1]]?Pr({key:z,value:o[z],valueSpec:{type:"string"},style:u,styleSpec:_}):V&&w[V[1]]&&w[V[1]].transition?Pr({key:z,value:o[z],valueSpec:_.transition,style:u,styleSpec:_}):w[z]?Pr({key:z,value:o[z],valueSpec:w[z],style:u,styleSpec:_}):[new i.J(z,o[z],`unknown property "${z}"`)])}return T}const ti={"*":()=>[],array:xr,boolean:function(y){const o=y.value,u=y.key,_=i.K(o);return _!=="boolean"?[new i.V(u,o,`boolean expected, ${_} found`)]:[]},number:Rn,color:function(y){const o=y.key,u=y.value,_=i.K(u);return _!=="string"?[new i.V(o,u,`color expected, ${_} found`)]:i.a0.parseCSSColor(u)===null?[new i.V(o,u,`color expected, "${u}" found`)]:[]},enum:ur,filter:Ir,function:Dn,layer:wi,object:At,source:hn,model:i.a4,light:yr,"light-3d":Vi,terrain:ki,fog:mi,string:xn,formatted:function(y){return xn(y).length===0?[]:ar(y)},resolvedImage:function(y){return xn(y).length===0?[]:ar(y)},projection:function(y){const o=y.value,u=y.styleSpec,_=u.projection,w=y.style;let T=[];const C=i.K(o);if(C==="object")for(const z in o)T=T.concat(Pr({key:z,value:o[z],valueSpec:_[z],style:w,styleSpec:u}));else C!=="string"&&(T=T.concat([new i.V("projection",o,`object or string expected, ${C} found`)]));return T},import:function(y){const{value:o,styleSpec:u}=y,{data:_,...w}=o;Object.defineProperty(w,"__line__",{value:o.__line__,enumerable:!1});let T=At(i.L({},y,{value:w,valueSpec:u.import}));return i.M(w.id)===""&&T.push(new i.V(`${y.key}.id`,w,"import id can't be an empty string")),_&&(T=T.concat(Fa(_,u,{key:`${y.key}.data`}))),T},iconset:function(y){const o=y.value,u=y.key,_=y.styleSpec,w=y.style;if(!o.type)return[new i.V(u,o,'"type" is required')];const T=i.M(o.type);let C=[];if(C=C.concat(At({key:u,value:o,valueSpec:_[`iconset_${T}`],style:w,styleSpec:_})),T==="source"&&o.source){const z=w.sources&&w.sources[o.source],V=z&&i.M(z.type);z?V!=="raster-array"&&C.push(new i.V(u,o.source,`iconset cannot be used with a source of type ${String(V)}, it only be used with a "raster-array" source type`)):C.push(new i.V(u,o.source,`source "${o.source}" not found`))}return C}};function Pr(y,o=!1){const u=y.value,_=y.valueSpec,w=y.styleSpec;if(_.expression&&i.a2(i.M(u)))return Dn(y);if(_.expression&&i.S(i.U(u)))return ar(y);if(_.type&&ti[_.type]){const T=ti[_.type](y);return o===!0&&T.length>0&&i.K(y.value)==="array"?ar(y):T}return At(i.L({},y,{valueSpec:_.type?w[_.type]:_}))}function ys(y){const o=y.value,u=y.key,_=xn(y);return _.length||(o.indexOf("{fontstack}")===-1&&_.push(new i.V(u,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&_.push(new i.V(u,o,'"glyphs" url must include a "{range}" token'))),_}function Fa(y,o=i.a5,u={}){return Pr({key:u.key||"",value:y,valueSpec:o.$root,styleSpec:o,style:y,objectElementValidators:{glyphs:ys,"*":()=>[]}})}function Za(y,o=i.a5){return Tt(Fa(y,o))}const Oo=y=>Tt(hn(y)),Ia=y=>Tt(yr(y)),fi=y=>Tt(Vi(y)),la=y=>Tt(ki(y)),Iu=y=>Tt(mi(y)),zs=y=>Tt(function(o){const u=o.value,_=o.style,w=o.styleSpec,T=w.snow;let C=[];const z=i.K(u);if(u===void 0)return C;if(z!=="object")return C=C.concat([new i.V("snow",u,`object expected, ${z} found`)]),C;for(const V in u){const $=V.match(/^(.*)-transition$/);C=C.concat($&&T[$[1]]&&T[$[1]].transition?Pr({key:V,value:u[V],valueSpec:w.transition,style:_,styleSpec:w}):T[V]?Pr({key:V,value:u[V],valueSpec:T[V],style:_,styleSpec:w}):[new i.J(V,u[V],`unknown property "${V}"`)])}return C}(y)),Zt=y=>Tt(function(o){const u=o.value,_=o.style,w=o.styleSpec,T=w.rain;let C=[];const z=i.K(u);if(u===void 0)return C;if(z!=="object")return C=C.concat([new i.V("rain",u,`object expected, ${z} found`)]),C;for(const V in u){const $=V.match(/^(.*)-transition$/);C=C.concat($&&T[$[1]]&&T[$[1]].transition?Pr({key:V,value:u[V],valueSpec:w.transition,style:_,styleSpec:w}):T[V]?Pr({key:V,value:u[V],valueSpec:T[V],style:_,styleSpec:w}):[new i.J(V,u[V],`unknown property "${V}"`)])}return C}(y)),Ee=y=>Tt(wi(y)),Re=y=>Tt(Ir(y)),tt=y=>Tt(pi(y)),gt=y=>Tt(Li(y)),ft=y=>Tt(i.a4(y));function Tt(y){return y.slice().sort((o,u)=>o.line&&u.line?o.line-u.line:0)}function Ft(y,o){let u=!1;if(o&&o.length)for(const _ of o)_ instanceof i.J?i.w(_.message):(y.fire(new i.z(new Error(_.message))),u=!0);return u}let Ct;class Ht extends i.E{constructor(o,u="flat"){super(),this._transitionable=new i.a6(Ct||(Ct=new i.a7({anchor:new i.a8(i.a5.light.anchor),position:new i.a9(i.a5.light.position),color:new i.a8(i.a5.light.color),intensity:new i.a8(i.a5.light.intensity)}))),this.setLight(o,u),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,u,_={}){this._validate(Ia,o,_)||(this._transitionable.setTransitionOrValue(o),this.id=u)}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,u,_){return(!_||_.validate!==!1)&&Ft(this,o.call(Za,i.l({value:u,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}}let Gt=class extends i.E{constructor(y,o,u,_){super(),this.scope=u,this._transitionable=new i.a6(new i.a7({source:new i.a8(i.a5.terrain.source),exaggeration:new i.a8(i.a5.terrain.exaggeration)}),u,_),this._transitionable.setTransitionOrValue(y,_),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=o}get(){return this._transitionable.serialize()}set(y,o){this._transitionable.setTransitionOrValue(y,o)}updateTransitions(y){this._transitioning=this._transitionable.transitioned(y,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(y){this.properties=this._transitioning.possiblyEvaluate(y)}getExaggeration(y){return this._transitioning.possiblyEvaluate(new i.aa(y)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const y=this._transitionable._values.exaggeration;if(!y)return null;const o=y.value.expression;if(!o)return null;let u=-1,_=-1,w=1;for(const T of o.zoomStops)w=o.evaluate(new i.aa(T)),w>.01?(u=T,_=-1):_=T;return w<.01&&u>0&&_>u?[u,_]:null}isZoomDependent(){const y=this._transitionable._values.exaggeration;return y!=null&&y.value!=null&&y.value.expression!=null&&y.value.expression instanceof i.ab}};const $t=45,Sn=65,Nn=.05;function qn(y,o,u,_){const w=i.ae($t,Sn,u),[T,C]=vr(y,_);let z=1-Math.min(1,Math.exp((o-T)/(C-T)*-6));return z*=z*z,z=Math.min(1,1.00747*z),z*w*y.alpha}function vr(y,o){const u=.5/Math.tan(.5*o);return[y.range[0]+u,y.range[1]+u]}function Or(y,o,u,_,w){const T=i.ad.vec3.transformMat4([],[o,u,_],w.mercatorFogMatrix);return qn(y,i.ad.vec3.length(T),w.pitch,w._fov)}function Rr(y,o,u,_,w,T,C){const z=[[u,_,0],[w,_,0],[w,T,0],[u,T,0]];let V=Number.MAX_VALUE,$=-Number.MAX_VALUE;for(const K of z){const ee=i.ad.vec3.transformMat4([],K,o),te=i.ad.vec3.length(ee);V=Math.min(V,te),$=Math.max($,te)}return[qn(y,V,C.pitch,C._fov),qn(y,$,C.pitch,C._fov)]}class qr extends i.E{constructor(o,u,_,w){super();const T=new i.a7({range:new i.a8(i.a5.fog.range),color:new i.a8(i.a5.fog.color),"color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new i.a8(i.a5.fog["high-color"]),"high-color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new i.a8(i.a5.fog["space-color"]),"space-color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new i.a8(i.a5.fog["horizon-blend"]),"star-intensity":new i.a8(i.a5.fog["star-intensity"]),"vertical-range":new i.a8(i.a5.fog["vertical-range"])});this._transitionable=new i.a6(T,_,new Map(w)),this.set(o,w),this._transitioning=this._transitionable.untransitioned(),this._transform=u,this.properties=new i.af(T),this.scope=_}get state(){const o=this._transform,u=o.projection.name==="globe",_=i.ag(o.zoom),w=this.properties.get("range"),T=[.5,3];return{range:u?[i.ah(T[0],w[0],_),i.ah(T[1],w[1],_)]:w,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,u,_={}){if(this._validate(Iu,o,_))return;const w=i.l({},o);for(const T of Object.keys(i.a5.fog))w[T]===void 0&&(w[T]=i.a5.fog[T].default);this._options=w,this._transitionable.setTransitionOrValue(this._options,u)}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;const u=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.ae($t,Sn,o))*u.a}getOpacityAtLatLng(o,u){return this._transform.projection.supportsFog?function(_,w,T){const C=i.ac.fromLngLat(w),z=T.elevation?T.elevation.getAtPointOrZero(C):0;return Or(_,C.x,C.y,z,T)}(this.state,o,u):0}getOpacityForTile(o){if(!this._transform.projection.supportsFog)return[1,1];const u=this._transform.calculateFogTileMatrix(o.toUnwrapped());return Rr(this.state,u,0,0,i.ai,i.ai,this._transform)}getOpacityForBounds(o,u,_,w,T){return this._transform.projection.supportsFog?Rr(this.state,o,u,_,w,T,this._transform):[1,1]}getFovAdjustedRange(o){return this._transform.projection.supportsFog?vr(this.state,o):[0,1]}isVisibleOnFrustum(o){if(!this._transform.projection.supportsFog)return!1;const u=[4,5,6,7];for(const _ of u){const w=o.points[_];let T;if(w[2]>=0)T=w;else{const C=o.points[_-4];T=i.aj(C,w,C[2]/(C[2]-w[2]))}if(Or(this.state,T[0],T[1],0,this._transform)>=Nn)return!0}return!1}updateConfig(o){this._transitionable.setTransitionOrValue(this._options,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,u,_){return(!_||_.validate!==!1)&&Ft(this,o.call(Za,i.l({value:u,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}}let Ri,Xi,Hr,gi,Gr=class extends i.E{constructor(y,o,u,_){super();const w=Ri||(Ri=new i.a7({density:new i.a8(i.a5.snow.density),intensity:new i.a8(i.a5.snow.intensity),color:new i.a8(i.a5.snow.color),opacity:new i.a8(i.a5.snow.opacity),vignette:new i.a8(i.a5.snow.vignette),"vignette-color":new i.a8(i.a5.snow["vignette-color"]),"center-thinning":new i.a8(i.a5.snow["center-thinning"]),direction:new i.a8(i.a5.snow.direction),"flake-size":new i.a8(i.a5.snow["flake-size"])}));this._transitionable=new i.a6(w,u,new Map(_)),this.set(y,_),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.af(w),this.scope=u}get state(){const y=this.properties.get("opacity"),o=this.properties.get("color"),u=this.properties.get("direction"),_=i.ak(u[0]),w=-Math.max(i.ak(u[1]),.01),T=[Math.cos(_)*Math.cos(w),Math.sin(_)*Math.cos(w),Math.sin(w)],C=this.properties.get("vignette"),z=this.properties.get("vignette-color");return z.a=C,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.al(o.r,o.g,o.b,o.a*y),direction:T,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:z}}get(){return this._transitionable.serialize()}set(y,o,u={}){if(this._validate(zs,y,u))return;const _=i.l({},y);for(const w of Object.keys(i.a5.snow))_[w]===void 0&&(_[w]=i.a5.snow[w].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(y){this._transitionable.setTransitionOrValue(this._options,new Map(y))}updateTransitions(y){this._transitioning=this._transitionable.transitioned(y,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(y){this.properties=this._transitioning.possiblyEvaluate(y)}_validate(y,o,u){return(!u||u.validate!==!1)&&Ft(this,y.call(Za,i.l({value:o,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}},Ni=class extends i.E{constructor(y,o,u,_){super();const w=Xi||(Xi=new i.a7({density:new i.a8(i.a5.rain.density),intensity:new i.a8(i.a5.rain.intensity),color:new i.a8(i.a5.rain.color),opacity:new i.a8(i.a5.rain.opacity),vignette:new i.a8(i.a5.rain.vignette),"vignette-color":new i.a8(i.a5.rain["vignette-color"]),"center-thinning":new i.a8(i.a5.rain["center-thinning"]),direction:new i.a8(i.a5.rain.direction),"droplet-size":new i.a8(i.a5.rain["droplet-size"]),"distortion-strength":new i.a8(i.a5.rain["distortion-strength"])}));this._transitionable=new i.a6(w,u,new Map(_)),this.set(y,_),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.af(w),this.scope=u}get state(){const y=this.properties.get("opacity"),o=this.properties.get("color"),u=this.properties.get("direction"),_=i.ak(u[0]),w=-Math.max(i.ak(u[1]),.01),T=[Math.cos(_)*Math.cos(w),Math.sin(_)*Math.cos(w),Math.sin(w)],C=this.properties.get("vignette-color");return C.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.al(o.r,o.g,o.b,o.a*y),direction:T,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:C}}get(){return this._transitionable.serialize()}set(y,o,u={}){if(this._validate(Zt,y,u))return;const _=i.l({},y);for(const w of Object.keys(i.a5.rain))_[w]===void 0&&(_[w]=i.a5.rain[w].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(y){this._transitionable.setTransitionOrValue(this._options,new Map(y))}updateTransitions(y){this._transitioning=this._transitionable.transitioned(y,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(y){this.properties=this._transitioning.possiblyEvaluate(y)}_validate(y,o,u){return(!u||u.validate!==!1)&&Ft(this,y.call(Za,i.l({value:o,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}};class Pa extends i.E{constructor(o,u,_,w){super(),this.scope=_,this._options=o,this.properties=new i.af(u),this._transitionable=new i.a6(u,_,new Map(w)),this._transitionable.setTransitionOrValue(o.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(o){this._transitionable.setTransitionOrValue(this._options.properties,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(o,u){this._options=o,this._transitionable.setTransitionOrValue(o.properties,u)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Ua{constructor(o,u,_,w){this.screenBounds=o,this.cameraPoint=u,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,w)}static createFromScreenPoints(o,u){let _,w;if(o instanceof i.P||typeof o[0]=="number"){const T=i.P.convert(o);_=[T],w=u.isPointAboveHorizon(T)}else{const T=i.P.convert(o[0]),C=i.P.convert(o[1]);_=[T,C],w=i.an(T,C).every(z=>u.isPointAboveHorizon(z))}return new Ua(_,u.getCameraPoint(),w,u)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(o){return i.an(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const u=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],w=i.an(u,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<_.x?w.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?w[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(w[3]=this.cameraPoint)),i.ao(w,o)}bufferedCameraGeometryGlobe(o){const u=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],w=i.an(u,_,o),T=this.cameraPoint.clone();switch(3*((T.y>u.y)+(T.y>_.y))+((T.x>u.x)+(T.x>_.x))){case 0:w[0]=T,w[4]=T.clone();break;case 1:w.splice(1,0,T);break;case 2:w[1]=T;break;case 3:w.splice(4,0,T);break;case 5:w.splice(2,0,T);break;case 6:w[3]=T;break;case 7:w.splice(3,0,T);break;case 8:w[2]=T}return w}containsTile(o,u,_,w=0){const T=o.queryPadding/u._pixelsPerMercatorPixel+1,C=_?this._bufferedCameraMercator(T,u):this._bufferedScreenMercator(T,u);let z=o.tileID.wrap+(C.unwrapped?w:0);const V=C.polygon.map(Ce=>i.ap(o.tileTransform,Ce,z));if(!i.aq(V,0,0,i.ai,i.ai))return;z=o.tileID.wrap+(this.screenGeometryMercator.unwrapped?w:0);const $=this.screenGeometryMercator.polygon.map(Ce=>i.ar(o.tileTransform,Ce,z)),K=$.map(Ce=>new i.P(Ce[0],Ce[1])),ee=u.getFreeCameraOptions().position||new i.ac(0,0,0),te=i.ar(o.tileTransform,ee,z),ce=$.map(Ce=>{const Pe=i.ad.vec3.sub(Ce,Ce,te);return i.ad.vec3.normalize(Pe,Pe),new i.as(te,Pe)}),Te=i.at(o,1,u.zoom)*u._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:K,tilespaceRays:ce,bufferedTilespaceGeometry:V,bufferedTilespaceBounds:(ve=i.au(V),ve.min.x=i.ay(ve.min.x,0,i.ai),ve.min.y=i.ay(ve.min.y,0,i.ai),ve.max.x=i.ay(ve.max.x,0,i.ai),ve.max.y=i.ay(ve.max.y,0,i.ai),ve),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:Te};var ve}_bufferedScreenMercator(o,u){const _=Ro(o);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let w;return w=u.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(o),u):{polygon:this.bufferedScreenGeometry(o).map(T=>u.pointCoordinate3D(T)),unwrapped:!0},this._screenRaycastCache[_]=w,w}}_bufferedCameraMercator(o,u){const _=Ro(o);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let w;return w=u.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(o),u):{polygon:this.bufferedCameraGeometry(o).map(T=>u.pointCoordinate3D(T)),unwrapped:!0},this._cameraRaycastCache[_]=w,w}}_projectAndResample(o,u){const _=function(T,C){const z=i.ad.mat4.multiply([],C.pixelMatrix,C.globeMatrix),V=[0,-i.az,0,1],$=[0,i.az,0,1],K=[0,0,0,1];i.ad.vec4.transformMat4(V,V,z),i.ad.vec4.transformMat4($,$,z),i.ad.vec4.transformMat4(K,K,z);const ee=new i.P(V[0]/V[3],V[1]/V[3]),te=new i.P($[0]/$[3],$[1]/$[3]),ce=i.aw(T,ee)&&V[3]<K[3],Te=i.aw(T,te)&&$[3]<K[3];if(!ce&&!Te)return null;const ve=function(rt,it,dt){for(let xt=1;xt<rt.length;xt++){const Xt=vs(it.pointCoordinate3D(rt[xt-1]).x),zt=vs(it.pointCoordinate3D(rt[xt]).x);if(dt<0){if(Xt<zt)return{idx:xt,t:-Xt/(zt-1-Xt)}}else if(zt<Xt)return{idx:xt,t:(1-Xt)/(zt+1-Xt)}}return null}(T,C,ce?-1:1);if(!ve)return null;const{idx:Ce,t:Pe}=ve;let qe=Ce>1?_s(T.slice(0,Ce),C):[],Je=Ce<T.length?_s(T.slice(Ce),C):[];qe=qe.map(rt=>new i.P(vs(rt.x),rt.y)),Je=Je.map(rt=>new i.P(vs(rt.x),rt.y));const Ye=[...qe];Ye.length===0&&Ye.push(Je[Je.length-1]);const lt=i.ah(Ye[Ye.length-1].y,(Je.length===0?qe[0]:Je[0]).y,Pe);let nt;return nt=ce?[new i.P(0,lt),new i.P(0,0),new i.P(1,0),new i.P(1,lt)]:[new i.P(1,lt),new i.P(1,1),new i.P(0,1),new i.P(0,lt)],Ye.push(...nt),Je.length===0?Ye.push(qe[0]):Ye.push(...Je),{polygon:Ye.map(rt=>new i.ac(rt.x,rt.y)),unwrapped:!1}}(o,u);if(_)return _;const w=function(T,C){let z=!1,V=-1/0,$=0;for(let ee=0;ee<T.length-1;ee++)T[ee].x>V&&(V=T[ee].x,$=ee);for(let ee=0;ee<T.length-1;ee++){const te=($+ee)%(T.length-1),ce=T[te],Te=T[te+1];Math.abs(ce.x-Te.x)>.5&&(ce.x<Te.x?(ce.x+=1,te===0&&(T[T.length-1].x+=1)):(Te.x+=1,te+1===T.length-1&&(T[0].x+=1)),z=!0)}const K=i.av(C.center.lng);return z&&K<Math.abs(K-1)&&T.forEach(ee=>{ee.x-=1}),{polygon:T,unwrapped:z}}(_s(o,u).map(T=>new i.P(vs(T.x),T.y)),u);return{polygon:w.polygon.map(T=>new i.ac(T.x,T.y)),unwrapped:w.unwrapped}}}function _s(y,o){return i.ax(y,u=>{const _=o.pointCoordinate3D(u);u.x=_.x,u.y=_.y},1/256)}function vs(y){return y<0?1+y%1:y%1}function Ro(y){return 100*y|0}function bs(y,o,u,_,w){const T=function(z,V){if(z)return w(z);if(V){if(y.url&&V.tiles&&y.tiles&&delete y.tiles,V.variants){if(!Array.isArray(V.variants))return w(new Error("variants must be an array"));for(const K of V.variants){if(K==null||typeof K!="object"||K.constructor!==Object)return w(new Error("variant must be an object"));if(!Array.isArray(K.capabilities))return w(new Error("capabilities must be an array"));if(K.capabilities.length===1&&K.capabilities[0]==="meshopt"){V=i.l(V,K);break}}}const $=i.aA(i.l({},V,y),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);$.tiles=o.canonicalizeTileset($,y.url),w(null,$)}},C=function(z,V,$){if(!z)return null;if(!V&&!$)return z;$=$||z.worldview_default;const K=Object.values(z.language||{});if(K.length===0)return null;const ee=Object.values(z.worldview||{});if(ee.length===0)return null;const te=K.every(Te=>Te===V),ce=ee.every(Te=>Te===$);return te&&ce?z:V in(z.language_options||{})||$ in(z.worldview_options||{})?null:z.language_options&&z.worldview_options?z:null}(y.data,u,_);return C?i.q.frame(()=>T(null,C)):y.url?i.n(o.transformRequest(o.normalizeSourceURL(y.url,null,u,_),i.R.Source),T):i.q.frame(()=>{const{data:z,...V}=y;T(null,V)})}class Bs{constructor(o,u,_){this.bounds=i.aB.convert(this.validateBounds(o)),this.minzoom=u||0,this.maxzoom=_||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const u=Math.pow(2,o.z),_=Math.floor(i.av(this.bounds.getWest())*u),w=Math.floor(i.aC(this.bounds.getNorth())*u),T=Math.ceil(i.av(this.bounds.getEast())*u),C=Math.ceil(i.aC(this.bounds.getSouth())*u);return o.x>=_&&o.x<T&&o.y>=w&&o.y<C}}class iu extends i.E{constructor(o,u,_,w){if(super(),this.id=o,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,i.l(this,i.aA(u,["url","scheme","tileSize","promoteId"])),this._options=i.l({type:"vector"},u),this._collectResourceTiming=!!u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w),this._tileWorkers={},this._deduped=new i.aD}load(o){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"}));const u=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map.getWorldview();this._tileJSONRequest=bs(this._options,this.map._requestManager,u,_,(w,T)=>{if(this._tileJSONRequest=null,this._loaded=!0,w)u&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${u}`),_&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new i.z(w));else if(T){if(i.l(this,T),this.hasWorldviews=!!T.worldview_options,T.worldview_default&&(this.worldviewDefault=T.worldview_default),T.vector_layers){this.vectorLayers=T.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const C of T.vector_layers)this.vectorLayerIds.push(C.id),T.worldview&&T.worldview[C.source]&&this.localizableLayerIds.add(C.id)}T.bounds&&(this.tileBounds=new Bs(T.bounds,this.minzoom,this.maxzoom)),xe(T.tiles,this.map._requestManager._customAccessToken),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}o&&o(w)})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();const o=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return i.l({},this._options)}loadTile(o,u){const _=o.tileID.canonical.url(this.tiles,this.scheme),w=this.map._requestManager.normalizeTileURL(_),T=this.map._requestManager.transformRequest(w,i.R.Tile),C=this.map.style?this.map.style.getLut(this.scope):null,z=C?{image:C.image.clone()}:null,V={request:T,data:void 0,uid:o.uid,tileID:o.tileID,tileZoom:o.tileZoom,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,lut:z,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:o.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:o.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&i.f(_)&&(V.worldview=this.map.getWorldview()||this.worldviewDefault,V.localizableLayerIds=this.localizableLayerIds),V.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired")o.state==="loading"?o.reloadCallback=u:o.request=o.actor.send("reloadTile",V,$.bind(this));else if(o.actor=this._tileWorkers[w]=this._tileWorkers[w]||this.dispatcher.getActor(),this.dispatcher.ready)o.request=o.actor.send("loadTile",V,$.bind(this),void 0,!0);else{const K=i.aE.call({deduped:this._deduped},V,(ee,te)=>{ee||!te?$.call(this,ee):(V.data={cacheControl:te.cacheControl,expires:te.expires,rawData:te.rawData.slice(0)},o.actor&&o.actor.send("loadTile",V,$.bind(this),void 0,!0))},!0);o.request={cancel:K}}function $(K,ee){return delete o.request,o.aborted?u(null):K&&K.status!==404?u(K):(ee&&ee.resourceTiming&&(o.resourceTiming=ee.resourceTiming),this.map._refreshExpiredTiles&&ee&&o.setExpiryData(ee),o.loadVectorData(ee,this.map.painter),i.aF(this.dispatcher),u(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,u){o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope}),o.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Wo extends i.E{constructor(o,u,_,w){super(),this.id=o,this.dispatcher=_,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=i.l({type:"raster"},u),i.l(this,i.aA(u,["url","scheme","tileSize"]))}load(o){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"})),this._tileJSONRequest=bs(this._options,this.map._requestManager,null,null,(u,_)=>{this._tileJSONRequest=null,this._loaded=!0,u?this.fire(new i.z(u)):_&&(i.l(this,_),_.raster_layers&&(this.rasterLayers=_.raster_layers,this.rasterLayerIds=this.rasterLayers.map(w=>w.id)),_.bounds&&(this.tileBounds=new Bs(_.bounds,this.minzoom,this.maxzoom)),xe(_.tiles),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))),o&&o(u)})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();const o=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return i.l({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,u){const _=i.q.devicePixelRatio>=2,w=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);o.request=i.o(this.map._requestManager.transformRequest(w,i.R.Tile),(T,C,z,V)=>(delete o.request,o.aborted?(o.state="unloaded",u(null)):T?(o.state="errored",u(T)):C?(this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:z,expires:V}),o.setTexture(C,this.map.painter),o.state="loaded",i.aF(this.dispatcher),void u(null)):u(null)))}abortTile(o,u){o.request&&(o.request.cancel(),delete o.request),u&&u()}unloadTile(o,u){o.texture&&o.texture instanceof i.T?(o.destroy(!0),o.texture&&o.texture instanceof i.T&&this.map.painter.saveTileTexture(o.texture)):o.destroy(),u&&u()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Oa extends Wo{constructor(o,u,_,w){super(o,u,_,w),this.type="raster-array",this.maxzoom=22,this.partial=!0,this.iconsets={},this._options=i.l({type:"raster-array"},u)}triggerRepaint(o){const u=this.map.painter._terrain,_=this.map.style.getSourceCache(this.id);u&&u.enabled&&_&&u._clearRenderCacheForTile(_.id,o.tileID),this.map.triggerRepaint()}loadTile(o,u){const _=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),w=this.map._requestManager.transformRequest(_,i.R.Tile),T={request:w,uid:o.uid,tileID:o.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};o.source=this.id,o.scope=this.scope,o.requestParams=w,o.actor||(o.actor=this.dispatcher.getActor());const C=(z,V,$,K)=>{if(delete o.request,o.aborted)return o.state="unloaded",u(null);if(z)return z.name==="AbortError"?void 0:(o.state="errored",u(z));if(this.map._refreshExpiredTiles&&V&&o.setExpiryData({cacheControl:$,expires:K}),this.partial)o.state="empty";else{if(!V)return u(null);o.state="loaded",o._isHeaderLoaded=!0,o._mrt=V;const ee=new Map;for(const te in o._mrt.layers){const ce=o.getLayer(te);if(ce)for(const Te of ce.getBandList()){const{bytes:ve,tileSize:Ce,buffer:Pe}=ce.getBandView(Te),qe=Ce+2*Pe,Je={data:new i.r({width:qe,height:qe},ve),pixelRatio:2,sdf:!1,usvg:!1,version:0};ee.set(`${te}/${Te}`,Je)}}for(const te in this.iconsets)this.iconsets[te].addIcons(ee)}u(null)};o.request=this.partial?o.fetchHeader(void 0,C.bind(this)):o.actor.send("loadTile",T,C.bind(this),void 0,!0)}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,u){const _=o.texture;_&&_ instanceof i.T?(o.destroy(!0),this.map.painter.saveTileTexture(_)):(o.destroy(),o.flushQueues(),o._isHeaderLoaded=!1,delete o._mrt,delete o.textureDescriptor),o.fbo&&(o.fbo.destroy(),delete o.fbo),delete o.request,delete o.requestParams,delete o.neighboringTiles,o.state="unloaded"}prepareTile(o,u,_){o._isHeaderLoaded&&(o.state!=="empty"&&(o.state="reloading"),o.fetchBand(u,_,(w,T)=>{if(w)return o.state="errored",this.fire(new i.z(w)),void this.triggerRepaint(o);T&&(o._isHeaderLoaded=!0,o.setTexture(T,this.map.painter),o.state="loaded",this.triggerRepaint(o))}))}getInitialBand(o){if(!this.rasterLayers)return 0;const u=this.rasterLayers.find(({id:T})=>T===o),_=u&&u.fields,w=_&&_.bands&&_.bands;return w?w[0]:0}getTextureDescriptor(o,u,_){if(!o)return;const w=u.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!w)return;let T=null;u instanceof i.aI?T=u.paint.get("raster-array-band"):u instanceof i.aJ&&(T=u.paint.get("raster-particle-array-band"));const C=T||this.getInitialBand(w);if(C!=null)if(o.textureDescriptor){if(!o.updateNeeded(w,C)||_)return Object.assign({},o.textureDescriptor,{texture:o.texture})}else this.prepareTile(o,w,C)}addIconset(o,u){this.iconsets[o]=u,this.partial=!1}}const Fl={vector:iu,raster:Wo,"raster-dem":class extends Wo{constructor(y,o,u,_){super(y,o,u,_),this.type="raster-dem",this.maxzoom=22,this._options=i.l({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(y,o){const u=this.map._requestManager.normalizeTileURL(y.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(w,T){w&&(y.state="errored",o(w)),T&&(y.dem=T,y.dem.onDeserialize(),y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0,y.state="loaded",o(null))}y.request=i.o(this.map._requestManager.transformRequest(u,i.R.Tile),(function(w,T,C,z){if(delete y.request,y.aborted)y.state="unloaded",o(null);else if(w)y.state="errored",o(w);else if(T){this.map._refreshExpiredTiles&&y.setExpiryData({cacheControl:C,expires:z});const V=ImageBitmap&&T instanceof ImageBitmap&&i.t(),$=1-(T.width-i.aG(T.width))/2;$<1||y.neighboringTiles||(y.neighboringTiles=this._getNeighboringTiles(y.tileID));const K=V?T:i.q.getImageData(T,$),ee={uid:y.uid,tileID:y.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:K,encoding:this.encoding,padding:$};y.actor&&y.state!=="expired"||(y.actor=this.dispatcher.getActor(),y.actor.send("loadTile",ee,_.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(y){const o=y.canonical,u=Math.pow(2,o.z),_=(o.x-1+u)%u,w=o.x===0?y.wrap-1:y.wrap,T=(o.x+1+u)%u,C=o.x+1===u?y.wrap+1:y.wrap,z={};return z[new i.aH(y.overscaledZ,w,o.z,_,o.y).key]={backfilled:!1},z[new i.aH(y.overscaledZ,C,o.z,T,o.y).key]={backfilled:!1},o.y>0&&(z[new i.aH(y.overscaledZ,w,o.z,_,o.y-1).key]={backfilled:!1},z[new i.aH(y.overscaledZ,y.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},z[new i.aH(y.overscaledZ,C,o.z,T,o.y-1).key]={backfilled:!1}),o.y+1<u&&(z[new i.aH(y.overscaledZ,w,o.z,_,o.y+1).key]={backfilled:!1},z[new i.aH(y.overscaledZ,y.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},z[new i.aH(y.overscaledZ,C,o.z,T,o.y+1).key]={backfilled:!1}),z}},"raster-array":Oa,geojson:class extends i.E{constructor(y,o,u,_){super(),this.id=y,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(_),this._data=o.data,this._options=i.l({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.minzoom!==void 0&&(this.minzoom=o.minzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const w=i.ai/this.tileSize;this.workerOptions=i.l({source:this.id,scope:this.scope,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*w,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*w,extent:i.ai,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:i.ai,radius:(o.clusterRadius!==void 0?o.clusterRadius:50)*w,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter,dynamic:o.dynamic},o.workerOptions)}onAdd(y){this.map=y,this.setData(this._data)}setData(y){return this._data=y,this._updateWorkerData(),this}updateData(y){if(!this._options.dynamic)return this.fire(new i.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof y!="string"&&(y.type==="Feature"&&(y={type:"FeatureCollection",features:[y]}),y.type!=="FeatureCollection"))return this.fire(new i.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof y!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const o=new Map;for(const u of this._data.features)o.set(u.id,u);for(const u of y.features)o.set(u.id,u);this._data.features=[...o.values()]}else this._data=y;return this._updateWorkerData(!0),this}getClusterExpansionZoom(y,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:y,source:this.id,scope:this.scope},o),this}getClusterChildren(y,o){return this.actor.send("geojson.getClusterChildren",{clusterId:y,source:this.id,scope:this.scope},o),this}getClusterLeaves(y,o,u,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:y,limit:o,offset:u},_),this}_updateWorkerData(y=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.A("dataloading",{dataType:"source"})),this._loaded=!1;const o=i.l({append:y},this.workerOptions);o.scope=this.scope;const u=this._data;typeof u=="string"?(o.request=this.map._requestManager.transformRequest(i.q.resolveURL(u),i.R.Source),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(u),this._pendingLoad=this.actor.send(`${this.type}.loadData`,o,(_,w)=>{if(this._loaded=!0,this._pendingLoad=null,_)this.fire(new i.z(_));else{const T={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&w&&w.resourceTiming&&w.resourceTiming[this.id]&&(T.resourceTiming=w.resourceTiming[this.id]),y&&(this._partialReload=!0),this.fire(new i.A("data",T)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(y),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const y=i.C(this.id,this.scope);this.map.style.clearSource(y),this._updateWorkerData()}loadTile(y,o){const u=y.actor?"reloadTile":"loadTile";y.actor=this.actor;const _=this.map.style?this.map.style.getLut(this.scope):null,w=_?{image:_.image.clone()}:null,T=this._partialReload,C={type:this.type,uid:y.uid,tileID:y.tileID,tileZoom:y.tileZoom,zoom:y.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:w,scope:this.scope,pixelRatio:i.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:T};y.request=this.actor.send(u,C,(z,V)=>T&&!V?(y.state="loaded",o(null)):(delete y.request,y.destroy(),y.aborted?o(null):z?o(z):(y.loadVectorData(V,this.map.painter,u==="reloadTile"),o(null))),void 0,u==="loadTile")}abortTile(y){y.request&&(y.request.cancel(),delete y.request),y.aborted=!0}unloadTile(y,o){this.actor.send("removeTile",{uid:y.uid,type:this.type,source:this.id,scope:this.scope}),y.destroy()}onRemove(y){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return i.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.aK{constructor(y,o,u,_){super(y,o,u,_),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const y=this.options;this.urls=[];for(const o of y.urls)this.urls.push(this.map._requestManager.transformRequest(o,i.R.Source).url);i.aL(this.urls,(o,u)=>{this._loaded=!0,o?this.fire(new i.z(o)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(y){if(this.video){const o=this.video.seekable;y<o.start(0)||y>o.end(0)?this.fire(new i.z(new i.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=y}}getVideo(){return this.video}onAdd(y){this.map||(this.map=y,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const y=this.map.painter.context,o=y.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(y,this.video,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(y)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.aK,model:class extends i.E{constructor(y,o,u,_){super(),this.id=y,this.type="model",this.models=[],this._loaded=!1,this._options=o}load(){const y=[];for(const o in this._options.models){const u=this._options.models[o],_=i.aN(this.map._requestManager.transformRequest(u.uri,i.R.Model).url).then(w=>{if(!w)return;const T=i.aO(w),C=new i.aP(o,u.position,u.orientation,T);C.computeBoundsAndApplyParent(),this.models.push(C)}).catch(w=>{this.fire(new i.z(new Error(`Could not load model ${o} from ${u.uri}: ${w.message}`)))});y.push(_)}return Promise.allSettled(y).then(()=>{this._loaded=!0,this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(o=>{this.fire(new i.z(new Error(`Could not load models: ${o.message}`)))})}onAdd(y){this.map=y,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(y,o){}serialize(){return{type:"model"}}},"batched-model":class extends i.E{constructor(y,o,u,_){super(),this.type="batched-model",this.id=y,this.tileSize=512,this._options=o,this.tiles=this._options.tiles,this.maxzoom=o.maxzoom||19,this.minzoom=o.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=u,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(_)}onAdd(y){this.map=y,this.load()}reload(){this.cancelTileJSONRequest();const y=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(y))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(y){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map.getWorldview();this._tileJSONRequest=bs(this._options,this.map._requestManager,o,u,(_,w)=>{this._tileJSONRequest=null,this._loaded=!0,_?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),u&&u.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new i.z(_))):w&&(i.l(this,w),w.bounds&&(this.tileBounds=new Bs(w.bounds,this.minzoom,this.maxzoom)),xe(w.tiles,this.map._requestManager._customAccessToken),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))),y&&y(_)})}hasTransition(){return!1}hasTile(y){return!this.tileBounds||this.tileBounds.contains(y.canonical)}loaded(){return this._loaded}loadTile(y,o){const u=this.map._requestManager.normalizeTileURL(y.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(u,i.R.Tile),data:void 0,uid:y.uid,tileID:y.tileID,tileZoom:y.tileZoom,zoom:y.tileID.overscaledZ,tileSize:this.tileSize*y.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:y.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:i.q.devicePixelRatio,promoteId:this.promoteId};if(y.actor&&y.state!=="expired")if(y.state==="loading")y.reloadCallback=o;else{if(y.buckets){const T=Object.values(y.buckets);for(const C of T)C.dirty=!0;return void(y.state="loaded")}y.request=y.actor.send("reloadTile",_,w.bind(this))}else y.actor=this.dispatcher.getActor(),y.request=y.actor.send("loadTile",_,w.bind(this),void 0,!0);function w(T,C){return y.aborted?o(null):T&&T.status!==404?o(T):(this.map._refreshExpiredTiles&&C&&y.setExpiryData(C),y.loadModelData(C,this.map.painter),y.state="loaded",void o(null))}}serialize(){return i.l({},this._options)}},canvas:class extends i.aK{constructor(y,o,u,_){super(y,o,u,_),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(w=>!Array.isArray(w)||w.length!==2||w.some(T=>typeof T!="number"))||this.fire(new i.z(new i.V(`sources.${y}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.z(new i.V(`sources.${y}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new i.z(new i.V(`sources.${y}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new i.z(new i.V(`sources.${y}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.z(new i.V(`sources.${y}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(y){this.map=y,this.load(),this.canvas&&this.animate&&this.play()}onRemove(y){this.pause()}prepare(){let y=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,y=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,y=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context;this.texture?!y&&!this._playing||this.texture instanceof i.aM||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(o,this.canvas,o.gl.RGBA8,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const y of[this.canvas.width,this.canvas.height])if(isNaN(y)||y<=0)return!0;return!1}},custom:class extends i.E{constructor(y,o,u,_){super(),this.id=y,this.type="custom",this._dataType="raster",this._dispatcher=u,this._implementation=o,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Bs(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.clearTiles=this._clearTiles.bind(this),o.coveringTiles=this._coveringTiles.bind(this),i.l(this,i.aA(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.aA(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(y){this.map=y,this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(y),this.load()}onRemove(y){this._implementation.onRemove&&this._implementation.onRemove(y)}hasTile(y){if(this._implementation.hasTile){const{x:o,y:u,z:_}=y.canonical;return this._implementation.hasTile({x:o,y:u,z:_})}return!this.tileBounds||this.tileBounds.contains(y.canonical)}loadTile(y,o){const{x:u,y:_,z:w}=y.tileID.canonical,T=new AbortController;y.request=Promise.resolve(this._implementation.loadTile({x:u,y:_,z:w},{signal:T.signal})).then((function(C){return delete y.request,y.aborted?(y.state="unloaded",o(null)):C===void 0?(y.state="errored",o(null)):C===null?(this.loadTileData(y,{width:this.tileSize,height:this.tileSize,data:null}),y.state="loaded",o(null)):function(z){return z instanceof ImageData||z instanceof HTMLCanvasElement||z instanceof ImageBitmap||z instanceof HTMLImageElement}(C)?(this.loadTileData(y,C),y.state="loaded",void o(null)):(y.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(C=>{C.name!=="AbortError"&&(y.state="errored",o(C))}),y.request.cancel=()=>T.abort()}loadTileData(y,o){y.setTexture(o,this.map.painter)}unloadTile(y,o){if(y.texture&&y.texture instanceof i.T?(y.destroy(!0),y.texture&&y.texture instanceof i.T&&this.map.painter.saveTileTexture(y.texture)):y.destroy(),this._implementation.unloadTile){const{x:u,y:_,z:w}=y.tileID.canonical;this._implementation.unloadTile({x:u,y:_,z:w})}o&&o()}abortTile(y,o){y.request&&y.request.cancel&&(y.request.cancel(),delete y.request),o&&o()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(y=>({x:y.canonical.x,y:y.canonical.y,z:y.canonical.z}))}_clearTiles(){const y=i.C(this.id,this.scope);this.map.style.clearSource(y)}_update(){this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}}},Do=function(y,o,u,_){const w=new Fl[o.type](y,o,u,_);if(w.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${w.id}`);return i.aQ(["load","abort","unload","serialize","prepare"],w),w};function gh(y,o,u=""){return`${u}:${o.id||""}:${o.layer.id}:${function(_){if("layerId"in _)return`layer:${_.layerId}`;{const{featuresetId:w,importId:T}=_;return`featureset:${w}${T?`:import:${T}`:""}`}}(y.target)}`}function Pu(y,o,u,_=""){if(y.uniqueFeatureID){const w=gh(y,o,_);if(u.has(w))return!0;u.add(w)}return!1}function Jh(y,o,u,_,w=!1){const T=o.sourceCache.transform,C=o.sourceCache.tilesIn(y,o.has3DLayers,w);C.sort(cl);const z=[];for(const V of C){const $=V.tile.queryRenderedFeatures(o,V,u,_,T,w);Object.keys($).length&&z.push({wrappedTileID:V.tile.tileID.wrapped().key,queryResults:$})}return z.length===0?{}:function(V){const $={},K={};for(const ee of V){const te=ee.queryResults,ce=ee.wrappedTileID,Te=K[ce]=K[ce]||{};for(const ve in te){const Ce=te[ve],Pe=Te[ve]=Te[ve]||{},qe=$[ve]=$[ve]||[];for(const Je of Ce)Pe[Je.featureIndex]||(Pe[Je.featureIndex]=!0,qe.push(Je))}}return $}(z)}function lc(y,o,u,_,w){const T={},C=_.queryRenderedSymbols(y),z=[];for(const V of Object.keys(C).map(Number))z.push(w[V]);z.sort(cl);for(const V of z){const $=V.featureIndex.lookupSymbolFeatures(C[V.bucketInstanceId],V.bucketIndex,V.sourceLayerIndex,o,u);for(const K in $){const ee=T[K]=T[K]||[],te=$[K];te.sort((ce,Te)=>{const ve=V.featureSortOrder;if(ve){const Ce=ve.indexOf(ce.featureIndex);return ve.indexOf(Te.featureIndex)-Ce}return Te.featureIndex-ce.featureIndex});for(const ce of te)ee.push(ce)}}return T}function Ou(y,o){const u=y.getRenderableIds().map(T=>y.getTileByID(T)),_=[],w={};for(let T=0;T<u.length;T++){const C=u[T],z=C.tileID.canonical.key;w[z]||(w[z]=!0,C.querySourceFeatures(_,o))}return _}function cl(y,o){const u=y.tileID,_=o.tileID;return u.overscaledZ-_.overscaledZ||u.canonical.y-_.canonical.y||u.wrap-_.wrap||u.canonical.x-_.canonical.x}function Ys(y,o){const u={};if(!o)return u;for(const _ of y){const w=_.layerIds.map(T=>o.getLayer(T)).filter(Boolean);if(w.length!==0){_.layers=w,_.stateDependentLayerIds&&(_.stateDependentLayers=_.stateDependentLayerIds.map(T=>w.filter(C=>C.id===T)[0]));for(const T of w)u[T.fqid]=_}}return u}const Lo=32,Ul=33,cc=new Uint16Array(8184);for(let y=0;y<2046;y++){let o=y+2,u=0,_=0,w=0,T=0,C=0,z=0;for(1&o?w=T=C=Lo:u=_=z=Lo;(o>>=1)>1;){const $=u+w>>1,K=_+T>>1;1&o?(w=u,T=_,u=C,_=z):(u=w,_=T,w=C,T=z),C=$,z=K}const V=4*y;cc[V+0]=u,cc[V+1]=_,cc[V+2]=w,cc[V+3]=T}const so=new Uint16Array(2178),ko=new Uint8Array(1089),yh=new Uint16Array(1089);function Bc(y){return y===0?-.03125:y===32?.03125:0}const ud={type:2,extent:i.ai,loadGeometry:()=>[[new i.P(0,0),new i.P(i.ai+1,0),new i.P(i.ai+1,i.ai+1),new i.P(0,i.ai+1),new i.P(0,0)]]};class ql{constructor(o,u,_,w,T){this.tileID=o,this.uid=i.aW(),this.uses=0,this.tileSize=u,this.tileZoom=_,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=T,w&&w.style&&(this._lastUpdatedBrightness=w.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",w&&w.transform&&(this.projection=w.transform.projection)}registerFadeDuration(o){const u=o+this.timeAdded;u<i.q.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=i.aR(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,u,_){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=Ys(o.buckets,u.style),this.hasSymbolBuckets=!1;for(const w in this.buckets){const T=this.buckets[w];if(T instanceof i.aY){if(this.hasSymbolBuckets=!0,!_)break;T.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const w in this.buckets){const T=this.buckets[w];if(T instanceof i.aY&&T.hasRTLText){this.hasRTLText=!0,i.aZ();break}}this.queryPadding=0;for(const w in this.buckets){const T=this.buckets[w],C=u.style.getOwnLayer(w);if(!C)continue;const z=C.queryRadius(T);this.queryPadding=Math.max(this.queryPadding,z)}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas),this._lastUpdatedBrightness=o.brightness}else this.collisionBoxArray=new i.aX}unloadVectorData(){if(this.hasData()){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(o,u,_){o&&(o.resourceTiming&&(this.resourceTiming=o.resourceTiming),this.buckets=Object.assign({},this.buckets,Ys(o.buckets,u.style)),o.featureIndex&&(this.latestFeatureIndex=o.featureIndex))}getBucket(o){return this.buckets[o.fqid]}upload(o){for(const w in this.buckets){const T=this.buckets[w];T.uploadPending()&&T.upload(o)}const u=o.gl,_=this.imageAtlas;_&&!_.uploaded&&(this.imageAtlasTexture=new i.T(o,_.image,u.RGBA8,{useMipmap:!!_.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new i.T(o,this.glyphAtlasImage,u.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new i.T(o,this.lineAtlas.image,u.R8),this.lineAtlas.uploaded=!0)}prepare(o,u,_){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture,_),!u||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const w=u.style.getBrightness();(this._lastUpdatedBrightness||w)&&(this._lastUpdatedBrightness&&w&&Math.abs(this._lastUpdatedBrightness-w)<.001||(this.updateBuckets(u,this._lastUpdatedBrightness!==w),this._lastUpdatedBrightness=w))}queryRenderedFeatures(o,u,_,w,T,C){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const z=function(V,$){const K=i.ad.mat4.fromScaling([],[.5*V.width,.5*-V.height,1]);return i.ad.mat4.translate(K,K,[1,-1,0]),i.ad.mat4.multiply(K,K,V.calculateProjMatrix($.toUnwrapped())),Float32Array.from(K)}(T,this.tileID);return this.latestFeatureIndex.query(o,{tilespaceGeometry:u,pixelPosMatrix:z,transform:w,availableImages:_,tileTransform:this.tileTransform})}querySourceFeatures(o,u){const _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;const w=_.loadVTLayers(),T=u?u.sourceLayer:"",C=w._geojsonTileLayer||w[T];if(!C)return;const z=i.a_(u&&u.filter),{z:V,x:$,y:K}=this.tileID.canonical,ee={z:V,x:$,y:K};for(let te=0;te<C.length;te++){const ce=C.feature(te);if(z.needGeometry){const Ce=i.a$(ce,!0);if(!z.filter(new i.aa(this.tileID.overscaledZ),Ce,this.tileID.canonical))continue}else if(!z.filter(new i.aa(this.tileID.overscaledZ),ce))continue;const Te=_.getId(ce,T),ve=new i.b0(ce,V,$,K,Te);ve.tile=ee,o.push(ve)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(o){const u=this.expirationTime;if(o.cacheControl){const _=i.b1(o.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const _=Date.now();let w=!1;if(this.expirationTime>_)w=!1;else if(u)if(this.expirationTime<u)w=!0;else{const T=this.expirationTime-u;T?this.expirationTime=_+Math.max(T,3e4):w=!0}else w=!0;w?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(o){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&o&&this.updateBuckets(o)}updateBuckets(o,u){if(!this.latestFeatureIndex||!o.style)return;const _=this.latestFeatureIndex.loadVTLayers(),w=o.style.listImages(),T=o.style.getBrightness();for(const C in this.buckets){if(!o.style.hasLayer(C))continue;const z=this.buckets[C],V=z.layers[0],$=V.sourceLayer||"_geojsonTileLayer",K=_[$],ee=o.style.getLayerSourceCache(V);let te={};ee&&(te=ee._state.getState($,void 0));const ce=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},Te=Object.keys(te).length>0&&!u;Te&&!z.stateDependentLayers.length&&!u||z.update(te,K,w,ce,Te?z.stateDependentLayers:z.layers,u,T),(z instanceof i.b2||z instanceof i.b3)&&o._terrain&&o._terrain.enabled&&ee&&z.uploadPending()&&o._terrain._clearRenderCacheForTile(ee.id,this.tileID);const ve=o&&o.style&&o.style.getOwnLayer(C);ve&&(this.queryPadding=Math.max(this.queryPadding,ve.queryRadius(z)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=i.q.now()+o}setTexture(o,u){const _=u.context,w=_.gl;this.texture=this.texture||u.getTileTexture(o.width),this.texture&&this.texture instanceof i.T?this.texture.update(o):(this.texture=new i.T(_,o,w.RGBA8,{useMipmap:!0}),this.texture.bind(w.LINEAR,w.CLAMP_TO_EDGE))}setDependencies(o,u){const _={};for(const w of u)_[w]=!0;this.dependencies[o]=_}hasDependency(o,u){for(const _ of o){const w=this.dependencies[_];if(w){for(const T of u)if(w[T])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,u){if(!u||u.name==="mercator"||this._tileDebugBuffer)return;const _=i.b4(ud,this.tileID.canonical,this.tileTransform)[0],w=new i.b5,T=new i.b6;for(let C=0;C<_.length;C++){const{x:z,y:V}=_[C];w.emplaceBack(z,V),T.emplaceBack(C)}T.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(T),this._tileDebugBuffer=o.createVertexBuffer(w,i.b7.members),this._tileDebugSegments=i.b8.simpleSegment(0,0,w.length,T.length)}_makeTileBoundsBuffers(o,u){if(this._tileBoundsBuffer||!u||u.name==="mercator")return;const _=i.b4(ud,this.tileID.canonical,this.tileTransform)[0];let w,T;if(this.isRaster){const C=function(z,V){const $=i.aR(z,V),K=Math.pow(2,z.z);for(let Ce=0;Ce<Ul;Ce++)for(let Pe=0;Pe<Ul;Pe++){const qe=i.aS((z.x+(Pe+Bc(Pe))/Lo)/K),Je=i.aT((z.y+(Ce+Bc(Ce))/Lo)/K),Ye=V.project(qe,Je),lt=Ce*Ul+Pe;so[2*lt+0]=Math.round((Ye.x*$.scale-$.x)*i.ai),so[2*lt+1]=Math.round((Ye.y*$.scale-$.y)*i.ai)}ko.fill(0),yh.fill(0);for(let Ce=2045;Ce>=0;Ce--){const Pe=4*Ce,qe=cc[Pe+0],Je=cc[Pe+1],Ye=cc[Pe+2],lt=cc[Pe+3],nt=qe+Ye>>1,rt=Je+lt>>1,it=nt+rt-Je,dt=rt+qe-nt,xt=Je*Ul+qe,Xt=lt*Ul+Ye,zt=rt*Ul+nt,tn=Math.hypot((so[2*xt+0]+so[2*Xt+0])/2-so[2*zt+0],(so[2*xt+1]+so[2*Xt+1])/2-so[2*zt+1])>=16;ko[zt]=ko[zt]||(tn?1:0),Ce<1022&&(ko[zt]=ko[zt]||ko[(Je+dt>>1)*Ul+(qe+it>>1)]||ko[(lt+dt>>1)*Ul+(Ye+it>>1)])}const ee=new i.aU,te=new i.aV;let ce=0;function Te(Ce,Pe){const qe=Pe*Ul+Ce;return yh[qe]===0&&(ee.emplaceBack(so[2*qe+0],so[2*qe+1],Ce*i.ai/Lo,Pe*i.ai/Lo),yh[qe]=++ce),yh[qe]-1}function ve(Ce,Pe,qe,Je,Ye,lt){const nt=Ce+qe>>1,rt=Pe+Je>>1;if(Math.abs(Ce-Ye)+Math.abs(Pe-lt)>1&&ko[rt*Ul+nt])ve(Ye,lt,Ce,Pe,nt,rt),ve(qe,Je,Ye,lt,nt,rt);else{const it=Te(Ce,Pe),dt=Te(qe,Je),xt=Te(Ye,lt);te.emplaceBack(it,dt,xt)}}return ve(0,0,Lo,Lo,Lo,0),ve(Lo,Lo,0,0,0,Lo),{vertices:ee,indices:te}}(this.tileID.canonical,u);w=C.vertices,T=C.indices}else{w=new i.aU,T=new i.aV;for(const{x:z,y:V}of _)w.emplaceBack(z,V,0,0);const C=i.b9(w.int16,void 0,4);for(let z=0;z<C.length;z+=3)T.emplaceBack(C[z],C[z+1],C[z+2])}this._tileBoundsBuffer=o.createVertexBuffer(w,i.ba.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(T),this._tileBoundsSegments=i.b8.simpleSegment(0,0,w.length,T.length)}_makeGlobeTileDebugBuffers(o,u){const _=u.projection;if(!_||_.name!=="globe"||u.freezeTileCoverage)return;const w=this.tileID.canonical,T=i.bb(w,u),C=i.bc(T),z=i.ag(u.zoom);let V;z>0&&(V=i.ad.mat4.invert(new Float64Array(16),u.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,w,u,C,V,z),this._makeGlobeTileDebugTextBuffer(o,w,u,C,V,z)}_globePoint(o,u,_,w,T,C,z){let V=i.bd(o,u,_);if(C){const $=1<<_.z,K=i.av(w.center.lng),ee=i.aC(w.center.lat),te=(_.x+.5)/$-K;let ce=0;te>.5?ce=-1:te<-.5&&(ce=1);let Te=(o/i.ai+_.x)/$+ce,ve=(u/i.ai+_.y)/$;Te=(Te-K)*w._pixelsPerMercatorPixel+K,ve=(ve-ee)*w._pixelsPerMercatorPixel+ee;const Ce=[Te*w.worldSize,ve*w.worldSize,0];i.ad.vec3.transformMat4(Ce,Ce,C),V=i.be(V,Ce,z)}return i.ad.vec3.transformMat4(V,V,T)}_makeGlobeTileDebugBorderBuffer(o,u,_,w,T,C){const z=new i.b5,V=new i.b6,$=new i.bf,K=(te,ce,Te,ve,Ce)=>{const Pe=(Te-te)/(Ce-1),qe=(ve-ce)/(Ce-1),Je=z.length;for(let Ye=0;Ye<Ce;Ye++){const lt=te+Ye*Pe,nt=ce+Ye*qe;z.emplaceBack(lt,nt);const rt=this._globePoint(lt,nt,u,_,w,T,C);$.emplaceBack(rt[0],rt[1],rt[2]),V.emplaceBack(Je+Ye)}},ee=i.ai;K(0,0,ee,0,16),K(ee,0,ee,ee,16),K(ee,ee,0,ee,16),K(0,ee,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(V),this._tileDebugBuffer=o.createVertexBuffer(z,i.b7.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer($,i.bg.members),this._tileDebugSegments=i.b8.simpleSegment(0,0,z.length,V.length)}_makeGlobeTileDebugTextBuffer(o,u,_,w,T,C){const z=i.ai/4,V=new i.b5,$=new i.aV,K=new i.bf,ee=25;$.reserve(32),V.reserve(ee),K.reserve(ee);const te=(ce,Te)=>ee*ce+Te;for(let ce=0;ce<ee;ce++){const Te=ce*z;for(let ve=0;ve<ee;ve++){const Ce=ve*z;V.emplaceBack(Ce,Te);const Pe=this._globePoint(Ce,Te,u,_,w,T,C);K.emplaceBack(Pe[0],Pe[1],Pe[2])}}for(let ce=0;ce<4;ce++)for(let Te=0;Te<4;Te++){const ve=te(ce,Te),Ce=te(ce,Te+1),Pe=te(ce+1,Te),qe=te(ce+1,Te+1);$.emplaceBack(ve,Ce,Pe),$.emplaceBack(Pe,Ce,qe)}this._tileDebugTextIndexBuffer=o.createIndexBuffer($),this._tileDebugTextBuffer=o.createVertexBuffer(V,i.b7.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(K,i.bg.members),this._tileDebugTextSegments=i.b8.simpleSegment(0,0,ee,32)}destroy(o=!1){for(const u in this.buckets)this.buckets[u].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!o&&this.texture&&this.texture instanceof i.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}i.bh.setPbf(i.bi);class No extends ql{constructor(o,u,_,w,T){super(o,u,_,w,T),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(o){return this._mrt&&this._mrt.getLayer(o)}setTexture(o,u){const _=u.context,w=_.gl;this.texture=this.texture||u.getTileTexture(o.width),this.texture&&this.texture instanceof i.T?this.texture.update(o,{premultiply:!1}):this.texture=new i.T(_,o,w.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(o=16384,u){const _=this._mrt=new i.bh(30),w=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(o-1)}});return this.entireBuffer=null,this.request=i.bj(w,(T,C,z,V)=>{if(T)u(T);else try{const $=_.getHeaderLength(C);if($>o)return void(this.request=this.fetchHeader($,u));_.parseHeader(C),this._isHeaderLoaded=!0;let K=0;for(const ee of Object.values(_.layers))K=Math.max(K,ee.dataIndex[ee.dataIndex.length-1].lastByte);C.byteLength>=K&&(this.entireBuffer=C),u(null,this.entireBuffer||C,z,V)}catch($){u($)}}),this.request}fetchBand(o,u,_){const w=this._mrt;if(!this._isHeaderLoaded||!w)return void _(new Error("Tile header is not ready"));const T=this.actor;if(!T)return void _(new Error("Can't fetch tile band without an actor"));let C;const z=(ee,te)=>{C.complete(ee,te),ee?_(ee):(this.updateTextureDescriptor(o,u),_(null,this.textureDescriptor&&this.textureDescriptor.img))},V=(ee,te)=>{if(ee)return _(ee);const ce=T.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:te,task:C},z,void 0,!0);this._workQueue.push(()=>{ce&&ce.cancel(),C.cancel()})},$=w.getLayer(o);if(!$)return void _(new Error(`Unknown sourceLayer "${o}"`));if($.hasDataForBand(u))return this.updateTextureDescriptor(o,u),void _(null,this.textureDescriptor?this.textureDescriptor.img:null);const K=$.getDataRange([u]);if(C=w.createDecodingTask(K),!C||C.tasks.length)if(this.flushQueues(),this.entireBuffer)V(null,this.entireBuffer.slice(K.firstByte,K.lastByte+1));else{const ee=Object.assign({},this.requestParams,{headers:{Range:`bytes=${K.firstByte}-${K.lastByte}`}}),te=i.bj(ee,V);this._fetchQueue.push(()=>{te.cancel(),C.cancel()})}else _(null)}updateNeeded(o,u){return(!this.textureDescriptor||this.textureDescriptor.band!==u||this.textureDescriptor.layer!==o)&&this.state!=="errored"}updateTextureDescriptor(o,u){if(!this._mrt)return;const _=this._mrt.getLayer(o);if(!_||!_.hasBand(u)||!_.hasDataForBand(u))return;const{bytes:w,tileSize:T,buffer:C,offset:z,scale:V}=_.getBandView(u),$=T+2*C,K=new i.r({width:$,height:$},w),ee=this.texture;ee&&ee instanceof i.T&&ee.update(K,{premultiply:!1}),this.textureDescriptor={layer:o,band:u,img:K,buffer:C,offset:z,tileSize:T,format:_.pixelFormat,mix:[V,256*V,65536*V,16777216*V]}}}class jc{constructor(o,u){this.max=o,this.onRemove=u,this.reset()}reset(){for(const o in this.data)for(const u of this.data[o])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(o,u,_){const w=o.wrapped().key;this.data[w]===void 0&&(this.data[w]=[]);const T={value:u,timeout:void 0};if(_!==void 0&&(T.timeout=setTimeout(()=>{this.remove(o,T)},_)),this.data[w].push(T),this.order.push(w),this.order.length>this.max){const C=this._getAndRemoveByKey(this.order[0]);C&&this.onRemove(C)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const u=this.data[o].shift();return u.timeout&&clearTimeout(u.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),u.value}getByKey(o){const u=this.data[o];return u?u[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,u){if(!this.has(o))return this;const _=o.wrapped().key,w=u===void 0?0:this.data[_].indexOf(u),T=this.data[_][w];return this.data[_].splice(w,1),T.timeout&&clearTimeout(T.timeout),this.data[_].length===0&&delete this.data[_],this.onRemove(T.value),this.order.splice(this.order.indexOf(_),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(o){const u=[];for(const _ in this.data)for(const w of this.data[_])o(w.value)||u.push(w);for(const _ of u)this.remove(_.value.tileID,_)}}class Qh{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,u,_){const w=String(u);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][w]=this.stateChanges[o][w]||{},i.l(this.stateChanges[o][w],_),this.deletedStates[o]===null){this.deletedStates[o]={};for(const T in this.state[o])T!==w&&(this.deletedStates[o][T]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][w]===null){this.deletedStates[o][w]={};for(const T in this.state[o][w])_[T]||(this.deletedStates[o][w][T]=null)}else for(const T in _)this.deletedStates[o]&&this.deletedStates[o][w]&&this.deletedStates[o][w][T]===null&&delete this.deletedStates[o][w][T]}removeFeatureState(o,u,_){if(this.deletedStates[o]===null)return;const w=String(u);if(this.deletedStates[o]=this.deletedStates[o]||{},_&&u!==void 0)this.deletedStates[o][w]!==null&&(this.deletedStates[o][w]=this.deletedStates[o][w]||{},this.deletedStates[o][w][_]=null);else if(u!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][w])for(_ in this.deletedStates[o][w]={},this.stateChanges[o][w])this.deletedStates[o][w][_]=null;else this.deletedStates[o][w]=null;else this.deletedStates[o]=null}getState(o,u){const _=this.state[o]||{},w=this.stateChanges[o]||{},T=this.deletedStates[o];if(T===null)return{};if(u!==void 0){const z=String(u),V=i.l({},_[z],w[z]);if(T){const $=T[u];if($===null)return{};for(const K in $)delete V[K]}return V}const C=i.l({},_,w);if(T)for(const z in T)delete C[z];return C}initializeTileState(o,u){o.refreshFeatureState(u)}coalesceChanges(o,u){const _={};for(const w in this.stateChanges){this.state[w]=this.state[w]||{};const T={};for(const C in this.stateChanges[w])this.state[w][C]||(this.state[w][C]={}),i.l(this.state[w][C],this.stateChanges[w][C]),T[C]=this.state[w][C];_[w]=T}for(const w in this.deletedStates){this.state[w]=this.state[w]||{};const T={};if(this.deletedStates[w]===null)for(const C in this.state[w])T[C]={},this.state[w][C]={};else for(const C in this.deletedStates[w]){if(this.deletedStates[w][C]===null)this.state[w][C]={};else if(this.state[w][C])for(const z of Object.keys(this.deletedStates[w][C]))delete this.state[w][C][z];T[C]=this.state[w][C]}_[w]=_[w]||{},i.l(_[w],T)}if(this.stateChanges={},this.deletedStates={},Object.keys(_).length!==0)for(const w in o)o[w].refreshFeatureState(u)}}class Ko extends i.E{constructor(o,u,_){super(),this.id=o,this._onlySymbols=_,u.on("data",w=>{w.dataType==="source"&&w.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&w.dataType==="source"&&w.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),u.on("error",()=>{this._sourceErrored=!0}),this._source=u,this._tiles={},this._cache=new jc(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Qh,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(o){this.map=o,this._minTileCacheSize=this._minTileCacheSize===void 0&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles)if(!this._tiles[o].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,u){return o.isSymbolTile=this._onlySymbols,o.isExtraShadowCaster=this._shadowCasterTiles[o.tileID.key],this._source.loadTile(o,u)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o)}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o)}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const _=this._tiles[u];_.upload(o),_.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(Ei).map(o=>o.key)}getRenderableIds(o,u){const _=[];for(const w in this._tiles)this._isIdRenderable(+w,o,u)&&_.push(this._tiles[w]);return o?_.sort((w,T)=>{const C=w.tileID,z=T.tileID,V=new i.P(C.canonical.x,C.canonical.y)._rotate(this.transform.angle),$=new i.P(z.canonical.x,z.canonical.y)._rotate(this.transform.angle);return C.overscaledZ-z.overscaledZ||$.y-V.y||$.x-V.x}).map(w=>w.tileID.key):_.map(w=>w.tileID).sort(Ei).map(w=>w.key)}hasRenderableParent(o){const u=this.findLoadedParent(o,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(o,u,_){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(u||!this._tiles[o].holdingForFade())&&(_||!this._shadowCasterTiles[o])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(+o,"reloading")}}_reloadTile(o,u){const _=this._tiles[o];_&&(_.state!=="loading"&&(_.state=u),this._loadTile(_,this._tileLoaded.bind(this,_,o,u)))}_tileLoaded(o,u,_,w){if(w)if(o.state="errored",w.status!==404)this._source.fire(new i.z(w,{tile:o}));else{if(this._source.fire(new i.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:o})),!(o.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const T=this.map.painter.terrain;this.update(this.transform,T.getScaledDemTileSize(),!0),T.resetTileLookupCache(this.id)}else this.update(this.transform)}else o.timeAdded=i.q.now(),_==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(u,o),this._source.type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new i.A("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id}))}_backfillDEM(o){const u=this.getRenderableIds();for(let w=0;w<u.length;w++){const T=u[w];if(o.neighboringTiles&&o.neighboringTiles[T]){const C=this.getTileByID(T);_(o,C),_(C,o)}}function _(w,T){if(!w.dem||w.dem.borderReady)return;w.needsHillshadePrepare=!0,w.needsDEMTextureUpload=!0;let C=T.tileID.canonical.x-w.tileID.canonical.x;const z=T.tileID.canonical.y-w.tileID.canonical.y,V=Math.pow(2,w.tileID.canonical.z),$=T.tileID.key;C===0&&z===0||Math.abs(z)>1||(Math.abs(C)>1&&(Math.abs(C+V)===1?C+=V:Math.abs(C-V)===1&&(C-=V)),T.dem&&w.dem&&(w.dem.backfillBorder(T.dem,C,z),w.neighboringTiles&&w.neighboringTiles[$]&&(w.neighboringTiles[$].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,u,_,w){for(const T in this._tiles){let C=this._tiles[T];if(w[T]||!C.hasData()||C.tileID.overscaledZ<=u||C.tileID.overscaledZ>_)continue;let z=C.tileID;for(;C&&C.tileID.overscaledZ>u+1;){const $=C.tileID.scaledTo(C.tileID.overscaledZ-1);C=this._tiles[$.key],C&&C.hasData()&&(z=$)}let V=z;for(;V.overscaledZ>u;)if(V=V.scaledTo(V.overscaledZ-1),o[V.key]){w[z.key]=z;break}}}findLoadedParent(o,u){if(o.key in this._loadedParentTiles){const _=this._loadedParentTiles[o.key];return _&&_.tileID.overscaledZ>=u?_:null}for(let _=o.overscaledZ-1;_>=u;_--){const w=o.scaledTo(_),T=this._getLoadedTile(w);if(T)return T}}_getLoadedTile(o){const u=this._tiles[o.key];return u&&u.hasData()?u:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,u){u=u||this._source.tileSize;const _=Math.ceil(o.width/u)+1,w=Math.ceil(o.height/u)+1,T=Math.floor(_*w*5),C=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,T):T,z=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,C):C;this._cache.setMaxSize(z)}handleWrapJump(o){const u=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,u){const _={};for(const w in this._tiles){const T=this._tiles[w];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+u),_[T.tileID.key]=T}this._tiles=_;for(const w in this._timers)clearTimeout(this._timers[w]),delete this._timers[w];for(const w in this._tiles)this._setTileReloadTimer(+w,this._tiles[w])}}update(o,u,_,w){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!_)return;this.updateCacheSize(o,u),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const T=this._source.type==="batched-model";let C,z=this._source.maxzoom;const V=this.map&&this.map.painter?this.map.painter._terrain:null;if(V&&V.sourceCache===this&&V.attenuationRange()){const ee=V.attenuationRange()[0],te=Math.floor(ee)-Math.log2(V.getDemUpscale());z>te&&(z=te)}if(this.used||this.usedForTerrain){if(this._source.tileID)C=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(ee=>new i.aH(ee.canonical.z,ee.wrap,ee.canonical.z,ee.canonical.x,ee.canonical.y));else if(this.tileCoverLift!==0){const ee=o.clone();ee.tileCoverLift=this.tileCoverLift,C=ee.coveringTiles({tileSize:u||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:z,roundZoom:this._source.roundZoom&&!_,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:T}),this._source.minzoom<=1&&o.projection.name==="globe"&&(C.push(new i.aH(1,0,1,0,0)),C.push(new i.aH(1,0,1,1,0)),C.push(new i.aH(1,0,1,0,1)),C.push(new i.aH(1,0,1,1,1)))}else if(C=o.coveringTiles({tileSize:u||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:z,roundZoom:this._source.roundZoom&&!_,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:T}),this._source.hasTile){const ee=this._source.hasTile.bind(this._source);C=C.filter(te=>ee(te))}}else C=[];if(C.length>0&&this.castsShadows&&w&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!oo(this._source.type)){const ee=o.coveringZoomLevel({tileSize:u||this._source.tileSize,roundZoom:this._source.roundZoom&&!_}),te=Math.min(ee,this._source.maxzoom);if(T){const ce=o.extendTileCover(C,te);for(const Te of ce)C.push(Te)}else{const ce=o.extendTileCover(C,te,w);for(const Te of ce)this._shadowCasterTiles[Te.key]=!0,C.push(Te)}}const $=this._updateRetainedTiles(C);if(oo(this._source.type)&&C.length!==0){const ee={},te={},ce=Object.keys($);for(const ve of ce){const Ce=$[ve],Pe=this._tiles[ve];if(!Pe||Pe.fadeEndTime&&Pe.fadeEndTime<=i.q.now())continue;const qe=this.findLoadedParent(Ce,Math.max(Ce.overscaledZ-Ko.maxOverzooming,this._source.minzoom));qe&&(this._addTile(qe.tileID),ee[qe.tileID.key]=qe.tileID),te[ve]=Ce}const Te=C[C.length-1].overscaledZ;for(const ve in this._tiles){const Ce=this._tiles[ve];if($[ve]||!Ce.hasData())continue;let Pe=Ce.tileID;for(;Pe.overscaledZ>Te;){Pe=Pe.scaledTo(Pe.overscaledZ-1);const qe=this._tiles[Pe.key];if(qe&&qe.hasData()&&te[Pe.key]){$[ve]=Ce.tileID;break}}}for(const ve in ee)$[ve]||(this._coveredTiles[ve]=!0,$[ve]=ee[ve])}for(const ee in $)this._tiles[ee].clearFadeHold();const K=i.bk(this._tiles,$);for(const ee of K){const te=this._tiles[ee];te.hasSymbolBuckets&&!te.holdingForFade()?te.setHoldDuration(this.map._fadeDuration):te.hasSymbolBuckets&&!te.symbolFadeFinished()||this._removeTile(+ee)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){const u={};if(o.length===0)return u;const _={},w=o.reduce(($,K)=>Math.min($,K.overscaledZ),1/0),T=o[0].overscaledZ,C=Math.max(T-Ko.maxOverzooming,this._source.minzoom),z=Math.max(T+Ko.maxUnderzooming,this._source.minzoom),V={};for(const $ of o){const K=this._addTile($);u[$.key]=$,K.hasData()||w<this._source.maxzoom&&(V[$.key]=$)}this._retainLoadedChildren(V,w,z,u);for(const $ of o){let K=this._tiles[$.key];if(K.hasData())continue;if($.canonical.z>=this._source.maxzoom){const te=$.children(this._source.maxzoom)[0],ce=this.getTile(te);if(ce&&ce.hasData()){u[te.key]=te;continue}}else{const te=$.children(this._source.maxzoom);if(u[te[0].key]&&u[te[1].key]&&u[te[2].key]&&u[te[3].key])continue}let ee=K.wasRequested();for(let te=$.overscaledZ-1;te>=C;--te){const ce=$.scaledTo(te);if(_[ce.key]||(_[ce.key]=!0,K=this.getTile(ce),!K&&ee&&(K=this._addTile(ce)),K&&(u[ce.key]=ce,ee=K.wasRequested(),K.hasData())))break}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const u=[];let _,w=this._tiles[o].tileID;for(;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){_=this._loadedParentTiles[w.key];break}u.push(w.key);const T=w.scaledTo(w.overscaledZ-1);if(_=this._getLoadedTile(T),_)break;w=T}for(const T of u)this._loadedParentTiles[T]=_}}_addTile(o){let u=this._tiles[o.key];if(u)return u.isExtraShadowCaster!==!0||this._shadowCasterTiles[o.key]||this._reloadTile(o.key,"reloading"),u;u=this._cache.getAndRemove(o),u&&(this._setTileReloadTimer(o.key,u),u.tileID=o,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,u)));const _=!!u;if(!_){const w=this.map?this.map.painter:null,T=this._source.tileSize*o.overscaleFactor();u=this._source.type==="raster-array"?new No(o,T,this.transform.tileZoom,w,this._isRaster):new ql(o,T,this.transform.tileZoom,w,this._isRaster),this._loadTile(u,this._tileLoaded.bind(this,u,o.key,u.state))}return u?(u.uses++,this._tiles[o.key]=u,_||this._source.fire(new i.A("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u):null}_setTileReloadTimer(o,u){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const _=u.getExpiryTimeout();_&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},_))}_removeTile(o){const u=this._tiles[o];u&&(u.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),u.uses>0||(u.hasData()&&u.state!=="reloading"||u.state==="empty"?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,u,_){const w=[],T=this.transform;if(!T)return w;const C=T.projection.name==="globe",z=i.av(T.center.lng);for(const V in this._tiles){const $=this._tiles[V];if(_&&$.clearQueryDebugViz(),$.holdingForFade())continue;let K;if(C){const ee=$.tileID.canonical;if(ee.z===0){const te=[Math.abs(i.ay(z,...dr(ee,-1))-z),Math.abs(i.ay(z,...dr(ee,1))-z)];K=[0,2*te.indexOf(Math.min(...te))-1]}else{const te=[Math.abs(i.ay(z,...dr(ee,-1))-z),Math.abs(i.ay(z,...dr(ee,0))-z),Math.abs(i.ay(z,...dr(ee,1))-z)];K=[te.indexOf(Math.min(...te))-1]}}else K=[0];for(const ee of K){const te=o.containsTile($,T,u,ee);te&&w.push(te)}}return w}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(o){return this._getRenderableCoordinates(o)}_getRenderableCoordinates(o,u){const _=this.getRenderableIds(o,u).map(T=>this._tiles[T].tileID),w=this.transform.projection.name==="globe";for(const T of _)T.projMatrix=this.transform.calculateProjMatrix(T.toUnwrapped()),T.expandedProjMatrix=w?this.transform.calculateProjMatrix(T.toUnwrapped(),!1,!0):T.projMatrix;return _}sortCoordinatesByDistance(o){const u=o.slice(),_=this.transform._camera.position,w=this.transform._camera.forward(),T={};for(const C of u){const z=1/(1<<C.canonical.z);T[C.key]=((C.canonical.x+.5)*z+C.wrap-_[0])*w[0]+((C.canonical.y+.5)*z-_[1])*w[1]-_[2]*w[2]}return u.sort((C,z)=>T[C.key]-T[z.key]),u}hasTransition(){if(this._source.hasTransition())return!0;if(oo(this._source.type))for(const o in this._tiles){const u=this._tiles[o];if(u.fadeEndTime!==void 0&&u.fadeEndTime>=i.q.now())return!0}return!1}setFeatureState(o,u,_){this._state.updateState(o=o||"_geojsonTileLayer",u,_)}removeFeatureState(o,u,_){this._state.removeFeatureState(o=o||"_geojsonTileLayer",u,_)}getFeatureState(o,u){return this._state.getState(o=o||"_geojsonTileLayer",u)}setDependencies(o,u,_){const w=this._tiles[o];w&&w.setDependencies(u,_)}reloadTilesForDependencies(o,u){for(const _ in this._tiles)this._tiles[_].hasDependency(o,u)&&this._reloadTile(+_,"reloading");this._cache.filter(_=>!_.hasDependency(o,u))}_preloadTiles(o,u){if(!this._sourceLoaded){const V=()=>{this._sourceLoaded&&(this._source.off("data",V),this._preloadTiles(o,u))};return void this._source.on("data",V)}const _=new Map,w=Array.isArray(o)?o:[o],T=this.map.painter.terrain,C=this.usedForTerrain&&T?T.getScaledDemTileSize():this._source.tileSize;for(const V of w){const $=V.coveringTiles({tileSize:C,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const K of $)_.set(K.key,K);this.usedForTerrain&&V.updateElevation(!1)}const z=Array.from(_.values());i.bl(z,(V,$)=>{const K=new ql(V,this._source.tileSize*V.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(K,ee=>{this._source.type==="raster-dem"&&K.dem&&this._backfillDEM(K),$(ee,K)})},u)}}function Ei(y,o){const u=Math.abs(2*y.wrap)-+(y.wrap<0),_=Math.abs(2*o.wrap)-+(o.wrap<0);return y.overscaledZ-o.overscaledZ||_-u||o.canonical.y-y.canonical.y||o.canonical.x-y.canonical.x}function oo(y){return y==="raster"||y==="image"||y==="video"||y==="custom"}function dr(y,o){const u=1<<y.z;return[y.x/u+o,(y.x+1)/u+o]}Ko.maxOverzooming=10,Ko.maxUnderzooming=3;class Ru{constructor(o){this.style=o,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const o=!1,u=!1;for(const _ in this.style._mergedLayers){const w=this.style._mergedLayers[_];if(w.type==="fill-extrusion")this.layers.push({layer:w,visible:o,visibilityChanged:u});else if(w.type==="model"){const T=this.style.getLayerSource(w);T&&T.type==="batched-model"&&this.layers.push({layer:w,visible:o,visibilityChanged:u})}}}onNewFrame(o){this.layersGotHidden=!1;for(const u of this.layers){const _=u.layer;let w=!1;_.type==="fill-extrusion"?w=!_.isHidden(o)&&_.paint.get("fill-extrusion-opacity")>0:_.type==="model"&&(w=!_.isHidden(o)&&_.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!w&&u.visible,u.visible=w}}updateZOffset(o,u){this.currentBuildingBuckets=[];for(const w of this.layers){const T=w.layer,C=this.style.getLayerSourceCache(T);let z=1;T.type==="fill-extrusion"&&(z=w.visible?T.paint.get("fill-extrusion-vertical-scale"):0);let V=C?C.getTile(u):null;if(!V&&C&&u.canonical.z>C.getSource().minzoom){let $=u.scaledTo(Math.min(C.getSource().maxzoom,u.overscaledZ-1));for(;$.overscaledZ>=C.getSource().minzoom&&(V=C.getTile($),!V&&$.overscaledZ!==0);)$=$.scaledTo($.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:V?V.getBucket(T):null,tileID:V?V.tileID:u,verticalScale:z})}o.hasAnyZOffset=!1;let _=!1;for(let w=0;w<o.symbolInstances.length;w++){const T=o.symbolInstances.get(w),C=T.zOffset,z=this._getHeightAtTileOffset(u,T.tileAnchorX,T.tileAnchorY);T.zOffset=z!==Number.NEGATIVE_INFINITY?z:C,_||C===T.zOffset||(_=!0),o.hasAnyZOffset||T.zOffset===0||(o.hasAnyZOffset=!0)}_&&(o.zOffsetBuffersNeedUpload=!0,o.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(o,u,_,w){let T=u,C=_;if(o.canonical.z!==w.canonical.z){const z=w.canonical,V=1/(1<<o.canonical.z-z.z);T=(u+o.canonical.x*i.ai)*V-z.x*i.ai|0,C=(_+o.canonical.y*i.ai)*V-z.y*i.ai|0}return{tileX:T,tileY:C}}_getHeightAtTileOffset(o,u,_){let w,T;for(let C=0;C<this.layers.length;++C){if(this.layers[C].layer.type!=="fill-extrusion")continue;const{bucket:z,tileID:V,verticalScale:$}=this.currentBuildingBuckets[C];if(!z)continue;const{tileX:K,tileY:ee}=this._mapCoordToOverlappingTile(o,u,_,V),te=z.getHeightAtTileCoord(K,ee);te&&te.height!==void 0&&(te.hidden?w=te.height:T=Math.max(te.height*$,T||0))}if(T!==void 0)return T;for(let C=0;C<this.layers.length;++C){const z=this.layers[C];if(z.layer.type!=="model"||!z.visible)continue;const{bucket:V,tileID:$}=this.currentBuildingBuckets[C];if(!V)continue;const{tileX:K,tileY:ee}=this._mapCoordToOverlappingTile(o,u,_,$),te=V.getHeightAtTileCoord(K,ee);if(te&&!te.hidden)return te.height===void 0&&w!==void 0?Math.min(te.maxHeight,w)*te.verticalScale:te.height?te.height*te.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function yi(y,o){const u={};for(const _ in y)_!=="ref"&&(u[_]=y[_]);return i.bm.forEach(_=>{_ in o&&(u[_]=o[_])}),u}function ef(y){y=y.slice();const o=Object.create(null);for(let u=0;u<y.length;u++)o[y[u].id]=y[u];for(let u=0;u<y.length;u++)"ref"in y[u]&&(y[u]=yi(y[u],o[y[u].ref]));return y}const Si={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function js(y,o,u){u.push({command:Si.addSource,args:[y,o[y]]})}function au(y,o,u){o.push({command:Si.removeSource,args:[y]}),u[y]=!0}function su(y,o,u,_){au(y,u,_),js(y,o,u)}function Jn(y,o,u){let _;for(_ in y[u])if(y[u].hasOwnProperty(_)&&_!=="data"&&!i.bn(y[u][_],o[u][_]))return!1;for(_ in o[u])if(o[u].hasOwnProperty(_)&&_!=="data"&&!i.bn(y[u][_],o[u][_]))return!1;return!0}function ri(y,o,u,_,w,T){let C;for(C in o=o||{},y=y||{})y.hasOwnProperty(C)&&(i.bn(y[C],o[C])||u.push({command:T,args:[_,C,o[C],w]}));for(C in o)o.hasOwnProperty(C)&&!y.hasOwnProperty(C)&&(i.bn(y[C],o[C])||u.push({command:T,args:[_,C,o[C],w]}))}function _i(y){return y.id}function Fs(y,o){return y[o.id]=o,y}class _h{constructor(o,u){this.reset(o,u)}reset(o,u){this.points=o||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=i.ay(o,0,1);let u=1,_=this._distances[u];const w=o*this.paddedLength+this.padding;for(;_<w&&u<this._distances.length;)_=this._distances[++u];const T=u-1,C=this._distances[T],z=_-C,V=z>0?(w-C)/z:0;return this.points[T].mult(1-V).add(this.points[u].mult(V))}}class li{constructor(o,u,_){const w=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(o/_),this.yCellCount=Math.ceil(u/_);for(let C=0;C<this.xCellCount*this.yCellCount;C++)w.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=u,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,u,_,w,T){this._forEachCell(u,_,w,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(u),this.bboxes.push(_),this.bboxes.push(w),this.bboxes.push(T)}insertCircle(o,u,_,w){this._forEachCell(u-w,_-w,u+w,_+w,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(u),this.circles.push(_),this.circles.push(w)}_insertBoxCell(o,u,_,w,T,C){this.boxCells[T].push(C)}_insertCircleCell(o,u,_,w,T,C){this.circleCells[T].push(C)}_query(o,u,_,w,T,C){if(_<0||o>this.width||w<0||u>this.height)return!T&&[];const z=[];if(o<=0&&u<=0&&this.width<=_&&this.height<=w){if(T)return!0;for(let V=0;V<this.boxKeys.length;V++)z.push({key:this.boxKeys[V],x1:this.bboxes[4*V],y1:this.bboxes[4*V+1],x2:this.bboxes[4*V+2],y2:this.bboxes[4*V+3]});for(let V=0;V<this.circleKeys.length;V++){const $=this.circles[3*V],K=this.circles[3*V+1],ee=this.circles[3*V+2];z.push({key:this.circleKeys[V],x1:$-ee,y1:K-ee,x2:$+ee,y2:K+ee})}return C?z.filter(C):z}return this._forEachCell(o,u,_,w,this._queryCell,z,{hitTest:T,seenUids:{box:{},circle:{}}},C),T?z.length>0:z}_queryCircle(o,u,_,w,T){const C=o-_,z=o+_,V=u-_,$=u+_;if(z<0||C>this.width||$<0||V>this.height)return!w&&[];const K=[];return this._forEachCell(C,V,z,$,this._queryCellCircle,K,{hitTest:w,circle:{x:o,y:u,radius:_},seenUids:{box:{},circle:{}}},T),w?K.length>0:K}query(o,u,_,w,T){return this._query(o,u,_,w,!1,T)}hitTest(o,u,_,w,T){return this._query(o,u,_,w,!0,T)}hitTestCircle(o,u,_,w){return this._queryCircle(o,u,_,!0,w)}_queryCell(o,u,_,w,T,C,z,V){const $=z.seenUids,K=this.boxCells[T];if(K!==null){const te=this.bboxes;for(const ce of K)if(!$.box[ce]){$.box[ce]=!0;const Te=4*ce;if(o<=te[Te+2]&&u<=te[Te+3]&&_>=te[Te+0]&&w>=te[Te+1]&&(!V||V(this.boxKeys[ce]))){if(z.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[ce],x1:te[Te],y1:te[Te+1],x2:te[Te+2],y2:te[Te+3]})}}}const ee=this.circleCells[T];if(ee!==null){const te=this.circles;for(const ce of ee)if(!$.circle[ce]){$.circle[ce]=!0;const Te=3*ce;if(this._circleAndRectCollide(te[Te],te[Te+1],te[Te+2],o,u,_,w)&&(!V||V(this.circleKeys[ce]))){if(z.hitTest)return C.push(!0),!0;{const ve=te[Te],Ce=te[Te+1],Pe=te[Te+2];C.push({key:this.circleKeys[ce],x1:ve-Pe,y1:Ce-Pe,x2:ve+Pe,y2:Ce+Pe})}}}}}_queryCellCircle(o,u,_,w,T,C,z,V){const $=z.circle,K=z.seenUids,ee=this.boxCells[T];if(ee!==null){const ce=this.bboxes;for(const Te of ee)if(!K.box[Te]){K.box[Te]=!0;const ve=4*Te;if(this._circleAndRectCollide($.x,$.y,$.radius,ce[ve+0],ce[ve+1],ce[ve+2],ce[ve+3])&&(!V||V(this.boxKeys[Te])))return C.push(!0),!0}}const te=this.circleCells[T];if(te!==null){const ce=this.circles;for(const Te of te)if(!K.circle[Te]){K.circle[Te]=!0;const ve=3*Te;if(this._circlesCollide(ce[ve],ce[ve+1],ce[ve+2],$.x,$.y,$.radius)&&(!V||V(this.circleKeys[Te])))return C.push(!0),!0}}}_forEachCell(o,u,_,w,T,C,z,V){const $=this._convertToXCellCoord(o),K=this._convertToYCellCoord(u),ee=this._convertToXCellCoord(_),te=this._convertToYCellCoord(w);for(let ce=$;ce<=ee;ce++)for(let Te=K;Te<=te;Te++)if(T.call(this,o,u,_,w,this.xCellCount*Te+ce,C,z,V))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,u,_,w,T,C){const z=w-o,V=T-u,$=_+C;return $*$>z*z+V*V}_circleAndRectCollide(o,u,_,w,T,C,z){const V=(C-w)/2,$=Math.abs(o-(w+V));if($>V+_)return!1;const K=(z-T)/2,ee=Math.abs(u-(T+K));if(ee>K+_)return!1;if($<=V||ee<=K)return!0;const te=$-V,ce=ee-K;return te*te+ce*ce<=_*_}}const zo={unknown:0,flipRequired:1,flipNotRequired:2},uc=Math.tan(85*Math.PI/180);function xs(y,o,u,_,w,T,C){const z=i.ad.mat4.create();if(u)if(T.name==="globe"){const V=i.bo(w,o);i.ad.mat4.multiply(z,z,V)}else{const V=i.ad.mat2.invert([],C);z[0]=V[0],z[1]=V[1],z[4]=V[2],z[5]=V[3],_||i.ad.mat4.rotateZ(z,z,w.angle)}else i.ad.mat4.multiply(z,w.labelPlaneMatrix,y);return z}function za(y,o,u,_,w,T,C){const z=xs(y,o,u,_,w,T,C);return T.name==="globe"&&u||(z[2]=z[6]=z[10]=z[14]=0),z}function Ta(y,o,u,_,w,T,C){if(u){if(T.name==="globe"){const z=xs(y,o,u,_,w,T,C);return i.ad.mat4.invert(z,z),i.ad.mat4.multiply(z,y,z),z}{const z=i.ad.mat4.clone(y),V=i.ad.mat4.identity([]);return V[0]=C[0],V[1]=C[1],V[4]=C[2],V[5]=C[3],i.ad.mat4.multiply(z,z,V),_||i.ad.mat4.rotateZ(z,z,-w.angle),z}}return w.glCoordMatrix}function lo(y,o,u,_){const w=[y,o,u,1];u?i.ad.vec4.transformMat4(w,w,_):qa(w,w,_);const T=w[3];return w[0]/=T,w[1]/=T,w[2]/=T,w}function vh(y,o){return Math.min(.5+y/o*.5,1.5)}function tf(y,o){const u=y[0]/y[3],_=y[1]/y[3];return u>=-o[0]&&u<=o[0]&&_>=-o[1]&&_<=o[1]}function ou(y,o,u,_,w,T,C,z,V,$){const K=u.transform,ee=_?y.textSizeData:y.iconSizeData,te=i.bp(ee,u.transform.zoom),ce=K.projection.name==="globe",Te=[256/u.width*2+1,256/u.height*2+1],ve=_?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;ve.clear();let Ce=null;ce&&(Ce=_?y.text.globeExtVertexArray:y.icon.globeExtVertexArray);const Pe=y.lineVertexArray,qe=_?y.text.placedSymbolArray:y.icon.placedSymbolArray,Je=u.transform.width/u.transform.height;let Ye,lt=!1;for(let nt=0;nt<qe.length;nt++){const rt=qe.get(nt),{numGlyphs:it,writingMode:dt}=rt;if(dt!==i.bq.vertical||lt||Ye===i.bq.horizontal||(lt=!0),Ye=dt,(rt.hidden||dt===i.bq.vertical)&&!lt){Xo(it,ve);continue}lt=!1;const xt=new i.P(rt.tileAnchorX,rt.tileAnchorY);let{x:Xt,y:zt,z:tn}=K.projection.projectTilePoint(xt.x,xt.y,$.canonical);if(V){const[Bn,In,or]=V(xt);Xt+=Bn,zt+=In,tn+=or}const un=[Xt,zt,tn,1];if(i.ad.vec4.transformMat4(un,un,o),!tf(un,Te)){Xo(it,ve);continue}const Tn=un[3],Lt=vh(u.transform.getCameraToCenterDistance(K.projection),Tn),an=i.br(ee,te,rt),Pt=C?an/Lt:an*Lt,sn=lo(Xt,zt,tn,w);if(sn[3]<=0){Xo(it,ve);continue}let Qt={};const fn=i.ak(y.layers[0].layout.get("text-max-angle")),Wt=Math.cos(fn),mn=C?null:V,zn=os(rt,Pt,!1,z,o,w,T,y.glyphOffsetArray,Pe,ve,Ce,sn,xt,Qt,Je,mn,K.projection,$,C,Wt);lt=zn.useVertical,mn&&zn.needsFlipping&&(Qt={}),(zn.notEnoughRoom||lt||zn.needsFlipping&&os(rt,Pt,!0,z,o,w,T,y.glyphOffsetArray,Pe,ve,Ce,sn,xt,Qt,Je,mn,K.projection,$,C,Wt).notEnoughRoom)&&Xo(it,ve)}_?(y.text.dynamicLayoutVertexBuffer.updateData(ve),Ce&&y.text.globeExtVertexBuffer&&y.text.globeExtVertexBuffer.updateData(Ce)):(y.icon.dynamicLayoutVertexBuffer.updateData(ve),Ce&&y.icon.globeExtVertexBuffer&&y.icon.globeExtVertexBuffer.updateData(Ce))}function lu(y,o,u,_,w,T,C,z,V,$,K,ee,te,ce,Te,ve,Ce){const{lineStartIndex:Pe,glyphStartIndex:qe,segment:Je}=z,Ye=qe+z.numGlyphs,lt=Pe+z.lineLength,nt=o.getoffsetX(qe),rt=o.getoffsetX(Ye-1),it=wl(y*nt,u,_,w,T,C,Je,Pe,lt,V,$,K,ee,te,!0,ce,Te,ve,Ce);if(!it)return null;const dt=wl(y*rt,u,_,w,T,C,Je,Pe,lt,V,$,K,ee,te,!0,ce,Te,ve,Ce);return dt?{first:it,last:dt}:null}function Yo(y,o,u,_){return y===i.bq.horizontal&&Math.abs(_)>Math.abs(u)?{useVertical:!0}:y===i.bq.vertical?_>0?{needsFlipping:!0}:null:o!==zo.unknown&&function(w,T){return w===0||Math.abs(T/w)>uc}(u,_)?o===zo.flipRequired?{needsFlipping:!0}:null:u<0?{needsFlipping:!0}:null}function os(y,o,u,_,w,T,C,z,V,$,K,ee,te,ce,Te,ve,Ce,Pe,qe,Je){const Ye=o/24,lt=y.lineOffsetX*Ye,nt=y.lineOffsetY*Ye,{lineStartIndex:rt,glyphStartIndex:it,numGlyphs:dt,segment:xt,writingMode:Xt,flipState:zt}=y,tn=rt+y.lineLength,un=Tn=>{if(K){const[sn,Qt,fn]=Tn.up,Wt=$.length;i.bs(K,Wt+0,sn,Qt,fn),i.bs(K,Wt+1,sn,Qt,fn),i.bs(K,Wt+2,sn,Qt,fn),i.bs(K,Wt+3,sn,Qt,fn)}const[Lt,an,Pt]=Tn.point;i.bt($,Lt,an,Pt,Tn.angle)};if(dt>1){const Tn=lu(Ye,z,lt,nt,u,ee,te,y,V,T,ce,ve,!1,Ce,Pe,qe,Je);if(!Tn)return{notEnoughRoom:!0};if(_&&!u){let[Lt,an,Pt]=Tn.first.point,[sn,Qt,fn]=Tn.last.point;[Lt,an]=lo(Lt,an,Pt,C),[sn,Qt]=lo(sn,Qt,fn,C);const Wt=Yo(Xt,zt,(sn-Lt)*Te,Qt-an);if(y.flipState=Wt&&Wt.needsFlipping?zo.flipRequired:zo.flipNotRequired,Wt)return Wt}un(Tn.first);for(let Lt=it+1;Lt<it+dt-1;Lt++){const an=wl(Ye*z.getoffsetX(Lt),lt,nt,u,ee,te,xt,rt,tn,V,T,ce,ve,!1,!1,Ce,Pe,qe,Je);if(!an)return $.length-=4*(Lt-it),{notEnoughRoom:!0};un(an)}un(Tn.last)}else{if(_&&!u){const Lt=lo(te.x,te.y,0,w),an=rt+xt+1,Pt=new i.P(V.getx(an),V.gety(an)),sn=lo(Pt.x,Pt.y,0,w),Qt=sn[3]>0?sn:ws(te,Pt,Lt,1,w,void 0,Ce,Pe.canonical),fn=Yo(Xt,zt,(Qt[0]-Lt[0])*Te,Qt[1]-Lt[1]);if(y.flipState=fn&&fn.needsFlipping?zo.flipRequired:zo.flipNotRequired,fn)return fn}const Tn=wl(Ye*z.getoffsetX(it),lt,nt,u,ee,te,xt,rt,tn,V,T,ce,ve,!1,!1,Ce,Pe,qe,Je);if(!Tn)return{notEnoughRoom:!0};un(Tn)}return{}}function Fc(y,o,u,_,w){const{x:T,y:C,z}=_.projectTilePoint(y.x,y.y,o);if(!w)return lo(T,C,z,u);const[V,$,K]=w(y);return lo(T+V,C+$,z+K,u)}function ws(y,o,u,_,w,T,C,z){const V=Fc(y.sub(o)._unit()._add(y),z,w,C,T);return i.ad.vec3.sub(V,u,V),i.ad.vec3.normalize(V,V),i.ad.vec3.scaleAndAdd(V,u,V,_)}function wl(y,o,u,_,w,T,C,z,V,$,K,ee,te,ce,Te,ve,Ce,Pe,qe){const Je=_?y-o:y+o;let Ye=Je>0?1:-1,lt=0;_&&(Ye*=-1,lt=Math.PI),Ye<0&&(lt+=Math.PI);let nt=z+C+(Ye>0?0:1)|0,rt=w,it=w,dt=0,xt=0;const Xt=Math.abs(Je),zt=[],tn=[];let un=T,Tn=un,Lt=i.ad.vec3.zero([]);const an=()=>ws(Tn,un,it,Xt-dt+1,K,te,ve,Ce.canonical);for(;dt+xt<=Xt;){if(nt+=Ye,nt<z||nt>=V)return null;if(it=rt,Tn=un,zt.push(it),ce&&tn.push(Tn),un=new i.P($.getx(nt),$.gety(nt)),rt=ee[nt],!rt){const or=Fc(un,Ce.canonical,K,ve,te);rt=or[3]>0?ee[nt]=or:an()}dt+=xt;const Bn=i.ad.vec3.sub([],rt,it),In=i.ad.vec3.distance(it,rt);if(u&&In>0&&xt>0&&i.ad.vec3.dot(Lt,Bn)/(xt*In)<qe)return null;xt=In,Lt=Bn}Te&&te&&(ee[nt]&&(rt=an(),xt=i.ad.vec3.distance(it,rt),Lt=i.ad.vec3.sub([],rt,it)),ee[nt]=rt);const Pt=(Xt-dt)/xt,sn=un.sub(Tn)._mult(Pt)._add(Tn),Qt=i.ad.vec3.scaleAndAdd([],it,Lt,Pt);let fn=[0,0,1],Wt=Lt[0],mn=Lt[1];if(Pe&&(fn=ve.upVector(Ce.canonical,sn.x,sn.y),fn[0]!==0||fn[1]!==0||fn[2]!==1)){const Bn=[fn[2],0,-fn[0]],In=i.ad.vec3.cross([],fn,Bn);i.ad.vec3.normalize(Bn,Bn),i.ad.vec3.normalize(In,In),Wt=i.ad.vec3.dot(Lt,Bn),mn=i.ad.vec3.dot(Lt,In)}if(u){const Bn=i.ad.vec3.cross([],fn,Lt);i.ad.vec3.normalize(Bn,Bn),i.ad.vec3.scaleAndAdd(Qt,Qt,Bn,u*Ye)}const zn=lt+Math.atan2(mn,Wt);return zt.push(Qt),ce&&tn.push(sn),{point:Qt,angle:zn,path:zt,tilePath:tn,up:fn}}function Xo(y,o){const u=o.length,_=u+4*y;o.resize(_),o.float32.fill(-1/0,4*u,4*_)}function qa(y,o,u){const _=o[0],w=o[1];return y[0]=u[0]*_+u[4]*w+u[12],y[1]=u[1]*_+u[5]*w+u[13],y[3]=u[3]*_+u[7]*w+u[15],y}const Us=100;class Vl{constructor(o,u,_=new li(o.width+200,o.height+200,25),w=new li(o.width+200,o.height+200,25)){this.transform=o,this.grid=_,this.ignoredGrid=w,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+Us,this.screenBottomBoundary=o.height+Us,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=u}placeCollisionBox(o,u,_,w,T,C,z,V){let $=_.projectedAnchorX,K=_.projectedAnchorY,ee=_.projectedAnchorZ;const te=_.elevation,ce=_.tileID,Te=o.getProjection();if(te&&ce){const[nt,rt,it]=Te.upVector(ce.canonical,_.tileAnchorX,_.tileAnchorY),dt=Te.upVectorScale(ce.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;$+=nt*te*dt,K+=rt*te*dt,ee+=it*te*dt}const ve=this.projectAndGetPerspectiveRatio(z,$,K,ee,_.tileID,Te.name==="globe"||!!te||this.transform.pitch>0,Te),Ce=C*ve.perspectiveRatio,Pe=(_.x1*u+w.x-_.padding)*Ce+ve.point.x,qe=(_.y1*u+w.y-_.padding)*Ce+ve.point.y,Je=(_.x2*u+w.x+_.padding)*Ce+ve.point.x,Ye=(_.y2*u+w.y+_.padding)*Ce+ve.point.y,lt=ve.perspectiveRatio<=.55||ve.occluded;return!this.isInsideGrid(Pe,qe,Je,Ye)||!T&&this.grid.hitTest(Pe,qe,Je,Ye,V)||lt?{box:[],offscreen:!1,occluded:ve.occluded}:{box:[Pe,qe,Je,Ye],offscreen:this.isOffscreen(Pe,qe,Je,Ye),occluded:!1}}placeCollisionCircles(o,u,_,w,T,C,z,V,$,K,ee,te,ce,Te,ve){const Ce=[],Pe=this.transform.elevation,qe=o.getProjection(),Je=Pe?Pe.getAtTileOffsetFunc(ve,this.transform.center.lat,this.transform.worldSize,qe):null,Ye=new i.P(_.tileAnchorX,_.tileAnchorY);let{x:lt,y:nt,z:rt}=qe.projectTilePoint(Ye.x,Ye.y,ve.canonical);if(Je){const[fn,Wt,mn]=Je(Ye);lt+=fn,nt+=Wt,rt+=mn}const it=qe.name==="globe",dt=this.projectAndGetPerspectiveRatio(z,lt,nt,rt,ve,it||!!Pe||this.transform.pitch>0,qe),{perspectiveRatio:xt}=dt,Xt=(ee?C/xt:C*xt)/i.bw,zt=lo(lt,nt,rt,V),tn=_.lineOffsetX*Xt,un=_.lineOffsetY*Xt,Tn=i.ak(o.layers[0].layout.get("text-max-angle")),Lt=Math.cos(Tn),an=dt.signedDistanceFromCamera>0?lu(Xt,T,tn,un,!1,zt,Ye,_,w,V,{},Pe&&!ee?Je:null,ee&&!!Pe,qe,ve,ee,Lt):null;let Pt=!1,sn=!1,Qt=!0;if(an&&!dt.occluded){const fn=.5*ce*xt+Te,Wt=new i.P(-100,-100),mn=new i.P(this.screenRightBoundary,this.screenBottomBoundary),zn=new _h,{first:Bn,last:In}=an,or=Bn.path.length;let Br=[];for(let Er=or-1;Er>=1;Er--)Br.push(Bn.path[Er]);for(let Er=1;Er<In.path.length;Er++)Br.push(In.path[Er]);const mr=2.5*fn;$&&(Br=Br.map(([Er,Cr,jr],Nr)=>(Je&&!it&&(jr=Je(Nr<or-1?Bn.tilePath[or-1-Nr]:In.tilePath[Nr-or+2])[2]),lo(Er,Cr,jr,$))),Br.some(Er=>Er[3]<=0)&&(Br=[]));let Dr=[];if(Br.length>0){let Er=1/0,Cr=-1/0,jr=1/0,Nr=-1/0;for(const fr of Br)Er=Math.min(Er,fr[0]),jr=Math.min(jr,fr[1]),Cr=Math.max(Cr,fr[0]),Nr=Math.max(Nr,fr[1]);Cr>=Wt.x&&Er<=mn.x&&Nr>=Wt.y&&jr<=mn.y&&(Dr=[Br.map(fr=>new i.P(fr[0],fr[1]))],(Er<Wt.x||Cr>mn.x||jr<Wt.y||Nr>mn.y)&&(Dr=i.bu(Dr,Wt.x,Wt.y,mn.x,mn.y)))}for(const Er of Dr){zn.reset(Er,.25*fn);let Cr=0;Cr=zn.length<=.5*fn?1:Math.ceil(zn.paddedLength/mr)+1;for(let jr=0;jr<Cr;jr++){const Nr=jr/Math.max(Cr-1,1),fr=zn.lerp(Nr),ai=fr.x+Us,Ar=fr.y+Us;Ce.push(ai,Ar,fn,0);const tr=ai-fn,si=Ar-fn,Hi=ai+fn,ci=Ar+fn;if(Qt=Qt&&this.isOffscreen(tr,si,Hi,ci),sn=sn||this.isInsideGrid(tr,si,Hi,ci),!u&&this.grid.hitTestCircle(ai,Ar,fn,te)&&(Pt=!0,!K))return{circles:[],offscreen:!1,collisionDetected:Pt,occluded:!1}}}}return{circles:!K&&Pt||!sn?[]:Ce,offscreen:Qt,collisionDetected:Pt,occluded:dt.occluded}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const u=[];let _=1/0,w=1/0,T=-1/0,C=-1/0;for(const K of o){const ee=new i.P(K.x+Us,K.y+Us);_=Math.min(_,ee.x),w=Math.min(w,ee.y),T=Math.max(T,ee.x),C=Math.max(C,ee.y),u.push(ee)}const z=this.grid.query(_,w,T,C).concat(this.ignoredGrid.query(_,w,T,C)),V={},$={};for(const K of z){const ee=K.key;if(V[ee.bucketInstanceId]===void 0&&(V[ee.bucketInstanceId]={}),V[ee.bucketInstanceId][ee.featureIndex])continue;const te=[new i.P(K.x1,K.y1),new i.P(K.x2,K.y1),new i.P(K.x2,K.y2),new i.P(K.x1,K.y2)];i.bv(u,te)&&(V[ee.bucketInstanceId][ee.featureIndex]=!0,$[ee.bucketInstanceId]===void 0&&($[ee.bucketInstanceId]=[]),$[ee.bucketInstanceId].push(ee.featureIndex))}return $}insertCollisionBox(o,u,_,w,T){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:w,collisionGroupID:T},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,u,_,w,T){const C=u?this.ignoredGrid:this.grid,z={bucketInstanceId:_,featureIndex:w,collisionGroupID:T};for(let V=0;V<o.length;V+=4)C.insertCircle(z,o[V],o[V+1],o[V+2])}projectAndGetPerspectiveRatio(o,u,_,w,T,C,z){const V=[u,_,w,1];let $=!1;w||this.transform.pitch>0?(i.ad.vec4.transformMat4(V,V,o),this.fogState&&T&&z.name!=="globe"&&($=function(te,ce,Te,ve,Ce,Pe){const qe=Pe.calculateFogTileMatrix(Ce),Je=[ce,Te,ve];return i.ad.vec3.transformMat4(Je,Je,qe),qn(te,i.ad.vec3.length(Je),Pe.pitch,Pe._fov)}(this.fogState,u,_,w,T.toUnwrapped(),this.transform)>.9)):qa(V,V,o);const K=V[3];return{point:new i.P((V[0]/K+1)/2*this.transform.width+Us,(-V[1]/K+1)/2*this.transform.height+Us),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(z)/K*.5,1.5),signedDistanceFromCamera:K,occluded:C&&V[2]>K||$}}isOffscreen(o,u,_,w){return _<Us||o>=this.screenRightBoundary||w<Us||u>this.screenBottomBoundary}isInsideGrid(o,u,_,w){return _>=0&&o<this.gridRightBoundary&&w>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const o=i.ad.mat4.identity([]);return i.ad.mat4.translate(o,o,[-100,-100,0]),o}}function ns(y,o,u){const _=o.createTileMatrix(y,y.worldSize,u.toUnwrapped());return i.ad.mat4.multiply(new Float32Array(16),y.projMatrix,_)}function Pf(y,o,u){if(o.projection.name===u.projection.name)return y.projMatrix;const _=u.clone();return _.setProjection(o.projection),ns(_,o.getProjection(),y)}function Bo(y,o,u){return o.name===u.projection.name?y.projMatrix:ns(u,o,y)}class bh{constructor(o,u,_,w){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?u:-u))):w&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class hc{constructor(o,u,_,w,T,C=!1){this.text=new bh(o?o.text:null,u,_,T),this.icon=new bh(o?o.icon:null,u,w,T),this.clipped=C}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class fc{constructor(o,u,_,w=!1){this.text=o,this.icon=u,this.skipFade=_,this.clipped=w}}class Vd{constructor(){this.invProjMatrix=i.ad.mat4.create(),this.viewportMatrix=i.ad.mat4.create(),this.circles=[]}}class $l{constructor(o,u,_,w,T){this.bucketInstanceId=o,this.featureIndex=u,this.sourceLayerIndex=_,this.bucketIndex=w,this.tileID=T}}class Dm{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const u=++this.maxGroupID;this.collisionGroups[o]={ID:u,predicate:_=>_.collisionGroupID===u}}return this.collisionGroups[o]}}function xh(y,o,u,_,w){const{horizontalAlign:T,verticalAlign:C}=i.bD(y),z=-(T-.5)*o,V=-(C-.5)*u,$=i.bC(y,_);return new i.P(z+$[0]*w,V+$[1]*w)}function qs(y,o,u,_,w){const T=new i.P(y,o);return u&&T._rotate(_?w:-w),T}class hd{constructor(o,u,_,w,T,C){this.transform=o.clone(),this.projection=o.projection.name,this.collisionIndex=new Vl(this.transform,T),this.buildingIndex=C,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Dm(_),this.collisionCircleArrays={},this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,u,_,w,T=1){const C=_.getBucket(u),z=_.latestFeatureIndex;if(!C||!z||u.fqid!==C.layerIds[0])return;const V=C.layers[0].layout,$=C.layers[0].paint,K=_.collisionBoxArray,ee=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),te=_.tileSize/i.ai,ce=_.tileID.toUnwrapped();this.transform.setProjection(C.projection);const Te=(ve=_.tileID,Ce=C.getProjection(),Pe=this.transform,Ce.name===this.projection?Pe.calculateProjMatrix(ve.toUnwrapped()):ns(Pe,Ce,ve));var ve,Ce,Pe;const qe=V.get("text-pitch-alignment")==="map",Je=V.get("text-rotation-alignment")==="map";u.compileFilter(u.options);const Ye=u.dynamicFilter(),lt=u.dynamicFilterNeedsFeature(),nt=this.transform.calculatePixelsToTileUnitsMatrix(_),rt=za(Te,_.tileID.canonical,qe,Je,this.transform,C.getProjection(),nt);let it=null;if(qe){const an=Ta(Te,_.tileID.canonical,qe,Je,this.transform,C.getProjection(),nt);it=i.ad.mat4.multiply([],this.transform.labelPlaneMatrix,an)}let dt=null;Ye&&_.latestFeatureIndex&&(dt={unwrappedTileID:ce,dynamicFilter:Ye,dynamicFilterNeedsFeature:lt}),this.retainedQueryData[C.bucketInstanceId]=new $l(C.bucketInstanceId,z,C.sourceLayerIndex,C.index,_.tileID);const[xt,Xt]=C.layers[0].layout.get("text-size-scale-range"),zt=i.ay(T,xt,Xt),[tn,un]=V.get("icon-size-scale-range"),Tn=i.ay(T,tn,un),Lt={bucket:C,layout:V,paint:$,posMatrix:Te,textLabelPlaneMatrix:rt,labelToScreenMatrix:it,clippingData:dt,scale:ee,textPixelRatio:te,holdingForFade:_.holdingForFade(),collisionBoxArray:K,partiallyEvaluatedTextSize:i.bp(C.textSizeData,this.transform.zoom,zt),partiallyEvaluatedIconSize:i.bp(C.iconSizeData,this.transform.zoom,Tn),collisionGroup:this.collisionGroups.get(C.sourceID),latestFeatureIndex:_.latestFeatureIndex};if(w)for(const an of C.sortKeyRanges){const{sortKey:Pt,symbolInstanceStart:sn,symbolInstanceEnd:Qt}=an;o.push({sortKey:Pt,symbolInstanceStart:sn,symbolInstanceEnd:Qt,parameters:Lt})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:Lt})}attemptAnchorPlacement(o,u,_,w,T,C,z,V,$,K,ee,te,ce,Te,ve,Ce,Pe,qe){const{textOffset0:Je,textOffset1:Ye,crossTileID:lt}=te,nt=[Je,Ye],rt=xh(o,_,w,nt,T),it=this.collisionIndex.placeCollisionBox(Te,T,u,qs(rt.x,rt.y,C,z,this.transform.angle),ee,V,$,K.predicate);if(Ce){const dt=Te.getSymbolInstanceIconSize(qe,this.transform.zoom,te.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Te,dt,Ce,qs(rt.x,rt.y,C,z,this.transform.angle),ee,V,$,K.predicate).box.length===0)return}if(it.box.length>0){let dt;return this.prevPlacement&&this.prevPlacement.variableOffsets[lt]&&this.prevPlacement.placements[lt]&&this.prevPlacement.placements[lt].text&&(dt=this.prevPlacement.variableOffsets[lt].anchor),this.variableOffsets[lt]={textOffset:nt,width:_,height:w,anchor:o,textScale:T,prevAnchor:dt},this.markUsedJustification(Te,o,te,ve),Te.allowVerticalPlacement&&(this.markUsedOrientation(Te,ve,te),this.placedOrientations[lt]=ve),{shift:rt,placedGlyphBoxes:it}}}placeLayerBucketPart(o,u,_,w,T=1){const{bucket:C,layout:z,paint:V,posMatrix:$,textLabelPlaneMatrix:K,labelToScreenMatrix:ee,clippingData:te,textPixelRatio:ce,holdingForFade:Te,collisionBoxArray:ve,partiallyEvaluatedTextSize:Ce,partiallyEvaluatedIconSize:Pe,collisionGroup:qe,latestFeatureIndex:Je}=o.parameters,Ye=z.get("text-optional"),lt=z.get("icon-optional"),nt=z.get("text-allow-overlap"),rt=z.get("icon-allow-overlap"),it=z.get("text-rotation-alignment")==="map",dt=z.get("text-pitch-alignment")==="map",xt=V.get("symbol-z-offset"),Xt=z.get("symbol-elevation-reference")==="sea",[zt,tn]=z.get("text-size-scale-range"),[un,Tn]=z.get("icon-size-scale-range"),Lt=i.ay(T,zt,tn),an=i.ay(T,un,Tn);this.transform.setProjection(C.projection);let Pt=nt&&(rt||!C.hasIconData()||lt),sn=rt&&(nt||!C.hasTextData()||Ye);const Qt=!xt.isConstant();!C.collisionArrays&&ve&&C.deserializeCollisionBoxes(ve),_&&w&&C.updateCollisionDebugBuffers(this.transform.zoom,ve,Lt,an);const fn=(Wt,mn,zn)=>{const{crossTileID:Bn,numVerticalGlyphVertices:In}=Wt;let or=null;if(te&&te.dynamicFilterNeedsFeature||Qt){const Ti=this.retainedQueryData[C.bucketInstanceId];or=Je.loadFeature({featureIndex:Wt.featureIndex,bucketIndex:Ti.bucketIndex,sourceLayerIndex:Ti.sourceLayerIndex,layoutVertexArrayOffset:0})}if(te&&!(0,te.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},or,this.retainedQueryData[C.bucketInstanceId].tileID.canonical,new i.P(Wt.tileAnchorX,Wt.tileAnchorY),this.transform.calculateDistanceTileData(te.unwrappedTileID)))return this.placements[Bn]=new fc(!1,!1,!1,!0),void u.add(Bn);const Br=xt.evaluate(or,{});if(u.has(Bn))return;if(Te)return void(this.placements[Bn]=new fc(!1,!1,!1));let mr=!1,Dr=!1,Er=!0,Cr=!1,jr=!1,Nr=null,fr={box:null,offscreen:null,occluded:null},ai={box:null},Ar=null,tr=null,si=null,Hi=0,ci=0,Oi=0;zn.textFeatureIndex?Hi=zn.textFeatureIndex:Wt.useRuntimeCollisionCircles&&(Hi=Wt.featureIndex),zn.verticalTextFeatureIndex&&(ci=zn.verticalTextFeatureIndex);const Ka=Ti=>{Ti.tileID=this.retainedQueryData[C.bucketInstanceId].tileID;const ra=this.transform.elevation;Ti.elevation=Xt?Br:Br+(ra?ra.getAtTileOffset(Ti.tileID,Ti.tileAnchorX,Ti.tileAnchorY):0),Ti.elevation+=Wt.zOffset},us=zn.textBox;if(us){Ka(us);const Ti=Di=>{let sa=i.bq.horizontal;if(C.allowVerticalPlacement&&!Di&&this.prevPlacement){const mo=this.prevPlacement.placedOrientations[Bn];mo&&(this.placedOrientations[Bn]=mo,sa=mo,this.markUsedOrientation(C,sa,Wt))}return sa},ra=(Di,sa)=>{if(C.allowVerticalPlacement&&In>0&&zn.verticalTextBox){for(const mo of C.writingModes)if(mo===i.bq.vertical?(fr=sa(),ai=fr):fr=Di(),fr&&fr.box&&fr.box.length)break}else fr=Di()};if(z.get("text-variable-anchor")){let Di=z.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Bn]){const wa=this.prevPlacement.variableOffsets[Bn];Di.indexOf(wa.anchor)>0&&(Di=Di.filter(as=>as!==wa.anchor),Di.unshift(wa.anchor))}const sa=(wa,as,Su)=>{const Vo=C.getSymbolInstanceTextSize(Ce,Wt,this.transform.zoom,mn),ec=(wa.x2-wa.x1)*Vo+2*wa.padding,Rl=(wa.y2-wa.y1)*Vo+2*wa.padding,Xc=Wt.hasIconTextFit&&!rt?as:null;Xc&&Ka(Xc);let yl={box:[],offscreen:!1,occluded:!1};const Fh=nt?2*Di.length:Di.length;for(let go=0;go<Fh;++go){const _f=this.attemptAnchorPlacement(Di[go%Di.length],wa,ec,Rl,Vo,it,dt,ce,$,qe,go>=Di.length,Wt,mn,C,Su,Xc,Ce,Pe);if(_f&&(yl=_f.placedGlyphBoxes,yl&&yl.box&&yl.box.length)){mr=!0,Nr=_f.shift;break}}return yl};ra(()=>sa(us,zn.iconBox,i.bq.horizontal),()=>{const wa=zn.verticalTextBox;return wa&&Ka(wa),C.allowVerticalPlacement&&!(fr&&fr.box&&fr.box.length)&&In>0&&wa?sa(wa,zn.verticalIconBox,i.bq.vertical):{box:null,offscreen:null,occluded:null}}),fr&&(mr=fr.box,Er=fr.offscreen,Cr=fr.occluded);const mo=Ti(!(!fr||!fr.box));if(!mr&&this.prevPlacement){const wa=this.prevPlacement.variableOffsets[Bn];wa&&(this.variableOffsets[Bn]=wa,this.markUsedJustification(C,wa.anchor,Wt,mo))}}else{const Di=(sa,mo)=>{const wa=C.getSymbolInstanceTextSize(Ce,Wt,this.transform.zoom,mn,T),as=this.collisionIndex.placeCollisionBox(C,wa,sa,new i.P(0,0),nt,ce,$,qe.predicate);return as&&as.box&&as.box.length&&(this.markUsedOrientation(C,mo,Wt),this.placedOrientations[Bn]=mo),as};ra(()=>Di(us,i.bq.horizontal),()=>{const sa=zn.verticalTextBox;return C.allowVerticalPlacement&&In>0&&sa?(Ka(sa),Di(sa,i.bq.vertical)):{box:null,offscreen:null,occluded:null}}),Ti(!!(fr&&fr.box&&fr.box.length))}}if(Ar=fr,mr=Ar&&Ar.box&&Ar.box.length>0,Er=Ar&&Ar.offscreen,Cr=Ar&&Ar.occluded,Wt.useRuntimeCollisionCircles){const Ti=C.text.placedSymbolArray.get(Wt.centerJustifiedTextSymbolIndex>=0?Wt.centerJustifiedTextSymbolIndex:Wt.verticalPlacedTextSymbolIndex),ra=i.br(C.textSizeData,Ce,Ti),Di=z.get("text-padding");tr=this.collisionIndex.placeCollisionCircles(C,nt,Ti,C.lineVertexArray,C.glyphOffsetArray,ra,$,K,ee,_,dt,qe.predicate,Wt.collisionCircleDiameter*ra/i.bw,Di,this.retainedQueryData[C.bucketInstanceId].tileID),mr=nt||tr.circles.length>0&&!tr.collisionDetected,Er=Er&&tr.offscreen,Cr=tr.occluded}if(zn.iconFeatureIndex&&(Oi=zn.iconFeatureIndex),zn.iconBox){const Ti=ra=>{Ka(ra);const Di=Wt.hasIconTextFit&&Nr?qs(Nr.x,Nr.y,it,dt,this.transform.angle):new i.P(0,0),sa=C.getSymbolInstanceIconSize(Pe,this.transform.zoom,Wt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(C,sa,ra,Di,rt,ce,$,qe.predicate)};ai&&ai.box&&ai.box.length&&zn.verticalIconBox?(si=Ti(zn.verticalIconBox),Dr=si.box.length>0):(si=Ti(zn.iconBox),Dr=si.box.length>0),Er=Er&&si.offscreen,jr=si.occluded}const to=Ye||Wt.numHorizontalGlyphVertices===0&&In===0,Ws=lt||Wt.numIconVertices===0;if(to||Ws?Ws?to||(Dr=Dr&&mr):mr=Dr&&mr:Dr=mr=Dr&&mr,mr&&Ar&&Ar.box&&this.collisionIndex.insertCollisionBox(Ar.box,z.get("text-ignore-placement"),C.bucketInstanceId,ai&&ai.box&&ci?ci:Hi,qe.ID),Dr&&si&&this.collisionIndex.insertCollisionBox(si.box,z.get("icon-ignore-placement"),C.bucketInstanceId,Oi,qe.ID),tr&&(mr&&this.collisionIndex.insertCollisionCircles(tr.circles,z.get("text-ignore-placement"),C.bucketInstanceId,Hi,qe.ID),_)){const Ti=C.bucketInstanceId;let ra=this.collisionCircleArrays[Ti];ra===void 0&&(ra=this.collisionCircleArrays[Ti]=new Vd);for(let Di=0;Di<tr.circles.length;Di+=4)ra.circles.push(tr.circles[Di+0]),ra.circles.push(tr.circles[Di+1]),ra.circles.push(tr.circles[Di+2]),ra.circles.push(tr.collisionDetected?1:0)}const po=C.projection.name!=="globe";Pt=Pt&&(po||!Cr),sn=sn&&(po||!jr),this.placements[Bn]=new fc(mr||Pt,Dr||sn,Er||C.justReloaded),u.add(Bn)};if(C.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(C,this.retainedQueryData[C.bucketInstanceId].tileID),C.elevationType==="road"&&C.updateRoadElevation(),C.updateZOffset(),C.sortFeaturesByY){const Wt=C.getSortedSymbolIndexes(this.transform.angle);for(let mn=Wt.length-1;mn>=0;--mn){const zn=Wt[mn];fn(C.symbolInstances.get(zn),zn,C.collisionArrays[zn])}C.hasAnyZOffset&&i.w(`${C.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(C.hasAnyZOffset){const Wt=C.getSortedIndexesByZOffset();for(let mn=0;mn<Wt.length;++mn){const zn=Wt[mn];fn(C.symbolInstances.get(zn),zn,C.collisionArrays[zn])}}else for(let Wt=o.symbolInstanceStart;Wt<o.symbolInstanceEnd;Wt++)fn(C.symbolInstances.get(Wt),Wt,C.collisionArrays[Wt]);if(_&&C.bucketInstanceId in this.collisionCircleArrays){const Wt=this.collisionCircleArrays[C.bucketInstanceId];i.ad.mat4.invert(Wt.invProjMatrix,$),Wt.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1}markUsedJustification(o,u,_,w){const{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:z,verticalPlacedTextSymbolIndex:V,crossTileID:$}=_,K=i.bB(u),ee=w===i.bq.vertical?V:K==="left"?T:K==="center"?C:K==="right"?z:-1;T>=0&&(o.text.placedSymbolArray.get(T).crossTileID=ee>=0&&T!==ee?0:$),C>=0&&(o.text.placedSymbolArray.get(C).crossTileID=ee>=0&&C!==ee?0:$),z>=0&&(o.text.placedSymbolArray.get(z).crossTileID=ee>=0&&z!==ee?0:$),V>=0&&(o.text.placedSymbolArray.get(V).crossTileID=ee>=0&&V!==ee?0:$)}markUsedOrientation(o,u,_){const w=u===i.bq.horizontal||u===i.bq.horizontalOnly?u:0,T=u===i.bq.vertical?u:0,{leftJustifiedTextSymbolIndex:C,centerJustifiedTextSymbolIndex:z,rightJustifiedTextSymbolIndex:V,verticalPlacedTextSymbolIndex:$}=_,K=o.text.placedSymbolArray;C>=0&&(K.get(C).placedOrientation=w),z>=0&&(K.get(z).placedOrientation=w),V>=0&&(K.get(V).placedOrientation=w),$>=0&&(K.get($).placedOrientation=T)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let _=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const w=u?u.symbolFadeChange(o):1,T=u?u.opacities:{},C=u?u.variableOffsets:{},z=u?u.placedOrientations:{};for(const V in this.placements){const $=this.placements[V],K=T[V];K?(this.opacities[V]=new hc(K,w,$.text,$.icon,null,$.clipped),_=_||$.text!==K.text.placed||$.icon!==K.icon.placed):(this.opacities[V]=new hc(null,w,$.text,$.icon,$.skipFade,$.clipped),_=_||$.text||$.icon)}for(const V in T){const $=T[V];if(!this.opacities[V]){const K=new hc($,w,!1,!1);K.isHidden()||(this.opacities[V]=K,_=_||$.text.placed||$.icon.placed)}}for(const V in C)this.variableOffsets[V]||!this.opacities[V]||this.opacities[V].isHidden()||(this.variableOffsets[V]=C[V]);for(const V in z)this.placedOrientations[V]||!this.opacities[V]||this.opacities[V].isHidden()||(this.placedOrientations[V]=z[V]);_?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:o)}updateLayerOpacities(o,u,_,w){const T=new Set;for(const C of u){const z=C.getBucket(o);z&&C.latestFeatureIndex&&o.fqid===z.layerIds[0]&&(this.updateBucketOpacities(z,T,C,C.collisionBoxArray,_,w,C.tileID,o.scope),z.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(z,C.tileID),z.elevationType==="road"&&z.updateRoadElevation(),z.updateZOffset())}}updateBucketOpacities(o,u,_,w,T,C,z,V){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const $=o.layers[0].layout,K=o.layers[0].paint,ee=!!o.layers[0].dynamicFilter(),te=new hc(null,0,!1,!1,!0),ce=$.get("text-allow-overlap"),Te=$.get("icon-allow-overlap"),ve=$.get("text-variable-anchor"),Ce=$.get("text-rotation-alignment")==="map",Pe=$.get("text-pitch-alignment")==="map",qe=K.get("symbol-z-offset"),Je=$.get("symbol-elevation-reference")==="sea",Ye=!qe.isConstant(),lt=new hc(null,0,ce&&(Te||!o.hasIconData()||$.get("icon-optional")),Te&&(ce||!o.hasTextData()||$.get("text-optional")),!0);!o.collisionArrays&&w&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(w);const nt=(it,dt,xt)=>{for(let Xt=0;Xt<dt/4;Xt++)it.opacityVertexArray.emplaceBack(xt)};let rt=0;C&&o.updateReplacement(z,C);for(let it=0;it<o.symbolInstances.length;it++){const dt=o.symbolInstances.get(it),{numHorizontalGlyphVertices:xt,numVerticalGlyphVertices:Xt,crossTileID:zt,numIconVertices:tn,tileAnchorX:un,tileAnchorY:Tn}=dt;let Lt=null;const an=this.retainedQueryData[o.bucketInstanceId];Ye&&dt&&an&&(Lt=_.latestFeatureIndex.loadFeature({featureIndex:dt.featureIndex,bucketIndex:an.bucketIndex,sourceLayerIndex:an.sourceLayerIndex,layoutVertexArrayOffset:0}));const Pt=qe.evaluate(Lt,{}),sn=u.has(zt);let Qt=this.opacities[zt];sn?Qt=te:Qt||(Qt=lt,this.opacities[zt]=Qt),u.add(zt);const fn=xt>0||Xt>0,Wt=tn>0,mn=this.placedOrientations[zt],zn=mn===i.bq.vertical,Bn=mn===i.bq.horizontal||mn===i.bq.horizontalOnly;!fn&&!Wt||Qt.isHidden()||rt++;let In=!1;if((fn||Wt)&&C)for(const or of o.activeReplacements){if(i.bx(or,T,i.by.Symbol,V)||or.min.x>un||un>or.max.x||or.min.y>Tn||Tn>or.max.y)continue;const Br=i.bz(un,Tn,z.canonical,or.footprintTileId.canonical);if(In=i.bA(Br,or.footprint),In)break}if(fn){const or=In?wr:rr(Qt.text);nt(o.text,xt,zn?wr:or),nt(o.text,Xt,Bn?wr:or);const Br=Qt.text.isHidden(),{leftJustifiedTextSymbolIndex:mr,centerJustifiedTextSymbolIndex:Dr,rightJustifiedTextSymbolIndex:Er,verticalPlacedTextSymbolIndex:Cr}=dt,jr=o.text.placedSymbolArray,Nr=Br||zn?1:0;mr>=0&&(jr.get(mr).hidden=Nr),Dr>=0&&(jr.get(Dr).hidden=Nr),Er>=0&&(jr.get(Er).hidden=Nr),Cr>=0&&(jr.get(Cr).hidden=Br||Bn?1:0);const fr=this.variableOffsets[zt];fr&&this.markUsedJustification(o,fr.anchor,dt,mn);const ai=this.placedOrientations[zt];ai&&(this.markUsedJustification(o,"left",dt,ai),this.markUsedOrientation(o,ai,dt))}if(Wt){const or=In?wr:rr(Qt.icon),{placedIconSymbolIndex:Br,verticalPlacedIconSymbolIndex:mr}=dt,Dr=o.icon.placedSymbolArray,Er=Qt.icon.isHidden()?1:0;Br>=0&&(nt(o.icon,tn,zn?wr:or),Dr.get(Br).hidden=Er),mr>=0&&(nt(o.icon,dt.numVerticalIconVertices,Bn?wr:or),Dr.get(mr).hidden=Er)}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const or=o.collisionArrays[it];if(or){let Br=new i.P(0,0),mr=!0;if(or.textBox||or.verticalTextBox){if(ve){const Er=this.variableOffsets[zt];Er?(Br=xh(Er.anchor,Er.width,Er.height,Er.textOffset,Er.textScale),Ce&&Br._rotate(Pe?this.transform.angle:-this.transform.angle)):mr=!1}ee&&(mr=!Qt.clipped),or.textBox&&Hl(o.textCollisionBox.collisionVertexArray,Qt.text.placed,!mr||zn,Pt,Je,Br.x,Br.y),or.verticalTextBox&&Hl(o.textCollisionBox.collisionVertexArray,Qt.text.placed,!mr||Bn,Pt,Je,Br.x,Br.y)}const Dr=mr&&!!(!Bn&&or.verticalIconBox);or.iconBox&&Hl(o.iconCollisionBox.collisionVertexArray,Qt.icon.placed,Dr,Pt,Je,dt.hasIconTextFit?Br.x:0,dt.hasIconTextFit?Br.y:0),or.verticalIconBox&&Hl(o.iconCollisionBox.collisionVertexArray,Qt.icon.placed,!Dr,Pt,Je,dt.hasIconTextFit?Br.x:0,dt.hasIconTextFit?Br.y:0)}}}if(o.fullyClipped=rt===0,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const it=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=it.invProjMatrix,o.placementViewportMatrix=it.viewportMatrix,o.collisionCircleArray=it.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,u){const _=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*_>o}setStale(){this.stale=!0}}function Hl(y,o,u,_,w,T,C){y.emplaceBack(o?1:0,u?1:0,T||0,C||0,_,w?1:0),y.emplaceBack(o?1:0,u?1:0,T||0,C||0,_,w?1:0),y.emplaceBack(o?1:0,u?1:0,T||0,C||0,_,w?1:0),y.emplaceBack(o?1:0,u?1:0,T||0,C||0,_,w?1:0)}const fd=Math.pow(2,25),se=Math.pow(2,24),Ge=Math.pow(2,17),Rt=Math.pow(2,16),Yt=Math.pow(2,9),dn=Math.pow(2,8),kn=Math.pow(2,1);function rr(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const o=y.placed?1:0,u=Math.floor(127*y.opacity);return u*fd+o*se+u*Ge+o*Rt+u*Yt+o*dn+u*kn+o}const wr=0;class Wr{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&o.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(o,u,_,w,T,C){const z=this._bucketParts;for(;this._currentTileIndex<o.length;)if(u.getBucketParts(z,w,o[this._currentTileIndex],this._sortAcrossTiles,C),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,z.sort((V,$)=>V.sortKey-$.sortKey));this._currentPartIndex<z.length;){const V=z[this._currentPartIndex];if(u.placeLayerBucketPart(V,this._seenCrossTileIDs,_,V.symbolInstanceStart===0,C),this._currentPartIndex++,T())return!0}return!1}}class Ai{constructor(o,u,_,w,T,C,z,V,$){this.placement=new hd(o,T,C,z,V,$),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(o,u,_,w,T){const C=i.q.now(),z=()=>{const V=i.q.now()-C;return!this._forceFullPlacement&&V>2};for(;this._currentPlacementIndex>=0;){const V=u[o[this._currentPlacementIndex]],$=this.placement.collisionIndex.transform.zoom;if(V.type==="symbol"&&(!V.minzoom||V.minzoom<=$)&&(!V.maxzoom||V.maxzoom>$)){const K=V,ee=K.layout.get("symbol-z-elevate"),te=K.layout.get("symbol-sort-key").constantOr(1)!==void 0,ce=K.layout.get("symbol-z-order"),Te=ce==="viewport-y"||ce==="auto"&&!(ce!=="viewport-y"&&te),ve=K.layout.get("text-allow-overlap")||K.layout.get("icon-allow-overlap")||K.layout.get("text-ignore-placement")||K.layout.get("icon-ignore-placement"),Ce=Te&&ve,Pe=this._inProgressLayer=this._inProgressLayer||new Wr(K),qe=i.C(V.source,V.scope);if(Pe.continuePlacement(ee||Ce?w[qe]:_[qe],this.placement,this._showCollisionBoxes,V,z,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const Pi=512/i.ai/2;class pa{constructor(o,u,_){this.tileID=o,this.bucketInstanceId=_,this.index=new i.bE(u.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const w=o.canonical.x*i.ai,T=o.canonical.y*i.ai;for(let C=0;C<u.length;C++){const{key:z,crossTileID:V,tileAnchorX:$,tileAnchorY:K}=u.get(C),ee=Math.floor((w+$)*Pi),te=Math.floor((T+K)*Pi);this.index.add(ee,te),this.keys.push(z),this.crossTileIDs.push(V)}this.index.finish()}findMatches(o,u,_){const w=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),T=Pi/Math.pow(2,u.canonical.z-this.tileID.canonical.z),C=u.canonical.x*i.ai,z=u.canonical.y*i.ai;for(let V=0;V<o.length;V++){const $=o.get(V);if($.crossTileID)continue;const{key:K,tileAnchorX:ee,tileAnchorY:te}=$,ce=Math.floor((C+ee)*T),Te=Math.floor((z+te)*T),ve=this.index.range(ce-w,Te-w,ce+w,Te+w);for(const Ce of ve){const Pe=this.crossTileIDs[Ce];if(this.keys[Ce]===K&&!_.has(Pe)){_.add(Pe),$.crossTileID=Pe;break}}}}}class Ss{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class As{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const u=Math.round((o-this.lng)/360);if(u!==0)for(const _ in this.indexes){const w=this.indexes[_],T={};for(const C in w){const z=w[C];z.tileID=z.tileID.unwrapTo(z.tileID.wrap+u),T[z.tileID.key]=z}this.indexes[_]=T}this.lng=o}addBucket(o,u,_){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let T=0;T<u.symbolInstances.length;T++)u.symbolInstances.get(T).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]=new Set);const w=this.usedCrossTileIDs[o.overscaledZ];for(const T in this.indexes){const C=this.indexes[T];if(Number(T)>o.overscaledZ)for(const z in C){const V=C[z];V.tileID.isChildOf(o)&&V.findMatches(u.symbolInstances,o,w)}else{const z=C[o.scaledTo(Number(T)).key];z&&z.findMatches(u.symbolInstances,o,w)}}for(let T=0;T<u.symbolInstances.length;T++){const C=u.symbolInstances.get(T);C.crossTileID||(C.crossTileID=_.generate(),w.add(C.crossTileID))}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new pa(o,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(o,u){for(const _ of u.crossTileIDs)this.usedCrossTileIDs[o].delete(_)}removeStaleBuckets(o){let u=!1;for(const _ in this.indexes){const w=this.indexes[_];for(const T in w)o[w[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,w[T]),delete w[T],u=!0)}return u}}class Xs{constructor(){this.layerIndexes={},this.crossTileIDs=new Ss,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,u,_,w){let T=this.layerIndexes[o.fqid];T===void 0&&(T=this.layerIndexes[o.fqid]=new As);let C=!1;const z={};w.name!=="globe"&&T.handleWrapJump(_);for(const V of u){const $=V.getBucket(o);$&&o.fqid===$.layerIds[0]&&($.bucketInstanceId||($.bucketInstanceId=++this.maxBucketInstanceId),T.addBucket(V.tileID,$,this.crossTileIDs)&&(C=!0),z[$.bucketInstanceId]=!0)}return T.removeStaleBuckets(z)&&(C=!0),C}pruneUnusedLayers(o){const u={};o.forEach(_=>{u[_]=!0});for(const _ in this.layerIndexes)u[_]||delete this.layerIndexes[_]}}const Ja=771;class Mr{constructor(o,u,_,w){this.blendFunction=o,this.blendColor=u,this.mask=_,this.blendEquation=w}}Mr.Replace=[1,0,1,0],Mr.disabled=new Mr(Mr.Replace,i.al.transparent,[!1,!1,!1,!1]),Mr.unblended=new Mr(Mr.Replace,i.al.transparent,[!0,!0,!0,!0]),Mr.alphaBlended=new Mr([1,Ja,1,Ja],i.al.transparent,[!0,!0,!0,!0]),Mr.alphaBlendedNonPremultiplied=new Mr([770,Ja,770,Ja],i.al.transparent,[!0,!0,!0,!0]),Mr.multiply=new Mr([774,0,774,0],i.al.transparent,[!0,!0,!0,!0]);class sr{constructor(o,u,_){this.func=o,this.mask=u,this.range=_}}sr.ReadOnly=!1,sr.ReadWrite=!0,sr.disabled=new sr(519,sr.ReadOnly,[0,1]);const ul=7680;class Sr{constructor(o,u,_,w,T,C){this.test=o,this.ref=u,this.mask=_,this.fail=w,this.depthFail=T,this.pass=C}}Sr.disabled=new Sr({func:519,mask:0},0,0,ul,ul,ul);const dc=1029,Gl=2305;class br{constructor(o,u,_){this.enable=o,this.mode=u,this.frontFace=_}}function nf(y,o){const u=i.bG(y,3);i.ad.mat4.fromQuat(y,o),i.bI(y,3,u)}function Wl(y,o){const u=i.ad.quat.identity([]);return i.ad.quat.rotateZ(u,u,-o),i.ad.quat.rotateX(u,u,-y),u}function cu(y,o){const u=[y[0],y[1],0],_=[o[0],o[1],0];if(i.ad.vec3.length(u)>=1e-15){const C=i.ad.vec3.normalize([],u);i.ad.vec3.scale(_,C,i.ad.vec3.dot(_,C)),o[0]=_[0],o[1]=_[1]}const w=i.ad.vec3.cross([],o,y);if(i.ad.vec3.len(w)<1e-15)return null;const T=Math.atan2(-w[1],w[0]);return Wl(Math.atan2(Math.sqrt(y[0]*y[0]+y[1]*y[1]),-y[2]),T)}br.disabled=new br(!1,dc,Gl),br.backCCW=new br(!0,dc,Gl),br.backCW=new br(!0,dc,2304),br.frontCW=new br(!0,1028,2304),br.frontCCW=new br(!0,1028,Gl);class wh{constructor(o,u){this.position=o,this.orientation=u}get position(){return this._position}set position(o){if(o){const u=o instanceof i.ac?o:new i.ac(o[0],o[1],o[2]);this._renderWorldCopies&&(u.x=i.bF(u.x,0,1)),this._position=u}else this._position=null}lookAtPoint(o,u){if(this.orientation=null,!this.position)return;const _=this.position,w=this._elevation?this._elevation.getAtPointOrZero(i.ac.fromLngLat(o)):0,T=i.ac.fromLngLat(o,w),C=[T.x-_.x,T.y-_.y,T.z-_.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=cu(C,u)}setPitchBearing(o,u){this.orientation=Wl(i.ak(o),i.ak(-u))}}class Ts{constructor(o,u){this._transform=i.ad.mat4.identity([]),this.orientation=u,this.position=o}get mercatorPosition(){const o=this.position;return new i.ac(o[0],o[1],o[2])}get position(){const o=i.bG(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var u;o&&i.bI(this._transform,3,[(u=o)[0],u[1],u[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||i.ad.quat.identity([]),o&&nf(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,u){this._orientation=Wl(o,u),nf(this._transform,this._orientation)}forward(){const o=i.bG(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=i.bG(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=i.bG(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,u){const _=new Float64Array(16);return i.ad.mat4.invert(_,this.getWorldToCamera(o,u)),_}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(o,u,_){const w=this.position;i.ad.vec3.scale(w,w,-o);const T=new Float64Array(16);return i.ad.mat4.fromScaling(T,[_,_,_]),i.ad.mat4.translate(T,T,w),T[10]*=u,T}getWorldToCamera(o,u){const _=new Float64Array(16),w=new Float64Array(4),T=this.position;return i.ad.quat.conjugate(w,this._orientation),i.ad.vec3.scale(T,T,-o),i.ad.mat4.fromQuat(_,w),i.ad.mat4.translate(_,_,T),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=u,_[9]*=u,_[10]*=u,_[11]*=u,_}getCameraToClipPerspective(o,u,_,w){const T=new Float64Array(16);return i.ad.mat4.perspective(T,o,u,_,w),T}getCameraToClipOrthographic(o,u,_,w,T,C){const z=new Float64Array(16);return i.ad.mat4.ortho(z,o,u,_,w,T,C),z}getDistanceToElevation(o,u=!1){const _=o===0?0:i.bH(o,u?i.aT(this.position[1]):this.position[1]),w=this.forward();return(_-this.position[2])/w[2]}clone(){return new Ts([...this.position],[...this.orientation])}}const ya={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class uu{constructor(o=0,u=0,_=0,w=0){if(isNaN(o)||o<0||isNaN(u)||u<0||isNaN(_)||_<0||isNaN(w)||w<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=u,this.left=_,this.right=w}interpolate(o,u,_){return u.top!=null&&o.top!=null&&(this.top=i.ah(o.top,u.top,_)),u.bottom!=null&&o.bottom!=null&&(this.bottom=i.ah(o.bottom,u.bottom,_)),u.left!=null&&o.left!=null&&(this.left=i.ah(o.left,u.left,_)),u.right!=null&&o.right!=null&&(this.right=i.ah(o.right,u.right,_)),this}getCenter(o,u){const _=i.ay((this.left+o-this.right)/2,0,o),w=i.ay((this.top+u-this.bottom)/2,0,u);return new i.P(_,w)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new uu(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const On=15;class Sh{constructor(o,u,_,w,T,C,z){this.tileSize=512,this._renderWorldCopies=T===void 0||T,this._minZoom=o||0,this._maxZoom=u||22,this._minPitch=_??0,this._maxPitch=w??60,this.setProjection(C),this.setMaxBounds(z),this.width=0,this.height=0,this._center=new i.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new uu,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Ts,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const o=new Sh(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.mercatorFromTransition=this.mercatorFromTransition,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o.frustumCorners=this.frustumCorners,o._allowWorldUnderZoom=this._allowWorldUnderZoom,o}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<On}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(o,u=!1){const _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||_)&&this._updateCameraOnTerrain(),(o||_)&&this._constrainCamera(u),this._calcMatrices()}getProjection(){return i.aA(this.projection,["name","center","parallels"])}setProjection(o){this.projectionOptions=o||{name:"mercator"};const u=this.projection?this.getProjection():void 0;this.projection=i.bP(this.projectionOptions);const _=this.getProjection(),w=!i.bn(u,_);return w&&this._calcMatrices(),this.mercatorFromTransition=!1,w}setOrthographicProjectionAtLowPitch(o){return this._orthographicProjectionAtLowPitch!==o&&(this._orthographicProjectionAtLowPitch=o,this._calcMatrices(),!0)}setMercatorFromTransition(){const o=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.bP({name:"mercator"});const u=o!==this.projection.name;return u&&this._calcMatrices(),u}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.bF(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){const u=-o*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=i.ad.mat2.create(),i.ad.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const u=i.ay(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=i.ak(o),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const o=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/o)}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){const u=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(o){this._tileCoverLift!==o&&(this._tileCoverLift=o)}_updateCameraOnTerrain(){const o=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,u=this.elevation&&o===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||o===Number.NEGATIVE_INFINITY&&(!u||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const _=this._elevation;u||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&_.exaggeration()&&this._centerAltitudeValidForExaggeration!==_.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*_.exaggeration(),this._centerAltitudeValidForExaggeration=_.exaggeration()):(this._centerAltitude=o||0,this._centerAltitudeValidForExaggeration=_.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let w=0,T=0;for(let C=0;C<u.length;C++){const z=new i.P(u[C][0]*this.width,_+u[C][1]*(this.height-_)),V=o.pointCoordinate(z);if(!V)continue;const $=1/Math.hypot(V[0]-this._camera.position[0],V[1]-this._camera.position[1]);w+=V[3]*$,T+=$}return T===0?NaN:w/T}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const o=this._seaLevelZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*u,w=this._mercatorZfromZoom(o),T=this._mercatorZfromZoom(this._maxZoom),C=Math.max(w-_,T);this._setZoom(this._zoomFromMercatorZ(C))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){const u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let _;_=o.z<this._camera.position[2]?[u.x,u.y,u.z]:[o.x,o.y,o.z];const w=i.ad.vec3.length(i.ad.vec3.sub([],this._camera.position,_));return i.ay(this._zoomFromMercatorZ(w),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let u=!1;if(o.orientation&&!i.ad.quat.exactEquals(o.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(o.orientation)),o.position){const _=[o.position.x,o.position.y,o.position.z];i.ad.vec3.exactEquals(_,this._camera.position)||(this._setCameraPosition(_),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,u=new wh;return u.position=new i.ac(o[0],o[1],o[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(o){if(!i.ad.quat.length(o))return!1;i.ad.quat.normalize(o,o);const u=i.ad.vec3.transformQuat([],[0,0,-1],o),_=i.ad.vec3.transformQuat([],[0,-1,0],o);if(_[2]<0)return!1;const w=cu(u,_);return!!w&&(this._camera.orientation=w,!0)}_setCameraPosition(o){const u=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,w=this.cameraToCenterDistance;o[2]=i.ay(o[2],w/_,w/u),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,u,_){this._unmodified=!1,this._edgeInsets.interpolate(o,u,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const u=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(o){const u=[new i.bQ(0,o)];if(this.renderWorldCopies){const _=this.pointCoordinate(new i.P(0,0)),w=this.pointCoordinate(new i.P(this.width,0)),T=this.pointCoordinate(new i.P(this.width,this.height)),C=this.pointCoordinate(new i.P(0,this.height)),z=Math.floor(Math.min(_.x,w.x,T.x,C.x)),V=Math.floor(Math.max(_.x,w.x,T.x,C.x)),$=1;for(let K=z-$;K<=V+$;K++)K!==0&&u.push(new i.bQ(K,o))}return u}isLODDisabled(o){return(!o||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(o,u,_){let w=[];const T=_!==void 0,C=!T;if(C&&this.zoom<u||T&&_[0]===0&&_[1]===0)return w;const z=new Set,V=(K,ee,te,ce,Te)=>{const ve=i.c5(ee,K,te,ce,Te);z.has(ve)||(w.push(new i.aH(K,ee,te,ce,Te)),z.add(ve))};for(let K=0;K<o.length;K++){const ee=o[K];if(C&&ee.canonical.z!==u)continue;const te=ee.canonical,ce=ee.overscaledZ,Te=ee.wrap,ve=1<<te.z,Ce=te.x+1<ve,Pe=te.x>0,qe=te.y+1<ve,Je=te.y>0,Ye=ee.wrap-(Pe?0:1),lt=ee.wrap+(Ce?0:1),nt=Pe?te.x-1:ve-1,rt=Ce?te.x+1:0;if(T)_[0]<0?(V(ce,lt,te.z,rt,te.y),_[1]<0&&qe&&(V(ce,Te,te.z,te.x,te.y+1),V(ce,lt,te.z,rt,te.y+1)),_[1]>0&&Je&&(V(ce,Te,te.z,te.x,te.y-1),V(ce,lt,te.z,rt,te.y-1))):_[0]>0?(V(ce,Ye,te.z,nt,te.y),_[1]<0&&qe&&(V(ce,Te,te.z,te.x,te.y+1),V(ce,Ye,te.z,nt,te.y+1)),_[1]>0&&Je&&(V(ce,Te,te.z,te.x,te.y-1),V(ce,Ye,te.z,nt,te.y-1))):_[1]<0&&qe?V(ce,Te,te.z,te.x,te.y+1):Je&&V(ce,Te,te.z,te.x,te.y-1);else{const it=ee.visibleQuadrants;1&it&&(V(ce,Ye,te.z,nt,te.y),Je&&(V(ce,Te,te.z,te.x,te.y-1),V(ce,Ye,te.z,nt,te.y-1))),2&it&&(V(ce,lt,te.z,rt,te.y),Je&&(V(ce,Te,te.z,te.x,te.y-1),V(ce,lt,te.z,rt,te.y-1))),4&it&&(V(ce,Ye,te.z,nt,te.y),qe&&(V(ce,Te,te.z,te.x,te.y+1),V(ce,Ye,te.z,nt,te.y+1))),8&it&&(V(ce,lt,te.z,rt,te.y),qe&&(V(ce,Te,te.z,te.x,te.y+1),V(ce,lt,te.z,rt,te.y+1)))}}const $=[];for(const K of w)w.some(ee=>K.isChildOf(ee))||$.push(K);if(w=$.filter(K=>!o.some(ee=>!!(K.overscaledZ<u&&ee.isChildOf(K))||K.equals(ee)||K.isChildOf(ee))),C){const K=1<<u,ee=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),te=[K*ee.x,K*ee.y],ce=4,Te=ce*ce;w=w.filter(ve=>{const Ce=ve.canonical.x+.5-te[0],Pe=ve.canonical.y+.5-te[1];return Ce*Ce+Pe*Pe<Te})}return w}coveringTiles(o){let u=this.coveringZoomLevel(o);const _=u,w=this.elevation&&this.elevation.exaggeration(),T=w&&!o.isTerrainDEM,C=this.projection.name==="mercator";if(o.minzoom!==void 0&&u<o.minzoom)return[];o.maxzoom!==void 0&&u>o.maxzoom&&(u=o.maxzoom);const z=this.locationCoordinate(this.center),V=this.center.lat,$=1<<u,K=[$*z.x,$*z.y,0],ee=this.projection.name==="globe",te=!ee,ce=i.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,te),Te=ee?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ve=$*i.bH(1,this.center.lat),Ce=this._camera.position[2]/i.bH(1,this.center.lat),Pe=[$*Te.x,$*Te.y,Ce*(te?1:ve)],qe=ee||w,Je=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),Ye=this.isLODDisabled(!0)?u:0;let lt;if(this._elevation&&o.isTerrainDEM)lt=1e4*this._elevation.exaggeration();else if(this._elevation){const Pt=this._elevation.getMinMaxForVisibleTiles();lt=Pt?Pt.max:this._centerAltitude}else lt=this._centerAltitude;const nt=o.isTerrainDEM?-lt:this._elevation?this._elevation.getMinElevationBelowMSL():0,rt=this.projection.isReprojectedInTileSpace?i.bS(this):1,it=Pt=>{const Qt=new i.ac(Pt.x+25e-6,Pt.y,Pt.z),fn=new i.ac(Pt.x,Pt.y+25e-6,Pt.z),Wt=Pt.toLngLat(),mn=Qt.toLngLat(),zn=fn.toLngLat(),Bn=this.locationCoordinate(Wt),In=this.locationCoordinate(mn),or=this.locationCoordinate(zn),Br=Math.hypot(In.x-Bn.x,In.y-Bn.y),mr=Math.hypot(or.x-Bn.x,or.y-Bn.y);return Math.sqrt(Br*mr)*rt/25e-6},dt=Pt=>{const sn=lt,Qt=nt;return{aabb:i.bV(this,$,0,0,0,Pt,Qt,sn,this.projection),zoom:0,x:0,y:0,minZ:Qt,maxZ:sn,wrap:Pt,fullyVisible:!1}},xt=[];let Xt=[];const zt=u,tn=o.reparseOverscaled?_:u,un=(Ce-this._centerAltitude)*ve,Tn=Pt=>{if(!this._elevation||!Pt.tileID||!C)return;const sn=this._elevation.getMinMaxForTile(Pt.tileID),Qt=Pt.aabb;sn?(Qt.min[2]=sn.min,Qt.max[2]=sn.max,Qt.center[2]=(Qt.min[2]+Qt.max[2])/2):(Pt.shouldSplit=an(Pt),Pt.shouldSplit||(Qt.min[2]=Qt.max[2]=Qt.center[2]=this._centerAltitude))},Lt=(Pt,sn)=>{if(.707*sn<Pt)return 1;const Qt=sn/Pt;return Qt/(1.4144271570014144+(Math.pow(1.1,Qt-1.4144271570014144+1)-1)/(1.1-1)-1)},an=Pt=>{if(Pt.zoom<Ye)return!0;if(Pt.zoom===zt)return!1;if(Pt.shouldSplit!=null)return Pt.shouldSplit;const sn=Pt.aabb.distanceX(Pe),Qt=Pt.aabb.distanceY(Pe);let fn=un,Wt=1;if(ee){fn=Pt.aabb.distanceZ(Pe);const mr=Math.pow(2,Pt.zoom),Dr=i.aT((Pt.y+1)/mr),Er=i.aT(Pt.y/mr),Cr=Math.min(Math.max(V,Dr),Er),jr=i.ca(Cr)/i.ca(V);if(Wt=Cr===V?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,jr/this._mercatorScaleRatio),this.zoom<=i.c6&&Pt.zoom===zt-1&&jr>=.9)return!0}else if(T&&(fn=Pt.aabb.distanceZ(Pe)*ve),this.projection.isReprojectedInTileSpace&&_<=5){const mr=Math.pow(2,Pt.zoom),Dr=it(new i.ac((Pt.x+.5)/mr,(Pt.y+.5)/mr));Wt=Dr>.85?1:Dr}if(!C){const mr=Math.sqrt(sn*sn+Qt*Qt+fn*fn);let Dr=(1<<zt-Pt.zoom)*Je*Wt;return Dr*=Lt(Math.max(fn,un),mr),mr<Dr}let mn=Number.MAX_VALUE,zn=0;const Bn=Pt.aabb.getCorners(),In=[];for(const mr of Bn){i.ad.vec3.sub(In,mr,Pe),ee||(T?In[2]*=ve:In[2]=un);const Dr=i.ad.vec3.dot(In,this._camera.forward());Dr<mn&&(mn=Dr,zn=Math.abs(In[2]))}let or=(1<<zt-Pt.zoom)*Je*Wt;if(or*=Lt(Math.max(zn,un),mn),mn<or)return!0;const Br=Pt.aabb.closestPoint(K);return Br[0]===K[0]&&Br[1]===K[1]};if(this.renderWorldCopies)for(let Pt=1;Pt<=3;Pt++)xt.push(dt(-Pt)),xt.push(dt(Pt));for(xt.push(dt(0));xt.length>0;){const Pt=xt.pop(),sn=Pt.x,Qt=Pt.y;let fn=Pt.fullyVisible;const Wt=()=>this.projection.name==="globe"&&(Pt.y===0||Pt.y===(1<<Pt.zoom)-1);if(!fn){let mn=qe?Pt.aabb.intersects(ce):Pt.aabb.intersectsFlat(ce);if(mn===0&&Wt()){const zn=new i.bT(Pt.zoom,sn,Qt);mn=i.bU(this,$,zn,!0).intersects(ce)}if(mn===0)continue;fn=mn===2}if(Pt.zoom!==zt&&an(Pt))for(let mn=0;mn<4;mn++){const zn=(sn<<1)+mn%2,Bn=(Qt<<1)+(mn>>1),In={aabb:C?Pt.aabb.quadrant(mn):i.bV(this,$,Pt.zoom+1,zn,Bn,Pt.wrap,Pt.minZ,Pt.maxZ,this.projection),zoom:Pt.zoom+1,x:zn,y:Bn,wrap:Pt.wrap,fullyVisible:fn,tileID:void 0,shouldSplit:void 0,minZ:Pt.minZ,maxZ:Pt.maxZ};T&&!ee&&(In.tileID=new i.aH(Pt.zoom+1===zt?tn:Pt.zoom+1,Pt.wrap,Pt.zoom+1,zn,Bn),Tn(In)),xt.push(In)}else{const mn=Pt.zoom===zt?tn:Pt.zoom;if(o.minzoom&&o.minzoom>mn)continue;let zn=0;if(!fn){let Br=qe?Pt.aabb.intersectsPrecise(ce):Pt.aabb.intersectsPreciseFlat(ce);if(Br===0&&Wt()){const mr=new i.bT(Pt.zoom,sn,Qt);Br=i.bU(this,$,mr,!0).intersectsPrecise(ce)}if(Br===0)continue;if(o.calculateQuadrantVisibility)if(ce.containsPoint(Pt.aabb.center))zn=15;else for(let mr=0;mr<4;mr++)Pt.aabb.quadrant(mr).intersects(ce)!==0&&(zn|=1<<mr)}const Bn=K[0]-(.5+sn+(Pt.wrap<<Pt.zoom))*(1<<u-Pt.zoom),In=K[1]-.5-Qt,or=Pt.tileID?Pt.tileID:new i.aH(mn,Pt.wrap,Pt.zoom,sn,Qt);o.calculateQuadrantVisibility&&(or.visibleQuadrants=zn),Xt.push({tileID:or,distanceSq:Bn*Bn+In*In})}}if(this.fogCullDistSq){const Pt=this.fogCullDistSq,sn=this.horizonLineFromTop();Xt=Xt.filter(Qt=>{const fn=[0,0,0,1],Wt=[i.ai,i.ai,0,1],mn=this.calculateFogTileMatrix(Qt.tileID.toUnwrapped());i.ad.vec4.transformMat4(fn,fn,mn),i.ad.vec4.transformMat4(Wt,Wt,mn);const zn=i.ad.vec4.min([],fn,Wt),Bn=i.ad.vec4.max([],fn,Wt),In=i.bW(zn,Bn);if(In===0)return!0;let or=!1;const Br=this._elevation;if(Br&&In>Pt&&sn!==0){const mr=this.calculateProjMatrix(Qt.tileID.toUnwrapped());let Dr;o.isTerrainDEM||(Dr=Br.getMinMaxForTile(Qt.tileID)),Dr||(Dr={min:nt,max:lt});const Er=i.c7(this.rotation),Cr=[Er[0]*i.ai,Er[1]*i.ai,Dr.max];i.ad.vec3.transformMat4(Cr,Cr,mr),or=(1-Cr[1])*this.height*.5<sn}return In<Pt||or})}return Xt.sort((Pt,sn)=>Pt.distanceSq-sn.distanceSq).map(Pt=>Pt.tileID)}resize(o,u){this.width=o,this.height=u,this.pixelsToGLUnits=[2/o,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const u=i.ay(o.lat,-i.bX,i.bX),_=this.projection.project(o.lng,u);return new i.P(_.x*this.worldSize,_.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(o,u){let _,w;const T=this.centerPoint;if(this.projection.name==="globe"){const z=this.worldSize;_=(u.x-T.x)/z,w=(u.y-T.y)/z}else{const z=this.pointCoordinate(u),V=this.pointCoordinate(T);_=z.x-V.x,w=z.y-V.y}const C=this.locationCoordinate(o);this.setLocation(new i.ac(C.x-_,C.y-w))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o,u){return this.projection.locationPoint(this,o,u)}locationPoint3D(o,u){return this.projection.locationPoint(this,o,u,!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o,u){return this.coordinateLocation(this.pointCoordinate3D(o,u))}locationCoordinate(o,u){const _=u?i.bH(u,o.lat):void 0,w=this.projection.project(o.lng,o.lat);return new i.ac(w.x,w.y,_)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,u){const _=u??this._centerAltitude,w=[o.x,o.y,0,1],T=[o.x,o.y,1,1];i.ad.vec4.transformMat4(w,w,this.pixelMatrixInverse),i.ad.vec4.transformMat4(T,T,this.pixelMatrixInverse);const C=T[3];i.ad.vec4.scale(w,w,1/w[3]),i.ad.vec4.scale(T,T,1/C);const z=w[2],V=T[2];return{p0:w,p1:T,t:z===V?0:(_-z)/(V-z)}}screenPointToMercatorRay(o){const u=[o.x,o.y,0,1],_=[o.x,o.y,1,1];return i.ad.vec4.transformMat4(u,u,this.pixelMatrixInverse),i.ad.vec4.transformMat4(_,_,this.pixelMatrixInverse),i.ad.vec4.scale(u,u,1/u[3]),i.ad.vec4.scale(_,_,1/_[3]),u[2]=i.bH(u[2],this._center.lat)*this.worldSize,_[2]=i.bH(_[2],this._center.lat)*this.worldSize,i.ad.vec4.scale(u,u,1/this.worldSize),i.ad.vec4.scale(_,_,1/this.worldSize),new i.as([u[0],u[1],u[2]],i.ad.vec3.normalize([],i.ad.vec3.sub([],_,u)))}rayIntersectionCoordinate(o){const{p0:u,p1:_,t:w}=o,T=i.bH(u[2],this._center.lat),C=i.bH(_[2],this._center.lat);return new i.ac(i.ah(u[0],_[0],w)/this.worldSize,i.ah(u[1],_[1],w)/this.worldSize,i.ah(T,C,w))}pointCoordinate(o,u=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,u)}pointCoordinate3D(o,u){if(!this.elevation)return this.pointCoordinate(o,u);let _=this.projection.pointCoordinate3D(this,o.x,o.y);if(_)return new i.ac(_[0],_[1],_[2]);let w=0,T=this.horizonLineFromTop();if(o.y>T)return this.pointCoordinate(o,u);const C=.02*T,z=o.clone();for(let V=0;V<10&&T-w>C;V++){z.y=i.ah(w,T,.66);const $=this.projection.pointCoordinate3D(this,z.x,z.y);$?(T=z.y,_=$):w=z.y}return _?new i.ac(_[0],_[1],_[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){return this.projection.isPointAboveHorizon(this,o)}isPointOnSurface(o){if(o.y<0||o.y>this.height||o.x<0||o.x>this.width)return!1;if(this.elevation||this.zoom>=i.bY)return!this.isPointAboveHorizon(o);const u=this.pointCoordinate(o);return u.y>=0&&u.y<=1}_coordinatePoint(o,u){const _=u&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,w=[o.x*this.worldSize,o.y*this.worldSize,_+o.toAltitude(),1];return i.ad.vec4.transformMat4(w,w,this.pixelMatrix),w[3]>0?new i.P(w[0]/w[3],w[1]/w[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:o,left:u}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,T=this.pointLocation3D(new i.P(u,o)),C=this.pointLocation3D(new i.P(w,o)),z=this.pointLocation3D(new i.P(w,_)),V=this.pointLocation3D(new i.P(u,_));let $=Math.min(T.lng,C.lng,z.lng,V.lng),K=Math.max(T.lng,C.lng,z.lng,V.lng),ee=Math.min(T.lat,C.lat,z.lat,V.lat),te=Math.max(T.lat,C.lat,z.lat,V.lat);const ce=Math.pow(2,-this.zoom)/16*270,Te=this.projection.name==="globe"?1:4,ve=(Ce,Pe,qe,Je,Ye)=>{const lt=(Ce+qe)/2,nt=(Pe+Je)/2,rt=new i.P(lt,nt),{lng:it,lat:dt}=this.pointLocation3D(rt),xt=Math.max(0,$-it,ee-dt,it-K,dt-te);$=Math.min($,it),K=Math.max(K,it),ee=Math.min(ee,dt),te=Math.max(te,dt),(Ye<Te||xt>ce)&&(ve(Ce,Pe,lt,nt,Ye+1),ve(lt,nt,qe,Je,Ye+1))};if(ve(u,o,w,o,1),ve(w,o,w,_,1),ve(w,_,u,_,1),ve(u,_,u,o,1),this.projection.name==="globe"){const[Ce,Pe]=i.bZ(this);Ce?(te=90,K=180,$=-180):Pe&&(ee=-90,K=180,$=-180)}return new i.aB(new i.bO($,ee),new i.bO(K,te))}_getBoundsRectangular(o,u){const{top:_,left:w}=this._edgeInsets,T=this.height-this._edgeInsets.bottom,C=this.width-this._edgeInsets.right,z=new i.P(w,_),V=new i.P(C,_),$=new i.P(C,T),K=new i.P(w,T);let ee=this.pointCoordinate(z,o),te=this.pointCoordinate(V,o);const ce=this.pointCoordinate($,u),Te=this.pointCoordinate(K,u),ve=(Ce,Pe)=>(Pe.y-Ce.y)/(Pe.x-Ce.x);return ee.y>1&&te.y>=0?ee=new i.ac((1-Te.y)/ve(Te,ee)+Te.x,1):ee.y<0&&te.y<=1&&(ee=new i.ac(-Te.y/ve(Te,ee)+Te.x,0)),te.y>1&&ee.y>=0?te=new i.ac((1-ce.y)/ve(ce,te)+ce.x,1):te.y<0&&ee.y<=1&&(te=new i.ac(-ce.y/ve(ce,te)+ce.x,0)),new i.aB().extend(this.coordinateLocation(ee)).extend(this.coordinateLocation(te)).extend(this.coordinateLocation(Te)).extend(this.coordinateLocation(ce))}_getBoundsRectangularTerrain(){const o=this.elevation;if(!o.visibleDemTiles.length||o.isUsingMockSource())return this._getBoundsRectangular(0,0);const u=o.visibleDemTiles.reduce((_,w)=>{if(w.dem){const T=w.dem.tree;_.min=Math.min(_.min,T.minimums[0]),_.max=Math.max(_.max,T.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(u.min*o.exaggeration(),u.max*o.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(o=!0){const u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,_=this.height/2-u*(1-this._horizonShift);return o?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-i.bX,this.maxLat=i.bX,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.av(this.minLng)*this.tileSize,this.worldMaxX=i.av(this.maxLng)*this.tileSize,this.worldMinY=i.aC(this.maxLat)*this.tileSize,this.worldMaxY=i.aC(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,u){return this.projection.createTileMatrix(this,u,o)}calculateDistanceTileData(o){const u=o.key,_=this._distanceTileDataCache;if(_[u])return _[u];const w=o.canonical,T=1/this.height,C=this.cameraWorldSize,z=C/this.zoomScale(w.z),V=(w.x+Math.pow(2,w.z)*o.wrap)*z,$=w.y*z,K=this.point;K.x*=C/this.worldSize,K.y*=C/this.worldSize;const ee=this.angle,te=Math.sin(-ee),ce=-Math.cos(-ee);return _[u]={bearing:[te,ce],center:[(K.x-V)*T,(K.y-$)*T],scale:z/i.ai*T},_[u]}calculateFogTileMatrix(o){const u=o.key,_=this._fogTileMatrixCache;if(_[u])return _[u];const w=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,o);return i.ad.mat4.multiply(w,this.worldToFogMatrix,w),_[u]=new Float32Array(w),_[u]}calculateProjMatrix(o,u=!1,_=!1){const w=o.key;let T;if(T=_?this._expandedProjMatrixCache:u?this._alignedProjMatrixCache:this._projMatrixCache,T[w])return T[w];const C=this.calculatePosMatrix(o,this.worldSize);let z;return z=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:_?this.expandedFarZProjMatrix:u?this.alignedProjMatrix:this.projMatrix,i.ad.mat4.multiply(C,z,C),T[w]=new Float32Array(C),T[w]}calculatePixelsToTileUnitsMatrix(o){const u=o.tileID.key,_=this._pixelsToTileUnitsCache;if(_[u])return _[u];const w=i.b_(o,this);return _[u]=w,_[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const o=1/this.worldSize,u=i.ad.mat4.fromScaling([],[o,o,o]);return i.ad.mat4.multiply(u,u,this.globeMatrix),u}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const o=this._elevation;this._updateCameraState();const u=i.bH(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(u),w=this._camera.forward(),T=i.bH(1,this._center.lat);_[2]/=T,w[2]/=T,i.ad.vec3.normalize(w,w);const C=o.raycast(_,w,o.exaggeration());if(C){const z=i.ad.vec3.scaleAndAdd([],_,w,C),V=new i.ac(z[0],z[1],i.bH(z[2],i.aT(z[1]))),$=(V.z+i.ad.vec3.length([V.x-_[0],V.y-_[1],V.z-_[2]*T]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ($),this._centerAltitude=V.toAltitude(),this._center=this.coordinateLocation(V),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(o=!1){if(!this._elevation)return;const u=this._elevation,_=i.bH(1,this._center.lat)*this.worldSize,w=this._computeCameraPosition(_),T=u.getAtPointOrZero(new i.ac(...w)),C=this.pixelsPerMeter/this.worldSize*T,z=this._minimumHeightOverTerrain(),V=w[2]-C;if(V<=z)if(V<0||o){const $=this.locationCoordinate(this._center,this._centerAltitude),K=[w[0],w[1],$.z-w[2]],ee=i.ad.vec3.length(K);K[2]-=(z-V)/this._pixelsPerMercatorPixel;const te=i.ad.vec3.length(K);if(te===0)return;i.ad.vec3.scale(K,K,ee/te*this._pixelsPerMercatorPixel),this._camera.position=[w[0],w[1],$.z*this._pixelsPerMercatorPixel-K[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||o){const te=this.center;return te.lat=i.ay(te.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!o)&&(te.lng=i.ay(te.lng,this.minLng,this.maxLng)),this.center=te,void(this._constraining=!1)}const u=this._unmodified,{x:_,y:w}=this.point;let T=0,C=_,z=w;const V=this.width/2,$=this.height/2,K=this.worldMinY*this.scale,ee=this.worldMaxY*this.scale;if(w-$<K&&(z=K+$),w+$>ee&&(z=ee-$),ee-K<this.height&&(T=Math.max(T,this.height/(ee-K)),z=(ee+K)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const te=this.worldMinX*this.scale,ce=this.worldMaxX*this.scale,Te=this.worldSize/2-(te+ce)/2;C=(_+Te+this.worldSize)%this.worldSize-Te,C-V<te&&(C=te+V),C+V>ce&&(C=ce-V),ce-te<this.width&&(T=Math.max(T,this.width/(ce-te)),C=(ce+te)/2)}C===_&&z===w||this._allowWorldUnderZoom||(this.center=this.unproject(new i.P(C,z))),T&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(T)),this._constrainCamera(),this._unmodified=u,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,u=this.projection.name==="globe",_=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.bH(1,this.center.lat)/i.bH(1,i.c8));const w=i.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,w),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const T=this.projection.zAxisUnit==="meters"?_:1,C=this._camera.getWorldToCamera(this.worldSize,T);let z;const V=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(V[8]=2*-o.x/this.width,V[9]=2*o.y/this.height,this.isOrthographic){let dt=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),xt=dt*this.aspect,Xt=-xt,zt=-dt;xt-=o.x,Xt-=o.x,dt+=o.y,zt+=o.y,z=this._camera.getCameraToClipOrthographic(Xt,xt,zt,dt,this._nearZ,this._farZ),((tn,un,Tn,Lt)=>{for(let an=0;an<16;an++)tn[an]=i.ah(un[an],Tn[an],Lt)})(z,z,V,i.c9(this.pitch>=On?1:this.pitch/On))}else z=V;const $=i.ad.mat4.mul([],V,C);let K=i.ad.mat4.mul([],z,C);if(this.projection.isReprojectedInTileSpace){const dt=this.locationCoordinate(this.center),xt=i.ad.mat4.identity([]);i.ad.mat4.translate(xt,xt,[dt.x*this.worldSize,dt.y*this.worldSize,0]),i.ad.mat4.multiply(xt,xt,i.c0(this)),i.ad.mat4.translate(xt,xt,[-dt.x*this.worldSize,-dt.y*this.worldSize,0]),i.ad.mat4.multiply(K,K,xt),i.ad.mat4.multiply($,$,xt),this.inverseAdjustmentMatrix=i.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.ad.mat4.scale([],K,[this.worldSize,this.worldSize,this.worldSize/T,1]),this.projMatrix=K,this.invProjMatrix=i.ad.mat4.invert(new Float64Array(16),this.projMatrix),u){const dt=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);dt[8]=2*-o.x/this.width,dt[9]=2*o.y/this.height,this.expandedFarZProjMatrix=i.ad.mat4.mul([],dt,C)}else this.expandedFarZProjMatrix=this.projMatrix;const ee=i.ad.mat4.invert([],z);this.frustumCorners=i.c2.fromInvProjectionMatrix(ee,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!u);const te=new Float32Array(16);i.ad.mat4.identity(te),i.ad.mat4.scale(te,te,[1,-1,1]),i.ad.mat4.rotateX(te,te,this._pitch),i.ad.mat4.rotateZ(te,te,this.angle);const ce=i.ad.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.ad.mat4.clone(ce);const Te=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;ce[8]=2*-o.x/this.width,ce[9]=2*(o.y+Te)/this.height,this.skyboxMatrix=i.ad.mat4.multiply(te,ce,te);const ve=this.point,Ce=ve.x,Pe=ve.y,qe=this.width%2/2,Je=this.height%2/2,Ye=Math.cos(this.angle),lt=Math.sin(this.angle),nt=Ce-Math.round(Ce)+Ye*qe+lt*Je,rt=Pe-Math.round(Pe)+Ye*Je+lt*qe,it=new Float64Array(K);if(i.ad.mat4.translate(it,it,[nt>.5?nt-1:nt,rt>.5?rt-1:rt,0]),this.alignedProjMatrix=it,K=i.ad.mat4.create(),i.ad.mat4.scale(K,K,[this.width/2,-this.height/2,1]),i.ad.mat4.translate(K,K,[1,-1,0]),this.labelPlaneMatrix=K,K=i.ad.mat4.create(),i.ad.mat4.scale(K,K,[1,-1,1]),i.ad.mat4.translate(K,K,[-1,-1,0]),i.ad.mat4.scale(K,K,[2/this.width,2/this.height,1]),this.glCoordMatrix=K,this.pixelMatrix=i.ad.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,$),this._calcFogMatrices(),this._distanceTileDataCache={},K=i.ad.mat4.invert(new Float64Array(16),this.pixelMatrix),!K)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=K,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.c3(this);const dt=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.ad.vec3.transformMat4(dt,dt,C),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=K;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSizeForFog,u=this.cameraPixelsPerMeter,_=this._camera.position,w=1/this.height/this._pixelsPerMercatorPixel,T=[o,o,u];i.ad.vec3.scale(T,T,w),i.ad.vec3.scale(_,_,-1),i.ad.vec3.multiply(_,_,T);const C=i.ad.mat4.create();i.ad.mat4.translate(C,C,_),i.ad.mat4.scale(C,C,T),this.mercatorFogMatrix=C,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,u,w)}_computeCameraPosition(o){const u=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),w=this.point,T=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*u-o/this.worldSize*this._centerAltitude;return[w.x/this.worldSize-_[0]*T,w.y/this.worldSize-_[1]*T,o/this.worldSize*this._centerAltitude-_[2]*T]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){const u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],w=o[2];let T=1;this.projection.wrap&&(this.center=this.center.wrap()),w>0&&(T=Math.min((u-_)/w,1)),this._camera.position=i.ad.vec3.scaleAndAdd([],this._camera.position,o,T),this._updateStateFromCamera()}_updateStateFromCamera(){const o=this._camera.position,u=this._camera.forward(),{pitch:_,bearing:w}=this._camera.getPitchBearing(),T=i.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,C=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.ak(this._maxPitch)),z=Math.max((o[2]-T)/Math.cos(_),C),V=this._zoomFromMercatorZ(z);i.ad.vec3.scaleAndAdd(o,o,u,z),this._pitch=i.ay(_,i.ak(this.minPitch),i.ak(this.maxPitch)),this.angle=i.bF(w,-Math.PI,Math.PI),this._setZoom(i.ay(V,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.ac(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(o*this.tileSize))}zoomFromMercatorZAdjusted(o){let u=0,_=i.bY,w=0,T=1/0;for(;_-u>1e-6&&_>u;){const C=u+.5*(_-u),z=this.tileSize*Math.pow(2,C),V=this.getCameraToCenterDistance(this.projection,C,z),$=this.scaleZoom(V/(o*this.tileSize)),K=Math.abs(C-$);K<T&&(T=K,w=C),C<$?u=C:_=C}return w}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(o,u){const _=Math.min(o.x,u.x),w=Math.max(o.x,u.x),T=Math.min(o.y,u.y),C=Math.max(o.y,u.y);if(T<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const z=[new i.P(_,T),new i.P(w,C),new i.P(_,C),new i.P(w,T)],V=this.renderWorldCopies?-3:0,$=this.renderWorldCopies?4:1;for(const K of z){const ee=this.pointRayIntersection(K);if(ee.t<0)return!0;const te=this.rayIntersectionCoordinate(ee);if(te.x<V||te.y<0||te.x>$||te.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(o,u){const _=i.ad.vec3.length(i.ad.vec3.sub([],this._camera.position,o)),w=this._zoomFromMercatorZ(_)+u;return _-this._mercatorZfromZoom(w)}getCameraPoint(){if(this.projection.name==="globe"){const o=function([u,_,w],T){const C=[u,_,w,1];i.ad.vec4.transformMat4(C,C,T);const z=C[3]=Math.max(C[3],1e-6);return C[0]/=z,C[1]/=z,C[2]/=z,C}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(o[0],o[1])}{const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,o))}}getCameraToCenterDistance(o,u=this.zoom,_=this.worldSize){const w=i.b$(o,u,this.width,this.height,1024),T=o.pixelSpaceConversion(this.center.lat,_,w);let C=.5/Math.tan(.5*this._fov)*this.height*T;return this.isOrthographic&&(C=i.ah(1,C,i.c9(this.pitch>=On?1:this.pitch/On))),C}getWorldToCameraMatrix(){const o=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.ad.mat4.multiply(o,o,this.globeMatrix),o}getFrustum(o){return i.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,this.projection.zAxisUnit==="meters")}}const Vs=(y,o)=>{if(o>0&&y.terrain&&i.w("Cutoff is currently disabled on terrain"),o<=0||y.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const u=y.transform,_=Math.max(Math.abs(u._zoom-(y.minCutoffZoom-1)),1),w=u.isLODDisabled(!1)?i.ae(60,45,u.pitch):i.ae(30,15,u.pitch),T=u._farZ-u._nearZ,C=o*u.height,z=((1-(V=w))*u.cameraToCenterDistance+V*(u._farZ+C))*_;var V;return{shouldRenderCutoff:w<1,uniformValues:{u_cutoff_params:[u._nearZ,u._farZ,(z-u._nearZ)/T,(z-C-u._nearZ)/T]}}},co={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class dd{constructor(o,u){this.aabb=o,this.lastCascade=u}}class Of{add(o,u){const _=this.receivers[o.key];_!==void 0?(_.aabb.min[0]=Math.min(_.aabb.min[0],u.min[0]),_.aabb.min[1]=Math.min(_.aabb.min[1],u.min[1]),_.aabb.min[2]=Math.min(_.aabb.min[2],u.min[2]),_.aabb.max[0]=Math.max(_.aabb.max[0],u.max[0]),_.aabb.max[1]=Math.max(_.aabb.max[1],u.max[1]),_.aabb.max[2]=Math.max(_.aabb.max[2],u.max[2])):this.receivers[o.key]=new dd(u,null)}clear(){this.receivers={}}get(o){return this.receivers[o.key]}computeRequiredCascades(o,u,_){const w=i.ce.fromPoints(o.points);let T=0;for(const C in this.receivers){const z=this.receivers[C];if(!z||!w.intersectsAabb(z.aabb))continue;z.aabb.min=w.closestPoint(z.aabb.min),z.aabb.max=w.closestPoint(z.aabb.max);const V=z.aabb.getCorners();for(let $=0;$<_.length;$++){let K=!0;for(const ee of V){const te=[ee[0]*u,ee[1]*u,ee[2]];if(i.ad.vec3.transformMat4(te,te,_[$].matrix),te[0]<-1||te[0]>1||te[1]<-1||te[1]>1){K=!1;break}}if(z.lastCascade=$,T=Math.max(T,$),K)break}}return T+1}}class uo{constructor(o){this.painter=o,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Of,this._depthMode=new sr(o.context.gl.LEQUAL,sr.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,o.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),o.tp.registerParameter(co,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),o.tp.registerParameter(co,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),o.tp.registerParameter(co,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),o.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const o of this._cascades)o.texture.destroy(),o.framebuffer.destroy();this._cascades=[]}updateShadowParameters(o,u){const _=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!u||!u.properties)return;const w=u.properties.get("shadow-intensity");if(!u.shadowsEnabled()||w<=0||(this._shadowLayerCount=_.style.order.reduce((Te,ve)=>{const Ce=_.style._mergedLayers[ve];return Te+(Ce.hasShadowPass()&&!Ce.isHidden(o.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const T=_.context,C=co.shadowMapResolution,z=co.shadowMapResolution;if(this._cascades.length===0||co.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Te=0;Te<co.cascadeCount;++Te){const ve=_._shadowMapDebug,Ce=T.gl,Pe=T.createFramebuffer(C,z,ve,"texture"),qe=new i.T(T,{width:C,height:z,data:null},Ce.DEPTH_COMPONENT16);if(Pe.depthAttachment.set(qe.texture),ve){const Je=new i.T(T,{width:C,height:z,data:null},Ce.RGBA8);Pe.colorAttachment.set(Je.texture)}this._cascades.push({framebuffer:Pe,texture:qe,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.bR,scale:0})}}this.shadowDirection=Sl(u);let V=0;if(o.elevation){const Te=o.elevation,ve=[1e4,-1e4];Te.visibleDemTiles.filter(Ce=>Ce.dem).forEach(Ce=>{const Pe=Ce.dem.tree;ve[0]=Math.min(ve[0],Pe.minimums[0]),ve[1]=Math.max(ve[1],Pe.maximums[0])}),ve[0]!==1e4&&(V=(ve[1]-ve[0])*Te.exaggeration())}const $=1.5*o.cameraToCenterDistance,K=3*$,ee=new Float64Array(16);for(let Te=0;Te<this._cascades.length;++Te){const ve=this._cascades[Te];let Ce=o.height/50,Pe=1;co.cascadeCount===1?Pe=K:Te===0?Pe=$:(Ce=$,Pe=K);const[qe,Je]=Kl(o,this.shadowDirection,Ce,Pe,co.shadowMapResolution,V);ve.scale=o.scale,ve.matrix=qe,ve.boundingSphereRadius=Je,i.ad.mat4.invert(ee,ve.matrix),ve.frustum=i.bR.fromInvProjectionMatrix(ee,1,0,!0),ve.far=Pe}const te=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[te].far,this._cascades[te].far],this._uniformValues.u_shadow_intensity=w,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/co.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=co.shadowMapResolution,this._uniformValues.u_shadowmap_0=ya.ShadowMap0,this._uniformValues.u_shadowmap_1=ya.ShadowMap0+1,this._groundShadowTiles=_.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const ce=_.transform.elevation;for(const Te of this._groundShadowTiles){let ve={min:0,max:0};if(ce){const Ce=ce.getMinMaxForTile(Te);Ce&&(ve=Ce)}this.addShadowReceiver(Te.toUnwrapped(),ve.min,ve.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(o){this._enabled=o}drawShadowPass(o,u){if(!this.enabled)return;const _=this.painter,w=_.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(_.transform.getFrustum(0),_.transform.worldSize,this._cascades),w.viewport.set([0,0,co.shadowMapResolution,co.shadowMapResolution]);for(let T=0;T<this._numCascadesToRender;++T){_.currentShadowCascade=T,w.bindFramebuffer.set(this._cascades[T].framebuffer.framebuffer),w.clear({color:i.al.white,depth:1});for(const C of o.order){const z=o._mergedLayers[C];if(!z.hasShadowPass()||z.isHidden(_.transform.zoom))continue;const V=o.getLayerSourceCache(z),$=V?u[V.id]:void 0;(z.type==="model"||$&&$.length)&&_.renderLayer(_,V,z,$)}}_.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const o=this.painter,u=o.style,_=o.context,w=u.directionalLight,T=u.ambientLight;if(!w||!T)return;const C=[],z=Vs(o,o.longestCutoffRange);z.shouldRenderCutoff&&C.push("RENDER_CUTOFF"),C.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&C.push("NORMAL_OFFSET");const V=Du(u,w,T),$=new sr(_.gl.LEQUAL,sr.ReadOnly,o.depthRangeFor3D);for(const K of this._groundShadowTiles){const ee=K.toUnwrapped(),te=o.isTileAffectedByFog(K),ce=o.getOrCreateProgram("groundShadow",{defines:C,overrideFog:te});this.setupShadows(ee,ce),o.uploadCommonUniforms(_,ce,ee,null,z);const Te={u_matrix:o.transform.calculateProjMatrix(ee),u_ground_shadow_factor:V};ce.draw(o,_.gl.TRIANGLES,$,Sr.disabled,Mr.multiply,br.disabled,Te,"ground_shadow",o.tileExtentBuffer,o.quadTriangleIndexBuffer,o.tileExtentSegments,null,o.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Mr.unblended:Mr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(o){const u=this.painter.transform,_=u.calculatePosMatrix(o,u.worldSize);return i.ad.mat4.multiply(_,this._cascades[this.painter.currentShadowCascade].matrix,_),Float32Array.from(_)}calculateShadowPassMatrixFromMatrix(o){return i.ad.mat4.multiply(o,this._cascades[this.painter.currentShadowCascade].matrix,o),Float32Array.from(o)}setupShadows(o,u,_,w=0){if(!this.enabled)return;const T=this.painter.transform,C=this.painter.context,z=C.gl,V=this._uniformValues,$=new Float64Array(16),K=T.calculatePosMatrix(o,T.worldSize);for(let ee=0;ee<this._cascades.length;ee++)i.ad.mat4.multiply($,this._cascades[ee].matrix,K),V[ee===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from($),C.activeTexture.set(z.TEXTURE0+ya.ShadowMap0+ee),this._cascades[ee].texture.bind(z.NEAREST,z.CLAMP_TO_EDGE);if(this.useNormalOffset=!!_,this.useNormalOffset){const ee=i.cd(o.canonical),te=2/T.tileSize*i.ai/co.shadowMapResolution,ce=te*this._cascades[0].boundingSphereRadius,Te=te*this._cascades[this._cascades.length-1].boundingSphereRadius,ve=(_==="vector-tile"?1:3)/Math.pow(2,w-o.canonical.z-(1-T.zoom+Math.floor(T.zoom)));V.u_shadow_normal_offset=[ee,ce*ve,Te*ve],V.u_shadow_bias=[6e-5,.0012,.012]}else V.u_shadow_bias=[36e-5,.0012,.012];u.setShadowUniformValues(C,V)}setupShadowsFromMatrix(o,u,_=!1){if(!this.enabled)return;const w=this.painter.context,T=w.gl,C=this._uniformValues,z=new Float64Array(16);for(let V=0;V<co.cascadeCount;V++)i.ad.mat4.multiply(z,this._cascades[V].matrix,o),C[V===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(z),w.activeTexture.set(T.TEXTURE0+ya.ShadowMap0+V),this._cascades[V].texture.bind(T.NEAREST,T.CLAMP_TO_EDGE);if(this.useNormalOffset=_,_){const V=co.normalOffset;C.u_shadow_normal_offset=[1,V,V],C.u_shadow_bias=[6e-5,.0012,.012]}else C.u_shadow_bias=[36e-5,.0012,.012];u.setShadowUniformValues(w,C)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(o,u,_,w){if(w[2]>=0)return{};const T=function(V,$,K){const ee=K/(1<<V.canonical.z);return new i.ce([V.canonical.x*ee+V.wrap*K,V.canonical.y*ee+V.wrap*K,0],[(V.canonical.x+1)*ee+V.wrap*K,(V.canonical.y+1)*ee+V.wrap*K,$])}(o,u,_).getCorners(),C=u/-w[2];w[0]<0?(i.ad.vec3.add(T[0],T[0],[w[0]*C,0,0]),i.ad.vec3.add(T[3],T[3],[w[0]*C,0,0])):w[0]>0&&(i.ad.vec3.add(T[1],T[1],[w[0]*C,0,0]),i.ad.vec3.add(T[2],T[2],[w[0]*C,0,0])),w[1]<0?(i.ad.vec3.add(T[0],T[0],[0,w[1]*C,0]),i.ad.vec3.add(T[1],T[1],[0,w[1]*C,0])):w[1]>0&&(i.ad.vec3.add(T[2],T[2],[0,w[1]*C,0]),i.ad.vec3.add(T[3],T[3],[0,w[1]*C,0]));const z={};return z.vertices=T,z.planes=[Rs(T[1],T[0],T[4]),Rs(T[2],T[1],T[5]),Rs(T[3],T[2],T[6]),Rs(T[0],T[3],T[7])],z}addShadowReceiver(o,u,_){this._receivers.add(o,i.ce.fromTileIdAndHeight(o,u,_))}getMaxCascadeForTile(o){const u=this._receivers.get(o);return u&&u.lastCascade?u.lastCascade:0}}function Rs(y,o,u){const _=i.ad.vec3.sub([],u,o),w=i.ad.vec3.sub([],y,o),T=i.ad.vec3.cross([],_,w),C=i.ad.vec3.length(T);return C===0?[0,0,1,0]:(i.ad.vec3.scale(T,T,1/C),[T[0],T[1],T[2],-i.ad.vec3.dot(T,o)])}function Sl(y){const o=y.properties.get("direction"),u=i.cc(o.x,o.y,o.z);u[2]=i.ay(u[2],0,75);const _=i.cf([u[0],u[1],u[2]]);return i.ad.vec3.fromValues(_.x,_.y,_.z)}function Du(y,o,u){const _=o.properties.get("color-use-theme")==="none",w=o.properties.get("color"),T=o.properties.get("intensity"),C=o.properties.get("direction"),z=[C.x,C.y,C.z],V=u.properties.get("color-use-theme")==="none",$=u.properties.get("color"),K=u.properties.get("intensity"),ee=Math.max(i.ad.vec3.dot([0,0,1],z),0),te=[0,0,0];i.ad.vec3.scale(te,$.toRenderColor(V?null:y.getLut(o.scope)).toArray01Linear().slice(0,3),K);const ce=[0,0,0];return i.ad.vec3.scale(ce,w.toRenderColor(_?null:y.getLut(u.scope)).toArray01Linear().slice(0,3),ee*T),i.cg([te[0]>0?te[0]/(te[0]+ce[0]):0,te[1]>0?te[1]/(te[1]+ce[1]):0,te[2]>0?te[2]/(te[2]+ce[2]):0])}function Kl(y,o,u,_,w,T){const C=y.zoom,z=y.scale,V=y.worldSize,$=1/V,K=y.aspect,ee=Math.sqrt(1+K*K)*Math.tan(.5*y.fovX),te=ee*ee,ce=_-u,Te=_+u;let ve,Ce;te>ce/Te?(ve=_,Ce=_*ee):(ve=.5*Te*(1+te),Ce=.5*Math.sqrt(ce*ce+2*(_*_+u*u)*te+Te*Te*te*te));const Pe=y.projection.pixelsPerMeter(y.center.lat,V),qe=y._camera.getCameraToWorldMercator(),Je=[0,0,-ve*$];i.ad.vec3.transformMat4(Je,Je,qe);let Ye=Ce*$;const lt=y._edgeInsets;if(!(lt.left===0&&lt.top===0&&lt.right===0&&lt.bottom===0||lt.left===lt.right&&lt.top===lt.bottom)){const fn=y._camera.getWorldToCamera(y.worldSize,y.projection.zAxisUnit==="meters"?Pe:1),Wt=y._camera.getCameraToClipPerspective(y._fov,y.width/y.height,u,_);Wt[8]=2*-y.centerOffset.x/y.width,Wt[9]=2*y.centerOffset.y/y.height;const mn=new Float64Array(16);i.ad.mat4.mul(mn,Wt,fn);const zn=new Float64Array(16);i.ad.mat4.invert(zn,mn);const Bn=i.bR.fromInvProjectionMatrix(zn,V,C,!0);for(const In of Bn.points){const or=((nt=In)[0]/=z,nt[1]/=z,nt[2]=i.bH(nt[2],y._center.lat),nt);Ye=Math.max(Ye,i.ad.vec3.len(i.ad.vec3.subtract([],Je,or)))}}var nt;Ye*=w/(w-1);const rt=Math.acos(o[2]),it=Math.atan2(-o[0],-o[1]),dt=new Ts;dt.position=Je,dt.setPitchBearing(rt,it);const xt=dt.getWorldToCamera(V,Pe),Xt=Ye*V,zt=Math.min(y._mercatorZfromZoom(17)*V*-2,-2*Xt),tn=dt.getCameraToClipOrthographic(-Xt,Xt,-Xt,Xt,zt,(Xt+T*Pe)/o[2]),un=new Float64Array(16);i.ad.mat4.multiply(un,tn,xt);const Tn=i.ad.vec3.fromValues(Math.floor(1e6*Je[0])/1e6*V,Math.floor(1e6*Je[1])/1e6*V,0),Lt=.5*w,an=[0,0,0];i.ad.vec3.transformMat4(an,Tn,un),i.ad.vec3.scale(an,an,Lt);const Pt=[Math.floor(an[0]),Math.floor(an[1]),Math.floor(an[2])],sn=[0,0,0];i.ad.vec3.sub(sn,an,Pt),i.ad.vec3.scale(sn,sn,-1/Lt);const Qt=new Float64Array(16);return i.ad.mat4.identity(Qt),i.ad.mat4.translate(Qt,Qt,sn),i.ad.mat4.multiply(un,Qt,un),[un,Xt]}class rf extends i.E{constructor(o){super(),this.requestManager=o,this.models={"":{}},this.modelUris={"":{}},this.numModelsLoading={}}loadModel(o,u){return i.aN(this.requestManager.transformRequest(u,i.R.Model).url).then(_=>{if(!_)return;const w=i.aO(_),T=new i.aP(o,void 0,void 0,w);return T.computeBoundsAndApplyParent(),T}).catch(_=>{if(_&&_.status===404)return null;this.fire(new i.z(new Error(`Could not load model ${o} from ${u}: ${_.message}`)))})}load(o,u,_={keepNumReferences:!1}){this.models[u]||(this.models[u]={});const w=Object.keys(o);this.numModelsLoading[u]=(this.numModelsLoading[u]||0)+w.length;const T=[];for(const C of w)T.push(this.loadModel(C,o[C]));Promise.allSettled(T).then(C=>{for(let z=0;z<C.length;z++){const{status:V,value:$}=C[z];if(V==="fulfilled"&&$){const K=this.models[u][w[z]];this.models[u][w[z]]={model:$,numReferences:_.keepNumReferences&&K?K.numReferences:1}}}this.numModelsLoading[u]-=w.length,this.fire(new i.A("data",{dataType:"style"}))}).catch(C=>{this.fire(new i.z(new Error(`Could not load models: ${C.message}`)))})}isLoaded(){for(const o in this.numModelsLoading)if(this.numModelsLoading[o]>0)return!1;return!0}hasModel(o,u){return!!this.getModel(o,u)}getModel(o,u){return this.models[u]||(this.models[u]={}),this.models[u][o]?this.models[u][o].model:void 0}addModel(o,u,_){this.models[_]||(this.models[_]={}),this.modelUris[_]||(this.modelUris[_]={}),this.hasModel(o,_)&&this.models[_][o].numReferences++,this.modelUris[_][o]=this.requestManager.normalizeModelURL(u),this.load({[o]:this.modelUris[_][o]},_)}addModels(o,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={});const _=this.modelUris[u];for(const w in o)this.models[u][w]={},_[w]=this.requestManager.normalizeModelURL(o[w]);this.load(_,u,{keepNumReferences:!0})}reloadModels(o){this.load(this.modelUris[o],o)}addModelsFromBucket(o,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={});const _={};for(const w of o)this.hasModel(w,u)?this.models[u][w].numReferences++:(this.modelUris[u][w]=this.requestManager.normalizeModelURL(w),_[w]=this.modelUris[u][w]);this.load(_,u)}removeModel(o,u){if(this.models[u]&&this.models[u][o]&&(this.models[u][o].numReferences--,this.models[u][o].numReferences===0)){const _=this.models[u][o].model;delete this.models[u][o],delete this.modelUris[u][o],_.destroy()}}listModels(o){return this.models[o]||(this.models[o]={}),Object.keys(this.models[o])}upload(o,u){this.models[u]||(this.models[u]={});for(const _ in this.models[u])this.models[u][_].model&&this.models[u][_].model.upload(o.context)}}const Al=new i.a7({data:new i.a8(i.a5.colorTheme.data)}),xo={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function Ah(y){return y=y||{},Object.assign(y,xo)}class Lu extends i.E{constructor(o){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},i.aQ(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=o,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(o=>{o.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new i.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=o.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=o.stylesheet.indoor.buildingFeaturesetId,this._scope=o.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:o=>(o.feature&&o.feature.properties.floorplan&&this.selectFloorplan(o.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(o){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(C,z){const[V,$]=C,{center:K,radius:ee}=z,[te,ce]=K,Te=Math.abs(V-te);return Math.sqrt((Te>180?360-Te:Te)**2+($-ce)**2)<=ee}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new i.A("floorplangone")));const u={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},_=new i.P(this._map.transform.width/2,this._map.transform.height/2),w=[new i.P(0,0),new i.P(this._map.transform.width,this._map.transform.height)],T=this._map.queryRenderedFeatures(o?w:_,u);T.length>0&&(this._selectedFloorplan&&T[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=T[0],this._floorplanSelected(!1)))}_floorplanSelected(o){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(T){const[[C,z],[V,$]]=T,K=(V-C+360)%360,ee=K>180?360-K:K;return{center:[(C+ee/2+360)%360,(z+$)/2],radius:Math.sqrt(ee**2+($-z)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const u=this._floorplanStates[this._indoorData.id].selectedBuilding,_=this._floorplanStates[this._indoorData.id].selectedLevel;let w;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const T of this._indoorData.levels)T.id===this._selectedLevel.id&&(w=T.id);if(this.fire(new i.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:w})),u){const T=this._indoorData.buildings.find(C=>C.id===u);this._buildingSelected(T,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(_){const T=this._indoorData.levels.find(C=>C.id===_);this._updateLevels(T,o)}else o&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(o,u){u&&o&&o.extent&&this._map.fitBounds(o.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=o?o.id:void 0;const _=this._indoorData.levels.filter(w=>o.levels.includes(w.id));this.fire(new i.A("buildingselected",{buildingId:o.id,levels:_}))}_levelSelected(o){if(o==="overview")this._updateLevels(void 0,!0);else{const u=this._indoorData.levels.find(_=>_.id===o);this._updateLevels(u,!0)}this.fire(new i.A("levelselected",{levelId:o==="overview"?void 0:o}))}_updateLevels(o,u){if(!o)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(u&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function _($){const K=$.indexOf("/floor/");if(K===-1)return $;const ee=K+7,te=$.indexOf("/",ee);return te===-1?$.slice(ee):$.slice(ee,te)}this._selectedLevel=o,this._floorplanStates[this._indoorData.id].selectedLevel=o?o.id:void 0;const w=[],T={},C={},z={},V={};for(const $ of this._indoorData.levels)if(w.push($.id),T[$.id]=$.height,C[$.id]=$.base,o){if(this.mergeFloors){const K=_(o.id),ee=_($.id);z[$.id]=ee===K?"true":"false"}else z[$.id]=$.id===o.id?"true":"false";V[$.id]=$.base<o.base?"true":"false"}else V[$.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",w]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",T]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",C]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",z]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",V]),o&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!o.isUnderground),u&&o.extent)){const $=this._map.cameraForBounds(o.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),K=this._map.getZoom(),ee=$.zoom?Math.abs(K-$.zoom):0;this._map.fitBounds(o.extent,ee>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:K})}}selectFloorplan(o){const u={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},_=[new i.P(0,0),new i.P(this._map.transform.width,this._map.transform.height)],w=this._map.queryRenderedFeatures(_,u);if(w.length>0){for(const T of w)if(JSON.parse(T.properties["indoor-data"]).floorplanIDs.includes(o)){this._selectedFloorplan=T,this._floorplanSelected(!0);break}}}selectBuilding(o){const u=this._indoorData.buildings.find(_=>_.id===o);this._buildingSelected(u,!0)}selectLevel(o){this._levelSelected(o)}}function Tl(y){if(!y.metadata||!y.metadata.content_area)return;const o=i.q.devicePixelRatio,{left:u,top:_,width:w,height:T}=y.metadata.content_area,C=u*o,z=_*o;return[C,z,C+w*o,z+T*o]}function hu(y){if(y)return y.map(([o,u])=>[o*i.q.devicePixelRatio,u*i.q.devicePixelRatio])}class pc{constructor(o,u){this.id=o,this.style=u}addIcons(o){const u=new Map;for(const[_,w]of o.entries()){const T=i.I.from({name:_,iconsetId:this.id});u.set(T,w)}this.style.addImages(u)}}const Va=(y,o)=>Ft(y,o&&o.filter(u=>u.identifier!=="source.canvas")),pd=i.aA(Si,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport"]),Zs=i.aA(Si,["setCenter","setZoom","setBearing","setPitch"]),ho=new Set(["background","sky","slot","custom"]),Th={version:8,layers:[],sources:{}},Eh={duration:300,delay:0};class Js extends i.E{constructor(o,u={}){super(),this.map=o,this.scope=u.scope||"",this.globalId=null,this.fragments=[],this.importDepth=u.importDepth||0,this.importsCache=u.importsCache||new Map,this.resolvedImports=u.resolvedImports||new Set,this.transition=i.l({},Eh),this._buildingIndex=new Ru(this),this.crossTileSymbolIndex=new Xs,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=u.styleChanges||new Pn,this.dispatcher=u.dispatcher?u.dispatcher:new i.D(i.cj(),this),u.imageManager?this.imageManager=u.imageManager:(this.imageManager=new cn(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=u.glyphManager?u.glyphManager:new i.ck(o._requestManager,u.localFontFamily?i.cl.all:u.localIdeographFontFamily?i.cl.ideographs:i.cl.none,u.localFontFamily||u.localIdeographFontFamily),u.modelManager?this.modelManager=u.modelManager:(this.modelManager=new rf(o._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=u.configOptions?u.configOptions:new Map,this._configDependentLayers=u.configDependentLayers?u.configDependentLayers:new Set,this._config=u.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:u.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=u.initialConfig,this.dispatcher.broadcast("setReferrer",i.cm());const _=this;this._rtlTextPluginCallback=Js.registerForPluginStateChange(w=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:w.pluginStatus,pluginURL:w.pluginURL},(T,C)=>{if(i.cn(T),C&&C.every(z=>z))for(const z in _._sourceCaches){const V=_._sourceCaches[z],$=V.getSource().type;$!=="vector"&&$!=="geojson"||V.reload()}})}),this.on("data",w=>{if(w.dataType!=="source"||w.sourceDataType!=="metadata")return;const T=this.getOwnSource(w.sourceId);if(T&&T.vectorLayerIds)for(const C in this._layers){const z=this._layers[C];z.source===T.id&&this._validateLayer(z)}})}load(o){return o?(typeof o=="string"?this.loadURL(o):this.loadJSON(o),this):this}_getGlobalId(o){if(!o)return null;if(typeof o=="string"){if(i.f(o))return o;const u=i.co(o);if(!u.startsWith("http"))try{return new URL(u,location.href).toString()}catch{return u}return u}return`json://${i.cp(JSON.stringify(o))}`}_diffStyle(o,u,_){this.globalId=this._getGlobalId(o);const w=(T,C)=>{try{C(null,this.setState(T,_))}catch(z){C(z,!1)}};if(typeof o=="string"){const T=this.map._requestManager.normalizeStyleURL(o),C=this.map._requestManager.transformRequest(T,i.R.Style);i.n(C,(z,V)=>{z?this.fire(new i.z(z)):V&&w(V,u)})}else typeof o=="object"&&w(o,u)}loadURL(o,u={}){this.fire(new i.A("dataloading",{dataType:"style"}));const _=typeof u.validate=="boolean"?u.validate:!i.f(o);this.globalId=this._getGlobalId(o),o=this.map._requestManager.normalizeStyleURL(o,u.accessToken),this.resolvedImports.add(o);const w=this.importsCache.get(o);if(w)return this._load(w,_);const T=this.map._requestManager.transformRequest(o,i.R.Style);this._request=i.n(T,(C,z)=>{if(this._request=null,C)this.fire(new i.z(C));else if(z)return this.importsCache.set(o,z),this._load(z,_)})}loadJSON(o,u={}){this.fire(new i.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(o),this._request=i.q.frame(()=>{this._request=null,this._load(o,u.validate!==!1)})}loadEmpty(){this.fire(new i.A("dataloading",{dataType:"style"})),this._load(Th,!1)}_loadImports(o,u,_){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const w=[];for(const T of o){const C=this._createFragmentStyle(T),z=new Promise(K=>{C.once("style.import.load",K),C.once("error",K)}).then(()=>this.mergeAll());if(w.push(z),this.resolvedImports.has(T.url)){C.loadEmpty();continue}const V=T.data||this.importsCache.get(T.url);V?(C.loadJSON(V,{validate:u}),this._isInternalStyle(V)&&(C.globalId=null)):T.url?C.loadURL(T.url,{validate:u}):C.loadEmpty();const $={style:C,id:T.id,config:T.config};if(_){const K=this.fragments.findIndex(({id:ee})=>ee===_);this.fragments=this.fragments.slice(0,K).concat($).concat(this.fragments.slice(K))}else this.fragments.push($)}return Promise.allSettled(w)}getImportGlobalIds(o=this,u=new Set){for(const _ of o.fragments)_.style.globalId&&u.add(_.style.globalId),this.getImportGlobalIds(_.style,u);return[...u.values()]}_createFragmentStyle(o){const u=this.scope?i.C(o.id,this.scope):o.id;let _;const w=this._initialConfig&&this._initialConfig[u];(o.config||w)&&(_=i.l({},o.config,w));const T=new Js(this.map,{scope:u,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:_,configOptions:this.options,colorThemeOverride:o["color-theme"],configDependentLayers:this._configDependentLayers});return T.setEventedParent(this.map,{style:T}),T}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(o){return this.isRootStyle()&&(o.fragment||!!o.schema&&o.fragment!==!1)}_load(o,u){const _=o.indoor?Ah(o.schema):o.schema;if(this._isInternalStyle(o)){const C=i.l({},Th,{imports:[{id:"basemap",data:o,url:""}]});return void this._load(C,u)}if(this.updateConfig(this._config,_),u&&Va(this,Za(o)))return;this._loaded=!0,this.stylesheet=i.cq(o);const w=()=>{for(const $ in o.sources)this.addSource($,o.sources[$],{validate:!1,isInitialLoad:!0});if(o.iconsets)for(const $ in o.iconsets)this.addIconset($,o.iconsets[$]);o.sprite?this._loadIconset(o.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(o.glyphs);const C=ef(this.stylesheet.layers);if(this._order=C.map($=>$.id),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const $=this.stylesheet.lights[0];this.light=new Ht($.properties,$.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Ht(this.stylesheet.light)),this._layers={};for(const $ of C){const K=i.cv($,this.scope,this._styleColorTheme.lut,this.options);K.configDependencies.size!==0&&this._configDependentLayers.add(K.fqid),K.setEventedParent(this,{layer:{id:K.id}}),this._layers[K.id]=K;const ee=this.getOwnLayerSourceCache(K),te=!!this.directionalLight&&this.directionalLight.shadowsEnabled();ee&&K.canCastShadows()&&te&&(ee.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const z=this.stylesheet.terrain;z&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(z,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.A("data",{dataType:"style"}));const V=this.isRootStyle();o.imports?this._loadImports(o.imports,u).then(()=>{this._reloadImports(),this.fire(new i.A(V?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new i.A(V?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const T=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(T){const C=this._evaluateColorThemeData(T);this._loadColorTheme(C).then(()=>{w()}).catch(z=>{i.w(`Couldn't load color theme from the stylesheet: ${z}`),w()})}else this._styleColorTheme.lut=null,w()}isRootStyle(){return this.importDepth===0}mergeAll(){let o,u,_,w,T,C,z,V,$,K;const ee={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(te=>{if(te.stylesheet){if(te.light!=null&&(o=te.light),te.stylesheet.lights)for(const ce of te.stylesheet.lights)ce.type==="ambient"&&te.ambientLight!=null&&(u=te.ambientLight),ce.type==="directional"&&te.directionalLight!=null&&(_=te.directionalLight);w=this._prioritizeTerrain(w,te.terrain,te.stylesheet.terrain),te.stylesheet.fog&&te.fog!=null&&(T=te.fog),te.stylesheet.snow&&te.snow!=null&&(C=te.snow),te.stylesheet.rain&&te.rain!=null&&(z=te.rain),te.stylesheet.camera!=null&&(K=te.stylesheet.camera),te.stylesheet.projection!=null&&(V=te.stylesheet.projection),te.stylesheet.transition!=null&&($=te.stylesheet.transition),ee[te.scope]=te._styleColorTheme}}),this.light=o,this.ambientLight=u,this.directionalLight=_,this.fog=T,this.snow=C,this.rain=z,this._styleColorThemeForScope=ee,w===null?delete this.terrain:this.terrain=w,this.camera=K||{"camera-projection":"perspective"},this.projection=V||{name:"mercator"},this.transition=i.l({},Eh,$),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(o){const u=_=>{for(const w of _.fragments)u(w.style);o(_)};u(this)}_prioritizeTerrain(o,u,_){const w=o&&o.drapeRenderMode===0;return _===null?u&&u.drapeRenderMode===0?u:w?o:null:u!=null&&(!o||w||u&&u.drapeRenderMode===1)?u:o}mergeTerrain(){let o;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(u=>{o=this._prioritizeTerrain(o,u.terrain,u.stylesheet.terrain)}),o===null?delete this.terrain:this.terrain=o}mergeProjection(){let o;this.forEachFragmentStyle(u=>{u.stylesheet.projection!=null&&(o=u.stylesheet.projection)}),this.projection=o||{name:"mercator"}}mergeSources(){const o={},u={},_={};this.forEachFragmentStyle(w=>{for(const T in w._sourceCaches){const C=i.C(T,w.scope);o[C]=w._sourceCaches[T]}for(const T in w._otherSourceCaches){const C=i.C(T,w.scope);u[C]=w._otherSourceCaches[T]}for(const T in w._symbolSourceCaches){const C=i.C(T,w.scope);_[C]=w._symbolSourceCaches[T]}}),this._mergedSourceCaches=o,this._mergedOtherSourceCaches=u,this._mergedSymbolSourceCaches=_}mergeLayers(){const o={},u=[],_={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(T=>{for(const C of T._order){const z=T._layers[C];if(z.type==="slot"){const V=i.cr(C);if(o[V])continue;o[V]=[]}z.slot&&o[z.slot]?o[z.slot].push(z):u.push(z)}}),this._mergedOrder=[];const w=(T=[])=>{for(const C of T)if(C.type==="slot"){const z=i.cr(C.id);o[z]&&w(o[z]),this._mergedSlots.push(z)}else{const z=i.C(C.id,C.scope);this._mergedOrder.push(z),_[z]=C,C.is3D(!!this.terrain)&&(this._has3DLayers=!0),C.type==="circle"&&(this._hasCircleLayers=!0),C.type==="symbol"&&(this._hasSymbolLayers=!0),C.type==="clip"&&(this._clipLayerPresent=!0)}};w(u),this._mergedOrder.sort((T,C)=>{const z=_[T],V=_[C];return z.hasInitialOcclusionOpacityProperties?V.is3D(!!this.terrain)?1:0:z.is3D(!!this.terrain)&&V.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=_,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(o){return this.stylesheet.camera=i.l({},this.stylesheet.camera,o),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(o){return o.data?function(u,_,w){const T=i.l({},_);for(const z of Object.keys(i.a5.colorTheme))T[z]===void 0&&(T[z]=i.a5.colorTheme[z].default);const C=new i.a6(Al,u,new Map(w));return C.setTransitionOrValue(T,w),C.untransitioned().possiblyEvaluate(new i.aa(0))}(this.scope,o,this.options).get("data"):null}_loadColorTheme(o){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const u=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((_,w)=>{const T="data:image/png;base64,";if(!o||o.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void _();let C=o;C.startsWith(T)||(C=T+C);const z=i.I.from("mapbox-reserved-lut"),V=new Image;V.src=C,V.onerror=()=>{this._styleColorTheme.lutLoading=!1,w(new Error("Failed to load image data"))},V.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==u)return void _();this._styleColorTheme.lutLoading=!1;const{width:$,height:K,data:ee}=i.q.getImageData(V);if(K>32)return void w(new Error("The height of the image must be less than or equal to 32 pixels."));if($!==K*K)return void w(new Error("The width of the image must be equal to the height squared."));this.getImage(z)&&this.removeImage(z),this.addImage(z,{data:new i.r({width:$,height:K},ee),pixelRatio:1,sdf:!1,usvg:!1,version:0});const te=this.imageManager.getImage(z,this.scope);te?(this._styleColorTheme.lut={image:te.data,data:o},_()):w(new Error("Missing LUT image."))}})}getLut(o){const u=this._styleColorThemeForScope[o];return u?u.lut:null}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(o){this._spriteRequest=function(u,_,w){let T,C,z;const V=i.q.devicePixelRatio>1?"@2x":"";let $=i.n(_.transformRequest(_.normalizeSpriteURL(u,V,".json"),i.R.SpriteJSON),(te,ce)=>{$=null,z||(z=te,T=ce,ee())}),K=i.o(_.transformRequest(_.normalizeSpriteURL(u,V,".png"),i.R.SpriteImage),(te,ce)=>{K=null,z||(z=te,C=ce,ee())});function ee(){if(z)w(z);else if(T&&C){const te=i.q.getImageData(C),ce={};for(const Te in T){const{width:ve,height:Ce,x:Pe,y:qe,sdf:Je,pixelRatio:Ye,stretchX:lt,stretchY:nt,content:rt}=T[Te],it=new i.r({width:ve,height:Ce});i.r.copy(te,it,{x:Pe,y:qe},{x:0,y:0},{width:ve,height:Ce},null),ce[Te]={data:it,pixelRatio:Ye,sdf:Je,stretchX:lt,stretchY:nt,content:rt,usvg:!1}}w(null,ce)}}return{cancel(){$&&($.cancel(),$=null),K&&(K.cancel(),K=null)}}}(o,this.map._requestManager,(u,_)=>{if(this._spriteRequest=null,u)this.fire(new i.z(u));else if(_){const w=new Map;for(const T in _)w.set(i.I.from(T),_[T]);this.addImages(w)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.A("data",{dataType:"style"}))})}addIconset(o,u){if(u.type==="sprite")return void this._loadSprite(u.url);const _=this.getOwnSource(u.source);if(!_)return void this.fire(new i.z(new Error(`Source "${u.source}" as specified by iconset "${o}" does not exist and cannot be used as an iconset source`)));if(_.type!=="raster-array")return void this.fire(new i.z(new Error(`Source "${u.source}" as specified by iconset "${o}" is not a "raster-array" source and cannot be used as an iconset source`)));this.imageManager.createIconset(this.scope,o);const w=new pc(o,this);_.addIconset(o,w)}_loadIconset(o){if(!i.f(o)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(o);const u=this.map._spriteFormat==="auto";var _,w;this._spriteRequest=(w=(T,C)=>{if(this._spriteRequest=null,T)u?this._loadSprite(o):this.fire(new i.z(T));else if(C){const z=new Map;for(const V in C)z.set(i.I.from(V),C[V]);this.addImages(z)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.A("data",{dataType:"style"}))},i.bj((_=this.map._requestManager).transformRequest(_.normalizeIconsetURL(o),i.R.Iconset),(T,C)=>{if(T)return void w(T);const z={},V=i.ch(new i.bi(C));for(const $ of V.icons){const K={version:1,pixelRatio:i.q.devicePixelRatio,content:Tl($),stretchX:$.metadata?hu($.metadata.stretch_x_areas):void 0,stretchY:$.metadata?hu($.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:$};z[$.name]=K}w(null,z)}))}_validateLayer(o){const u=this.getOwnSource(o.source);if(!u)return;const _=o.sourceLayer;_&&(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(_)===-1)&&this.fire(new i.z(new Error(`Source layer "${_}" does not exist on source "${u.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:o}of this.fragments)if(!o.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((o,u)=>{const _=this.fragments[u];return _&&_.style&&(o.data=_.style.serialize()),o})}_serializeSources(){const o={};for(const u in this._sourceCaches){const _=this._sourceCaches[u].getSource();o[_.id]||(o[_.id]=_.serialize())}return o}_serializeLayers(o){const u=[];for(const _ of o){const w=this._layers[_];w&&w.type!=="custom"&&u.push(w.serialize())}return u}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(o){return o?this.order:this._mergedOrder}isLayerDraped(o){return!!this.terrain&&o.isDraped(this.getLayerSourceCache(o))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(o){const u=this.getOwnLayer(o);if(u)return u;this.fire(new i.z(new Error(`The layer '${o}' does not exist in the map's style.`)))}_checkSource(o){const u=this.getOwnSource(o);if(u)return u;this.fire(new i.z(new Error(`The source '${o}' does not exist in the map's style.`)))}precompilePrograms(o,u){const _=this.map.painter;if(_)for(let w=o.minzoom||0;w<(o.maxzoom||25.5);w++){const T=o.getProgramIds();if(T)for(const C of T){const z=o.getDefaultProgramParams(C,u.zoom,this._styleColorTheme.lut);z&&(_.style=this,this.fog&&(_._fogVisible=!0,z.overrideFog=!0,_.getOrCreateProgram(C,z)),_._fogVisible=!1,z.overrideFog=!1,_.getOrCreateProgram(C,z),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(z.overrideRtt=!0,_.getOrCreateProgram(C,z)))}}}update(o){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(o),this.directionalLight&&this.directionalLight.recalculate(o);const u=this.calculateLightsBrightness();o.brightness=u||0,u!==this._brightness&&(this._brightness=u,this.dispatcher.broadcast("setBrightness",u));const _=this._changes.isDirty();let w=!1;if(this._changes.isDirty()){const C=this._changes.getLayerUpdatesByScope();for(const z in C){const{updatedIds:V,removedIds:$}=C[z];(V||$)&&(this._updateWorkerLayers(z,V,$),w=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(o),this.light&&this.light.updateTransitions(o),this.ambientLight&&this.ambientLight.updateTransitions(o),this.directionalLight&&this.directionalLight.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this.snow&&this.snow.updateTransitions(o),this.rain&&this.rain.updateTransitions(o),this._changes.reset()}const T={};for(const C in this._mergedSourceCaches){const z=this._mergedSourceCaches[C];T[C]=z.used,z.used=!1,z.tileCoverLift=0}for(const C of this._mergedOrder){const z=this._mergedLayers[C];if(z.recalculate(o,this._availableImages),!z.isHidden(o.zoom)){const V=this.getLayerSourceCache(z);V&&(V.used=!0,V.tileCoverLift=Math.max(V.tileCoverLift,z.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(z,o)}):this.precompilePrograms(z,o))}for(const C in this._mergedSourceCaches){const z=this._mergedSourceCaches[C];if(!z)continue;const V=z._source;V.type==="raster-array"&&V.iconsets&&(z.used=!0)}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&w&&this.mergeLayers();for(const C in T){const z=this._mergedSourceCaches[C];T[C]!==z.used&&z.getSource().fire(new i.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:z.getSource().id}))}this.light&&this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.snow&&this.snow.recalculate(o),this.rain&&this.rain.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),_&&this.fire(new i.A("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=this._changes.getUpdatedImages();if(o.length){for(const u in this._mergedSourceCaches)this._mergedSourceCaches[u].reloadTilesForDependencies(["icons","patterns"],o);this._changes.resetUpdatedImages()}}_updateWorkerLayers(o,u,_){const w=this.getFragmentStyle(o);w&&this.dispatcher.broadcast("updateLayers",{layers:u?w._serializeLayers(u):[],scope:o,removedIds:_||[],options:w.options})}setState(o,u){if(this._checkLoaded(),Va(this,Za(o)))return!1;(o=i.cq(o)).layers=ef(o.layers);const _=function(C,z){if(!C)return[{command:Si.setStyle,args:[z]}];let V=[];try{if(!i.bn(C.version,z.version))return[{command:Si.setStyle,args:[z]}];if(i.bn(C.center,z.center)||V.push({command:Si.setCenter,args:[z.center]}),i.bn(C.zoom,z.zoom)||V.push({command:Si.setZoom,args:[z.zoom]}),i.bn(C.bearing,z.bearing)||V.push({command:Si.setBearing,args:[z.bearing]}),i.bn(C.pitch,z.pitch)||V.push({command:Si.setPitch,args:[z.pitch]}),i.bn(C.sprite,z.sprite)||V.push({command:Si.setSprite,args:[z.sprite]}),i.bn(C.glyphs,z.glyphs)||V.push({command:Si.setGlyphs,args:[z.glyphs]}),i.bn(C.imports,z.imports)||function(ce=[],Te=[],ve){Te=Te||[];const Ce=(ce=ce||[]).map(_i),Pe=Te.map(_i),qe=ce.reduce(Fs,{}),Je=Te.reduce(Fs,{}),Ye=Ce.slice();let lt,nt,rt,it;for(lt=0,nt=0;lt<Ce.length;lt++)rt=Ce[lt],Je.hasOwnProperty(rt)?nt++:(ve.push({command:Si.removeImport,args:[rt]}),Ye.splice(Ye.indexOf(rt,nt),1));for(lt=0,nt=0;lt<Pe.length;lt++)rt=Pe[Pe.length-1-lt],Ye[Ye.length-1-lt]!==rt&&(qe.hasOwnProperty(rt)?(ve.push({command:Si.removeImport,args:[rt]}),Ye.splice(Ye.lastIndexOf(rt,Ye.length-nt),1)):nt++,it=Ye[Ye.length-lt],ve.push({command:Si.addImport,args:[Je[rt],it]}),Ye.splice(Ye.length-lt,0,rt));for(const dt of Te){const xt=qe[dt.id];xt&&!i.bn(xt,dt)&&ve.push({command:Si.updateImport,args:[dt.id,dt]})}}(C.imports,z.imports,V),i.bn(C.transition,z.transition)||V.push({command:Si.setTransition,args:[z.transition]}),i.bn(C.light,z.light)||V.push({command:Si.setLight,args:[z.light]}),i.bn(C.fog,z.fog)||V.push({command:Si.setFog,args:[z.fog]}),i.bn(C.snow,z.snow)||V.push({command:Si.setSnow,args:[z.snow]}),i.bn(C.rain,z.rain)||V.push({command:Si.setRain,args:[z.rain]}),i.bn(C.projection,z.projection)||V.push({command:Si.setProjection,args:[z.projection]}),i.bn(C.lights,z.lights)||V.push({command:Si.setLights,args:[z.lights]}),i.bn(C.camera,z.camera)||V.push({command:Si.setCamera,args:[z.camera]}),!i.bn(C["color-theme"],z["color-theme"]))return[{command:Si.setStyle,args:[z]}];const $={},K=[];(function(ce,Te,ve,Ce){let Pe;for(Pe in Te=Te||{},ce=ce||{})ce.hasOwnProperty(Pe)&&(Te.hasOwnProperty(Pe)||au(Pe,ve,Ce));for(Pe in Te){if(!Te.hasOwnProperty(Pe))continue;const qe=Te[Pe];ce.hasOwnProperty(Pe)?i.bn(ce[Pe],qe)||(ce[Pe].type==="geojson"&&qe.type==="geojson"&&Jn(ce,Te,Pe)?ve.push({command:Si.setGeoJSONSourceData,args:[Pe,qe.data]}):su(Pe,Te,ve,Ce)):js(Pe,Te,ve)}})(C.sources,z.sources,K,$);const ee=[];C.layers&&C.layers.forEach(ce=>{ce.source&&$[ce.source]?V.push({command:Si.removeLayer,args:[ce.id]}):ee.push(ce)});let te=C.terrain;te&&$[te.source]&&(V.push({command:Si.setTerrain,args:[void 0]}),te=void 0),V=V.concat(K),i.bn(te,z.terrain)||V.push({command:Si.setTerrain,args:[z.terrain]}),function(ce,Te,ve){Te=Te||[];const Ce=(ce=ce||[]).map(_i),Pe=Te.map(_i),qe=ce.reduce(Fs,{}),Je=Te.reduce(Fs,{}),Ye=Ce.slice(),lt=Object.create(null);let nt,rt,it,dt,xt,Xt,zt;for(nt=0,rt=0;nt<Ce.length;nt++)it=Ce[nt],Je.hasOwnProperty(it)?rt++:(ve.push({command:Si.removeLayer,args:[it]}),Ye.splice(Ye.indexOf(it,rt),1));for(nt=0,rt=0;nt<Pe.length;nt++)it=Pe[Pe.length-1-nt],Ye[Ye.length-1-nt]!==it&&(qe.hasOwnProperty(it)?(ve.push({command:Si.removeLayer,args:[it]}),Ye.splice(Ye.lastIndexOf(it,Ye.length-rt),1)):rt++,Xt=Ye[Ye.length-nt],ve.push({command:Si.addLayer,args:[Je[it],Xt]}),Ye.splice(Ye.length-nt,0,it),lt[it]=!0);for(nt=0;nt<Pe.length;nt++)if(it=Pe[nt],dt=qe[it],xt=Je[it],!lt[it]&&!i.bn(dt,xt))if(i.bn(dt.source,xt.source)&&i.bn(dt["source-layer"],xt["source-layer"])&&i.bn(dt.type,xt.type)){for(zt in ri(dt.layout,xt.layout,ve,it,null,Si.setLayoutProperty),ri(dt.paint,xt.paint,ve,it,null,Si.setPaintProperty),i.bn(dt.slot,xt.slot)||ve.push({command:Si.setSlot,args:[it,xt.slot]}),i.bn(dt.filter,xt.filter)||ve.push({command:Si.setFilter,args:[it,xt.filter]}),i.bn(dt.minzoom,xt.minzoom)&&i.bn(dt.maxzoom,xt.maxzoom)||ve.push({command:Si.setLayerZoomRange,args:[it,xt.minzoom,xt.maxzoom]}),dt)dt.hasOwnProperty(zt)&&zt!=="layout"&&zt!=="paint"&&zt!=="filter"&&zt!=="metadata"&&zt!=="minzoom"&&zt!=="maxzoom"&&zt!=="slot"&&(zt.indexOf("paint.")===0?ri(dt[zt],xt[zt],ve,it,zt.slice(6),Si.setPaintProperty):i.bn(dt[zt],xt[zt])||ve.push({command:Si.setLayerProperty,args:[it,zt,xt[zt]]}));for(zt in xt)xt.hasOwnProperty(zt)&&!dt.hasOwnProperty(zt)&&zt!=="layout"&&zt!=="paint"&&zt!=="filter"&&zt!=="metadata"&&zt!=="minzoom"&&zt!=="maxzoom"&&zt!=="slot"&&(zt.indexOf("paint.")===0?ri(dt[zt],xt[zt],ve,it,zt.slice(6),Si.setPaintProperty):i.bn(dt[zt],xt[zt])||ve.push({command:Si.setLayerProperty,args:[it,zt,xt[zt]]}))}else ve.push({command:Si.removeLayer,args:[it]}),Xt=Ye[Ye.lastIndexOf(it)+1],ve.push({command:Si.addLayer,args:[xt,Xt]})}(ee,z.layers,V)}catch($){console.warn("Unable to compute style diff:",$),V=[{command:Si.setStyle,args:[z]}]}return V}(this.serialize(),o).filter(C=>!(C.command in Zs));if(_.length===0)return!1;const w=_.filter(C=>!(C.command in pd));if(w.length>0)throw new Error(`Unimplemented: ${w.map(C=>C.command).join(", ")}.`);const T=[];return _.forEach(C=>{T.push(this[C.command].apply(this,C.args))}),u&&Promise.all(T).then(u),this.stylesheet=o,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}addImages(o){for(const[u,_]of o.entries()){if(this.getImage(u)&&!u.iconsetId)return this.fire(new i.z(new Error(`An image with the name "${u.name}" already exists.`)));this.imageManager.addImage(u,this.scope,_),this._changes.updateImage(u)}return this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this}addImage(o,u){return this.getImage(o)&&!o.iconsetId?this.fire(new i.z(new Error(`An image with the name "${o.name}" already exists.`))):(this.imageManager.addImage(o,this.scope,u),this._changes.updateImage(o),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this)}updateImage(o,u,_=!1){this.imageManager.updateImage(o,this.scope,u),_&&(this._changes.updateImage(o),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})))}getImage(o){return this.imageManager.getImage(o,this.scope)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o,this.scope),this._changes.updateImage(o),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this):this.fire(new i.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(o,u,_={}){return this._checkLoaded(),this._validate(ft,`models.${o}`,u,null,_)||(this.modelManager.addModel(o,u,this.scope),this._changes.setDirty()),this}hasModel(o){return this.modelManager.hasModel(o,this.scope)}removeModel(o){return this.hasModel(o)?(this.modelManager.removeModel(o,this.scope),this):this.fire(new i.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(o,u,_={}){if(this._checkLoaded(),this.getOwnSource(o)!==void 0)throw new Error(`There is already a source with ID "${o}".`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(Oo,`sources.${o}`,u,null,_))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const w=Do(o,u,this.dispatcher,this);w.scope=this.scope,w.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(w.id),source:w.serialize(),sourceId:w.id}));const T=C=>{const z=(C?"symbol:":"other:")+w.id,V=i.C(z,this.scope),$=this._sourceCaches[z]=new Ko(V,w,C);(C?this._symbolSourceCaches:this._otherSourceCaches)[w.id]=$,$.onAdd(this.map)};T(!1),u.type!=="vector"&&u.type!=="geojson"||T(!0),w.onAdd&&w.onAdd(this.map),_.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(o){this._checkLoaded();const u=this.getOwnSource(o);if(!u)throw new Error("There is no source with this ID");for(const w in this._layers)if(this._layers[w].source===o)return this.fire(new i.z(new Error(`Source "${o}" cannot be removed while layer "${w}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===o)return this.fire(new i.z(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));const _=this.getOwnSourceCaches(o);for(const w of _){const T=i.cr(w.id);delete this._sourceCaches[T],this._changes.discardSourceCacheUpdate(w.id),w.fire(new i.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:w.getSource().id})),w.setEventedParent(null),w.clearTiles()}return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],this.mergeSources(),u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(o,u){this._checkLoaded(),this.getOwnSource(o).setData(u),this._changes.setDirty()}getOwnSource(o){const u=this.getOwnSourceCache(o);return u&&u.getSource()}getOwnSources(){const o=[];for(const u in this._otherSourceCaches){const _=this.getOwnSourceCache(u);_&&o.push(_.getSource())}return o}areTilesLoaded(){const o=this._mergedSourceCaches;for(const u in o){const _=o[u]._tiles;for(const w in _){const T=_[w];if(T.state!=="loaded"&&T.state!=="errored")return!1}}return!0}setLights(o){if(this._checkLoaded(),!o)return delete this.ambientLight,void delete this.directionalLight;const u=this._getTransitionParameters();for(const w of o){if(this._validate(fi,"lights",w))return;switch(w.type){case"ambient":if(this.ambientLight){const T=this.ambientLight;T.set(w),T.updateTransitions(u)}else this.ambientLight=new Pa(w,Hr||(Hr=new i.a7({color:new i.a8(i.a5.properties_light_ambient.color),"color-use-theme":new i.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.a8(i.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const T=this.directionalLight;T.set(w),T.updateTransitions(u)}else this.directionalLight=new Pa(w,gi||(gi=new i.a7({direction:new i.am(i.a5.properties_light_directional.direction),color:new i.a8(i.a5.properties_light_directional.color),"color-use-theme":new i.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.a8(i.a5.properties_light_directional.intensity),"cast-shadows":new i.a8(i.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new i.a8(i.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new i.a8(i.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const _=new i.aa(this.z||0,u);this.ambientLight&&this.ambientLight.recalculate(_),this.directionalLight&&this.directionalLight.recalculate(_),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const o=this.directionalLight,u=this.ambientLight;if(!o||!u)return;const _=te=>.2126*(te[0]<=.03928?te[0]/12.92:Math.pow((te[0]+.055)/1.055,2.4))+.7152*(te[1]<=.03928?te[1]/12.92:Math.pow((te[1]+.055)/1.055,2.4))+.0722*(te[2]<=.03928?te[2]/12.92:Math.pow((te[2]+.055)/1.055,2.4)),w=o.properties.get("color").toRenderColor(null).toArray01(),T=o.properties.get("intensity"),C=o.properties.get("direction"),z=1-i.cc(C.x,C.y,C.z)[2]/90,V=_(w)*T*z,$=u.properties.get("color").toRenderColor(null).toArray01(),K=u.properties.get("intensity"),ee=_($)*K;return Number(((V+ee)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const o=[];return this.directionalLight&&o.push(this.directionalLight.get()),this.ambientLight&&o.push(this.ambientLight.get()),o}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(o){if(!o)return this;if(i.cs(o)){const u=i.ct(o),_=this.fragments.find(({id:T})=>T===u);if(!_)throw new Error(`Style import '${o}' not found`);const w=i.cr(o);return _.style.getFragmentStyle(w)}{const u=this.fragments.find(({id:_})=>_===o);return u?u.style:void 0}}setFeaturesetSelectors(o){if(!o)return;const u={},_=(w,T="")=>`${w}::${T}`;this._featuresetSelectors={};for(const w in o){const T=this._featuresetSelectors[w]=[];for(const C of o[w].selectors){if(C.featureNamespace){const V=this.getOwnLayer(C.layer);if(!V){i.w(`Layer is undefined for selector: ${C.layer}`);continue}const $=_(V.source,V.sourceLayer);if($ in u&&u[$]!==C.featureNamespace){i.w(`"featureNamespace ${C.featureNamespace} of featureset ${w}'s selector is not associated to the same source, skip this selector`);continue}u[$]=C.featureNamespace}let z;if(C.properties)for(const V in C.properties){const $=i.X(C.properties[V]);$.result==="success"&&(z=z||{},z[V]=$.value)}T.push({layerId:C.layer,namespace:C.featureNamespace,properties:z,uniqueFeatureID:C._uniqueFeatureID})}}}getFeaturesetDescriptors(o){const u=this.getFragmentStyle(o);if(!u||!u.stylesheet.featuresets)return[];const _=[];for(const w in u.stylesheet.featuresets)_.push({featuresetId:w,importId:u.scope?u.scope:void 0});return _}getFeaturesetLayers(o,u){const _=this.getFragmentStyle(u),w=_.stylesheet.featuresets;if(!w||!w[o])return this.fire(new i.z(new Error(`The featureset '${o}' does not exist in the map's style and cannot be queried.`))),[];const T=[];for(const C of w[o].selectors){const z=_.getOwnLayer(C.layer);z&&T.push(z)}return T}getConfigProperty(o,u){const _=this.getFragmentStyle(o);if(!_)return null;const w=i.C(u,_.scope),T=_.options.get(w),C=T?T.value||T.default:null;return C?C.serialize():null}setConfigProperty(o,u,_){const w=this.getFragmentStyle(o);if(!w)return;const T=w.stylesheet.indoor?Ah(w.stylesheet.schema):w.stylesheet.schema;if(!T||!T[u])return;const C=i.X(_);if(C.result!=="success")return void Va(this,C.value);const z=C.value.expression,V=i.C(u,w.scope),$=w.options.get(V);if(!$)return;let K;const{minValue:ee,maxValue:te,stepValue:ce,type:Te,values:ve}=T[u],Ce=i.X(T[u].default);Ce.result==="success"&&(K=Ce.value.expression),K?(this.options.set(V,Object.assign({},$,{value:z,default:K,minValue:ee,maxValue:te,stepValue:ce,type:Te,values:ve})),this.updateConfigDependencies(u)):this.fire(new i.z(new Error(`No schema defined for the config option "${u}" in the "${o}" fragment.`)))}getConfig(o){const u=this.getFragmentStyle(o);if(!u)return null;const _=u.stylesheet.schema;if(!_)return null;const w={};for(const T in _){const C=i.C(T,u.scope),z=u.options.get(C),V=z?z.value||z.default:null;w[T]=V?V.serialize():null}return w}setConfig(o,u){const _=this.getFragmentStyle(o);_&&(_.updateConfig(u,_.stylesheet.schema),this.updateConfigDependencies())}getSchema(o){const u=this.getFragmentStyle(o);return u?u.stylesheet.schema:null}setSchema(o,u){const _=this.getFragmentStyle(o);_&&(_.stylesheet.schema=u,_.updateConfig(_._config,u),this.updateConfigDependencies())}updateConfig(o,u){if(this._config=o,o||u)if(u)for(const _ in u){let w,T;const C=i.X(u[_].default);if(C.result==="success"&&(w=C.value.expression),o&&o[_]!==void 0){const te=i.X(o[_]);te.result==="success"&&(T=te.value.expression)}const{minValue:z,maxValue:V,stepValue:$,type:K,values:ee}=u[_];if(w){const te=i.C(_,this.scope);this.options.set(te,{default:w,value:T,minValue:z,maxValue:V,stepValue:$,type:K,values:ee})}else this.fire(new i.z(new Error(`No schema defined for config option "${_}".`)))}else this.fire(new i.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(o){for(const u of this._configDependentLayers){const _=this.getLayer(u);if(_){if(o&&!_.configDependencies.has(o))continue;_.possiblyEvaluateVisibility(),this._updateLayer(_)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(u=>{const _=u._styleColorTheme.colorThemeOverride?u._styleColorTheme.colorThemeOverride:u._styleColorTheme.colorTheme;if(_){const w=u._evaluateColorThemeData(_);(!u._styleColorTheme.lut&&w!==""||u._styleColorTheme.lut&&w!==u._styleColorTheme.lut.data)&&u.setColorTheme(_)}}),this._changes.setDirty()}addLayer(o,u,_={}){this._checkLoaded();const w=o.id;if(this._layers[w])return void this.fire(new i.z(new Error(`Layer with id "${w}" already exists on this map`)));let T;if(o.type==="custom"){if(Va(this,i.cu(o)))return;T=i.cv(o,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof o.source=="object"&&(this.addSource(w,o.source),o=i.cq(o),o=i.l(o,{source:w})),this._validate(Ee,`layers.${w}`,o,{arrayIndex:-1},_))return;T=i.cv(o,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(T),T.setEventedParent(this,{layer:{id:w}})}T.configDependencies.size!==0&&this._configDependentLayers.add(T.fqid);let C=this._order.length;if(u){const K=this._order.indexOf(u);if(K===-1)return void this.fire(new i.z(new Error(`Layer with id "${u}" does not exist on this map.`)));T.slot===this._layers[u].slot?C=K:i.w(`Layer with id "${u}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(C,0,w),this._layerOrderChanged=!0,this._layers[w]=T;const z=this.getOwnLayerSourceCache(T),V=!!this.directionalLight&&this.directionalLight.shadowsEnabled();z&&T.canCastShadows()&&V&&(z.castsShadows=!0);const $=this._changes.getRemovedLayer(T);if($&&T.source&&z&&T.type!=="custom"){this._changes.discardLayerRemoval(T);const K=i.C(T.source,T.scope);$.type!==T.type?this._changes.updateSourceCache(K,"clear"):(this._changes.updateSourceCache(K,"reload"),z.pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map),T.scope=this.scope,this.mergeLayers()}moveLayer(o,u){this._checkLoaded();const _=this._checkLayer(o);if(!_||o===u)return;const w=this._order.indexOf(o);this._order.splice(w,1);let T=this._order.length;if(u){const C=this._order.indexOf(u);if(C===-1)return void this.fire(new i.z(new Error(`Layer with id "${u}" does not exist on this map.`)));_.slot===this._layers[u].slot?T=C:i.w(`Layer with id "${u}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(T,0,o),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(o){this._checkLoaded();const u=this._checkLayer(o);if(!u)return;u.setEventedParent(null);const _=this._order.indexOf(o);this._order.splice(_,1),delete this._layers[o],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(u.fqid),this._changes.removeLayer(u);const w=this.getOwnLayerSourceCache(u);if(w&&w.castsShadows){let T=!1;for(const C in this._layers)if(this._layers[C].source===u.source&&this._layers[C].canCastShadows()){T=!0;break}w.castsShadows=T}u.onRemove&&u.onRemove(this.map),this.mergeLayers()}getOwnLayer(o){return this._layers[o]}hasLayer(o){return o in this._mergedLayers}hasLayerType(o){for(const u in this._layers)if(this._layers[u].type===o)return!0;return!1}setLayerZoomRange(o,u,_){this._checkLoaded();const w=this._checkLayer(o);w&&(w.minzoom===u&&w.maxzoom===_||(u!=null&&(w.minzoom=u),_!=null&&(w.maxzoom=_),this._updateLayer(w)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(o,u){this._checkLoaded();const _=this._checkLayer(o);_&&_.slot!==u&&(_.slot=u,this._updateLayer(_))}setFilter(o,u,_={}){this._checkLoaded();const w=this._checkLayer(o);if(w&&!i.bn(w.filter,u))return u==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(Re,`layers.${w.id}.filter`,u,{layerType:w.type},_)||(w.filter=i.cq(u),this._updateLayer(w)))}getFilter(o){const u=this._checkLayer(o);if(u)return i.cq(u.filter)}setLayoutProperty(o,u,_,w={}){this._checkLoaded();const T=this._checkLayer(o);if(T&&!i.bn(T.getLayoutProperty(u),_)){if(_!=null&&(!w||w.validate!==!1)&&Va(T,gt.call(Za,{key:`layers.${o}.layout.${u}`,layerType:T.type,objectKey:u,value:_,styleSpec:i.a5,style:{glyphs:!0,sprite:!0}})))return;T.setLayoutProperty(u,_),T.configDependencies.size!==0&&this._configDependentLayers.add(T.fqid),this._updateLayer(T)}}getLayoutProperty(o,u){const _=this._checkLayer(o);if(_)return _.getLayoutProperty(u)}setPaintProperty(o,u,_,w={}){this._checkLoaded();const T=this._checkLayer(o);if(!T||i.bn(T.getPaintProperty(u),_)||_!=null&&(!w||w.validate!==!1)&&Va(T,tt.call(Za,{key:`layers.${o}.paint.${u}`,layerType:T.type,objectKey:u,value:_,styleSpec:i.a5})))return;const C=T.setPaintProperty(u,_);T.configDependencies.size!==0&&this._configDependentLayers.add(T.fqid),C&&this._updateLayer(T),this._changes.updatePaintProperties(T)}getPaintProperty(o,u){const _=this._checkLayer(o);if(_)return _.getPaintProperty(u)}setFeatureState(o,u){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){const{featuresetId:V,importId:$}=o.target,K=this.getFragmentStyle($),ee=K.getFeaturesetLayers(V);for(const{source:te,sourceLayer:ce}of ee)K.setFeatureState({id:o.id,source:te,sourceLayer:ce},u)}else if("layerId"in o.target){const{layerId:V}=o.target,$=this.getLayer(V);this.setFeatureState({id:o.id,source:$.source,sourceLayer:$.sourceLayer},u)}return}const _=o.source,w=o.sourceLayer,T=this._checkSource(_);if(!T)return;const C=T.type;if(C==="geojson"&&w)return void this.fire(new i.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(C==="vector"&&!w)return void this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")));o.id===void 0&&this.fire(new i.z(new Error("The feature id parameter must be provided.")));const z=this.getOwnSourceCaches(_);for(const V of z)V.setFeatureState(w,o.id,u)}removeFeatureState(o,u){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){const{featuresetId:V,importId:$}=o.target,K=this.getFragmentStyle($),ee=K.getFeaturesetLayers(V);for(const{source:te,sourceLayer:ce}of ee)K.removeFeatureState({id:o.id,source:te,sourceLayer:ce},u)}else if("layerId"in o.target){const{layerId:V}=o.target,$=this.getLayer(V);this.removeFeatureState({id:o.id,source:$.source,sourceLayer:$.sourceLayer},u)}return}const _=o.source,w=this._checkSource(_);if(!w)return;const T=w.type,C=T==="vector"?o.sourceLayer:void 0;if(T==="vector"&&!C)return void this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&typeof o.id!="string"&&typeof o.id!="number")return void this.fire(new i.z(new Error("A feature id is required to remove its specific state property.")));const z=this.getOwnSourceCaches(_);for(const V of z)V.removeFeatureState(C,o.id,u)}getFeatureState(o){if(this._checkLoaded(),"target"in o){let T;if("featuresetId"in o.target){const{featuresetId:C,importId:z}=o.target,V=this.getFragmentStyle(z),$=V.getFeaturesetLayers(C);for(const{source:K,sourceLayer:ee}of $){const te=V.getFeatureState({id:o.id,source:K,sourceLayer:ee});if(te&&!T)T=te;else if(!i.bn(T,te))return void this.fire(new i.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in o.target){const{layerId:C}=o.target,z=this.getLayer(C);T=this.getFeatureState({id:o.id,source:z.source,sourceLayer:z.sourceLayer})}return T}const u=o.source,_=o.sourceLayer,w=this._checkSource(u);if(w){if(w.type!=="vector"||_)return o.id===void 0&&this.fire(new i.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(u)[0].getFeatureState(_,o.id);this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(o){return this.stylesheet.transition=i.l({},this.stylesheet.transition,o),this.transition=this.stylesheet.transition,this}getTransition(){return i.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const o=this.getTerrain(),u=o&&this.terrain&&this.terrain.scope===this.scope?o:this.stylesheet.terrain;return i.cw({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:u,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},_=>_!==void 0)}_updateFilteredLayers(o){for(const u of Object.values(this._mergedLayers))o(u)&&this._updateLayer(u)}_updateLayer(o){this._changes.updateLayer(o);const u=this.getLayerSourceCache(o),_=i.C(o.source,o.scope),w=this._changes.getUpdatedSourceCaches();o.source&&!w[_]&&u&&u.getSource().type!=="raster"&&(this._changes.updateSourceCache(_,"reload"),u.pause()),o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){const u=z=>this._mergedLayers[z].is3D(!!this.terrain),_=this.order,w={},T=[];for(let z=_.length-1;z>=0;z--){const V=_[z];if(u(V)){w[V]=z;for(const $ of o){const K=$[V];if(K)for(const ee of K)T.push(ee)}}}T.sort((z,V)=>V.intersectionZ-z.intersectionZ);const C=[];for(let z=_.length-1;z>=0;z--){const V=_[z];if(u(V))for(let $=T.length-1;$>=0;$--){const K=T[$].feature;if(K.layer&&w[K.layer.id]<z)break;C.push(K),T.pop()}else for(const $ of o){const K=$[V];if(K)for(const ee of K)C.push(ee.feature)}}return C}queryRenderedFeatures(o,u,_){let w;u&&!Array.isArray(u)&&u.filter&&(this._validate(Re,"queryRenderedFeatures.filter",u.filter,null,u),w=i.a_(u.filter));const T={},C=K=>{if(ho.has(K.type))return;const ee=this.getOwnLayerSourceCache(K),te=T[ee.id]=T[ee.id]||{sourceCache:ee,layers:{},has3DLayers:!1};K.is3D(!!this.terrain)&&(te.has3DLayers=!0),te.layers[K.fqid]=te.layers[K.fqid]||{styleLayer:K,targets:[]},te.layers[K.fqid].targets.push({filter:w})};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new i.z(new Error("parameters.layers must be an Array."))),[];for(const K of u.layers){const ee=this._layers[K];if(!ee)return this.fire(new i.z(new Error(`The layer '${K}' does not exist in the map's style and cannot be queried for features.`))),[];C(ee)}}else for(const K in this._layers)C(this._layers[K]);const z=this._queryRenderedFeatures(o,T,_),V=this._flattenAndSortRenderedFeatures(z),$=[];for(const K of V)i.ct(K.layer.id)===this.scope&&$.push(K);return $}queryRenderedFeatureset(o,u,_){let w;u&&!Array.isArray(u)&&u.filter&&(this._validate(Re,"queryRenderedFeatures.filter",u.filter,null,u),w=i.a_(u.filter));const T="mock",C=[];if(u&&u.target)C.push(Object.assign({},u,{targetId:T,filter:w}));else{const K=this.getFeaturesetDescriptors();for(const ee of K)C.push({targetId:T,filter:w,target:ee});for(const{style:ee}of this.fragments){const te=ee.getFeaturesetDescriptors();for(const ce of te)C.push({targetId:T,filter:w,target:ce})}}const z=this.queryRenderedTargets(o,C,_),V=[],$=new Set;for(const K of z)for(const ee of K.variants[T])Pu(ee,K,$)||V.push(new i.cx(K,ee));return V}queryRenderedTargets(o,u,_){const w={},T=(z,V,$,K)=>{const ee=w[V.id]=w[V.id]||{sourceCache:V,layers:{},has3DLayers:!1};if(ee.layers[z.fqid]=ee.layers[z.fqid]||{styleLayer:z,targets:[]},z.is3D(!!this.terrain)&&(ee.has3DLayers=!0),!K)return $.uniqueFeatureID=!1,void ee.layers[z.fqid].targets.push($);ee.layers[z.fqid].targets.push(Object.assign({},$,{namespace:K.namespace,properties:K.properties,uniqueFeatureID:K.uniqueFeatureID}))};for(const z of u)if("featuresetId"in z.target){const{featuresetId:V,importId:$}=z.target,K=this.getFragmentStyle($);if(!K||!K._featuresetSelectors)continue;const ee=K._featuresetSelectors[V];if(!ee){this.fire(new i.z(new Error(`The featureset '${V}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const te of ee){const ce=K.getOwnLayer(te.layerId);ce&&!ho.has(ce.type)&&T(ce,K.getOwnLayerSourceCache(ce),z,te)}}else if("layerId"in z.target){const{layerId:V}=z.target,$=this.getLayer(V);if(!$||ho.has($.type))continue;T($,this.getLayerSourceCache($),z)}const C=this._queryRenderedFeatures(o,w,_);return this._flattenAndSortRenderedFeatures(C)}_queryRenderedFeatures(o,u,_){const w=[],T=!!this.map._showQueryGeometry,C=Ua.createFromScreenPoints(o,_);for(const z in u){const V=Jh(C,u[z],this._availableImages,_,T);Object.keys(V).length&&w.push(V)}if(this.placement)for(const z in u){if(!u[z].sourceCache._onlySymbols)continue;const V=lc(C.screenGeometry,u[z],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(V).length&&w.push(V)}return w}querySourceFeatures(o,u){const _=u&&u.filter;_&&this._validate(Re,"querySourceFeatures.filter",_,null,u);let w=[];const T=this.getOwnSourceCaches(o);for(const C of T)w=w.concat(Ou(C,u));return w}addSourceType(o,u,_){return Js.getSourceType(o)?_(new Error(`A source type called "${o}" already exists.`)):(Js.setSourceType(o,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:u.workerSourceURL},_):_(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(o,u,_={}){this._checkLoaded();const w=this.light.getLight();let T=!1;for(const z in o)if(!i.bn(o[z],w[z])){T=!0;break}if(!T)return;const C=this._getTransitionParameters();this.light.setLight(o,u,_),this.light.updateTransitions(C)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(o,u=1){if(this._checkLoaded(),!o)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),u===0&&delete this.terrain,o===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let _=o;const w=o.source==null;if(u===1){if(this.disableElevatedTerrain)return;if(typeof _.source=="object"){const z="terrain-dem-src";this.addSource(z,_.source),_=i.cq(_),_=i.l(_,{source:z})}const T=i.l({},_),C={};if(this.terrain&&w){T.source=this.terrain.get().source;const z=this.terrain?this.getFragmentStyle(this.terrain.scope):null;z&&(C.style=z.serialize())}if(this._validate(la,"terrain",T,C))return}if(!this.terrain||this.terrain.scope!==this.scope&&!w||this.terrain&&u!==this.terrain.drapeRenderMode){if(!_)return;this._createTerrain(_,u),this.fire(new i.A("data",{dataType:"style"}))}else{const T=this.terrain,C=T.get();for(const z of Object.keys(i.a5.terrain))!_.hasOwnProperty(z)&&i.a5.terrain[z].default&&(_[z]=i.a5.terrain[z].default);for(const z in o)if(!i.bn(o[z],C[z])){T.set(o,this.options),this.stylesheet.terrain=o;const V=this._getTransitionParameters({duration:0});T.updateTransitions(V),this.fire(new i.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){const u=this.fog=new qr(o,this.map.transform,this.scope,this.options);this.stylesheet.fog=u.get();const _=this._getTransitionParameters({duration:0});u.updateTransitions(_)}_createSnow(o){const u=this.snow=new Gr(o,this.map.transform,this.scope,this.options);this.stylesheet.snow=u.get();const _=this._getTransitionParameters({duration:0});u.updateTransitions(_)}_createRain(o){const u=this.rain=new Ni(o,this.map.transform,this.scope,this.options);this.stylesheet.rain=u.get();const _=this._getTransitionParameters({duration:0});u.updateTransitions(_)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const u=this.fog;if(!i.bn(u.get(),o)){u.set(o,this.options),this.stylesheet.fog=u.get();const _=this._getTransitionParameters({duration:0});u.updateTransitions(_)}}else this._createFog(o);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(o){if(this._checkLoaded(),!o)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const u=this.snow;if(!i.bn(u.get(),o)){u.set(o,this.options),this.stylesheet.snow=u.get();const _=this._getTransitionParameters({duration:0});u.updateTransitions(_)}}else this._createSnow(o);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(o){if(this._checkLoaded(),!o)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const u=this.rain;if(!i.bn(u.get(),o)){u.set(o,this.options),this.stylesheet.rain=u.get();const _=this._getTransitionParameters({duration:0});u.updateTransitions(_)}}else this._createRain(o);this._markersNeedUpdate=!0}_reloadColorTheme(){const o=()=>{for(const w in this._layers)this._layers[w].lut=this._styleColorTheme.lut;for(const w in this._sourceCaches)this._sourceCaches[w].clearTiles()},u=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!u)return this._styleColorTheme.lut=null,void o();const _=this._evaluateColorThemeData(u);this._loadColorTheme(_).then(()=>{this.fire(new i.A("colorthemeset")),o()}).catch(w=>{i.w(`Couldn't set color theme: ${w}`)})}setColorTheme(o){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&i.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=o,this._reloadColorTheme()}setImportColorTheme(o,u){const _=this.getFragmentStyle(o);_&&(_._styleColorTheme.colorThemeOverride=u,_._reloadColorTheme())}_getTransitionParameters(o){return{now:i.q.now(),transition:i.l(this.transition,o)}}updateDrapeFirstLayers(){if(!this.terrain)return;const o=[],u=[];for(const _ of this._mergedOrder)this.isLayerDraped(this._mergedLayers[_])?o.push(_):u.push(_);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...u)}_createTerrain(o,u){const _=this.terrain=new Gt(o,u,this.scope,this.options);u===1&&(this.stylesheet.terrain=o),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const w=this._getTransitionParameters({duration:0});_.updateTransitions(w)}_force3DLayerUpdate(){for(const o in this._layers){const u=this._layers[o];u.type==="fill-extrusion"&&this._updateLayer(u)}}_forceSymbolLayerUpdate(){for(const o in this._layers){const u=this._layers[o];u.type==="symbol"&&this._updateLayer(u)}}_validate(o,u,_,w,T={}){if(T&&T.validate===!1)return!1;const C=i.l({},this.serialize());return Va(this,o.call(Za,i.l({key:u,style:C,value:_,styleSpec:i.a5},w)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.cy.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._mergedLayers)this._mergedLayers[o].setEventedParent(null);for(const o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles(),this._mergedSourceCaches[o].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(o){const u=this.getSourceCaches(o);for(const _ of u)_.clearTiles()}clearSources(){for(const o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles()}reloadSource(o){const u=this.getSourceCaches(o);for(const _ of u)_.resume(),_.reload()}reloadSources(){for(const o of this.getSources())o.reload&&o.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(o=>{o.modelManager.reloadModels(o.scope)})}updateSources(o){let u;this.directionalLight&&(u=Sl(this.directionalLight));for(const _ in this._mergedSourceCaches)this._mergedSourceCaches[_].update(o,void 0,void 0,u)}_generateCollisionBoxes(){for(const o in this._sourceCaches){const u=this._sourceCaches[o];u.resume(),u.reload()}}_updatePlacement(o,u,_,w,T,C,z=!1){let V=!1,$=!1;const K={},ee={};for(const te of this._mergedOrder){const ce=this._mergedLayers[te];if(ce.type!=="symbol")continue;const Te=i.C(ce.source,ce.scope);let ve=K[Te];if(!ve){const Pe=this.getLayerSourceCache(ce);if(!Pe)continue;const qe=Pe.getRenderableIds(!0).map(Je=>Pe.getTileByID(Je));ee[Te]=qe.slice(),ve=K[Te]=qe.sort((Je,Ye)=>Ye.tileID.overscaledZ-Je.tileID.overscaledZ||(Je.tileID.isLessThan(Ye.tileID)?-1:1))}const Ce=this.crossTileSymbolIndex.addLayer(ce,ve,u.center.lng,u.projection);V=V||Ce}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),z=z||this._layerOrderChanged||w===0,this._layerOrderChanged&&this.fire(new i.A("neworder")),(z||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.q.now(),u.zoom))&&(this.pauseablePlacement=new Ai(u,this._mergedOrder,z,_,w,T,this.placement,this.fog&&u.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,K,ee,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.q.now()),$=!0),V&&this.pauseablePlacement.placement.setStale()),$||V){this._buildingIndex.onNewFrame(u.zoom);for(let te=0;te<this._mergedOrder.length;te++){const ce=this._mergedLayers[this._mergedOrder[te]];if(ce.type!=="symbol")continue;const Te=this.isLayerClipped(ce);this.placement.updateLayerOpacities(ce,K[i.C(ce.source,ce.scope)],te,Te?C:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.q.now())}}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}addImport(o,u){this._checkLoaded();const _=this.stylesheet.imports=this.stylesheet.imports||[];if(_.findIndex(({id:T})=>T===o.id)!==-1)return void this.fire(new i.z(new Error(`Import with id '${o.id}' already exists in the map's style.`)));if(!u)return _.push(o),this._loadImports([o],!0);const w=_.findIndex(({id:T})=>T===u);return w===-1&&this.fire(new i.z(new Error(`Import with id "${u}" does not exist on this map.`))),this.stylesheet.imports=_.slice(0,w).concat(o).concat(_.slice(w)),this._loadImports([o],!0,u)}updateImport(o,u){this._checkLoaded();const _=this.stylesheet.imports||[],w=this.getImportIndex(o);return w===-1?this:typeof u=="string"?(this.setImportUrl(o,u),this):(u.url&&u.url!==_[w].url&&this.setImportUrl(o,u.url),i.bn(u.config,_[w].config)||this.setImportConfig(o,u.config,u.data.schema),i.bn(u.data,_[w].data)||this.setImportData(o,u.data),this)}moveImport(o,u){this._checkLoaded();let _=this.stylesheet.imports||[];const w=this.getImportIndex(o);if(w===-1)return this;const T=this.getImportIndex(u);if(T===-1)return this;const C=_[w],z=this.fragments[w];return _=_.filter(({id:V})=>V!==o),this.fragments=this.fragments.filter(({id:V})=>V!==o),this.stylesheet.imports=_.slice(0,T).concat(C).concat(_.slice(T)),this.fragments=this.fragments.slice(0,T).concat(z).concat(this.fragments.slice(T)),this.mergeLayers(),this}setImportUrl(o,u){this._checkLoaded();const _=this.stylesheet.imports||[],w=this.getImportIndex(o);if(w===-1)return this;_[w].url=u;const T=this.fragments[w];return T.style=this._createFragmentStyle(_[w]),T.style.on("style.import.load",()=>this.mergeAll()),T.style.loadURL(u),this}setImportData(o,u){this._checkLoaded();const _=this.getImportIndex(o),w=this.stylesheet.imports||[];return _===-1?this:u?(this.fragments[_].style.setState(u),this._reloadImports(),this):(delete w[_].data,this.setImportUrl(o,w[_].url))}setImportConfig(o,u,_){this._checkLoaded();const w=this.getImportIndex(o),T=this.stylesheet.imports||[];if(w===-1)return this;u?T[w].config=u:delete T[w].config;const C=this.fragments[w];_&&C.style.stylesheet&&(C.style.stylesheet.schema=_);const z=C.style.stylesheet&&C.style.stylesheet.schema;return C.config=u,C.style.updateConfig(u,z),this.updateConfigDependencies(),this}removeImport(o){this._checkLoaded();const u=this.stylesheet.imports||[],_=this.getImportIndex(o);_!==-1&&(u.splice(_,1),this.fragments[_].style._remove(),this.fragments.splice(_,1),this._reloadImports())}getImportIndex(o){const u=(this.stylesheet.imports||[]).findIndex(_=>_.id===o);return u===-1&&this.fire(new i.z(new Error(`Import '${o}' does not exist in the map's style and cannot be updated.`))),u}getLayer(o){return this._mergedLayers[o]}getSources(){const o=[];for(const u in this._mergedOtherSourceCaches){const _=this._mergedOtherSourceCaches[u];_&&o.push(_.getSource())}return o}getSource(o,u){const _=this.getSourceCache(o,u);return _&&_.getSource()}getLayerSource(o){const u=this.getLayerSourceCache(o);return u&&u.getSource()}getSourceCache(o,u){const _=i.C(o,u);return this._mergedOtherSourceCaches[_]}getLayerSourceCache(o){const u=i.C(o.source,o.scope);return o.type==="symbol"?this._mergedSymbolSourceCaches[u]:this._mergedOtherSourceCaches[u]}getSourceCaches(o){if(o==null)return Object.values(this._mergedSourceCaches);const u=[];return this._mergedOtherSourceCaches[o]&&u.push(this._mergedOtherSourceCaches[o]),this._mergedSymbolSourceCaches[o]&&u.push(this._mergedSymbolSourceCaches[o]),u}updateSourceCaches(){const o=this._changes.getUpdatedSourceCaches();for(const u in o){const _=o[u];_==="reload"?this.reloadSource(u):_==="clear"&&this.clearSource(u)}}updateLayers(o){const u=this._changes.getUpdatedPaintProperties();for(const _ of u){const w=this.getLayer(_);w&&w.updateTransitions(o)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(o){this.stylesheet.glyphs=o,this.glyphManager.setURL(o,this.scope)}getImages(o,u,_){this.imageManager.getImages(u.images,u.scope,_),this._updateTilesForChangedImages();const w=C=>{if(C){const z=u.images.map(V=>i.I.toString(V));C.setDependencies(u.tileID.key,u.type,z)}},T=i.C(u.source,u.scope);w(this._mergedOtherSourceCaches[T]),w(this._mergedSymbolSourceCaches[T])}rasterizeImages(o,u,_){this.imageManager.rasterizeImages(u,_)}getGlyphs(o,u,_){this.glyphManager.getGlyphs(u.stacks,u.scope,_)}getResource(o,u,_){return i.cz(u,_)}getOwnSourceCache(o){return this._otherSourceCaches[o]}getOwnLayerSourceCache(o){return o.type==="symbol"?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}getOwnSourceCaches(o){const u=[];return this._otherSourceCaches[o]&&u.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&u.push(this._symbolSourceCaches[o]),u}_isSourceCacheLoaded(o){const u=this.getOwnSourceCaches(o);return u.length===0?(this.fire(new i.z(new Error(`There is no source with ID '${o}'`))),!1):u.every(_=>_.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(o,u){if(!this._clipLayerPresent&&o.type!=="fill-extrusion")return!1;const _=o.type==="fill-extrusion"&&o.sourceLayer==="building";if(o.is3D(!!this.terrain)){if(_||u&&u.type==="batched-model"||o.type==="model")return!0}else if(o.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(o=>{o.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Js.getSourceType=function(y){return Fl[y]},Js.setSourceType=function(y,o){Fl[y]=o},Js.registerForPluginStateChange=i.ci;var ku=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,fu=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,mc=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Nu="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",gc=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,zu=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,du=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Uc=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,jo=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,ls=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Yi=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return clamp(mix(lerpx.x,lerpx.y,f.y),0.0,1.0);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const ea=[];Xl(ku,ea),Xl(mc,ea),Xl(fu,ea);const $a={"_prelude_fog.vertex.glsl":zu,"_prelude_terrain.vertex.glsl":gc,"_prelude_shadow.vertex.glsl":ls,"_prelude_fog.fragment.glsl":du,"_prelude_shadow.fragment.glsl":Yi,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Uc,"_prelude_raster_particle.glsl":jo},rs={};ni("",gc),ni(du,zu),ni(Yi,ls),ni(Uc,""),ni(jo,"");const Yl=ni(fu,mc),Bu=ku;var Zo={background:ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:ni("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ni(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:ni(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ni("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:ni("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:ni("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:ni(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:ni(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
void main() {vec3 color=vec3(241.0/255.0,236.0/255.0,225.0/255.0);
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,normal);
#endif
if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(v_normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:ni(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:ni(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:ni(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:ni(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),0.001);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:ni("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:ni("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:ni(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:ni(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#endif
}`),terrainRaster:ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:ni("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:ni(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Nu),skyboxGradient:ni(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Nu),skyboxCapture:ni(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:ni(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:ni(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:ni(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:ni("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:ni("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:ni("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:ni("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Xl(y,o){const u=y.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let _ of u)if(_=_.trim(),_[0]==="#"&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const w=_.split(" ");for(const T of w)o.includes(T)||o.push(T)}}function ni(y,o){const u=/#include\s+"([^"]+)"/g,_=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let w=o.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);w&&(w=w.map($=>{const K=$.split(" ");return K[K.length-1]}),w=[...new Set(w)]);const T={},C=[],z=[];if(y=y.replace(u,($,K)=>(z.push(K),"")),(o=o.replace(u,($,K)=>(C.push(K),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let V=[...ea];Xl(y,V),Xl(o,V);for(const $ of[...C,...z])$a[$]||console.error(`Undefined include: ${$}`),rs[$]||(rs[$]=[],Xl($a[$],rs[$])),V=[...V,...rs[$]];return{fragmentSource:y=y.replace(_,($,K,ee,te,ce)=>(T[ce]=!0,K==="define"?`
#ifndef HAS_UNIFORM_u_${ce}
in ${ee} ${te} ${ce};
#else
uniform ${ee} ${te} u_${ce};
#endif
`:K==="initialize"?`
#ifdef HAS_UNIFORM_u_${ce}
    ${ee} ${te} ${ce} = u_${ce};
#endif
`:K==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${ce}
    in ${ee} ${te} ${ce};
#endif
`:K==="initialize-attribute"?"":void 0)),vertexSource:o=o.replace(_,($,K,ee,te,ce)=>{const Te=te==="float"?"vec2":te,ve=ce.match(/color/)?"color":Te;return K==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${ce}
in ${ee} ${te} a_${ce};
#endif
`:T[ce]?K==="define"?`
#ifndef HAS_UNIFORM_u_${ce}
uniform lowp float u_${ce}_t;
in ${ee} ${Te} a_${ce};
out ${ee} ${te} ${ce};
#else
uniform ${ee} ${te} u_${ce};
#endif
`:K==="initialize"?ve==="vec4"?`
#ifndef HAS_UNIFORM_u_${ce}
    ${ce} = a_${ce};
#else
    ${ee} ${te} ${ce} = u_${ce};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ce}
    ${ce} = unpack_mix_${ve}(a_${ce}, u_${ce}_t);
#else
    ${ee} ${te} ${ce} = u_${ce};
#endif
`:K==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${ce}
    in ${ee} ${te} a_${ce};
    out ${ee} ${te} ${ce};
#endif
`:K==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${ce}
    ${ce} = a_${ce};
#endif
`:void 0:K==="define"?`
#ifndef HAS_UNIFORM_u_${ce}
uniform lowp float u_${ce}_t;
in ${ee} ${Te} a_${ce};
#else
uniform ${ee} ${te} u_${ce};
#endif
`:K==="define-instanced"?ve==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${ce}0;
in vec4 a_${ce}1;
in vec4 a_${ce}2;
in vec4 a_${ce}3;
#else
uniform ${ee} ${te} u_${ce};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${ee} ${Te} a_${ce};
#else
uniform ${ee} ${te} u_${ce};
#endif
`:K==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${ce}
    ${ee} ${te} ${ce} = a_${ce};
#endif
`:ve==="vec4"?`
#ifndef HAS_UNIFORM_u_${ce}
    ${ee} ${te} ${ce} = a_${ce};
#else
    ${ee} ${te} ${ce} = u_${ce};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ce}
    ${ee} ${te} ${ce} = unpack_mix_${ve}(a_${ce}, u_${ce}_t);
#else
    ${ee} ${te} ${ce} = u_${ce};
#endif
`}),staticAttributes:w,usedDefines:V,vertexIncludes:C,fragmentIncludes:z}}class ju{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(o,u,_,w,T,C,z,V){this.context=o;let $=this.boundPaintVertexBuffers.length!==w.length;for(let ee=0;!$&&ee<w.length;ee++)this.boundPaintVertexBuffers[ee]!==w[ee]&&($=!0);let K=this.boundDynamicVertexBuffers.length!==z.length;for(let ee=0;!K&&ee<z.length;ee++)this.boundDynamicVertexBuffers[ee]!==z[ee]&&(K=!0);if(!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==_||$||K||this.boundIndexBuffer!==T||this.boundVertexOffset!==C)this.freshBind(u,_,w,T,C,z,V);else{o.bindVertexArrayOES.set(this.vao);for(const ee of z)ee&&(ee.bind(),V&&ee.instanceCount&&ee.setVertexAttribDivisor(o.gl,u,V));T&&T.dynamicDraw&&T.bind()}}freshBind(o,u,_,w,T,C,z){const V=o.numAttributes,$=this.context,K=$.gl;this.vao&&this.destroy(),this.vao=$.gl.createVertexArray(),$.bindVertexArrayOES.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=w,this.boundVertexOffset=T,this.boundDynamicVertexBuffers=C,u.enableAttributes(K,o),u.bind(),u.setVertexAttribPointers(K,o,T);for(const ee of _)ee.enableAttributes(K,o),ee.bind(),ee.setVertexAttribPointers(K,o,T);for(const ee of C)ee&&(ee.enableAttributes(K,o),ee.bind(),ee.setVertexAttribPointers(K,o,T),z&&ee.instanceCount&&ee.setVertexAttribDivisor(K,o,z));w&&w.bind(),$.currentNumAttributes=V}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function El(y,o){const u=Math.pow(2,o.canonical.z),_=o.canonical.y;return[new i.ac(0,_/u).toLngLat().lat,new i.ac(0,(_+1)/u).toLngLat().lat]}function Qa(y,o,u,_,w,T,C){const z=y.context,V=z.gl,$=u.hillshadeFBO;if(!$)return;y.prepareDrawTile();const K=y.isTileAffectedByFog(o),ee=y.getOrCreateProgram("hillshade",{overrideFog:K});z.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,$.colorAttachment.get());const te=((Ce,Pe,qe,Je)=>{const Ye=qe.paint.get("hillshade-shadow-color"),lt=qe.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",nt=qe.paint.get("hillshade-highlight-color"),rt=qe.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",it=qe.paint.get("hillshade-accent-color"),dt=qe.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",xt=qe.paint.get("hillshade-emissive-strength");let Xt=i.ak(qe.paint.get("hillshade-illumination-direction"));if(qe.paint.get("hillshade-illumination-anchor")==="viewport")Xt-=Ce.transform.angle;else if(Ce.style&&Ce.style.enable3dLights()&&Ce.style.directionalLight){const tn=Ce.style.directionalLight.properties.get("direction"),un=i.cc(tn.x,tn.y,tn.z);Xt=i.ak(un[1])}const zt=!Ce.options.moving;return{u_matrix:Je||Ce.transform.calculateProjMatrix(Pe.tileID.toUnwrapped(),zt),u_image:0,u_latrange:El(0,Pe.tileID),u_light:[qe.paint.get("hillshade-exaggeration"),Xt],u_shadow:Ye.toRenderColor(lt?null:qe.lut),u_highlight:nt.toRenderColor(rt?null:qe.lut),u_emissive_strength:xt,u_accent:it.toRenderColor(dt?null:qe.lut)}})(y,u,_,y.terrain?o.projMatrix:null);y.uploadCommonUniforms(z,ee,o.toUnwrapped());const{tileBoundsBuffer:ce,tileBoundsIndexBuffer:Te,tileBoundsSegments:ve}=y.getTileBoundsBuffers(u);ee.draw(y,V.TRIANGLES,w,T,C,br.disabled,te,_.id,ce,Te,ve)}function pu(y,o,u){if(!o.needsDEMTextureUpload)return;const _=y.context,w=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||y.getTileTexture(u.stride);const T=u.getPixels();o.demTexture?o.demTexture.update(T,{premultiply:!1}):o.demTexture=new i.T(_,T,w.R32F,{premultiply:!1}),o.needsDEMTextureUpload=!1}function Mh(y,o,u){const _=y.context,w=_.gl;if(!o.dem)return;const T=o.dem;if(_.activeTexture.set(w.TEXTURE1),pu(y,o,T),!o.demTexture)return;o.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);const C=T.dim;_.activeTexture.set(w.TEXTURE0);let z=o.hillshadeFBO;if(!z){const te=new i.T(_,{width:C,height:C,data:null},w.RGBA8);te.bind(w.LINEAR,w.CLAMP_TO_EDGE),z=o.hillshadeFBO=_.createFramebuffer(C,C,!0,"renderbuffer"),z.colorAttachment.set(te.texture)}_.bindFramebuffer.set(z.framebuffer),_.viewport.set([0,0,C,C]);const{tileBoundsBuffer:V,tileBoundsIndexBuffer:$,tileBoundsSegments:K}=y.getMercatorTileBoundsBuffers(),ee=[];y.linearFloatFilteringSupported()&&ee.push("TERRAIN_DEM_FLOAT_FORMAT"),y.getOrCreateProgram("hillshadePrepare",{defines:ee}).draw(y,w.TRIANGLES,sr.disabled,Sr.disabled,Mr.unblended,br.disabled,((te,ce)=>{const Te=ce.stride,ve=i.ad.mat4.create();return i.ad.mat4.ortho(ve,0,i.ai,-i.ai,0,0,1),i.ad.mat4.translate(ve,ve,[0,-i.ai,0]),{u_matrix:ve,u_image:1,u_dimension:[Te,Te],u_zoom:te.overscaledZ}})(o.tileID,T),u.id,V,$,K),o.needsHillshadePrepare=!1}class ua{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Rf extends ua{getDefault(){return i.al.transparent}set(o){const u=this.current;(o.r!==u.r||o.g!==u.g||o.b!==u.b||o.a!==u.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Jo extends ua{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class hl extends ua{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class Fu extends ua{getDefault(){return[!0,!0,!0,!0]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||o[3]!==u[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class yc extends ua{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class qc extends ua{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class mu extends ua{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const u=this.current;(o.func!==u.func||o.ref!==u.ref||o.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Np extends ua{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Df extends ua{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=o,this.dirty=!1}}class Lf extends ua{getDefault(){return[0,1]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Qo extends ua{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=o,this.dirty=!1}}class Ha extends ua{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class _a extends ua{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.BLEND):u.disable(u.BLEND),this.current=o,this.dirty=!1}}class Zl extends ua{getDefault(){const o=this.gl;return[o.ONE,o.ZERO,o.ONE,o.ZERO]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||o[3]!==u[3]||this.dirty)&&(this.gl.blendFuncSeparate(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class _c extends ua{getDefault(){return i.al.transparent}set(o){const u=this.current;(o.r!==u.r||o.g!==u.g||o.b!==u.b||o.a!==u.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class $d extends ua{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(o,o),this.current=o,this.dirty=!1)}}class gu extends ua{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=o,this.dirty=!1}}class md extends ua{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class Ch extends ua{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}let kf=class extends ua{getDefault(){return null}set(y){(y!==this.current||this.dirty)&&(this.gl.useProgram(y),this.current=y,this.dirty=!1)}};class Nf extends ua{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Ih extends ua{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||o[3]!==u[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class gd extends ua{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class Lm extends ua{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class af extends ua{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class Cg extends ua{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class yu extends ua{getDefault(){return null}set(o){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Vc extends ua{getDefault(){return null}set(o){this.gl&&(o!==this.current||this.dirty)&&(this.gl.bindVertexArray(o),this.current=o,this.dirty=!1)}}class vc extends ua{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class Ig extends ua{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class zf extends ua{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class fl extends ua{constructor(o,u){super(o),this.context=o,this.parent=u}getDefault(){return null}}class el extends fl{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Bf extends fl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Ph extends fl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,this.attachment(),u.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class zp extends Bf{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Bp=(y,o,u)=>({u_matrix:y,u_image0:0,u_skirt_height:o,u_ground_shadow_factor:u}),Uu=(y,o,u,_,w,T,C,z,V,$,K,ee,te,ce,Te,ve)=>({u_proj_matrix:Float32Array.from(y),u_globe_matrix:o,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:u,u_zoom_transition:w,u_merc_center:T,u_image0:0,u_frustum_tl:C,u_frustum_tr:z,u_frustum_br:V,u_frustum_bl:$,u_globe_pos:K,u_globe_radius:ee,u_viewport:te,u_grid_matrix:ve?Float32Array.from(ve):new Float32Array(9),u_skirt_height:ce,u_far_z_cutoff:Te});function yd(y,o){return y!=null&&o!=null&&!(!y.hasData()||!o.hasData())&&y.demTexture!=null&&o.demTexture!=null&&y.tileID.key!==o.tileID.key}const tl=new class{constructor(){this.operations={}}newMorphing(y,o,u,_,w){if(y in this.operations){const T=this.operations[y];T.to.tileID.key!==u.tileID.key&&(T.queued=u)}else this.operations[y]={startTime:_,phase:0,duration:w,from:o,to:u,queued:null}}getMorphValuesForProxy(y){if(!(y in this.operations))return null;const o=this.operations[y];return{from:o.from,to:o.to,phase:o.phase}}update(y){for(const o in this.operations){const u=this.operations[o];for(u.phase=(y-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,y)){delete this.operations[o];break}}}_nextOp(y,o){return!!y.queued&&(y.from=y.to,y.to=y.queued,y.queued=null,y.phase=0,y.startTime=o,!0)}_validOp(y){return y.from.hasData()&&y.to.hasData()}},Oh={0:null,1:"TERRAIN_VERTEX_MORPHING"};function bc(y,o,u){if(o===0)return 0;const _=o<1&&u===514?.25/o:1;return 6*Math.pow(1.5,22-y)*Math.max(o,1)*_}function Rh(y,o){const u=1<<y.z;return!o&&(y.x===0||y.x===u-1)||y.y===0||y.y===u-1}const qu=y=>({u_matrix:y});function Ml(y,o,u,_,w){if(w>0){const T=i.q.now(),C=(T-y.timeAdded)/w,z=o?(T-o.timeAdded)/w:-1,V=u.getSource(),$=_.coveringZoomLevel({tileSize:V.tileSize,roundZoom:V.roundZoom}),K=!o||Math.abs(o.tileID.overscaledZ-$)>Math.abs(y.tileID.overscaledZ-$),ee=K&&y.refreshedUponExpiration?1:i.ay(K?C:1-z,0,1);return y.refreshedUponExpiration&&C>=1&&(y.refreshedUponExpiration=!1),o?{opacity:1,mix:1-ee}:{opacity:ee,mix:0}}return{opacity:1,mix:0}}class $c extends Ko{constructor(o){const u={type:"raster-dem",maxzoom:o.transform.maxZoom},_=new i.D(i.cj(),null),w=Do("mock-dem",u,_,o.style);super("mock-dem",w,!1),w.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,u){o.state="loaded",u(null)}}class Vu extends Ko{constructor(o){const u=Do("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},new i.D(i.cj(),null),o.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,u,_){if(o.freezeTileCoverage)return;this.transform=o;const w=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((T,C)=>{if(T[C.key]="",!this._tiles[C.key]){const z=new ql(C,this._source.tileSize*C.overscaleFactor(),o.tileZoom);z.state="loaded",this._tiles[C.key]=z}return T},{});for(const T in this._tiles)T in w||(this.freeFBO(T),this._tiles[T].unloadVectorData(),delete this._tiles[T])}freeFBO(o){const u=this.proxyCachedFBO[o];if(u!==void 0){const _=Object.values(u);this.renderCachePool.push(..._),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Hd extends i.aH{constructor(o,u,_){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=u,this.projMatrix=_}}class Dh extends i.cK{constructor(o,u){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},o.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),o.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),o.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,w,T]=function(V){const $=new i.b5,K=new i.aV,ee=131;$.reserve(17161),K.reserve(33800);const te=i.ai/128,ce=i.ai+te/2,Te=ce+te;for(let Ce=-te;Ce<Te;Ce+=te)for(let Pe=-te;Pe<Te;Pe+=te){const qe=Pe<0||Pe>ce||Ce<0||Ce>ce?24575:0,Je=i.ay(Math.round(Pe),0,i.ai),Ye=i.ay(Math.round(Ce),0,i.ai);$.emplaceBack(Je+qe,Ye)}const ve=(Ce,Pe)=>{const qe=Pe*ee+Ce;K.emplaceBack(qe+1,qe,qe+ee),K.emplaceBack(qe+ee,qe+ee+1,qe+1)};for(let Ce=1;Ce<129;Ce++)for(let Pe=1;Pe<129;Pe++)ve(Pe,Ce);return[0,129].forEach(Ce=>{for(let Pe=0;Pe<130;Pe++)ve(Pe,Ce),ve(Ce,Pe)}),[$,K,32768]}(),C=o.context;this.gridBuffer=C.createVertexBuffer(_,i.b7.members),this.gridIndexBuffer=C.createIndexBuffer(w),this.gridSegments=i.b8.simpleSegment(0,0,_.length,w.length),this.gridNoSkirtSegments=i.b8.simpleSegment(0,0,_.length,T),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Vu(u.map),this.orthoMatrix=i.ad.mat4.create(),i.ad.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.ai,0,i.ai,0,1);const z=C.gl;this._overlapStencilMode=new Sr({func:z.GEQUAL,mask:255},0,255,z.KEEP,z.KEEP,z.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new $c(u.map),this._pendingGroundEffectLayers=[]}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),this._style=o,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(o,u,_){if(o&&o.terrain){this._style!==o&&(this.style=o,this._evaluationZoom=void 0);const w=o.terrain.properties,T=o.terrain.drapeRenderMode===0,C=o.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.q.now();const z=o.terrain&&o.terrain.scope,V=w.get("source"),$=T?this._mockSourceCache:o.getSourceCache(V,z);if(!$)return void i.w(`Couldn't find terrain source "${V}".`);if(this.sourceCache=$,this._attenuationRange=o.terrain.getAttenuationRange(),this._exaggeration=C?this.calculateExaggeration(u):w.get("exaggeration"),!u.projection.requiresDraping&&C&&this._exaggeration===0)return void this._disable();this.enabled=!0;const K=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const ee=this.getScaledDemTileSize();this.sourceCache.update(u,ee,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,K(),this._initializing=!0),K(),u.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0,this._previousZoom=u.zoom}else this._disable()}calculateExaggeration(o){if(this._attenuationRange&&o.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(o.zoom);const u=this._previousCameraAltitude,_=o.getFreeCameraOptions().position.z/o.pixelsPerMeter*o.worldSize;this._previousCameraAltitude=_;const w=u!=null?_-u:Number.MAX_VALUE;if(Math.abs(w)<2)return this._exaggeration;const T=o.zoom,C=this._style.terrain;if(!this._previousUpdateTimestamp)return C.getExaggeration(T);let z=T-this._previousZoom;const V=this._previousUpdateTimestamp;let $=T;this._evaluationZoom!=null&&($=this._evaluationZoom,Math.abs(T-$)>.5&&(z=.5*(T-$+z)),z*w<0&&($+=z)),this._evaluationZoom=$;const K=C.getExaggeration($),ee=K===C.getExaggeration(Math.max(0,$-.1));if(ee&&Math.abs(K-this._exaggeration)<.01)return K;let te=Math.min(.1,.00375*(this._updateTimestamp-V));return(ee||K<.1||Math.abs(z)<1e-4)&&(te=Math.min(.2,4*te)),i.ah(this._exaggeration,K,te)}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(o){o.coord&&o.dataType==="source"?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):o.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._mergedSourceCaches)this._style._mergedSourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const u=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=_._centerAltitude===0&&this.getAtPointOrZero(i.ac.fromLngLat(_.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const w=this.proxyCoords=u.getIds().map(V=>{const $=u.getTileByID(V).tileID;return $.projMatrix=_.calculateProjMatrix($.toUnwrapped()),$});(function(V,$){const K=$.transform.pointCoordinate($.transform.getCameraPoint()),ee=new i.P(K.x,K.y);V.sort((te,ce)=>{if(ce.overscaledZ-te.overscaledZ)return ce.overscaledZ-te.overscaledZ;const Te=new i.P(te.canonical.x+(1<<te.canonical.z)*te.wrap,te.canonical.y),ve=new i.P(ce.canonical.x+(1<<ce.canonical.z)*ce.wrap,ce.canonical.y),Ce=ee.mult(1<<te.canonical.z);return Ce.x-=.5,Ce.y-=.5,Ce.distSqr(Te)-Ce.distSqr(ve)})})(w,this.painter);const T=this.proxyToSource||{};this.proxyToSource={},w.forEach(V=>{this.proxyToSource[V.key]={}}),this.terrainTileForTile={};const C=this._style._mergedSourceCaches;for(const V in C){const $=C[V];if(!$.used||($!==this.sourceCache&&this.resetTileLookupCache($.id),this._setupProxiedCoordsForOrtho($,o[V],T),$.usedForTerrain))continue;const K=o[V];$.getSource().reparseOverscaled&&this._assignTerrainTiles(K)}this.proxiedCoords[u.id]=w.map(V=>new Hd(V,V.key,this.orthoMatrix)),this._assignTerrainTiles(w),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(T),this.renderingToTexture=!1;const z={};this._visibleDemTiles=[];for(const V of this.proxyCoords){const $=this.terrainTileForTile[V.key];if(!$)continue;const K=$.tileID.key;K in z||(this._visibleDemTiles.push($),z[K]=K)}}_assignTerrainTiles(o){this._initializing||o.forEach(u=>{if(this.terrainTileForTile[u.key])return;const _=this._findTileCoveringTileID(u,this.sourceCache);_&&(this.terrainTileForTile[u.key]=_)})}_prepareDEMTextures(){const o=this.painter.context,u=o.gl;for(const _ in this.terrainTileForTile){const w=this.terrainTileForTile[_],T=w.dem;!T||w.demTexture&&!w.needsDEMTextureUpload||(o.activeTexture.set(u.TEXTURE1),pu(this.painter,w,T))}}_prepareDemTileUniforms(o,u,_,w){if(!u||u.demTexture==null)return!1;const T=o.tileID.canonical,C=Math.pow(2,u.tileID.canonical.z-T.z),z=w||"";return _[`u_dem_tl${z}`]=[T.x*C%1,T.y*C%1],_[`u_dem_scale${z}`]=C,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let o=0;const u=this._visibleDemTiles.reduce((_,w)=>{if(!w.dem)return _;const T=w.dem.tree.minimums[0];return T>0&&o++,_+T},0);return o?u/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,u=o.gl;o.activeTexture.set(u.TEXTURE2);const _=this._getLoadedAreaMinimum(),w=new i.cL({width:1,height:1},new Float32Array([_]));this._emptyDEMTextureDirty=!1;let T=this._emptyDEMTexture;return T?T.update(w,{premultiply:!1}):T=this._emptyDEMTexture=new i.T(o,w,u.R32F,{premultiply:!1}),T}setupElevationDraw(o,u,_){const w=this.painter.context,T=w.gl,C={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};C.u_exaggeration=this.exaggeration();let z=null,V=null,$=1;if(_&&_.morphing&&this._useVertexMorphing){const ce=_.morphing.srcDemTile,Te=_.morphing.dstDemTile;$=_.morphing.phase,ce&&Te&&(this._prepareDemTileUniforms(o,ce,C,"_prev")&&(V=ce),this._prepareDemTileUniforms(o,Te,C)&&(z=Te))}const K=ce=>ce&&ce.demTexture&&this.painter.linearFloatFilteringSupported()?T.LINEAR:T.NEAREST;let ee=null;var te;if(this.enabled?V&&z?(ee=z.demTexture,w.activeTexture.set(T.TEXTURE4),V.demTexture.bind(K(V),T.CLAMP_TO_EDGE),C.u_dem_lerp=$):(z=this.terrainTileForTile[o.tileID.key],ee=this._prepareDemTileUniforms(o,z,C)?z.demTexture:this.emptyDEMTexture):ee=this.emptyDEMTexture,w.activeTexture.set(T.TEXTURE2),ee&&(C.u_dem_size=(te=ee).size[0]===1?1:te.size[0]-2,ee.bind(K(z),T.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(_&&_.useDepthForOcclusion,u,C),_&&_.useMeterToDem&&z){const ce=(1<<z.tileID.canonical.z)*i.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;C.u_meter_to_dem=ce}if(_&&_.labelPlaneMatrixInv&&(C.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),u.setTerrainUniformValues(w,C),this.painter.transform.projection.name==="globe"){const ce=this.globeUniformValues(this.painter.transform,o.tileID.canonical,_&&_.useDenormalizedUpVectorScale);u.setGlobeUniformValues(w,ce)}}globeUniformValues(o,u,_){const w=o.projection;return{u_tile_tl_up:w.upVector(u,0,0),u_tile_tr_up:w.upVector(u,i.ai,0),u_tile_br_up:w.upVector(u,i.ai,i.ai),u_tile_bl_up:w.upVector(u,0,i.ai),u_tile_up_scale:_?i.cM(1):w.upVectorScale(u,o.center.lat,o.worldSize).metersToTile}}renderToBackBuffer(o){const u=this.painter,_=this.painter.context;o.length!==0&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,u.width,u.height]),u.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(w,T,C,z,V){if(w.transform.projection.name==="globe")(function($,K,ee,te,ce){const Te=$.context,ve=Te.gl;let Ce,Pe;const qe=$.transform,Je=i.cD($,Te,qe),Ye=(tn,un)=>{if(Pe===un)return;const Tn=[Oh[un],"PROJECTION_GLOBE_VIEW"];Je&&Tn.push("CUSTOM_ANTIALIASING");const Lt=$.isTileAffectedByFog(tn);Ce=$.getOrCreateProgram("globeRaster",{defines:Tn,overrideFog:Lt}),Pe=un},lt=$.colorModeForRenderPass(),nt=new sr(ve.LEQUAL,sr.ReadWrite,$.depthRangeFor3D);tl.update(ce);const rt=i.cE(qe),it=[i.av(qe.center.lng),i.aC(qe.center.lat)],dt=$.globeSharedBuffers,xt=[qe.width*i.q.devicePixelRatio,qe.height*i.q.devicePixelRatio],Xt=Float32Array.from(qe.globeMatrix),zt={useDenormalizedUpVectorScale:!0};{const tn=$.transform,un=bc(tn.zoom,K.exaggeration(),K.sourceCache._source.tileSize);Pe=-1;const Tn=ve.TRIANGLES;for(const Lt of te){const an=ee.getTile(Lt),Pt=Sr.disabled,sn=K.prevTerrainTileForTile[Lt.key],Qt=K.terrainTileForTile[Lt.key];yd(sn,Qt)&&tl.newMorphing(Lt.key,sn,Qt,ce,250),Te.activeTexture.set(ve.TEXTURE0),an.texture&&an.texture.bind(ve.LINEAR,ve.CLAMP_TO_EDGE);const fn=tl.getMorphValuesForProxy(Lt.key),Wt=fn?1:0;fn&&i.L(zt,{morphing:{srcDemTile:fn.from,dstDemTile:fn.to,phase:i.cC(fn.phase)}});const mn=i.cF(Lt.canonical),zn=i.cG(mn.getCenter().lat),Bn=i.cH(Lt.canonical,mn,zn,tn.worldSize/tn._pixelsPerMercatorPixel),In=i.bc(i.cI(Lt.canonical)),or=Uu(tn.expandedFarZProjMatrix,Xt,rt,In,i.ag(tn.zoom),it,tn.frustumCorners.TL,tn.frustumCorners.TR,tn.frustumCorners.BR,tn.frustumCorners.BL,tn.globeCenterInViewSpace,tn.globeRadius,xt,un,tn._farZ,Bn);if(Ye(Lt,Wt),Ce&&(K.setupElevationDraw(an,Ce,zt),$.uploadCommonUniforms(Te,Ce,Lt.toUnwrapped()),dt)){const[Br,mr,Dr]=dt.getGridBuffers(zn,un!==0);Ce.draw($,Tn,nt,Pt,lt,br.backCCW,or,"globe_raster",Br,mr,Dr)}}}if(dt&&($.renderDefaultNorthPole||$.renderDefaultSouthPole)){const tn=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Je&&tn.push("CUSTOM_ANTIALIASING"),Ce=$.getOrCreateProgram("globeRaster",{defines:tn});for(const un of te){const{x:Tn,y:Lt,z:an}=un.canonical,Pt=Lt===0,sn=Lt===(1<<an)-1,[Qt,fn,Wt,mn]=dt.getPoleBuffers(an,!1);if(mn&&(Pt||sn)){const zn=ee.getTile(un);Te.activeTexture.set(ve.TEXTURE0),zn.texture&&zn.texture.bind(ve.LINEAR,ve.CLAMP_TO_EDGE);let Bn=i.cJ(an,Tn,qe);const In=i.bc(i.cI(un.canonical)),or=(Br,mr)=>Br.draw($,ve.TRIANGLES,nt,Sr.disabled,lt,br.disabled,Uu(qe.expandedFarZProjMatrix,Bn,Bn,In,0,it,qe.frustumCorners.TL,qe.frustumCorners.TR,qe.frustumCorners.BR,qe.frustumCorners.BL,qe.globeCenterInViewSpace,qe.globeRadius,xt,0,qe._farZ),"globe_pole_raster",mr,Wt,mn);K.setupElevationDraw(zn,Ce,zt),$.uploadCommonUniforms(Te,Ce,un.toUnwrapped()),Pt&&$.renderDefaultNorthPole&&or(Ce,Qt),sn&&$.renderDefaultSouthPole&&(Bn=i.ad.mat4.scale(i.ad.mat4.create(),Bn,[1,-1,1]),or(Ce,fn))}}}})(w,T,C,z,V);else{const $=w.context,K=$.gl;let ee,te;const ce=w.shadowRenderer,Te=Vs(w,w.longestCutoffRange),ve=lt=>{if(te===lt)return;const nt=[];nt.push(Oh[lt]),Te.shouldRenderCutoff&&nt.push("RENDER_CUTOFF"),ce&&(nt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),ce.useNormalOffset&&nt.push("NORMAL_OFFSET")),ee=w.getOrCreateProgram("terrainRaster",{defines:nt}),te=lt},Ce=w.colorModeForRenderPass(),Pe=new sr(K.LEQUAL,sr.ReadWrite,w.depthRangeFor3D);tl.update(V);const qe=w.transform,Je=bc(qe.zoom,T.exaggeration(),T.sourceCache._source.tileSize);let Ye=[0,0,0];if(ce){const lt=w.style.directionalLight,nt=w.style.ambientLight;lt&&nt&&(Ye=Du(w.style,lt,nt))}{te=-1;const lt=K.TRIANGLES,[nt,rt]=[T.gridIndexBuffer,T.gridSegments];for(const it of z){const dt=C.getTile(it),xt=Sr.disabled,Xt=T.prevTerrainTileForTile[it.key],zt=T.terrainTileForTile[it.key];yd(Xt,zt)&&tl.newMorphing(it.key,Xt,zt,V,250),$.activeTexture.set(K.TEXTURE0),dt.texture&&dt.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);const tn=tl.getMorphValuesForProxy(it.key),un=tn?1:0;let Tn;tn&&(Tn={morphing:{srcDemTile:tn.from,dstDemTile:tn.to,phase:i.cC(tn.phase)}});const Lt=Bp(it.projMatrix,Rh(it.canonical,qe.renderWorldCopies)?Je/10:Je,Ye);if(ve(un),!ee)continue;T.setupElevationDraw(dt,ee,Tn);const an=it.toUnwrapped();ce&&ce.setupShadows(an,ee),w.uploadCommonUniforms($,ee,an,null,Te),ee.draw(w,lt,Pe,xt,Ce,br.backCCW,Lt,"terrain_raster",T.gridBuffer,nt,rt)}}}}(u,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,u.gpuTimingDeferredRenderEnd(),o.splice(0,o.length))}renderBatch(o){if(this._drapedRenderBatches.length===0)return o+1;this.renderingToTexture=!0;const u=this.painter,_=this.painter.context,w=this.proxySourceCache,T=this.proxiedCoords[w.id],C=this._drapedRenderBatches.shift(),z=u.style.order,V=[];let $=0;for(const K of T){const ee=w.getTileByID(K.proxyTileKey),te=w.proxyCachedFBO[K.key]?w.proxyCachedFBO[K.key][o]:void 0,ce=te!==void 0?w.renderCache[te]:this.pool[$++],Te=te!==void 0;if(ee.texture=ce.tex,Te&&!ce.dirty){V.push(ee.tileID);continue}let ve;_.bindFramebuffer.set(ce.fb.framebuffer),this.renderedToTile=!1,ce.dirty&&(_.clear({color:i.al.transparent,stencil:0}),ce.dirty=!1);for(let Ce=C.start;Ce<=C.end;++Ce){const Pe=u.style._mergedLayers[z[Ce]];if(Pe.isHidden(u.transform.zoom))continue;const qe=u.style.getLayerSourceCache(Pe),Je=qe?this.proxyToSource[K.key][qe.id]:[K];if(!Je)continue;const Ye=Je;_.viewport.set([0,0,ce.fb.width,ce.fb.height]),ve!==(qe?qe.id:null)&&(this._setupStencil(ce,Je,Pe,qe),ve=qe?qe.id:null),u.renderLayer(u,qe,Pe,Ye)}if(this._drapedRenderBatches.length===0)for(const Ce of this._pendingGroundEffectLayers){const Pe=u.style._mergedLayers[z[Ce]];if(Pe.isHidden(u.transform.zoom))continue;const qe=u.style.getLayerSourceCache(Pe),Je=qe?this.proxyToSource[K.key][qe.id]:[K];if(!Je)continue;const Ye=Je;_.viewport.set([0,0,ce.fb.width,ce.fb.height]),ve!==(qe?qe.id:null)&&(this._setupStencil(ce,Je,Pe,qe),ve=qe?qe.id:null),u.renderLayer(u,qe,Pe,Ye)}this.renderedToTile?(ce.dirty=!0,V.push(ee.tileID)):Te||--$,$===5&&($=0,this.renderToBackBuffer(V))}return this.renderToBackBuffer(V),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,u.width,u.height]),C.end+1}postRender(){}isLayerOrderingCorrect(o){const u=o.order.length;let _=-1,w=u;for(let T=0;T<u;++T)this._style.isLayerDraped(o._mergedLayers[o.order[T]])?_=Math.max(_,T):w=Math.min(w,T);return w>_}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{o=Math.min(o,u.dem.tree.minimums[0])}),o===0?o:(o-30)*this._exaggeration}raycast(o,u,_){if(!this._visibleDemTiles)return null;const w=this._visibleDemTiles.filter(T=>T.dem).map(T=>{const C=T.tileID,z=1<<C.overscaledZ,{x:V,y:$}=C.canonical,K=V/z,ee=(V+1)/z,te=$/z,ce=($+1)/z;return{minx:K,miny:te,maxx:ee,maxy:ce,t:T.dem.tree.raycastRoot(K,te,ee,ce,o,u,_),tile:T}});w.sort((T,C)=>(T.t!==null?T.t:Number.MAX_VALUE)-(C.t!==null?C.t:Number.MAX_VALUE));for(const T of w){if(T.t==null)return null;const C=T.tile.dem.tree.raycast(T.minx,T.miny,T.maxx,T.maxy,o,u,_);if(C!=null)return C}return null}_createFBO(){const o=this.painter.context,u=o.gl,_=this.drapeBufferSize;o.activeTexture.set(u.TEXTURE0);const w=new i.T(o,{width:_[0],height:_[1],data:null},u.RGBA8);w.bind(u.LINEAR,u.CLAMP_TO_EDGE);const T=o.createFramebuffer(_[0],_[1],!0,null);return T.colorAttachment.set(w.texture),T.depthAttachment=new zp(o,T.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,T.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):T.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&u.texParameterf(u.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:T,tex:w,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const o in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const u=this._style._mergedLayers[o],_=u.isHidden(this.painter.transform.zoom);return u.type==="hillshade"||u.type==="custom"?!_&&u.shouldRedrape():!_&&u.hasTransition()})}_clearLineLayersFromRenderCache(){let o=!1;for(const _ of this._style.getSources())if(_ instanceof iu){o=!0;break}if(!o)return;const u={};for(let _=0;_<this._style.order.length;++_){const w=this._style._mergedLayers[this._style.order[_]],T=this._style.getLayerSourceCache(w);if(T&&!u[T.id]&&!w.isHidden(this.painter.transform.zoom)&&w.type==="line"&&w.widthExpression()instanceof i.ab){u[T.id]=!0;for(const C of this.proxyCoords){const z=this.proxyToSource[C.key][T.id];if(z)for(const V of z)this._clearRenderCacheForTile(T.id,V)}}}}_clearRasterLayersFromRenderCache(){let o=!1;for(const _ in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[_]._source instanceof Wo){o=!0;break}if(!o)return;const u={};for(let _=0;_<this._style.order.length;++_){const w=this._style._mergedLayers[this._style.order[_]],T=this._style.getLayerSourceCache(w);if(!T||u[T.id]||w.isHidden(this.painter.transform.zoom)||w.type!=="raster")continue;const C=w.paint.get("raster-fade-duration");for(const z of this.proxyCoords){const V=this.proxyToSource[z.key][T.id];if(V)for(const $ of V){const K=Ml(T.getTile($),T.findLoadedParent($,0),T,this.painter.transform,C);(K.opacity!==1||K.mix!==0)&&this._clearRenderCacheForTile(T.id,$)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const o=this._style.order,u=o.length;if(u===0)return;const _=[];this._pendingGroundEffectLayers=[];let w,T=0,C=this._style._mergedLayers[o[T]];for(;!this._style.isLayerDraped(C)&&C.isHidden(this.painter.transform.zoom)&&++T<u;)C=this._style._mergedLayers[o[T]];for(;T<u;++T){const z=this._style._mergedLayers[o[T]];z.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(z)?w===void 0&&(w=T):(z.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(T),w!==void 0&&(_.push({start:w,end:T-1}),w=void 0)))}if(w!==void 0&&_.push({start:w,end:T-1}),_.length!==0){const z=_[_.length-1];this._pendingGroundEffectLayers.every(V=>V>z.end)||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=_}_setupRenderCache(o){const u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){const C=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let z=0;z<C.length;++z){const V=Object.values(C[z]);u.renderCachePool.push(...V)}}return}this._clearRasterLayersFromRenderCache();const _=this.proxyCoords,w=this._tilesDirty;for(let C=_.length-1;C>=0;C--){const z=_[C];if(u.getTileByID(z.key),u.proxyCachedFBO[z.key]!==void 0){const V=o[z.key],$=this.proxyToSource[z.key];let K=0;for(const ee in $){const te=$[ee],ce=V[ee];if(!ce||ce.length!==te.length||te.some((Te,ve)=>Te!==ce[ve]||w[ee]&&w[ee].hasOwnProperty(Te.key))){K=-1;break}++K}for(const ee in u.proxyCachedFBO[z.key])u.renderCache[u.proxyCachedFBO[z.key][ee]].dirty=K<0||K!==Object.values(V).length}}const T=[...this._drapedRenderBatches];T.sort((C,z)=>z.end-z.start-(C.end-C.start));for(const C of T)for(const z of _){if(u.proxyCachedFBO[z.key])continue;let V=u.renderCachePool.pop();V===void 0&&u.renderCache.length<50&&(V=u.renderCache.length,u.renderCache.push(this._createFBO())),V!==void 0&&(u.proxyCachedFBO[z.key]={},u.proxyCachedFBO[z.key][C.start]=V,u.renderCache[V].dirty=!0)}this._tilesDirty={}}_setupStencil(o,u,_,w){if(!w||!this._sourceTilesOverlap[w.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const T=this.painter.context,C=T.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let z;if(_.isTileClipped())z=u.length,this._overlapStencilMode.test={func:C.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);z=1,this._overlapStencilMode.test={func:C.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+z>255&&(T.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=z,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):Sr.disabled}_renderTileClippingMasks(o,u){const _=this.painter,w=this.painter.context,T=w.gl;_._tileClippingMaskIDs={},w.setColorMode(Mr.disabled),w.setDepthMode(sr.disabled);const C=_.getOrCreateProgram("clippingMask");for(const z of o){const V=_._tileClippingMaskIDs[z.key]=--u;C.draw(_,T.TRIANGLES,sr.disabled,new Sr({func:T.ALWAYS,mask:0},V,255,T.KEEP,T.KEEP,T.REPLACE),Mr.disabled,br.disabled,qu(z.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(o){const u=this.painter.transform;if(o.x<0||o.x>u.width||o.y<0||o.y>u.height)return null;const _=[o.x,o.y,1,1];i.ad.vec4.transformMat4(_,_,u.pixelMatrixInverse),i.ad.vec4.scale(_,_,1/_[3]),_[0]/=u.worldSize,_[1]/=u.worldSize;const w=u._camera.position,T=i.bH(1,u.center.lat),C=[w[0],w[1],w[2]/T,0],z=i.ad.vec3.subtract([],_.slice(0,3),C);i.ad.vec3.normalize(z,z);const V=this.raycast(C,z,this._exaggeration);return V!==null&&V?(i.ad.vec3.scaleAndAdd(C,C,z,V),C[3]=C[2],C[2]*=T,C):null}_setupProxiedCoordsForOrtho(o,u,_){if(o.getSource()instanceof i.aK)return this._setupProxiedCoordsForImageSource(o,u,_);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const w=this.proxiedCoords[o.id]=[],T=this.proxyCoords;for(let V=0;V<T.length;V++){const $=T[V],K=this._findTileCoveringTileID($,o);if(K){const ee=this._createProxiedId($,K,_[$.key]&&_[$.key][o.id]);w.push(ee),this.proxyToSource[$.key][o.id]=[ee]}}let C=!1;const z=new Set;for(let V=0;V<u.length;V++){const $=o.getTile(u[V]);if(!$||!$.hasData())continue;const K=this._findTileCoveringTileID($.tileID,this.proxySourceCache);if(K&&K.tileID.canonical.z!==$.tileID.canonical.z){const ee=this.proxyToSource[K.tileID.key][o.id],te=this._createProxiedId(K.tileID,$,_[K.tileID.key]&&_[K.tileID.key][o.id]);ee?ee.splice(ee.length-1,0,te):this.proxyToSource[K.tileID.key][o.id]=[te];const ce=this.proxyToSource[K.tileID.key][o.id];z.has(ce)||z.add(ce),w.push(te),C=!0}}if(this._sourceTilesOverlap[o.id]=C,C&&this._debugParams.sortTilesHiZFirst)for(const V of z)V.sort(($,K)=>K.overscaledZ-$.overscaledZ)}_setupProxiedCoordsForImageSource(o,u,_){if(!o.getSource().loaded())return;const w=this.proxiedCoords[o.id]=[],T=this.proxyCoords,C=o.getSource(),z=C.tileID;if(!z)return;const V=new i.P(z.x,z.y)._div(1<<z.z),$=C.coordinates.map(i.ac.fromLngLat).reduce((ee,te)=>(ee.min.x=Math.min(ee.min.x,te.x-V.x),ee.min.y=Math.min(ee.min.y,te.y-V.y),ee.max.x=Math.max(ee.max.x,te.x-V.x),ee.max.y=Math.max(ee.max.y,te.y-V.y),ee),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),K=(ee,te)=>{const ce=ee.wrap+ee.canonical.x/(1<<ee.canonical.z),Te=ee.canonical.y/(1<<ee.canonical.z),ve=i.ai/(1<<ee.canonical.z),Ce=te.wrap+te.canonical.x/(1<<te.canonical.z),Pe=te.canonical.y/(1<<te.canonical.z);return ce+ve<Ce+$.min.x||ce>Ce+$.max.x||Te+ve<Pe+$.min.y||Te>Pe+$.max.y};for(let ee=0;ee<T.length;ee++){const te=T[ee];for(let ce=0;ce<u.length;ce++){const Te=o.getTile(u[ce]);if(!Te||!Te.hasData()||K(te,Te.tileID))continue;const ve=this._createProxiedId(te,Te,_[te.key]&&_[te.key][o.id]),Ce=this.proxyToSource[te.key][o.id];Ce?Ce.push(ve):this.proxyToSource[te.key][o.id]=[ve],w.push(ve)}}}_createProxiedId(o,u,_){let w=this.orthoMatrix;if(_){const T=_.find(C=>C.key===u.tileID.key);if(T)return T}if(u.tileID.key!==o.key){const T=o.canonical.z-u.tileID.canonical.z;let C,z,V;w=i.ad.mat4.create();const $=u.tileID.wrap-o.wrap<<o.overscaledZ;T>0?(C=i.ai>>T,z=C*((u.tileID.canonical.x<<T)-o.canonical.x+$),V=C*((u.tileID.canonical.y<<T)-o.canonical.y)):(C=i.ai<<-T,z=i.ai*(u.tileID.canonical.x-(o.canonical.x+$<<-T)),V=i.ai*(u.tileID.canonical.y-(o.canonical.y<<-T))),i.ad.mat4.ortho(w,0,C,0,C,0,1),i.ad.mat4.translate(w,w,[z,V,0])}return new Hd(u.tileID,o.key,w)}_findTileCoveringTileID(o,u){let _=u.getTile(o);if(_&&_.hasData())return _;const w=this._findCoveringTileCache[u.id],T=w[o.key];if(_=T?u.getTileByID(T):null,_&&_.hasData()||T===null)return _;let C=_?_.tileID:o,z=C.overscaledZ;const V=u.getSource().minzoom,$=[];if(!T){const ee=u.getSource().maxzoom;if(o.canonical.z>=ee){const te=o.canonical.z-ee;u.getSource().reparseOverscaled?(z=Math.max(o.canonical.z+2,u.transform.tileZoom),C=new i.aH(z,o.wrap,ee,o.canonical.x>>te,o.canonical.y>>te)):te!==0&&(z=ee,C=new i.aH(z,o.wrap,ee,o.canonical.x>>te,o.canonical.y>>te))}C.key!==o.key&&($.push(C.key),_=u.getTile(C))}const K=ee=>{$.forEach(te=>{w[te]=ee}),$.length=0};for(z-=1;z>=V&&(!_||!_.hasData());z--){_&&K(_.tileID.key);const ee=C.calculateScaledKey(z);if(_=u.getTileByID(ee),_&&_.hasData())break;const te=w[ee];if(te===null)break;te===void 0?$.push(ee):_=u.getTileByID(te)}return K(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,u){let _=this._tilesDirty[o];_||(_=this._tilesDirty[o]={}),_[u.key]=!0}}function $u(y,o,u){const _=function(z,V,$){const K=i.ad.vec3.dot(V,z),ee=i.ad.vec3.dot($,[.2126,.7152,.0722]),te=(Te,ve,Ce)=>(1-Ce)*Te+Ce*ve,ce=te(1-.3*Math.min(ee,1),1,Math.min(K+1,1));return te(.92,1,Math.asin(i.ay(V[2],-1,1))/Math.PI+.5)*ce}(y,[0,0,1],o),w=[0,0,0];i.ad.vec3.scale(w,u.slice(0,3),_);const T=[0,0,0];i.ad.vec3.scale(T,o.slice(0,3),y[2]);const C=[0,0,0];return i.ad.vec3.add(C,w,T),i.cg(C)}const Ds=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],jp=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class km{static cacheKey(o,u,_,w){let T=`${u}${w?w.cacheKey:""}`;for(const C of _)o.usedDefines.includes(C)&&(T+=`/${C}`);return T}constructor(o,u,_,w,T,C){const z=o.gl;this.program=z.createProgram(),this.configuration=w,this.name=u,this.fixedDefines=[...C];const V=w?w.getBinderAttributes():[],$=(_.staticAttributes||[]).concat(V);let K=w?w.defines():[];K=K.concat(C.map(Ce=>`#define ${Ce}`));const ee=`#version 300 es
`;let te=ee+K.concat("precision mediump float;",Bu,Yl.fragmentSource).join(`
`);for(const Ce of _.fragmentIncludes)te+=`
${$a[Ce]}`;te+=`
${_.fragmentSource}`;let ce=ee+K.concat("precision highp float;",Bu,Yl.vertexSource).join(`
`);for(const Ce of _.vertexIncludes)ce+=`
${$a[Ce]}`;this.forceManualRenderingForInstanceIDShaders=o.forceManualRenderingForInstanceIDShaders&&_.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(ce+=`
uniform int u_instanceID;
`),ce+=`
${_.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(ce=ce.replaceAll("gl_InstanceID","u_instanceID"));const Te=z.createShader(z.FRAGMENT_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);z.shaderSource(Te,te),z.compileShader(Te),z.attachShader(this.program,Te);const ve=z.createShader(z.VERTEX_SHADER);if(z.isContextLost())this.failedToCreate=!0;else{z.shaderSource(ve,ce),z.compileShader(ve),z.attachShader(this.program,ve),this.attributes={},this.numAttributes=$.length;for(let Ce=0;Ce<this.numAttributes;Ce++)if($[Ce]){const Pe=$[Ce].startsWith("a_")?$[Ce]:`a_${$[Ce]}`;z.bindAttribLocation(this.program,Ce,Pe),this.attributes[Pe]=Ce}z.linkProgram(this.program),z.deleteShader(ve),z.deleteShader(Te),this.fixedUniforms=T(o),this.binderUniforms=w?w.getUniforms(o):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(Ce=>({u_instanceID:new i.bN(Ce)}))(o)),(C.includes("TERRAIN")||u.indexOf("symbol")!==-1||u.indexOf("circle")!==-1)&&(this.terrainUniforms=(Ce=>({u_dem:new i.bN(Ce),u_dem_prev:new i.bN(Ce),u_dem_tl:new i.bK(Ce),u_dem_scale:new i.bM(Ce),u_dem_tl_prev:new i.bK(Ce),u_dem_scale_prev:new i.bM(Ce),u_dem_size:new i.bM(Ce),u_dem_lerp:new i.bM(Ce),u_exaggeration:new i.bM(Ce),u_depth:new i.bN(Ce),u_depth_size_inv:new i.bK(Ce),u_depth_range_unpack:new i.bK(Ce),u_occluder_half_size:new i.bM(Ce),u_occlusion_depth_offset:new i.bM(Ce),u_meter_to_dem:new i.bM(Ce),u_label_plane_matrix_inv:new i.bJ(Ce)}))(o)),C.includes("GLOBE")&&(this.globeUniforms=(Ce=>({u_tile_tl_up:new i.bL(Ce),u_tile_tr_up:new i.bL(Ce),u_tile_br_up:new i.bL(Ce),u_tile_bl_up:new i.bL(Ce),u_tile_up_scale:new i.bM(Ce)}))(o)),C.includes("FOG")&&(this.fogUniforms=(Ce=>({u_fog_matrix:new i.bJ(Ce),u_fog_range:new i.bK(Ce),u_fog_color:new i.cb(Ce),u_fog_horizon_blend:new i.bM(Ce),u_fog_vertical_limit:new i.bK(Ce),u_fog_temporal_offset:new i.bM(Ce),u_frustum_tl:new i.bL(Ce),u_frustum_tr:new i.bL(Ce),u_frustum_br:new i.bL(Ce),u_frustum_bl:new i.bL(Ce),u_globe_pos:new i.bL(Ce),u_globe_radius:new i.bM(Ce),u_globe_transition:new i.bM(Ce),u_is_globe:new i.bN(Ce),u_viewport:new i.bK(Ce)}))(o)),C.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(Ce=>({u_cutoff_params:new i.cb(Ce)}))(o)),C.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(Ce=>({u_lighting_ambient_color:new i.bL(Ce),u_lighting_directional_dir:new i.bL(Ce),u_lighting_directional_color:new i.bL(Ce),u_ground_radiance:new i.bL(Ce)}))(o)),C.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(Ce=>({u_light_matrix_0:new i.bJ(Ce),u_light_matrix_1:new i.bJ(Ce),u_fade_range:new i.bK(Ce),u_shadow_normal_offset:new i.bL(Ce),u_shadow_intensity:new i.bM(Ce),u_shadow_texel_size:new i.bM(Ce),u_shadow_map_resolution:new i.bM(Ce),u_shadow_direction:new i.bL(Ce),u_shadow_bias:new i.bL(Ce),u_shadowmap_0:new i.bN(Ce),u_shadowmap_1:new i.bN(Ce)}))(o))}}setTerrainUniformValues(o,u){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const w in u)_[w]&&_[w].set(this.program,w,u[w])}}setGlobeUniformValues(o,u){if(!this.globeUniforms)return;const _=this.globeUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const w in u)_[w]&&_[w].set(this.program,w,u[w])}}setFogUniformValues(o,u){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const w in u)_[w].set(this.program,w,u[w])}}setCutoffUniformValues(o,u){if(!this.cutoffUniforms)return;const _=this.cutoffUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const w in u)_[w].set(this.program,w,u[w])}}setLightsUniformValues(o,u){if(!this.lightsUniforms)return;const _=this.lightsUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const w in u)_[w].set(this.program,w,u[w])}}setShadowUniformValues(o,u){if(this.failedToCreate||!this.shadowUniforms)return;const _=this.shadowUniforms;o.program.set(this.program);for(const w in u)_[w].set(this.program,w,u[w])}_drawDebugWireframe(o,u,_,w,T,C,z,V,$,K){const ee=o.options.wireframe;if(ee.terrain===!1&&ee.layers2D===!1&&ee.layers3D===!1)return;const te=o.context;if(!(!(!ee.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!ee.layers2D||o._terrain&&o._terrain.renderingToTexture||!Ds.includes(this.name))||!(!ee.layers3D||!jp.includes(this.name))))return;const ce=te.gl,Te=o.wireframeDebugCache.getLinesFromTrianglesBuffer(o.frameCounter,T,te);if(!Te)return;const ve=[...this.fixedDefines];ve.push("DEBUG_WIREFRAME");const Ce=o.getOrCreateProgram(this.name,{config:this.configuration,defines:ve});te.program.set(Ce.program);const Pe=(Ye,lt,nt)=>{if(lt[Ye]&&nt[Ye])for(const rt in lt[Ye])nt[Ye][rt]&&nt[Ye][rt].set(nt.program,rt,lt[Ye][rt].current)};$&&$.setUniforms(Ce.program,te,Ce.binderUniforms,z,{zoom:V}),Pe("fixedUniforms",this,Ce),Pe("terrainUniforms",this,Ce),Pe("globeUniforms",this,Ce),Pe("fogUniforms",this,Ce),Pe("lightsUniforms",this,Ce),Pe("shadowUniforms",this,Ce),Te.bind(),te.setColorMode(new Mr([ce.ONE,ce.ONE_MINUS_SRC_ALPHA,ce.ZERO,ce.ONE],i.al.transparent,[!0,!0,!0,!1])),te.setDepthMode(new sr(u.func===ce.LESS?ce.LEQUAL:u.func,sr.ReadOnly,u.range)),te.setStencilMode(Sr.disabled);const qe=3*C.primitiveLength*2,Je=3*C.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const Ye=K||1;for(let lt=0;lt<Ye;++lt)Ce.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",lt),ce.drawElements(ce.LINES,qe,ce.UNSIGNED_SHORT,Je)}else K&&K>1?ce.drawElementsInstanced(ce.LINES,qe,ce.UNSIGNED_SHORT,Je,K):ce.drawElements(ce.LINES,qe,ce.UNSIGNED_SHORT,Je);T.bind(),te.program.set(this.program),te.setDepthMode(u),te.setStencilMode(_),te.setColorMode(w)}checkUniforms(o,u,_){if(this.fixedDefines.includes(u)){for(const w of Object.keys(_))if(!_[w].initialized)throw new Error(`Program '${this.name}', from draw '${o}': uniform ${w} not set but required by ${u} being defined`)}}draw(o,u,_,w,T,C,z,V,$,K,ee,te,ce,Te,ve,Ce){const Pe=o.context,qe=Pe.gl;if(this.failedToCreate)return;Pe.program.set(this.program),Pe.setDepthMode(_),Pe.setStencilMode(w),Pe.setColorMode(T),Pe.setCullFace(C);for(const lt of Object.keys(this.fixedUniforms))this.fixedUniforms[lt].set(this.program,lt,z[lt]);Te&&Te.setUniforms(this.program,Pe,this.binderUniforms,te,{zoom:ce});const Je={[qe.POINTS]:1,[qe.LINES]:2,[qe.TRIANGLES]:3,[qe.LINE_STRIP]:1}[u];this.checkUniforms(V,"RENDER_SHADOWS",this.shadowUniforms);const Ye=Ce&&Ce>0?1:void 0;for(const lt of ee.get()){const nt=lt.vaos||(lt.vaos={});if((nt[V]||(nt[V]=new ju)).bind(Pe,this,$,Te?Te.getPaintVertexBuffers():[],K,lt.vertexOffset,ve||[],Ye),this.forceManualRenderingForInstanceIDShaders){const rt=Ce||1;for(let it=0;it<rt;++it)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",it),K?qe.drawElements(u,lt.primitiveLength*Je,qe.UNSIGNED_SHORT,lt.primitiveOffset*Je*2):qe.drawArrays(u,lt.vertexOffset,lt.vertexLength)}else Ce&&Ce>1?qe.drawElementsInstanced(u,lt.primitiveLength*Je,qe.UNSIGNED_SHORT,lt.primitiveOffset*Je*2,Ce):K?qe.drawElements(u,lt.primitiveLength*Je,qe.UNSIGNED_SHORT,lt.primitiveOffset*Je*2):qe.drawArrays(u,lt.vertexOffset,lt.vertexLength);u===qe.TRIANGLES&&K&&this._drawDebugWireframe(o,_,w,T,K,lt,te,ce,Te,Ce)}}}function _d(y,o){const u=Math.pow(2,o.tileID.overscaledZ),_=o.tileSize*Math.pow(2,y.transform.tileZoom)/u,w=_*(o.tileID.canonical.x+o.tileID.wrap*u),T=_*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.at(o,1,y.transform.tileZoom),u_pixel_coord_upper:[w>>16,T>>16],u_pixel_coord_lower:[65535&w,65535&T]}}const Fp={terrain:0,flat:1},Qs=i.ad.mat4.create(),jf=(y,o,u,_,w,T,C,z,V,$,K,ee,te,ce,Te,ve,Ce,Pe)=>{const qe=o.style.light,Je=qe.properties.get("position"),Ye=[Je.x,Je.y,Je.z],lt=i.ad.mat3.create();qe.properties.get("anchor")==="viewport"&&(i.ad.mat3.fromRotation(lt,-o.transform.angle),i.ad.vec3.transformMat3(Ye,Ye,lt));const nt=qe.properties.get("color"),rt=o.transform,it={u_matrix:y,u_lightpos:Ye,u_lightintensity:qe.properties.get("intensity"),u_lightcolor:[nt.r,nt.g,nt.b],u_vertical_gradient:+u,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Qs,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Fp[$],u_base_type:Fp[K],u_ao:w,u_edge_radius:T,u_width_scale:C,u_flood_light_color:Te,u_vertical_scale:ve,u_flood_light_intensity:Ce,u_ground_shadow_factor:Pe};return rt.projection.name==="globe"&&(it.u_tile_id=[z.canonical.x,z.canonical.y,1<<z.canonical.z],it.u_zoom_transition=ee,it.u_inv_rot_matrix=ce,it.u_merc_center=te,it.u_up_dir=rt.projection.upVector(new i.bT(0,0,0),te[0]*i.ai,te[1]*i.ai),it.u_height_lift=V),it},q=(y,o,u,_,w,T)=>({u_matrix:y,u_edge_radius:o,u_width_scale:u,u_vertical_scale:_,u_height_type:Fp[w],u_base_type:Fp[T]}),Z=(y,o,u,_,w,T,C,z,V,$,K,ee,te,ce,Te,ve,Ce)=>{const Pe=jf(y,o,u,_,w,T,C,z,$,K,ee,te,ce,Te,ve,Ce,1,[0,0,0]),qe={u_height_factor:-Math.pow(2,z.overscaledZ)/V.tileSize/8};return i.l(Pe,_d(o,V),qe)},de=(y,o)=>({u_matrix:y,u_emissive_strength:o}),Ie=(y,o,u,_)=>i.l(de(y,o),_d(u,_)),Ve=(y,o,u)=>({u_matrix:y,u_world:u,u_emissive_strength:o}),Ze=(y,o,u,_,w)=>i.l(Ie(y,o,u,_),{u_world:w}),et=(y,o,u,_,w)=>({u_matrix:y,u_camera_pos:[o[0],o[1],o[2]],u_depth_bias:u,u_height_scale:_,u_reset_depth:w}),at=(y,o,u,_)=>{const w=i.ai/u.tileSize;return{u_matrix:y,u_camera_to_center_distance:o.getCameraToCenterDistance(_),u_extrude_scale:[o.pixelsToGLUnits[0]/w,o.pixelsToGLUnits[1]/w]}},ut=(y,o,u=1)=>({u_matrix:y,u_color:o.toRenderColor(null),u_overlay:0,u_overlay_scale:u}),St=i.ad.mat4.create(),Jt=(y,o,u,_,w,T,C)=>{const z=y.transform,V=z.projection.name==="globe",$=V?i.cO(z.zoom,o.canonical)*z._pixelsPerMercatorPixel:i.at(u,1,T),K={u_matrix:o.projMatrix,u_extrude_scale:$,u_intensity:C,u_inv_rot_matrix:St,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(V){K.u_inv_rot_matrix=_,K.u_merc_center=w,K.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],K.u_zoom_transition=i.ag(z.zoom);const ee=w[0]*i.ai,te=w[1]*i.ai;K.u_up_dir=z.projection.upVector(new i.bT(0,0,0),ee,te)}return K};function Mt(y,[o,u,_,w],[T,C]){if(T===C)return[0,0,0,0];const z=255*(y-1)/(y*(C-T));return[o*z,u*z,_*z,w*z]}function vn(y,o,[u,_]){return u===_?0:.5/y+(o-u)*(y-1)/(y*(_-u))}const nn=(y,o,u,_,w,T,C,z,V,$,K,ee,te,ce,Te,ve,Ce,Pe,qe,Je,Ye)=>({u_matrix:y,u_normalize_matrix:o,u_globe_matrix:u,u_merc_matrix:_,u_grid_matrix:w,u_tl_parent:T,u_scale_parent:$,u_fade_t:K.mix,u_opacity:K.opacity*ee.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:ee.paint.get("raster-brightness-min"),u_brightness_high:ee.paint.get("raster-brightness-max"),u_saturation_factor:i.cP(ee.paint.get("raster-saturation")),u_contrast_factor:i.cQ(ee.paint.get("raster-contrast")),u_spin_weights:wn(ee.paint.get("raster-hue-rotate")),u_perspective_transform:te,u_raster_elevation:ce,u_zoom_transition:C,u_merc_center:z,u_cutoff_params:V,u_colorization_mix:Mt(i.cR,ve,Pe),u_colorization_offset:vn(i.cR,Ce,Pe),u_color_ramp:Te,u_texture_offset:[Je/(qe+2*Je),qe/(qe+2*Je)],u_texture_res:[qe+2*Je,qe+2*Je],u_emissive_strength:Ye});function wn(y){y*=Math.PI/180;const o=Math.sin(y),u=Math.cos(y);return[(2*u+1)/3,(-Math.sqrt(3)*o-u+1)/3,(Math.sqrt(3)*o-u+1)/3]}const pn=.05,_t=(y,o,u,_,w,T,C,z,V,$,K,ee)=>({u_matrix:y,u_normalize_matrix:o,u_globe_matrix:u,u_merc_matrix:_,u_grid_matrix:w,u_tl_parent:T,u_scale_parent:$,u_fade_t:K.mix,u_opacity:K.opacity,u_image0:0,u_image1:1,u_raster_elevation:ee,u_zoom_transition:C,u_merc_center:z,u_cutoff_params:V}),en=(y,o,u,_,w,T,C,z,V,$)=>({u_particle_texture:y,u_particle_texture_side_len:o,u_tile_offset:u,u_velocity:_,u_color_ramp:T,u_velocity_res:w,u_max_speed:C,u_uv_offset:z,u_data_scale:[255*V[0],255*V[1]],u_data_offset:$,u_particle_pos_scale:1.1,u_particle_pos_offset:[pn,pn]}),Vn=(y,o,u,_,w,T,C,z,V,$)=>({u_particle_texture:y,u_particle_texture_side_len:o,u_velocity:u,u_velocity_res:_,u_max_speed:w,u_speed_factor:T,u_reset_rate:C,u_rand_seed:Math.random(),u_uv_offset:z,u_data_scale:[255*V[0],255*V[1]],u_data_offset:$,u_particle_pos_scale:1.1,u_particle_pos_offset:[pn,pn]}),Yn=i.ad.mat4.create(),Gn=(y,o,u,_,w,T,C,z,V,$,K,ee,te,ce,Te,ve,Ce,Pe,qe,Je,Ye,lt)=>{const nt=w.transform,rt={u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:nt.getCameraToCenterDistance(qe),u_rotate_symbol:+u,u_aspect_ratio:nt.width/nt.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:C,u_coord_matrix:z,u_is_text:+$,u_elevation_from_sea:V?1:0,u_pitch_with_map:+_,u_texsize:K,u_texsize_icon:ee,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Yn,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Yn,u_up_vector:[0,-1,0],u_color_adj_mat:Je,u_icon_transition:Ye||0,u_gamma_scale:_?w.transform.getCameraToCenterDistance(qe)*Math.cos(w.terrain?0:w.transform._pitch):1,u_device_pixel_ratio:i.q.devicePixelRatio,u_is_halo:1,u_scale_factor:lt||1};return qe.name==="globe"&&(rt.u_tile_id=[ce.canonical.x,ce.canonical.y,1<<ce.canonical.z],rt.u_zoom_transition=Te,rt.u_inv_rot_matrix=Ce,rt.u_merc_center=ve,rt.u_camera_forward=nt._camera.forward(),rt.u_ecef_origin=i.cS(nt.globeMatrix,ce.toUnwrapped()),rt.u_tile_matrix=Float32Array.from(nt.globeMatrix),rt.u_up_vector=Pe),rt},Tr=(y,o,u,_)=>({u_matrix:y,u_emissive_strength:o,u_opacity:u,u_color:_}),pr=(y,o,u,_,w,T,C,z,V)=>i.l(function($,K,ee,te,ce,Te){const{width:ve,height:Ce}=te.imageManager.getPixelSize(K),Pe=Math.pow(2,Te.tileID.overscaledZ),qe=Te.tileSize*Math.pow(2,te.transform.tileZoom)/Pe,Je=qe*(Te.tileID.canonical.x+Te.tileID.wrap*Pe),Ye=qe*Te.tileID.canonical.y;return{u_image:0,u_pattern_tl:ee.tl,u_pattern_br:ee.br,u_texsize:[ve,Ce],u_pattern_size:ee.displaySize,u_pattern_units_to_pixels:ce?[te.transform.width,-1*te.transform.height]:[1/i.at(Te,1,te.transform.tileZoom),1/i.at(Te,1,te.transform.tileZoom)],u_pixel_coord_upper:[Je>>16,Ye>>16],u_pixel_coord_lower:[65535&Je,65535&Ye]}}(0,T,C,_,z,V),{u_matrix:y,u_emissive_strength:o,u_opacity:u}),ii=new Float32Array(i.ad.mat4.identity([])),cr=(y,o,u,_,w,T,C,z,V,$,K,ee,te,ce=[0,0,0],Te)=>{const ve=w.style.light,Ce=ve.properties.get("position"),Pe=[-Ce.x,-Ce.y,Ce.z],qe=i.ad.mat3.create();ve.properties.get("anchor")==="viewport"&&(i.ad.mat3.fromRotation(qe,-w.transform.angle),i.ad.vec3.transformMat3(Pe,Pe,qe));const Je=K.alphaMode==="MASK",Ye=ve.properties.get("color").toRenderColor(null),lt=te.paint.get("model-ambient-occlusion-intensity"),nt=te.paint.get("model-color").constantOr(i.al.white).toRenderColor(null),rt=te.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:y,u_lighting_matrix:o,u_normal_matrix:u,u_node_matrix:_||ii,u_lightpos:Pe,u_lightintensity:ve.properties.get("intensity"),u_lightcolor:[Ye.r,Ye.g,Ye.b],u_camera_pos:ce,u_opacity:T,u_baseTextureIsAlpha:0,u_alphaMask:+Je,u_alphaCutoff:K.alphaCutoff,u_baseColorFactor:[C.r,C.g,C.b,C.a],u_emissiveFactor:[z[0],z[1],z[2],1],u_metallicFactor:V,u_roughnessFactor:$,u_baseColorTexture:ya.BaseColor,u_metallicRoughnessTexture:ya.MetallicRoughness,u_normalTexture:ya.Normal,u_occlusionTexture:ya.Occlusion,u_emissionTexture:ya.Emission,u_lutTexture:ya.LUT,u_color_mix:[nt.r,nt.g,nt.b,rt],u_aoIntensity:lt,u_emissive_strength:ee,u_occlusionTextureTransform:Te||[0,0,0,0]}},va=(y,o=ii,u=ii)=>({u_matrix:y,u_instance:o,u_node_matrix:u}),Ea={fillExtrusion:y=>({u_matrix:new i.bJ(y),u_lightpos:new i.bL(y),u_lightintensity:new i.bM(y),u_lightcolor:new i.bL(y),u_vertical_gradient:new i.bM(y),u_opacity:new i.bM(y),u_edge_radius:new i.bM(y),u_width_scale:new i.bM(y),u_ao:new i.bK(y),u_height_type:new i.bN(y),u_base_type:new i.bN(y),u_tile_id:new i.bL(y),u_zoom_transition:new i.bM(y),u_inv_rot_matrix:new i.bJ(y),u_merc_center:new i.bK(y),u_up_dir:new i.bL(y),u_height_lift:new i.bM(y),u_flood_light_color:new i.bL(y),u_vertical_scale:new i.bM(y),u_flood_light_intensity:new i.bM(y),u_ground_shadow_factor:new i.bL(y)}),fillExtrusionDepth:y=>({u_matrix:new i.bJ(y),u_edge_radius:new i.bM(y),u_width_scale:new i.bM(y),u_vertical_scale:new i.bM(y),u_height_type:new i.bN(y),u_base_type:new i.bN(y)}),fillExtrusionPattern:y=>({u_matrix:new i.bJ(y),u_lightpos:new i.bL(y),u_lightintensity:new i.bM(y),u_lightcolor:new i.bL(y),u_vertical_gradient:new i.bM(y),u_height_factor:new i.bM(y),u_edge_radius:new i.bM(y),u_width_scale:new i.bM(y),u_ao:new i.bK(y),u_height_type:new i.bN(y),u_base_type:new i.bN(y),u_tile_id:new i.bL(y),u_zoom_transition:new i.bM(y),u_inv_rot_matrix:new i.bJ(y),u_merc_center:new i.bK(y),u_up_dir:new i.bL(y),u_height_lift:new i.bM(y),u_image:new i.bN(y),u_texsize:new i.bK(y),u_pixel_coord_upper:new i.bK(y),u_pixel_coord_lower:new i.bK(y),u_tile_units_to_pixels:new i.bM(y),u_opacity:new i.bM(y)}),fillExtrusionGroundEffect:y=>({u_matrix:new i.bJ(y),u_opacity:new i.bM(y),u_ao_pass:new i.bM(y),u_meter_to_tile:new i.bM(y),u_ao:new i.bK(y),u_flood_light_intensity:new i.bM(y),u_flood_light_color:new i.bL(y),u_attenuation:new i.bM(y),u_edge_radius:new i.bM(y),u_fb:new i.bN(y),u_fb_size:new i.bM(y),u_dynamic_offset:new i.bM(y)}),fill:y=>({u_matrix:new i.bJ(y),u_emissive_strength:new i.bM(y)}),fillPattern:y=>({u_matrix:new i.bJ(y),u_emissive_strength:new i.bM(y),u_image:new i.bN(y),u_texsize:new i.bK(y),u_pixel_coord_upper:new i.bK(y),u_pixel_coord_lower:new i.bK(y),u_tile_units_to_pixels:new i.bM(y)}),fillOutline:y=>({u_matrix:new i.bJ(y),u_emissive_strength:new i.bM(y),u_world:new i.bK(y)}),fillOutlinePattern:y=>({u_matrix:new i.bJ(y),u_emissive_strength:new i.bM(y),u_world:new i.bK(y),u_image:new i.bN(y),u_texsize:new i.bK(y),u_pixel_coord_upper:new i.bK(y),u_pixel_coord_lower:new i.bK(y),u_tile_units_to_pixels:new i.bM(y)}),elevatedStructures:y=>({u_matrix:new i.bJ(y)}),elevatedStructuresDepthReconstruct:y=>({u_matrix:new i.bJ(y),u_camera_pos:new i.bL(y),u_depth_bias:new i.bM(y),u_height_scale:new i.bM(y),u_reset_depth:new i.bM(y)}),circle:i.cT,collisionBox:y=>({u_matrix:new i.bJ(y),u_camera_to_center_distance:new i.bM(y),u_extrude_scale:new i.bK(y)}),collisionCircle:y=>({u_matrix:new i.bJ(y),u_inv_matrix:new i.bJ(y),u_camera_to_center_distance:new i.bM(y),u_viewport_size:new i.bK(y)}),debug:y=>({u_color:new i.cA(y),u_matrix:new i.bJ(y),u_overlay:new i.bN(y),u_overlay_scale:new i.bM(y)}),clippingMask:y=>({u_matrix:new i.bJ(y)}),heatmap:y=>({u_extrude_scale:new i.bM(y),u_intensity:new i.bM(y),u_matrix:new i.bJ(y),u_inv_rot_matrix:new i.bJ(y),u_merc_center:new i.bK(y),u_tile_id:new i.bL(y),u_zoom_transition:new i.bM(y),u_up_dir:new i.bL(y)}),heatmapTexture:y=>({u_image:new i.bN(y),u_color_ramp:new i.bN(y),u_opacity:new i.bM(y)}),hillshade:y=>({u_matrix:new i.bJ(y),u_image:new i.bN(y),u_latrange:new i.bK(y),u_light:new i.bK(y),u_shadow:new i.cA(y),u_highlight:new i.cA(y),u_emissive_strength:new i.bM(y),u_accent:new i.cA(y)}),hillshadePrepare:y=>({u_matrix:new i.bJ(y),u_image:new i.bN(y),u_dimension:new i.bK(y),u_zoom:new i.bM(y)}),line:i.cU,linePattern:i.cV,raster:y=>({u_matrix:new i.bJ(y),u_normalize_matrix:new i.bJ(y),u_globe_matrix:new i.bJ(y),u_merc_matrix:new i.bJ(y),u_grid_matrix:new i.cB(y),u_tl_parent:new i.bK(y),u_scale_parent:new i.bM(y),u_fade_t:new i.bM(y),u_opacity:new i.bM(y),u_image0:new i.bN(y),u_image1:new i.bN(y),u_brightness_low:new i.bM(y),u_brightness_high:new i.bM(y),u_saturation_factor:new i.bM(y),u_contrast_factor:new i.bM(y),u_spin_weights:new i.bL(y),u_perspective_transform:new i.bK(y),u_raster_elevation:new i.bM(y),u_zoom_transition:new i.bM(y),u_merc_center:new i.bK(y),u_cutoff_params:new i.cb(y),u_colorization_mix:new i.cb(y),u_colorization_offset:new i.bM(y),u_color_ramp:new i.bN(y),u_texture_offset:new i.bK(y),u_texture_res:new i.bK(y),u_emissive_strength:new i.bM(y)}),rasterParticle:y=>({u_matrix:new i.bJ(y),u_normalize_matrix:new i.bJ(y),u_globe_matrix:new i.bJ(y),u_merc_matrix:new i.bJ(y),u_grid_matrix:new i.cB(y),u_tl_parent:new i.bK(y),u_scale_parent:new i.bM(y),u_fade_t:new i.bM(y),u_opacity:new i.bM(y),u_image0:new i.bN(y),u_image1:new i.bN(y),u_raster_elevation:new i.bM(y),u_zoom_transition:new i.bM(y),u_merc_center:new i.bK(y),u_cutoff_params:new i.cb(y)}),rasterParticleTexture:y=>({u_texture:new i.bN(y),u_opacity:new i.bM(y)}),rasterParticleDraw:y=>({u_particle_texture:new i.bN(y),u_particle_texture_side_len:new i.bM(y),u_tile_offset:new i.bK(y),u_velocity:new i.bN(y),u_color_ramp:new i.bN(y),u_velocity_res:new i.bK(y),u_max_speed:new i.bM(y),u_uv_offset:new i.bK(y),u_data_scale:new i.bK(y),u_data_offset:new i.bM(y),u_particle_pos_scale:new i.bM(y),u_particle_pos_offset:new i.bK(y)}),rasterParticleUpdate:y=>({u_particle_texture:new i.bN(y),u_particle_texture_side_len:new i.bM(y),u_velocity:new i.bN(y),u_velocity_res:new i.bK(y),u_max_speed:new i.bM(y),u_speed_factor:new i.bM(y),u_reset_rate:new i.bM(y),u_rand_seed:new i.bM(y),u_uv_offset:new i.bK(y),u_data_scale:new i.bK(y),u_data_offset:new i.bM(y),u_particle_pos_scale:new i.bM(y),u_particle_pos_offset:new i.bK(y)}),symbol:y=>({u_is_size_zoom_constant:new i.bN(y),u_is_size_feature_constant:new i.bN(y),u_size_t:new i.bM(y),u_size:new i.bM(y),u_camera_to_center_distance:new i.bM(y),u_rotate_symbol:new i.bN(y),u_aspect_ratio:new i.bM(y),u_fade_change:new i.bM(y),u_matrix:new i.bJ(y),u_label_plane_matrix:new i.bJ(y),u_coord_matrix:new i.bJ(y),u_is_text:new i.bN(y),u_elevation_from_sea:new i.bN(y),u_pitch_with_map:new i.bN(y),u_texsize:new i.bK(y),u_texsize_icon:new i.bK(y),u_texture:new i.bN(y),u_texture_icon:new i.bN(y),u_gamma_scale:new i.bM(y),u_device_pixel_ratio:new i.bM(y),u_tile_id:new i.bL(y),u_zoom_transition:new i.bM(y),u_inv_rot_matrix:new i.bJ(y),u_merc_center:new i.bK(y),u_camera_forward:new i.bL(y),u_tile_matrix:new i.bJ(y),u_up_vector:new i.bL(y),u_ecef_origin:new i.bL(y),u_is_halo:new i.bN(y),u_icon_transition:new i.bM(y),u_color_adj_mat:new i.bJ(y),u_scale_factor:new i.bM(y)}),background:y=>({u_matrix:new i.bJ(y),u_emissive_strength:new i.bM(y),u_opacity:new i.bM(y),u_color:new i.cA(y)}),backgroundPattern:y=>({u_matrix:new i.bJ(y),u_emissive_strength:new i.bM(y),u_opacity:new i.bM(y),u_image:new i.bN(y),u_pattern_tl:new i.bK(y),u_pattern_br:new i.bK(y),u_texsize:new i.bK(y),u_pattern_size:new i.bK(y),u_pixel_coord_upper:new i.bK(y),u_pixel_coord_lower:new i.bK(y),u_pattern_units_to_pixels:new i.bK(y)}),terrainRaster:y=>({u_matrix:new i.bJ(y),u_image0:new i.bN(y),u_skirt_height:new i.bM(y),u_ground_shadow_factor:new i.bL(y)}),skybox:y=>({u_matrix:new i.bJ(y),u_sun_direction:new i.bL(y),u_cubemap:new i.bN(y),u_opacity:new i.bM(y),u_temporal_offset:new i.bM(y)}),skyboxGradient:y=>({u_matrix:new i.bJ(y),u_color_ramp:new i.bN(y),u_center_direction:new i.bL(y),u_radius:new i.bM(y),u_opacity:new i.bM(y),u_temporal_offset:new i.bM(y)}),skyboxCapture:y=>({u_matrix_3f:new i.cB(y),u_sun_direction:new i.bL(y),u_sun_intensity:new i.bM(y),u_color_tint_r:new i.cb(y),u_color_tint_m:new i.cb(y),u_luminance:new i.bM(y)}),globeRaster:y=>({u_proj_matrix:new i.bJ(y),u_globe_matrix:new i.bJ(y),u_normalize_matrix:new i.bJ(y),u_merc_matrix:new i.bJ(y),u_zoom_transition:new i.bM(y),u_merc_center:new i.bK(y),u_image0:new i.bN(y),u_grid_matrix:new i.cB(y),u_skirt_height:new i.bM(y),u_far_z_cutoff:new i.bM(y),u_frustum_tl:new i.bL(y),u_frustum_tr:new i.bL(y),u_frustum_br:new i.bL(y),u_frustum_bl:new i.bL(y),u_globe_pos:new i.bL(y),u_globe_radius:new i.bM(y),u_viewport:new i.bK(y)}),globeAtmosphere:y=>({u_frustum_tl:new i.bL(y),u_frustum_tr:new i.bL(y),u_frustum_br:new i.bL(y),u_frustum_bl:new i.bL(y),u_horizon:new i.bM(y),u_transition:new i.bM(y),u_fadeout_range:new i.bM(y),u_color:new i.cb(y),u_high_color:new i.cb(y),u_space_color:new i.cb(y),u_temporal_offset:new i.bM(y),u_horizon_angle:new i.bM(y)}),model:y=>({u_matrix:new i.bJ(y),u_lighting_matrix:new i.bJ(y),u_normal_matrix:new i.bJ(y),u_node_matrix:new i.bJ(y),u_lightpos:new i.bL(y),u_lightintensity:new i.bM(y),u_lightcolor:new i.bL(y),u_camera_pos:new i.bL(y),u_opacity:new i.bM(y),u_baseColorFactor:new i.cb(y),u_emissiveFactor:new i.cb(y),u_metallicFactor:new i.bM(y),u_roughnessFactor:new i.bM(y),u_baseTextureIsAlpha:new i.bN(y),u_alphaMask:new i.bN(y),u_alphaCutoff:new i.bM(y),u_baseColorTexture:new i.bN(y),u_metallicRoughnessTexture:new i.bN(y),u_normalTexture:new i.bN(y),u_occlusionTexture:new i.bN(y),u_emissionTexture:new i.bN(y),u_lutTexture:new i.bN(y),u_color_mix:new i.cb(y),u_aoIntensity:new i.bM(y),u_emissive_strength:new i.bM(y),u_occlusionTextureTransform:new i.cb(y)}),modelDepth:y=>({u_matrix:new i.bJ(y),u_instance:new i.bJ(y),u_node_matrix:new i.bJ(y)}),groundShadow:y=>({u_matrix:new i.bJ(y),u_ground_shadow_factor:new i.bL(y)}),stars:y=>({u_matrix:new i.bJ(y),u_up:new i.bL(y),u_right:new i.bL(y),u_intensity_multiplier:new i.bM(y)}),snowParticle:y=>({u_modelview:new i.bJ(y),u_projection:new i.bJ(y),u_time:new i.bM(y),u_cam_pos:new i.bL(y),u_velocityConeAperture:new i.bM(y),u_velocity:new i.bM(y),u_horizontalOscillationRadius:new i.bM(y),u_horizontalOscillationRate:new i.bM(y),u_boxSize:new i.bM(y),u_billboardSize:new i.bM(y),u_simpleShapeParameters:new i.bK(y),u_screenSize:new i.bK(y),u_thinningCenterPos:new i.bK(y),u_thinningShape:new i.bL(y),u_thinningAffectedRatio:new i.bM(y),u_thinningParticleOffset:new i.bM(y),u_particleColor:new i.cb(y),u_direction:new i.bL(y)}),rainParticle:y=>({u_modelview:new i.bJ(y),u_projection:new i.bJ(y),u_time:new i.bM(y),u_cam_pos:new i.bL(y),u_texScreen:new i.bN(y),u_velocityConeAperture:new i.bM(y),u_velocity:new i.bM(y),u_boxSize:new i.bM(y),u_rainDropletSize:new i.bK(y),u_distortionStrength:new i.bM(y),u_rainDirection:new i.bL(y),u_color:new i.cb(y),u_screenSize:new i.bK(y),u_thinningCenterPos:new i.bK(y),u_thinningShape:new i.bL(y),u_thinningAffectedRatio:new i.bM(y),u_thinningParticleOffset:new i.bM(y),u_shapeDirectionalPower:new i.bM(y),u_shapeNormalPower:new i.bM(y),u_mode:new i.bM(y)}),vignette:y=>({u_vignetteShape:new i.bL(y),u_vignetteColor:new i.cb(y)}),occlusion:y=>({u_matrix:new i.bJ(y),u_anchorPos:new i.bL(y),u_screenSizePx:new i.bK(y),u_occluderSizePx:new i.bK(y),u_color:new i.cb(y)})};class $i{constructor(o,u,_,w){this.id=$i.uniqueIdxCounter,$i.uniqueIdxCounter++,this.context=o;const T=o.gl;this.buffer=T.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),T.bufferData(T.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||w||u.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){this.id=$i.uniqueIdxCounter,$i.uniqueIdxCounter++;const u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}$i.uniqueIdxCounter=0;const ta={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ga{constructor(o,u,_,w,T,C){this.length=u.length,this.attributes=_,this.itemSize=u.bytesPerElement,this.dynamicDraw=w,this.instanceCount=C,this.context=o;const z=o.gl;this.buffer=z.createBuffer(),o.bindVertexBuffer.set(this.buffer),z.bufferData(z.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?z.DYNAMIC_DRAW:z.STATIC_DRAW),this.dynamicDraw||T||u.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,u){for(let _=0;_<this.attributes.length;_++){const w=u.attributes[this.attributes[_].name];w!==void 0&&o.enableVertexAttribArray(w)}}setVertexAttribPointers(o,u,_){for(let w=0;w<this.attributes.length;w++){const T=this.attributes[w],C=u.attributes[T.name];C!==void 0&&o.vertexAttribPointer(C,T.components,o[ta[T.type]],!1,this.itemSize,T.offset+this.itemSize*(_||0))}}setVertexAttribDivisor(o,u,_){for(let w=0;w<this.attributes.length;w++){const T=u.attributes[this.attributes[w].name];T!==void 0&&this.instanceCount&&this.instanceCount>0&&o.vertexAttribDivisor(T,_)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Bi{constructor(o,u,_,w,T){this.context=o,this.width=u,this.height=_;const C=this.framebuffer=o.gl.createFramebuffer();w&&(this.colorAttachment=new el(o,C)),T&&(this.depthAttachmentType=T,this.depthAttachment=T==="renderbuffer"?new Bf(o,C):new Ph(o,C))}destroy(){const o=this.context.gl;if(this.colorAttachment){const u=this.colorAttachment.get();u&&o.deleteTexture(u)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const u=this.depthAttachment.get();u&&o.deleteRenderbuffer(u)}else{const u=this.depthAttachment.get();u&&o.deleteTexture(u)}o.deleteFramebuffer(this.framebuffer)}}class vi{constructor(o,u){this.gl=o,this.clearColor=new Rf(this),this.clearDepth=new Jo(this),this.clearStencil=new hl(this),this.colorMask=new Fu(this),this.depthMask=new yc(this),this.stencilMask=new qc(this),this.stencilFunc=new mu(this),this.stencilOp=new Np(this),this.stencilTest=new Df(this),this.depthRange=new Lf(this),this.depthTest=new Qo(this),this.depthFunc=new Ha(this),this.blend=new _a(this),this.blendFunc=new Zl(this),this.blendColor=new _c(this),this.blendEquation=new $d(this),this.cullFace=new gu(this),this.cullFaceSide=new md(this),this.frontFace=new Ch(this),this.program=new kf(this),this.activeTexture=new Nf(this),this.viewport=new Ih(this),this.bindFramebuffer=new gd(this),this.bindRenderbuffer=new Lm(this),this.bindTexture=new af(this),this.bindVertexBuffer=new Cg(this),this.bindElementBuffer=new yu(this),this.bindVertexArrayOES=new Vc(this),this.pixelStoreUnpack=new vc(this),this.pixelStoreUnpackPremultiplyAlpha=new Ig(this),this.pixelStoreUnpackFlipY=new zf(this),this.options=u?Object.assign({},u):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=o.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=o.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=o.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=u&&!!u.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=o.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),this.maxPointSize=o.getParameter(o.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,u,_){return new $i(this,o,u,_)}createVertexBuffer(o,u,_,w,T){return new Ga(this,o,u,_,w,T)}createRenderbuffer(o,u,_){const w=this.gl,T=w.createRenderbuffer();return this.bindRenderbuffer.set(T),w.renderbufferStorage(w.RENDERBUFFER,o,u,_),this.bindRenderbuffer.set(null),T}createFramebuffer(o,u,_,w){return new Bi(this,o,u,_,w)}clear({color:o,depth:u,stencil:_,colorMask:w}){const T=this.gl;let C=0;o&&(C|=T.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set(w||[!0,!0,!0,!0])),u!==void 0&&(C|=T.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),_!==void 0&&(C|=T.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),T.clear(C)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){i.bn(o.blendFunction,Mr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor),o.blendEquation?this.blendEquation.set(o.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(o.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let cs;function Ba(y,o,u,_,w,T,C){const z=y.context,V=z.gl,$=y.transform,K=y.getOrCreateProgram("collisionBox"),ee=[];let te=0,ce=0;for(let Ye=0;Ye<_.length;Ye++){const lt=_[Ye],nt=o.getTile(lt),rt=nt.getBucket(u);if(!rt)continue;const it=Pf(lt,rt,$);let dt=it;w[0]===0&&w[1]===0||(dt=y.translatePosMatrix(it,nt,w,T));const xt=C?rt.textCollisionBox:rt.iconCollisionBox,Xt=rt.collisionCircleArray;if(Xt.length>0){const zt=i.ad.mat4.create(),tn=dt;i.ad.mat4.mul(zt,rt.placementInvProjMatrix,$.glCoordMatrix),i.ad.mat4.mul(zt,zt,rt.placementViewportMatrix),ee.push({circleArray:Xt,circleOffset:ce,transform:tn,invTransform:zt,projection:rt.getProjection()}),te+=Xt.length/4,ce=te}xt&&(y.terrain&&y.terrain.setupElevationDraw(nt,K),K.draw(y,V.LINES,sr.disabled,Sr.disabled,y.colorModeForRenderPass(),br.disabled,at(dt,$,nt,rt.getProjection()),u.id,xt.layoutVertexBuffer,xt.indexBuffer,xt.segments,null,$.zoom,null,[xt.collisionVertexBuffer,xt.collisionVertexBufferExt]))}if(!C||!ee.length)return;const Te=y.getOrCreateProgram("collisionCircle"),ve=new i.cW;ve.resize(4*te),ve._trim();let Ce=0;for(const Ye of ee)for(let lt=0;lt<Ye.circleArray.length/4;lt++){const nt=4*lt,rt=Ye.circleArray[nt+0],it=Ye.circleArray[nt+1],dt=Ye.circleArray[nt+2],xt=Ye.circleArray[nt+3];ve.emplace(Ce++,rt,it,dt,xt,0),ve.emplace(Ce++,rt,it,dt,xt,1),ve.emplace(Ce++,rt,it,dt,xt,2),ve.emplace(Ce++,rt,it,dt,xt,3)}(!cs||cs.length<2*te)&&(cs=function(Ye){const lt=2*Ye,nt=new i.aV;nt.resize(lt),nt._trim();for(let rt=0;rt<lt;rt++){const it=6*rt;nt.uint16[it+0]=4*rt+0,nt.uint16[it+1]=4*rt+1,nt.uint16[it+2]=4*rt+2,nt.uint16[it+3]=4*rt+2,nt.uint16[it+4]=4*rt+3,nt.uint16[it+5]=4*rt+0}return nt}(te));const Pe=z.createIndexBuffer(cs,!0),qe=z.createVertexBuffer(ve,i.cX.members,!0);for(const Ye of ee){const lt={u_matrix:Ye.transform,u_inv_matrix:Ye.invTransform,u_camera_to_center_distance:(Je=$).getCameraToCenterDistance(Ye.projection),u_viewport_size:[Je.width,Je.height]};Te.draw(y,V.TRIANGLES,sr.disabled,Sr.disabled,y.colorModeForRenderPass(),br.disabled,lt,u.id,qe,Pe,i.b8.simpleSegment(0,2*Ye.circleOffset,Ye.circleArray.length,Ye.circleArray.length/2),null,$.zoom)}var Je;qe.destroy(),Pe.destroy()}const ji=i.ad.mat4.create();function fo(y){const o=y._camera.getWorldToCamera(y.worldSize,1),u=i.ad.mat4.multiply([],o,y.globeMatrix);i.ad.mat4.invert(u,u);const _=[0,0,0],w=[0,1,0,0];return i.ad.vec4.transformMat4(w,w,u),_[0]=w[0],_[1]=w[1],_[2]=w[2],i.ad.vec3.normalize(_,_),_}function ba({width:y,height:o,anchor:u,textOffset:_,textScale:w},T){const{horizontalAlign:C,verticalAlign:z}=i.bD(u),V=-(C-.5)*y,$=-(z-.5)*o,K=i.bC(u,_);return new i.P((V/w+K[0])*T,($/w+K[1])*T)}function is(y,o,u,_,w,T,C,z,V,$,K){const ee=y.text.placedSymbolArray,te=y.text.dynamicLayoutVertexArray,ce=y.icon.dynamicLayoutVertexArray,Te={},ve=y.getProjection(),Ce=Bo(z,ve,T),Pe=T.elevation,qe=ve.upVectorScale(z.canonical,T.center.lat,T.worldSize).metersToTile;te.clear();for(let Je=0;Je<ee.length;Je++){const Ye=ee.get(Je),{tileAnchorX:lt,tileAnchorY:nt,numGlyphs:rt}=Ye,it=Ye.hidden||!Ye.crossTileID||y.allowVerticalPlacement&&!Ye.placedOrientation?null:_[Ye.crossTileID];if(it){let dt=0,xt=0,Xt=0;if(Pe){const Qt=Pe?Pe.getAtTileOffset(z,lt,nt):0,[fn,Wt,mn]=ve.upVector(z.canonical,lt,nt);dt=Qt*fn*qe,xt=Qt*Wt*qe,Xt=Qt*mn*qe}let[zt,tn,un,Tn]=lo(Ye.projectedAnchorX+dt,Ye.projectedAnchorY+xt,Ye.projectedAnchorZ+Xt,u?Ce:C);const Lt=vh(T.getCameraToCenterDistance(ve),Tn);let an=w.evaluateSizeForFeature(y.textSizeData,$,Ye)*Lt/i.bw;u&&(an*=y.tilePixelRatio/V);const Pt=ba(it,an);u?({x:zt,y:tn,z:un}=ve.projectTilePoint(lt+Pt.x,nt+Pt.y,z.canonical),[zt,tn,un]=lo(zt+dt,tn+xt,un+Xt,C)):(o&&Pt._rotate(-T.angle),zt+=Pt.x,tn+=Pt.y,un=0);const sn=y.allowVerticalPlacement&&Ye.placedOrientation===i.bq.vertical?Math.PI/2:0;for(let Qt=0;Qt<rt;Qt++)i.bt(te,zt,tn,un,sn);K&&Ye.associatedIconIndex>=0&&(Te[Ye.associatedIconIndex]={x:zt,y:tn,z:un,angle:sn})}else Xo(rt,te)}if(K){ce.clear();const Je=y.icon.placedSymbolArray;for(let Ye=0;Ye<Je.length;Ye++){const lt=Je.get(Ye),{numGlyphs:nt}=lt,rt=Te[Ye];if(lt.hidden||!rt)Xo(nt,ce);else{const{x:it,y:dt,z:xt,angle:Xt}=rt;for(let zt=0;zt<nt;zt++)i.bt(ce,it,dt,xt,Xt)}}y.icon.dynamicLayoutVertexBuffer.updateData(ce)}y.text.dynamicLayoutVertexBuffer.updateData(te)}function bi(y,o,u,_,w,T,C={}){const z=u.paint.get("icon-translate"),V=u.paint.get("text-translate"),$=u.paint.get("icon-translate-anchor"),K=u.paint.get("text-translate-anchor"),ee=u.layout.get("icon-rotation-alignment"),te=u.layout.get("text-rotation-alignment"),ce=u.layout.get("icon-pitch-alignment"),Te=u.layout.get("text-pitch-alignment"),ve=u.layout.get("icon-keep-upright"),Ce=u.layout.get("text-keep-upright"),Pe=u.paint.get("icon-color-saturation"),qe=u.paint.get("icon-color-contrast"),Je=u.paint.get("icon-color-brightness-min"),Ye=u.paint.get("icon-color-brightness-max"),lt=u.layout.get("symbol-elevation-reference")==="sea",nt=y.context,rt=nt.gl,it=y.transform,dt=ee==="map",xt=te==="map",Xt=ce==="map",zt=Te==="map",tn=u.layout.get("symbol-sort-key").constantOr(1)!==void 0;let un=!1;const Tn=y.depthModeForSublayer(0,sr.ReadOnly),Lt=[i.av(it.center.lng),i.aC(it.center.lat)],an=u.layout.get("text-variable-anchor"),Pt=it.projection.name==="globe",sn=[],Qt=[0,-1,0];for(const fn of _){const Wt=o.getTile(fn),mn=Wt.getBucket(u);if(!mn||mn.projection.name==="mercator"&&Pt||mn.fullyClipped)continue;const zn=mn.projection.name==="globe",Bn=zn?i.ag(it.zoom):0,In=Bo(fn,mn.getProjection(),it),or=it.calculatePixelsToTileUnitsMatrix(Wt),Br=an&&mn.hasTextData(),mr=mn.hasIconTextFit()&&Br&&mn.hasIconData(),Dr=mn.getProjection().createInversionMatrix(it,fn.canonical),Er=Hi=>{it.depthOcclusionForSymbolsAndCircles&&(u.hasInitialOcclusionOpacityProperties||y.terrain)&&(Hi.push("DEPTH_D24"),Hi.push("DEPTH_OCCLUSION"))},Cr=()=>{const Hi=dt&&u.layout.get("symbol-placement")!=="point",ci=[];Er(ci);const Oi=Hi||mr,Ka=u.paint.get("icon-image-cross-fade").constantOr(0);y.terrainRenderModeElevated()&&Xt&&ci.push("PITCH_WITH_MAP_TERRAIN"),zn&&(ci.push("PROJECTION_GLOBE_VIEW"),Oi&&ci.push("PROJECTED_POS_ON_VIEWPORT")),Ka>0&&ci.push("ICON_TRANSITION"),mn.icon.zOffsetVertexBuffer&&ci.push("Z_OFFSET"),Pe===0&&qe===0&&Je===0&&Ye===1||ci.push("COLOR_ADJUSTMENT"),mn.sdfIcons&&ci.push("RENDER_SDF");const us=mn.icon.programConfigurations.get(u.id),to=y.getOrCreateProgram("symbol",{config:us,defines:ci}),Ws=Wt.imageAtlasTexture?Wt.imageAtlasTexture.size:[0,0],po=mn.iconSizeData,Ti=i.bp(po,it.zoom),ra=Xt||it.pitch!==0,Di=xs(In,Wt.tileID.canonical,Xt,dt,it,mn.getProjection(),or),sa=Ta(In,Wt.tileID.canonical,Xt,dt,it,mn.getProjection(),or),mo=y.translatePosMatrix(sa,Wt,z,$,!0),wa=y.translatePosMatrix(In,Wt,z,$),as=Oi?ji:Di,Su=dt&&!Xt&&!Hi;let Vo=Qt;!Pt&&!it.mercatorFromTransition||dt||(Vo=fo(it));const ec=zn?Vo:Qt,Rl=u.getColorAdjustmentMatrix(Pe,qe,Je,Ye),Xc=Gn(po.kind,Ti,Su,Xt,y,wa,as,mo,lt,!1,Ws,[0,0],!0,fn,Bn,Lt,Dr,ec,mn.getProjection(),Rl,Ka),yl=Wt.imageAtlasTexture?Wt.imageAtlasTexture:null,Fh=u.layout.get("icon-size").constantOr(0)!==1||mn.iconsNeedLinear,go=mn.sdfIcons||y.options.rotating||y.options.zooming||Fh||ra?rt.LINEAR:rt.NEAREST,_f=mn.sdfIcons&&u.paint.get("icon-halo-width").constantOr(1)!==0,Dl=y.terrain&&Xt&&Hi?i.ad.mat4.invert(i.ad.mat4.create(),Di):ji;if(Hi&&mn.icon){const op=it.elevation,Yp=op?op.getAtTileOffsetFunc(fn,it.center.lat,it.worldSize,mn.getProjection()):null,zg=za(In,Wt.tileID.canonical,Xt,dt,it,mn.getProjection(),or);ou(mn,In,y,!1,zg,sa,Xt,ve,Yp,fn)}return{program:to,buffers:mn.icon,uniformValues:Xc,atlasTexture:yl,atlasTextureIcon:null,atlasInterpolation:go,atlasInterpolationIcon:null,isSDF:mn.sdfIcons,hasHalo:_f,tile:Wt,labelPlaneMatrixInv:Dl}},jr=()=>{const Hi=xt&&u.layout.get("symbol-placement")!=="point",ci=[],Oi=Hi||an||mr;y.terrainRenderModeElevated()&&zt&&ci.push("PITCH_WITH_MAP_TERRAIN"),zn&&(ci.push("PROJECTION_GLOBE_VIEW"),Oi&&ci.push("PROJECTED_POS_ON_VIEWPORT")),mn.text.zOffsetVertexBuffer&&ci.push("Z_OFFSET"),mn.iconsInText&&ci.push("RENDER_TEXT_AND_SYMBOL"),ci.push("RENDER_SDF"),Er(ci);const Ka=mn.text.programConfigurations.get(u.id),us=y.getOrCreateProgram("symbol",{config:Ka,defines:ci});let to,Ws=[0,0],po=null;const Ti=mn.textSizeData;mn.iconsInText&&(Ws=Wt.imageAtlasTexture?Wt.imageAtlasTexture.size:[0,0],po=Wt.imageAtlasTexture?Wt.imageAtlasTexture:null,to=zt||it.pitch!==0||y.options.rotating||y.options.zooming||Ti.kind==="composite"||Ti.kind==="camera"?rt.LINEAR:rt.NEAREST);const ra=Wt.glyphAtlasTexture?Wt.glyphAtlasTexture.size:[0,0],Di=u.layout.get("text-size-scale-range"),sa=i.ay(y.scaleFactor,Di[0],Di[1]),mo=i.bp(Ti,it.zoom,sa),wa=xs(In,Wt.tileID.canonical,zt,xt,it,mn.getProjection(),or),as=Ta(In,Wt.tileID.canonical,zt,xt,it,mn.getProjection(),or),Su=y.translatePosMatrix(as,Wt,V,K,!0),Vo=y.translatePosMatrix(In,Wt,V,K),ec=Oi?ji:wa,Rl=xt&&!zt&&!Hi;let Xc=Qt;!Pt&&!it.mercatorFromTransition||xt||(Xc=fo(it));const yl=Gn(Ti.kind,mo,Rl,zt,y,Vo,ec,Su,lt,!0,ra,Ws,!0,fn,Bn,Lt,Dr,zn?Xc:Qt,mn.getProjection(),null,null,sa),Fh=Wt.glyphAtlasTexture?Wt.glyphAtlasTexture:null,go=rt.LINEAR,_f=u.paint.get("text-halo-width").constantOr(1)!==0,Dl=y.terrain&&zt&&Hi?i.ad.mat4.invert(i.ad.mat4.create(),wa):ji;if(Hi&&mn.text){const op=it.elevation,Yp=op?op.getAtTileOffsetFunc(fn,it.center.lat,it.worldSize,mn.getProjection()):null,zg=za(In,Wt.tileID.canonical,zt,xt,it,mn.getProjection(),or);ou(mn,In,y,!0,zg,as,zt,Ce,Yp,fn)}return{program:us,buffers:mn.text,uniformValues:yl,atlasTexture:Fh,atlasTextureIcon:po,atlasInterpolation:go,atlasInterpolationIcon:to,isSDF:!0,hasHalo:_f,tile:Wt,labelPlaneMatrixInv:Dl}},Nr=mn.icon.segments.get().length,fr=mn.text.segments.get().length,ai=Nr&&!C.onlyText?Cr():null,Ar=fr&&!C.onlyIcons?jr():null,tr=u.paint.get("icon-opacity").constantOr(1),si=u.paint.get("text-opacity").constantOr(1);if(tn&&mn.canOverlap){un=!0;const Hi=tr&&!C.onlyText?mn.icon.segments.get():[],ci=si&&!C.onlyIcons?mn.text.segments.get():[];for(const Oi of Hi)sn.push({segments:new i.b8([Oi]),sortKey:Oi.sortKey,state:ai});for(const Oi of ci)sn.push({segments:new i.b8([Oi]),sortKey:Oi.sortKey,state:Ar})}else C.onlyText||sn.push({segments:tr?mn.icon.segments:new i.b8([]),sortKey:0,state:ai}),C.onlyIcons||sn.push({segments:si?mn.text.segments:new i.b8([]),sortKey:0,state:Ar})}un&&sn.sort((fn,Wt)=>fn.sortKey-Wt.sortKey);for(const fn of sn){const Wt=fn.state;if(Wt)if(y.terrain?y.terrain.setupElevationDraw(Wt.tile,Wt.program,{useDepthForOcclusion:it.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Wt.labelPlaneMatrixInv}):y.setupDepthForOcclusion(it.depthOcclusionForSymbolsAndCircles,Wt.program),nt.activeTexture.set(rt.TEXTURE0),Wt.atlasTexture&&Wt.atlasTexture.bind(Wt.atlasInterpolation,rt.CLAMP_TO_EDGE,!0),Wt.atlasTextureIcon&&(nt.activeTexture.set(rt.TEXTURE1),Wt.atlasTextureIcon&&Wt.atlasTextureIcon.bind(Wt.atlasInterpolationIcon,rt.CLAMP_TO_EDGE,!0)),y.uploadCommonLightUniforms(y.context,Wt.program),Wt.hasHalo){const mn=Wt.uniformValues;mn.u_is_halo=1,ka(Wt.buffers,fn.segments,u,y,Wt.program,Tn,w,T,mn,2),mn.u_is_halo=0}else{if(Wt.isSDF){const mn=Wt.uniformValues;Wt.hasHalo&&(mn.u_is_halo=1,ka(Wt.buffers,fn.segments,u,y,Wt.program,Tn,w,T,mn,1)),mn.u_is_halo=0}ka(Wt.buffers,fn.segments,u,y,Wt.program,Tn,w,T,Wt.uniformValues,1)}}}function ka(y,o,u,_,w,T,C,z,V,$){const K=[y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer,y.iconTransitioningVertexBuffer,y.globeExtVertexBuffer,y.zOffsetVertexBuffer];w.draw(_,_.context.gl.TRIANGLES,T,C,z,br.disabled,V,u.id,y.layoutVertexBuffer,y.indexBuffer,o,u.paint,_.transform.zoom,y.programConfigurations.get(u.id),K,$)}function $s(y,o){const u=1<<y.canonical.z,_=(o.x*u-y.canonical.x-y.wrap*u)*i.ai,w=(o.y*u-y.canonical.y)*i.ai,T=i.d5(o.z,o.y);return i.ad.vec3.fromValues(_,w,T)}function wo(y,o,u,_,w){if(!u.layout||u.layout.get("fill-elevation-reference")==="none")return;const T=y.context.gl,C=new sr(y.context.gl.LEQUAL,sr.ReadWrite,y.depthRangeFor3D),z=new sr(y.context.gl.GREATER,sr.ReadWrite,y.depthRangeFor3D),V=function(ce){const Te=i.c4(ce.pitch);let ve=.01;return ce.isOrthographic&&(ve=i.ah(1e-4,ve,i.c9(Te>=On?1:Te/On))),2*ve}(y.transform),$=y.transform.getFreeCameraOptions().position,K="elevatedStructuresDepthReconstruct",ee=y.getOrCreateProgram(K,{defines:["DEPTH_RECONSTRUCTION"]}),te=y.getOrCreateProgram(K);for(const ce of _){const Te=o.getTile(ce),ve=Te.getBucket(u);if(!ve)continue;const Ce=ve.elevatedStructures;if(!Ce)continue;const Pe=ve.elevationBufferData.heightRange,qe=$s(ce.toUnwrapped(),$),Je=y.translatePosMatrix(ce.projMatrix,Te,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));let Ye,lt,nt,rt;if(w==="initialize"){if(!Pe||Pe.min>=1||Ce.depthSegments.segments[0].primitiveLength===0)continue;Ye=et(Je,qe,V,1,0),lt=C,nt=Ce.depthSegments,rt=ee}else if(w==="reset"){if(!Pe||Pe.min>=0||Ce.maskSegments.segments[0].primitiveLength===0)continue;Ye=et(Je,qe,0,0,1),lt=z,nt=Ce.maskSegments,rt=ee}else if(w==="geometry"){if(Ce.depthSegments.segments[0].primitiveLength===0)continue;Ye=et(Je,qe,V,1,0),lt=C,nt=Ce.depthSegments,rt=te}rt.draw(y,T.TRIANGLES,lt,Sr.disabled,Mr.disabled,br.disabled,Ye,u.id,Ce.vertexBuffer,Ce.indexBuffer,nt,u.paint,y.transform.zoom)}}function nl(y,o,u){const{painter:_,sourceCache:w,layer:T,coords:C,colorMode:z,elevationType:V,terrainEnabled:$,pass:K}=y,ee=_.context.gl,te=T.paint.get("fill-pattern");let ce=V;V!=="road"||o&&!$||(ce="none");const Te=ce==="road",ve=new sr(_.context.gl.LEQUAL,sr.ReadWrite,_.depthRangeFor3D),Ce=te&&te.constantOr(1),Pe=(qe,Je)=>{let Ye,lt,nt,rt,it;Je?(lt=Ce&&!T.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Ye=ee.LINES):(lt=Ce?"fillPattern":"fill",Ye=ee.TRIANGLES);for(const dt of C){const xt=w.getTile(dt);if(Ce&&!xt.patternsLoaded())continue;const Xt=xt.getBucket(T);if(!Xt)continue;const zt=o?Xt.elevationBufferData:Xt.bufferData;if(zt.isEmpty())continue;_.prepareDrawTile();const tn=zt.programConfigurations.get(T.id),un=_.isTileAffectedByFog(dt),Tn=[],Lt=[];Te&&(Tn.push("ELEVATED_ROADS"),Lt.push(zt.elevatedLayoutVertexBuffer));const an=_.getOrCreateProgram(lt,{config:tn,overrideFog:un,defines:Tn});Ce&&(_.context.activeTexture.set(ee.TEXTURE0),xt.imageAtlasTexture&&xt.imageAtlasTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),tn.updatePaintBuffers());const Pt=te.constantOr(null);if(Pt&&xt.imageAtlas){const fn=xt.imageAtlas,Wt=i.d0.from(Pt).getPrimary().scaleSelf(i.q.devicePixelRatio).toString(),mn=fn.patternPositions.get(Wt);mn&&tn.setConstantPatternPositions(mn)}const sn=_.translatePosMatrix(dt.projMatrix,xt,T.paint.get("fill-translate"),T.paint.get("fill-translate-anchor")),Qt=T.paint.get("fill-emissive-strength");if(Je){rt=zt.lineIndexBuffer,it=zt.lineSegments;const fn=_.terrain&&_.terrain.renderingToTexture?_.terrain.drapeBufferSize:[ee.drawingBufferWidth,ee.drawingBufferHeight];nt=lt==="fillOutlinePattern"&&Ce?Ze(sn,Qt,_,xt,fn):Ve(sn,Qt,fn)}else rt=zt.indexBuffer,it=zt.triangleSegments,nt=Ce?Ie(sn,Qt,_,xt):de(sn,Qt);_.uploadCommonUniforms(_.context,an,dt.toUnwrapped()),an.draw(_,Ye,ce!=="none"?ve:qe,u||_.stencilModeForClipping(dt),z,br.disabled,nt,T.id,zt.layoutVertexBuffer,rt,it,T.paint,_.transform.zoom,tn,Lt)}};_.renderPass===K&&Pe(_.depthModeForSublayer(1,_.renderPass==="opaque"?sr.ReadWrite:sr.ReadOnly),!1),ce==="none"&&_.renderPass==="translucent"&&T.paint.get("fill-antialias")&&Pe(_.depthModeForSublayer(T.getPaintProperty("fill-outline-color")?2:0,sr.ReadOnly),!0)}function Cl(y,o,u,_,w,T,C,z){u.resetLayerRenderingStats(y);const V=y.context,$=V.gl,K=y.transform,ee=u.paint.get("fill-extrusion-pattern"),te=ee.constantOr(1),ce=u.paint.get("fill-extrusion-opacity"),Te=y.style.enable3dLights(),ve=u.paint.get(Te&&!te?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Ce=[u.paint.get("fill-extrusion-ambient-occlusion-intensity"),ve],Pe=u.layout.get("fill-extrusion-edge-radius"),qe=Pe>0&&!u.paint.get("fill-extrusion-rounded-roof"),Je=qe?0:Pe,Ye=K.projection.name==="globe"?i.d6():0,lt=K.projection.name==="globe",nt=lt?i.ag(K.zoom):0,rt=[i.av(K.center.lng),i.aC(K.center.lat)],it=u.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",dt=u.paint.get("fill-extrusion-flood-light-color").toRenderColor(it?null:u.lut).toArray01().slice(0,3),xt=u.paint.get("fill-extrusion-flood-light-intensity"),Xt=u.paint.get("fill-extrusion-vertical-scale"),zt=u.paint.get("fill-extrusion-line-width").constantOr(1)!==0,tn=u.paint.get("fill-extrusion-height-alignment"),un=u.paint.get("fill-extrusion-base-alignment"),Tn=Vs(y,u.paint.get("fill-extrusion-cutoff-fade-range")),Lt=[];let an;lt&&Lt.push("PROJECTION_GLOBE_VIEW"),Ce[0]>0&&Lt.push("FAUX_AO"),qe&&Lt.push("ZERO_ROOF_RADIUS"),z&&Lt.push("HAS_CENTROID"),xt>0&&Lt.push("FLOOD_LIGHT"),Tn.shouldRenderCutoff&&Lt.push("RENDER_CUTOFF"),zt&&Lt.push("RENDER_WALL_MODE");const Pt=y.renderPass==="shadow",sn=y.shadowRenderer,Qt=Pt&&!!sn;y.shadowRenderer&&(y.shadowRenderer.useNormalOffset=!0);let fn=[0,0,0];if(sn){const zn=y.style.directionalLight,Bn=y.style.ambientLight;zn&&Bn&&(fn=Du(y.style,zn,Bn)),Pt||(Lt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),sn.useNormalOffset&&Lt.push("NORMAL_OFFSET")),an=Lt.concat(["SHADOWS_SINGLE_CASCADE"])}const Wt=Qt?"fillExtrusionDepth":te?"fillExtrusionPattern":"fillExtrusion",mn=u.getLayerRenderingStats();for(const zn of _){const Bn=o.getTile(zn),In=Bn.getBucket(u);if(!In||In.projection.name!==K.projection.name)continue;let or=!1;sn&&(or=sn.getMaxCascadeForTile(zn.toUnwrapped())===0);const Br=y.isTileAffectedByFog(zn),mr=In.programConfigurations.get(u.id),Dr=y.getOrCreateProgram(Wt,{config:mr,defines:or?an:Lt,overrideFog:Br});if(y.terrain&&y.terrain.setupElevationDraw(Bn,Dr,{useMeterToDem:!0}),!In.centroidVertexBuffer){const Ar=Dr.attributes.a_centroid_pos;Ar!==void 0&&$.vertexAttrib2f(Ar,0,0)}!Pt&&sn&&sn.setupShadows(Bn.tileID.toUnwrapped(),Dr,"vector-tile",Bn.tileID.overscaledZ),te&&(y.context.activeTexture.set($.TEXTURE0),Bn.imageAtlasTexture&&Bn.imageAtlasTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),mr.updatePaintBuffers());const Er=ee.constantOr(null);if(Er&&Bn.imageAtlas){const Ar=Bn.imageAtlas,tr=i.d0.from(Er).getPrimary().scaleSelf(i.q.devicePixelRatio),si=Ar.patternPositions.get(tr.toString());si&&mr.setConstantPatternPositions(si)}const Cr=u.paint.get("fill-extrusion-vertical-gradient"),jr=1/In.tileToMeter;let Nr;if(Pt&&sn){if(Wa(Bn.tileID,In,y))continue;const Ar=sn.calculateShadowPassMatrixFromTile(Bn.tileID.toUnwrapped());Nr=q(Ar,Je,jr,Xt,tn,un)}else{const Ar=y.translatePosMatrix(zn.expandedProjMatrix,Bn,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),tr=K.projection.createInversionMatrix(K,zn.canonical);Nr=te?Z(Ar,y,Cr,ce,Ce,Je,jr,zn,Bn,Ye,tn,un,nt,rt,tr,dt,Xt):jf(Ar,y,Cr,ce,Ce,Je,jr,zn,Ye,tn,un,nt,rt,tr,dt,Xt,xt,fn)}y.uploadCommonUniforms(V,Dr,zn.toUnwrapped(),null,Tn);let fr=In.segments;if(K.projection.name==="mercator"&&!Pt&&(fr=In.getVisibleSegments(Bn.tileID,y.terrain,y.transform.getFrustum(0)),!fr.get().length))continue;if(mn)if(Pt)for(const Ar of fr.get())mn.numRenderedVerticesInShadowPass+=Ar.primitiveLength;else for(const Ar of fr.get())mn.numRenderedVerticesInTransparentPass+=Ar.primitiveLength;const ai=[];(y.terrain||z)&&ai.push(In.centroidVertexBuffer),lt&&ai.push(In.layoutVertexExtBuffer),zt&&ai.push(In.wallVertexBuffer),Dr.draw(y,V.gl.TRIANGLES,w,T,C,br.backCCW,Nr,u.id,In.layoutVertexBuffer,In.indexBuffer,fr,u.paint,y.transform.zoom,mr,ai)}y.shadowRenderer&&(y.shadowRenderer.useNormalOffset=!1)}function Es(y,o,u,_,w,T,C,z,V,$,K,ee,te,ce,Te,ve,Ce,Pe,qe){const Je=y.context,Ye=Je.gl,lt=y.transform,nt=y.transform.zoom,rt=[],it=Vs(y,u.paint.get("fill-extrusion-cutoff-fade-range"));$==="clear"?(rt.push("CLEAR_SUBPASS"),qe&&(rt.push("CLEAR_FROM_TEXTURE"),Je.activeTexture.set(Ye.TEXTURE0),qe.bind(Ye.LINEAR,Ye.CLAMP_TO_EDGE))):$==="sdf"&&rt.push("SDF_SUBPASS"),Ce&&rt.push("HAS_CENTROID"),it.shouldRenderCutoff&&rt.push("RENDER_CUTOFF");const dt=u.layout.get("fill-extrusion-edge-radius"),xt=(Xt,zt,tn,un,Tn)=>{const Lt=zt.programConfigurations.get(u.id),an=y.isTileAffectedByFog(Xt),Pt=y.getOrCreateProgram("fillExtrusionGroundEffect",{config:Lt,defines:rt,overrideFog:an}),sn=((fn,Wt,mn,zn,Bn,In,or,Br,mr,Dr,Er)=>({u_matrix:Wt,u_opacity:mn,u_ao_pass:zn?1:0,u_meter_to_tile:Bn,u_ao:In,u_flood_light_intensity:or,u_flood_light_color:Br,u_attenuation:mr,u_edge_radius:Dr,u_fb:0,u_fb_size:Er,u_dynamic_offset:1}))(0,un,K,V,Tn,[ee,te*Tn],ce,Te,ve,nt>=17?0:dt*Tn,qe?qe.size[0]:0),Qt=[];Ce&&Qt.push(zt.hiddenByLandmarkVertexBuffer),y.uploadCommonUniforms(Je,Pt,Xt.toUnwrapped(),null,it),Pt.draw(y,Je.gl.TRIANGLES,w,T,C,z,sn,u.id,zt.vertexBuffer,zt.indexBuffer,tn,u.paint,nt,Lt,Qt)};for(const Xt of _){const zt=o.getTile(Xt),tn=zt.getBucket(u);if(!tn||tn.projection.name!==lt.projection.name||!tn.groundEffect||tn.groundEffect&&!tn.groundEffect.hasData())continue;const un=tn.groundEffect,Tn=1/tn.tileToMeter;{const Lt=y.translatePosMatrix(Xt.projMatrix,zt,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),an=un.getDefaultSegment();xt(Xt,un,an,Lt,Tn)}if(Pe)for(let Lt=0;Lt<4;Lt++){const an=i.d7[Lt](Xt),Pt=o.getTile(an);if(!Pt)continue;const sn=Pt.getBucket(u);if(!sn||sn.projection.name!==lt.projection.name||!sn.groundEffect||sn.groundEffect&&!sn.groundEffect.hasData())continue;const Qt=sn.groundEffect;let fn,Wt;Lt===0?(fn=[-i.ai,0,0],Wt=1):Lt===1?(fn=[i.ai,0,0],Wt=0):Lt===2?(fn=[0,-i.ai,0],Wt=3):(fn=[0,i.ai,0],Wt=2);const mn=Qt.regionSegments[Wt];if(!mn)continue;const zn=new Float32Array(16);i.ad.mat4.translate(zn,Xt.projMatrix,fn),xt(Xt,Qt,mn,y.translatePosMatrix(zn,zt,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Tn)}}}function Il(y,o,u,_,w,T,C){_.centroidVertexArray.length===0&&_.createCentroidsBuffer();const z=T?T.findDEMTileFor(u):null;if(!(z&&z.dem||C))return;T&&z&&z.dem&&_.selfDEMTileTimestamp!==z.dem._timestamp&&(_.borderDoneWithNeighborZ=[-1,-1,-1,-1],_.selfDEMTileTimestamp=z.dem._timestamp);const V=Pe=>new i.P(Math.ceil((Pe+i.da)*i.db),0),$=Pe=>{const qe=o.getSource().minzoom,Je=lt=>{const nt=o.getTileByID(lt);if(nt&&nt.hasData())return nt.getBucket(w)},Ye=[0,-1,1];for(const lt of Ye){if(Pe.overscaledZ+lt<qe)continue;const nt=Je(Pe.calculateScaledKey(Pe.overscaledZ+lt));if(nt)return nt}},K=[0,0,0],ee=(Pe,qe)=>(K[0]=Math.min(Pe.min.y,qe.min.y),K[1]=Math.max(Pe.max.y,qe.max.y),K[2]=i.ai-qe.min.x>Pe.max.x?qe.min.x-i.ai:Pe.max.x,K),te=(Pe,qe)=>(K[0]=Math.min(Pe.min.x,qe.min.x),K[1]=Math.max(Pe.max.x,qe.max.x),K[2]=i.ai-qe.min.y>Pe.max.y?qe.min.y-i.ai:Pe.max.y,K),ce=[(Pe,qe)=>ee(Pe,qe),(Pe,qe)=>ee(qe,Pe),(Pe,qe)=>te(Pe,qe),(Pe,qe)=>te(qe,Pe)],Te=(Pe,qe,Je,Ye,lt,nt,rt)=>{if(!T)return 0;const it=[[nt?Je:Pe,nt?Pe:Je,0],[nt?Je:qe,nt?qe:Je,0]],dt=rt<0?i.ai+rt:rt,xt=[nt?dt:(Pe+qe)/2,nt?(Pe+qe)/2:dt,0];return Je===0&&rt<0||Je!==0&&rt>0?T.getForTilePoints(lt,[xt],!0,Ye):it.push(xt),T.getForTilePoints(u,it,!0,z),Math.max(it[0][2],it[1][2],xt[2])/T.exaggeration()};for(let Pe=0;Pe<4;Pe++){const qe=_.borderFeatureIndices[Pe];if(qe.length===0)continue;const Je=i.d7[Pe](u),Ye=$(Je);if(!(Ye&&Ye instanceof i.d8))continue;const lt=T?T.findDEMTileFor(Je):null;if(!(lt&&lt.dem||C)||(T&&lt&&lt.dem&&_.borderDEMTileTimestamp[Pe]!==lt.dem._timestamp&&(_.borderDoneWithNeighborZ[Pe]=-1,_.borderDEMTileTimestamp[Pe]=lt.dem._timestamp),_.borderDoneWithNeighborZ[Pe]===Ye.canonical.z))continue;Ye.centroidVertexArray.length===0&&Ye.createCentroidsBuffer();const nt=(Pe<2?1:5)-Pe,rt=Ye.borderDoneWithNeighborZ[nt]!==_.canonical.z,it=Ye.borderFeatureIndices[nt];let dt=0;if(_.canonical.z!==Ye.canonical.z){for(const xt of qe)_.showCentroid(_.featuresOnBorder[xt]);if(rt)for(const xt of it)Ye.showCentroid(Ye.featuresOnBorder[xt]);_.borderDoneWithNeighborZ[Pe]=Ye.canonical.z,Ye.borderDoneWithNeighborZ[nt]=_.canonical.z}for(const xt of qe){const Xt=_.featuresOnBorder[xt],zt=_.centroidData[Xt.centroidDataIndex],tn=Xt.borders[Pe];let un;for(;dt<it.length;){un=Ye.featuresOnBorder[it[dt]];const Tn=un.borders[nt];if(Tn[1]>tn[0]+3||Tn[0]>tn[0]-3)break;Ye.showCentroid(un),dt++}if(un&&dt<it.length){const Tn=dt;let Lt=0;for(;!(un.borders[nt][0]>tn[1]-3)&&(Lt++,++dt!==it.length);)un=Ye.featuresOnBorder[it[dt]];un=Ye.featuresOnBorder[it[Tn]];let an=!1;if(Lt>=1){const Qt=un.borders[nt];Math.abs(tn[0]-Qt[0])<3&&Math.abs(tn[1]-Qt[1])<3&&(Lt=1,an=!0,dt=Tn+1)}else if(Lt===0){_.showCentroid(Xt);continue}const Pt=Ye.centroidData[un.centroidDataIndex];C&&an&&(((ve=zt).flags|(Ce=Pt).flags)&i.d9?(ve.flags|=i.d9,Ce.flags|=i.d9):(ve.flags&=~i.d9,Ce.flags&=~i.d9));const sn=Xt.intersectsCount()>1||un.intersectsCount()>1;if(Lt>1)dt=Tn,zt.centroidXY=Pt.centroidXY=new i.P(0,0);else if(lt&&lt.dem&&!sn){const Qt=ce[Pe](zt,Pt),fn=Pe%2?i.ai-1:0,Wt=Te(Qt[0],Math.min(i.ai-1,Qt[1]),fn,lt,Je,Pe<2,Qt[2]);zt.centroidXY=Pt.centroidXY=V(Wt)}else sn?zt.centroidXY=Pt.centroidXY=new i.P(0,0):(zt.centroidXY=_.encodeBorderCentroid(Xt),Pt.centroidXY=Ye.encodeBorderCentroid(un));_.writeCentroidToBuffer(zt),Ye.writeCentroidToBuffer(Pt)}else _.showCentroid(Xt)}_.borderDoneWithNeighborZ[Pe]=Ye.canonical.z,Ye.borderDoneWithNeighborZ[nt]=_.canonical.z}var ve,Ce;(_.needsCentroidUpdate||!_.centroidVertexBuffer&&_.centroidVertexArray.length!==0)&&_.uploadCentroid(y)}const xc=[1,0,0],En=[0,1,0],Fn=[0,0,1];function Wa(y,o,u){const _=u.transform,w=u.shadowRenderer;if(!w)return!0;const T=y.toUnwrapped(),C=_.tileSize*w._cascades[u.currentShadowCascade].scale;let z=o.maxHeight;if(_.elevation){const ve=_.elevation.getMinMaxForTile(y);ve&&(z+=ve.max)}const V=[...w.shadowDirection];V[2]=-V[2];const $=w.computeSimplifiedTileShadowVolume(T,z,C,V);if(!$)return!1;const K=[xc,En,Fn,V,[V[0],0,V[2]],[0,V[1],V[2]]],ee=_.projection.name==="globe",te=_.scaleZoom(C),ce=i.bR.fromInvProjectionMatrix(_.invProjMatrix,_.worldSize,te,!ee),Te=w.getCurrentCascadeFrustum();return ce.intersectsPrecise($.vertices,$.planes,K)===0||Te.intersectsPrecise($.vertices,$.planes,K)===0}function Ra(y){return[y[0]*i.dc,y[1]*i.dc,y[2]*i.dc,0]}function qt(y,o,u,_,w,T,C,z,V){const $=_.getSource(),K=u.globeSharedBuffers;if(!K)return;let ee,te,ce;if(o&&(ee=_.getTile(o)),$ instanceof i.aK?(te=$.texture,ce=i.cJ(0,0,u.transform)):ee&&o&&(te=ee.texture,ce=i.cJ(o.canonical.z,o.canonical.x,u.transform)),!te||!ce)return;y||(ce=i.ad.mat4.scale(i.ad.mat4.create(),ce,[1,-1,1]));const Te=u.context,ve=Te.gl,Ce=w.paint.get("raster-resampling")==="nearest"?ve.NEAREST:ve.LINEAR,Pe=u.colorModeForDrapableLayerRenderPass(T),qe=C.defines;qe.push("GLOBE_POLES");const Je=new sr(ve.LEQUAL,sr.ReadWrite,u.depthRangeFor3D),Ye=Float32Array.from(u.transform.expandedFarZProjMatrix),lt=Float32Array.from(i.bc(i.cI(new i.bT(0,0,0))));u.terrain&&u.terrain.prepareDrawTile(),Te.activeTexture.set(ve.TEXTURE0),te.bind(Ce,ve.CLAMP_TO_EDGE),Te.activeTexture.set(ve.TEXTURE1),te.bind(Ce,ve.CLAMP_TO_EDGE),"useMipmap"in te&&Te.extTextureFilterAnisotropic&&u.transform.pitch>20&&ve.texParameterf(ve.TEXTURE_2D,Te.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Te.extTextureFilterAnisotropicMax);const[nt,rt,it,dt]=o?K.getPoleBuffers(o.canonical.z,!1):K.getPoleBuffers(0,!0),xt=w.paint.get("raster-elevation");let Xt;y?(Xt=nt,u.renderDefaultNorthPole=xt!==0):(Xt=rt,u.renderDefaultSouthPole=xt!==0);const zt=Ra(C.mix),tn=((Tn,Lt,an,Pt,sn,Qt,fn,Wt,mn,zn,Bn,In,or)=>nn(Tn,Lt,an,new Float32Array(16),new Float32Array(9),[0,0],Pt,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Qt,[0,0],Wt,2,zn,Bn,In,1,0,or))(Ye,lt,ce,i.ag(u.transform.zoom),0,w,0,xt,0,zt,C.offset,C.range,T),un=u.getOrCreateProgram("raster",{defines:qe});u.uploadCommonUniforms(Te,un,null),un.draw(u,ve.TRIANGLES,Je,V,Pe,z,tn,w.id,Xt,it,dt)}function Up(y){const o=y._nearZ,u=y.projection.farthestPixelDistance(y),_=u-o,w=.2*y.height,T=o+w;return[o,u,(T-w-o)/_,(T-o)/_]}function sf(y,o,u,_){if(y)return o instanceof Oa&&y instanceof No?o.getTextureDescriptor(y,u,!0):{texture:y.texture,mix:Ra(_.mix),offset:_.offset,buffer:0,tileSize:1}}var of=i.dd([{name:"a_index",type:"Int16",components:1}]);class lf{constructor(o,u,_,w){const T={width:_[0],height:_[1],data:null},C=o.gl;this.targetColorTexture=new i.T(o,T,C.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new i.T(o,T,C.RGBA8,{useMipmap:!1}),this.context=o,this.updateParticleTexture(u,w),this.lastInvalidatedAt=0}updateParticleTexture(o,u){if(this.particleTextureDimension===u.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const _=this.context.gl,w=u.width*u.height;this.particleTexture0=new i.T(this.context,u,_.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new i.T(this.context,u,_.RGBA8,{premultiply:!1,useMipmap:!1});const T=new i.de;T.reserve(w);for(let C=0;C<w;C++)T.emplaceBack(C);this.particleIndexBuffer=this.context.createVertexBuffer(T,of.members,!0),this.particleSegment=i.b8.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=u.width}update(o){return!(this.lastInvalidatedAt<o&&(this.lastInvalidatedAt=i.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function wc(y,o,u){if(!y)return null;const _=o.getTextureDescriptor(y,u,!0);if(!_)return null;let{texture:w,mix:T,offset:C,tileSize:z,buffer:V,format:$}=_;if(!w||!$)return null;let K=!1;return $==="uint32"&&(K=!0,T[3]=0,T=Mt(i.df,T,[0,u.paint.get("raster-particle-max-speed")]),C=vn(i.df,C,[0,u.paint.get("raster-particle-max-speed")])),{texture:w,textureOffset:[V/(z+2*V),z/(z+2*V)],tileSize:z,scalarData:K,scale:T,offset:C,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[$]]}}function cf(y){const o=y._nearZ,u=y.projection.farthestPixelDistance(y),_=u-o,w=.2*y.height,T=o+w;return[o,u,(T-w-o)/_,(T-o)/_]}const Hc=new i.al(1,0,0,1),Nm=new i.al(0,1,0,1),Gd=new i.al(0,0,1,1),zm=new i.al(1,0,1,1),uf=new i.al(0,1,1,1);function Pl(y,o,u,_,w,T,C){const z=y.context,V=y.transform,$=z.gl,K=V.projection.name==="globe",ee=K?["PROJECTION_GLOBE_VIEW"]:[];let te=i.ad.mat4.clone(u.projMatrix);if(K&&i.ag(V.zoom)>0){const zt=i.bb(u.canonical,V),tn=i.dg(zt);te=i.ad.mat4.multiply(new Float32Array(16),V.globeMatrix,tn),i.ad.mat4.multiply(te,V.projMatrix,te)}const ce=i.ad.mat4.create();ce[12]+=2*w/(i.q.devicePixelRatio*V.width),ce[13]+=2*T/(i.q.devicePixelRatio*V.height),i.ad.mat4.multiply(te,ce,te);const Te=y.getOrCreateProgram("debug",{defines:ee}),ve=o.getTileByID(u.key);y.terrain&&y.terrain.setupElevationDraw(ve,Te);const Ce=sr.disabled,Pe=Sr.disabled,qe=y.colorModeForRenderPass(),Je="$debug";z.activeTexture.set($.TEXTURE0),y.emptyTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),K?ve._makeGlobeTileDebugBuffers(y.context,V):ve._makeDebugTileBoundsBuffers(y.context,V.projection);const Ye=ve._tileDebugBuffer||y.debugBuffer,lt=ve._tileDebugIndexBuffer||y.debugIndexBuffer,nt=ve._tileDebugSegments||y.debugSegments;if(Te.draw(y,$.LINE_STRIP,Ce,Pe,qe,br.disabled,ut(te,_),Je,Ye,lt,nt,null,null,null,[ve._globeTileDebugBorderBuffer]),C){const zt=ve.latestRawTileData,tn=Math.floor((zt&&zt.byteLength||0)/1024);let un=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(un+=` => ${u.overscaledZ}`),un+=` ${ve.state}`,un+=` ${tn}kb`,function(Tn,Lt){Tn.initDebugOverlayCanvas();const an=Tn.debugOverlayCanvas,Pt=Tn.context.gl,sn=Tn.debugOverlayCanvas.getContext("2d");sn.clearRect(0,0,an.width,an.height),sn.shadowColor="white",sn.shadowBlur=2,sn.lineWidth=1.5,sn.strokeStyle="white",sn.textBaseline="top",sn.font="bold 36px Open Sans, sans-serif",sn.fillText(Lt,5,5),sn.strokeText(Lt,5,5),Tn.debugOverlayTexture.update(an),Tn.debugOverlayTexture.bind(Pt.LINEAR,Pt.CLAMP_TO_EDGE)}(y,un)}const rt=o.getTile(u).tileSize,it=512/Math.min(rt,512)*(u.overscaledZ/V.zoom)*.5,dt=ve._tileDebugTextBuffer||y.debugBuffer,xt=ve._tileDebugTextIndexBuffer||y.quadTriangleIndexBuffer,Xt=ve._tileDebugTextSegments||y.debugSegments;Te.draw(y,$.TRIANGLES,Ce,Pe,Mr.alphaBlended,br.disabled,ut(te,i.al.transparent,it),Je,dt,xt,Xt,null,null,null,[ve._globeTileDebugTextBuffer])}function Ff(y,o,u,_){Gu(y,0,o+u/2,y.transform.width,u,_)}function Hu(y,o,u,_){Gu(y,o-u/2,0,u,y.transform.height,_)}function Gu(y,o,u,_,w,T){const C=y.context,z=C.gl;z.enable(z.SCISSOR_TEST),z.scissor(o*i.q.devicePixelRatio,u*i.q.devicePixelRatio,_*i.q.devicePixelRatio,w*i.q.devicePixelRatio),C.clear({color:T}),z.disable(z.SCISSOR_TEST)}const Wd=i.dd([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Wu}=Wd;function rl(y,o,u,_){y.emplaceBack(o,u,_)}class Bm{constructor(o){this.vertexArray=new i.dh,this.indices=new i.aV,rl(this.vertexArray,-1,-1,1),rl(this.vertexArray,1,-1,1),rl(this.vertexArray,-1,1,1),rl(this.vertexArray,1,1,1),rl(this.vertexArray,-1,-1,-1),rl(this.vertexArray,1,-1,-1),rl(this.vertexArray,-1,1,-1),rl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,Wu),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=i.b8.simpleSegment(0,0,36,12)}}function eo(y,o,u,_,w,T){const C=y.context.gl,z=o.paint.get("sky-atmosphere-color"),V=o.paint.get("sky-atmosphere-halo-color"),$=o.paint.get("sky-atmosphere-sun-intensity"),K=((ee,te,ce,Te,ve)=>({u_matrix_3f:ee,u_sun_direction:te,u_sun_intensity:ce,u_color_tint_r:[Te.r,Te.g,Te.b,Te.a],u_color_tint_m:[ve.r,ve.g,ve.b,ve.a],u_luminance:5e-5}))(i.ad.mat3.fromMat4(i.ad.mat3.create(),_),w,$,z,V);C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.TEXTURE_CUBE_MAP_POSITIVE_X+T,o.skyboxTexture,0),u.draw(y,C.TRIANGLES,sr.disabled,Sr.disabled,Mr.unblended,br.frontCW,K,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}const Pg=i.dd([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class hf{constructor(o){const u=new i.di;u.emplaceBack(-1,1,1,0,0),u.emplaceBack(1,1,1,1,0),u.emplaceBack(1,-1,1,1,1),u.emplaceBack(-1,-1,1,0,1);const _=new i.aV;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=o.createVertexBuffer(u,Pg.members),this.indexBuffer=o.createIndexBuffer(_),this.segments=i.b8.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const na=i.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Mi{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Kd{constructor(o){this.colorModeAlphaBlendedWriteRGB=new Mr([1,Ja,1,Ja],i.al.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Mr([1,0,1,0],i.al.transparent,[!1,!1,!1,!0]),this.params=new Mi,this.updateNeeded=!0,o.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),o.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),o.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),o.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(o){const u=o.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new hf(u);const _=this.params.sizeRange,w=this.params.intensityRange,T=function(K){const ee=i.dl(30),te=[];for(let ce=0;ce<K;++ce){const Te=2*Math.PI*ee(),ve=Math.acos(1-2*ee())-.5*Math.PI;te.push(i.ad.vec3.fromValues(Math.cos(ve)*Math.cos(Te),Math.cos(ve)*Math.sin(Te),Math.sin(ve)))}return te}(this.params.starsCount),C=i.dl(300),z=new i.dj,V=new i.aV;let $=0;for(let K=0;K<T.length;++K){const ee=i.ad.vec3.scale([],T[K],200),te=Math.max(0,1+.01*_*(1*C()-.5)),ce=Math.max(0,1+.01*w*(1*C()-.5));z.emplaceBack(ee[0],ee[1],ee[2],-1,-1,te,ce),z.emplaceBack(ee[0],ee[1],ee[2],1,-1,te,ce),z.emplaceBack(ee[0],ee[1],ee[2],1,1,te,ce),z.emplaceBack(ee[0],ee[1],ee[2],-1,1,te,ce),V.emplaceBack($+0,$+1,$+2),V.emplaceBack($+0,$+2,$+3),$+=4}this.starsVx=u.createVertexBuffer(z,na.members),this.starsIdx=u.createIndexBuffer(V),this.starsSegments=i.b8.simpleSegment(0,0,z.length,V.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(o,u){const _=o.context,w=_.gl,T=o.transform,C=new sr(w.LEQUAL,sr.ReadOnly,[0,1]),z=i.ag(T.zoom),V=o.style.getLut(u.scope),$=u.properties.get("color-use-theme")==="none",K=u.properties.get("color").toRenderColor($?null:V).toArray01(),ee=u.properties.get("high-color-use-theme")==="none",te=u.properties.get("high-color").toRenderColor(ee?null:V).toArray01(),ce=u.properties.get("space-color-use-theme")==="none",Te=u.properties.get("space-color").toRenderColor(ce?null:V).toArray01PremultipliedAlpha(),ve=5e-4,Ce=i.dk(u.properties.get("horizon-blend"),0,1,ve,.25),Pe=i.cD(o,_,T)&&Ce===ve?T.worldSize/(2*Math.PI*1.025)-1:T.globeRadius,qe=o.frameCounter/1e3%1,Je=i.ad.vec3.length(T.globeCenterInViewSpace),Ye=Math.sqrt(Math.pow(Je,2)-Math.pow(Pe,2)),lt=Math.acos(Ye/Je),nt=rt=>{const it=T.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];rt&&it.push("ALPHA_PASS");const dt=o.getOrCreateProgram("globeAtmosphere",{defines:it}),xt=((zt,tn,un,Tn,Lt,an,Pt,sn,Qt,fn,Wt,mn)=>({u_frustum_tl:zt,u_frustum_tr:tn,u_frustum_br:un,u_frustum_bl:Tn,u_horizon:Lt,u_transition:an,u_fadeout_range:Pt,u_color:sn,u_high_color:Qt,u_space_color:fn,u_temporal_offset:Wt,u_horizon_angle:mn}))(T.frustumCorners.TL,T.frustumCorners.TR,T.frustumCorners.BR,T.frustumCorners.BL,T.frustumCorners.horizon,z,Ce,K,te,Te,qe,lt);o.uploadCommonUniforms(_,dt);const Xt=this.atmosphereBuffer;Xt&&dt.draw(o,w.TRIANGLES,C,Sr.disabled,rt?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,br.backCW,xt,rt?"atmosphere_glow_alpha":"atmosphere_glow",Xt.vertexBuffer,Xt.indexBuffer,Xt.segments)};nt(!1),nt(!0)}drawStars(o,u){const _=i.ay(u.properties.get("star-intensity"),0,1);if(_===0)return;const w=o.context,T=w.gl,C=o.transform,z=o.getOrCreateProgram("stars"),V=i.ad.quat.identity([]);i.ad.quat.rotateX(V,V,-C._pitch),i.ad.quat.rotateZ(V,V,-C.angle),i.ad.quat.rotateX(V,V,i.ak(C._center.lat)),i.ad.quat.rotateY(V,V,-i.ak(C._center.lng));const $=i.ad.mat4.fromQuat(new Float32Array(16),V),K=i.ad.mat4.multiply([],C.starsProjMatrix,$),ee=i.ad.mat3.fromMat4([],$),te=i.ad.mat3.invert([],ee),ce=[0,1,0];i.ad.vec3.transformMat3(ce,ce,te),i.ad.vec3.scale(ce,ce,this.params.sizeMultiplier);const Te=[1,0,0];i.ad.vec3.transformMat3(Te,Te,te),i.ad.vec3.scale(Te,Te,this.params.sizeMultiplier);const ve=(Ce=ce,Pe=Te,qe=_,{u_matrix:Float32Array.from(K),u_up:Ce,u_right:Pe,u_intensity_multiplier:qe});var Ce,Pe,qe;o.uploadCommonUniforms(w,z),this.starsVx&&this.starsIdx&&z.draw(o,T.TRIANGLES,sr.disabled,Sr.disabled,this.colorModeAlphaBlendedWriteRGB,br.disabled,ve,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Sc(y,o){const u=[...y],_=o.cameraWorldSizeForFog/o.worldSize,w=i.ad.mat4.identity([]);return i.ad.mat4.scale(w,w,[_,_,1]),i.ad.mat4.multiply(u,w,u),i.ad.mat4.multiply(u,o.worldToFogMatrix,u),u}function Lh(y,o,u,_,w){const T=u.material,C=_.context,{baseColorTexture:z,metallicRoughnessTexture:V}=T.pbrMetallicRoughness,{normalTexture:$,occlusionTexture:K,emissionTexture:ee}=T;function te(Te,ve,Ce){if(Te&&(y.push(ve),C.activeTexture.set(C.gl.TEXTURE0+Ce),Te.gfxTexture)){const{minFilter:Pe,magFilter:qe,wrapS:Je,wrapT:Ye}=Te.sampler;Te.gfxTexture.bindExtraParam(Pe,qe,Je,Ye)}}te(z,"HAS_TEXTURE_u_baseColorTexture",ya.BaseColor),te(V,"HAS_TEXTURE_u_metallicRoughnessTexture",ya.MetallicRoughness),te($,"HAS_TEXTURE_u_normalTexture",ya.Normal),te(K,"HAS_TEXTURE_u_occlusionTexture",ya.Occlusion),te(ee,"HAS_TEXTURE_u_emissionTexture",ya.Emission),w&&(w.texture||(w.texture=new i.dn(_.context,w.image,[w.image.height,w.image.height,w.image.height],C.gl.RGBA8)),C.activeTexture.set(C.gl.TEXTURE0+ya.LUT),w.texture&&w.texture.bind(C.gl.LINEAR,C.gl.CLAMP_TO_EDGE),y.push("APPLY_LUT_ON_GPU")),u.texcoordBuffer&&(y.push("HAS_ATTRIBUTE_a_uv_2f"),o.push(u.texcoordBuffer)),u.colorBuffer&&(y.push(u.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),o.push(u.colorBuffer)),u.normalBuffer&&(y.push("HAS_ATTRIBUTE_a_normal_3f"),o.push(u.normalBuffer)),u.pbrBuffer&&(y.push("HAS_ATTRIBUTE_a_pbr"),y.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),o.push(u.pbrBuffer)),T.alphaMode!=="OPAQUE"&&T.alphaMode!=="MASK"||y.push("UNPREMULT_TEXTURE_IN_SHADER"),T.defined||y.push("DIFFUSE_SHADED");const ce=_.shadowRenderer;ce&&(y.push("RENDER_SHADOWS","DEPTH_TEXTURE"),ce.useNormalOffset&&y.push("NORMAL_OFFSET"))}function Ac(y,o,u,_,w,T){const C=u.paint.get("model-opacity").constantOr(1),z=o.context,V=new sr(o.context.gl.LEQUAL,sr.ReadWrite,o.depthRangeFor3D),$=o.transform,K=y.mesh,ee=K.material,te=ee.pbrMetallicRoughness,ce=o.style.fog;let Te;Te=o.transform.projection.zAxisUnit==="pixels"?[...y.nodeModelMatrix]:i.ad.mat4.multiply([],_.zScaleMatrix,y.nodeModelMatrix),i.ad.mat4.multiply(Te,_.negCameraPosMatrix,Te);const ve=i.ad.mat4.invert([],Te);i.ad.mat4.transpose(ve,ve);const Ce=u.paint.get("model-color-use-theme").constantOr("default")==="none",Pe=u.paint.get("model-emissive-strength").constantOr(0),qe=cr(new Float32Array(y.worldViewProjection),new Float32Array(Te),new Float32Array(ve),null,o,C,te.baseColorFactor.toRenderColor(null),ee.emissiveFactor,te.metallicFactor,te.roughnessFactor,ee,Pe,u),Je={defines:[]},Ye=[],lt=o.shadowRenderer;lt&&(lt.useNormalOffset=!1),Lh(Je.defines,Ye,K,o,Ce?null:u.lut);let nt=null;if(ce){const dt=Sc(y.nodeModelMatrix,o.transform);if(nt=new Float32Array(dt),$.projection.name!=="globe"){const xt=K.aabb.min,Xt=K.aabb.max,[zt,tn]=ce.getOpacityForBounds(dt,xt[0],xt[1],Xt[0],Xt[1]);Je.overrideFog=zt>=Nn||tn>=Nn}}const rt=Vs(o,u.paint.get("model-cutoff-fade-range"));rt.shouldRenderCutoff&&Je.defines.push("RENDER_CUTOFF");const it=o.getOrCreateProgram("model",Je);o.uploadCommonUniforms(z,it,null,nt,rt),o.renderPass!=="shadow"&&lt&&lt.setupShadowsFromMatrix(y.nodeModelMatrix,it),it.draw(o,z.gl.TRIANGLES,V,w,T,K.material.doubleSided?br.disabled:br.backCCW,qe,u.id,K.vertexBuffer,K.indexBuffer,K.segments,u.paint,o.transform.zoom,void 0,Ye)}function Ku(y,o,u,_,w,T,C){let z;z=y.projection.name==="globe"?i.dp(u,y):[...u],i.ad.mat4.multiply(z,z,o.matrix);const V=i.ad.mat4.multiply([],_,z);if(o.meshes)for(const $ of o.meshes){if($.material.alphaMode!=="BLEND"){C.push({mesh:$,depth:0,modelIndex:w,worldViewProjection:V,nodeModelMatrix:z});continue}const K=i.ad.vec3.transformMat4([],$.centroid,V);!y.isOrthographic&&K[2]<=0||T.push({mesh:$,depth:K[2],modelIndex:w,worldViewProjection:V,nodeModelMatrix:z})}if(o.children)for(const $ of o.children)Ku(y,$,u,_,w,T,C)}function vd(y,o,u,_){const w=u.shadowRenderer;if(!w)return;const T=w.getShadowPassDepthMode(),C=w.getShadowPassColorMode(),z=w.calculateShadowPassMatrixFromMatrix(o),V=va(z);u.getOrCreateProgram("modelDepth",{defines:u._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(u,u.context.gl.TRIANGLES,T,Sr.disabled,C,br.backCCW,V,_.id,y.vertexBuffer,y.indexBuffer,y.segments,_.paint,u.transform.zoom,void 0,void 0)}function Uf(y,o,u){const _=o.updateZoomBasedPaintProperties(),w=function(T,C,z){let V,$,K,ee=T.terrain?T.terrain.exaggeration():0;if(T.terrain&&ee>0){const te=T.terrain,ce=te.findDEMTileFor(z);ce&&ce.dem?V=i.dr.create(te,z,ce):ee=0}if(ee===0&&(C.terrainElevationMin=0,C.terrainElevationMax=0),ee===C.validForExaggeration&&(ee===0||V&&V._demTile&&V._demTile.tileID===C.validForDEMTile.id&&V._dem._timestamp===C.validForDEMTile.timestamp))return!1;for(const te in C.instancesPerModel){const ce=C.instancesPerModel[te];for(let Te=0;Te<ce.instancedDataArray.length;++Te){const ve=(V?ee*V.getElevationAt(0|ce.instancedDataArray.float32[16*Te],0|ce.instancedDataArray.float32[16*Te+1],!0,!0):0)+ce.instancesEvaluatedElevation[Te];ce.instancedDataArray.float32[16*Te+6]=ve,$=$?Math.min(C.terrainElevationMin,ve):ve,K=K?Math.max(C.terrainElevationMax,ve):ve}}return C.terrainElevationMin=$||0,C.terrainElevationMax=K||0,C.validForExaggeration=ee,C.validForDEMTile=V&&V._demTile?{id:V._demTile.tileID,timestamp:V._dem._timestamp}:{id:void 0,timestamp:0},!0}(y,o,u);(_||w)&&(o.uploaded=!1,o.upload(y.context))}const Ol={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.ce([0,0,0],[i.ai,i.ai,0])};function bd(y,o){const u=1<<y.canonical.z,_=o.getFreeCameraOptions().position,w=o.elevation,T=y.canonical.x/u,C=(y.canonical.x+1)/u,z=y.canonical.y/u,V=(y.canonical.y+1)/u;let $=o._centerAltitude;if(w){const ce=w.getMinMaxForTile(y);ce&&ce.max>$&&($=ce.max)}const K=i.ay(_.x,T,C)-_.x,ee=i.ay(_.y,z,V)-_.y,te=i.bH($,o.center.lat)-_.z;return o._zoomFromMercatorZ(Math.sqrt(K*K+ee*ee+te*te))}function So(y,o,u,_,w,T,C){const z=y.context,V=y.renderPass==="shadow",$=y.shadowRenderer,K=V&&$?$.getShadowPassDepthMode():new sr(z.gl.LEQUAL,sr.ReadWrite,y.depthRangeFor3D),ee=y.isTileAffectedByFog(T);if(u.meshes)for(const te of u.meshes){const ce=["MODEL_POSITION_ON_GPU"],Te=[];let ve,Ce,Pe;_.instancedDataArray.length>20&&ce.push("INSTANCED_ARRAYS");const qe=Vs(y,o.paint.get("model-cutoff-fade-range"));if(qe.shouldRenderCutoff&&ce.push("RENDER_CUTOFF"),V&&$)ve=y.getOrCreateProgram("modelDepth",{defines:ce}),Ce=va(C.shadowTileMatrix,C.shadowTileMatrix,Float32Array.from(u.matrix)),Pe=$.getShadowPassColorMode();else{Lh(ce,Te,te,y,o.paint.get("model-color-use-theme").constantOr("default")==="none"?null:o.lut),ve=y.getOrCreateProgram("model",{defines:ce,overrideFog:ee});const Ye=te.material,lt=Ye.pbrMetallicRoughness,nt=o.paint.get("model-opacity").constantOr(1),rt=o.paint.get("model-emissive-strength").constantOr(0);Ce=cr(T.expandedProjMatrix,Float32Array.from(u.matrix),new Float32Array(16),null,y,nt,lt.baseColorFactor.toRenderColor(null),Ye.emissiveFactor,lt.metallicFactor,lt.roughnessFactor,Ye,rt,o,w),$&&(C.shadowUniformsInitialized?ve.setShadowUniformValues(z,$.getShadowUniformValues()):($.setupShadows(T.toUnwrapped(),ve,"model-tile",T.overscaledZ),C.shadowUniformsInitialized=!0)),Pe=qe.shouldRenderCutoff||nt<1||Ye.alphaMode!=="OPAQUE"?Mr.alphaBlended:Mr.unblended}y.uploadCommonUniforms(z,ve,T.toUnwrapped(),null,qe);const Je=te.material.doubleSided?br.disabled:br.backCCW;if(_.instancedDataArray.length>20)Te.push(_.instancedDataBuffer),ve.draw(y,z.gl.TRIANGLES,K,Sr.disabled,Pe,Je,Ce,o.id,te.vertexBuffer,te.indexBuffer,te.segments,o.paint,y.transform.zoom,void 0,Te,_.instancedDataArray.length);else{const Ye=V?"u_instance":"u_normal_matrix";for(let lt=0;lt<_.instancedDataArray.length;++lt)Ce[Ye]=new Float32Array(_.instancedDataArray.arrayBuffer,64*lt,16),ve.draw(y,z.gl.TRIANGLES,K,Sr.disabled,Pe,Je,Ce,o.id,te.vertexBuffer,te.indexBuffer,te.segments,o.paint,y.transform.zoom,void 0,Te)}}if(u.children)for(const te of u.children)So(y,o,te,_,w,T,C)}const kh=[1,-1,1];function Yd(y,o,u,_){if(!u.modelManager)return!0;const w=u.modelManager;if(!u.shadowRenderer)return!0;const T=u.shadowRenderer,C=o.aabb;let z=!0,V=y.maxHeight;if(V===0){let K=0;for(const ee in y.instancesPerModel){const te=w.getModel(ee,_);te?K=Math.max(K,Math.max(Math.max(te.aabb.max[0],te.aabb.max[1]),te.aabb.max[2])):z=!1}V=y.maxScale*K*1.41+y.maxVerticalOffset,z&&(y.maxHeight=V)}C.max[2]=V,C.min[2]+=y.terrainElevationMin,C.max[2]+=y.terrainElevationMax,i.ad.vec3.transformMat4(C.min,C.min,o.tileMatrix),i.ad.vec3.transformMat4(C.max,C.max,o.tileMatrix);const $=C.intersects(T.getCurrentCascadeFrustum());return u.currentShadowCascade===0&&(y.isInsideFirstShadowMapFrustum=$===2),$===0}function Xd(y,o){const u=y.uniformValues.u_cutoff_params[0],_=y.uniformValues.u_cutoff_params[1],w=y.uniformValues.u_cutoff_params[2],T=y.uniformValues.u_cutoff_params[3];return _===u||T===w?1:i.ay(((o-u)/(_-u)-w)/(T-w),0,1)}function ff(y,o,u,_){if(o.pitch<20)return 1;const w=o.getWorldToCameraMatrix();i.ad.mat4.multiply(w,w,y);const T=i.ad.vec4.fromValues(u.min[0],u.min[1],u.min[2],1);let C=i.ad.vec4.transformMat4(i.ad.vec4.create(),T,w),z=C,V=C;T[1]=u.max[1],C=i.ad.vec4.transformMat4(i.ad.vec4.create(),T,w),z=C[1]<z[1]?C:z,V=C[1]>V[1]?C:V,T[0]=u.max[0],C=i.ad.vec4.transformMat4(i.ad.vec4.create(),T,w),z=C[1]<z[1]?C:z,V=C[1]>V[1]?C:V,T[1]=u.min[1],C=i.ad.vec4.transformMat4(i.ad.vec4.create(),T,w),z=C[1]<z[1]?C:z,V=C[1]>V[1]?C:V;const $=i.ay(_[0],0,1),K=100*o.pixelsPerMeter*i.ay(_[1],0,1),ee=i.ay(_[2],0,1),te=i.ad.vec4.lerp(i.ad.vec4.create(),z,V,$),ce=Math.tan(.5*o.fovX),Te=-te[2]*ce;if(K===0)return te[1]<-Math.abs(Te)?ee:1;const ve=(-Math.abs(Te)-te[1])/K,Ce=(qe,Je,Ye)=>(1-Ye)*qe+Ye*Je,Pe=i.ay(Ce(1,ee,ve),ee,1);return Ce(1,Pe,i.ay((o.pitch-20)/20,0,1))}class Yu{}class Xu{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(o,u,_){{const ee=this._storage.get(u.id);if(ee)return ee.lastUsedFrameIdx=o,ee.buf}const w=_.gl,T=w.getBufferParameter(w.ELEMENT_ARRAY_BUFFER,w.BUFFER_SIZE),C=new ArrayBuffer(T),z=new Int16Array(C);w.getBufferSubData(w.ELEMENT_ARRAY_BUFFER,0,new Int16Array(C));const V=new i.dt;for(let ee=0;ee<T/2;ee+=3){const te=z[ee],ce=z[ee+1],Te=z[ee+2];V.emplaceBack(te,ce),V.emplaceBack(ce,Te),V.emplaceBack(Te,te)}const $=_.bindVertexArrayOES.current,K=new Yu;return K.buf=new $i(_,V),K.lastUsedFrameIdx=o,this._storage.set(u.id,K),_.bindVertexArrayOES.set($),K.buf}update(o){for(const[u,_]of this._storage)o-_.lastUsedFrameIdx>30&&(_.buf.destroy(),this._storage.delete(u))}destroy(){for(const[o,u]of this._storage)u.buf.destroy(),this._storage.delete(o)}}class Zd{constructor(o){this.occluderSize=30,this.depthOffset=-1e-4,o.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),o.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Nh=i.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Tc{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class _u{constructor(o,u){this.revealStart=11,this.revealRange=2,o.registerParameter(this,[...u,"Reveal"],"revealStart",{min:0,max:17,step:.05}),o.registerParameter(this,[...u,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Jl=i.dd([{type:"Float32",name:"a_pos_2f",components:2}]);class vu{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(o,u){const _=o.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const C=new i.du,z=new i.aV;C.emplaceBack(-1,-1),C.emplaceBack(1,-1),C.emplaceBack(1,1),C.emplaceBack(-1,1),z.emplaceBack(0,1,2),z.emplaceBack(0,2,3),this.vignetteVx=o.context.createVertexBuffer(C,Jl.members),this.vignetteIdx=o.context.createIndexBuffer(z)}const w=i.b8.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){o.uploadCommonUniforms(o.context,_);const C={u_vignetteShape:(T={vignetteShape:[u.start,u.range,Math.pow(10,u.fadePower)],vignetteColor:[u.color.r,u.color.g,u.color.b,u.color.a*u.strength]}).vignetteShape,u_vignetteColor:T.vignetteColor};_.draw(o,o.context.gl.TRIANGLES,sr.disabled,Sr.disabled,Mr.alphaBlended,br.disabled,C,"vignette",this.vignetteVx,this.vignetteIdx,w)}var T}}class Ms{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(o,u){const _=o.getFreeCameraOptions().position,w=_.toAltitude(),T=_.toLngLat(),C=i.ak(T.lng),z=i.ak(T.lat),V=o.pixelsPerMeter/u,$=C*i.dv,K=i.dv*Math.log(Math.tan(Math.PI/4+z/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const ee=-this._offsetYPrev+K,te=-this._elevationPrev+w;this._accumulatedOffsetX+=(-this._offsetXPrev+$)*V,this._accumulatedOffsetY+=ee*V,this._accumulatedElevation+=te*V,this._offsetXPrev=$,this._offsetYPrev=K,this._elevationPrev=w}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Ql(y,o){return[-(y[0]-Math.floor(y[0]/o)*o),-(y[1]-Math.floor(y[1]/o)*o),-(y[2]-Math.floor(y[2]/o)*o)]}function Gc(y){const o=i.dl(1323123451230),u=[];for(let _=0;_<y;++_){const w=2*o()-1,T=2*o()-1,C=2*o()-1;u.push(i.ad.vec3.fromValues(w,T,C))}return u}function Hs(y,o,u,_,w){const T=i.ay((w-u)/(_-u),0,1);return(1-T)*y+T*o}class Ec{constructor(o){this._movement=new Ms,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new vu,this._ppmScaleFactor=o}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(o,u){const _=o.transform;this._movement.update(_,this._ppmScaleFactor);const w=_.starsProjMatrix,T=i.ad.quat.identity([]);i.ad.quat.rotateX(T,T,i.ak(90)-_._pitch),i.ad.quat.rotateZ(T,T,-_.angle);const C=i.ad.mat4.fromQuat(new Float32Array(16),T),z=i.ad.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),V=i.ad.mat4.transpose([],z),$=i.ad.mat4.multiply([],V,C),K=Date.now()/1e3;return this._accumulatedTimeFromStart+=(K-this._prevTime)*u,this._prevTime=K,{projectionMatrix:w,modelviewMatrix:$}}}class df extends Ec{constructor(o){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new _u(o.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(o){const u=o.context;if(!this.particlesVx){const _=Gc(this.particlesCount),w=new i.dw,T=new i.aV;let C=0;const z=i.dl(1323123451230);for(let V=0;V<_.length;++V){const $=_[V],K=[2*z()-1,z(),z(),z()];w.emplaceBack($[0],$[1],$[2],-1,-1,...K),w.emplaceBack($[0],$[1],$[2],1,-1,...K),w.emplaceBack($[0],$[1],$[2],1,1,...K),w.emplaceBack($[0],$[1],$[2],-1,1,...K),T.emplaceBack(C+0,C+1,C+2),T.emplaceBack(C+0,C+2,C+3),C+=4}this.particlesVx=u.createVertexBuffer(w,Nh.members),this.particlesIdx=u.createIndexBuffer(T)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.rain)return;const u=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},_=o.transform.zoom;if(u.revealStart>_)return;const w=Hs(0,1,u.revealStart,u.revealStart+u.revealRange,_);if(!this.particlesVx||!this.particlesIdx)return;const T=structuredClone(this._params);let C=[-T.direction.x,T.direction.y,-100];i.ad.vec3.normalize(C,C);const z=structuredClone(this._vignetteParams);z.strength*=w,T.overrideStyleParameters||(T.intensity=o.style.rain.state.density,T.timeFactor=o.style.rain.state.intensity,T.color=structuredClone(o.style.rain.state.color),C=structuredClone(o.style.rain.state.direction),T.screenThinning.intensity=o.style.rain.state.centerThinning,T.dropletSizeX=o.style.rain.state.dropletSize[0],T.dropletSizeYScale=o.style.rain.state.dropletSize[1]/o.style.rain.state.dropletSize[0],T.distortionStrength=100*o.style.rain.state.distortionStrength,z.strength=1,z.color=structuredClone(o.style.rain.state.vignetteColor));const V=this.updateOnRender(o,T.timeFactor),$=o.context,K=$.gl,ee=o.transform;this.screenTexture&&this.screenTexture.size[0]===o.width&&this.screenTexture.size[1]===o.height||(this.screenTexture=new i.T($,{width:o.width,height:o.height,data:null},K.RGBA8)),T.distortionStrength>0&&($.activeTexture.set(K.TEXTURE0),this.screenTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),K.copyTexSubImage2D(K.TEXTURE_2D,0,0,0,0,0,o.width,o.height));const te=o.getOrCreateProgram("rainParticle");o.uploadCommonUniforms($,te),$.activeTexture.set(K.TEXTURE0),this.screenTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE);const ce=[T.color.r,T.color.g,T.color.b,T.color.a],Te=(ve,Ce)=>{const Pe=Ql(this._movement.getPosition(),ve),qe=T.dropletSizeX,Je=T.dropletSizeX*T.dropletSizeYScale,Ye=o.width/2,lt=o.height/2,nt=Hs(0,T.screenThinning.start,0,1,T.screenThinning.intensity),rt=Hs(.001,T.screenThinning.range,0,1,T.screenThinning.intensity),it=Hs(0,T.screenThinning.particleOffset,0,1,T.screenThinning.intensity),dt=(xt={modelview:V.modelviewMatrix,projection:V.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Pe,velocityConeAperture:T.velocityConeAperture,velocity:T.velocity,boxSize:ve,rainDropletSize:[qe,Je],distortionStrength:T.distortionStrength,rainDirection:C,color:ce,screenSize:[ee.width,ee.height],thinningCenterPos:[Ye,lt],thinningShape:[nt,rt,Math.pow(10,T.screenThinning.fadePower)],thinningAffectedRatio:T.screenThinning.affectedRatio,thinningParticleOffset:it,shapeDirectionalPower:T.shapeDirPower,shapeNormalPower:T.shapeNormalPower,mode:Ce?0:1},{u_modelview:Float32Array.from(xt.modelview),u_projection:Float32Array.from(xt.projection),u_time:xt.time,u_cam_pos:xt.camPos,u_texScreen:0,u_velocityConeAperture:xt.velocityConeAperture,u_velocity:xt.velocity,u_boxSize:xt.boxSize,u_rainDropletSize:xt.rainDropletSize,u_distortionStrength:xt.distortionStrength,u_rainDirection:xt.rainDirection,u_color:xt.color,u_screenSize:xt.screenSize,u_thinningCenterPos:xt.thinningCenterPos,u_thinningShape:xt.thinningShape,u_thinningAffectedRatio:xt.thinningAffectedRatio,u_thinningParticleOffset:xt.thinningParticleOffset,u_shapeDirectionalPower:xt.shapeDirectionalPower,u_shapeNormalPower:xt.shapeNormalPower,u_mode:xt.mode});var xt;const Xt=Math.round(T.intensity*this.particlesCount),zt=i.b8.simpleSegment(0,0,4*Xt,2*Xt);te.draw(o,K.TRIANGLES,sr.disabled,Sr.disabled,Mr.alphaBlended,br.disabled,dt,"rain_particles",this.particlesVx,this.particlesIdx,zt)};T.distortionStrength>0&&Te(T.boxSize,!0),Te(T.boxSize,!1),this._vignette.draw(o,z)}}const Jd=i.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class qf extends Ec{constructor(o){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new _u(o.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(o){const u=o.context;if(!this.particlesVx){const _=Gc(this.particlesCount),w=new i.dx,T=new i.aV;let C=0;const z=i.dl(1323123451230);for(let V=0;V<_.length;++V){const $=_[V],K=z(),ee=z(),te=z(),ce=[V/_.length,K,ee,te],Te=[z(),z()];w.emplaceBack($[0],$[1],$[2],-1,-1,...ce,...Te),w.emplaceBack($[0],$[1],$[2],1,-1,...ce,...Te),w.emplaceBack($[0],$[1],$[2],1,1,...ce,...Te),w.emplaceBack($[0],$[1],$[2],-1,1,...ce,...Te),T.emplaceBack(C+0,C+1,C+2),T.emplaceBack(C+0,C+2,C+3),C+=4}this.particlesVx=u.createVertexBuffer(w,Jd.members),this.particlesIdx=u.createIndexBuffer(T)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.snow)return;const u=structuredClone(this._params);let _=[-u.direction.x,u.direction.y,-100];i.ad.vec3.normalize(_,_);const w=structuredClone(this._vignetteParams),T=u.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},C=o.transform.zoom;if(T.revealStart>C)return;const z=Hs(0,1,T.revealStart,T.revealStart+T.revealRange,C);w.strength*=z,u.overrideStyleParameters||(u.intensity=o.style.snow.state.density,u.timeFactor=o.style.snow.state.intensity,u.color=structuredClone(o.style.snow.state.color),_=structuredClone(o.style.snow.state.direction),u.screenThinning.intensity=o.style.snow.state.centerThinning,u.billboardSize=2.79*o.style.snow.state.flakeSize,w.strength=1,w.color=structuredClone(o.style.snow.state.vignetteColor));const V=this.updateOnRender(o,u.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const $=o.context,K=$.gl,ee=o.transform,te=o.getOrCreateProgram("snowParticle");o.uploadCommonUniforms($,te),((ce,Te,ve)=>{const Ce=Ql(this._movement.getPosition(),ce),Pe=ee.width/2,qe=ee.height/2,Je=Hs(0,ve.screenThinning.start,0,1,ve.screenThinning.intensity),Ye=Hs(.001,ve.screenThinning.range,0,1,ve.screenThinning.intensity),lt=Hs(0,ve.screenThinning.particleOffset,0,1,ve.screenThinning.intensity),nt=(rt={modelview:V.modelviewMatrix,projection:V.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Ce,velocityConeAperture:ve.velocityConeAperture,velocity:ve.velocity,horizontalOscillationRadius:ve.horizontalOscillationRadius,horizontalOscillationRate:ve.horizontalOscillationRate,boxSize:ce,billboardSize:1*ve.billboardSize,simpleShapeParameters:[ve.shapeFadeStart,ve.shapeFadePower],screenSize:[ee.width,ee.height],thinningCenterPos:[Pe,qe],thinningShape:[Je,Ye,Math.pow(10,ve.screenThinning.fadePower)],thinningAffectedRatio:ve.screenThinning.affectedRatio,thinningParticleOffset:lt,color:[ve.color.r,ve.color.g,ve.color.b,ve.color.a],direction:_},{u_modelview:Float32Array.from(rt.modelview),u_projection:Float32Array.from(rt.projection),u_time:rt.time,u_cam_pos:rt.camPos,u_velocityConeAperture:rt.velocityConeAperture,u_velocity:rt.velocity,u_horizontalOscillationRadius:rt.horizontalOscillationRadius,u_horizontalOscillationRate:rt.horizontalOscillationRate,u_boxSize:rt.boxSize,u_billboardSize:rt.billboardSize,u_simpleShapeParameters:rt.simpleShapeParameters,u_screenSize:rt.screenSize,u_thinningCenterPos:rt.thinningCenterPos,u_thinningShape:rt.thinningShape,u_thinningAffectedRatio:rt.thinningAffectedRatio,u_thinningParticleOffset:rt.thinningParticleOffset,u_particleColor:rt.color,u_direction:rt.direction});var rt;const it=Math.round(ve.intensity*this.particlesCount),dt=i.b8.simpleSegment(0,0,4*it,2*it);this.particlesVx&&this.particlesIdx&&te.draw(o,K.TRIANGLES,sr.disabled,Sr.disabled,Mr.alphaBlended,br.disabled,nt,"snow_particles",this.particlesVx,this.particlesIdx,dt)})(u.boxSize,0,u),this._vignette.draw(o,w)}}const pf={symbol:function(y,o,u,_,w){if(y.renderPass!=="translucent")return;const T=Sr.disabled,C=y.colorModeForRenderPass(),z=u.layout.get("text-variable-anchor"),V=u.layout.get("text-size-scale-range"),$=i.ay(y.scaleFactor,V[0],V[1]);z&&function(te,ce,Te,ve,Ce,Pe,qe,Je){const Ye=ce.transform,lt=Ce==="map",nt=Pe==="map";for(const rt of te){const it=ve.getTile(rt),dt=it.getBucket(Te);if(!dt||!dt.text||!dt.text.segments.get().length)continue;const xt=i.bp(dt.textSizeData,Ye.zoom,Je),Xt=Bo(rt,dt.getProjection(),Ye),zt=Ye.calculatePixelsToTileUnitsMatrix(it),tn=xs(Xt,it.tileID.canonical,nt,lt,Ye,dt.getProjection(),zt),un=dt.hasIconTextFit()&&dt.hasIconData();if(xt){const Tn=Math.pow(2,Ye.zoom-it.tileID.overscaledZ);is(dt,lt,nt,qe,i.cY,Ye,tn,rt,Tn,xt,un)}}}(_,y,u,o,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),w,$);const K=u.paint.get("icon-opacity").constantOr(1)!==0,ee=u.paint.get("text-opacity").constantOr(1)!==0;u.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(K||ee)?bi(y,o,u,_,T,C):(K&&bi(y,o,u,_,T,C,{onlyIcons:!0}),ee&&bi(y,o,u,_,T,C,{onlyText:!0})),o.map.showCollisionBoxes&&(Ba(y,o,u,_,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),Ba(y,o,u,_,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(y,o,u,_){if(y.renderPass!=="translucent")return;const w=u.paint.get("circle-opacity"),T=u.paint.get("circle-stroke-width"),C=u.paint.get("circle-stroke-opacity"),z=u.layout.get("circle-sort-key").constantOr(1)!==void 0,V=u.paint.get("circle-emissive-strength");if(w.constantOr(1)===0&&(T.constantOr(1)===0||C.constantOr(1)===0))return;const $=y.context,K=$.gl,ee=y.transform,te=y.depthModeForSublayer(0,sr.ReadOnly),ce=Sr.disabled,Te=y.colorModeForDrapableLayerRenderPass(V),ve=ee.projection.name==="globe",Ce=[i.av(ee.center.lng),i.aC(ee.center.lat)],Pe=[];for(let Je=0;Je<_.length;Je++){const Ye=_[Je],lt=o.getTile(Ye),nt=lt.getBucket(u);if(!nt||nt.projection.name!==ee.projection.name)continue;const rt=nt.programConfigurations.get(u.id),it=i.cZ(u),dt=y.isTileAffectedByFog(Ye);ve&&it.push("PROJECTION_GLOBE_VIEW"),it.push("DEPTH_D24"),y.terrain&&ee.depthOcclusionForSymbolsAndCircles&&it.push("DEPTH_OCCLUSION");const xt=y.getOrCreateProgram("circle",{config:rt,defines:it,overrideFog:dt}),Xt=nt.layoutVertexBuffer,zt=nt.globeExtVertexBuffer,tn=nt.indexBuffer,un=ee.projection.createInversionMatrix(ee,Ye.canonical),Tn={programConfiguration:rt,program:xt,layoutVertexBuffer:Xt,globeExtVertexBuffer:zt,indexBuffer:tn,uniformValues:i.c_(y,Ye,lt,un,Ce,u),tile:lt};if(z){const Lt=nt.segments.get();for(const an of Lt)Pe.push({segments:new i.b8([an]),sortKey:an.sortKey,state:Tn})}else Pe.push({segments:nt.segments,sortKey:0,state:Tn})}z&&Pe.sort((Je,Ye)=>Je.sortKey-Ye.sortKey);const qe={useDepthForOcclusion:ee.depthOcclusionForSymbolsAndCircles};for(const Je of Pe){const{programConfiguration:Ye,program:lt,layoutVertexBuffer:nt,globeExtVertexBuffer:rt,indexBuffer:it,uniformValues:dt,tile:xt}=Je.state,Xt=Je.segments;y.terrain&&y.terrain.setupElevationDraw(xt,lt,qe),y.uploadCommonUniforms($,lt,xt.tileID.toUnwrapped()),lt.draw(y,K.TRIANGLES,te,ce,Te,br.disabled,dt,u.id,nt,it,Xt,u.paint,ee.zoom,Ye,[rt])}},heatmap:function(y,o,u,_){if(u.paint.get("heatmap-opacity")!==0)if(y.renderPass==="offscreen"){const w=y.context,T=w.gl,C=Sr.disabled,z=new Mr([T.ONE,T.ONE,T.ONE,T.ONE],i.al.transparent,[!0,!0,!0,!0]);(function(ce,Te,ve,Ce){const Pe=ce.gl,qe=Te.width*Ce,Je=Te.height*Ce;ce.activeTexture.set(Pe.TEXTURE1),ce.viewport.set([0,0,qe,Je]);let Ye=ve.heatmapFbo;if(!Ye||Ye&&(Ye.width!==qe||Ye.height!==Je)){Ye&&Ye.destroy();const lt=Pe.createTexture();Pe.bindTexture(Pe.TEXTURE_2D,lt),Pe.texParameteri(Pe.TEXTURE_2D,Pe.TEXTURE_WRAP_S,Pe.CLAMP_TO_EDGE),Pe.texParameteri(Pe.TEXTURE_2D,Pe.TEXTURE_WRAP_T,Pe.CLAMP_TO_EDGE),Pe.texParameteri(Pe.TEXTURE_2D,Pe.TEXTURE_MIN_FILTER,Pe.LINEAR),Pe.texParameteri(Pe.TEXTURE_2D,Pe.TEXTURE_MAG_FILTER,Pe.LINEAR),Ye=ve.heatmapFbo=ce.createFramebuffer(qe,Je,!0,null),function(nt,rt,it,dt,xt,Xt){const zt=nt.gl;zt.texImage2D(zt.TEXTURE_2D,0,nt.extRenderToTextureHalfFloat?zt.RGBA16F:zt.RGBA,xt,Xt,0,zt.RGBA,nt.extRenderToTextureHalfFloat?zt.HALF_FLOAT:zt.UNSIGNED_BYTE,null),dt.colorAttachment.set(it)}(ce,0,lt,Ye,qe,Je)}else Pe.bindTexture(Pe.TEXTURE_2D,Ye.colorAttachment.get()),ce.bindFramebuffer.set(Ye.framebuffer)})(w,y,u,y.transform.projection.name==="globe"?.5:.25),w.clear({color:i.al.transparent});const V=y.transform,$=V.projection.name==="globe",K=$?["PROJECTION_GLOBE_VIEW"]:[],ee=$?br.frontCCW:br.disabled,te=[i.av(V.center.lng),i.aC(V.center.lat)];for(let ce=0;ce<_.length;ce++){const Te=_[ce];if(o.hasRenderableParent(Te))continue;const ve=o.getTile(Te),Ce=ve.getBucket(u);if(!Ce||Ce.projection.name!==V.projection.name)continue;const Pe=y.isTileAffectedByFog(Te),qe=Ce.programConfigurations.get(u.id),Je=y.getOrCreateProgram("heatmap",{config:qe,defines:K,overrideFog:Pe}),{zoom:Ye}=y.transform;y.terrain&&y.terrain.setupElevationDraw(ve,Je),y.uploadCommonUniforms(w,Je,Te.toUnwrapped());const lt=V.projection.createInversionMatrix(V,Te.canonical);Je.draw(y,T.TRIANGLES,sr.disabled,C,z,ee,Jt(y,Te,ve,lt,te,Ye,u.paint.get("heatmap-intensity")),u.id,Ce.layoutVertexBuffer,Ce.indexBuffer,Ce.segments,u.paint,y.transform.zoom,qe,$?[Ce.globeExtVertexBuffer]:null)}w.viewport.set([0,0,y.width,y.height])}else y.renderPass==="translucent"&&(y.context.setColorMode(y.colorModeForRenderPass()),function(w,T){const C=w.context,z=C.gl,V=T.heatmapFbo;if(!V)return;C.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,V.colorAttachment.get()),C.activeTexture.set(z.TEXTURE1);let $=T.colorRampTexture;$||($=T.colorRampTexture=new i.T(C,T.colorRamp,z.RGBA8)),$.bind(z.LINEAR,z.CLAMP_TO_EDGE),w.getOrCreateProgram("heatmapTexture").draw(w,z.TRIANGLES,sr.disabled,Sr.disabled,w.colorModeForRenderPass(),br.disabled,((K,ee,te,ce)=>({u_image:0,u_color_ramp:1,u_opacity:ee.paint.get("heatmap-opacity")}))(0,T),T.id,w.viewportBuffer,w.quadTriangleIndexBuffer,w.viewportSegments,T.paint,w.transform.zoom)}(y,u))},line:function(y,o,u,_){if(y.renderPass!=="translucent")return;const w=u.paint.get("line-opacity"),T=u.paint.get("line-width");if(w.constantOr(1)===0||T.constantOr(1)===0)return;const C=u.paint.get("line-emissive-strength"),z=u.paint.get("line-occlusion-opacity"),V=u.layout.get("line-elevation-reference"),$=u.layout.get("line-width-unit")==="meters",K=V==="sea",ee=y.context,te=ee.gl;if(u.hasElevatedBuckets&&y.transform.projection.name==="globe")return;const ce=u.layout.get("line-cross-slope"),Te=ce!==void 0,ve=ce<1,Ce=y.colorModeForDrapableLayerRenderPass(C),Pe=y.terrain&&y.terrain.renderingToTexture,qe=Pe?1:i.q.devicePixelRatio,Je=u.paint.get("line-dasharray"),Ye=Je.constantOr(1),lt=u.layout.get("line-cap"),nt=Je.constantOr(null),rt=lt.constantOr(null),it=u.paint.get("line-pattern"),dt=it.constantOr(1),xt=it.constantOr(null),Xt=u.paint.get("line-opacity").constantOr(1);let zt=!dt&&Xt!==1||y.depthOcclusion&&z>0&&z<1;const tn=u.paint.get("line-gradient"),un=dt?"linePattern":"line",Tn=i.c$(u);let Lt;if(Pe&&y.terrain&&y.terrain.clipOrMaskOverlapStencilType()&&(zt=!1),z!==0&&y.depthOcclusion){const Pt=u.paint._values["line-opacity"];Pt&&Pt.value&&Pt.value.kind==="constant"?Lt=Pt.value:i.w(`Occlusion opacity for layer ${u.id} is supported only when line-opacity isn't data-driven.`)}T.value.kind!=="constant"&&T.value.isLineProgressConstant===!1&&Tn.push("VARIABLE_LINE_WIDTH");const an=(Pt,sn,Qt,fn,Wt,mn)=>{for(const zn of Pt){const Bn=o.getTile(zn);if(dt&&!Bn.patternsLoaded())continue;const In=Bn.getBucket(u);if(!In||In.hasZOffset&&!Wt||!In.hasZOffset&&Wt)continue;y.prepareDrawTile();const or=In.programConfigurations.get(u.id),Br=y.isTileAffectedByFog(zn),mr=y.getOrCreateProgram(un,{config:or,defines:sn,overrideFog:Br,overrideRtt:!Wt&&void 0});if(xt&&Bn.imageAtlas){const Ar=i.d0.from(xt).getPrimary().scaleSelf(qe).toString(),tr=Bn.imageAtlas.patternPositions.get(Ar);tr&&or.setConstantPatternPositions(tr)}if(!dt&&nt&&rt&&Bn.lineAtlas){const Ar=Bn.lineAtlas.getDash(nt,rt);Ar&&or.setConstantPatternPositions(Ar)}let[Dr,Er]=u.paint.get("line-trim-offset");(rt==="round"||rt==="square")&&Dr!==Er&&(Dr===0&&(Dr-=1),Er===1&&(Er+=1));const Cr=Pe?zn.projMatrix:null,jr=$?1/In.tileToMeter/i.at(Bn,1,y.transform.zoom):1,Nr=$?1/In.tileToMeter/i.at(Bn,1,Math.floor(y.transform.zoom)):1,fr=dt?i.d1(y,Bn,u,Cr,qe,jr,Nr,[Dr,Er]):i.d2(y,Bn,u,Cr,In.lineClipsArray.length,qe,jr,Nr,[Dr,Er]);if(tn){const Ar=In.gradients[u.id];let tr=Ar.texture;if(u.gradientVersion!==Ar.version){let si=256;if(u.stepInterpolant){const Hi=o.getSource().maxzoom,ci=zn.canonical.z===Hi?Math.ceil(1<<y.transform.maxZoom-zn.canonical.z):1;si=i.ay(i.d3(In.maxLineLength/i.ai*1024*ci),256,ee.maxTextureSize)}Ar.gradient=i.d4({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:si,image:Ar.gradient||void 0,clips:In.lineClipsArray}),Ar.texture?Ar.texture.update(Ar.gradient):Ar.texture=new i.T(ee,Ar.gradient,te.RGBA8),Ar.version=u.gradientVersion,tr=Ar.texture}ee.activeTexture.set(te.TEXTURE1),tr.bind(u.stepInterpolant?te.NEAREST:te.LINEAR,te.CLAMP_TO_EDGE)}Ye&&(ee.activeTexture.set(te.TEXTURE0),Bn.lineAtlasTexture&&Bn.lineAtlasTexture.bind(te.LINEAR,te.REPEAT),or.updatePaintBuffers()),dt&&(ee.activeTexture.set(te.TEXTURE0),Bn.imageAtlasTexture&&Bn.imageAtlasTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),or.updatePaintBuffers()),Wt&&!K&&y.terrain.setupElevationDraw(Bn,mr),y.uploadCommonUniforms(ee,mr,zn.toUnwrapped());const ai=Ar=>{Lt!=null&&(Lt.value=Xt*z),mr.draw(y,te.TRIANGLES,Qt,Ar,Ce,br.disabled,fr,u.id,In.layoutVertexBuffer,In.indexBuffer,In.segments,u.paint,y.transform.zoom,or,[In.layoutVertexBuffer2,In.patternVertexBuffer,In.zOffsetVertexBuffer]),Lt!=null&&(Lt.value=Xt)};if(zt&&!Wt){const Ar=y.stencilModeForClipping(zn).ref;Ar===0&&Pe&&ee.clear({stencil:0});const tr={func:te.EQUAL,mask:255};fr.u_alpha_discard_threshold=.8,ai(new Sr(tr,Ar,255,te.KEEP,te.KEEP,te.INVERT)),fr.u_alpha_discard_threshold=0,ai(new Sr(tr,Ar,255,te.KEEP,te.KEEP,te.KEEP))}else fr.u_alpha_discard_threshold=zt&&Wt&&mn?.8:0,ai(Wt?fn:y.stencilModeForClipping(zn))}};if(u.hasNonElevatedBuckets){const Pt=!Pe&&y.terrain;z!==0&&Pt?i.w(`Occlusion opacity for layer ${u.id} is supported on terrain only if the layer has line-z-offset enabled.`):Pt?i.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${u.id}.`):an(_,Tn,y.depthModeForSublayer(0,sr.ReadOnly),Sr.disabled,!1,!0)}if(u.hasElevatedBuckets){Tn.push("ELEVATED"),Te&&Tn.push(ve?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),K&&Tn.push("ELEVATION_REFERENCE_SEA");const Pt=zt?y.stencilModeFor3D():Sr.disabled,sn=new sr(y.depthOcclusion?te.GREATER:te.LEQUAL,sr.ReadOnly,y.depthRangeFor3D);y.forceTerrainMode=!0,an(_,Tn,sn,Pt,!0,!0),zt&&an(_,Tn,sn,Pt,!0,!1),y.forceTerrainMode=!1}zt&&(y.resetStencilClippingMasks(),Pe&&ee.clear({stencil:0})),z===0||y.depthOcclusion||Pe||y.layersWithOcclusionOpacity.push(y.currentLayer)},fill:function(y,o,u,_){const w=u.paint.get("fill-color"),T=u.paint.get("fill-opacity");if(T.constantOr(1)===0)return;const C=u.paint.get("fill-emissive-strength"),z=y.colorModeForDrapableLayerRenderPass(C),V=u.paint.get("fill-pattern"),$=y.opaquePassEnabledForLayer()&&!V.constantOr(1)&&w.constantOr(i.al.transparent).a===1&&T.constantOr(0)===1?"opaque":"translucent";let K="none";u.layout.get("fill-elevation-reference")!=="none"?K="road":u.paint.get("fill-z-offset").constantOr(1)!==0&&(K="offset");const ee=!(!y.terrain||!y.terrain.enabled),te={painter:y,sourceCache:o,layer:u,coords:_,colorMode:z,elevationType:K,terrainEnabled:ee,pass:$};if(K!=="offset"){if(nl(te,!1),K==="road"){const ce=!ee&&y.renderPass==="translucent";ce&&wo(y,o,u,_,"geometry"),nl(te,!0,Sr.disabled),ce&&function(Te){const{painter:ve,sourceCache:Ce,layer:Pe,coords:qe,colorMode:Je}=Te,Ye=ve.context.gl,lt=new sr(ve.context.gl.LEQUAL,sr.ReadOnly,ve.depthRangeFor3D);for(const nt of qe){const rt=Ce.getTile(nt),it=rt.getBucket(Pe);if(!it)continue;const dt=it.elevatedStructures;if(!dt||!dt.renderableSegments||dt.renderableSegments.segments[0].primitiveLength===0)continue;ve.prepareDrawTile();const xt=it.bufferData.programConfigurations.get(Pe.id),Xt=ve.isTileAffectedByFog(nt),zt=ve.getOrCreateProgram("elevatedStructures",{config:xt,overrideFog:Xt,defines:["NORMAL_OFFSET"]}),tn={u_matrix:ve.translatePosMatrix(nt.projMatrix,rt,Pe.paint.get("fill-translate"),Pe.paint.get("fill-translate-anchor"))};ve.uploadCommonUniforms(ve.context,zt,nt.toUnwrapped()),zt.draw(ve,Ye.TRIANGLES,lt,Sr.disabled,Je,br.backCCW,tn,Pe.id,dt.vertexBuffer,dt.indexBuffer,dt.renderableSegments,Pe.paint,ve.transform.zoom,xt,[dt.vertexBufferNormal])}}(te)}}else nl(te,!1,y.stencilModeFor3D())},"fill-extrusion":function(y,o,u,_){const w=u.paint.get("fill-extrusion-opacity"),T=y.context,C=T.gl,z=y.terrain,V=z&&z.renderingToTexture;if(w===0)return;const $=y.conflationActive&&y.style.isLayerClipped(u,o.getSource()),K=y.style.order.indexOf(u.fqid);if($&&function(ee,te,ce,Te,ve){for(const Ce of Te){const Pe=te.getTile(Ce).getBucket(ce);Pe&&(Pe.updateReplacement(Ce,ee.replacementSource,ve),Pe.uploadCentroid(ee.context))}}(y,o,u,_,K),z||$)for(const ee of _){const te=o.getTile(ee).getBucket(u);te&&Il(y.context,o,ee,te,u,z,$)}if(y.renderPass==="shadow"&&y.shadowRenderer){const ee=y.shadowRenderer;if(z&&w<.65&&u._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.ab)return;const te=ee.getShadowPassDepthMode(),ce=ee.getShadowPassColorMode();Cl(y,o,u,_,te,Sr.disabled,ce,$)}else if(y.renderPass==="translucent"){const ee=!u.paint.get("fill-extrusion-pattern").constantOr(1),te=u.paint.get("fill-extrusion-color").constantOr(i.al.white);if(!V&&te.a!==0){const ce=new sr(y.context.gl.LEQUAL,sr.ReadWrite,y.depthRangeFor3D);w===1&&ee?Cl(y,o,u,_,ce,Sr.disabled,Mr.unblended,$):(Cl(y,o,u,_,ce,Sr.disabled,Mr.disabled,$),Cl(y,o,u,_,ce,y.stencilModeFor3D(),y.colorModeForRenderPass(),$),y.resetStencilClippingMasks())}if(y.style.enable3dLights()&&ee&&(!z&&y.transform.projection.name!=="globe"||V)){const ce=u.paint.get("fill-extrusion-opacity"),Te=u.paint.get("fill-extrusion-ambient-occlusion-intensity"),ve=u.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),Ce=u.paint.get("fill-extrusion-flood-light-intensity"),Pe=u.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",qe=u.paint.get("fill-extrusion-flood-light-color").toRenderColor(Pe?null:u.lut).toArray01().slice(0,3),Je=Te>0&&ve>0,Ye=Ce>0,lt=(rt,it,dt)=>(1-dt)*rt+dt*it,nt=rt=>{const it=y.depthModeForSublayer(1,sr.ReadOnly,C.LEQUAL,!0),dt=u.paint.get(rt?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),xt=lt(.1,3,dt),Xt=y._showOverdrawInspector;if(!Xt){const zt=new Sr({func:C.ALWAYS,mask:255},255,255,C.KEEP,C.KEEP,C.REPLACE),tn=new Mr([C.ONE,C.ONE,C.ONE,C.ONE],i.al.transparent,[!1,!1,!1,!0],C.MIN);Es(y,o,u,_,it,zt,tn,br.disabled,rt,"sdf",ce,Te,ve,Ce,qe,xt,$,!1)}{const zt=Xt?Sr.disabled:new Sr({func:C.EQUAL,mask:255},255,255,C.KEEP,C.DECR,C.DECR),tn=Xt?y.colorModeForRenderPass():new Mr([C.ONE_MINUS_DST_ALPHA,C.DST_ALPHA,C.ONE,C.ONE],i.al.transparent,[!0,!0,!0,!0]);Es(y,o,u,_,it,zt,tn,br.disabled,rt,"color",ce,Te,ve,Ce,qe,xt,$,!1)}};if(V){const rt=(it,dt,xt)=>{const Xt=y.depthModeForSublayer(1,sr.ReadOnly,C.LEQUAL,!1),zt=u.paint.get(it?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),tn=lt(.1,3,zt);{const un=new Mr([C.ONE,C.ONE,C.ONE,C.ONE],i.al.transparent,[!1,!1,!1,!0]);Es(y,o,u,_,Xt,Sr.disabled,un,br.disabled,it,"clear",ce,Te,ve,Ce,qe,tn,$,dt)}{const un=new Sr({func:C.ALWAYS,mask:255},255,255,C.KEEP,C.KEEP,C.REPLACE),Tn=new Mr([C.ONE,C.ONE,C.ONE,C.ONE],i.al.transparent,[!1,!1,!1,!0],C.MIN);Es(y,o,u,_,Xt,un,Tn,br.disabled,it,"sdf",ce,Te,ve,Ce,qe,tn,$,dt)}{const un=it?C.ZERO:C.ONE_MINUS_DST_ALPHA,Tn=new Sr({func:C.EQUAL,mask:255},255,255,C.KEEP,C.DECR,C.DECR),Lt=new Mr([un,C.DST_ALPHA,C.ONE_MINUS_DST_ALPHA,C.ZERO],i.al.transparent,[!0,!0,!0,!0]);Es(y,o,u,_,Xt,Tn,Lt,br.disabled,it,"color",ce,Te,ve,Ce,qe,tn,$,dt)}{const un=new Mr([C.ONE,C.ONE,C.ONE,it?C.ZERO:C.ONE],i.al.transparent,[!1,!1,!1,!0],it?C.FUNC_ADD:C.MAX);Es(y,o,u,_,Xt,Sr.disabled,un,br.disabled,it,"clear",ce,Te,ve,Ce,qe,tn,$,dt,xt)}};if(Je||Ye){let it;if(y.prepareDrawTile(),z){const dt=z.drapeBufferSize[0],xt=z.drapeBufferSize[1];it=z.framebufferCopyTexture,it&&(!it||it.size[0]===dt&&it.size[1]===xt)||(it&&it.destroy(),it=z.framebufferCopyTexture=new i.T(T,new i.r({width:dt,height:xt}),C.RGBA8)),it.bind(C.LINEAR,C.CLAMP_TO_EDGE),C.copyTexSubImage2D(C.TEXTURE_2D,0,0,0,0,0,dt,xt)}Je&&rt(!0,!1,it),Ye&&rt(!1,!0,it)}}else Je&&nt(!0),Ye&&nt(!1),(Je||Ye)&&y.resetStencilClippingMasks()}}},hillshade:function(y,o,u,_){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent"||y.style.disableElevatedTerrain)return;const w=y.context,T=y.terrain&&y.terrain.renderingToTexture,[C,z]=y.renderPass!=="translucent"||T?[{},_]:y.stencilConfigForOverlap(_);for(const V of z){const $=o.getTile(V);if($.needsHillshadePrepare&&y.renderPass==="offscreen")Mh(y,$,u);else if(y.renderPass==="translucent"){const K=y.depthModeForSublayer(0,sr.ReadOnly),ee=u.paint.get("hillshade-emissive-strength"),te=y.colorModeForDrapableLayerRenderPass(ee),ce=T&&y.terrain?y.terrain.stencilModeForRTTOverlap(V):C[V.overscaledZ];Qa(y,V,$,u,K,ce,te)}}w.viewport.set([0,0,y.width,y.height]),y.resetStencilClippingMasks()},raster:function(y,o,u,_,w,T){if(y.renderPass!=="translucent"||u.paint.get("raster-opacity")===0)return;const C=y.transform.projection.name==="globe",z=u.paint.get("raster-elevation")!==0,V=z&&C;if(y.renderElevatedRasterBackface&&!V)return;const $=y.context,K=$.gl,ee=o.getSource(),te=function(nt,rt,it,dt){const xt=rt.paint.get("raster-color"),Xt=nt.type==="raster-array",zt=[],tn=rt.paint.get("raster-resampling"),un=rt.paint.get("raster-color-mix");let Tn=rt.paint.get("raster-color-range");const Lt=[un[0],un[1],un[2],0],an=un[3];let Pt=tn==="nearest"?dt.NEAREST:dt.LINEAR;if(Xt&&(zt.push("RASTER_ARRAY"),xt||zt.push("RASTER_COLOR"),tn==="linear"&&zt.push("RASTER_ARRAY_LINEAR"),Pt=dt.NEAREST,!Tn&&nt.rasterLayers)){const sn=nt.rasterLayers.find(({id:Qt})=>Qt===rt.sourceLayer);sn&&sn.fields&&sn.fields.range&&(Tn=sn.fields.range)}if(Tn=Tn||[0,1],xt){zt.push("RASTER_COLOR"),it.activeTexture.set(dt.TEXTURE2),rt.updateColorRamp(Tn);let sn=rt.colorRampTexture;sn||(sn=rt.colorRampTexture=new i.T(it,rt.colorRamp,dt.RGBA8)),sn.bind(dt.LINEAR,dt.CLAMP_TO_EDGE)}return{mix:Lt,range:Tn,offset:an,defines:zt,resampling:Pt}}(ee,u,$,K);if(ee instanceof i.aK&&!_.length&&!C)return;const ce=u.paint.get("raster-emissive-strength"),Te=y.colorModeForDrapableLayerRenderPass(ce),ve=y.terrain&&y.terrain.renderingToTexture,Ce=!y.options.moving,Pe=u.paint.get("raster-resampling")==="nearest"?K.NEAREST:K.LINEAR;if(ee instanceof i.aK&&!_.length&&(ee.onNorthPole||ee.onSouthPole)){const nt=z?y.stencilModeFor3D():Sr.disabled;return void qt(!!ee.onNorthPole,null,y,o,u,ce,te,br.disabled,nt)}if(!_.length)return;const[qe,Je]=ee instanceof i.aK||ve?[{},_]:y.stencilConfigForOverlap(_),Ye=Je[Je.length-1].overscaledZ;V&&te.defines.push("PROJECTION_GLOBE_VIEW"),z&&te.defines.push("RENDER_CUTOFF");const lt=(nt,rt,it)=>{for(const dt of nt){const xt=dt.toUnwrapped(),Xt=o.getTile(dt);if(ve&&(!Xt||!Xt.hasData()))continue;$.activeTexture.set(K.TEXTURE0);const zt=sf(Xt,ee,u,te);if(!zt||!zt.texture)continue;const{texture:tn,mix:un,offset:Tn,tileSize:Lt,buffer:an}=zt;let Pt,sn;ve?(Pt=sr.disabled,sn=dt.projMatrix):z?(Pt=new sr(K.LEQUAL,sr.ReadWrite,y.depthRangeFor3D),sn=C?Float32Array.from(y.transform.expandedFarZProjMatrix):y.transform.calculateProjMatrix(xt,Ce)):(Pt=y.depthModeForSublayer(dt.overscaledZ-Ye,u.paint.get("raster-opacity")===1?sr.ReadWrite:sr.ReadOnly,K.LESS),sn=y.transform.calculateProjMatrix(xt,Ce));const Qt=y.terrain&&ve?y.terrain.stencilModeForRTTOverlap(dt):qe[dt.overscaledZ],fn=T?0:u.paint.get("raster-fade-duration");Xt.registerFadeDuration(fn);const Wt=o.findLoadedParent(dt,0),mn=Ml(Xt,Wt,o,y.transform,fn);let zn,Bn;y.terrain&&y.terrain.prepareDrawTile(),$.activeTexture.set(K.TEXTURE0),tn.bind(Pe,K.CLAMP_TO_EDGE),$.activeTexture.set(K.TEXTURE1),Wt?(Wt.texture&&Wt.texture.bind(Pe,K.CLAMP_TO_EDGE),zn=Math.pow(2,Wt.tileID.overscaledZ-Xt.tileID.overscaledZ),Bn=[Xt.tileID.canonical.x*zn%1,Xt.tileID.canonical.y*zn%1]):tn.bind(Pe,K.CLAMP_TO_EDGE),"useMipmap"in tn&&$.extTextureFilterAnisotropic&&y.transform.pitch>20&&K.texParameterf(K.TEXTURE_2D,$.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,$.extTextureFilterAnisotropicMax);const In=y.transform;let or;const Br=z?Up(In):[0,0,0,0];let mr,Dr,Er,Cr,jr,Nr=0;if(V&&ee instanceof i.aK&&ee.coordinates.length>3)mr=Float32Array.from(i.bc(i.cI(new i.bT(0,0,0)))),Dr=Float32Array.from(In.globeMatrix),Er=Float32Array.from(i.cE(In)),Cr=[i.av(In.center.lng),i.aC(In.center.lat)],or=ee.elevatedGlobePerspectiveTransform,jr=ee.elevatedGlobeGridMatrix||new Float32Array(9);else if(V){const tr=i.cF(dt.canonical);Nr=i.cG(tr.getCenter().lat),mr=Float32Array.from(i.bc(i.cI(dt.canonical))),Dr=Float32Array.from(In.globeMatrix),Er=Float32Array.from(i.cE(In)),Cr=[i.av(In.center.lng),i.aC(In.center.lat)],or=[0,0],jr=Float32Array.from(i.cH(dt.canonical,tr,Nr,In.worldSize/In._pixelsPerMercatorPixel))}else or=ee instanceof i.aK?ee.perspectiveTransform:[0,0],mr=new Float32Array(16),Dr=new Float32Array(9),Er=new Float32Array(16),Cr=[0,0],jr=new Float32Array(9);const fr=nn(sn,mr,Dr,Er,jr,Bn||[0,0],i.ag(y.transform.zoom),Cr,Br,zn||1,mn,u,or,z?u.paint.get("raster-elevation"):0,2,un,Tn,te.range,Lt,an,ce),ai=y.isTileAffectedByFog(dt),Ar=y.getOrCreateProgram("raster",{defines:te.defines,overrideFog:ai});if(y.uploadCommonUniforms($,Ar,xt),ee instanceof i.aK){const tr=ee.elevatedGlobeVertexBuffer,si=ee.elevatedGlobeIndexBuffer;if(ve||!C)ee.boundsBuffer&&ee.boundsSegments&&Ar.draw(y,K.TRIANGLES,Pt,Sr.disabled,Te,br.disabled,fr,u.id,ee.boundsBuffer,y.quadTriangleIndexBuffer,ee.boundsSegments);else if(tr&&si){const Hi=In.zoom<=i.c6?ee.elevatedGlobeSegments:ee.getSegmentsForLongitude(In.center.lng);Hi&&Ar.draw(y,K.TRIANGLES,Pt,Sr.disabled,Te,rt,fr,u.id,tr,si,Hi)}}else if(V){Pt=new sr(K.LEQUAL,sr.ReadOnly,y.depthRangeFor3D);const tr=y.globeSharedBuffers;if(tr){const[si,Hi,ci]=tr.getGridBuffers(Nr,!1);Ar.draw(y,K.TRIANGLES,Pt,it||Qt,y.colorModeForRenderPass(),rt,fr,u.id,si,Hi,ci)}}else{const{tileBoundsBuffer:tr,tileBoundsIndexBuffer:si,tileBoundsSegments:Hi}=y.getTileBoundsBuffers(Xt);Ar.draw(y,K.TRIANGLES,Pt,Qt,Te,br.disabled,fr,u.id,tr,si,Hi)}}if(!(ee instanceof i.aK)&&V)for(const dt of nt){const xt=dt.canonical.y===(1<<dt.canonical.z)-1;dt.canonical.y===0&&qt(!0,dt,y,o,u,ce,te,rt,it||Sr.disabled),xt&&qt(!1,dt,y,o,u,ce,te,rt===br.frontCW?br.backCW:br.frontCW,it||Sr.disabled)}};V?lt(Je,y.renderElevatedRasterBackface?br.backCW:br.frontCW,y.stencilModeFor3D()):lt(Je,br.disabled,void 0),y.resetStencilClippingMasks()},"raster-particle":function(y,o,u,_,w,T){y.renderPass==="offscreen"&&function(C,z,V,$){if(!$.length)return;const K=C.context,ee=K.gl,te=z.getSource();if(!(te instanceof Oa))return;const ce=Math.ceil(Math.sqrt(V.paint.get("raster-particle-count")));let Te=V.particlePositionRGBAImage;if(!Te||Te.width!==ce){const Je=function(Ye){const lt=Ye*Ye,nt=new Uint8Array(4*lt),rt=function(dt){return dt|=0,dt=Math.imul(2747636419^dt,2654435769),dt=Math.imul(dt^dt>>>16,2654435769),((dt=Math.imul(dt^dt>>>16,2654435769))>>>0)/4294967296},it=1/1.1;for(let dt=0;dt<lt;dt++){const xt=it*(rt(2*dt+0)+pn),Xt=it*(rt(2*dt+1)+pn),zt=255*xt%1,tn=255*Xt%1,un=zt,Tn=Xt-tn/255,Lt=tn;nt[4*dt+0]=255*(xt-zt/255),nt[4*dt+1]=255*un,nt[4*dt+2]=255*Tn,nt[4*dt+3]=255*Lt}return nt}(ce);Te=V.particlePositionRGBAImage=new i.r({width:ce,height:ce},Je)}let ve=V.particleFramebuffer;ve?ve.width!==ce&&(ve.destroy(),ve=V.particleFramebuffer=K.createFramebuffer(ce,ce,!0,null)):ve=V.particleFramebuffer=K.createFramebuffer(ce,ce,!0,null);const Ce=[];for(const Je of $){const Ye=z.getTile(Je);if(!(Ye instanceof No))continue;const lt=wc(Ye,te,V);if(!lt)continue;const nt=[Ye.tileSize,Ye.tileSize];let rt=V.tileFramebuffer;rt||(rt=V.tileFramebuffer=K.createFramebuffer(nt[0],nt[1],!0,null));let it=Ye.rasterParticleState;it||(it=Ye.rasterParticleState=new lf(K,Je,nt,Te));const dt=it.update(V.lastInvalidatedAt);it.particleTextureDimension!==ce&&it.updateParticleTexture(Je,Te);const xt=it.targetColorTexture;it.targetColorTexture=it.backgroundColorTexture,it.backgroundColorTexture=xt;const Xt=it.particleTexture0;it.particleTexture0=it.particleTexture1,it.particleTexture1=Xt,Ce.push([Je,lt,it,dt])}if(Ce.length===0)return;const Pe=i.q.now(),qe=V.previousDrawTimestamp?.001*(Pe-V.previousDrawTimestamp):.0167;if(V.previousDrawTimestamp=Pe,V.hasColorMap()){K.activeTexture.set(ee.TEXTURE0+2);let Je=V.colorRampTexture;Je||(Je=V.colorRampTexture=new i.T(K,V.colorRamp,ee.RGBA8)),Je.bind(ee.LINEAR,ee.CLAMP_TO_EDGE)}K.bindFramebuffer.set(V.tileFramebuffer.framebuffer),function(Je,Ye,lt){const nt=Je.context,rt=nt.gl,it=Ye.tileFramebuffer;nt.activeTexture.set(rt.TEXTURE0);const dt={u_texture:0,u_opacity:1.05*(Xt=Ye.paint.get("raster-particle-fade-opacity-factor"))/(Xt+.05)},xt=Je.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Xt;for(const zt of lt){const[,,tn,un]=zt;it.colorAttachment.set(tn.targetColorTexture.texture),nt.viewport.set([0,0,it.width,it.height]),nt.clear({color:i.al.transparent}),un&&(tn.backgroundColorTexture.bind(rt.NEAREST,rt.CLAMP_TO_EDGE),xt.draw(Je,rt.TRIANGLES,sr.disabled,Sr.disabled,Mr.alphaBlended,br.disabled,dt,Ye.id,Je.viewportBuffer,Je.quadTriangleIndexBuffer,Je.viewportSegments))}}(C,V,Ce),function(Je,Ye,lt,nt){const rt=Je.context,it=rt.gl,dt=lt.tileFramebuffer,xt=Je.transform.projection.name==="globe",Xt=lt.paint.get("raster-particle-max-speed");for(const zt of nt){const[tn,un,Tn]=zt;rt.activeTexture.set(it.TEXTURE0+0),un.texture.bind(it.LINEAR,it.CLAMP_TO_EDGE),dt.colorAttachment.set(Tn.targetColorTexture.texture);const Lt=Je.getOrCreateProgram("rasterParticleDraw",{defines:un.defines,overrideFog:!1});rt.activeTexture.set(it.TEXTURE0+1);const an=un.scalarData?[]:[0,1,2,3].map(Qt=>i.d7[Qt](tn));an.push(tn);const Pt=tn.canonical.x,sn=tn.canonical.y;for(const Qt of an){const fn=Ye.getTile(xt?Qt.wrapped():Qt);if(!fn)continue;const Wt=fn.rasterParticleState;if(!Wt)continue;const mn=Qt.canonical.x+(1<<Qt.canonical.z)*(Qt.wrap-tn.wrap),zn=Qt.canonical.y;Wt.particleTexture0.bind(it.NEAREST,it.CLAMP_TO_EDGE);const Bn=en(1,Wt.particleTexture0.size[0],[mn-Pt,zn-sn],0,un.texture.size,2,Xt,un.textureOffset,un.scale,un.offset);Lt.draw(Je,it.POINTS,sr.disabled,Sr.disabled,Mr.alphaBlended,br.disabled,Bn,lt.id,Wt.particleIndexBuffer,void 0,Wt.particleSegment)}}}(C,z,V,Ce),K.bindFramebuffer.set(V.particleFramebuffer.framebuffer),function(Je,Ye,lt,nt){const rt=Je.context,it=rt.gl,dt=Ye.paint.get("raster-particle-max-speed"),xt=nt*Ye.paint.get("raster-particle-speed-factor")*.15,Xt=function(tn){return Math.pow(tn,6)}(.01+1*Ye.paint.get("raster-particle-reset-rate-factor")),zt=Ye.particleFramebuffer;rt.viewport.set([0,0,zt.width,zt.height]);for(const tn of lt){const[,un,Tn]=tn;rt.activeTexture.set(it.TEXTURE0+0),un.texture.bind(it.LINEAR,it.CLAMP_TO_EDGE),rt.activeTexture.set(it.TEXTURE0+1);const Lt=Tn.particleTexture0;Lt.bind(it.NEAREST,it.CLAMP_TO_EDGE);const an=Vn(1,Lt.size[0],0,un.texture.size,dt,xt,Xt,un.textureOffset,un.scale,un.offset);zt.colorAttachment.set(Tn.particleTexture1.texture),rt.clear({color:i.al.transparent}),Je.getOrCreateProgram("rasterParticleUpdate",{defines:un.defines}).draw(Je,it.TRIANGLES,sr.disabled,Sr.disabled,Mr.unblended,br.disabled,an,Ye.id,Je.viewportBuffer,Je.quadTriangleIndexBuffer,Je.viewportSegments)}}(C,V,Ce,qe)}(y,o,u,_),y.renderPass==="translucent"&&(function(C,z,V,$,K){const ee=C.context,te=ee.gl,ce=z.getSource().tileSize,Te=5*(1-i.ae(i.bY,i.bY+1,C.transform.zoom))*ce+V.paint.get("raster-particle-elevation"),ve=!C.options.moving,Ce=C.transform.projection.name==="globe";if(!$.length)return;const[Pe,qe]=C.stencilConfigForOverlap($),Je=[];Ce&&Je.push("PROJECTION_GLOBE_VIEW");const Ye=C.stencilModeFor3D();for(const lt of qe){const nt=lt.toUnwrapped(),rt=z.getTile(lt);if(!rt.rasterParticleState)continue;const it=rt.rasterParticleState,dt=100;rt.registerFadeDuration(dt);const xt=z.findLoadedParent(lt,0),Xt=Ml(rt,xt,z,C.transform,dt);let zt,tn;C.terrain&&C.terrain.prepareDrawTile(),ee.activeTexture.set(te.TEXTURE0),it.targetColorTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),ee.activeTexture.set(te.TEXTURE1),xt&&xt.rasterParticleState?(xt.rasterParticleState.targetColorTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),zt=Math.pow(2,xt.tileID.overscaledZ-rt.tileID.overscaledZ),tn=[rt.tileID.canonical.x*zt%1,rt.tileID.canonical.y*zt%1]):it.targetColorTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE);const un=Ce?Float32Array.from(C.transform.expandedFarZProjMatrix):C.transform.calculateProjMatrix(nt,ve),Tn=C.transform,Lt=cf(Tn),an=i.cF(lt.canonical),Pt=i.cG(an.getCenter().lat);let sn,Qt,fn,Wt,mn;Ce?(sn=Float32Array.from(i.bc(i.cI(lt.canonical))),Qt=Float32Array.from(Tn.globeMatrix),fn=Float32Array.from(i.cE(Tn)),Wt=[i.av(Tn.center.lng),i.aC(Tn.center.lat)],mn=Float32Array.from(i.cH(lt.canonical,an,Pt,Tn.worldSize/Tn._pixelsPerMercatorPixel))):(sn=new Float32Array(16),Qt=new Float32Array(9),fn=new Float32Array(16),Wt=[0,0],mn=new Float32Array(9));const zn=_t(un,sn,Qt,fn,mn,tn||[0,0],i.ag(C.transform.zoom),Wt,Lt,zt||1,Xt,Te),Bn=C.isTileAffectedByFog(lt),In=C.getOrCreateProgram("rasterParticle",{defines:Je,overrideFog:Bn});if(C.uploadCommonUniforms(ee,In,nt),Ce){const or=new sr(te.LEQUAL,sr.ReadOnly,C.depthRangeFor3D),Br=0,mr=C.globeSharedBuffers;if(mr){const[Dr,Er,Cr]=mr.getGridBuffers(Pt,Br!==0);In.draw(C,te.TRIANGLES,or,Ye,Mr.alphaBlended,C.renderElevatedRasterBackface?br.frontCCW:br.backCCW,zn,V.id,Dr,Er,Cr)}}else{const or=C.depthModeForSublayer(0,sr.ReadOnly),Br=Pe[lt.overscaledZ],{tileBoundsBuffer:mr,tileBoundsIndexBuffer:Dr,tileBoundsSegments:Er}=C.getTileBoundsBuffers(rt);In.draw(C,te.TRIANGLES,or,Br,Mr.alphaBlended,br.disabled,zn,V.id,mr,Dr,Er)}}C.resetStencilClippingMasks()}(y,o,u,_),y.style.map.triggerRepaint())},background:function(y,o,u,_){const w=u.paint.get("background-color"),T=u.paint.get("background-color-use-theme").constantOr("default")==="none",C=u.paint.get("background-opacity"),z=u.paint.get("background-emissive-strength"),V=u.paint.get("background-pitch-alignment")==="viewport";if(C===0)return;const $=y.context,K=$.gl,ee=y.transform,te=ee.tileSize,ce=u.paint.get("background-pattern");let Te;if(ce!==void 0&&(ce===null||(Te=y.imageManager.getPattern(i.I.from(ce.toString()),u.scope,y.style.getLut(u.scope)),!Te)))return;const ve=!ce&&w.a===1&&C===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==ve)return;const Ce=Sr.disabled,Pe=y.depthModeForSublayer(0,ve==="opaque"?sr.ReadWrite:sr.ReadOnly),qe=y.colorModeForDrapableLayerRenderPass(z),Je=ce?"backgroundPattern":"background";let Ye,lt=_;if(lt||(Ye=y.getBackgroundTiles(),lt=Object.values(Ye).map(nt=>nt.tileID)),ce&&($.activeTexture.set(K.TEXTURE0),y.imageManager.bind(y.context,u.scope)),V){const nt=y.getOrCreateProgram(Je,{overrideFog:!1,overrideRtt:!0}),rt=new Float32Array(i.ad.mat4.identity([])),it=new i.aH(0,0,0,0,0),dt=ce?pr(rt,z,C,y,0,u.scope,Te,V,{tileID:it,tileSize:te}):Tr(rt,z,C,w.toRenderColor(T?null:u.lut));nt.draw(y,K.TRIANGLES,Pe,Ce,qe,br.disabled,dt,u.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments)}else for(const nt of lt){const rt=y.isTileAffectedByFog(nt),it=y.getOrCreateProgram(Je,{overrideFog:rt}),dt=nt.toUnwrapped(),xt=_?nt.projMatrix:y.transform.calculateProjMatrix(dt);y.prepareDrawTile();const Xt=o?o.getTile(nt):Ye?Ye[nt.key]:new ql(nt,te,ee.zoom,y),zt=ce?pr(xt,z,C,y,0,u.scope,Te,V,{tileID:nt,tileSize:te}):Tr(xt,z,C,w.toRenderColor(T?null:u.lut));y.uploadCommonUniforms($,it,dt);const{tileBoundsBuffer:tn,tileBoundsIndexBuffer:un,tileBoundsSegments:Tn}=y.getTileBoundsBuffers(Xt);it.draw(y,K.TRIANGLES,Pe,Ce,qe,br.disabled,zt,u.id,tn,un,Tn)}},sky:function(y,o,u){const _=y._atmosphere?i.ag(y.transform.zoom):1,w=u.paint.get("sky-opacity")*_;if(w===0)return;const T=y.context,C=u.paint.get("sky-type"),z=new sr(T.gl.LEQUAL,sr.ReadOnly,[0,1]),V=y.frameCounter/1e3%1;C==="atmosphere"?y.renderPass==="offscreen"?u.needsSkyboxCapture(y)&&(function($,K,ee,te){const ce=$.context,Te=ce.gl;let ve=K.skyboxFbo;if(!ve){ve=K.skyboxFbo=ce.createFramebuffer(32,32,!0,null),K.skyboxGeometry=new Bm(ce),K.skyboxTexture=ce.gl.createTexture(),Te.bindTexture(Te.TEXTURE_CUBE_MAP,K.skyboxTexture),Te.texParameteri(Te.TEXTURE_CUBE_MAP,Te.TEXTURE_WRAP_S,Te.CLAMP_TO_EDGE),Te.texParameteri(Te.TEXTURE_CUBE_MAP,Te.TEXTURE_WRAP_T,Te.CLAMP_TO_EDGE),Te.texParameteri(Te.TEXTURE_CUBE_MAP,Te.TEXTURE_MIN_FILTER,Te.LINEAR),Te.texParameteri(Te.TEXTURE_CUBE_MAP,Te.TEXTURE_MAG_FILTER,Te.LINEAR);for(let Je=0;Je<6;++Je)Te.texImage2D(Te.TEXTURE_CUBE_MAP_POSITIVE_X+Je,0,Te.RGBA,32,32,0,Te.RGBA,Te.UNSIGNED_BYTE,null)}ce.bindFramebuffer.set(ve.framebuffer),ce.viewport.set([0,0,32,32]);const Ce=K.getCenter($,!0),Pe=$.getOrCreateProgram("skyboxCapture"),qe=new Float64Array(16);i.ad.mat4.identity(qe),i.ad.mat4.rotateY(qe,qe,.5*-Math.PI),eo($,K,Pe,qe,Ce,0),i.ad.mat4.identity(qe),i.ad.mat4.rotateY(qe,qe,.5*Math.PI),eo($,K,Pe,qe,Ce,1),i.ad.mat4.identity(qe),i.ad.mat4.rotateX(qe,qe,.5*-Math.PI),eo($,K,Pe,qe,Ce,2),i.ad.mat4.identity(qe),i.ad.mat4.rotateX(qe,qe,.5*Math.PI),eo($,K,Pe,qe,Ce,3),i.ad.mat4.identity(qe),eo($,K,Pe,qe,Ce,4),i.ad.mat4.identity(qe),i.ad.mat4.rotateY(qe,qe,Math.PI),eo($,K,Pe,qe,Ce,5),ce.viewport.set([0,0,$.width,$.height])}(y,u),u.markSkyboxValid(y)):y.renderPass==="sky"&&function($,K,ee,te,ce){const Te=$.context,ve=Te.gl,Ce=$.transform,Pe=$.getOrCreateProgram("skybox");Te.activeTexture.set(ve.TEXTURE0),ve.bindTexture(ve.TEXTURE_CUBE_MAP,K.skyboxTexture);const qe=((Je,Ye,lt,nt,rt)=>({u_matrix:Je,u_sun_direction:Ye,u_cubemap:0,u_opacity:nt,u_temporal_offset:rt}))(Ce.skyboxMatrix,K.getCenter($,!1),0,te,ce);$.uploadCommonUniforms(Te,Pe),Pe.draw($,ve.TRIANGLES,ee,Sr.disabled,$.colorModeForRenderPass(),br.backCW,qe,"skybox",K.skyboxGeometry.vertexBuffer,K.skyboxGeometry.indexBuffer,K.skyboxGeometry.segment)}(y,u,z,w,V):C==="gradient"&&y.renderPass==="sky"&&function($,K,ee,te,ce){const Te=$.context,ve=Te.gl,Ce=$.transform,Pe=$.getOrCreateProgram("skyboxGradient");K.skyboxGeometry||(K.skyboxGeometry=new Bm(Te)),Te.activeTexture.set(ve.TEXTURE0);let qe=K.colorRampTexture;qe||(qe=K.colorRampTexture=new i.T(Te,K.colorRamp,ve.RGBA8)),qe.bind(ve.LINEAR,ve.CLAMP_TO_EDGE);const Je=((Ye,lt,nt,rt,it)=>({u_matrix:Ye,u_color_ramp:0,u_center_direction:lt,u_radius:i.ak(nt),u_opacity:rt,u_temporal_offset:it}))(Ce.skyboxMatrix,K.getCenter($,!1),K.paint.get("sky-gradient-radius"),te,ce);$.uploadCommonUniforms(Te,Pe),Pe.draw($,ve.TRIANGLES,ee,Sr.disabled,$.colorModeForRenderPass(),br.backCW,Je,"skyboxGradient",K.skyboxGeometry.vertexBuffer,K.skyboxGeometry.indexBuffer,K.skyboxGeometry.segment)}(y,u,z,w,V)},debug:function(y,o,u,_,w,T){for(let C=0;C<u.length;C++)if(w){const $=new i.al(_.r*.8,_.g*.8,_.b*.8,1);Pl(y,o,u[C],_,-1,-1,T),Pl(y,o,u[C],_,-1,1,T),Pl(y,o,u[C],_,1,1,T),Pl(y,o,u[C],_,1,-1,T),Pl(y,o,u[C],$,0,0,T)}else Pl(y,o,u[C],_,0,0,T)},custom:function(y,o,u,_){const w=y.context,T=u.implementation;if(!y.transform.projection.unsupportedLayers||!y.transform.projection.unsupportedLayers.includes("custom")||y.terrain&&(y.terrain.renderingToTexture||y.renderPass==="offscreen")&&u.isDraped(o)){if(y.renderPass==="offscreen"){const C=T.prerender;if(C){if(y.setCustomLayerDefaults(),w.setColorMode(y.colorModeForRenderPass()),y.transform.projection.name==="globe"){const z=y.transform.pointMerc;C.call(T,w.gl,y.transform.customLayerMatrix(),y.transform.getProjection(),y.transform.globeToMercatorMatrix(),i.ag(y.transform.zoom),[z.x,z.y],y.transform.pixelsPerMeterRatio)}else C.call(T,w.gl,y.transform.customLayerMatrix());w.setDirty(),y.setBaseState()}}else if(y.renderPass==="translucent"){if(y.terrain&&y.terrain.renderingToTexture){const z=T.renderToTile;if(z){const V=_[0].canonical,$=new i.ac(V.x+_[0].wrap*(1<<V.z),V.y,V.z);w.setDepthMode(sr.disabled),w.setStencilMode(Sr.disabled),w.setColorMode(y.colorModeForRenderPass()),y.setCustomLayerDefaults(),z.call(T,w.gl,$),w.setDirty(),y.setBaseState()}return}y.setCustomLayerDefaults(),w.setColorMode(y.colorModeForRenderPass()),w.setStencilMode(Sr.disabled);const C=T.renderingMode==="3d"?new sr(y.context.gl.LEQUAL,sr.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,sr.ReadOnly);if(w.setDepthMode(C),y.transform.projection.name==="globe"){const z=y.transform.pointMerc;T.render(w.gl,y.transform.customLayerMatrix(),y.transform.getProjection(),y.transform.globeToMercatorMatrix(),i.ag(y.transform.zoom),[z.x,z.y],y.transform.pixelsPerMeterRatio)}else T.render(w.gl,y.transform.customLayerMatrix());w.setDirty(),y.setBaseState(),w.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(y,o,u,_){if(y.renderPass==="opaque")return;const w=u.paint.get("model-opacity").constantOr(1);if(w===0)return;const T=u.paint.get("model-cast-shadows");if(y.renderPass==="shadow"&&(!T||y.terrain&&w<.65&&u._transitionablePaint._values["model-opacity"].value.expression instanceof i.ab))return;const C=y.shadowRenderer,z=u.paint.get("model-receive-shadows");C&&(C.useNormalOffset=!0,z||(C.enabled=!1));const V=()=>{C&&(C.useNormalOffset=!0,z||(C.enabled=!0))},$=o.getSource();if(y.renderPass==="light-beam"&&$.type!=="batched-model")return;if($.type==="vector"||$.type==="geojson")return function(Pe,qe,Je,Ye,lt){const nt=Pe.transform;if(nt.projection.name!=="mercator")return void i.w(`Drawing 3D models for ${nt.projection.name} projection is not yet implemented`);const rt=nt.getFreeCameraOptions().position;if(!Pe.modelManager)return;const it=Pe.modelManager;Je.modelManager=it;const dt=Pe.shadowRenderer;if(!Je._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const xt=Je._unevaluatedLayout._values["model-id"],Xt=Object.assign({},Je.layout.get("model-id").parameters),zt=Pe.style.order.indexOf(Je.fqid);for(const tn of Ye){const un=qe.getTile(tn).getBucket(Je);if(!un||un.projection.name!==nt.projection.name)continue;const Tn=un.getModelUris();Tn&&!un.modelsRequested&&(it.addModelsFromBucket(Tn,lt),un.modelsRequested=!0);const Lt=bd(tn,nt);Xt.zoom=Lt;const an=xt.possiblyEvaluate(Xt);if(Uf(Pe,un,tn),Ol.shadowUniformsInitialized=!1,Ol.useSingleShadowCascade=!!dt&&dt.getMaxCascadeForTile(tn.toUnwrapped())===0,Pe.renderPass==="shadow"&&dt){if(Pe.currentShadowCascade===1&&un.isInsideFirstShadowMapFrustum)continue;const Qt=nt.calculatePosMatrix(tn.toUnwrapped(),nt.worldSize);if(Ol.tileMatrix.set(Qt),Ol.shadowTileMatrix=Float32Array.from(dt.calculateShadowPassMatrixFromMatrix(Qt)),Ol.aabb.min.fill(0),Ol.aabb.max[0]=Ol.aabb.max[1]=i.ai,Ol.aabb.max[2]=0,Yd(un,Ol,Pe,Je.scope))continue}const Pt=1<<tn.canonical.z,sn=[((rt.x-tn.wrap)*Pt-tn.canonical.x)*i.ai,(rt.y*Pt-tn.canonical.y)*i.ai,rt.z*Pt*i.ai];Pe.conflationActive&&Object.keys(un.instancesPerModel).length>0&&Pe.style.isLayerClipped(Je,qe.getSource())&&un.updateReplacement(tn,Pe.replacementSource,zt,lt)&&(un.uploaded=!1,un.upload(Pe.context));for(let Qt in un.instancesPerModel){const fn=un.instancesPerModel[Qt];fn.features.length>0&&(Qt=an.evaluate(fn.features[0].feature,{}));const Wt=it.getModel(Qt,lt);if(Wt&&Wt.uploaded)for(const mn of Wt.nodes)So(Pe,Je,mn,fn,sn,tn,Ol)}}}(y,o,u,_,$.type==="vector"?u.scope:""),void V();if(!$.loaded())return;if($.type==="batched-model")return function(Pe,qe,Je,Ye){Je.resetLayerRenderingStats(Pe);const lt=Pe.context,nt=Pe.transform,rt=Pe.style.fog,it=Pe.shadowRenderer;if(nt.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${nt.projection.name} projection is not yet implemented`);const dt=Pe.transform.getFreeCameraOptions().position,xt=i.ad.vec3.scale([],[dt.x,dt.y,dt.z],Pe.transform.worldSize),Xt=i.ad.vec3.negate([],xt),zt=i.ad.mat4.identity([]),tn=i.dm(nt.center.lat,nt.zoom),un=i.ad.mat4.fromScaling([],[1,1,1/tn]);i.ad.mat4.translate(zt,zt,Xt);const Tn=Je.paint.get("model-opacity").constantOr(1),Lt=new sr(lt.gl.LEQUAL,sr.ReadWrite,Pe.depthRangeFor3D),an=new sr(lt.gl.LEQUAL,sr.ReadOnly,Pe.depthRangeFor3D),Pt=new i.ce([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),sn=Pe.renderPass==="shadow",Qt=sn&&it?it.getCurrentCascadeFrustum():nt.getFrustum(nt.scaleZoom(nt.worldSize)),fn=Je.paint.get("model-front-cutoff"),Wt=fn[2]<1,mn=Vs(Pe,Je.paint.get("model-cutoff-fade-range")),zn=Je.getLayerRenderingStats();(function(Bn,In,or,Br){const mr=Bn.terrain?Bn.terrain.exaggeration():0,Dr=Bn.transform.zoom;for(const Er of Br){const Cr=In.getTile(Er).getBucket(or);Cr&&(Cr.setFilter(or.filter),Bn.conflationActive&&Cr.updateReplacement(Er,Bn.replacementSource),Cr.evaluateScale(Bn,or),Bn.terrain&&mr>0&&Cr.elevationUpdate(Bn.terrain,mr,Er,or.source),Cr.needsReEvaluation(Bn,Dr,or)&&Cr.evaluate(or))}})(Pe,qe,Je,Ye),function(){let Bn,In,or;Wt?(Bn=Ye.length-1,In=-1,or=-1):(Bn=0,In=Ye.length,or=1);const Br=new Float64Array(16),mr=i.ad.vec3.create(),Dr=new i.P(0,0);for(let Er=Bn;Er!==In;Er+=or){const Cr=Ye[Er],jr=qe.getTile(Cr).getBucket(Je);if(!jr||!jr.uploaded)continue;let Nr=!1;it&&(Nr=it.getMaxCascadeForTile(Cr.toUnwrapped())===0);const fr=nt.calculatePosMatrix(Cr.toUnwrapped(),nt.worldSize),ai=jr.modelTraits;!sn&&Wt&&(i.ad.mat4.invert(Br,fr),i.ad.vec3.transformMat4(mr,xt,Br),Dr.x=mr[0],Dr.y=mr[1]);const Ar=[];jr.setFilter(Je.filter);for(const tr of jr.getNodesInfo()){if(tr.hiddenByReplacement||!tr.node.meshes)continue;const si=tr.node;let Hi=0;Pe.terrain&&si.elevation&&(Hi=si.elevation*Pe.terrain.exaggeration());const ci=(()=>{const sa=tr.aabb;return Pt.min=[...sa.min],Pt.max=[...sa.max],Pt.min[2]+=Hi,Pt.max[2]+=Hi,i.ad.vec3.transformMat4(Pt.min,Pt.min,fr),i.ad.vec3.transformMat4(Pt.max,Pt.max,fr),Pt})(),Oi=tr.evaluatedScale;if(Oi[0]<=1&&Oi[1]<=1&&Oi[2]<=1&&ci.intersects(Qt)===0)continue;if(!sn&&Wt){const sa=.16666666666666666;tr.cameraCollisionOpacity=xt[0]>ci.min[0]&&xt[0]<ci.max[0]&&xt[1]>ci.min[1]&&xt[1]<ci.max[1]&&xt[2]*tn<ci.max[2]&&si.footprint&&i.bA(Dr,si.footprint)?Math.max(tr.cameraCollisionOpacity-sa,0):Math.min(1,tr.cameraCollisionOpacity+sa)}const Ka=[...fr],us=si.anchor?si.anchor[0]:0,to=si.anchor?si.anchor[1]:0;i.ad.mat4.translate(Ka,Ka,[us*(Oi[0]-1),to*(Oi[1]-1),Hi]),i.ad.vec3.exactEquals(Oi,i.dq)||i.ad.mat4.scale(Ka,Ka,Oi);const Ws=i.ad.mat4.multiply([],Ka,si.matrix),po=i.ad.mat4.multiply([],nt.expandedFarZProjMatrix,Ws),Ti=i.ad.mat4.multiply([],nt.expandedFarZProjMatrix,Ka),ra=i.ad.vec4.transformMat4([],[us,to,Hi,1],po)[2];si.hidden=!1;let Di=Tn;sn||(Wt&&(Di*=tr.cameraCollisionOpacity,Di*=ff(Ka,nt,tr.aabb,fn)),Di*=Xd(mn,ra)),Di!==0?Ar.push({nodeInfo:tr,depth:ra,opacity:Di,wvpForNode:po,wvpForTile:Ti,nodeModelMatrix:Ws,tileModelMatrix:Ka}):si.hidden=!0}sn||Ar.sort((tr,si)=>!Wt||tr.opacity===1&&si.opacity===1?tr.depth<si.depth?-1:1:tr.opacity===1?-1:si.opacity===1?1:tr.depth>si.depth?-1:1);for(const tr of Ar){const si=tr.nodeInfo,Hi=si.node;let ci=i.ad.mat4.multiply([],un,tr.tileModelMatrix);i.ad.mat4.multiply(ci,zt,ci);const Oi=i.ad.mat4.invert([],ci);i.ad.mat4.transpose(Oi,Oi),i.ad.mat4.scale(Oi,Oi,kh),ci=i.ad.mat4.multiply(ci,ci,Hi.matrix);const Ka=Pe.renderPass==="light-beam",us=Je.paint.get("model-color-use-theme").constantOr("default")==="none",to=ai&i.ds.HasMapboxMeshFeatures,Ws=to?0:si.evaluatedRMEA[0][2];for(let po=0;po<Hi.meshes.length;++po){const Ti=Hi.meshes[po],ra=po===Hi.lightMeshIndex;let Di=tr.wvpForNode;if(ra){if(!Ka&&!Pe.terrain&&Pe.shadowRenderer){Pe.currentLayer<Pe.firstLightBeamLayer&&(Pe.firstLightBeamLayer=Pe.currentLayer);continue}Di=tr.wvpForTile}else if(Ka)continue;const sa={defines:[]},mo=[];if(!sn&&it&&(it.useNormalOffset=!!Ti.normalBuffer),Lh(sa.defines,mo,Ti,Pe,us?null:Je.lut),to||sa.defines.push("DIFFUSE_SHADED"),Nr&&sa.defines.push("SHADOWS_SINGLE_CASCADE"),zn&&(sn?zn.numRenderedVerticesInShadowPass+=Ti.vertexArray.length:zn.numRenderedVerticesInTransparentPass+=Ti.vertexArray.length),sn){vd(Ti,tr.nodeModelMatrix,Pe,Je);continue}let wa=null;if(rt){const Xc=Sc(tr.nodeModelMatrix,Pe.transform);if(wa=new Float32Array(Xc),nt.projection.name!=="globe"){const yl=Ti.aabb.min,Fh=Ti.aabb.max,[go,_f]=rt.getOpacityForBounds(Xc,yl[0],yl[1],Fh[0],Fh[1]);sa.overrideFog=go>=Nn||_f>=Nn}}const as=Ti.material;let Su;as.occlusionTexture&&as.occlusionTexture.offsetScale&&(Su=as.occlusionTexture.offsetScale,sa.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Vo=Pe.getOrCreateProgram("model",sa);!sn&&it&&it.setupShadowsFromMatrix(tr.tileModelMatrix,Vo,it.useNormalOffset),Pe.uploadCommonUniforms(lt,Vo,null,wa);const ec=as.pbrMetallicRoughness;ec.metallicFactor=.9,ec.roughnessFactor=.5;const Rl=cr(new Float32Array(Di),new Float32Array(ci),new Float32Array(Oi),new Float32Array(Hi.matrix),Pe,tr.opacity,ec.baseColorFactor.toRenderColor(null),as.emissiveFactor,ec.metallicFactor,ec.roughnessFactor,as,Ws,Je,[0,0,0],Su);!ra&&(si.hasTranslucentParts||tr.opacity<1)&&Vo.draw(Pe,lt.gl.TRIANGLES,Lt,Sr.disabled,Mr.disabled,br.backCCW,Rl,Je.id,Ti.vertexBuffer,Ti.indexBuffer,Ti.segments,Je.paint,Pe.transform.zoom,void 0,mo),Vo.draw(Pe,lt.gl.TRIANGLES,ra?an:Lt,Sr.disabled,ra||tr.opacity<1||si.hasTranslucentParts?Mr.alphaBlended:Mr.unblended,br.backCCW,Rl,Je.id,Ti.vertexBuffer,Ti.indexBuffer,Ti.segments,Je.paint,Pe.transform.zoom,void 0,mo)}}}}()}(y,o,u,_),void V();if($.type!=="model")return;const K=$.getModels(),ee=[],te=y.transform.getFreeCameraOptions().position,ce=i.ad.vec3.scale([],[te.x,te.y,te.z],y.transform.worldSize);i.ad.vec3.negate(ce,ce);const Te=[],ve=[];let Ce=0;for(const Pe of K){const qe=u.paint.get("model-rotation").constantOr(null),Je=u.paint.get("model-scale").constantOr(null),Ye=u.paint.get("model-translation").constantOr(null);Pe.computeModelMatrix(y,qe,Je,Ye,!0,!0,!1);const lt=i.ad.mat4.identity([]),nt=i.dm(Pe.position.lat,y.transform.zoom),rt=i.ad.mat4.fromScaling([],[1,1,1/nt]);i.ad.mat4.translate(lt,lt,ce),ee.push({zScaleMatrix:rt,negCameraPosMatrix:lt});for(const it of Pe.nodes)Ku(y.transform,it,Pe.matrix,y.transform.expandedFarZProjMatrix,Ce,Te,ve);Ce++}if(Te.sort((Pe,qe)=>qe.depth-Pe.depth),y.renderPass!=="shadow"){if(w===1)for(const Pe of ve)Ac(Pe,y,u,ee[Pe.modelIndex],Sr.disabled,y.colorModeForRenderPass());else{for(const Pe of ve)Ac(Pe,y,u,ee[Pe.modelIndex],Sr.disabled,Mr.disabled);for(const Pe of ve)Ac(Pe,y,u,ee[Pe.modelIndex],y.stencilModeFor3D(),y.colorModeForRenderPass());y.resetStencilClippingMasks()}for(const Pe of Te)Ac(Pe,y,u,ee[Pe.modelIndex],Sr.disabled,y.colorModeForRenderPass());V()}else{for(const Pe of ve)vd(Pe.mesh,Pe.nodeModelMatrix,y,u);for(const Pe of Te)vd(Pe.mesh,Pe.nodeModelMatrix,y,u);V()}}},zh={line:function(y,o,u){if(y.hasElevatedBuckets=!1,y.hasNonElevatedBuckets=!1,y._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||y._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(o){const _=o.getVisibleCoordinates();for(const w of _){const T=o.getTile(w).getBucket(y);if(T&&(T.hasZOffset?y.hasElevatedBuckets=!0:y.hasNonElevatedBuckets=!0,y.hasElevatedBuckets&&y.hasNonElevatedBuckets))break}}}else y.hasNonElevatedBuckets=!0},model:function(y,o,u){const _=o.getSource();if(!_.loaded())return;if(_.type==="vector"||_.type==="geojson")return void(u.modelManager&&u.modelManager.upload(u,_.type==="vector"?y.scope:""));if(_.type==="batched-model"||_.type!=="model")return;const w=_.getModels();for(const T of w)T.upload(u.context)},raster:function(y,o,u){const _=o.getSource();if(!(_ instanceof Oa&&_.loaded()))return;const w=y.sourceLayer||_.rasterLayerIds&&_.rasterLayerIds[0];if(!w)return;const T=y.paint.get("raster-array-band")||_.getInitialBand(w);if(T==null)return;const C=o.getIds().map(z=>o.getTileByID(z));for(const z of C)z.updateNeeded(w,T)&&_.prepareTile(z,w,T)},"raster-particle":function(y,o,u){const _=o.getSource();if(!(_ instanceof Oa&&_.loaded()))return;const w=y.sourceLayer||_.rasterLayerIds&&_.rasterLayerIds[0];if(!w)return;const T=y.paint.get("raster-particle-array-band")||_.getInitialBand(w);if(T==null)return;const C=o.getIds().map(z=>o.getTileByID(z));for(const z of C)z.updateNeeded(w,T)&&_.prepareTile(z,w,T)}},jm={fill:wo};class qp{constructor(o,u,_,w,T){this.context=new vi(o,u),this.transform=_,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=T,this._timeStamp=i.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const C=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const V of C)this._debugParams.enabledLayers[V]=!0;T.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),T.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),T.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),T.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),T.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),T.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const V of C)T.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],V);this.occlusionParams=new Zd(T),this.setup(),this.numSublayers=Ko.maxUnderzooming+Ko.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.dy,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new uo(this),this._wireframeDebugCache=new Xu,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const z=new i.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new i.T(this.context,z,o.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=w}updateTerrain(o,u){const _=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Dh(this,o));const w=this._terrain;this.transform.elevation=_?w:null,w.update(o,this.transform,u),this.transform.elevation&&!w.enabled&&(this.transform.elevation=null)}_updateFog(o){const u=o.fog;if(!u||this.transform.projection.name==="globe"||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,w]=u.getFovAdjustedRange(this.transform._fov);if(_>w)return void(this.transform.fogCullDistSq=null);const T=_+.78*(w-_);this.transform.fogCullDistSq=T*T}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(o){o&&!this._terrain&&(this._terrain=new Dh(this,this.style)),this._forceTerrainMode=o}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(o,u){if(this.width=o*i.q.devicePixelRatio,this.height=u*i.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._mergedLayers[_].resize()}setup(){const o=this.context,u=new i.b5;u.emplaceBack(0,0),u.emplaceBack(i.ai,0),u.emplaceBack(0,i.ai),u.emplaceBack(i.ai,i.ai),this.tileExtentBuffer=o.createVertexBuffer(u,i.b7.members),this.tileExtentSegments=i.b8.simpleSegment(0,0,4,2);const _=new i.b5;_.emplaceBack(0,0),_.emplaceBack(i.ai,0),_.emplaceBack(0,i.ai),_.emplaceBack(i.ai,i.ai),this.debugBuffer=o.createVertexBuffer(_,i.b7.members),this.debugSegments=i.b8.simpleSegment(0,0,4,5);const w=new i.b5;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(-1,1),w.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(w,i.b7.members),this.viewportSegments=i.b8.simpleSegment(0,0,4,2);const T=new i.aU;T.emplaceBack(0,0,0,0),T.emplaceBack(i.ai,0,i.ai,0),T.emplaceBack(0,i.ai,0,i.ai),T.emplaceBack(i.ai,i.ai,i.ai,i.ai),this.mercatorBoundsBuffer=o.createVertexBuffer(T,i.ba.members),this.mercatorBoundsSegments=i.b8.simpleSegment(0,0,4,2);const C=new i.aV;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(C);const z=new i.b6;for(const $ of[0,1,3,2,0])z.emplaceBack($);this.debugIndexBuffer=o.createIndexBuffer(z),this.emptyTexture=new i.T(o,new i.r({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA8),this.identityMat=i.ad.mat4.create();const V=this.context.gl;this.stencilClearMode=new Sr({func:V.ALWAYS,mask:0},0,255,V.ZERO,V.ZERO,V.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const o=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,o.TRIANGLES,sr.disabled,this.stencilClearMode,Mr.disabled,br.disabled,qu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,u,_){if(!u||this.currentStencilSource===u.id||!o.isTileClipped()||!_||_.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let z=!1;for(const V of _)if(this._tileClippingMaskIDs[V.key]===void 0){z=!0;break}if(!z)return}this.currentStencilSource=u.id;const w=this.context,T=w.gl;this.nextStencilID+_.length>256&&this.clearStencil(),w.setColorMode(Mr.disabled),w.setDepthMode(sr.disabled);const C=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const z of _){const V=u.getTile(z),$=this._tileClippingMaskIDs[z.key]=this.nextStencilID++,{tileBoundsBuffer:K,tileBoundsIndexBuffer:ee,tileBoundsSegments:te}=this.getTileBoundsBuffers(V);C.draw(this,T.TRIANGLES,sr.disabled,new Sr({func:T.ALWAYS,mask:0},$,255,T.KEEP,T.KEEP,T.REPLACE),Mr.disabled,br.disabled,qu(z.projMatrix),"$clipping",K,ee,te)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,u=this.context.gl;return new Sr({func:u.NOTEQUAL,mask:255},o,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const u=this.context.gl;return new Sr({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(o){const u=this.context.gl,_=o.sort((C,z)=>z.overscaledZ-C.overscaledZ),w=_[_.length-1].overscaledZ,T=_[0].overscaledZ-w+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();const C={};for(let z=0;z<T;z++)C[z+w]=new Sr({func:u.GEQUAL,mask:255},z+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=T,[C,_]}return[{[w]:Sr.disabled},_]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new Mr([o.CONSTANT_COLOR,o.ONE,o.CONSTANT_COLOR,o.ONE],new i.al(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Mr.unblended:Mr.alphaBlended}colorModeForDrapableLayerRenderPass(o){const u=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Mr([u.ONE,u.ONE_MINUS_SRC_ALPHA,u.CONSTANT_ALPHA,u.ONE_MINUS_SRC_ALPHA],new i.al(0,0,0,o===void 0?0:o),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(o,u,_,w=!1){if(this.depthOcclusion)return new sr(this.context.gl.GREATER,sr.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!w)return sr.disabled;const T=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new sr(_||this.context.gl.LEQUAL,u,[T,T])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const o=this.context.gl,u=Math.ceil(this.width),_=Math.ceil(this.height),w=this.context.bindFramebuffer.get(),T=o.getParameter(o.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===u&&this.depthFBO.height===_||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),u!==0&&_!==0&&(this.depthFBO=new Bi(this.context,u,_,!1,"texture"),this.depthTexture=new i.T(this.context,{width:u,height:_,data:null},o.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(w),o.bindTexture(o.TEXTURE_2D,T),this.depthFBO&&(o.bindFramebuffer(o.READ_FRAMEBUFFER,null),o.bindFramebuffer(o.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),o.blitFramebuffer(0,0,u,_,0,0,u,_,o.DEPTH_BUFFER_BIT,o.NEAREST),o.bindFramebuffer(o.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((o,u)=>o+u/this._fpsHistory.length,0))}render(o,u){const _=i.q.now();this._dt=_-this._timeStamp,this._timeStamp=_,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=o.map.repaint,this.style=o,this.options=u;const w=this.style._mergedLayers,T=!(!this.terrain||!this.terrain.enabled),C=()=>this.style._getOrder(T).filter(Lt=>{const an=w[Lt];return!(an.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[an.type]});let z=C(),V=!1,$=!1;for(const Lt of z){const an=w[Lt];an.type==="circle"&&(V=!0),an.type==="symbol"&&(an.hasInitialOcclusionOpacityProperties?$=!0:V=!0)}let K=z.map(Lt=>w[Lt]);const ee=this.style._mergedSourceCaches;this.imageManager=o.imageManager,this.modelManager=o.modelManager,this.symbolFadeChange=o.placement.symbolFadeChange(i.q.now()),this.imageManager.beginFrame();let te=0,ce=!1;for(const Lt in ee){const an=ee[Lt];an.used&&(an.prepare(this.context),an.getSource().usedInConflation&&++te)}let Te=!1;for(const Lt of K)Lt.isHidden(this.transform.zoom)||(Lt.type==="clip"&&(Te=!0),this.prepareLayer(Lt));const ve={},Ce={},Pe={},qe={},Je={};for(const Lt in ee){const an=ee[Lt];ve[Lt]=an.getVisibleCoordinates(),Ce[Lt]=ve[Lt].slice().reverse(),Pe[Lt]=an.getVisibleCoordinates(!0).reverse(),qe[Lt]=an.getShadowCasterCoordinates(),Je[Lt]=an.sortCoordinatesByDistance(ve[Lt])}const Ye=Lt=>{const an=this.style.getLayerSourceCache(Lt);return an&&an.used?an.getSource():null};if(te||Te||this._clippingActiveLastFrame){const Lt=[],an=[];let Pt=0;for(const sn of K)this.isSourceForClippingOrConflation(sn,Ye(sn))&&(Lt.push(sn),an.push(Pt)),Pt++;if(Lt&&(Te||Lt.length>1)||this._clippingActiveLastFrame){Te=!1;const sn=[];for(let Qt=0;Qt<Lt.length;Qt++){const fn=Lt[Qt],Wt=an[Qt],mn=this.style.getLayerSourceCache(fn);if(!mn||!mn.used||!mn.getSource().usedInConflation&&fn.type!=="clip")continue;let zn=i.dA,Bn=i.by.None;const In=[];let or=!0;if(fn.type==="clip"){zn=Wt;for(const Br of fn.layout.get("clip-layer-types"))Bn|=Br==="model"?i.by.Model:Br==="symbol"?i.by.Symbol:i.by.FillExtrusion;for(const Br of fn.layout.get("clip-layer-scope"))In.push(Br);fn.isHidden(this.transform.zoom)?or=!1:Te=!0}or&&sn.push({layer:fn.fqid,cache:mn,order:zn,clipMask:Bn,clipScope:In})}this.replacementSource.setSources(sn),ce=!0}}this._clippingActiveLastFrame=Te,ce||this.replacementSource.clear(),this.conflationActive=ce,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Lt=0;Lt<K.length;Lt++){const an=K[Lt],Pt=an.cutoffRange();if(this.longestCutoffRange=Math.max(Pt,this.longestCutoffRange),Pt>0){const sn=Ye(an);sn&&(this.minCutoffZoom=Math.max(sn.minzoom,this.minCutoffZoom)),an.minzoom&&(this.minCutoffZoom=Math.max(an.minzoom,this.minCutoffZoom))}an.is3D(T)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Lt),this._lastOcclusionLayer=Lt)}const lt=this.style&&this.style.fog;lt?(this._fogVisible=lt.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=lt.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Pe),this.opaquePassCutoff=0,z=C(),K=z.map(Lt=>w[Lt]));const nt=this._shadowRenderer;if(nt){nt.updateShadowParameters(this.transform,this.style.directionalLight);for(const Lt in ee)for(const an of ve[Lt]){let Pt={min:0,max:0};this.terrain&&(Pt=this.terrain.getMinMaxForTile(an)||Pt),nt.addShadowReceiver(an.toUnwrapped(),Pt.min,Pt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.dz(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Kd(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const rt=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),it=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(rt&&!this._snow&&(this._snow=new qf(this)),!rt&&this._snow&&(this._snow.destroy(),delete this._snow),it&&!this._rain&&(this._rain=new df(this)),!it&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!on.has(this.context.gl))return;this.renderPass="offscreen";for(const Lt of K){const an=o.getLayerSourceCache(Lt);if(!Lt.hasOffscreenPass()||Lt.isHidden(this.transform.zoom))continue;const Pt=an?Ce[an.id]:void 0;(Lt.type==="custom"||Lt.type==="raster"||Lt.type==="raster-particle"||Lt.isSky()||Pt&&Pt.length)&&this.renderLayer(this,an,Lt,Pt)}this.depthRangeFor3D=[0,1-(K.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,qe)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const dt=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),xt=(()=>{if(u.showOverdrawInspector)return i.al.black;const Lt=this.style.fog;if(Lt&&this.transform.projection.supportsFog){const an=this.style.getLut(Lt.scope);if(!dt){const Pt=Lt.properties.get("color-use-theme")==="none",sn=Lt.properties.get("color").toRenderColor(Pt?null:an).toArray01();return new i.al(...sn)}if(dt){const Pt=Lt.properties.get("space-color-use-theme")==="none",sn=Lt.properties.get("space-color").toRenderColor(Pt?null:an).toArray01();return new i.al(...sn)}}return i.al.transparent})();if(this.context.clear({color:xt,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&dt&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=z.length-1;this.currentLayer>=0;this.currentLayer--){const Lt=K[this.currentLayer],an=o.getLayerSourceCache(Lt);if(Lt.isSky())continue;const Pt=an?(Lt.is3D(T)?Je:Ce)[an.id]:void 0;this._renderTileClippingMasks(Lt,an,Pt),this.renderLayer(this,an,Lt,Pt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&dt&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.ag(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<z.length;this.currentLayer++){const Lt=K[this.currentLayer],an=o.getLayerSourceCache(Lt);Lt.isSky()&&this.renderLayer(this,an,Lt,an?Ce[an.id]:void 0)}function Xt(Lt,an){let Pt;return an&&(Pt=(Lt.type==="symbol"?Pe:Lt.is3D(T)?Je:Ce)[an.id]),Pt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<z.length;){const Lt=K[this.currentLayer];if(Lt.type==="raster"||Lt.type==="raster-particle"){const an=o.getLayerSourceCache(Lt);this.renderLayer(this,an,Lt,Xt(Lt,an))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let zt=0;nt&&(zt=nt.getShadowCastingLayerCount());let tn=!1,un=-1;for(let Lt=0;Lt<z.length;++Lt){const an=K[Lt];an.isHidden(this.transform.zoom)||an.is3D(T)&&(un=Lt)}$&&un===-1&&(V=!0);let Tn=!1;for(;this.currentLayer<z.length;){const Lt=K[this.currentLayer],an=o.getLayerSourceCache(Lt);if(Lt.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Lt)){if(Lt.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Tn&&Lt.is3D(T)&&!T){const Pt=this.currentLayer,sn=Qt=>{for(this.currentLayer=0;this.currentLayer<K.length;this.currentLayer++){const fn=K[this.currentLayer];if(jm[fn.type]){const Wt=this.style.getLayerSourceCache(fn);jm[fn.type](this,Wt,fn,Xt(fn,Wt),Qt)}}};sn("initialize"),sn("reset"),this.currentLayer=Pt,Tn=!0}if(V&&!tn&&this.terrain&&!this.transform.isOrthographic&&(tn=!0,this.blitDepth()),$&&un!==-1&&this.currentLayer===un+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Lt,an,an?ve[an.id]:void 0),this.renderLayer(this,an,Lt,Xt(Lt,an)),!this.terrain&&nt&&zt>0&&Lt.hasShadowPass()&&--zt==0&&(nt.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Pt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Pt;this.currentLayer++){const sn=K[this.currentLayer];if(!sn.hasLightBeamPass())continue;const Qt=o.getLayerSourceCache(sn);this.renderLayer(this,Qt,sn,Qt?Ce[Qt.id]:void 0)}this.currentLayer=Pt,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Pt=this.currentLayer;this.depthOcclusion=!0;for(const sn of this.layersWithOcclusionOpacity){this.currentLayer=sn;const Qt=K[this.currentLayer],fn=o.getLayerSourceCache(Qt),Wt=fn?Ce[fn.id]:void 0;this.terrain||this._renderTileClippingMasks(Qt,fn,fn?ve[fn.id]:void 0),this.renderLayer(this,fn,Qt,Wt)}this.depthOcclusion=!1,this.currentLayer=Pt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Lt=null;K.forEach(an=>{const Pt=o.getLayerSourceCache(an);Pt&&!an.isHidden(this.transform.zoom)&&Pt.getVisibleCoordinates().length&&(!Lt||Lt.getSource().maxzoom<Pt.getSource().maxzoom)&&(Lt=Pt)}),Lt&&this.options.showTileBoundaries&&pf.debug(this,Lt,Lt.getVisibleCoordinates(),i.al.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&pf.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.al(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Lt){const an=Lt.transform.padding;Ff(Lt,Lt.transform.height-(an.top||0),3,Hc),Ff(Lt,an.bottom||0,3,Nm),Hu(Lt,an.left||0,3,Gd),Hu(Lt,Lt.transform.width-(an.right||0),3,zm);const Pt=Lt.transform.centerPoint;(function(sn,Qt,fn,Wt){Gu(sn,Qt-1,fn-10,2,20,Wt),Gu(sn,Qt-10,fn-1,20,2,Wt)})(Lt,Pt.x,Lt.transform.height-Pt.y,uf)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),ce||(this.conflationActive=!1)}prepareLayer(o){this.gpuTimingStart(o);const{unsupportedLayers:u}=this.transform.projection,_=!u||!u.includes(o.type);if(zh[o.type]&&(_||this.terrain&&o.type==="custom")){const w=this.style.getLayerSourceCache(o);zh[o.type](o,w,this)}this.gpuTimingEnd()}renderLayer(o,u,_,w){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="sky"||_.type==="custom"||_.type==="model"||_.type==="raster"||_.type==="raster-particle"||w&&w.length)&&(this.id=_.id,this.gpuTimingStart(_),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(_.type)&&(!o.terrain||_.type!=="custom")||_.type==="clip"||pf[_.type](o,u,_,w,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery,_=this.context.gl;let w=this.gpuTimers[o.id];w||(w=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:_.createQuery()}),w.calls++,_.beginQuery(u.TIME_ELAPSED_EXT,w.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const o=this.context.extTimerQuery,u=this.context.gl,_=u.createQuery();this.deferredRenderGpuTimeQueries.push(_),u.beginQuery(o.TIME_ELAPSED_EXT,_)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}collectDeferredRenderGpuQueries(){const o=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],o}queryGpuTimers(o){const u={};for(const _ in o){const w=o[_],T=this.context.extTimerQuery,C=T.getQueryParameter(w.query,this.context.gl.QUERY_RESULT)/1e6;T.deleteQueryEXT(w.query),u[_]=C}return u}queryGpuTimeDeferredRender(o){if(!this.options.gpuTimingDeferredRender)return 0;const u=this.context.gl;let _=0;for(const w of o)_+=u.getQueryParameter(w,u.QUERY_RESULT)/1e6,u.deleteQuery(w);return _}translatePosMatrix(o,u,_,w,T){if(!_[0]&&!_[1])return o;const C=T?w==="map"?this.transform.angle:0:w==="viewport"?-this.transform.angle:0;if(C){const $=Math.sin(C),K=Math.cos(C);_=[_[0]*K-_[1]*$,_[0]*$+_[1]*K]}const z=[T?_[0]:i.at(u,_[0],this.transform.zoom),T?_[1]:i.at(u,_[1],this.transform.zoom),0],V=new Float32Array(16);return i.ad.mat4.translate(V,o,z),V}saveTileTexture(o){const u=o.size[0],_=this._tileTextures[u];_?_.push(o):this._tileTextures[u]=[o]}getTileTexture(o){const u=this._tileTextures[o];return u&&u.length>0?u.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(o,u,_){const w=_===void 0?this.terrain&&this.terrain.renderingToTexture:_,T=[];return this.style&&this.style.enable3dLights()&&(o==="globeRaster"||o==="terrainRaster"?(T.push("LIGHTING_3D_MODE"),T.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):w||T.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||T.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(T.push("TERRAIN"),this.linearFloatFilteringSupported()&&T.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&T.push("GLOBE"),!this._fogVisible||w||u!==void 0&&!u||T.push("FOG","FOG_DITHERING"),w&&T.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&T.push("OVERDRAW_INSPECTOR"),T}getOrCreateProgram(o,u){this.cache=this.cache||{};const _=u&&u.defines||[],w=u&&u.config,T=this.currentGlobalDefines(o,u&&u.overrideFog,u&&u.overrideRtt).concat(_),C=km.cacheKey(Zo[o],o,T,w);return this.cache[C]||(this.cache[C]=new km(this.context,o,Zo[o],w,Ea[o],T)),this.cache[C]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(o,u){if(this.style.enable3dLights()){const _=this.style.directionalLight,w=this.style.ambientLight;if(_&&w){const T=((C,z,V)=>{const $=C.properties.get("direction"),K=C.properties.get("color-use-theme")==="none",ee=C.properties.get("color").toRenderColor(K?null:V.getLut(C.scope)).toArray01(),te=C.properties.get("intensity"),ce=z.properties.get("color-use-theme")==="none",Te=z.properties.get("color").toRenderColor(ce?null:V.getLut(z.scope)).toArray01(),ve=z.properties.get("intensity"),Ce=[$.x,$.y,$.z],Pe=i.cN(Te,ve),qe=i.cN(ee,te);return{u_lighting_ambient_color:Pe,u_lighting_directional_dir:Ce,u_lighting_directional_color:qe,u_ground_radiance:$u(Ce,qe,Pe)}})(_,w,this.style);u.setLightsUniformValues(o,T)}}}uploadCommonUniforms(o,u,_,w,T){if(this.uploadCommonLightUniforms(o,u),this.terrain&&this.terrain.renderingToTexture)return;const C=this.style.fog;if(C){const z=C.getOpacity(this.transform.pitch),V=(($,K,ee,te,ce,Te,ve,Ce,Pe,qe,Je,Ye)=>{const lt=$.transform,nt=K.properties.get("color-use-theme")==="none",rt=K.properties.get("color").toRenderColor(nt?null:$.style.getLut(K.scope)).toArray01();rt[3]=te;const it=$.frameCounter/1e3%1,[dt,xt]=K.properties.get("vertical-range");return{u_fog_matrix:ee?lt.calculateFogTileMatrix(ee):Ye||$.identityMat,u_fog_range:K.getFovAdjustedRange(lt._fov),u_fog_color:rt,u_fog_horizon_blend:K.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(dt,xt),xt],u_fog_temporal_offset:it,u_frustum_tl:ce,u_frustum_tr:Te,u_frustum_br:ve,u_frustum_bl:Ce,u_globe_pos:Pe,u_globe_radius:qe,u_viewport:Je,u_globe_transition:i.ag(lt.zoom),u_is_globe:+(lt.projection.name==="globe")}})(this,C,_,z,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.q.devicePixelRatio,this.transform.height*i.q.devicePixelRatio],w);u.setFogUniformValues(o,V)}T&&u.setCutoffUniformValues(o,T.uniformValues)}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){const o=this.canvasCopy();o&&(this.frameCopies.push(o),this.tileLoaded=!1)}canvasCopy(){const o=this.context.gl,u=o.createTexture();return o.bindTexture(o.TEXTURE_2D,u),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&o.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const o=this._backgroundTiles,u=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const w of _)u[w.key]=o[w.key]||new ql(w,512,this.transform.tileZoom,this);return u}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(o,u){return!(!o.is3D(!(!this.terrain||!this.terrain.enabled))||o.type!=="clip"&&(o.minzoom&&o.minzoom>this.transform.zoom||(this.style._clipLayerPresent||o.sourceLayer!=="building")&&(!u||u.type!=="batched-model")))}isTileAffectedByFog(o){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let u=this._cachedTileFogOpacities[o.key];return u||(this._cachedTileFogOpacities[o.key]=u=this.style.fog.getOpacityForTile(o)),u[0]>=Nn||u[1]>=Nn}setupDepthForOcclusion(o,u,_){const w=this.context,T=w.gl,C=!!_;var z;_||(_={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),w.activeTexture.set(T.TEXTURE3),o&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),_.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],_.u_depth_range_unpack=[2/((z=this.depthRangeFor3D)[1]-z[0]),-1-2*z[0]/(z[1]-z[0])],_.u_occluder_half_size=.5*this.occlusionParams.occluderSize,_.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),w.activeTexture.set(T.TEXTURE0),C||u.setTerrainUniformValues(w,_)}}function Fm(y,o){let u=!1,_=null;const w=()=>{_=null,u&&(y(),_=setTimeout(w,o),u=!1)};return()=>(u=!0,_||w(),_)}class Og{constructor(o){this._hashName=o&&encodeURIComponent(o),i.aQ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Fm(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const o=this._map;if(!o)return"";const u=Fy(o);if(this._hashName){const _=this._hashName;let w=!1;const T=location.hash.slice(1).split("&").map(C=>{const z=C.split("=")[0];return z===_?(w=!0,`${z}=${u}`):C}).filter(C=>C);return w||T.push(`${_}=${u}`),`#${T.join("&")}`}return`#${u}`}_getCurrentHash(){const o=location.hash.replace("#","");if(this._hashName){let u;return o.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(u=_)}),(u&&u[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._map;if(!o)return!1;const u=this._getCurrentHash();if(u.length>=3&&!u.some(_=>isNaN(_))){const _=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(u[3]||0):o.getBearing();return o.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:_,pitch:+(u[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Fy(y,o){const u=y.getCenter(),_=Math.round(100*y.getZoom())/100,w=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,w),C=Math.round(u.lng*T)/T,z=Math.round(u.lat*T)/T,V=y.getBearing(),$=y.getPitch();let K=o?`/${C}/${z}/${_}`:`${_}/${z}/${C}`;return(V||$)&&(K+="/"+Math.round(10*V)/10),$&&(K+=`/${Math.round($)}`),K}const Vp={linearity:.3,easing:i.dB(0,0,.3,1)},il=i.l({deceleration:2500,maxSpeed:1400},Vp),dl=i.l({deceleration:20,maxSpeed:1400},Vp),Uy=i.l({deceleration:1e3,maxSpeed:360},Vp),qy=i.l({deceleration:1e3,maxSpeed:90},Vp);class Vy{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.q.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,u=i.q.now();for(;o.length>0&&u-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const u={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:T}of this._inertiaBuffer)u.zoom+=T.zoomDelta||0,u.bearing+=T.bearingDelta||0,u.pitch+=T.pitchDelta||0,T.panDelta&&u.pan._add(T.panDelta),T.around&&(u.around=T.around),T.pinchAround&&(u.pinchAround=T.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,w={};if(u.pan.mag()){const T=Hp(u.pan.mag(),_,i.l({},il,o||{}));w.offset=u.pan.mult(T.amount/u.pan.mag()),w.center=this._map.transform.center,$p(w,T)}if(u.zoom){const T=Hp(u.zoom,_,dl);w.zoom=this._map.transform.zoom+T.amount,$p(w,T)}if(u.bearing){const T=Hp(u.bearing,_,Uy);w.bearing=this._map.transform.bearing+i.ay(T.amount,-179,179),$p(w,T)}if(u.pitch){const T=Hp(u.pitch,_,qy);w.pitch=this._map.transform.pitch+T.amount,$p(w,T)}if(w.zoom||w.bearing){const T=u.pinchAround===void 0?u.around:u.pinchAround;w.around=T?this._map.unproject(T):this._map.getCenter()}return this.clear(),w.noMoveStart=!0,w}}function $p(y,o){(!y.duration||y.duration<o.duration)&&(y.duration=o.duration,y.easing=o.easing)}function Hp(y,o,u){const{maxSpeed:_,linearity:w,deceleration:T}=u,C=i.ay(y*w/(o/1e3),-_,_),z=Math.abs(C)/(T*w);return{easing:u.easing,duration:1e3*z,amount:C*(z/2)}}class pl extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u,_,w={}){const T=be(u.getCanvasContainer(),_),C=u.unproject(T);super(o,i.l({point:T,lngLat:C,originalEvent:_},w)),this._defaultPrevented=!1,this.target=u}}class Qd extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u,_){const w=o==="touchend"?_.changedTouches:_.touches,T=Ae(u.getCanvasContainer(),w),C=T.map(V=>u.unproject(V)),z=T.reduce((V,$,K,ee)=>V.add($.div(ee.length)),new i.P(0,0));super(o,{points:T,point:z,lngLats:C,lngLat:u.unproject(z),originalEvent:_}),this._defaultPrevented=!1}}class $y extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u){super("wheel",{originalEvent:u}),this._defaultPrevented=!1}}class Hy{constructor(o,u){this._map=o,this._clickTolerance=u.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new $y(this._map,o))}mousedown(o,u){return this._mousedownPos=u,this._firePreventable(new pl(o.type,this._map,o))}mouseup(o){this._map.fire(new pl(o.type,this._map,o))}preclick(o){const u=i.l({},o);u.type="preclick",this._map.fire(new pl(u.type,this._map,u))}click(o,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(o),this._map.fire(new pl(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new pl(o.type,this._map,o))}mouseover(o){this._map.fire(new pl(o.type,this._map,o))}mouseout(o){this._map.fire(new pl(o.type,this._map,o))}touchstart(o){return this._firePreventable(new Qd(o.type,this._map,o))}touchmove(o){this._map.fire(new Qd(o.type,this._map,o))}touchend(o){this._map.fire(new Qd(o.type,this._map,o))}touchcancel(o){this._map.fire(new Qd(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Sv{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new pl(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new pl("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new pl(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Gy{constructor(o,u){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,u){this.isEnabled()&&o.shiftKey&&o.button===0&&(ge(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(o,u){if(!this._active)return;const _=u,w=this._startPos,T=this._lastPos;if(!w||!T||T.equals(_)||!this._box&&_.dist(w)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=G("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const C=Math.min(w.x,_.x),z=Math.max(w.x,_.x),V=Math.min(w.y,_.y),$=Math.max(w.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${C}px,${V}px)`,this._box.style.width=z-C+"px",this._box.style.height=$-V+"px")})}mouseupWindow(o,u){if(!this._active)return;const _=this._startPos,w=u;if(_&&o.button===0){if(this.reset(),pe(),_.x!==w.x||_.y!==w.y)return this._map.fire(new i.A("boxzoomend",{originalEvent:o})),{cameraAnimation:T=>T.fitScreenCoordinates(_,w,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),fe(),delete this._startPos,delete this._lastPos}_fireEvent(o,u){return this._map.fire(new i.A(o,{originalEvent:u}))}}function Da(y,o){const u={};for(let _=0;_<y.length;_++)u[y[_].identifier]=o[_];return u}class Rg{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,u,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=o.timeStamp),_.length===this.numTouches&&(this.centroid=function(w){const T=new i.P(0,0);for(const C of w)T._add(C);return T.div(w.length)}(u),this.touches=Da(_,u)))}touchmove(o,u,_){if(this.aborted||!this.centroid)return;const w=Da(_,u);for(const T in this.touches){const C=w[T];(!C||C.dist(this.touches[T])>30)&&(this.aborted=!0)}}touchend(o,u,_){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const w=!this.aborted&&this.centroid;if(this.reset(),w)return w}}}class Dg{constructor(o){this.singleTap=new Rg(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,u,_){this.singleTap.touchstart(o,u,_)}touchmove(o,u,_){this.singleTap.touchmove(o,u,_)}touchend(o,u,_){const w=this.singleTap.touchend(o,u,_);if(w){const T=o.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(w)<30;if(T&&C||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=w,this.count===this.numTaps)return this.reset(),w}}}class Wy{constructor(){this._zoomIn=new Dg({numTouches:1,numTaps:2}),this._zoomOut=new Dg({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,u,_){this._zoomIn.touchstart(o,u,_),this._zoomOut.touchstart(o,u,_)}touchmove(o,u,_){this._zoomIn.touchmove(o,u,_),this._zoomOut.touchmove(o,u,_)}touchend(o,u,_){const w=this._zoomIn.touchend(o,u,_),T=this._zoomOut.touchend(o,u,_);return w?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()+1,around:C.unproject(w)},{originalEvent:o})}):T?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()-1,around:C.unproject(T)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const ep={0:1,2:2},Um={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Gp{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,u){return!1}_move(o,u){return{}}mousedown(o,u){if(this._lastPoint)return;const _=Oe(o);this._correctButton(o,_)&&(this._lastPoint=u,this._eventButton=_)}mousemoveWindow(o,u){const _=this._lastPoint;if(_){if(o.preventDefault(),this._eventButton!=null&&function(w,T){const C=ep[T];return w.buttons===void 0||(w.buttons&C)!==C}(o,this._eventButton))this.reset();else if(this._moved||!(u.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(_,u)}}mouseupWindow(o){this._lastPoint&&Oe(o)===this._eventButton&&(this._moved&&pe(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wp extends Gp{mousedown(o,u){super.mousedown(o,u),this._lastPoint&&(this._active=!0)}_correctButton(o,u){return u===0&&!o.ctrlKey}_move(o,u){return{around:u,panDelta:u.sub(o)}}}class Bh extends Gp{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?Um[o.pitchRotateKey]:void 0}_correctButton(o,u){return this._pitchRotateKey?u===0&&o[this._pitchRotateKey]:u===0&&o.ctrlKey||u===2}_move(o,u){const _=.8*(u.x-o.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class bu extends Gp{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?Um[o.pitchRotateKey]:void 0}_correctButton(o,u){return this._pitchRotateKey?u===0&&o[this._pitchRotateKey]:u===0&&o.ctrlKey||u===2}_move(o,u){const _=-.5*(u.y-o.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class ps{constructor(o,u){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),i.aQ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(o,u,_){return this._calculateTransform(o,u,_)}touchmove(o,u,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(_.length===1&&!i.dC())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.cancelable&&o.preventDefault(),this._calculateTransform(o,u,_)}}touchend(o,u,_){this._calculateTransform(o,u,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,u,_){_.length>0&&(this._active=!0);const w=Da(_,u),T=new i.P(0,0),C=new i.P(0,0);let z=0;for(const $ in w){const K=w[$],ee=this._touches[$];ee&&(T._add(K),C._add(K.sub(ee)),z++,w[$]=K)}if(this._touches=w,z<this._minTouches||!C.mag())return;const V=C.div(z);return this._sum._add(V),this._sum.mag()<this._clickTolerance?void 0:{around:T.div(z),panDelta:V}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=G("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Zu{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,u,_){return{}}touchstart(o,u,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([u[0],u[1]]))}touchmove(o,u,_){const w=this._firstTwoTouches;if(!w)return;o.preventDefault();const[T,C]=w,z=tp(_,u,T),V=tp(_,u,C);if(!z||!V)return;const $=this._aroundCenter?null:z.add(V).div(2);return this._move([z,V],$,o)}touchend(o,u,_){if(!this._firstTwoTouches)return;const[w,T]=this._firstTwoTouches,C=tp(_,u,w),z=tp(_,u,T);C&&z||(this._active&&pe(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function tp(y,o,u){for(let _=0;_<y.length;_++)if(y[_].identifier===u)return o[_]}function np(y,o){return Math.log(y/o)/Math.LN2}class xd extends Zu{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,u){const _=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(np(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:np(this._distance,_),pinchAround:u}}}function mf(y,o){return 180*y.angleWith(o)/Math.PI}class Ju extends Zu{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,u){const _=this._vector;if(this._vector=o[0].sub(o[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:mf(this._vector,_),pinchAround:u}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const u=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;const w=mf(o,_);return Math.abs(w)<u}}function jh(y){return Math.abs(y.y)>Math.abs(y.x)}class Ky extends Zu{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,jh(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,u,_){const w=this._lastPoints;if(!w)return;const T=o[0].sub(w[0]),C=o[1].sub(w[1]);return this._map._cooperativeGestures&&!i.dC()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(T,C,_.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(T.y+C.y)/2*-.5})}gestureBeginsVertically(o,u,_){if(this._valid!==void 0)return this._valid;const w=o.mag()>=2,T=u.mag()>=2;if(!w&&!T)return;if(!w||!T)return this._firstMove==null&&(this._firstMove=_),_-this._firstMove<100&&void 0;const C=o.y>0==u.y>0;return jh(o)&&jh(u)&&C}}const qm={panStep:100,bearingStep:15,pitchStep:10};class rp{constructor(){const o=qm;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let u=0,_=0,w=0,T=0,C=0;switch(o.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:o.shiftKey?_=-1:(o.preventDefault(),T=-1);break;case 39:o.shiftKey?_=1:(o.preventDefault(),T=1);break;case 38:o.shiftKey?w=1:(o.preventDefault(),C=-1);break;case 40:o.shiftKey?w=-1:(o.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(_=0,w=0),{cameraAnimation:z=>{const V=z.getZoom();z.easeTo({duration:300,easeId:"keyboardHandler",easing:wd,zoom:u?Math.round(V)+u*(o.shiftKey?2:1):V,bearing:z.getBearing()+_*this._bearingStep,pitch:z.getPitch()+w*this._pitchStep,offset:[-T*this._panStep,-C*this._panStep],center:z.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function wd(y){return y*(2-y)}const xu=4.000244140625,Gs=1/450;class Wc{constructor(o,u){this._map=o,this._el=o.getCanvasContainer(),this._handler=u,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Gs,i.aQ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||i.dC()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const _=i.q.now(),w=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,u!==0&&u%xu==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":w>400?(this._type=null,this._lastValue=u,this._timeout=window.setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(w*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),o.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=o,this._delta-=u,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=be(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform;this._type==="wheel"&&o.projection.wrap&&(o._center.lng>=180||o._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const u=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(this._delta!==0){const $=this._type==="wheel"&&Math.abs(this._delta)>xu?this._wheelZoomRate:this._defaultZoomRate;let K=2/(1+Math.exp(-Math.abs(this._delta*$)));this._delta<0&&K!==0&&(K=1/K);const ee=u(),te=Math.pow(2,ee),ce=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):te;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(ce*K))),this._type==="wheel"&&(this._startZoom=ee,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const _=typeof this._targetZoom=="number"?this._targetZoom:u(),w=this._startZoom,T=this._easing;let C,z=!1;if(this._type==="wheel"&&w&&T){const $=Math.min((i.q.now()-this._lastWheelEventTime)/200,1),K=T($);C=i.ah(w,_,K),$<1?this._frameId||(this._frameId=!0):z=!0}else C=_,z=!0;this._active=!0,z&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let V=C-u();return V*this._lastDelta<0&&(V=0),{noInertia:!0,needsRenderFrame:!z,zoomDelta:V,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let u=i.dD;if(this._prevEase){const _=this._prevEase,w=(i.q.now()-_.start)/_.duration,T=_.easing(w+.01)-_.easing(w),C=.27/Math.sqrt(T*T+1e-4)*.01,z=Math.sqrt(.0729-C*C);u=i.dB(C,z,.25,1)}return this._prevEase={start:i.q.now(),duration:o,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=G("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Vf{constructor(o,u){this._clickZoom=o,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Kc{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,u){return o.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(o.shiftKey?-1:1),around:_.unproject(u)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gf{constructor(){this._tap=new Dg({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,u,_){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=u[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(o,u,_))}touchmove(o,u,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const w=u[0],T=w.y-this._swipePoint.y;return this._swipePoint=w,o.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(o,u,_)}touchend(o,u,_){this._tapTime?this._swipePoint&&_.length===0&&this.reset():this._tap.touchend(o,u,_)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yy{constructor(o,u,_){this._el=o,this._mousePan=u,this._touchPan=_}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Sd{constructor(o,u,_){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=u,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ad{constructor(o,u,_,w){this._el=o,this._touchZoom=u,this._touchRotate=_,this._tapDragZoom=w,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Td=y=>y.zoom||y.drag||y.pitch||y.rotate;class Lg extends i.A{}class ml{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,u){const _=i.ad.vec3.sub([],u,o);this.radius=i.ad.vec3.length(_[2]<0?i.ad.vec3.div([],_,this.constants):[_[0],_[1],0])}projectRay(o){i.ad.vec3.div(o,o,this.constants),i.ad.vec3.normalize(o,o),i.ad.vec3.mul(o,o,this.constants);const u=i.ad.vec3.scale([],o,this.radius);if(u[2]>0){const _=i.ad.vec3.scale([],[0,0,1],i.ad.vec3.dot(u,[0,0,1])),w=i.ad.vec3.scale([],i.ad.vec3.normalize([],[u[0],u[1],0]),this.radius),T=i.ad.vec3.add([],u,i.ad.vec3.scale([],i.ad.vec3.sub([],i.ad.vec3.add([],w,_),u),2));u[0]=T[0],u[1]=T[1]}return u}}function yf(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class Kp{constructor(o,u){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Vy(o),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ml,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),i.aQ(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(const[w,T,C]of this._listeners){const z=w===document?this.handleWindowEvent:this.handleEvent;w.addEventListener(T,z,C)}}destroy(){for(const[o,u,_]of this._listeners){const w=o===document?this.handleWindowEvent:this.handleEvent;o.removeEventListener(u,w,_)}}_addDefaultHandlers(o){const u=this._map,_=u.getCanvasContainer();this._add("mapEvent",new Hy(u,o));const w=u.boxZoom=new Gy(u,o);this._add("boxZoom",w);const T=new Wy,C=new Kc;u.doubleClickZoom=new Vf(C,T),this._add("tapZoom",T),this._add("clickZoom",C);const z=new gf;this._add("tapDragZoom",z);const V=u.touchPitch=new Ky(u);this._add("touchPitch",V);const $=new Bh(o),K=new bu(o);u.dragRotate=new Sd(o,$,K),this._add("mouseRotate",$,["mousePitch"]),this._add("mousePitch",K,["mouseRotate"]);const ee=new Wp(o),te=new ps(u,o);u.dragPan=new Yy(_,ee,te),this._add("mousePan",ee),this._add("touchPan",te,["touchZoom","touchRotate"]);const ce=new Ju,Te=new xd;u.touchZoomRotate=new Ad(_,Te,ce,z),this._add("touchRotate",ce,["touchPan","touchZoom"]),this._add("touchZoom",Te,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Sv(u));const ve=u.scrollZoom=new Wc(u,this);this._add("scrollZoom",ve,["mousePan"]);const Ce=u.keyboard=new rp;this._add("keyboard",Ce);for(const Pe of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[Pe]&&u[Pe].enable(o[Pe])}_add(o,u,_){this._handlers.push({handlerName:o,handler:u,allowed:_}),this._handlersById[o]=u}stop(o){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Td(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(o,u,_){for(const w in o)if(w!==_&&(!u||u.indexOf(w)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const u=[];for(const _ of o)this._el.contains(_.target)&&u.push(_);return u}handleEvent(o,u){this._updatingCamera=!0;const _=o.type==="renderFrame",w=_?void 0:o,T={needsRenderFrame:!1},C={},z={},V=o.touches?this._getMapTouches(o.touches):void 0,$=V?Ae(this._el,V):_?void 0:be(this._el,o);for(const{handlerName:te,handler:ce,allowed:Te}of this._handlers){if(!ce.isEnabled())continue;let ve;this._blockedByActive(z,Te,te)?ce.reset():ce[u||o.type]&&(ve=ce[u||o.type](o,$,V),this.mergeHandlerResult(T,C,ve,te,w),ve&&ve.needsRenderFrame&&this._triggerRenderFrame()),(ve||ce.isActive())&&(z[te]=ce)}const K={};for(const te in this._previousActiveHandlers)z[te]||(K[te]=w);this._previousActiveHandlers=z,(Object.keys(K).length||yf(T))&&(this._changes.push([T,C,K]),this._triggerRenderFrame()),(Object.keys(z).length||yf(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ee}=T;ee&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ee(this._map))}mergeHandlerResult(o,u,_,w,T){if(!_)return;i.l(o,_);const C={handlerName:w,originalEvent:_.originalEvent||T};_.zoomDelta!==void 0&&(u.zoom=C),_.panDelta!==void 0&&(u.drag=C),_.pitchDelta!==void 0&&(u.pitch=C),_.bearingDelta!==void 0&&(u.rotate=C)}_applyChanges(){const o={},u={},_={};for(const[w,T,C]of this._changes)w.panDelta&&(o.panDelta=(o.panDelta||new i.P(0,0))._add(w.panDelta)),w.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+w.zoomDelta),w.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+w.bearingDelta),w.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+w.pitchDelta),w.around!==void 0&&(o.around=w.around),w.aroundCoord!==void 0&&(o.aroundCoord=w.aroundCoord),w.pinchAround!==void 0&&(o.pinchAround=w.pinchAround),w.noInertia&&(o.noInertia=w.noInertia),i.l(u,T),i.l(_,C);this._updateMapTransform(o,u,_),this._changes=[]}_updateMapTransform(o,u,_){const w=this._map,T=w.transform,C=qe=>[qe.x,qe.y,qe.z];if((qe=>{const Je=this._eventsInProgress.drag;return Je&&!this._handlersById[Je.handlerName].isActive()})()&&!yf(o)){const qe=T.zoom;T.cameraElevationReference="sea",this._originalZoom!=null&&T._orthographicProjectionAtLowPitch&&T.projection.name!=="globe"&&T.pitch===0?(T.cameraElevationReference="ground",T.zoom=this._originalZoom):(T.recenterOnTerrain(),T.cameraElevationReference="ground"),qe!==T.zoom&&this._map._update(!0)}if(T._isCameraConstrained&&w._stop(!0),!yf(o))return void this._fireEvents(u,_,!0);let{panDelta:z,zoomDelta:V,bearingDelta:$,pitchDelta:K,around:ee,aroundCoord:te,pinchAround:ce}=o;T._isCameraConstrained&&(V>0&&(V=0),T._isCameraConstrained=!1),ce!==void 0&&(ee=ce),(V||(qe=>u[qe]&&!this._eventsInProgress[qe])("drag"))&&ee&&(this._dragOrigin=C(T.pointCoordinate3D(ee)),this._originalZoom=T.zoom,this._trackingEllipsoid.setup(T._camera.position,this._dragOrigin)),T.cameraElevationReference="sea",w._stop(!0),ee=ee||w.transform.centerPoint,$&&(T.bearing+=$),K&&(T.pitch+=K),T._updateCameraState();const Te=[0,0,0];if(z)if(T.projection.name==="mercator"){const qe=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(ee).dir),Je=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(ee.sub(z)).dir);Te[0]=Je[0]-qe[0],Te[1]=Je[1]-qe[1]}else{const qe=T.pointCoordinate(ee);if(T.projection.name==="globe"){z=z.rotate(-T.angle);const Je=T._pixelsPerMercatorPixel/T.worldSize;Te[0]=-z.x*i.dE(i.aT(qe.y))*Je,Te[1]=-z.y*i.dE(T.center.lat)*Je}else{const Je=T.pointCoordinate(ee.sub(z));qe&&Je&&(Te[0]=Je.x-qe.x,Te[1]=Je.y-qe.y)}}const ve=T.zoom,Ce=[0,0,0];if(V){const qe=C(te||T.pointCoordinate3D(ee)),Je={dir:i.ad.vec3.normalize([],i.ad.vec3.sub([],qe,T._camera.position))};if(Je.dir[2]<0){const Ye=T.zoomDeltaToMovement(qe,V);i.ad.vec3.scale(Ce,Je.dir,Ye)}}const Pe=i.ad.vec3.add(Te,Te,Ce);T._translateCameraConstrained(Pe),V&&Math.abs(T.zoom-ve)>1e-4&&T.recenterOnTerrain(),T.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(u,_,!0)}_fireEvents(o,u,_){const w=Td(this._eventsInProgress),T=Td(o),C={};for(const K in o){const{originalEvent:ee}=o[K];this._eventsInProgress[K]||(C[`${K}start`]=ee),this._eventsInProgress[K]=o[K]}!w&&T&&this._fireEvent("movestart",T.originalEvent);for(const K in C)this._fireEvent(K,C[K]);T&&this._fireEvent("move",T.originalEvent);for(const K in o){const{originalEvent:ee}=o[K];this._fireEvent(K,ee)}const z={};let V;for(const K in this._eventsInProgress){const{handlerName:ee,originalEvent:te}=this._eventsInProgress[K];this._handlersById[ee].isActive()||(delete this._eventsInProgress[K],V=u[ee]||te,z[`${K}end`]=V)}for(const K in z)this._fireEvent(K,z[K]);const $=Td(this._eventsInProgress);if(_&&(w||T)&&!$){this._updatingCamera=!0;const K=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ee=te=>te!==0&&-this._bearingSnap<te&&te<this._bearingSnap;K?(ee(K.bearing||this._map.getBearing())&&(K.bearing=0),this._map.easeTo(K,{originalEvent:V})):(this._map.fire(new i.A("moveend",{originalEvent:V})),ee(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,u){this._map.fire(new i.A(o,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new Lg("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Xy="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ip extends i.E{constructor(o,u){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=u.bearingSnap,this._respectPrefersReducedMotion=u.respectPrefersReducedMotion!==!1,i.aQ(["_renderFrameCallback"],this)}getCenter(){return new i.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(o,u){return this.jumpTo({center:o},u)}panBy(o,u,_){return o=i.P.convert(o).mult(-1),this.panTo(this.transform.center,i.l({offset:o},u),_)}panTo(o,u,_){return this.easeTo(i.l({center:o},u),_)}getZoom(){return this.transform.zoom}setZoom(o,u){return this.jumpTo({zoom:o},u),this}zoomTo(o,u,_){return this.easeTo(i.l({zoom:o},u),_)}zoomIn(o,u){return this.zoomTo(this.getZoom()+1,o,u),this}zoomOut(o,u){return this.zoomTo(this.getZoom()-1,o,u),this}getBearing(){return this.transform.bearing}setBearing(o,u){return this.jumpTo({bearing:o},u),this}getPadding(){return this.transform.padding}setPadding(o,u){return this.jumpTo({padding:o},u),this}rotateTo(o,u,_){return this.easeTo(i.l({bearing:o},u),_)}resetNorth(o,u){return this.rotateTo(0,i.l({duration:1e3},o),u),this}resetNorthPitch(o,u){return this.easeTo(i.l({bearing:0,pitch:0,duration:1e3},o),u),this}snapToNorth(o,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,u):this}getPitch(){return this.transform.pitch}setPitch(o,u){return this.jumpTo({pitch:o},u),this}cameraForBounds(o,u){o=i.aB.convert(o);const _=u&&u.bearing||0,w=u&&u.pitch||0,T=o.getNorthWest(),C=o.getSouthEast();return this._cameraForBounds(this.transform,T,C,_,w,u)}_extendPadding(o){const u={top:0,right:0,bottom:0,left:0};return o==null?i.l({},u,this.transform.padding):typeof o=="number"?{top:o,bottom:o,right:o,left:o}:i.l({},u,o)}_extendCameraOptions(o){return(o=i.l({offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=this._extendPadding(o.padding),o}_minimumAABBFrustumDistance(o,u){const _=u.max[0]-u.min[0],w=u.max[1]-u.min[1];return _/w>o.aspect?_/(2*Math.tan(.5*o.fovX)*o.aspect):w/(2*Math.tan(.5*o.fovY)*o.aspect)}_cameraForBoundsOnGlobe(o,u,_,w,T,C){const z=o.clone(),V=this._extendCameraOptions(C);z.bearing=w,z.pitch=T;const $=i.bO.convert(u),K=i.bO.convert(_),ee=.5*($.lat+K.lat),te=.5*($.lng+K.lng),ce=i.dF(ee,te),Te=i.ad.vec3.normalize([],ce),ve=i.ad.vec3.normalize([],i.ad.vec3.cross([],Te,[0,1,0])),Ce=i.ad.vec3.cross([],ve,Te),Pe=[ve[0],ve[1],ve[2],0,Ce[0],Ce[1],Ce[2],0,Te[0],Te[1],Te[2],0,0,0,0,1],qe=[ce,i.dF($.lat,$.lng),i.dF(K.lat,$.lng),i.dF(K.lat,K.lng),i.dF($.lat,K.lng),i.dF(ee,$.lng),i.dF(ee,K.lng),i.dF($.lat,te),i.dF(K.lat,te)];let Je=i.ce.fromPoints(qe.map(Qt=>[i.ad.vec3.dot(ve,Qt),i.ad.vec3.dot(Ce,Qt),i.ad.vec3.dot(Te,Qt)]));const Ye=i.ad.vec3.transformMat4([],Je.center,Pe);i.ad.vec3.squaredLength(Ye)===0&&i.ad.vec3.set(Ye,0,0,1),i.ad.vec3.normalize(Ye,Ye),i.ad.vec3.scale(Ye,Ye,i.az),z.center=i.dG(Ye);const lt=z.getWorldToCameraMatrix(),nt=i.ad.mat4.invert(new Float64Array(16),lt);Je=i.ce.applyTransform(Je,i.ad.mat4.multiply([],lt,Pe));const rt=this._extendAABB(Je,z,V,w);if(!rt)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Je=rt,i.ad.vec3.transformMat4(Ye,Ye,lt);const it=.5*(Je.max[2]-Je.min[2]),dt=this._minimumAABBFrustumDistance(z,Je),xt=i.ad.vec3.scale([],[0,0,1],it),Xt=i.ad.vec3.add(xt,Ye,xt),zt=dt+(z.pitch===0?0:i.ad.vec3.distance(Ye,Xt)),tn=z.globeCenterInViewSpace,un=i.ad.vec3.sub([],Ye,[tn[0],tn[1],tn[2]]);i.ad.vec3.normalize(un,un),i.ad.vec3.scale(un,un,zt);const Tn=i.ad.vec3.add([],Ye,un);i.ad.vec3.transformMat4(Tn,Tn,nt);const Lt=i.dv/i.az,an=i.ad.vec3.length(Tn),Pt=i.bH(Math.max(an*Lt-i.dv,Number.EPSILON),0),sn=Math.min(z.zoomFromMercatorZAdjusted(Pt),V.maxZoom);return sn>.5*(i.c6+i.bY)?(z.setProjection({name:"mercator"}),z.zoom=sn,this._cameraForBounds(z,u,_,w,T,C)):{center:z.center,zoom:sn,bearing:w,pitch:T}}_extendAABB(o,u,_,w){const T=.5*((_.padding.left||0)+(_.padding.right||0)),C=.5*((_.padding.top||0)+(_.padding.bottom||0)),z=C,V=T,$=T,K=C,ee=u.width-(V+$),te=u.height-(z+K),ce=i.ad.vec3.sub([],o.max,o.min),Te=Math.min(ee/ce[0],te/ce[1]),ve=Math.min(u.scaleZoom(u.scale*Te),_.maxZoom);if(isNaN(ve))return null;const Ce=u.scale/u.zoomScale(ve),Pe=new i.ce([o.min[0]-V*Ce,o.min[1]-K*Ce,o.min[2]],[o.max[0]+$*Ce,o.max[1]+z*Ce,o.max[2]]),qe=(typeof _.offset.x=="number"&&typeof _.offset.y=="number"?new i.P(_.offset.x,_.offset.y):i.P.convert(_.offset)).rotate(-i.ak(w));return Pe.center[0]-=qe.x*Ce,Pe.center[1]+=qe.y*Ce,Pe}queryTerrainElevation(o,u){const _=this.transform.elevation;return _?(u=i.l({},{exaggerated:!0},u),_.getAtPoint(i.ac.fromLngLat(o),null,u.exaggerated)):null}_cameraForBounds(o,u,_,w,T,C){if(o.projection.name==="globe")return this._cameraForBoundsOnGlobe(o,u,_,w,T,C);const z=o.clone(),V=this._extendCameraOptions(C);z.bearing=w,z.pitch=T;const $=i.bO.convert(u),K=i.bO.convert(_),ee=new i.bO($.lng,K.lat),te=new i.bO(K.lng,$.lat),ce=z.project($),Te=z.project(K),ve=this.queryTerrainElevation($),Ce=this.queryTerrainElevation(K),Pe=this.queryTerrainElevation(ee),qe=this.queryTerrainElevation(te),Je=[[ce.x,ce.y,Math.min(ve||0,Ce||0,Pe||0,qe||0)],[Te.x,Te.y,Math.max(ve||0,Ce||0,Pe||0,qe||0)]];let Ye=i.ce.fromPoints(Je);const lt=z.getWorldToCameraMatrix(),nt=i.ad.mat4.invert(new Float64Array(16),lt);Ye=i.ce.applyTransform(Ye,lt);const rt=this._extendAABB(Ye,z,V,w);if(!rt)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Ye=rt;const it=.5*i.ad.vec3.sub([],Ye.max,Ye.min)[2],dt=this._minimumAABBFrustumDistance(z,Ye),xt=[0,0,1,0];i.ad.vec4.transformMat4(xt,xt,lt),i.ad.vec4.normalize(xt,xt);const Xt=i.ad.vec3.scale([],xt,dt+it),zt=i.ad.vec3.add([],Ye.center,Xt);i.ad.vec3.transformMat4(Ye.center,Ye.center,nt),i.ad.vec3.transformMat4(zt,zt,nt);const tn=z.unproject(new i.P(Ye.center[0],Ye.center[1])),un=i.dH(z.projection,tn),Tn=Math.pow(2,un),Lt=Math.min(z._zoomFromMercatorZ(zt[2]*z.pixelsPerMeter*Tn/z.worldSize),V.maxZoom);return z.mercatorFromTransition&&Lt<.5*(i.c6+i.bY)?(z.setProjection({name:"globe"}),z.zoom=Lt,this._cameraForBounds(z,u,_,w,T,C)):{center:tn,zoom:Lt,bearing:w,pitch:T}}fitBounds(o,u,_){const w=this.cameraForBounds(o,u);return this._fitInternal(w,u,_)}fitScreenCoordinates(o,u,_,w,T){const C=i.P.convert(o),z=i.P.convert(u),V=new i.P(Math.min(C.x,z.x),Math.min(C.y,z.y)),$=new i.P(Math.max(C.x,z.x),Math.max(C.y,z.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(C,z))return this;const K=this.transform.pointLocation3D(V),ee=this.transform.pointLocation3D($),te=this.transform.pointLocation3D(new i.P(V.x,$.y)),ce=this.transform.pointLocation3D(new i.P($.x,V.y)),Te=[Math.min(K.lng,ee.lng,te.lng,ce.lng),Math.min(K.lat,ee.lat,te.lat,ce.lat)],ve=[Math.max(K.lng,ee.lng,te.lng,ce.lng),Math.max(K.lat,ee.lat,te.lat,ce.lat)],Ce=w&&w.pitch?w.pitch:this.getPitch(),Pe=this._cameraForBounds(this.transform,Te,ve,_,Ce,w);return this._fitInternal(Pe,w,T)}_fitInternal(o,u,_){return o?(u=i.l(o,u)).linear?this.easeTo(u,_):this.flyTo(u,_):this}jumpTo(o,u){this.stop();const _=o.preloadOnly?this.transform.clone():this.transform;let w=!1,T=!1,C=!1;"zoom"in o&&_.zoom!==+o.zoom&&(w=!0,_.zoom=+o.zoom),o.center!==void 0&&(_.center=i.bO.convert(o.center)),"bearing"in o&&_.bearing!==+o.bearing&&(T=!0,_.bearing=+o.bearing),"pitch"in o&&_.pitch!==+o.pitch&&(C=!0,_.pitch=+o.pitch);const z=typeof o.padding=="number"?this._extendPadding(o.padding):o.padding;if(o.padding!=null&&!_.isPaddingEqual(z))if(o.retainPadding===!1){const V=_.clone();V.padding=z,_.setLocationAtPoint(_.center,V.centerPoint)}else _.padding=z;return o.preloadOnly?(this._preloadTiles(_),this):(this.fire(new i.A("movestart",u)).fire(new i.A("move",u)),w&&this.fire(new i.A("zoomstart",u)).fire(new i.A("zoom",u)).fire(new i.A("zoomend",u)),T&&this.fire(new i.A("rotatestart",u)).fire(new i.A("rotate",u)).fire(new i.A("rotateend",u)),C&&this.fire(new i.A("pitchstart",u)).fire(new i.A("pitch",u)).fire(new i.A("pitchend",u)),this.fire(new i.A("moveend",u)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(Xy),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,u){const _=this.transform;if(!_.projection.supportsFreeCamera)return i.w(Xy),this;this.stop();const w=_.zoom,T=_.pitch,C=_.bearing;_.setFreeCameraOptions(o);const z=w!==_.zoom,V=T!==_.pitch,$=C!==_.bearing;return this.fire(new i.A("movestart",u)).fire(new i.A("move",u)),z&&this.fire(new i.A("zoomstart",u)).fire(new i.A("zoom",u)).fire(new i.A("zoomend",u)),$&&this.fire(new i.A("rotatestart",u)).fire(new i.A("rotate",u)).fire(new i.A("rotateend",u)),V&&this.fire(new i.A("pitchstart",u)).fire(new i.A("pitch",u)).fire(new i.A("pitchend",u)),this.fire(new i.A("moveend",u)),this}easeTo(o,u){this._stop(!1,o.easeId),((o=i.l({offset:[0,0],duration:500,easing:i.dD},o)).animate===!1||this._prefersReducedMotion(o))&&(o.duration=0);const _=this.transform,w=this.getZoom(),T=this.getBearing(),C=this.getPitch(),z=this.getPadding(),V="zoom"in o?+o.zoom:w,$="bearing"in o?this._normalizeBearing(o.bearing,T):T,K="pitch"in o?+o.pitch:C,ee=this._extendPadding(o.padding),te=i.P.convert(o.offset);let ce,Te,ve;if(_.projection.name==="globe"){const xt=i.ac.fromLngLat(_.center),Xt=te.rotate(-_.angle);xt.x+=Xt.x/_.worldSize,xt.y+=Xt.y/_.worldSize;const zt=xt.toLngLat(),tn=i.bO.convert(o.center||zt);this._normalizeCenter(tn),ce=_.centerPoint.add(Xt),Te=new i.P(xt.x,xt.y).mult(_.worldSize),ve=new i.P(i.av(tn.lng),i.aC(tn.lat)).mult(_.worldSize).sub(Te)}else{ce=_.centerPoint.add(te);const xt=_.pointLocation(ce),Xt=i.bO.convert(o.center||xt);this._normalizeCenter(Xt),Te=_.project(xt),ve=_.project(Xt).sub(Te)}const Ce=_.zoomScale(V-w);let Pe,qe;o.around&&(Pe=i.bO.convert(o.around),qe=_.locationPoint(Pe));const Je=this._zooming||V!==w,Ye=this._rotating||T!==$,lt=this._pitching||K!==C,nt=!_.isPaddingEqual(ee),rt=o.retainPadding===!1?_.clone():_,it=xt=>Xt=>{if(Je&&(xt.zoom=i.ah(w,V,Xt)),Ye&&(xt.bearing=i.ah(T,$,Xt)),lt&&(xt.pitch=i.ah(C,K,Xt)),nt&&(rt.interpolatePadding(z,ee,Xt),ce=rt.centerPoint.add(te)),Pe)xt.setLocationAtPoint(Pe,qe);else{const zt=xt.zoomScale(xt.zoom-w),tn=V>w?Math.min(2,Ce):Math.max(.5,Ce),un=Math.pow(tn,1-Xt),Tn=xt.unproject(Te.add(ve.mult(Xt*un)).mult(zt));xt.setLocationAtPoint(xt.renderWorldCopies?Tn.wrap():Tn,ce)}return o.preloadOnly||this._fireMoveEvents(u),xt};if(o.preloadOnly){const xt=this._emulate(it,o.duration,_);return this._preloadTiles(xt),this}const dt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Je,this._rotating=Ye,this._pitching=lt,this._padding=nt,this._easeId=o.easeId,this._prepareEase(u,o.noMoveStart,dt),this._ease(it(_),xt=>{_.cameraElevationReference==="sea"&&_.recenterOnTerrain(),this._afterEase(u,xt)},o),this}_prepareEase(o,u,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),u||_.moving||this.fire(new i.A("movestart",o)),this._zooming&&!_.zooming&&this.fire(new i.A("zoomstart",o)),this._rotating&&!_.rotating&&this.fire(new i.A("rotatestart",o)),this._pitching&&!_.pitching&&this.fire(new i.A("pitchstart",o))}_fireMoveEvents(o){this.fire(new i.A("move",o)),this._zooming&&this.fire(new i.A("zoom",o)),this._rotating&&this.fire(new i.A("rotate",o)),this._pitching&&this.fire(new i.A("pitch",o))}_afterEase(o,u){if(this._easeId&&u&&this._easeId===u)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,w=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new i.A("zoomend",o)),w&&this.fire(new i.A("rotateend",o)),T&&this.fire(new i.A("pitchend",o)),this.fire(new i.A("moveend",o))}flyTo(o,u){if(this._prefersReducedMotion(o)){const Qt=i.aA(o,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Qt,u)}this.stop(),o=i.l({offset:[0,0],speed:1.2,curve:1.42,easing:i.dD},o);const _=this.transform,w=this.getZoom(),T=this.getBearing(),C=this.getPitch(),z=this.getPadding(),V="zoom"in o?i.ay(+o.zoom,_.minZoom,_.maxZoom):w,$="bearing"in o?this._normalizeBearing(o.bearing,T):T,K="pitch"in o?+o.pitch:C,ee=this._extendPadding(o.padding),te=_.zoomScale(V-w),ce=i.P.convert(o.offset);let Te=_.centerPoint.add(ce);const ve=_.pointLocation(Te),Ce=i.bO.convert(o.center||ve);this._normalizeCenter(Ce);const Pe=_.project(ve),qe=_.project(Ce).sub(Pe);let Je=o.curve;const Ye=Math.max(_.width,_.height),lt=Ye/te,nt=qe.mag();if("minZoom"in o){const Qt=i.ay(Math.min(o.minZoom,w,V),_.minZoom,_.maxZoom),fn=Ye/_.zoomScale(Qt-w);Je=Math.sqrt(fn/nt*2)}const rt=Je*Je;function it(Qt){const fn=(lt*lt-Ye*Ye+(Qt?-1:1)*rt*rt*nt*nt)/(2*(Qt?lt:Ye)*rt*nt);return Math.log(Math.sqrt(fn*fn+1)-fn)}function dt(Qt){return(Math.exp(Qt)-Math.exp(-Qt))/2}function xt(Qt){return(Math.exp(Qt)+Math.exp(-Qt))/2}const Xt=it(0);let zt=function(Qt){return xt(Xt)/xt(Xt+Je*Qt)},tn=function(Qt){return Ye*((xt(Xt)*(dt(fn=Xt+Je*Qt)/xt(fn))-dt(Xt))/rt)/nt;var fn},un=(it(1)-Xt)/Je;if(Math.abs(nt)<1e-6||!isFinite(un)){if(Math.abs(Ye-lt)<1e-6)return this.easeTo(o,u);const Qt=lt<Ye?-1:1;un=Math.abs(Math.log(lt/Ye))/Je,tn=function(){return 0},zt=function(fn){return Math.exp(Qt*Je*fn)}}o.duration="duration"in o?+o.duration:1e3*un/("screenSpeed"in o?+o.screenSpeed/Je:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);const Tn=T!==$,Lt=K!==C,an=!_.isPaddingEqual(ee),Pt=o.retainPadding===!1?_.clone():_,sn=Qt=>fn=>{const Wt=fn*un,mn=1/zt(Wt);Qt.zoom=fn===1?V:w+Qt.scaleZoom(mn),Tn&&(Qt.bearing=i.ah(T,$,fn)),Lt&&(Qt.pitch=i.ah(C,K,fn)),an&&(Pt.interpolatePadding(z,ee,fn),Te=Pt.centerPoint.add(ce));const zn=fn===1?Ce:Qt.unproject(Pe.add(qe.mult(tn(Wt))).mult(mn));return Qt.setLocationAtPoint(Qt.renderWorldCopies?zn.wrap():zn,Te),Qt._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(u),Qt};if(o.preloadOnly){const Qt=this._emulate(sn,o.duration,_);return this._preloadTiles(Qt),this}return this._zooming=!0,this._rotating=Tn,this._pitching=Lt,this._padding=an,this._prepareEase(u,!1),this._ease(sn(_),()=>this._afterEase(u),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(o){}_cancelRenderFrame(o){}_stop(o,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,u)}if(!o){const _=this.handlers;_&&_.stop(!1)}return this}_ease(o,u,_){_.animate===!1||_.duration===0?(o(1),u()):(this._easeStart=i.q.now(),this._easeOptions=_,this._onEaseFrame=o,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((i.q.now()-this._easeStart)/this._easeOptions.duration,1),u=this._onEaseFrame;u&&u(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,u){o=i.bF(o,-180,180);const _=Math.abs(o-u);return Math.abs(o-360-u)<_&&(o-=360),Math.abs(o+360-u)<_&&(o+=360),o}_normalizeCenter(o){const u=this.transform;if(u.maxBounds||u.projection.name!=="globe"&&!u.renderWorldCopies)return;const _=o.lng-u.center.lng;o.lng+=_>180?-360:_<-180?360:0}_prefersReducedMotion(o){return this._respectPrefersReducedMotion&&i.q.prefersReducedMotion&&!(o&&o.essential)}_emulate(o,u,_){const w=Math.ceil(15*u/1e3),T=[],C=o(_.clone());for(let z=0;z<=w;z++){const V=C(z/w);T.push(V.clone())}return T}_preloadTiles(o,u){}}class Ed{constructor(o={}){this.options=o,i.aQ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const u=this.options&&this.options.compact,_=o._getUIString("AttributionControl.ToggleAttribution");this._map=o,this._container=G("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=G("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",_);const w=G("span","mapboxgl-ctrl-icon",this._compactButton);return w.setAttribute("aria-hidden","true"),w.setAttribute("title",_),this._innerContainer=G("div","mapboxgl-ctrl-attrib-inner",this._container),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.e.ACCESS_TOKEN}];if(o){const _=u.reduce((w,T,C)=>(T.value&&(w+=`${T.key}=${T.value}${C<u.length-1?"&":""}`),w),"?");o.href=`${i.e.FEEDBACK_URL}/${_}#${Fy(this._map,!0)}`,o.rel="noopener nofollow"}}_updateData(o){!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){const w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}const u=this._map.style._mergedSourceCaches;for(const w in u){const T=u[w];if(T.used){const C=T.getSource();C.attribution&&o.indexOf(C.attribution)<0&&o.push(C.attribution)}}o.sort((w,T)=>w.length-T.length),o=o.filter((w,T)=>{for(let C=T+1;C<o.length;C++)if(o[C].indexOf(w)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));const _=o.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,o.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Fo{constructor(){i.aQ(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=G("div","mapboxgl-ctrl");const u=G("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&o.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(Object.entries(o).length===0)return!0;for(const u in o){const _=o[u].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const u=o[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class Yc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const u=++this._id;return this._queue.push({callback:o,id:u,cancelled:!1}),u}remove(o){const u=this._currentlyRunning,_=u?this._queue.concat(u):this._queue;for(const w of _)if(w.id===o)return void(w.cancelled=!0)}run(o=0){const u=this._currentlyRunning=this._queue;this._queue=[];for(const _ of u)if(!_.cancelled&&(_.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class ap{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const u=i.cC((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,u,_){this._start=this.getValue(u),this._end=o,this._startTime=u,this._endTime=u+_}}const wu={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class al extends i.A{constructor(o,u,_,w){const{point:T,lngLat:C,originalEvent:z,target:V}=o;super(o.type,{point:T,lngLat:C,originalEvent:z,target:V}),this.preventDefault=()=>{o.preventDefault()},this.id=u,this.interaction=_,this.feature=w}}class kg{constructor(o){this.map=o,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(o,u){if(this.typeById.has(o))throw new Error(`Interaction id "${o}" already exists.`);const _=u.filter;let w=u.type;_&&this.filters.set(o,i.a_(_)),w==="mouseover"&&(w="mouseenter"),w==="mouseout"&&(w="mouseleave");const T=this.interactionsByType.get(w)||new Map;w==="mouseenter"||w==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(o,u)):T.size===0&&this.map.on(w,this.handleType),T.size===0&&this.interactionsByType.set(w,T),T.set(o,u),this.typeById.set(o,w)}get(o){const u=this.typeById.get(o);if(!u)return;const _=this.interactionsByType.get(u);return _?_.get(o):void 0}remove(o){const u=this.typeById.get(o);if(!u)return;this.typeById.delete(o),this.filters.delete(o);const _=this.interactionsByType.get(u);_&&(_.delete(o),u==="mouseenter"||u==="mouseleave"?(this.delegatedInteractions.delete(o),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):_.size===0&&this.map.off(u,this.handleType))}queryTargets(o,u){const _=[];for(const[w,T]of u)T.target&&_.push({targetId:w,target:T.target,filter:this.filters.get(w)});return this.map.style.queryRenderedTargets(o,_,this.map.transform)}handleMove(o){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const u=this.queryTargets(o.point,Array.from(this.delegatedInteractions).reverse());u.length&&(o.type="mouseenter",this.handleType(o,u));const _=new Map;for(const[w,{feature:T}]of this.prevHoveredFeatures)this.hoveredFeatures.has(w)||_.set(T.id,T);_.size&&(o.type="mouseleave",this.handleType(o,Array.from(_.values())))}handleOut(o){const u=Array.from(this.hoveredFeatures.values()).map(({feature:_})=>_);u.length&&(o.type="mouseleave",this.handleType(o,u)),this.hoveredFeatures.clear()}handleType(o,u){const _=Array.from(this.interactionsByType.get(o.type)).reverse(),w=!!u;u=u||this.queryTargets(o.point,_);const T=o.type==="mouseenter";let C=!1;const z=new Set;for(const V of u){for(const[$,K]of _){if(!K.target)continue;const ee=V.variants?V.variants[$]:null;if(ee){for(const te of ee){if(Pu(te,V,z,$))continue;const ce=new i.cx(V,te),Te=gh(te,V,$);w&&(ce.state=this.map.getFeatureState(ce));const ve=T?this.prevHoveredFeatures.get(Te):null,Ce=new al(o,$,K,ce),Pe=ve?ve.stop:K.handler(Ce);if(T&&this.hoveredFeatures.set(Te,{feature:V,stop:Pe}),Pe!==!1){C=!0;break}}if(C)break}}if(C)break}if(!C)for(const[V,$]of _){const{handler:K,target:ee}=$;if(!ee&&K(new al(o,V,$,null))!==!1)break}}}function zi(y,o){if(Array.isArray(y)&&Array.isArray(o)){const u=new Set(y),_=new Set(o);return u.size===_.size&&y.every(w=>_.has(w))}return i.bn(y,o)}const $f={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Zy={showCompass:!0,showZoom:!0,visualizePitch:!1};class Jy{constructor(o,u,_=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new Bh({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,_&&(this.mousePitch=new bu({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),i.aQ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener("mousedown",this.mousedown),u.addEventListener("touchstart",this.touchstart,{passive:!1}),u.addEventListener("touchmove",this.touchmove),u.addEventListener("touchend",this.touchend),u.addEventListener("touchcancel",this.reset)}down(o,u){this.mouseRotate.mousedown(o,u),this.mousePitch&&this.mousePitch.mousedown(o,u),ge()}move(o,u){const _=this.map,w=this.mouseRotate.mousemoveWindow(o,u),T=w&&w.bearingDelta;if(T&&_.setBearing(_.getBearing()+T),this.mousePitch){const C=this.mousePitch.mousemoveWindow(o,u),z=C&&C.pitchDelta;z&&_.setPitch(_.getPitch()+z)}}off(){const o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart,{passive:!1}),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){fe(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(i.l({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),be(this.element,o)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,be(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ae(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=Ae(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function sp(y,o,u){if(y=new i.bO(y.lng,y.lat),o){const _=new i.bO(y.lng-360,y.lat),w=new i.bO(y.lng+360,y.lat),T=360*Math.ceil(Math.abs(y.lng-u.center.lng)/360),C=u.locationPoint3D(y).distSqr(o),z=o.x<0||o.y<0||o.x>u.width||o.y>u.height;u.locationPoint3D(_).distSqr(o)<C&&(z||Math.abs(_.lng-u.center.lng)<T)?y=_:u.locationPoint3D(w).distSqr(o)<C&&(z||Math.abs(w.lng-u.center.lng)<T)&&(y=w)}for(;Math.abs(y.lng-u.center.lng)>180;){const _=u.locationPoint3D(y);if(_.x>=0&&_.y>=0&&_.x<=u.width&&_.y<=u.height)break;y.lng>u.center.lng?y.lng-=360:y.lng+=360}return y}const gl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Ma={anchor:"center",color:"#3FB1CE",scale:1,draggable:!1,clickTolerance:0,rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Uo extends i.E{constructor(o,u){super(),(o instanceof HTMLElement||u)&&(o=i.l({element:o},u)),i.aQ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),o=i.l({},Ma,o),this._anchor=o.anchor,this._color=o.color,this._scale=o.scale,this._draggable=o.draggable,this._clickTolerance=o.clickTolerance,this._rotation=o.rotation,this._rotationAlignment=o.rotationAlignment,this._pitchAlignment=o.pitchAlignment,this._occludedOpacity=o.occludedOpacity,this._altitude=o.altitude,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),o&&o.element?(this._element=o.element,this._offset=i.P.convert(o&&o.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=i.P.convert(o&&o.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",T=>{T.preventDefault()}),this._element.addEventListener("mousedown",T=>{T.preventDefault()});const _=this._element.classList;for(const T in gl)_.remove(`mapboxgl-marker-anchor-${T}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`);const w=o&&o.className?o.className.trim().split(/\s+/):[];_.add(...w),this._popup=null}_createDefaultMarker(){const o=G("div"),u=W("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},o);if(this._altitude===0){const _=W("radialGradient",{id:"shadowGradient"},W("defs",{},u));W("stop",{offset:"10%","stop-opacity":.4},_),W("stop",{offset:"100%","stop-opacity":.05},_),W("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},u)}return W("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},u),W("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},u),W("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},u),o}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){const o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=i.bO.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(o){return o===this._altitude||(this._defaultMarker&&(this._altitude===0&&o!==0||this._altitude!==0&&o===0)&&(this._element=this._createDefaultMarker()),this._altitude=o||Ma.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const w=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[w,-1*(38.1-13.5+w)],"bottom-right":[-w,-1*(38.1-13.5+w)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,o._marker=this,o._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){const u=o.code,_=o.charCode||o.keyCode;u!=="Space"&&u!=="Enter"&&_!==32&&_!==13||this.togglePopup()}_onMapClick(o){const u=o.originalEvent.target,_=this._element;this._popup&&(u===_||_.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const o=this._map,u=this._pos;if(!o||!u)return!1;const _=o.unproject(u,this._altitude),w=o.getFreeCameraOptions();if(!w.position)return!1;const T=w.position.toLngLat();return T.distanceTo(_)<.9*T.distanceTo(this._lngLat)}_evaluateOpacity(){const o=this._map;if(!o)return;const u=this._pos;if(!u||u.x<0||u.x>o.transform.width||u.y<0||u.y>o.transform.height)return void this._clearFadeTimer();const _=o.unproject(u,this._altitude);let w;o._showingGlobe()&&i.dK(o.transform,this._lngLat)?w=0:(w=1-o._queryFogOpacity(_),o.transform._terrainEnabled()&&o.getTerrain()&&this._behindTerrain()&&(w*=this._occludedOpacity)),this._element.style.opacity=`${w}`,this._element.style.pointerEvents=w>0?"auto":"none",this._popup&&this._popup._setOpacity(w),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const o=this._pos;if(!o||!this._map)return;const u=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${o.x}px,${o.y}px)
            ${gl[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${u.x}px,${u.y}px)
        `}_calculateXYTransform(){const o=this._pos,u=this._map,_=this.getPitchAlignment();if(!u||!o||_!=="map")return"";if(!u._showingGlobe()){const V=u.getPitch();return V?`rotateX(${V}deg)`:""}const w=i.c4(i.dL(u.transform,this._lngLat)),T=o.sub(i.dM(u.transform)),C=Math.abs(T.x)+Math.abs(T.y);if(C===0)return"";const z=w/C;return`rotateX(${-T.y*z}deg) rotateY(${T.x*z}deg)`}_calculateZTransform(){const o=this._pos,u=this._map;if(!u||!o)return"";let _=0;const w=this.getRotationAlignment();if(w==="map")if(u._showingGlobe()){const T=u.project(new i.bO(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),C=u.project(new i.bO(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(T);_=i.c4(Math.atan2(C.y,C.x))-90}else _=-u.getBearing();else if(w==="horizon"){const T=i.ae(4,6,u.getZoom()),C=i.dM(u.transform);C.y+=T*u.transform.height;const z=o.sub(C),V=i.c4(Math.atan2(z.y,z.x));_=(V>90?V-270:V+90)*(1-T)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(o){cancelAnimationFrame(this._updateFrameId);const u=this._map;u&&(u.transform.renderWorldCopies&&(this._lngLat=sp(this._lngLat,this._pos,u.transform)),this._pos=u.project(this._lngLat,this._altitude),o===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),u._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(u._showingGlobe()||u.getTerrain()||u.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=i.P.convert(o),this._update(),this}addClassName(o){return this._element.classList.add(o),this}removeClassName(o){return this._element.classList.remove(o),this}toggleClassName(o){return this._element.classList.toggle(o)}_onMove(o){const u=this._map;if(!u)return;const _=this._pointerdownPos,w=this._positionDelta;if(_&&w){if(!this._isDragging){const T=this._clickTolerance||u._clickTolerance;if(o.point.dist(_)<T)return;this._isDragging=!0}this._pos=o.point.sub(w),this._lngLat=u.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.A("dragstart"))),this.fire(new i.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.A("dragend")),this._state="inactive"}_addDragHandler(o){const u=this._map,_=this._pos;u&&_&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(_),this._pointerdownPos=o.point,this._state="pending",u.on("mousemove",this._onMove),u.on("touchmove",this._onMove),u.once("mouseup",this._onUp),u.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;const u=this._map;return u&&(o?(u.on("mousedown",this._addDragHandler),u.on("touchstart",this._addDragHandler)):(u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||Ma.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||Ma.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o||Ma.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(o){return this._occludedOpacity=o||Ma.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Mc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},xa={maxWidth:100,unit:"metric"},Ng={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Cc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Qy=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Hf(y=new i.P(0,0),o="bottom"){if(typeof y=="number"){const u=Math.round(Math.sqrt(.5*Math.pow(y,2)));switch(o){case"top":return new i.P(0,y);case"top-left":return new i.P(u,u);case"top-right":return new i.P(-u,u);case"bottom":return new i.P(0,-y);case"bottom-left":return new i.P(u,-u);case"bottom-right":return new i.P(-u,-u);case"left":return new i.P(y,0);case"right":return new i.P(-y,0)}return new i.P(0,0)}return y instanceof i.P||Array.isArray(y)?i.P.convert(y):i.P.convert(y[o]||[0,0])}return{version:x,supported:H.supported,setRTLTextPlugin:i.dN,getRTLTextPluginStatus:i.dO,Map:class extends ip{constructor(y){I.mark(S.create);const o=y;if((y=i.l({},$f,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(y.antialias&&i.dI(window)&&(y.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Sh(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies,null,null),y),this._repaint=!!y.repaint,this._interactive=y.interactive,this._minTileCacheSize=y.minTileCacheSize,this._maxTileCacheSize=y.maxTileCacheSize,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=y.crossSourceCollisions,this._collectResourceTiming=y.collectResourceTiming,this._language=this._parseLanguage(y.language),this._worldview=y.worldview,this._renderTaskQueue=new Yc,this._domRenderTaskQueue=new Yc,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.aW(),this._locale=i.l({},wu,y.locale),this._clickTolerance=y.clickTolerance,this._cooperativeGestures=y.cooperativeGestures,this._performanceMetricsCollection=y.performanceMetricsCollection,this._tessellationStep=y.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=y.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new ap(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=y.scaleFactor,this._requestManager=new De(y.transformRequest,y.accessToken,y.testMode),this._silenceAuthErrors=!!y.testMode,this._contextCreateOptions=y.contextCreateOptions?Object.assign({},y.contextCreateOptions):{},typeof y.container=="string"){const u=document.getElementById(y.container);if(!u)throw new Error(`Container '${y.container.toString()}' not found.`);this._container=u}else{if(!(y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),y.maxBounds&&this.setMaxBounds(y.maxBounds),this._spriteFormat=y.spriteFormat,i.aQ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Tc),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Kp(this,y),this._localFontFamily=y.localFontFamily,this._localIdeographFontFamily=y.localIdeographFontFamily,(y.style||!y.testMode)&&this.setStyle(y.style||i.e.DEFAULT_STYLE,{config:y.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),y.projection&&this.setProjection(y.projection),this.indoor=new Lu(this),y.hash&&(this._hash=new Og(typeof y.hash=="string"&&y.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){o.center==null&&o.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch});const u=y.bounds;u&&(this.resize(),this.fitBounds(u,i.l({},y.fitBoundsOptions,{duration:0})))}this.resize(),y.attributionControl&&this.addControl(new Ed({customAttribution:y.customAttribution})),this._logoControl=new Fo,this.addControl(this._logoControl,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",u=>{this._update(u.dataType==="style"),this.fire(new i.A(`${u.dataType}data`,u))}),this.on("dataloading",u=>{this.fire(new i.A(`${u.dataType}dataloading`,u))}),this._interactions=new kg(this)}_getMapId(){return this._mapId}addControl(y,o){if(o===void 0&&(o=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new i.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=y.onAdd(this);this._controls.push(y);const _=this._controlPositions[o];return o.indexOf("bottom")!==-1?_.insertBefore(u,_.firstChild):_.appendChild(u),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new i.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(y);return o>-1&&this._controls.splice(o,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(y){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const o=!this._moving;return o&&this.fire(new i.A("movestart",y)).fire(new i.A("move",y)),this.fire(new i.A("resize",y)),o&&this.fire(new i.A("moveend",y)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(y){return this.transform.setMaxBounds(i.aB.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y?this.setZoom(y):this.fire(new i.A("zoomstart")).fire(new i.A("zoom")).fire(new i.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y?this.setZoom(y):this.fire(new i.A("zoomstart")).fire(new i.A("zoom")).fire(new i.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y?this.setPitch(y):this.fire(new i.A("pitchstart")).fire(new i.A("pitch")).fire(new i.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y?this.setPitch(y):this.fire(new i.A("pitchstart")).fire(new i.A("pitch")).fire(new i.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(y){return this._scaleFactor=y,this.painter.scaleFactor=y,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(o=>o.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(y){return y==="auto"?navigator.language:Array.isArray(y)?y.length===0?void 0:y.map(o=>o==="auto"?navigator.language:o):y}setLanguage(y){const o=this._parseLanguage(y);if(!this.style||o===this._language)return this;this._language=o,this.style.reloadSources();for(const u of this._controls)u._setLanguage&&u._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(y){return this.style&&y!==this._worldview?(this._worldview=y,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(y){return this._lazyInitEmptyStyle(),y?typeof y=="string"&&(y={name:y}):y=null,this._useExplicitProjection=!!y,this._prioritizeAndUpdateProjection(y,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const y=this.transform,o=y.projection.name;let u;o==="globe"&&y.zoom>=i.bY?(y.setMercatorFromTransition(),u=!0):o==="mercator"&&y.zoom<i.bY&&(y.setProjection({name:"globe"}),u=!0),u&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(y,o){return this._updateProjection(y||o||{name:"mercator"})}_updateProjection(y){let o;return o=y.name==="globe"&&this.transform.zoom>=i.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(y),this.style.applyProjectionUpdate(),o&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(y,o){return this.transform.locationPoint3D(i.bO.convert(y),o)}unproject(y,o){return this.transform.pointLocation3D(i.P.convert(y),o)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(y,o,u){const _=w=>{let T=[];if(Array.isArray(o)){const C=o.filter(z=>this.getLayer(z));T=C.length?this.queryRenderedFeatures(w,{layers:C}):[]}else T=this.queryRenderedFeatures(w,{target:o});return T};if(y==="mouseenter"||y==="mouseover"){let w=!1;return{listener:u,targets:o,delegates:{mousemove:C=>{const z=_(C.point);z.length?w||(w=!0,u.call(this,new pl(y,this,C.originalEvent,{features:z}))):w=!1},mouseout:()=>{w=!1}}}}if(y==="mouseleave"||y==="mouseout"){let w=!1;return{listener:u,targets:o,delegates:{mousemove:z=>{_(z.point).length?w=!0:w&&(w=!1,u.call(this,new pl(y,this,z.originalEvent)))},mouseout:z=>{w&&(w=!1,u.call(this,new pl(y,this,z.originalEvent)))}}}}{const w=T=>{const C=_(T.point);C.length&&(T.features=C,u.call(this,T),delete T.features)};return{listener:u,targets:o,delegates:{[y]:w}}}}on(y,o,u){if(typeof o=="function"||u===void 0)return super.on(y,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const _=this._createDelegatedListener(y,o,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(_);for(const w in _.delegates)this.on(w,_.delegates[w]);return this}once(y,o,u){if(typeof o=="function"||u===void 0)return super.once(y,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const _=this._createDelegatedListener(y,o,u);for(const w in _.delegates)this.once(w,_.delegates[w]);return this}off(y,o,u){if(typeof o=="function"||u===void 0)return super.off(y,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const _=this._delegatedListeners?this._delegatedListeners[y]:void 0;return _&&(w=>{for(let T=0;T<w.length;T++){const C=w[T];if(C.listener===u&&zi(C.targets,o)){for(const z in C.delegates)this.off(z,C.delegates[z]);return w.splice(T,1),this}}})(_),this}queryRenderedFeatures(y,o){if(!this.style)return[];if(y===void 0||y instanceof i.P||Array.isArray(y)||o!==void 0||(o=y,y=void 0),y=y||[[0,0],[this.transform.width,this.transform.height]],!o){const T=this.style.queryRenderedFeatures(y,void 0,this.transform),C=this.style.queryRenderedFeatureset(y,void 0,this.transform);return T.concat(C)}let u=!0;if(o.target&&(u=this._isTargetValid(o.target),u&&!o.layers))return this.style.queryRenderedFeatureset(y,o,this.transform);let _=!0;if(o.layers&&Array.isArray(o.layers)){for(const T of o.layers)if(!this._isValidId(T)){_=!1;break}if(_&&!o.target)return this.style.queryRenderedFeatures(y,o,this.transform)}let w=[];return _&&(w=w.concat(this.style.queryRenderedFeatures(y,o,this.transform))),u&&(w=w.concat(this.style.queryRenderedFeatureset(y,o,this.transform))),w}querySourceFeatures(y,o){return!y||typeof y=="string"&&!this._isValidId(y)?[]:this.style.querySourceFeatures(y,o)}isPointOnSurface(y){const{name:o}=this.transform.projection;return o!=="globe"&&o!=="mercator"&&i.w(`${o} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(y))}addInteraction(y,o){return this._interactions.add(y,o),this}removeInteraction(y){return this._interactions.remove(y),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(y){return this._cooperativeGestures=y,this}setStyle(y,o){return o=i.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o),this.style&&y&&o.diff!==!1&&o.localFontFamily===this._localFontFamily&&o.localIdeographFontFamily===this._localIdeographFontFamily&&!o.config?(this.style._diffStyle(y,(u,_)=>{u?(i.w(`Unable to perform style diff: ${String(u.message||u.error||u)}. Rebuilding the style from scratch.`),this._updateStyle(y,o)):_&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(y,o))}_getUIString(y){const o=this._locale[y];if(o==null)throw new Error(`Missing UI string '${y}'`);return o}_updateStyle(y,o){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),y){const u=i.l({},o);o&&o.config&&(u.initialConfig=o.config,delete u.config),this.style=new Js(this,u).load(y),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Js(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(y){return y==null?(this.fire(new i.z(new Error("IDs can't be empty."))),!1):!i.cs(y)||(this.fire(new i.z(new Error(`IDs can't contain special symbols: "${y}".`))),!1)}_isTargetValid(y){return"featuresetId"in y?this._isValidId("importId"in y?y.importId:y.featuresetId):"layerId"in y&&this._isValidId(y.layerId)}_areTargetsValid(y){if(Array.isArray(y)){for(const o of y)if(!this._isValidId(o))return!1;return!0}return this._isTargetValid(y)}addSource(y,o){return this._isValidId(y)?(this._lazyInitEmptyStyle(),this.style.addSource(y,o),this._update(!0)):this}isSourceLoaded(y){return!!this._isValidId(y)&&!!this.style&&this.style._isSourceCacheLoaded(y)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(y,o,u){this._lazyInitEmptyStyle(),this.style.addSourceType(y,o,u)}removeSource(y){return this._isValidId(y)?(this.style.removeSource(y),this._updateTerrain(),this._update(!0)):this}getSource(y){return this._isValidId(y)?this.style.getOwnSource(y):null}addImage(y,o,{pixelRatio:u=1,sdf:_=!1,stretchX:w,stretchY:T,content:C}={}){this._lazyInitEmptyStyle();const z=i.I.from(y);if(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap){const{width:V,height:$,data:K}=i.q.getImageData(o);this.style.addImage(z,{data:new i.r({width:V,height:$},K),pixelRatio:u,stretchX:w,stretchY:T,content:C,sdf:_,version:0,usvg:!1})}else if(o.width===void 0||o.height===void 0)this.fire(new i.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:V,height:$}=o,K=o;this.style.addImage(z,{data:new i.r({width:V,height:$},new Uint8Array(K.data)),pixelRatio:u,stretchX:w,stretchY:T,content:C,sdf:_,usvg:!1,version:0,userImage:K}),K.onAdd&&K.onAdd(this,y)}}updateImage(y,o){this._lazyInitEmptyStyle();const u=i.I.from(y),_=this.style.getImage(u);if(!_)return void this.fire(new i.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const w=o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap?i.q.getImageData(o):o,{width:T,height:C,data:z}=w;if(T===void 0||C===void 0)return void this.fire(new i.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(T!==(_.usvg?_.icon.usvg_tree.width:_.data.width)||C!==(_.usvg?_.icon.usvg_tree.height:_.data.height))return void this.fire(new i.z(new Error(`The width and height of the updated image (${T}, ${C})
                must be that same as the previous version of the image
                (${_.data.width}, ${_.data.height})`)));const V=!(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap);let $=!1;_.usvg?(_.data=new i.r({width:T,height:C},new Uint8Array(z)),_.usvg=!1,_.icon=void 0,$=!0):_.data.replace(z,V),this.style.updateImage(u,_,$)}hasImage(y){return y?!!this.style&&!!this.style.getImage(i.I.from(y)):(this.fire(new i.z(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(i.I.from(y))}loadImage(y,o){i.o(this._requestManager.transformRequest(y,i.R.Image),(u,_)=>{o(u,_ instanceof HTMLImageElement?i.q.getImageData(_):_)})}listImages(){return this.style.listImages().map(y=>y.name)}addModel(y,o){this._lazyInitEmptyStyle(),this.style.addModel(y,o)}hasModel(y){return y?this.style.hasModel(y):(this.fire(new i.z(new Error("Missing required model id"))),!1)}removeModel(y){this.style.removeModel(y)}listModels(){return this.style.listModels()}addLayer(y,o){return this._isValidId(y.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(y,o),this._update(!0)):this}getSlot(y){const o=this.getLayer(y);return o&&o.slot||null}setSlot(y,o){return this.style.setSlot(y,o),this.style.mergeLayers(),this._update(!0)}addImport(y,o){return this.style.addImport(y,o),this}updateImport(y,o){return typeof o!="string"&&o.id!==y?(this.removeImport(y),this.addImport(o)):(this.style.updateImport(y,o),this._update(!0))}removeImport(y){return this.style.removeImport(y),this}moveImport(y,o){return this.style.moveImport(y,o),this._update(!0)}moveLayer(y,o){return this._isValidId(y)?(this.style.moveLayer(y,o),this._update(!0)):this}removeLayer(y){return this._isValidId(y)?(this.style.removeLayer(y),this._update(!0)):this}getLayer(y){if(!this._isValidId(y))return null;const o=this.style.getOwnLayer(y);return o?o.type==="custom"?o.implementation:o.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(y,o,u){return this._isValidId(y)?(this.style.setLayerZoomRange(y,o,u),this._update(!0)):this}setFilter(y,o,u={}){return this._isValidId(y)?(this.style.setFilter(y,o,u),this._update(!0)):this}getFilter(y){return this._isValidId(y)?this.style.getFilter(y):null}setPaintProperty(y,o,u,_={}){return this._isValidId(y)?(this.style.setPaintProperty(y,o,u,_),this._update(!0)):this}getPaintProperty(y,o){return this._isValidId(y)?this.style.getPaintProperty(y,o):null}setLayoutProperty(y,o,u,_={}){return this._isValidId(y)?(this.style.setLayoutProperty(y,o,u,_),this._update(!0)):this}getLayoutProperty(y,o){return this._isValidId(y)?this.style.getLayoutProperty(y,o):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(y){return this.style.setGlyphsUrl(y),this._update(!0)}getSchema(y){return this.style.getSchema(y)}setSchema(y,o){return this.style.setSchema(y,o),this._update(!0)}getConfig(y){return this.style.getConfig(y)}setConfig(y,o){return this.style.setConfig(y,o),this._update(!0)}getConfigProperty(y,o){return this.style.getConfigProperty(y,o)}setConfigProperty(y,o,u){return this.style.setConfigProperty(y,o,u),this._update(!0)}getFeaturesetDescriptors(y){return this.style.getFeaturesetDescriptors(y)}setLights(y){if(this._lazyInitEmptyStyle(),y&&y.length===1&&y[0].type==="flat"){const o=y[0];o.properties?this.style.setFlatLight(o.properties,o.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(y),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const y=this.style.getLights()||[];return y.length===0&&y.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),y}setLight(y,o={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:y}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(y){return this._lazyInitEmptyStyle(),!y&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(y),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(y){return this._lazyInitEmptyStyle(),this.style.setFog(y),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(y){return this._lazyInitEmptyStyle(),this.style.setSnow(y),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(y){return this._lazyInitEmptyStyle(),this.style.setRain(y),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(y){return this._lazyInitEmptyStyle(),this.style.setColorTheme(y),this._update(!0)}setImportColorTheme(y,o){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(y,o),this._update(!0)}setCamera(y){return this.style.setCamera(y),this._triggerCameraUpdate(y)}_triggerCameraUpdate(y){return this._update(this.transform.setOrthographicProjectionAtLowPitch(y["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(y){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.bO.convert(y),this.transform):0}setFeatureState(y,o){return y.source&&!this._isValidId(y.source)?this:(this.style.setFeatureState(y,o),this._update())}removeFeatureState(y,o){return y.source&&!this._isValidId(y.source)?this:(this.style.removeFeatureState(y,o),this._update())}getFeatureState(y){return y.source&&!this._isValidId(y.source)?null:this.style.getFeatureState(y)}_updateContainerDimensions(){if(!this._container)return;const y=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let u,_,w,T=this._container;for(;T&&(!_||!w);){const C=window.getComputedStyle(T).transform;C&&C!=="none"&&(u=C.match(/matrix.*\((.+)\)/)[1].split(", "),u[0]&&u[0]!=="0"&&u[0]!=="1"&&(_=u[0]),u[3]&&u[3]!=="0"&&u[3]!=="1"&&(w=u[3])),T=T.parentElement}this._containerWidth=_?Math.abs(y/_):y,this._containerHeight=w?Math.abs(o/w):o}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const y=this._container;y.classList.add("mapboxgl-map"),(this._missingCSSCanary=G("div","mapboxgl-canary",y)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=G("div","mapboxgl-canvas-container",y);this._canvas=G("canvas","mapboxgl-canvas",o),this._interactive&&(o.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const u=this._controlContainer=G("div","mapboxgl-control-container",y),_=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(w=>{_[w]=G("div",`mapboxgl-ctrl-${w}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,o){const u=i.q.devicePixelRatio||1;this._canvas.width=u*Math.ceil(y),this._canvas.height=u*Math.ceil(o),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${o}px`}_addMarker(y){this._markers.push(y)}_removeMarker(y){const o=this._markers.indexOf(y);o!==-1&&this._markers.splice(o,1)}_addPopup(y){this._popups.push(y)}_removePopup(y){const o=this._popups.indexOf(y);o!==-1&&this._popups.splice(o,1)}_setupPainter(){const y=i.l({},H.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl2",y);o?(Kt(o,!0),this.painter=new qp(o,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",u=>{u.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.m.testSupport(o)):this.fire(new i.z(new Error("Failed to initialize WebGL")))}_contextLost(y){y.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.A("webglcontextlost",{originalEvent:y}))}_contextRestored(y){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style.reloadModels(),this.style.clearSources(),this._update(),this.fire(new i.A("webglcontextrestored",{originalEvent:y}))}_onMapScroll(y){if(y.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(y){return this.style?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_requestDomTask(y){!this.loaded()||this.loaded()&&!this.isMoving()?y():this._domRenderTaskQueue.add(y)}_render(y){let o;this.fire(new i.A("renderstart")),++this._frameId;const u=this.painter.context.extTimerQuery,_=i.q.now(),w=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(o=w.createQuery(),w.beginQuery(u.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(y),this._domRenderTaskQueue.run(y),this._removed)return;this._updateProjectionTransition();const T=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const $=this.transform.zoom,K=this.transform.pitch,ee=i.q.now(),te=new i.aa($,{now:ee,fadeDuration:T,pitch:K,transition:this.style.transition});this.style.update(te)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let C=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),C=this._updateAverageElevation(_),this.style.updateSources(this.transform),this.isMoving()||this._forceMarkerAndPopupUpdate()):C=this._updateAverageElevation(_);const z=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,T,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),z&&(this._placementDirty=z.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:T,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,I.mark(S.load),this.fire(new i.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),o){const $=i.q.now()-_;w.endQuery(u.TIME_ELAPSED_EXT),setTimeout(()=>{const K=w.getQueryParameter(o,w.QUERY_RESULT)/1e6;w.deleteQuery(o),this.fire(new i.A("gpu-timing-frame",{cpuTime:$,gpuTime:K}))},50)}if(this.listens("gpu-timing-layer")){const $=this.painter.collectGpuTimers();setTimeout(()=>{const K=this.painter.queryGpuTimers($);this.fire(new i.A("gpu-timing-layer",{layerTimes:K}))},50)}if(this.listens("gpu-timing-deferred-render")){const $=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const K=this.painter.queryGpuTimeDeferredRender($);this.fire(new i.A("gpu-timing-deferred-render",{gpuTime:K}))},50)}const V=this._sourcesDirty||this._styleDirty||this._placementDirty||C;if(V||this._repaint)this.triggerRepaint();else{const $=this.idle();if($&&(C=this._updateAverageElevation(_,!0)),C)this.triggerRepaint();else if(this._triggerFrame(!1),$&&(this.fire(new i.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const K=this._calculateSpeedIndex();this.fire(new i.A("speedindexcompleted",{speedIndex:K})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||V||(this._fullyLoaded=!0,I.mark(S.fullLoad),this._performanceMetricsCollection&&mt(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(y){for(const o of this._markers)y&&!this.getRenderWorldCopies()&&(o._lngLat=o._lngLat.wrap()),o._update();for(const o of this._popups)!y||this.getRenderWorldCopies()||o._trackPointer||(o._lngLat=o._lngLat.wrap()),o._update()}_updateAverageElevation(y,o=!1){const u=w=>(this.transform.averageElevation=w,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&u(0);const _=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(_||(o||y-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(y)){const w=this.transform.averageElevation;let T=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(T)?T=0:this._averageElevationLastSampledAt=y;const C=Math.abs(w-T);if(C>1){if(this._isInitialLoad||_)return this._averageElevation.jumpTo(T),u(T);this._averageElevation.easeTo(T,y,300)}else if(C>1e-4)return this._averageElevation.jumpTo(T),u(T)}return!!this._averageElevation.isEasing(y)&&u(this._averageElevation.getValue(y))}_authenticate(){_e(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,y=>{if(y&&(y.message===ke||y.status===401)){const o=this.painter.context.gl;Kt(o,!1),this._logoControl instanceof Fo&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Xe(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&vt(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const y=this._isDragging();this.painter.updateTerrain(this.style,y)}_calculateSpeedIndex(){const y=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const u=this.painter.context.gl,_=u.createFramebuffer();function w(T){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,T,0);const C=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,C),C}return u.bindFramebuffer(u.FRAMEBUFFER,_),this._canvasPixelComparison(w(y),o.canvasCopies.map(w),o.timeStamps)}_canvasPixelComparison(y,o,u){let _=u[1]-u[0];const w=y.length/4;for(let T=0;T<o.length;T++){const C=o[T];let z=0;for(let V=0;V<C.length;V+=4)C[V]===y[V]&&C[V+1]===y[V+1]&&C[V+2]===y[V+2]&&C[V+3]===y[V+3]&&(z+=1);_+=(u[T+2]-u[T+1])*(1-z/w)}return _}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const y=this.painter.context.gl.getExtension("WEBGL_lose_context");y&&y.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),on.delete(this.painter.context.gl),yt.remove(),Le.remove(),this._removed=!0,this.fire(new i.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(y){this._renderNextFrame=this._renderNextFrame||y,this.style&&!this._frame&&(this._frame=i.q.frame(o=>{const u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(o)}))}_preloadTiles(y){const o=this.style?this.style.getSourceCaches():[];return i.bl(o,(u,_)=>u._preloadTiles(y,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(y){this._trackResize&&this.resize({originalEvent:y})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(y){this._showParseStatus!==y&&(this._showParseStatus=y,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(y){this._showTerrainWireframe!==y&&(this._showTerrainWireframe=y,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(y){this._showLayers2DWireframe!==y&&(this._showLayers2DWireframe=y,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(y){this._showLayers3DWireframe!==y&&(this._showLayers3DWireframe=y,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(y){this._speedIndexTiming!==y&&(this._speedIndexTiming=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,this._tp.refreshUI(),y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(y){this._showTileAABBs!==y&&(this._showTileAABBs=y,this._tp.refreshUI(),y&&this._update())}_setCacheLimits(y,o){i.dJ(y,o)}get version(){return x}},NavigationControl:class{constructor(y={}){this.options=i.l({},Zy,y),this._container=G("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(i.aQ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),G("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),G("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.aQ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{const u=this._map;u&&(this.options.visualizePitch?u.resetNorthPitch({},{originalEvent:o}):u.resetNorth({},{originalEvent:o}))}),this._compassIcon=G("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const y=this._map;if(!y)return;const o=y.getZoom(),u=o===y.getMaxZoom(),_=o===y.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const y=this._map;if(!y)return;const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(y.transform.pitch*(Math.PI/180)),.5)}) rotateX(${y.transform.pitch}deg) rotateZ(${y.transform.angle*(180/Math.PI)}deg)`:`rotate(${y.transform.angle*(180/Math.PI)}deg)`;y._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),y.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&y.on("pitch",this._rotateCompassArrow),y.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Jy(y,this._compass,this.options.visualizePitch)),this._container}onRemove(){const y=this._map;y&&(this._container.remove(),this.options.showZoom&&y.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&y.off("pitch",this._rotateCompassArrow),y.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(y,o){const u=G("button",y,this._container);return u.type="button",u.addEventListener("click",o),u}_setButtonTitle(y,o){if(!this._map)return;const u=this._map._getUIString(`NavigationControl.${o}`);y.setAttribute("aria-label",u),y.firstElementChild&&y.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends i.E{constructor(y={}){super();const o=navigator.geolocation;this.options=i.l({geolocation:o},Mc,y),i.aQ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Fm(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(y){return this._map=y,this._container=G("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(y){const o=(u=!!this.options.geolocation)=>{this._supportsGeolocation=u,y(u)};this._supportsGeolocation!==void 0?y(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(u=>o(u.state!=="denied")).catch(()=>o()):o()}_isOutOfMapMaxBounds(y){const o=this._map.getMaxBounds(),u=y.coords;return!!o&&(u.longitude<o.getWest()||u.longitude>o.getEast()||u.latitude<o.getSouth()||u.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(y){if(this._map){if(this._isOutOfMapMaxBounds(y))return this._setErrorState(),this.fire(new i.A("outofmaxbounds",y)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=y,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(y),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(y),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.A("geolocate",y)),this._finish()}}_updateCamera(y){const o=new i.bO(y.coords.longitude,y.coords.latitude),u=y.coords.accuracy,_=this._map.getBearing(),w=i.l({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(u),w,{geolocateSource:!0})}_updateMarker(y){if(y){const o=new i.bO(y.coords.longitude,y.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=y.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const y=this._map.transform,o=i.bH(1,y._center.lat)*y.worldSize,u=Math.ceil(2*this._accuracy*o);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(y){if(this._map){if(this.options.trackUserLocation)if(y.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(y.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.A("error",y)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(y){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=G("button","mapboxgl-ctrl-geolocate",this._container),G("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",y===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=G("div","mapboxgl-user-location"),this._dotElement.appendChild(G("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(G("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Uo({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=G("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Uo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.A("trackuserlocationend")))})}}_onDeviceOrientation(y){this._userLocationDotMarker&&(y.webkitCompassHeading?this._heading=y.webkitCompassHeading:y.absolute===!0&&(this._heading=-1*y.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(y={maximumAge:6e5,timeout:0},this._noTimeout=!0):(y=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,y),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const y=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(o=>{o==="granted"&&y()}).catch(console.error):y()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ed,ScaleControl:class{constructor(y={}){this.options=i.l({},xa,y),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),i.aQ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const y=this.options.maxWidth||100,o=this._map,u=o._containerHeight/2,_=o._containerWidth/2-y/2,w=o.unproject([_,u]),T=o.unproject([_+y,u]),C=w.distanceTo(T);if(this.options.unit==="imperial"){const z=3.2808*C;z>5280?this._setScale(y,z/5280,"mile"):this._setScale(y,z,"foot")}else this.options.unit==="nautical"?this._setScale(y,C/1852,"nautical-mile"):C>=1e3?this._setScale(y,C/1e3,"kilometer"):this._setScale(y,C,"meter")}_setScale(y,o,u){this._map._requestDomTask(()=>{const _=function(T){const C=Math.pow(10,`${Math.floor(T)}`.length-1);let z=T/C;return z=z>=10?10:z>=5?5:z>=3?3:z>=2?2:z>=1?1:function(V){const $=Math.pow(10,Math.ceil(-Math.log(V)/Math.LN10));return Math.round(V*$)/$}(z),C*z}(o),w=_/o;this._container.innerHTML=this._isNumberFormatSupported&&u!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:u}).format(_):`${_}&nbsp;${Ng[u]}`,this._container.style.width=y*w+"px"})}onAdd(y){return this._map=y,this._language=y.getLanguage(),this._container=G("div","mapboxgl-ctrl mapboxgl-ctrl-scale",y.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(y){this._language=y,this._update()}setUnit(y){this.options.unit=y,this._update()}},FullscreenControl:class{constructor(y={}){this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:i.w("Full screen control 'container' must be a DOM element.")),i.aQ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=G("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const y=this._fullscreenButton=G("button","mapboxgl-ctrl-fullscreen",this._controlContainer);G("span","mapboxgl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",y)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends i.E{constructor(y){super(),this.options=i.l(Object.create(Cc),y),this._altitude=this.options.altitude,i.aQ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(y&&y.className?y.className.trim().split(/\s+/):[])}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&y.on("preclick",this._onClose),this.options.closeOnMove&&y.on("move",this._onClose),y.on("remove",this.remove),this._update(),y._addPopup(this),this._focusFirstElement(),this._trackPointer?(y.on("mousemove",this._onMouseEvent),y.on("mouseup",this._onMouseEvent),y._canvasContainer.classList.add("mapboxgl-track-pointer")):y.on("move",this._update),this.fire(new i.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const y=this._map;return y&&(y.off("move",this._update),y.off("move",this._onClose),y.off("preclick",this._onClose),y.off("click",this._onClose),y.off("remove",this.remove),y.off("mousemove",this._onMouseEvent),y.off("mouseup",this._onMouseEvent),y.off("drag",this._onMouseEvent),y._canvasContainer&&y._canvasContainer.classList.remove("mapboxgl-track-pointer"),y._removePopup(this),this._map=void 0),this.fire(new i.A("close")),this}getLngLat(){return this._lngLat}setLngLat(y){this._lngLat=i.bO.convert(y),this._pos=null,this._trackPointer=!1,this._update();const o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(y){return this._altitude=y,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const y=this._map;return y&&(y.off("move",this._update),y.on("mousemove",this._onMouseEvent),y.on("drag",this._onMouseEvent),y._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const o=document.createDocumentFragment(),u=document.createElement("body");let _;for(u.innerHTML=y;_=u.firstChild,_;)o.appendChild(_);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=G("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(y),this.options.closeButton){const u=this._closeButton=G("button","mapboxgl-popup-close-button",o);u.type="button",u.setAttribute("aria-label","Close popup"),u.innerHTML='<span aria-hidden="true">&#215;</span>',u.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(y){return this._classList.add(y),this._updateClassList(),this}removeClassName(y){return this._classList.delete(y),this._updateClassList(),this}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){let o;return this._classList.delete(y)?o=!1:(this._classList.add(y),o=!0),this._updateClassList(),o}_onMouseEvent(y){this._update(y.point)}_getAnchor(y){if(this.options.anchor)return this.options.anchor;const o=this._map,u=this._container,_=this._pos;if(!o||!u||!_)return"bottom";const w=u.offsetWidth,T=u.offsetHeight,C=_.x<w/2,z=_.x>o.transform.width-w/2;if(_.y+y<T)return C?"top-left":z?"top-right":"top";if(_.y>o.transform.height-T){if(C)return"bottom-left";if(z)return"bottom-right"}return C?"left":z?"right":"bottom"}_updateClassList(){const y=this._container;if(!y)return;const o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),y.className=o.join(" ")}_update(y){const o=this._map,u=this._content;if(!o||!this._lngLat&&!this._trackPointer||!u)return;let _=this._container;if(_||(_=this._container=G("div","mapboxgl-popup",o.getContainer()),this._tip=G("div","mapboxgl-popup-tip",_),_.appendChild(u)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=sp(this._lngLat,this._pos,o.transform)),!this._trackPointer||y){const w=this._pos=this._trackPointer&&y instanceof i.P?y:o.project(this._lngLat,this._altitude),T=Hf(this.options.offset),C=this._anchor=this._getAnchor(T.y),z=Hf(this.options.offset,C),V=w.add(z).round();o._requestDomTask(()=>{this._container&&C&&(this._container.style.transform=`${gl[C]} translate(${V.x}px,${V.y}px)`)})}if(!this._marker&&o._showingGlobe()){const w=i.dK(o.transform,this._lngLat)?0:1;this._setOpacity(w)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(Qy);y&&y.focus()}_onClose(){this.remove()}_setOpacity(y){this._container&&(this._container.style.opacity=`${y}`),this._content&&(this._content.style.pointerEvents=y?"auto":"none")}},Marker:Uo,Style:Js,LngLat:i.bO,LngLatBounds:i.aB,Point:i.P,MercatorCoordinate:i.ac,FreeCameraOptions:wh,Evented:i.E,config:i.e,prewarm:i.dP,clearPrewarmedResources:i.dQ,get accessToken(){return i.e.ACCESS_TOKEN},set accessToken(y){i.e.ACCESS_TOKEN=y},get baseApiUrl(){return i.e.API_URL},set baseApiUrl(y){i.e.API_URL=y},get workerCount(){return i.dR.workerCount},set workerCount(y){i.dR.workerCount=y},get maxParallelImageRequests(){return i.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(y){i.e.MAX_PARALLEL_IMAGE_REQUESTS=y},clearStorage(y){i.dS(y)},get workerUrl(){return i.dT.workerUrl},set workerUrl(y){i.dT.workerUrl=y},get workerClass(){return i.dT.workerClass},set workerClass(y){i.dT.workerClass=y},get workerParams(){return i.dT.workerParams},set workerParams(y){i.dT.workerParams=y},get dracoUrl(){return i.dU()},set dracoUrl(y){i.dV(y)},get meshoptUrl(){return i.dW()},set meshoptUrl(y){i.dX(y)},setNow:i.q.setNow,restoreNow:i.q.restoreNow}});var f=s;return f})}(CA)),CA.exports}var aue=iue();const td=Xa(aue);function mK(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var s=t.length;for(e=0;e<s;e++)t[e]&&(n=mK(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function fa(){for(var t,e,n=0,r="",s=arguments.length;n<s;n++)(t=arguments[n])&&(e=mK(t))&&(r&&(r+=" "),r+=e);return r}var CM,Sj;function Cf(){if(Sj)return CM;Sj=1;var t=Array.isArray;return CM=t,CM}var IM,Aj;function gK(){if(Aj)return IM;Aj=1;var t=typeof BS=="object"&&BS&&BS.Object===Object&&BS;return IM=t,IM}var PM,Tj;function Pm(){if(Tj)return PM;Tj=1;var t=gK(),e=typeof self=="object"&&self&&self.Object===Object&&self,n=t||e||Function("return this")();return PM=n,PM}var OM,Ej;function y2(){if(Ej)return OM;Ej=1;var t=Pm(),e=t.Symbol;return OM=e,OM}var RM,Mj;function sue(){if(Mj)return RM;Mj=1;var t=y2(),e=Object.prototype,n=e.hasOwnProperty,r=e.toString,s=t?t.toStringTag:void 0;function l(f){var i=n.call(f,s),x=f[s];try{f[s]=void 0;var S=!0}catch{}var I=r.call(f);return S&&(i?f[s]=x:delete f[s]),I}return RM=l,RM}var DM,Cj;function oue(){if(Cj)return DM;Cj=1;var t=Object.prototype,e=t.toString;function n(r){return e.call(r)}return DM=n,DM}var LM,Ij;function Ag(){if(Ij)return LM;Ij=1;var t=y2(),e=sue(),n=oue(),r="[object Null]",s="[object Undefined]",l=t?t.toStringTag:void 0;function f(i){return i==null?i===void 0?s:r:l&&l in Object(i)?e(i):n(i)}return LM=f,LM}var kM,Pj;function Tg(){if(Pj)return kM;Pj=1;function t(e){return e!=null&&typeof e=="object"}return kM=t,kM}var NM,Oj;function N1(){if(Oj)return NM;Oj=1;var t=Ag(),e=Tg(),n="[object Symbol]";function r(s){return typeof s=="symbol"||e(s)&&t(s)==n}return NM=r,NM}var zM,Rj;function ok(){if(Rj)return zM;Rj=1;var t=Cf(),e=N1(),n=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,r=/^\w*$/;function s(l,f){if(t(l))return!1;var i=typeof l;return i=="number"||i=="symbol"||i=="boolean"||l==null||e(l)?!0:r.test(l)||!n.test(l)||f!=null&&l in Object(f)}return zM=s,zM}var BM,Dj;function ky(){if(Dj)return BM;Dj=1;function t(e){var n=typeof e;return e!=null&&(n=="object"||n=="function")}return BM=t,BM}var jM,Lj;function lk(){if(Lj)return jM;Lj=1;var t=Ag(),e=ky(),n="[object AsyncFunction]",r="[object Function]",s="[object GeneratorFunction]",l="[object Proxy]";function f(i){if(!e(i))return!1;var x=t(i);return x==r||x==s||x==n||x==l}return jM=f,jM}var FM,kj;function lue(){if(kj)return FM;kj=1;var t=Pm(),e=t["__core-js_shared__"];return FM=e,FM}var UM,Nj;function cue(){if(Nj)return UM;Nj=1;var t=lue(),e=function(){var r=/[^.]+$/.exec(t&&t.keys&&t.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function n(r){return!!e&&e in r}return UM=n,UM}var qM,zj;function yK(){if(zj)return qM;zj=1;var t=Function.prototype,e=t.toString;function n(r){if(r!=null){try{return e.call(r)}catch{}try{return r+""}catch{}}return""}return qM=n,qM}var VM,Bj;function uue(){if(Bj)return VM;Bj=1;var t=lk(),e=cue(),n=ky(),r=yK(),s=/[\\^$.*+?()[\]{}|]/g,l=/^\[object .+?Constructor\]$/,f=Function.prototype,i=Object.prototype,x=f.toString,S=i.hasOwnProperty,I=RegExp("^"+x.call(S).replace(s,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function R(F){if(!n(F)||e(F))return!1;var j=t(F)?I:l;return j.test(r(F))}return VM=R,VM}var $M,jj;function hue(){if(jj)return $M;jj=1;function t(e,n){return e==null?void 0:e[n]}return $M=t,$M}var HM,Fj;function pv(){if(Fj)return HM;Fj=1;var t=uue(),e=hue();function n(r,s){var l=e(r,s);return t(l)?l:void 0}return HM=n,HM}var GM,Uj;function iE(){if(Uj)return GM;Uj=1;var t=pv(),e=t(Object,"create");return GM=e,GM}var WM,qj;function fue(){if(qj)return WM;qj=1;var t=iE();function e(){this.__data__=t?t(null):{},this.size=0}return WM=e,WM}var KM,Vj;function due(){if(Vj)return KM;Vj=1;function t(e){var n=this.has(e)&&delete this.__data__[e];return this.size-=n?1:0,n}return KM=t,KM}var YM,$j;function pue(){if($j)return YM;$j=1;var t=iE(),e="__lodash_hash_undefined__",n=Object.prototype,r=n.hasOwnProperty;function s(l){var f=this.__data__;if(t){var i=f[l];return i===e?void 0:i}return r.call(f,l)?f[l]:void 0}return YM=s,YM}var XM,Hj;function mue(){if(Hj)return XM;Hj=1;var t=iE(),e=Object.prototype,n=e.hasOwnProperty;function r(s){var l=this.__data__;return t?l[s]!==void 0:n.call(l,s)}return XM=r,XM}var ZM,Gj;function gue(){if(Gj)return ZM;Gj=1;var t=iE(),e="__lodash_hash_undefined__";function n(r,s){var l=this.__data__;return this.size+=this.has(r)?0:1,l[r]=t&&s===void 0?e:s,this}return ZM=n,ZM}var JM,Wj;function yue(){if(Wj)return JM;Wj=1;var t=fue(),e=due(),n=pue(),r=mue(),s=gue();function l(f){var i=-1,x=f==null?0:f.length;for(this.clear();++i<x;){var S=f[i];this.set(S[0],S[1])}}return l.prototype.clear=t,l.prototype.delete=e,l.prototype.get=n,l.prototype.has=r,l.prototype.set=s,JM=l,JM}var QM,Kj;function _ue(){if(Kj)return QM;Kj=1;function t(){this.__data__=[],this.size=0}return QM=t,QM}var eC,Yj;function ck(){if(Yj)return eC;Yj=1;function t(e,n){return e===n||e!==e&&n!==n}return eC=t,eC}var tC,Xj;function aE(){if(Xj)return tC;Xj=1;var t=ck();function e(n,r){for(var s=n.length;s--;)if(t(n[s][0],r))return s;return-1}return tC=e,tC}var nC,Zj;function vue(){if(Zj)return nC;Zj=1;var t=aE(),e=Array.prototype,n=e.splice;function r(s){var l=this.__data__,f=t(l,s);if(f<0)return!1;var i=l.length-1;return f==i?l.pop():n.call(l,f,1),--this.size,!0}return nC=r,nC}var rC,Jj;function bue(){if(Jj)return rC;Jj=1;var t=aE();function e(n){var r=this.__data__,s=t(r,n);return s<0?void 0:r[s][1]}return rC=e,rC}var iC,Qj;function xue(){if(Qj)return iC;Qj=1;var t=aE();function e(n){return t(this.__data__,n)>-1}return iC=e,iC}var aC,eF;function wue(){if(eF)return aC;eF=1;var t=aE();function e(n,r){var s=this.__data__,l=t(s,n);return l<0?(++this.size,s.push([n,r])):s[l][1]=r,this}return aC=e,aC}var sC,tF;function sE(){if(tF)return sC;tF=1;var t=_ue(),e=vue(),n=bue(),r=xue(),s=wue();function l(f){var i=-1,x=f==null?0:f.length;for(this.clear();++i<x;){var S=f[i];this.set(S[0],S[1])}}return l.prototype.clear=t,l.prototype.delete=e,l.prototype.get=n,l.prototype.has=r,l.prototype.set=s,sC=l,sC}var oC,nF;function uk(){if(nF)return oC;nF=1;var t=pv(),e=Pm(),n=t(e,"Map");return oC=n,oC}var lC,rF;function Sue(){if(rF)return lC;rF=1;var t=yue(),e=sE(),n=uk();function r(){this.size=0,this.__data__={hash:new t,map:new(n||e),string:new t}}return lC=r,lC}var cC,iF;function Aue(){if(iF)return cC;iF=1;function t(e){var n=typeof e;return n=="string"||n=="number"||n=="symbol"||n=="boolean"?e!=="__proto__":e===null}return cC=t,cC}var uC,aF;function oE(){if(aF)return uC;aF=1;var t=Aue();function e(n,r){var s=n.__data__;return t(r)?s[typeof r=="string"?"string":"hash"]:s.map}return uC=e,uC}var hC,sF;function Tue(){if(sF)return hC;sF=1;var t=oE();function e(n){var r=t(this,n).delete(n);return this.size-=r?1:0,r}return hC=e,hC}var fC,oF;function Eue(){if(oF)return fC;oF=1;var t=oE();function e(n){return t(this,n).get(n)}return fC=e,fC}var dC,lF;function Mue(){if(lF)return dC;lF=1;var t=oE();function e(n){return t(this,n).has(n)}return dC=e,dC}var pC,cF;function Cue(){if(cF)return pC;cF=1;var t=oE();function e(n,r){var s=t(this,n),l=s.size;return s.set(n,r),this.size+=s.size==l?0:1,this}return pC=e,pC}var mC,uF;function hk(){if(uF)return mC;uF=1;var t=Sue(),e=Tue(),n=Eue(),r=Mue(),s=Cue();function l(f){var i=-1,x=f==null?0:f.length;for(this.clear();++i<x;){var S=f[i];this.set(S[0],S[1])}}return l.prototype.clear=t,l.prototype.delete=e,l.prototype.get=n,l.prototype.has=r,l.prototype.set=s,mC=l,mC}var gC,hF;function _K(){if(hF)return gC;hF=1;var t=hk(),e="Expected a function";function n(r,s){if(typeof r!="function"||s!=null&&typeof s!="function")throw new TypeError(e);var l=function(){var f=arguments,i=s?s.apply(this,f):f[0],x=l.cache;if(x.has(i))return x.get(i);var S=r.apply(this,f);return l.cache=x.set(i,S)||x,S};return l.cache=new(n.Cache||t),l}return n.Cache=t,gC=n,gC}var yC,fF;function Iue(){if(fF)return yC;fF=1;var t=_K(),e=500;function n(r){var s=t(r,function(f){return l.size===e&&l.clear(),f}),l=s.cache;return s}return yC=n,yC}var _C,dF;function Pue(){if(dF)return _C;dF=1;var t=Iue(),e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,n=/\\(\\)?/g,r=t(function(s){var l=[];return s.charCodeAt(0)===46&&l.push(""),s.replace(e,function(f,i,x,S){l.push(x?S.replace(n,"$1"):i||f)}),l});return _C=r,_C}var vC,pF;function fk(){if(pF)return vC;pF=1;function t(e,n){for(var r=-1,s=e==null?0:e.length,l=Array(s);++r<s;)l[r]=n(e[r],r,e);return l}return vC=t,vC}var bC,mF;function Oue(){if(mF)return bC;mF=1;var t=y2(),e=fk(),n=Cf(),r=N1(),s=t?t.prototype:void 0,l=s?s.toString:void 0;function f(i){if(typeof i=="string")return i;if(n(i))return e(i,f)+"";if(r(i))return l?l.call(i):"";var x=i+"";return x=="0"&&1/i==-1/0?"-0":x}return bC=f,bC}var xC,gF;function vK(){if(gF)return xC;gF=1;var t=Oue();function e(n){return n==null?"":t(n)}return xC=e,xC}var wC,yF;function bK(){if(yF)return wC;yF=1;var t=Cf(),e=ok(),n=Pue(),r=vK();function s(l,f){return t(l)?l:e(l,f)?[l]:n(r(l))}return wC=s,wC}var SC,_F;function lE(){if(_F)return SC;_F=1;var t=N1();function e(n){if(typeof n=="string"||t(n))return n;var r=n+"";return r=="0"&&1/n==-1/0?"-0":r}return SC=e,SC}var AC,vF;function dk(){if(vF)return AC;vF=1;var t=bK(),e=lE();function n(r,s){s=t(s,r);for(var l=0,f=s.length;r!=null&&l<f;)r=r[e(s[l++])];return l&&l==f?r:void 0}return AC=n,AC}var TC,bF;function xK(){if(bF)return TC;bF=1;var t=dk();function e(n,r,s){var l=n==null?void 0:t(n,r);return l===void 0?s:l}return TC=e,TC}var Rue=xK();const sd=Xa(Rue);var EC,xF;function Due(){if(xF)return EC;xF=1;function t(e){return e==null}return EC=t,EC}var Lue=Due();const aa=Xa(Lue);var MC,wF;function kue(){if(wF)return MC;wF=1;var t=Ag(),e=Cf(),n=Tg(),r="[object String]";function s(l){return typeof l=="string"||!e(l)&&n(l)&&t(l)==r}return MC=s,MC}var Nue=kue();const _2=Xa(Nue);var zue=lk();const qi=Xa(zue);var Bue=ky();const z1=Xa(Bue);var CC={exports:{}},Ps={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var SF;function jue(){if(SF)return Ps;SF=1;var t=Symbol.for("react.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),f=Symbol.for("react.context"),i=Symbol.for("react.server_context"),x=Symbol.for("react.forward_ref"),S=Symbol.for("react.suspense"),I=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),F=Symbol.for("react.lazy"),j=Symbol.for("react.offscreen"),H;H=Symbol.for("react.module.reference");function G(W){if(typeof W=="object"&&W!==null){var J=W.$$typeof;switch(J){case t:switch(W=W.type,W){case n:case s:case r:case S:case I:return W;default:switch(W=W&&W.$$typeof,W){case i:case f:case x:case F:case R:case l:return W;default:return J}}case e:return J}}}return Ps.ContextConsumer=f,Ps.ContextProvider=l,Ps.Element=t,Ps.ForwardRef=x,Ps.Fragment=n,Ps.Lazy=F,Ps.Memo=R,Ps.Portal=e,Ps.Profiler=s,Ps.StrictMode=r,Ps.Suspense=S,Ps.SuspenseList=I,Ps.isAsyncMode=function(){return!1},Ps.isConcurrentMode=function(){return!1},Ps.isContextConsumer=function(W){return G(W)===f},Ps.isContextProvider=function(W){return G(W)===l},Ps.isElement=function(W){return typeof W=="object"&&W!==null&&W.$$typeof===t},Ps.isForwardRef=function(W){return G(W)===x},Ps.isFragment=function(W){return G(W)===n},Ps.isLazy=function(W){return G(W)===F},Ps.isMemo=function(W){return G(W)===R},Ps.isPortal=function(W){return G(W)===e},Ps.isProfiler=function(W){return G(W)===s},Ps.isStrictMode=function(W){return G(W)===r},Ps.isSuspense=function(W){return G(W)===S},Ps.isSuspenseList=function(W){return G(W)===I},Ps.isValidElementType=function(W){return typeof W=="string"||typeof W=="function"||W===n||W===s||W===r||W===S||W===I||W===j||typeof W=="object"&&W!==null&&(W.$$typeof===F||W.$$typeof===R||W.$$typeof===l||W.$$typeof===f||W.$$typeof===x||W.$$typeof===H||W.getModuleId!==void 0)},Ps.typeOf=G,Ps}var AF;function Fue(){return AF||(AF=1,CC.exports=jue()),CC.exports}var Uue=Fue(),IC,TF;function wK(){if(TF)return IC;TF=1;var t=Ag(),e=Tg(),n="[object Number]";function r(s){return typeof s=="number"||e(s)&&t(s)==n}return IC=r,IC}var PC,EF;function que(){if(EF)return PC;EF=1;var t=wK();function e(n){return t(n)&&n!=+n}return PC=e,PC}var Vue=que();const B1=Xa(Vue);var $ue=wK();const Hue=Xa($ue);var Wh=function(e){return e===0?0:e>0?1:-1},B_=function(e){return _2(e)&&e.indexOf("%")===e.length-1},gr=function(e){return Hue(e)&&!B1(e)},Lc=function(e){return gr(e)||_2(e)},Gue=0,mv=function(e){var n=++Gue;return"".concat(e||"").concat(n)},Kh=function(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!gr(e)&&!_2(e))return r;var l;if(B_(e)){var f=e.indexOf("%");l=n*parseFloat(e.slice(0,f))/100}else l=+e;return B1(l)&&(l=r),s&&l>n&&(l=n),l},gy=function(e){if(!e)return null;var n=Object.keys(e);return n&&n.length?e[n[0]]:null},Wue=function(e){if(!Array.isArray(e))return!1;for(var n=e.length,r={},s=0;s<n;s++)if(!r[e[s]])r[e[s]]=!0;else return!0;return!1},Dc=function(e,n){return gr(e)&&gr(n)?function(r){return e+r*(n-e)}:function(){return n}};function dT(t,e,n){return!t||!t.length?null:t.find(function(r){return r&&(typeof e=="function"?e(r):sd(r,e))===n})}function z0(t,e){for(var n in t)if({}.hasOwnProperty.call(t,n)&&(!{}.hasOwnProperty.call(e,n)||t[n]!==e[n]))return!1;for(var r in e)if({}.hasOwnProperty.call(e,r)&&!{}.hasOwnProperty.call(t,r))return!1;return!0}function X4(t){"@babel/helpers - typeof";return X4=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},X4(t)}var Kue=["viewBox","children"],Yue=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],MF=["points","pathLength"],OC={svg:Kue,polygon:MF,polyline:MF},pk=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],pT=function(e,n){if(!e||typeof e=="function"||typeof e=="boolean")return null;var r=e;if(st.isValidElement(e)&&(r=e.props),!z1(r))return null;var s={};return Object.keys(r).forEach(function(l){pk.includes(l)&&(s[l]=n||function(f){return r[l](r,f)})}),s},Xue=function(e,n,r){return function(s){return e(n,r,s),null}},rv=function(e,n,r){if(!z1(e)||X4(e)!=="object")return null;var s=null;return Object.keys(e).forEach(function(l){var f=e[l];pk.includes(l)&&typeof f=="function"&&(s||(s={}),s[l]=Xue(f,n,r))}),s},Zue=["children"],Jue=["children"];function CF(t,e){if(t==null)return{};var n=Que(t,e),r,s;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(s=0;s<l.length;s++)r=l[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function Que(t,e){if(t==null)return{};var n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;n[r]=t[r]}return n}function Z4(t){"@babel/helpers - typeof";return Z4=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Z4(t)}var IF={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",contextmenu:"onContextMenu",dblclick:"onDoubleClick"},cg=function(e){return typeof e=="string"?e:e?e.displayName||e.name||"Component":""},PF=null,RC=null,mk=function t(e){if(e===PF&&Array.isArray(RC))return RC;var n=[];return st.Children.forEach(e,function(r){aa(r)||(Uue.isFragment(r)?n=n.concat(t(r.props.children)):n.push(r))}),RC=n,PF=e,n};function od(t,e){var n=[],r=[];return Array.isArray(e)?r=e.map(function(s){return cg(s)}):r=[cg(e)],mk(t).forEach(function(s){var l=sd(s,"type.displayName")||sd(s,"type.name");r.indexOf(l)!==-1&&n.push(s)}),n}function Qf(t,e){var n=od(t,e);return n&&n[0]}var OF=function(e){if(!e||!e.props)return!1;var n=e.props,r=n.width,s=n.height;return!(!gr(r)||r<=0||!gr(s)||s<=0)},ehe=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],the=function(e){return e&&e.type&&_2(e.type)&&ehe.indexOf(e.type)>=0},SK=function(e){return e&&Z4(e)==="object"&&"clipDot"in e},nhe=function(e,n,r,s){var l,f=(l=OC==null?void 0:OC[s])!==null&&l!==void 0?l:[];return!qi(e)&&(s&&f.includes(n)||Yue.includes(n))||r&&pk.includes(n)},di=function(e,n,r){if(!e||typeof e=="function"||typeof e=="boolean")return null;var s=e;if(st.isValidElement(e)&&(s=e.props),!z1(s))return null;var l={};return Object.keys(s).forEach(function(f){var i;nhe((i=s)===null||i===void 0?void 0:i[f],f,n,r)&&(l[f]=s[f])}),l},J4=function t(e,n){if(e===n)return!0;var r=st.Children.count(e);if(r!==st.Children.count(n))return!1;if(r===0)return!0;if(r===1)return RF(Array.isArray(e)?e[0]:e,Array.isArray(n)?n[0]:n);for(var s=0;s<r;s++){var l=e[s],f=n[s];if(Array.isArray(l)||Array.isArray(f)){if(!t(l,f))return!1}else if(!RF(l,f))return!1}return!0},RF=function(e,n){if(aa(e)&&aa(n))return!0;if(!aa(e)&&!aa(n)){var r=e.props||{},s=r.children,l=CF(r,Zue),f=n.props||{},i=f.children,x=CF(f,Jue);return s&&i?z0(l,x)&&J4(s,i):!s&&!i?z0(l,x):!1}return!1},DF=function(e,n){var r=[],s={};return mk(e).forEach(function(l,f){if(the(l))r.push(l);else if(l){var i=cg(l.type),x=n[i]||{},S=x.handler,I=x.once;if(S&&(!I||!s[i])){var R=S(l,i,f);r.push(R),s[i]=!0}}}),r},rhe=function(e){var n=e&&e.type;return n&&IF[n]?IF[n]:null},ihe=function(e,n){return mk(n).indexOf(e)},ahe=["children","width","height","viewBox","className","style","title","desc"];function Q4(){return Q4=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Q4.apply(this,arguments)}function she(t,e){if(t==null)return{};var n=ohe(t,e),r,s;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(s=0;s<l.length;s++)r=l[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function ohe(t,e){if(t==null)return{};var n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;n[r]=t[r]}return n}function eR(t){var e=t.children,n=t.width,r=t.height,s=t.viewBox,l=t.className,f=t.style,i=t.title,x=t.desc,S=she(t,ahe),I=s||{width:n,height:r,x:0,y:0},R=fa("recharts-surface",l);return kt.createElement("svg",Q4({},di(S,!0,"svg"),{className:R,width:n,height:r,style:f,viewBox:"".concat(I.x," ").concat(I.y," ").concat(I.width," ").concat(I.height)}),kt.createElement("title",null,i),kt.createElement("desc",null,x),e)}var lhe=["children","className"];function tR(){return tR=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},tR.apply(this,arguments)}function che(t,e){if(t==null)return{};var n=uhe(t,e),r,s;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(s=0;s<l.length;s++)r=l[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function uhe(t,e){if(t==null)return{};var n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;n[r]=t[r]}return n}var Na=kt.forwardRef(function(t,e){var n=t.children,r=t.className,s=che(t,lhe),l=fa("recharts-layer",r);return kt.createElement("g",tR({className:l},di(s,!0),{ref:e}),n)}),Tp=function(e,n){for(var r=arguments.length,s=new Array(r>2?r-2:0),l=2;l<r;l++)s[l-2]=arguments[l]},DC,LF;function hhe(){if(LF)return DC;LF=1;function t(e,n,r){var s=-1,l=e.length;n<0&&(n=-n>l?0:l+n),r=r>l?l:r,r<0&&(r+=l),l=n>r?0:r-n>>>0,n>>>=0;for(var f=Array(l);++s<l;)f[s]=e[s+n];return f}return DC=t,DC}var LC,kF;function fhe(){if(kF)return LC;kF=1;var t=hhe();function e(n,r,s){var l=n.length;return s=s===void 0?l:s,!r&&s>=l?n:t(n,r,s)}return LC=e,LC}var kC,NF;function AK(){if(NF)return kC;NF=1;var t="\\ud800-\\udfff",e="\\u0300-\\u036f",n="\\ufe20-\\ufe2f",r="\\u20d0-\\u20ff",s=e+n+r,l="\\ufe0e\\ufe0f",f="\\u200d",i=RegExp("["+f+t+s+l+"]");function x(S){return i.test(S)}return kC=x,kC}var NC,zF;function dhe(){if(zF)return NC;zF=1;function t(e){return e.split("")}return NC=t,NC}var zC,BF;function phe(){if(BF)return zC;BF=1;var t="\\ud800-\\udfff",e="\\u0300-\\u036f",n="\\ufe20-\\ufe2f",r="\\u20d0-\\u20ff",s=e+n+r,l="\\ufe0e\\ufe0f",f="["+t+"]",i="["+s+"]",x="\\ud83c[\\udffb-\\udfff]",S="(?:"+i+"|"+x+")",I="[^"+t+"]",R="(?:\\ud83c[\\udde6-\\uddff]){2}",F="[\\ud800-\\udbff][\\udc00-\\udfff]",j="\\u200d",H=S+"?",G="["+l+"]?",W="(?:"+j+"(?:"+[I,R,F].join("|")+")"+G+H+")*",J=G+H+W,ie="(?:"+[I+i+"?",i,R,F,f].join("|")+")",he=RegExp(x+"(?="+x+")|"+ie+J,"g");function ge(fe){return fe.match(he)||[]}return zC=ge,zC}var BC,jF;function mhe(){if(jF)return BC;jF=1;var t=dhe(),e=AK(),n=phe();function r(s){return e(s)?n(s):t(s)}return BC=r,BC}var jC,FF;function ghe(){if(FF)return jC;FF=1;var t=fhe(),e=AK(),n=mhe(),r=vK();function s(l){return function(f){f=r(f);var i=e(f)?n(f):void 0,x=i?i[0]:f.charAt(0),S=i?t(i,1).join(""):f.slice(1);return x[l]()+S}}return jC=s,jC}var FC,UF;function yhe(){if(UF)return FC;UF=1;var t=ghe(),e=t("toUpperCase");return FC=e,FC}var _he=yhe();const cE=Xa(_he);function vo(t){return function(){return t}}const TK=Math.cos,mT=Math.sin,Rp=Math.sqrt,gT=Math.PI,uE=2*gT,nR=Math.PI,rR=2*nR,P_=1e-6,vhe=rR-P_;function EK(t){this._+=t[0];for(let e=1,n=t.length;e<n;++e)this._+=arguments[e]+t[e]}function bhe(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return EK;const n=10**e;return function(r){this._+=r[0];for(let s=1,l=r.length;s<l;++s)this._+=Math.round(arguments[s]*n)/n+r[s]}}class xhe{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?EK:bhe(e)}moveTo(e,n){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,n){this._append`L${this._x1=+e},${this._y1=+n}`}quadraticCurveTo(e,n,r,s){this._append`Q${+e},${+n},${this._x1=+r},${this._y1=+s}`}bezierCurveTo(e,n,r,s,l,f){this._append`C${+e},${+n},${+r},${+s},${this._x1=+l},${this._y1=+f}`}arcTo(e,n,r,s,l){if(e=+e,n=+n,r=+r,s=+s,l=+l,l<0)throw new Error(`negative radius: ${l}`);let f=this._x1,i=this._y1,x=r-e,S=s-n,I=f-e,R=i-n,F=I*I+R*R;if(this._x1===null)this._append`M${this._x1=e},${this._y1=n}`;else if(F>P_)if(!(Math.abs(R*x-S*I)>P_)||!l)this._append`L${this._x1=e},${this._y1=n}`;else{let j=r-f,H=s-i,G=x*x+S*S,W=j*j+H*H,J=Math.sqrt(G),ie=Math.sqrt(F),he=l*Math.tan((nR-Math.acos((G+F-W)/(2*J*ie)))/2),ge=he/ie,fe=he/J;Math.abs(ge-1)>P_&&this._append`L${e+ge*I},${n+ge*R}`,this._append`A${l},${l},0,0,${+(R*j>I*H)},${this._x1=e+fe*x},${this._y1=n+fe*S}`}}arc(e,n,r,s,l,f){if(e=+e,n=+n,r=+r,f=!!f,r<0)throw new Error(`negative radius: ${r}`);let i=r*Math.cos(s),x=r*Math.sin(s),S=e+i,I=n+x,R=1^f,F=f?s-l:l-s;this._x1===null?this._append`M${S},${I}`:(Math.abs(this._x1-S)>P_||Math.abs(this._y1-I)>P_)&&this._append`L${S},${I}`,r&&(F<0&&(F=F%rR+rR),F>vhe?this._append`A${r},${r},0,1,${R},${e-i},${n-x}A${r},${r},0,1,${R},${this._x1=S},${this._y1=I}`:F>P_&&this._append`A${r},${r},0,${+(F>=nR)},${R},${this._x1=e+r*Math.cos(l)},${this._y1=n+r*Math.sin(l)}`)}rect(e,n,r,s){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}h${r=+r}v${+s}h${-r}Z`}toString(){return this._}}function gk(t){let e=3;return t.digits=function(n){if(!arguments.length)return e;if(n==null)e=null;else{const r=Math.floor(n);if(!(r>=0))throw new RangeError(`invalid digits: ${n}`);e=r}return t},()=>new xhe(e)}function yk(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function MK(t){this._context=t}MK.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e);break}}};function hE(t){return new MK(t)}function CK(t){return t[0]}function IK(t){return t[1]}function PK(t,e){var n=vo(!0),r=null,s=hE,l=null,f=gk(i);t=typeof t=="function"?t:t===void 0?CK:vo(t),e=typeof e=="function"?e:e===void 0?IK:vo(e);function i(x){var S,I=(x=yk(x)).length,R,F=!1,j;for(r==null&&(l=s(j=f())),S=0;S<=I;++S)!(S<I&&n(R=x[S],S,x))===F&&((F=!F)?l.lineStart():l.lineEnd()),F&&l.point(+t(R,S,x),+e(R,S,x));if(j)return l=null,j+""||null}return i.x=function(x){return arguments.length?(t=typeof x=="function"?x:vo(+x),i):t},i.y=function(x){return arguments.length?(e=typeof x=="function"?x:vo(+x),i):e},i.defined=function(x){return arguments.length?(n=typeof x=="function"?x:vo(!!x),i):n},i.curve=function(x){return arguments.length?(s=x,r!=null&&(l=s(r)),i):s},i.context=function(x){return arguments.length?(x==null?r=l=null:l=s(r=x),i):r},i}function ZS(t,e,n){var r=null,s=vo(!0),l=null,f=hE,i=null,x=gk(S);t=typeof t=="function"?t:t===void 0?CK:vo(+t),e=typeof e=="function"?e:vo(e===void 0?0:+e),n=typeof n=="function"?n:n===void 0?IK:vo(+n);function S(R){var F,j,H,G=(R=yk(R)).length,W,J=!1,ie,he=new Array(G),ge=new Array(G);for(l==null&&(i=f(ie=x())),F=0;F<=G;++F){if(!(F<G&&s(W=R[F],F,R))===J)if(J=!J)j=F,i.areaStart(),i.lineStart();else{for(i.lineEnd(),i.lineStart(),H=F-1;H>=j;--H)i.point(he[H],ge[H]);i.lineEnd(),i.areaEnd()}J&&(he[F]=+t(W,F,R),ge[F]=+e(W,F,R),i.point(r?+r(W,F,R):he[F],n?+n(W,F,R):ge[F]))}if(ie)return i=null,ie+""||null}function I(){return PK().defined(s).curve(f).context(l)}return S.x=function(R){return arguments.length?(t=typeof R=="function"?R:vo(+R),r=null,S):t},S.x0=function(R){return arguments.length?(t=typeof R=="function"?R:vo(+R),S):t},S.x1=function(R){return arguments.length?(r=R==null?null:typeof R=="function"?R:vo(+R),S):r},S.y=function(R){return arguments.length?(e=typeof R=="function"?R:vo(+R),n=null,S):e},S.y0=function(R){return arguments.length?(e=typeof R=="function"?R:vo(+R),S):e},S.y1=function(R){return arguments.length?(n=R==null?null:typeof R=="function"?R:vo(+R),S):n},S.lineX0=S.lineY0=function(){return I().x(t).y(e)},S.lineY1=function(){return I().x(t).y(n)},S.lineX1=function(){return I().x(r).y(e)},S.defined=function(R){return arguments.length?(s=typeof R=="function"?R:vo(!!R),S):s},S.curve=function(R){return arguments.length?(f=R,l!=null&&(i=f(l)),S):f},S.context=function(R){return arguments.length?(R==null?l=i=null:i=f(l=R),S):l},S}class OK{constructor(e,n){this._context=e,this._x=n}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(e,n){switch(e=+e,n=+n,this._point){case 0:{this._point=1,this._line?this._context.lineTo(e,n):this._context.moveTo(e,n);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+e)/2,this._y0,this._x0,n,e,n):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+n)/2,e,this._y0,e,n);break}}this._x0=e,this._y0=n}}function whe(t){return new OK(t,!0)}function She(t){return new OK(t,!1)}const _k={draw(t,e){const n=Rp(e/gT);t.moveTo(n,0),t.arc(0,0,n,0,uE)}},Ahe={draw(t,e){const n=Rp(e/5)/2;t.moveTo(-3*n,-n),t.lineTo(-n,-n),t.lineTo(-n,-3*n),t.lineTo(n,-3*n),t.lineTo(n,-n),t.lineTo(3*n,-n),t.lineTo(3*n,n),t.lineTo(n,n),t.lineTo(n,3*n),t.lineTo(-n,3*n),t.lineTo(-n,n),t.lineTo(-3*n,n),t.closePath()}},RK=Rp(1/3),The=RK*2,Ehe={draw(t,e){const n=Rp(e/The),r=n*RK;t.moveTo(0,-n),t.lineTo(r,0),t.lineTo(0,n),t.lineTo(-r,0),t.closePath()}},Mhe={draw(t,e){const n=Rp(e),r=-n/2;t.rect(r,r,n,n)}},Che=.8908130915292852,DK=mT(gT/10)/mT(7*gT/10),Ihe=mT(uE/10)*DK,Phe=-TK(uE/10)*DK,Ohe={draw(t,e){const n=Rp(e*Che),r=Ihe*n,s=Phe*n;t.moveTo(0,-n),t.lineTo(r,s);for(let l=1;l<5;++l){const f=uE*l/5,i=TK(f),x=mT(f);t.lineTo(x*n,-i*n),t.lineTo(i*r-x*s,x*r+i*s)}t.closePath()}},UC=Rp(3),Rhe={draw(t,e){const n=-Rp(e/(UC*3));t.moveTo(0,n*2),t.lineTo(-UC*n,-n),t.lineTo(UC*n,-n),t.closePath()}},Ld=-.5,kd=Rp(3)/2,iR=1/Rp(12),Dhe=(iR/2+1)*3,Lhe={draw(t,e){const n=Rp(e/Dhe),r=n/2,s=n*iR,l=r,f=n*iR+n,i=-l,x=f;t.moveTo(r,s),t.lineTo(l,f),t.lineTo(i,x),t.lineTo(Ld*r-kd*s,kd*r+Ld*s),t.lineTo(Ld*l-kd*f,kd*l+Ld*f),t.lineTo(Ld*i-kd*x,kd*i+Ld*x),t.lineTo(Ld*r+kd*s,Ld*s-kd*r),t.lineTo(Ld*l+kd*f,Ld*f-kd*l),t.lineTo(Ld*i+kd*x,Ld*x-kd*i),t.closePath()}};function khe(t,e){let n=null,r=gk(s);t=typeof t=="function"?t:vo(t||_k),e=typeof e=="function"?e:vo(e===void 0?64:+e);function s(){let l;if(n||(n=l=r()),t.apply(this,arguments).draw(n,+e.apply(this,arguments)),l)return n=null,l+""||null}return s.type=function(l){return arguments.length?(t=typeof l=="function"?l:vo(l),s):t},s.size=function(l){return arguments.length?(e=typeof l=="function"?l:vo(+l),s):e},s.context=function(l){return arguments.length?(n=l??null,s):n},s}function yT(){}function _T(t,e,n){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+n)/6)}function LK(t){this._context=t}LK.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:_T(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:_T(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function Nhe(t){return new LK(t)}function kK(t){this._context=t}kK.prototype={areaStart:yT,areaEnd:yT,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x2=t,this._y2=e;break;case 1:this._point=2,this._x3=t,this._y3=e;break;case 2:this._point=3,this._x4=t,this._y4=e,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+e)/6);break;default:_T(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function zhe(t){return new kK(t)}function NK(t){this._context=t}NK.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+t)/6,r=(this._y0+4*this._y1+e)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:_T(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function Bhe(t){return new NK(t)}function zK(t){this._context=t}zK.prototype={areaStart:yT,areaEnd:yT,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,e){t=+t,e=+e,this._point?this._context.lineTo(t,e):(this._point=1,this._context.moveTo(t,e))}};function jhe(t){return new zK(t)}function qF(t){return t<0?-1:1}function VF(t,e,n){var r=t._x1-t._x0,s=e-t._x1,l=(t._y1-t._y0)/(r||s<0&&-0),f=(n-t._y1)/(s||r<0&&-0),i=(l*s+f*r)/(r+s);return(qF(l)+qF(f))*Math.min(Math.abs(l),Math.abs(f),.5*Math.abs(i))||0}function $F(t,e){var n=t._x1-t._x0;return n?(3*(t._y1-t._y0)/n-e)/2:e}function qC(t,e,n){var r=t._x0,s=t._y0,l=t._x1,f=t._y1,i=(l-r)/3;t._context.bezierCurveTo(r+i,s+i*e,l-i,f-i*n,l,f)}function vT(t){this._context=t}vT.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:qC(this,this._t0,$F(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var n=NaN;if(t=+t,e=+e,!(t===this._x1&&e===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,qC(this,$F(this,n=VF(this,t,e)),n);break;default:qC(this,this._t0,n=VF(this,t,e));break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=n}}};function BK(t){this._context=new jK(t)}(BK.prototype=Object.create(vT.prototype)).point=function(t,e){vT.prototype.point.call(this,e,t)};function jK(t){this._context=t}jK.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,n,r,s,l){this._context.bezierCurveTo(e,t,r,n,l,s)}};function Fhe(t){return new vT(t)}function Uhe(t){return new BK(t)}function FK(t){this._context=t}FK.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,e=this._y,n=t.length;if(n)if(this._line?this._context.lineTo(t[0],e[0]):this._context.moveTo(t[0],e[0]),n===2)this._context.lineTo(t[1],e[1]);else for(var r=HF(t),s=HF(e),l=0,f=1;f<n;++l,++f)this._context.bezierCurveTo(r[0][l],s[0][l],r[1][l],s[1][l],t[f],e[f]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,e){this._x.push(+t),this._y.push(+e)}};function HF(t){var e,n=t.length-1,r,s=new Array(n),l=new Array(n),f=new Array(n);for(s[0]=0,l[0]=2,f[0]=t[0]+2*t[1],e=1;e<n-1;++e)s[e]=1,l[e]=4,f[e]=4*t[e]+2*t[e+1];for(s[n-1]=2,l[n-1]=7,f[n-1]=8*t[n-1]+t[n],e=1;e<n;++e)r=s[e]/l[e-1],l[e]-=r,f[e]-=r*f[e-1];for(s[n-1]=f[n-1]/l[n-1],e=n-2;e>=0;--e)s[e]=(f[e]-s[e+1])/l[e];for(l[n-1]=(t[n]+s[n-1])/2,e=0;e<n-1;++e)l[e]=2*t[e+1]-s[e+1];return[s,l]}function qhe(t){return new FK(t)}function fE(t,e){this._context=t,this._t=e}fE.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(t,e);else{var n=this._x*(1-this._t)+t*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,e)}break}}this._x=t,this._y=e}};function Vhe(t){return new fE(t,.5)}function $he(t){return new fE(t,0)}function Hhe(t){return new fE(t,1)}function e1(t,e){if((f=t.length)>1)for(var n=1,r,s,l=t[e[0]],f,i=l.length;n<f;++n)for(s=l,l=t[e[n]],r=0;r<i;++r)l[r][1]+=l[r][0]=isNaN(s[r][1])?s[r][0]:s[r][1]}function aR(t){for(var e=t.length,n=new Array(e);--e>=0;)n[e]=e;return n}function Ghe(t,e){return t[e]}function Whe(t){const e=[];return e.key=t,e}function Khe(){var t=vo([]),e=aR,n=e1,r=Ghe;function s(l){var f=Array.from(t.apply(this,arguments),Whe),i,x=f.length,S=-1,I;for(const R of l)for(i=0,++S;i<x;++i)(f[i][S]=[0,+r(R,f[i].key,S,l)]).data=R;for(i=0,I=yk(e(f));i<x;++i)f[I[i]].index=i;return n(f,I),f}return s.keys=function(l){return arguments.length?(t=typeof l=="function"?l:vo(Array.from(l)),s):t},s.value=function(l){return arguments.length?(r=typeof l=="function"?l:vo(+l),s):r},s.order=function(l){return arguments.length?(e=l==null?aR:typeof l=="function"?l:vo(Array.from(l)),s):e},s.offset=function(l){return arguments.length?(n=l??e1,s):n},s}function Yhe(t,e){if((r=t.length)>0){for(var n,r,s=0,l=t[0].length,f;s<l;++s){for(f=n=0;n<r;++n)f+=t[n][s][1]||0;if(f)for(n=0;n<r;++n)t[n][s][1]/=f}e1(t,e)}}function Xhe(t,e){if((s=t.length)>0){for(var n=0,r=t[e[0]],s,l=r.length;n<l;++n){for(var f=0,i=0;f<s;++f)i+=t[f][n][1]||0;r[n][1]+=r[n][0]=-i/2}e1(t,e)}}function Zhe(t,e){if(!(!((f=t.length)>0)||!((l=(s=t[e[0]]).length)>0))){for(var n=0,r=1,s,l,f;r<l;++r){for(var i=0,x=0,S=0;i<f;++i){for(var I=t[e[i]],R=I[r][1]||0,F=I[r-1][1]||0,j=(R-F)/2,H=0;H<i;++H){var G=t[e[H]],W=G[r][1]||0,J=G[r-1][1]||0;j+=W-J}x+=R,S+=j*R}s[r-1][1]+=s[r-1][0]=n,x&&(n-=S/x)}s[r-1][1]+=s[r-1][0]=n,e1(t,e)}}function aw(t){"@babel/helpers - typeof";return aw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},aw(t)}var Jhe=["type","size","sizeType"];function sR(){return sR=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},sR.apply(this,arguments)}function GF(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function WF(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?GF(Object(n),!0).forEach(function(r){Qhe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):GF(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Qhe(t,e,n){return e=efe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function efe(t){var e=tfe(t,"string");return aw(e)=="symbol"?e:e+""}function tfe(t,e){if(aw(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(aw(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function nfe(t,e){if(t==null)return{};var n=rfe(t,e),r,s;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(s=0;s<l.length;s++)r=l[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function rfe(t,e){if(t==null)return{};var n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;n[r]=t[r]}return n}var UK={symbolCircle:_k,symbolCross:Ahe,symbolDiamond:Ehe,symbolSquare:Mhe,symbolStar:Ohe,symbolTriangle:Rhe,symbolWye:Lhe},ife=Math.PI/180,afe=function(e){var n="symbol".concat(cE(e));return UK[n]||_k},sfe=function(e,n,r){if(n==="area")return e;switch(r){case"cross":return 5*e*e/9;case"diamond":return .5*e*e/Math.sqrt(3);case"square":return e*e;case"star":{var s=18*ife;return 1.25*e*e*(Math.tan(s)-Math.tan(s*2)*Math.pow(Math.tan(s),2))}case"triangle":return Math.sqrt(3)*e*e/4;case"wye":return(21-10*Math.sqrt(3))*e*e/8;default:return Math.PI*e*e/4}},ofe=function(e,n){UK["symbol".concat(cE(e))]=n},vk=function(e){var n=e.type,r=n===void 0?"circle":n,s=e.size,l=s===void 0?64:s,f=e.sizeType,i=f===void 0?"area":f,x=nfe(e,Jhe),S=WF(WF({},x),{},{type:r,size:l,sizeType:i}),I=function(){var W=afe(r),J=khe().type(W).size(sfe(l,i,r));return J()},R=S.className,F=S.cx,j=S.cy,H=di(S,!0);return F===+F&&j===+j&&l===+l?kt.createElement("path",sR({},H,{className:fa("recharts-symbols",R),transform:"translate(".concat(F,", ").concat(j,")"),d:I()})):null};vk.registerSymbol=ofe;function t1(t){"@babel/helpers - typeof";return t1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t1(t)}function oR(){return oR=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},oR.apply(this,arguments)}function KF(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function lfe(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?KF(Object(n),!0).forEach(function(r){sw(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):KF(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function cfe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ufe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,VK(r.key),r)}}function hfe(t,e,n){return e&&ufe(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function ffe(t,e,n){return e=bT(e),dfe(t,qK()?Reflect.construct(e,n||[],bT(t).constructor):e.apply(t,n))}function dfe(t,e){if(e&&(t1(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return pfe(t)}function pfe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function qK(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(qK=function(){return!!t})()}function bT(t){return bT=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},bT(t)}function mfe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&lR(t,e)}function lR(t,e){return lR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},lR(t,e)}function sw(t,e,n){return e=VK(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function VK(t){var e=gfe(t,"string");return t1(e)=="symbol"?e:e+""}function gfe(t,e){if(t1(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(t1(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var gp=32,bk=function(t){function e(){return cfe(this,e),ffe(this,e,arguments)}return mfe(e,t),hfe(e,[{key:"renderIcon",value:function(r){var s=this.props.inactiveColor,l=gp/2,f=gp/6,i=gp/3,x=r.inactive?s:r.color;if(r.type==="plainline")return kt.createElement("line",{strokeWidth:4,fill:"none",stroke:x,strokeDasharray:r.payload.strokeDasharray,x1:0,y1:l,x2:gp,y2:l,className:"recharts-legend-icon"});if(r.type==="line")return kt.createElement("path",{strokeWidth:4,fill:"none",stroke:x,d:"M0,".concat(l,"h").concat(i,`
            A`).concat(f,",").concat(f,",0,1,1,").concat(2*i,",").concat(l,`
            H`).concat(gp,"M").concat(2*i,",").concat(l,`
            A`).concat(f,",").concat(f,",0,1,1,").concat(i,",").concat(l),className:"recharts-legend-icon"});if(r.type==="rect")return kt.createElement("path",{stroke:"none",fill:x,d:"M0,".concat(gp/8,"h").concat(gp,"v").concat(gp*3/4,"h").concat(-32,"z"),className:"recharts-legend-icon"});if(kt.isValidElement(r.legendIcon)){var S=lfe({},r);return delete S.legendIcon,kt.cloneElement(r.legendIcon,S)}return kt.createElement(vk,{fill:x,cx:l,cy:l,size:gp,sizeType:"diameter",type:r.type})}},{key:"renderItems",value:function(){var r=this,s=this.props,l=s.payload,f=s.iconSize,i=s.layout,x=s.formatter,S=s.inactiveColor,I={x:0,y:0,width:gp,height:gp},R={display:i==="horizontal"?"inline-block":"block",marginRight:10},F={display:"inline-block",verticalAlign:"middle",marginRight:4};return l.map(function(j,H){var G=j.formatter||x,W=fa(sw(sw({"recharts-legend-item":!0},"legend-item-".concat(H),!0),"inactive",j.inactive));if(j.type==="none")return null;var J=qi(j.value)?null:j.value;Tp(!qi(j.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var ie=j.inactive?S:j.color;return kt.createElement("li",oR({className:W,style:R,key:"legend-item-".concat(H)},rv(r.props,j,H)),kt.createElement(eR,{width:f,height:f,viewBox:I,style:F},r.renderIcon(j)),kt.createElement("span",{className:"recharts-legend-item-text",style:{color:ie}},G?G(J,j,H):J))})}},{key:"render",value:function(){var r=this.props,s=r.payload,l=r.layout,f=r.align;if(!s||!s.length)return null;var i={padding:0,margin:0,textAlign:l==="horizontal"?f:"left"};return kt.createElement("ul",{className:"recharts-default-legend",style:i},this.renderItems())}}])}(st.PureComponent);sw(bk,"displayName","Legend");sw(bk,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var VC,YF;function yfe(){if(YF)return VC;YF=1;var t=sE();function e(){this.__data__=new t,this.size=0}return VC=e,VC}var $C,XF;function _fe(){if(XF)return $C;XF=1;function t(e){var n=this.__data__,r=n.delete(e);return this.size=n.size,r}return $C=t,$C}var HC,ZF;function vfe(){if(ZF)return HC;ZF=1;function t(e){return this.__data__.get(e)}return HC=t,HC}var GC,JF;function bfe(){if(JF)return GC;JF=1;function t(e){return this.__data__.has(e)}return GC=t,GC}var WC,QF;function xfe(){if(QF)return WC;QF=1;var t=sE(),e=uk(),n=hk(),r=200;function s(l,f){var i=this.__data__;if(i instanceof t){var x=i.__data__;if(!e||x.length<r-1)return x.push([l,f]),this.size=++i.size,this;i=this.__data__=new n(x)}return i.set(l,f),this.size=i.size,this}return WC=s,WC}var KC,e8;function $K(){if(e8)return KC;e8=1;var t=sE(),e=yfe(),n=_fe(),r=vfe(),s=bfe(),l=xfe();function f(i){var x=this.__data__=new t(i);this.size=x.size}return f.prototype.clear=e,f.prototype.delete=n,f.prototype.get=r,f.prototype.has=s,f.prototype.set=l,KC=f,KC}var YC,t8;function wfe(){if(t8)return YC;t8=1;var t="__lodash_hash_undefined__";function e(n){return this.__data__.set(n,t),this}return YC=e,YC}var XC,n8;function Sfe(){if(n8)return XC;n8=1;function t(e){return this.__data__.has(e)}return XC=t,XC}var ZC,r8;function HK(){if(r8)return ZC;r8=1;var t=hk(),e=wfe(),n=Sfe();function r(s){var l=-1,f=s==null?0:s.length;for(this.__data__=new t;++l<f;)this.add(s[l])}return r.prototype.add=r.prototype.push=e,r.prototype.has=n,ZC=r,ZC}var JC,i8;function GK(){if(i8)return JC;i8=1;function t(e,n){for(var r=-1,s=e==null?0:e.length;++r<s;)if(n(e[r],r,e))return!0;return!1}return JC=t,JC}var QC,a8;function WK(){if(a8)return QC;a8=1;function t(e,n){return e.has(n)}return QC=t,QC}var eI,s8;function KK(){if(s8)return eI;s8=1;var t=HK(),e=GK(),n=WK(),r=1,s=2;function l(f,i,x,S,I,R){var F=x&r,j=f.length,H=i.length;if(j!=H&&!(F&&H>j))return!1;var G=R.get(f),W=R.get(i);if(G&&W)return G==i&&W==f;var J=-1,ie=!0,he=x&s?new t:void 0;for(R.set(f,i),R.set(i,f);++J<j;){var ge=f[J],fe=i[J];if(S)var ye=F?S(fe,ge,J,i,f,R):S(ge,fe,J,f,i,R);if(ye!==void 0){if(ye)continue;ie=!1;break}if(he){if(!e(i,function(pe,be){if(!n(he,be)&&(ge===pe||I(ge,pe,x,S,R)))return he.push(be)})){ie=!1;break}}else if(!(ge===fe||I(ge,fe,x,S,R))){ie=!1;break}}return R.delete(f),R.delete(i),ie}return eI=l,eI}var tI,o8;function Afe(){if(o8)return tI;o8=1;var t=Pm(),e=t.Uint8Array;return tI=e,tI}var nI,l8;function Tfe(){if(l8)return nI;l8=1;function t(e){var n=-1,r=Array(e.size);return e.forEach(function(s,l){r[++n]=[l,s]}),r}return nI=t,nI}var rI,c8;function xk(){if(c8)return rI;c8=1;function t(e){var n=-1,r=Array(e.size);return e.forEach(function(s){r[++n]=s}),r}return rI=t,rI}var iI,u8;function Efe(){if(u8)return iI;u8=1;var t=y2(),e=Afe(),n=ck(),r=KK(),s=Tfe(),l=xk(),f=1,i=2,x="[object Boolean]",S="[object Date]",I="[object Error]",R="[object Map]",F="[object Number]",j="[object RegExp]",H="[object Set]",G="[object String]",W="[object Symbol]",J="[object ArrayBuffer]",ie="[object DataView]",he=t?t.prototype:void 0,ge=he?he.valueOf:void 0;function fe(ye,pe,be,Ae,Oe,ue,we){switch(be){case ie:if(ye.byteLength!=pe.byteLength||ye.byteOffset!=pe.byteOffset)return!1;ye=ye.buffer,pe=pe.buffer;case J:return!(ye.byteLength!=pe.byteLength||!ue(new e(ye),new e(pe)));case x:case S:case F:return n(+ye,+pe);case I:return ye.name==pe.name&&ye.message==pe.message;case j:case G:return ye==pe+"";case R:var ke=s;case H:var De=Ae&f;if(ke||(ke=l),ye.size!=pe.size&&!De)return!1;var je=we.get(ye);if(je)return je==pe;Ae|=i,we.set(ye,pe);var ze=r(ke(ye),ke(pe),Ae,Oe,ue,we);return we.delete(ye),ze;case W:if(ge)return ge.call(ye)==ge.call(pe)}return!1}return iI=fe,iI}var aI,h8;function YK(){if(h8)return aI;h8=1;function t(e,n){for(var r=-1,s=n.length,l=e.length;++r<s;)e[l+r]=n[r];return e}return aI=t,aI}var sI,f8;function Mfe(){if(f8)return sI;f8=1;var t=YK(),e=Cf();function n(r,s,l){var f=s(r);return e(r)?f:t(f,l(r))}return sI=n,sI}var oI,d8;function Cfe(){if(d8)return oI;d8=1;function t(e,n){for(var r=-1,s=e==null?0:e.length,l=0,f=[];++r<s;){var i=e[r];n(i,r,e)&&(f[l++]=i)}return f}return oI=t,oI}var lI,p8;function Ife(){if(p8)return lI;p8=1;function t(){return[]}return lI=t,lI}var cI,m8;function Pfe(){if(m8)return cI;m8=1;var t=Cfe(),e=Ife(),n=Object.prototype,r=n.propertyIsEnumerable,s=Object.getOwnPropertySymbols,l=s?function(f){return f==null?[]:(f=Object(f),t(s(f),function(i){return r.call(f,i)}))}:e;return cI=l,cI}var uI,g8;function Ofe(){if(g8)return uI;g8=1;function t(e,n){for(var r=-1,s=Array(e);++r<e;)s[r]=n(r);return s}return uI=t,uI}var hI,y8;function Rfe(){if(y8)return hI;y8=1;var t=Ag(),e=Tg(),n="[object Arguments]";function r(s){return e(s)&&t(s)==n}return hI=r,hI}var fI,_8;function wk(){if(_8)return fI;_8=1;var t=Rfe(),e=Tg(),n=Object.prototype,r=n.hasOwnProperty,s=n.propertyIsEnumerable,l=t(function(){return arguments}())?t:function(f){return e(f)&&r.call(f,"callee")&&!s.call(f,"callee")};return fI=l,fI}var Ax={exports:{}},dI,v8;function Dfe(){if(v8)return dI;v8=1;function t(){return!1}return dI=t,dI}Ax.exports;var b8;function XK(){return b8||(b8=1,function(t,e){var n=Pm(),r=Dfe(),s=e&&!e.nodeType&&e,l=s&&!0&&t&&!t.nodeType&&t,f=l&&l.exports===s,i=f?n.Buffer:void 0,x=i?i.isBuffer:void 0,S=x||r;t.exports=S}(Ax,Ax.exports)),Ax.exports}var pI,x8;function Sk(){if(x8)return pI;x8=1;var t=9007199254740991,e=/^(?:0|[1-9]\d*)$/;function n(r,s){var l=typeof r;return s=s??t,!!s&&(l=="number"||l!="symbol"&&e.test(r))&&r>-1&&r%1==0&&r<s}return pI=n,pI}var mI,w8;function Ak(){if(w8)return mI;w8=1;var t=9007199254740991;function e(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=t}return mI=e,mI}var gI,S8;function Lfe(){if(S8)return gI;S8=1;var t=Ag(),e=Ak(),n=Tg(),r="[object Arguments]",s="[object Array]",l="[object Boolean]",f="[object Date]",i="[object Error]",x="[object Function]",S="[object Map]",I="[object Number]",R="[object Object]",F="[object RegExp]",j="[object Set]",H="[object String]",G="[object WeakMap]",W="[object ArrayBuffer]",J="[object DataView]",ie="[object Float32Array]",he="[object Float64Array]",ge="[object Int8Array]",fe="[object Int16Array]",ye="[object Int32Array]",pe="[object Uint8Array]",be="[object Uint8ClampedArray]",Ae="[object Uint16Array]",Oe="[object Uint32Array]",ue={};ue[ie]=ue[he]=ue[ge]=ue[fe]=ue[ye]=ue[pe]=ue[be]=ue[Ae]=ue[Oe]=!0,ue[r]=ue[s]=ue[W]=ue[l]=ue[J]=ue[f]=ue[i]=ue[x]=ue[S]=ue[I]=ue[R]=ue[F]=ue[j]=ue[H]=ue[G]=!1;function we(ke){return n(ke)&&e(ke.length)&&!!ue[t(ke)]}return gI=we,gI}var yI,A8;function ZK(){if(A8)return yI;A8=1;function t(e){return function(n){return e(n)}}return yI=t,yI}var Tx={exports:{}};Tx.exports;var T8;function kfe(){return T8||(T8=1,function(t,e){var n=gK(),r=e&&!e.nodeType&&e,s=r&&!0&&t&&!t.nodeType&&t,l=s&&s.exports===r,f=l&&n.process,i=function(){try{var x=s&&s.require&&s.require("util").types;return x||f&&f.binding&&f.binding("util")}catch{}}();t.exports=i}(Tx,Tx.exports)),Tx.exports}var _I,E8;function JK(){if(E8)return _I;E8=1;var t=Lfe(),e=ZK(),n=kfe(),r=n&&n.isTypedArray,s=r?e(r):t;return _I=s,_I}var vI,M8;function Nfe(){if(M8)return vI;M8=1;var t=Ofe(),e=wk(),n=Cf(),r=XK(),s=Sk(),l=JK(),f=Object.prototype,i=f.hasOwnProperty;function x(S,I){var R=n(S),F=!R&&e(S),j=!R&&!F&&r(S),H=!R&&!F&&!j&&l(S),G=R||F||j||H,W=G?t(S.length,String):[],J=W.length;for(var ie in S)(I||i.call(S,ie))&&!(G&&(ie=="length"||j&&(ie=="offset"||ie=="parent")||H&&(ie=="buffer"||ie=="byteLength"||ie=="byteOffset")||s(ie,J)))&&W.push(ie);return W}return vI=x,vI}var bI,C8;function zfe(){if(C8)return bI;C8=1;var t=Object.prototype;function e(n){var r=n&&n.constructor,s=typeof r=="function"&&r.prototype||t;return n===s}return bI=e,bI}var xI,I8;function QK(){if(I8)return xI;I8=1;function t(e,n){return function(r){return e(n(r))}}return xI=t,xI}var wI,P8;function Bfe(){if(P8)return wI;P8=1;var t=QK(),e=t(Object.keys,Object);return wI=e,wI}var SI,O8;function jfe(){if(O8)return SI;O8=1;var t=zfe(),e=Bfe(),n=Object.prototype,r=n.hasOwnProperty;function s(l){if(!t(l))return e(l);var f=[];for(var i in Object(l))r.call(l,i)&&i!="constructor"&&f.push(i);return f}return SI=s,SI}var AI,R8;function v2(){if(R8)return AI;R8=1;var t=lk(),e=Ak();function n(r){return r!=null&&e(r.length)&&!t(r)}return AI=n,AI}var TI,D8;function dE(){if(D8)return TI;D8=1;var t=Nfe(),e=jfe(),n=v2();function r(s){return n(s)?t(s):e(s)}return TI=r,TI}var EI,L8;function Ffe(){if(L8)return EI;L8=1;var t=Mfe(),e=Pfe(),n=dE();function r(s){return t(s,n,e)}return EI=r,EI}var MI,k8;function Ufe(){if(k8)return MI;k8=1;var t=Ffe(),e=1,n=Object.prototype,r=n.hasOwnProperty;function s(l,f,i,x,S,I){var R=i&e,F=t(l),j=F.length,H=t(f),G=H.length;if(j!=G&&!R)return!1;for(var W=j;W--;){var J=F[W];if(!(R?J in f:r.call(f,J)))return!1}var ie=I.get(l),he=I.get(f);if(ie&&he)return ie==f&&he==l;var ge=!0;I.set(l,f),I.set(f,l);for(var fe=R;++W<j;){J=F[W];var ye=l[J],pe=f[J];if(x)var be=R?x(pe,ye,J,f,l,I):x(ye,pe,J,l,f,I);if(!(be===void 0?ye===pe||S(ye,pe,i,x,I):be)){ge=!1;break}fe||(fe=J=="constructor")}if(ge&&!fe){var Ae=l.constructor,Oe=f.constructor;Ae!=Oe&&"constructor"in l&&"constructor"in f&&!(typeof Ae=="function"&&Ae instanceof Ae&&typeof Oe=="function"&&Oe instanceof Oe)&&(ge=!1)}return I.delete(l),I.delete(f),ge}return MI=s,MI}var CI,N8;function qfe(){if(N8)return CI;N8=1;var t=pv(),e=Pm(),n=t(e,"DataView");return CI=n,CI}var II,z8;function Vfe(){if(z8)return II;z8=1;var t=pv(),e=Pm(),n=t(e,"Promise");return II=n,II}var PI,B8;function eY(){if(B8)return PI;B8=1;var t=pv(),e=Pm(),n=t(e,"Set");return PI=n,PI}var OI,j8;function $fe(){if(j8)return OI;j8=1;var t=pv(),e=Pm(),n=t(e,"WeakMap");return OI=n,OI}var RI,F8;function Hfe(){if(F8)return RI;F8=1;var t=qfe(),e=uk(),n=Vfe(),r=eY(),s=$fe(),l=Ag(),f=yK(),i="[object Map]",x="[object Object]",S="[object Promise]",I="[object Set]",R="[object WeakMap]",F="[object DataView]",j=f(t),H=f(e),G=f(n),W=f(r),J=f(s),ie=l;return(t&&ie(new t(new ArrayBuffer(1)))!=F||e&&ie(new e)!=i||n&&ie(n.resolve())!=S||r&&ie(new r)!=I||s&&ie(new s)!=R)&&(ie=function(he){var ge=l(he),fe=ge==x?he.constructor:void 0,ye=fe?f(fe):"";if(ye)switch(ye){case j:return F;case H:return i;case G:return S;case W:return I;case J:return R}return ge}),RI=ie,RI}var DI,U8;function Gfe(){if(U8)return DI;U8=1;var t=$K(),e=KK(),n=Efe(),r=Ufe(),s=Hfe(),l=Cf(),f=XK(),i=JK(),x=1,S="[object Arguments]",I="[object Array]",R="[object Object]",F=Object.prototype,j=F.hasOwnProperty;function H(G,W,J,ie,he,ge){var fe=l(G),ye=l(W),pe=fe?I:s(G),be=ye?I:s(W);pe=pe==S?R:pe,be=be==S?R:be;var Ae=pe==R,Oe=be==R,ue=pe==be;if(ue&&f(G)){if(!f(W))return!1;fe=!0,Ae=!1}if(ue&&!Ae)return ge||(ge=new t),fe||i(G)?e(G,W,J,ie,he,ge):n(G,W,pe,J,ie,he,ge);if(!(J&x)){var we=Ae&&j.call(G,"__wrapped__"),ke=Oe&&j.call(W,"__wrapped__");if(we||ke){var De=we?G.value():G,je=ke?W.value():W;return ge||(ge=new t),he(De,je,J,ie,ge)}}return ue?(ge||(ge=new t),r(G,W,J,ie,he,ge)):!1}return DI=H,DI}var LI,q8;function Tk(){if(q8)return LI;q8=1;var t=Gfe(),e=Tg();function n(r,s,l,f,i){return r===s?!0:r==null||s==null||!e(r)&&!e(s)?r!==r&&s!==s:t(r,s,l,f,n,i)}return LI=n,LI}var kI,V8;function Wfe(){if(V8)return kI;V8=1;var t=$K(),e=Tk(),n=1,r=2;function s(l,f,i,x){var S=i.length,I=S,R=!x;if(l==null)return!I;for(l=Object(l);S--;){var F=i[S];if(R&&F[2]?F[1]!==l[F[0]]:!(F[0]in l))return!1}for(;++S<I;){F=i[S];var j=F[0],H=l[j],G=F[1];if(R&&F[2]){if(H===void 0&&!(j in l))return!1}else{var W=new t;if(x)var J=x(H,G,j,l,f,W);if(!(J===void 0?e(G,H,n|r,x,W):J))return!1}}return!0}return kI=s,kI}var NI,$8;function tY(){if($8)return NI;$8=1;var t=ky();function e(n){return n===n&&!t(n)}return NI=e,NI}var zI,H8;function Kfe(){if(H8)return zI;H8=1;var t=tY(),e=dE();function n(r){for(var s=e(r),l=s.length;l--;){var f=s[l],i=r[f];s[l]=[f,i,t(i)]}return s}return zI=n,zI}var BI,G8;function nY(){if(G8)return BI;G8=1;function t(e,n){return function(r){return r==null?!1:r[e]===n&&(n!==void 0||e in Object(r))}}return BI=t,BI}var jI,W8;function Yfe(){if(W8)return jI;W8=1;var t=Wfe(),e=Kfe(),n=nY();function r(s){var l=e(s);return l.length==1&&l[0][2]?n(l[0][0],l[0][1]):function(f){return f===s||t(f,s,l)}}return jI=r,jI}var FI,K8;function Xfe(){if(K8)return FI;K8=1;function t(e,n){return e!=null&&n in Object(e)}return FI=t,FI}var UI,Y8;function Zfe(){if(Y8)return UI;Y8=1;var t=bK(),e=wk(),n=Cf(),r=Sk(),s=Ak(),l=lE();function f(i,x,S){x=t(x,i);for(var I=-1,R=x.length,F=!1;++I<R;){var j=l(x[I]);if(!(F=i!=null&&S(i,j)))break;i=i[j]}return F||++I!=R?F:(R=i==null?0:i.length,!!R&&s(R)&&r(j,R)&&(n(i)||e(i)))}return UI=f,UI}var qI,X8;function Jfe(){if(X8)return qI;X8=1;var t=Xfe(),e=Zfe();function n(r,s){return r!=null&&e(r,s,t)}return qI=n,qI}var VI,Z8;function Qfe(){if(Z8)return VI;Z8=1;var t=Tk(),e=xK(),n=Jfe(),r=ok(),s=tY(),l=nY(),f=lE(),i=1,x=2;function S(I,R){return r(I)&&s(R)?l(f(I),R):function(F){var j=e(F,I);return j===void 0&&j===R?n(F,I):t(R,j,i|x)}}return VI=S,VI}var $I,J8;function j1(){if(J8)return $I;J8=1;function t(e){return e}return $I=t,$I}var HI,Q8;function ede(){if(Q8)return HI;Q8=1;function t(e){return function(n){return n==null?void 0:n[e]}}return HI=t,HI}var GI,e7;function tde(){if(e7)return GI;e7=1;var t=dk();function e(n){return function(r){return t(r,n)}}return GI=e,GI}var WI,t7;function nde(){if(t7)return WI;t7=1;var t=ede(),e=tde(),n=ok(),r=lE();function s(l){return n(l)?t(r(l)):e(l)}return WI=s,WI}var KI,n7;function Om(){if(n7)return KI;n7=1;var t=Yfe(),e=Qfe(),n=j1(),r=Cf(),s=nde();function l(f){return typeof f=="function"?f:f==null?n:typeof f=="object"?r(f)?e(f[0],f[1]):t(f):s(f)}return KI=l,KI}var YI,r7;function rY(){if(r7)return YI;r7=1;function t(e,n,r,s){for(var l=e.length,f=r+(s?1:-1);s?f--:++f<l;)if(n(e[f],f,e))return f;return-1}return YI=t,YI}var XI,i7;function rde(){if(i7)return XI;i7=1;function t(e){return e!==e}return XI=t,XI}var ZI,a7;function ide(){if(a7)return ZI;a7=1;function t(e,n,r){for(var s=r-1,l=e.length;++s<l;)if(e[s]===n)return s;return-1}return ZI=t,ZI}var JI,s7;function ade(){if(s7)return JI;s7=1;var t=rY(),e=rde(),n=ide();function r(s,l,f){return l===l?n(s,l,f):t(s,e,f)}return JI=r,JI}var QI,o7;function sde(){if(o7)return QI;o7=1;var t=ade();function e(n,r){var s=n==null?0:n.length;return!!s&&t(n,r,0)>-1}return QI=e,QI}var eP,l7;function ode(){if(l7)return eP;l7=1;function t(e,n,r){for(var s=-1,l=e==null?0:e.length;++s<l;)if(r(n,e[s]))return!0;return!1}return eP=t,eP}var tP,c7;function lde(){if(c7)return tP;c7=1;function t(){}return tP=t,tP}var nP,u7;function cde(){if(u7)return nP;u7=1;var t=eY(),e=lde(),n=xk(),r=1/0,s=t&&1/n(new t([,-0]))[1]==r?function(l){return new t(l)}:e;return nP=s,nP}var rP,h7;function ude(){if(h7)return rP;h7=1;var t=HK(),e=sde(),n=ode(),r=WK(),s=cde(),l=xk(),f=200;function i(x,S,I){var R=-1,F=e,j=x.length,H=!0,G=[],W=G;if(I)H=!1,F=n;else if(j>=f){var J=S?null:s(x);if(J)return l(J);H=!1,F=r,W=new t}else W=S?[]:G;e:for(;++R<j;){var ie=x[R],he=S?S(ie):ie;if(ie=I||ie!==0?ie:0,H&&he===he){for(var ge=W.length;ge--;)if(W[ge]===he)continue e;S&&W.push(he),G.push(ie)}else F(W,he,I)||(W!==G&&W.push(he),G.push(ie))}return G}return rP=i,rP}var iP,f7;function hde(){if(f7)return iP;f7=1;var t=Om(),e=ude();function n(r,s){return r&&r.length?e(r,t(s,2)):[]}return iP=n,iP}var fde=hde();const d7=Xa(fde);function iY(t,e,n){return e===!0?d7(t,n):qi(e)?d7(t,e):t}function n1(t){"@babel/helpers - typeof";return n1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n1(t)}var dde=["ref"];function p7(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function Zm(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?p7(Object(n),!0).forEach(function(r){pE(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):p7(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function pde(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function m7(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,sY(r.key),r)}}function mde(t,e,n){return e&&m7(t.prototype,e),n&&m7(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function gde(t,e,n){return e=xT(e),yde(t,aY()?Reflect.construct(e,n||[],xT(t).constructor):e.apply(t,n))}function yde(t,e){if(e&&(n1(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _de(t)}function _de(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function aY(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(aY=function(){return!!t})()}function xT(t){return xT=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},xT(t)}function vde(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&cR(t,e)}function cR(t,e){return cR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},cR(t,e)}function pE(t,e,n){return e=sY(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function sY(t){var e=bde(t,"string");return n1(e)=="symbol"?e:e+""}function bde(t,e){if(n1(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(n1(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function xde(t,e){if(t==null)return{};var n=wde(t,e),r,s;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(s=0;s<l.length;s++)r=l[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function wde(t,e){if(t==null)return{};var n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;n[r]=t[r]}return n}function Sde(t){return t.value}function Ade(t,e){if(kt.isValidElement(t))return kt.cloneElement(t,e);if(typeof t=="function")return kt.createElement(t,e);e.ref;var n=xde(e,dde);return kt.createElement(bk,n)}var g7=1,Nd=function(t){function e(){var n;pde(this,e);for(var r=arguments.length,s=new Array(r),l=0;l<r;l++)s[l]=arguments[l];return n=gde(this,e,[].concat(s)),pE(n,"lastBoundingBox",{width:-1,height:-1}),n}return vde(e,t),mde(e,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var r=this.wrapperNode.getBoundingClientRect();return r.height=this.wrapperNode.offsetHeight,r.width=this.wrapperNode.offsetWidth,r}return null}},{key:"updateBBox",value:function(){var r=this.props.onBBoxUpdate,s=this.getBBox();s?(Math.abs(s.width-this.lastBoundingBox.width)>g7||Math.abs(s.height-this.lastBoundingBox.height)>g7)&&(this.lastBoundingBox.width=s.width,this.lastBoundingBox.height=s.height,r&&r(s)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,r&&r(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?Zm({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(r){var s=this.props,l=s.layout,f=s.align,i=s.verticalAlign,x=s.margin,S=s.chartWidth,I=s.chartHeight,R,F;if(!r||(r.left===void 0||r.left===null)&&(r.right===void 0||r.right===null))if(f==="center"&&l==="vertical"){var j=this.getBBoxSnapshot();R={left:((S||0)-j.width)/2}}else R=f==="right"?{right:x&&x.right||0}:{left:x&&x.left||0};if(!r||(r.top===void 0||r.top===null)&&(r.bottom===void 0||r.bottom===null))if(i==="middle"){var H=this.getBBoxSnapshot();F={top:((I||0)-H.height)/2}}else F=i==="bottom"?{bottom:x&&x.bottom||0}:{top:x&&x.top||0};return Zm(Zm({},R),F)}},{key:"render",value:function(){var r=this,s=this.props,l=s.content,f=s.width,i=s.height,x=s.wrapperStyle,S=s.payloadUniqBy,I=s.payload,R=Zm(Zm({position:"absolute",width:f||"auto",height:i||"auto"},this.getDefaultPosition(x)),x);return kt.createElement("div",{className:"recharts-legend-wrapper",style:R,ref:function(j){r.wrapperNode=j}},Ade(l,Zm(Zm({},this.props),{},{payload:iY(I,S,Sde)})))}}],[{key:"getWithHeight",value:function(r,s){var l=Zm(Zm({},this.defaultProps),r.props),f=l.layout;return f==="vertical"&&gr(r.props.height)?{height:r.props.height}:f==="horizontal"?{width:r.props.width||s}:null}}])}(st.PureComponent);pE(Nd,"displayName","Legend");pE(Nd,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var aP,y7;function Tde(){if(y7)return aP;y7=1;var t=y2(),e=wk(),n=Cf(),r=t?t.isConcatSpreadable:void 0;function s(l){return n(l)||e(l)||!!(r&&l&&l[r])}return aP=s,aP}var sP,_7;function oY(){if(_7)return sP;_7=1;var t=YK(),e=Tde();function n(r,s,l,f,i){var x=-1,S=r.length;for(l||(l=e),i||(i=[]);++x<S;){var I=r[x];s>0&&l(I)?s>1?n(I,s-1,l,f,i):t(i,I):f||(i[i.length]=I)}return i}return sP=n,sP}var oP,v7;function Ede(){if(v7)return oP;v7=1;function t(e){return function(n,r,s){for(var l=-1,f=Object(n),i=s(n),x=i.length;x--;){var S=i[e?x:++l];if(r(f[S],S,f)===!1)break}return n}}return oP=t,oP}var lP,b7;function Mde(){if(b7)return lP;b7=1;var t=Ede(),e=t();return lP=e,lP}var cP,x7;function lY(){if(x7)return cP;x7=1;var t=Mde(),e=dE();function n(r,s){return r&&t(r,s,e)}return cP=n,cP}var uP,w7;function Cde(){if(w7)return uP;w7=1;var t=v2();function e(n,r){return function(s,l){if(s==null)return s;if(!t(s))return n(s,l);for(var f=s.length,i=r?f:-1,x=Object(s);(r?i--:++i<f)&&l(x[i],i,x)!==!1;);return s}}return uP=e,uP}var hP,S7;function Ek(){if(S7)return hP;S7=1;var t=lY(),e=Cde(),n=e(t);return hP=n,hP}var fP,A7;function cY(){if(A7)return fP;A7=1;var t=Ek(),e=v2();function n(r,s){var l=-1,f=e(r)?Array(r.length):[];return t(r,function(i,x,S){f[++l]=s(i,x,S)}),f}return fP=n,fP}var dP,T7;function Ide(){if(T7)return dP;T7=1;function t(e,n){var r=e.length;for(e.sort(n);r--;)e[r]=e[r].value;return e}return dP=t,dP}var pP,E7;function Pde(){if(E7)return pP;E7=1;var t=N1();function e(n,r){if(n!==r){var s=n!==void 0,l=n===null,f=n===n,i=t(n),x=r!==void 0,S=r===null,I=r===r,R=t(r);if(!S&&!R&&!i&&n>r||i&&x&&I&&!S&&!R||l&&x&&I||!s&&I||!f)return 1;if(!l&&!i&&!R&&n<r||R&&s&&f&&!l&&!i||S&&s&&f||!x&&f||!I)return-1}return 0}return pP=e,pP}var mP,M7;function Ode(){if(M7)return mP;M7=1;var t=Pde();function e(n,r,s){for(var l=-1,f=n.criteria,i=r.criteria,x=f.length,S=s.length;++l<x;){var I=t(f[l],i[l]);if(I){if(l>=S)return I;var R=s[l];return I*(R=="desc"?-1:1)}}return n.index-r.index}return mP=e,mP}var gP,C7;function Rde(){if(C7)return gP;C7=1;var t=fk(),e=dk(),n=Om(),r=cY(),s=Ide(),l=ZK(),f=Ode(),i=j1(),x=Cf();function S(I,R,F){R.length?R=t(R,function(G){return x(G)?function(W){return e(W,G.length===1?G[0]:G)}:G}):R=[i];var j=-1;R=t(R,l(n));var H=r(I,function(G,W,J){var ie=t(R,function(he){return he(G)});return{criteria:ie,index:++j,value:G}});return s(H,function(G,W){return f(G,W,F)})}return gP=S,gP}var yP,I7;function Dde(){if(I7)return yP;I7=1;function t(e,n,r){switch(r.length){case 0:return e.call(n);case 1:return e.call(n,r[0]);case 2:return e.call(n,r[0],r[1]);case 3:return e.call(n,r[0],r[1],r[2])}return e.apply(n,r)}return yP=t,yP}var _P,P7;function Lde(){if(P7)return _P;P7=1;var t=Dde(),e=Math.max;function n(r,s,l){return s=e(s===void 0?r.length-1:s,0),function(){for(var f=arguments,i=-1,x=e(f.length-s,0),S=Array(x);++i<x;)S[i]=f[s+i];i=-1;for(var I=Array(s+1);++i<s;)I[i]=f[i];return I[s]=l(S),t(r,this,I)}}return _P=n,_P}var vP,O7;function kde(){if(O7)return vP;O7=1;function t(e){return function(){return e}}return vP=t,vP}var bP,R7;function uY(){if(R7)return bP;R7=1;var t=pv(),e=function(){try{var n=t(Object,"defineProperty");return n({},"",{}),n}catch{}}();return bP=e,bP}var xP,D7;function Nde(){if(D7)return xP;D7=1;var t=kde(),e=uY(),n=j1(),r=e?function(s,l){return e(s,"toString",{configurable:!0,enumerable:!1,value:t(l),writable:!0})}:n;return xP=r,xP}var wP,L7;function zde(){if(L7)return wP;L7=1;var t=800,e=16,n=Date.now;function r(s){var l=0,f=0;return function(){var i=n(),x=e-(i-f);if(f=i,x>0){if(++l>=t)return arguments[0]}else l=0;return s.apply(void 0,arguments)}}return wP=r,wP}var SP,k7;function Bde(){if(k7)return SP;k7=1;var t=Nde(),e=zde(),n=e(t);return SP=n,SP}var AP,N7;function jde(){if(N7)return AP;N7=1;var t=j1(),e=Lde(),n=Bde();function r(s,l){return n(e(s,l,t),s+"")}return AP=r,AP}var TP,z7;function mE(){if(z7)return TP;z7=1;var t=ck(),e=v2(),n=Sk(),r=ky();function s(l,f,i){if(!r(i))return!1;var x=typeof f;return(x=="number"?e(i)&&n(f,i.length):x=="string"&&f in i)?t(i[f],l):!1}return TP=s,TP}var EP,B7;function Fde(){if(B7)return EP;B7=1;var t=oY(),e=Rde(),n=jde(),r=mE(),s=n(function(l,f){if(l==null)return[];var i=f.length;return i>1&&r(l,f[0],f[1])?f=[]:i>2&&r(f[0],f[1],f[2])&&(f=[f[0]]),e(l,t(f,1),[])});return EP=s,EP}var Ude=Fde();const Mk=Xa(Ude);function ow(t){"@babel/helpers - typeof";return ow=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ow(t)}function uR(){return uR=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},uR.apply(this,arguments)}function qde(t,e){return Gde(t)||Hde(t,e)||$de(t,e)||Vde()}function Vde(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $de(t,e){if(t){if(typeof t=="string")return j7(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return j7(t,e)}}function j7(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Hde(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r,s,l,f,i=[],x=!0,S=!1;try{if(l=(n=n.call(t)).next,e!==0)for(;!(x=(r=l.call(n)).done)&&(i.push(r.value),i.length!==e);x=!0);}catch(I){S=!0,s=I}finally{try{if(!x&&n.return!=null&&(f=n.return(),Object(f)!==f))return}finally{if(S)throw s}}return i}}function Gde(t){if(Array.isArray(t))return t}function F7(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function MP(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?F7(Object(n),!0).forEach(function(r){Wde(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):F7(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Wde(t,e,n){return e=Kde(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Kde(t){var e=Yde(t,"string");return ow(e)=="symbol"?e:e+""}function Yde(t,e){if(ow(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(ow(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Xde(t){return Array.isArray(t)&&Lc(t[0])&&Lc(t[1])?t.join(" ~ "):t}var Zde=function(e){var n=e.separator,r=n===void 0?" : ":n,s=e.contentStyle,l=s===void 0?{}:s,f=e.itemStyle,i=f===void 0?{}:f,x=e.labelStyle,S=x===void 0?{}:x,I=e.payload,R=e.formatter,F=e.itemSorter,j=e.wrapperClassName,H=e.labelClassName,G=e.label,W=e.labelFormatter,J=e.accessibilityLayer,ie=J===void 0?!1:J,he=function(){if(I&&I.length){var we={padding:0,margin:0},ke=(F?Mk(I,F):I).map(function(De,je){if(De.type==="none")return null;var ze=MP({display:"block",paddingTop:4,paddingBottom:4,color:De.color||"#000"},i),Ue=De.formatter||R||Xde,Fe=De.value,Qe=De.name,Be=Fe,bt=Qe;if(Ue&&Be!=null&&bt!=null){var xe=Ue(Fe,Qe,De,je,I);if(Array.isArray(xe)){var Le=qde(xe,2);Be=Le[0],bt=Le[1]}else Be=xe}return kt.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(je),style:ze},Lc(bt)?kt.createElement("span",{className:"recharts-tooltip-item-name"},bt):null,Lc(bt)?kt.createElement("span",{className:"recharts-tooltip-item-separator"},r):null,kt.createElement("span",{className:"recharts-tooltip-item-value"},Be),kt.createElement("span",{className:"recharts-tooltip-item-unit"},De.unit||""))});return kt.createElement("ul",{className:"recharts-tooltip-item-list",style:we},ke)}return null},ge=MP({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},l),fe=MP({margin:0},S),ye=!aa(G),pe=ye?G:"",be=fa("recharts-default-tooltip",j),Ae=fa("recharts-tooltip-label",H);ye&&W&&I!==void 0&&I!==null&&(pe=W(G,I));var Oe=ie?{role:"status","aria-live":"assertive"}:{};return kt.createElement("div",uR({className:be,style:ge},Oe),kt.createElement("p",{className:Ae,style:fe},kt.isValidElement(pe)?pe:"".concat(pe)),he())};function lw(t){"@babel/helpers - typeof";return lw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},lw(t)}function JS(t,e,n){return e=Jde(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Jde(t){var e=Qde(t,"string");return lw(e)=="symbol"?e:e+""}function Qde(t,e){if(lw(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(lw(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var nx="recharts-tooltip-wrapper",epe={visibility:"hidden"};function tpe(t){var e=t.coordinate,n=t.translateX,r=t.translateY;return fa(nx,JS(JS(JS(JS({},"".concat(nx,"-right"),gr(n)&&e&&gr(e.x)&&n>=e.x),"".concat(nx,"-left"),gr(n)&&e&&gr(e.x)&&n<e.x),"".concat(nx,"-bottom"),gr(r)&&e&&gr(e.y)&&r>=e.y),"".concat(nx,"-top"),gr(r)&&e&&gr(e.y)&&r<e.y))}function U7(t){var e=t.allowEscapeViewBox,n=t.coordinate,r=t.key,s=t.offsetTopLeft,l=t.position,f=t.reverseDirection,i=t.tooltipDimension,x=t.viewBox,S=t.viewBoxDimension;if(l&&gr(l[r]))return l[r];var I=n[r]-i-s,R=n[r]+s;if(e[r])return f[r]?I:R;if(f[r]){var F=I,j=x[r];return F<j?Math.max(R,x[r]):Math.max(I,x[r])}var H=R+i,G=x[r]+S;return H>G?Math.max(I,x[r]):Math.max(R,x[r])}function npe(t){var e=t.translateX,n=t.translateY,r=t.useTranslate3d;return{transform:r?"translate3d(".concat(e,"px, ").concat(n,"px, 0)"):"translate(".concat(e,"px, ").concat(n,"px)")}}function rpe(t){var e=t.allowEscapeViewBox,n=t.coordinate,r=t.offsetTopLeft,s=t.position,l=t.reverseDirection,f=t.tooltipBox,i=t.useTranslate3d,x=t.viewBox,S,I,R;return f.height>0&&f.width>0&&n?(I=U7({allowEscapeViewBox:e,coordinate:n,key:"x",offsetTopLeft:r,position:s,reverseDirection:l,tooltipDimension:f.width,viewBox:x,viewBoxDimension:x.width}),R=U7({allowEscapeViewBox:e,coordinate:n,key:"y",offsetTopLeft:r,position:s,reverseDirection:l,tooltipDimension:f.height,viewBox:x,viewBoxDimension:x.height}),S=npe({translateX:I,translateY:R,useTranslate3d:i})):S=epe,{cssProperties:S,cssClasses:tpe({translateX:I,translateY:R,coordinate:n})}}function r1(t){"@babel/helpers - typeof";return r1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r1(t)}function q7(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function V7(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?q7(Object(n),!0).forEach(function(r){fR(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):q7(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function ipe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ape(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,fY(r.key),r)}}function spe(t,e,n){return e&&ape(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function ope(t,e,n){return e=wT(e),lpe(t,hY()?Reflect.construct(e,n||[],wT(t).constructor):e.apply(t,n))}function lpe(t,e){if(e&&(r1(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return cpe(t)}function cpe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function hY(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(hY=function(){return!!t})()}function wT(t){return wT=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},wT(t)}function upe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&hR(t,e)}function hR(t,e){return hR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},hR(t,e)}function fR(t,e,n){return e=fY(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function fY(t){var e=hpe(t,"string");return r1(e)=="symbol"?e:e+""}function hpe(t,e){if(r1(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(r1(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var $7=1,fpe=function(t){function e(){var n;ipe(this,e);for(var r=arguments.length,s=new Array(r),l=0;l<r;l++)s[l]=arguments[l];return n=ope(this,e,[].concat(s)),fR(n,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),fR(n,"handleKeyDown",function(f){if(f.key==="Escape"){var i,x,S,I;n.setState({dismissed:!0,dismissedAtCoordinate:{x:(i=(x=n.props.coordinate)===null||x===void 0?void 0:x.x)!==null&&i!==void 0?i:0,y:(S=(I=n.props.coordinate)===null||I===void 0?void 0:I.y)!==null&&S!==void 0?S:0}})}}),n}return upe(e,t),spe(e,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var r=this.wrapperNode.getBoundingClientRect();(Math.abs(r.width-this.state.lastBoundingBox.width)>$7||Math.abs(r.height-this.state.lastBoundingBox.height)>$7)&&this.setState({lastBoundingBox:{width:r.width,height:r.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var r,s;this.props.active&&this.updateBBox(),this.state.dismissed&&(((r=this.props.coordinate)===null||r===void 0?void 0:r.x)!==this.state.dismissedAtCoordinate.x||((s=this.props.coordinate)===null||s===void 0?void 0:s.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var r=this,s=this.props,l=s.active,f=s.allowEscapeViewBox,i=s.animationDuration,x=s.animationEasing,S=s.children,I=s.coordinate,R=s.hasPayload,F=s.isAnimationActive,j=s.offset,H=s.position,G=s.reverseDirection,W=s.useTranslate3d,J=s.viewBox,ie=s.wrapperStyle,he=rpe({allowEscapeViewBox:f,coordinate:I,offsetTopLeft:j,position:H,reverseDirection:G,tooltipBox:this.state.lastBoundingBox,useTranslate3d:W,viewBox:J}),ge=he.cssClasses,fe=he.cssProperties,ye=V7(V7({transition:F&&l?"transform ".concat(i,"ms ").concat(x):void 0},fe),{},{pointerEvents:"none",visibility:!this.state.dismissed&&l&&R?"visible":"hidden",position:"absolute",top:0,left:0},ie);return kt.createElement("div",{tabIndex:-1,className:ge,style:ye,ref:function(be){r.wrapperNode=be}},S)}}])}(st.PureComponent),dpe=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},Ny={isSsr:dpe()};function i1(t){"@babel/helpers - typeof";return i1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i1(t)}function H7(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function G7(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?H7(Object(n),!0).forEach(function(r){Ck(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):H7(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function ppe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function mpe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,pY(r.key),r)}}function gpe(t,e,n){return e&&mpe(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function ype(t,e,n){return e=ST(e),_pe(t,dY()?Reflect.construct(e,n||[],ST(t).constructor):e.apply(t,n))}function _pe(t,e){if(e&&(i1(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return vpe(t)}function vpe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function dY(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(dY=function(){return!!t})()}function ST(t){return ST=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},ST(t)}function bpe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&dR(t,e)}function dR(t,e){return dR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},dR(t,e)}function Ck(t,e,n){return e=pY(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function pY(t){var e=xpe(t,"string");return i1(e)=="symbol"?e:e+""}function xpe(t,e){if(i1(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(i1(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function wpe(t){return t.dataKey}function Spe(t,e){return kt.isValidElement(t)?kt.cloneElement(t,e):typeof t=="function"?kt.createElement(t,e):kt.createElement(Zde,e)}var Rc=function(t){function e(){return ppe(this,e),ype(this,e,arguments)}return bpe(e,t),gpe(e,[{key:"render",value:function(){var r=this,s=this.props,l=s.active,f=s.allowEscapeViewBox,i=s.animationDuration,x=s.animationEasing,S=s.content,I=s.coordinate,R=s.filterNull,F=s.isAnimationActive,j=s.offset,H=s.payload,G=s.payloadUniqBy,W=s.position,J=s.reverseDirection,ie=s.useTranslate3d,he=s.viewBox,ge=s.wrapperStyle,fe=H??[];R&&fe.length&&(fe=iY(H.filter(function(pe){return pe.value!=null&&(pe.hide!==!0||r.props.includeHidden)}),G,wpe));var ye=fe.length>0;return kt.createElement(fpe,{allowEscapeViewBox:f,animationDuration:i,animationEasing:x,isAnimationActive:F,active:l,coordinate:I,hasPayload:ye,offset:j,position:W,reverseDirection:J,useTranslate3d:ie,viewBox:he,wrapperStyle:ge},Spe(S,G7(G7({},this.props),{},{payload:fe})))}}])}(st.PureComponent);Ck(Rc,"displayName","Tooltip");Ck(Rc,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!Ny.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var CP,W7;function Ape(){if(W7)return CP;W7=1;var t=Pm(),e=function(){return t.Date.now()};return CP=e,CP}var IP,K7;function Tpe(){if(K7)return IP;K7=1;var t=/\s/;function e(n){for(var r=n.length;r--&&t.test(n.charAt(r)););return r}return IP=e,IP}var PP,Y7;function Epe(){if(Y7)return PP;Y7=1;var t=Tpe(),e=/^\s+/;function n(r){return r&&r.slice(0,t(r)+1).replace(e,"")}return PP=n,PP}var OP,X7;function mY(){if(X7)return OP;X7=1;var t=Epe(),e=ky(),n=N1(),r=NaN,s=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,f=/^0o[0-7]+$/i,i=parseInt;function x(S){if(typeof S=="number")return S;if(n(S))return r;if(e(S)){var I=typeof S.valueOf=="function"?S.valueOf():S;S=e(I)?I+"":I}if(typeof S!="string")return S===0?S:+S;S=t(S);var R=l.test(S);return R||f.test(S)?i(S.slice(2),R?2:8):s.test(S)?r:+S}return OP=x,OP}var RP,Z7;function Mpe(){if(Z7)return RP;Z7=1;var t=ky(),e=Ape(),n=mY(),r="Expected a function",s=Math.max,l=Math.min;function f(i,x,S){var I,R,F,j,H,G,W=0,J=!1,ie=!1,he=!0;if(typeof i!="function")throw new TypeError(r);x=n(x)||0,t(S)&&(J=!!S.leading,ie="maxWait"in S,F=ie?s(n(S.maxWait)||0,x):F,he="trailing"in S?!!S.trailing:he);function ge(ke){var De=I,je=R;return I=R=void 0,W=ke,j=i.apply(je,De),j}function fe(ke){return W=ke,H=setTimeout(be,x),J?ge(ke):j}function ye(ke){var De=ke-G,je=ke-W,ze=x-De;return ie?l(ze,F-je):ze}function pe(ke){var De=ke-G,je=ke-W;return G===void 0||De>=x||De<0||ie&&je>=F}function be(){var ke=e();if(pe(ke))return Ae(ke);H=setTimeout(be,ye(ke))}function Ae(ke){return H=void 0,he&&I?ge(ke):(I=R=void 0,j)}function Oe(){H!==void 0&&clearTimeout(H),W=0,I=G=R=H=void 0}function ue(){return H===void 0?j:Ae(e())}function we(){var ke=e(),De=pe(ke);if(I=arguments,R=this,G=ke,De){if(H===void 0)return fe(G);if(ie)return clearTimeout(H),H=setTimeout(be,x),ge(G)}return H===void 0&&(H=setTimeout(be,x)),j}return we.cancel=Oe,we.flush=ue,we}return RP=f,RP}var DP,J7;function Cpe(){if(J7)return DP;J7=1;var t=Mpe(),e=ky(),n="Expected a function";function r(s,l,f){var i=!0,x=!0;if(typeof s!="function")throw new TypeError(n);return e(f)&&(i="leading"in f?!!f.leading:i,x="trailing"in f?!!f.trailing:x),t(s,l,{leading:i,maxWait:l,trailing:x})}return DP=r,DP}var Ipe=Cpe();const gY=Xa(Ipe);function cw(t){"@babel/helpers - typeof";return cw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cw(t)}function Q7(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function QS(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Q7(Object(n),!0).forEach(function(r){Ppe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Q7(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Ppe(t,e,n){return e=Ope(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ope(t){var e=Rpe(t,"string");return cw(e)=="symbol"?e:e+""}function Rpe(t,e){if(cw(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(cw(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Dpe(t,e){return zpe(t)||Npe(t,e)||kpe(t,e)||Lpe()}function Lpe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kpe(t,e){if(t){if(typeof t=="string")return eU(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eU(t,e)}}function eU(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Npe(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r,s,l,f,i=[],x=!0,S=!1;try{if(l=(n=n.call(t)).next,e!==0)for(;!(x=(r=l.call(n)).done)&&(i.push(r.value),i.length!==e);x=!0);}catch(I){S=!0,s=I}finally{try{if(!x&&n.return!=null&&(f=n.return(),Object(f)!==f))return}finally{if(S)throw s}}return i}}function zpe(t){if(Array.isArray(t))return t}var fm=st.forwardRef(function(t,e){var n=t.aspect,r=t.initialDimension,s=r===void 0?{width:-1,height:-1}:r,l=t.width,f=l===void 0?"100%":l,i=t.height,x=i===void 0?"100%":i,S=t.minWidth,I=S===void 0?0:S,R=t.minHeight,F=t.maxHeight,j=t.children,H=t.debounce,G=H===void 0?0:H,W=t.id,J=t.className,ie=t.onResize,he=t.style,ge=he===void 0?{}:he,fe=st.useRef(null),ye=st.useRef();ye.current=ie,st.useImperativeHandle(e,function(){return Object.defineProperty(fe.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),fe.current},configurable:!0})});var pe=st.useState({containerWidth:s.width,containerHeight:s.height}),be=Dpe(pe,2),Ae=be[0],Oe=be[1],ue=st.useCallback(function(ke,De){Oe(function(je){var ze=Math.round(ke),Ue=Math.round(De);return je.containerWidth===ze&&je.containerHeight===Ue?je:{containerWidth:ze,containerHeight:Ue}})},[]);st.useEffect(function(){var ke=function(Qe){var Be,bt=Qe[0].contentRect,xe=bt.width,Le=bt.height;ue(xe,Le),(Be=ye.current)===null||Be===void 0||Be.call(ye,xe,Le)};G>0&&(ke=gY(ke,G,{trailing:!0,leading:!1}));var De=new ResizeObserver(ke),je=fe.current.getBoundingClientRect(),ze=je.width,Ue=je.height;return ue(ze,Ue),De.observe(fe.current),function(){De.disconnect()}},[ue,G]);var we=st.useMemo(function(){var ke=Ae.containerWidth,De=Ae.containerHeight;if(ke<0||De<0)return null;Tp(B_(f)||B_(x),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,f,x),Tp(!n||n>0,"The aspect(%s) must be greater than zero.",n);var je=B_(f)?ke:f,ze=B_(x)?De:x;n&&n>0&&(je?ze=je/n:ze&&(je=ze*n),F&&ze>F&&(ze=F)),Tp(je>0||ze>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,je,ze,f,x,I,R,n);var Ue=!Array.isArray(j)&&cg(j.type).endsWith("Chart");return kt.Children.map(j,function(Fe){return kt.isValidElement(Fe)?st.cloneElement(Fe,QS({width:je,height:ze},Ue?{style:QS({height:"100%",width:"100%",maxHeight:ze,maxWidth:je},Fe.props.style)}:{})):Fe})},[n,j,x,F,R,I,Ae,f]);return kt.createElement("div",{id:W?"".concat(W):void 0,className:fa("recharts-responsive-container",J),style:QS(QS({},ge),{},{width:f,height:x,minWidth:I,minHeight:R,maxHeight:F}),ref:fe},we)}),uw=function(e){return null};uw.displayName="Cell";function hw(t){"@babel/helpers - typeof";return hw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hw(t)}function tU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function pR(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?tU(Object(n),!0).forEach(function(r){Bpe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):tU(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Bpe(t,e,n){return e=jpe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function jpe(t){var e=Fpe(t,"string");return hw(e)=="symbol"?e:e+""}function Fpe(t,e){if(hw(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(hw(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var o0={widthCache:{},cacheCount:0},Upe=2e3,qpe={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},nU="recharts_measurement_span";function Vpe(t){var e=pR({},t);return Object.keys(e).forEach(function(n){e[n]||delete e[n]}),e}var Rx=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e==null||Ny.isSsr)return{width:0,height:0};var r=Vpe(n),s=JSON.stringify({text:e,copyStyle:r});if(o0.widthCache[s])return o0.widthCache[s];try{var l=document.getElementById(nU);l||(l=document.createElement("span"),l.setAttribute("id",nU),l.setAttribute("aria-hidden","true"),document.body.appendChild(l));var f=pR(pR({},qpe),r);Object.assign(l.style,f),l.textContent="".concat(e);var i=l.getBoundingClientRect(),x={width:i.width,height:i.height};return o0.widthCache[s]=x,++o0.cacheCount>Upe&&(o0.cacheCount=0,o0.widthCache={}),x}catch{return{width:0,height:0}}},$pe=function(e){return{top:e.top+window.scrollY-document.documentElement.clientTop,left:e.left+window.scrollX-document.documentElement.clientLeft}};function fw(t){"@babel/helpers - typeof";return fw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fw(t)}function AT(t,e){return Kpe(t)||Wpe(t,e)||Gpe(t,e)||Hpe()}function Hpe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Gpe(t,e){if(t){if(typeof t=="string")return rU(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rU(t,e)}}function rU(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Wpe(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r,s,l,f,i=[],x=!0,S=!1;try{if(l=(n=n.call(t)).next,e===0){if(Object(n)!==n)return;x=!1}else for(;!(x=(r=l.call(n)).done)&&(i.push(r.value),i.length!==e);x=!0);}catch(I){S=!0,s=I}finally{try{if(!x&&n.return!=null&&(f=n.return(),Object(f)!==f))return}finally{if(S)throw s}}return i}}function Kpe(t){if(Array.isArray(t))return t}function Ype(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function iU(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Zpe(r.key),r)}}function Xpe(t,e,n){return e&&iU(t.prototype,e),n&&iU(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Zpe(t){var e=Jpe(t,"string");return fw(e)=="symbol"?e:e+""}function Jpe(t,e){if(fw(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(fw(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var aU=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,sU=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,Qpe=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,eme=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,yY={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},tme=Object.keys(yY),S0="NaN";function nme(t,e){return t*yY[e]}var eA=function(){function t(e,n){Ype(this,t),this.num=e,this.unit=n,this.num=e,this.unit=n,Number.isNaN(e)&&(this.unit=""),n!==""&&!Qpe.test(n)&&(this.num=NaN,this.unit=""),tme.includes(n)&&(this.num=nme(e,n),this.unit="px")}return Xpe(t,[{key:"add",value:function(n){return this.unit!==n.unit?new t(NaN,""):new t(this.num+n.num,this.unit)}},{key:"subtract",value:function(n){return this.unit!==n.unit?new t(NaN,""):new t(this.num-n.num,this.unit)}},{key:"multiply",value:function(n){return this.unit!==""&&n.unit!==""&&this.unit!==n.unit?new t(NaN,""):new t(this.num*n.num,this.unit||n.unit)}},{key:"divide",value:function(n){return this.unit!==""&&n.unit!==""&&this.unit!==n.unit?new t(NaN,""):new t(this.num/n.num,this.unit||n.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(n){var r,s=(r=eme.exec(n))!==null&&r!==void 0?r:[],l=AT(s,3),f=l[1],i=l[2];return new t(parseFloat(f),i??"")}}])}();function _Y(t){if(t.includes(S0))return S0;for(var e=t;e.includes("*")||e.includes("/");){var n,r=(n=aU.exec(e))!==null&&n!==void 0?n:[],s=AT(r,4),l=s[1],f=s[2],i=s[3],x=eA.parse(l??""),S=eA.parse(i??""),I=f==="*"?x.multiply(S):x.divide(S);if(I.isNaN())return S0;e=e.replace(aU,I.toString())}for(;e.includes("+")||/.-\d+(?:\.\d+)?/.test(e);){var R,F=(R=sU.exec(e))!==null&&R!==void 0?R:[],j=AT(F,4),H=j[1],G=j[2],W=j[3],J=eA.parse(H??""),ie=eA.parse(W??""),he=G==="+"?J.add(ie):J.subtract(ie);if(he.isNaN())return S0;e=e.replace(sU,he.toString())}return e}var oU=/\(([^()]*)\)/;function rme(t){for(var e=t;e.includes("(");){var n=oU.exec(e),r=AT(n,2),s=r[1];e=e.replace(oU,_Y(s))}return e}function ime(t){var e=t.replace(/\s+/g,"");return e=rme(e),e=_Y(e),e}function ame(t){try{return ime(t)}catch{return S0}}function LP(t){var e=ame(t.slice(5,-1));return e===S0?"":e}var sme=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],ome=["dx","dy","angle","className","breakAll"];function mR(){return mR=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},mR.apply(this,arguments)}function lU(t,e){if(t==null)return{};var n=lme(t,e),r,s;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(s=0;s<l.length;s++)r=l[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function lme(t,e){if(t==null)return{};var n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;n[r]=t[r]}return n}function cU(t,e){return fme(t)||hme(t,e)||ume(t,e)||cme()}function cme(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ume(t,e){if(t){if(typeof t=="string")return uU(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return uU(t,e)}}function uU(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function hme(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r,s,l,f,i=[],x=!0,S=!1;try{if(l=(n=n.call(t)).next,e===0){if(Object(n)!==n)return;x=!1}else for(;!(x=(r=l.call(n)).done)&&(i.push(r.value),i.length!==e);x=!0);}catch(I){S=!0,s=I}finally{try{if(!x&&n.return!=null&&(f=n.return(),Object(f)!==f))return}finally{if(S)throw s}}return i}}function fme(t){if(Array.isArray(t))return t}var vY=/[ \f\n\r\t\v\u2028\u2029]+/,bY=function(e){var n=e.children,r=e.breakAll,s=e.style;try{var l=[];aa(n)||(r?l=n.toString().split(""):l=n.toString().split(vY));var f=l.map(function(x){return{word:x,width:Rx(x,s).width}}),i=r?0:Rx(" ",s).width;return{wordsWithComputedWidth:f,spaceWidth:i}}catch{return null}},dme=function(e,n,r,s,l){var f=e.maxLines,i=e.children,x=e.style,S=e.breakAll,I=gr(f),R=i,F=function(){var je=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return je.reduce(function(ze,Ue){var Fe=Ue.word,Qe=Ue.width,Be=ze[ze.length-1];if(Be&&(s==null||l||Be.width+Qe+r<Number(s)))Be.words.push(Fe),Be.width+=Qe+r;else{var bt={words:[Fe],width:Qe};ze.push(bt)}return ze},[])},j=F(n),H=function(je){return je.reduce(function(ze,Ue){return ze.width>Ue.width?ze:Ue})};if(!I)return j;for(var G="…",W=function(je){var ze=R.slice(0,je),Ue=bY({breakAll:S,style:x,children:ze+G}).wordsWithComputedWidth,Fe=F(Ue),Qe=Fe.length>f||H(Fe).width>Number(s);return[Qe,Fe]},J=0,ie=R.length-1,he=0,ge;J<=ie&&he<=R.length-1;){var fe=Math.floor((J+ie)/2),ye=fe-1,pe=W(ye),be=cU(pe,2),Ae=be[0],Oe=be[1],ue=W(fe),we=cU(ue,1),ke=we[0];if(!Ae&&!ke&&(J=fe+1),Ae&&ke&&(ie=fe-1),!Ae&&ke){ge=Oe;break}he++}return ge||j},hU=function(e){var n=aa(e)?[]:e.toString().split(vY);return[{words:n}]},pme=function(e){var n=e.width,r=e.scaleToFit,s=e.children,l=e.style,f=e.breakAll,i=e.maxLines;if((n||r)&&!Ny.isSsr){var x,S,I=bY({breakAll:f,children:s,style:l});if(I){var R=I.wordsWithComputedWidth,F=I.spaceWidth;x=R,S=F}else return hU(s);return dme({breakAll:f,children:s,maxLines:i,style:l},x,S,n,r)}return hU(s)},fU="#808080",iv=function(e){var n=e.x,r=n===void 0?0:n,s=e.y,l=s===void 0?0:s,f=e.lineHeight,i=f===void 0?"1em":f,x=e.capHeight,S=x===void 0?"0.71em":x,I=e.scaleToFit,R=I===void 0?!1:I,F=e.textAnchor,j=F===void 0?"start":F,H=e.verticalAnchor,G=H===void 0?"end":H,W=e.fill,J=W===void 0?fU:W,ie=lU(e,sme),he=st.useMemo(function(){return pme({breakAll:ie.breakAll,children:ie.children,maxLines:ie.maxLines,scaleToFit:R,style:ie.style,width:ie.width})},[ie.breakAll,ie.children,ie.maxLines,R,ie.style,ie.width]),ge=ie.dx,fe=ie.dy,ye=ie.angle,pe=ie.className,be=ie.breakAll,Ae=lU(ie,ome);if(!Lc(r)||!Lc(l))return null;var Oe=r+(gr(ge)?ge:0),ue=l+(gr(fe)?fe:0),we;switch(G){case"start":we=LP("calc(".concat(S,")"));break;case"middle":we=LP("calc(".concat((he.length-1)/2," * -").concat(i," + (").concat(S," / 2))"));break;default:we=LP("calc(".concat(he.length-1," * -").concat(i,")"));break}var ke=[];if(R){var De=he[0].width,je=ie.width;ke.push("scale(".concat((gr(je)?je/De:1)/De,")"))}return ye&&ke.push("rotate(".concat(ye,", ").concat(Oe,", ").concat(ue,")")),ke.length&&(Ae.transform=ke.join(" ")),kt.createElement("text",mR({},di(Ae,!0),{x:Oe,y:ue,className:fa("recharts-text",pe),textAnchor:j,fill:J.includes("url")?fU:J}),he.map(function(ze,Ue){var Fe=ze.words.join(be?"":" ");return kt.createElement("tspan",{x:Oe,dy:Ue===0?we:i,key:"".concat(Fe,"-").concat(Ue)},Fe)}))};function Ty(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function mme(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Ik(t){let e,n,r;t.length!==2?(e=Ty,n=(i,x)=>Ty(t(i),x),r=(i,x)=>t(i)-x):(e=t===Ty||t===mme?t:gme,n=t,r=t);function s(i,x,S=0,I=i.length){if(S<I){if(e(x,x)!==0)return I;do{const R=S+I>>>1;n(i[R],x)<0?S=R+1:I=R}while(S<I)}return S}function l(i,x,S=0,I=i.length){if(S<I){if(e(x,x)!==0)return I;do{const R=S+I>>>1;n(i[R],x)<=0?S=R+1:I=R}while(S<I)}return S}function f(i,x,S=0,I=i.length){const R=s(i,x,S,I-1);return R>S&&r(i[R-1],x)>-r(i[R],x)?R-1:R}return{left:s,center:f,right:l}}function gme(){return 0}function xY(t){return t===null?NaN:+t}function*yme(t,e){for(let n of t)n!=null&&(n=+n)>=n&&(yield n)}const _me=Ik(Ty),b2=_me.right;Ik(xY).center;class dU extends Map{constructor(e,n=xme){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),e!=null)for(const[r,s]of e)this.set(r,s)}get(e){return super.get(pU(this,e))}has(e){return super.has(pU(this,e))}set(e,n){return super.set(vme(this,e),n)}delete(e){return super.delete(bme(this,e))}}function pU({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):n}function vme({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):(t.set(r,n),n)}function bme({_intern:t,_key:e},n){const r=e(n);return t.has(r)&&(n=t.get(r),t.delete(r)),n}function xme(t){return t!==null&&typeof t=="object"?t.valueOf():t}function wme(t=Ty){if(t===Ty)return wY;if(typeof t!="function")throw new TypeError("compare is not a function");return(e,n)=>{const r=t(e,n);return r||r===0?r:(t(n,n)===0)-(t(e,e)===0)}}function wY(t,e){return(t==null||!(t>=t))-(e==null||!(e>=e))||(t<e?-1:t>e?1:0)}const Sme=Math.sqrt(50),Ame=Math.sqrt(10),Tme=Math.sqrt(2);function TT(t,e,n){const r=(e-t)/Math.max(0,n),s=Math.floor(Math.log10(r)),l=r/Math.pow(10,s),f=l>=Sme?10:l>=Ame?5:l>=Tme?2:1;let i,x,S;return s<0?(S=Math.pow(10,-s)/f,i=Math.round(t*S),x=Math.round(e*S),i/S<t&&++i,x/S>e&&--x,S=-S):(S=Math.pow(10,s)*f,i=Math.round(t/S),x=Math.round(e/S),i*S<t&&++i,x*S>e&&--x),x<i&&.5<=n&&n<2?TT(t,e,n*2):[i,x,S]}function gR(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const r=e<t,[s,l,f]=r?TT(e,t,n):TT(t,e,n);if(!(l>=s))return[];const i=l-s+1,x=new Array(i);if(r)if(f<0)for(let S=0;S<i;++S)x[S]=(l-S)/-f;else for(let S=0;S<i;++S)x[S]=(l-S)*f;else if(f<0)for(let S=0;S<i;++S)x[S]=(s+S)/-f;else for(let S=0;S<i;++S)x[S]=(s+S)*f;return x}function yR(t,e,n){return e=+e,t=+t,n=+n,TT(t,e,n)[2]}function _R(t,e,n){e=+e,t=+t,n=+n;const r=e<t,s=r?yR(e,t,n):yR(t,e,n);return(r?-1:1)*(s<0?1/-s:s)}function mU(t,e){let n;for(const r of t)r!=null&&(n<r||n===void 0&&r>=r)&&(n=r);return n}function gU(t,e){let n;for(const r of t)r!=null&&(n>r||n===void 0&&r>=r)&&(n=r);return n}function SY(t,e,n=0,r=1/0,s){if(e=Math.floor(e),n=Math.floor(Math.max(0,n)),r=Math.floor(Math.min(t.length-1,r)),!(n<=e&&e<=r))return t;for(s=s===void 0?wY:wme(s);r>n;){if(r-n>600){const x=r-n+1,S=e-n+1,I=Math.log(x),R=.5*Math.exp(2*I/3),F=.5*Math.sqrt(I*R*(x-R)/x)*(S-x/2<0?-1:1),j=Math.max(n,Math.floor(e-S*R/x+F)),H=Math.min(r,Math.floor(e+(x-S)*R/x+F));SY(t,e,j,H,s)}const l=t[e];let f=n,i=r;for(rx(t,n,e),s(t[r],l)>0&&rx(t,n,r);f<i;){for(rx(t,f,i),++f,--i;s(t[f],l)<0;)++f;for(;s(t[i],l)>0;)--i}s(t[n],l)===0?rx(t,n,i):(++i,rx(t,i,r)),i<=e&&(n=i+1),e<=i&&(r=i-1)}return t}function rx(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function Eme(t,e,n){if(t=Float64Array.from(yme(t)),!(!(r=t.length)||isNaN(e=+e))){if(e<=0||r<2)return gU(t);if(e>=1)return mU(t);var r,s=(r-1)*e,l=Math.floor(s),f=mU(SY(t,l).subarray(0,l+1)),i=gU(t.subarray(l+1));return f+(i-f)*(s-l)}}function Mme(t,e,n=xY){if(!(!(r=t.length)||isNaN(e=+e))){if(e<=0||r<2)return+n(t[0],0,t);if(e>=1)return+n(t[r-1],r-1,t);var r,s=(r-1)*e,l=Math.floor(s),f=+n(t[l],l,t),i=+n(t[l+1],l+1,t);return f+(i-f)*(s-l)}}function Cme(t,e,n){t=+t,e=+e,n=(s=arguments.length)<2?(e=t,t=0,1):s<3?1:+n;for(var r=-1,s=Math.max(0,Math.ceil((e-t)/n))|0,l=new Array(s);++r<s;)l[r]=t+r*n;return l}function qd(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function Eg(t,e){switch(arguments.length){case 0:break;case 1:{typeof t=="function"?this.interpolator(t):this.range(t);break}default:{this.domain(t),typeof e=="function"?this.interpolator(e):this.range(e);break}}return this}const vR=Symbol("implicit");function Pk(){var t=new dU,e=[],n=[],r=vR;function s(l){let f=t.get(l);if(f===void 0){if(r!==vR)return r;t.set(l,f=e.push(l)-1)}return n[f%n.length]}return s.domain=function(l){if(!arguments.length)return e.slice();e=[],t=new dU;for(const f of l)t.has(f)||t.set(f,e.push(f)-1);return s},s.range=function(l){return arguments.length?(n=Array.from(l),s):n.slice()},s.unknown=function(l){return arguments.length?(r=l,s):r},s.copy=function(){return Pk(e,n).unknown(r)},qd.apply(s,arguments),s}function dw(){var t=Pk().unknown(void 0),e=t.domain,n=t.range,r=0,s=1,l,f,i=!1,x=0,S=0,I=.5;delete t.unknown;function R(){var F=e().length,j=s<r,H=j?s:r,G=j?r:s;l=(G-H)/Math.max(1,F-x+S*2),i&&(l=Math.floor(l)),H+=(G-H-l*(F-x))*I,f=l*(1-x),i&&(H=Math.round(H),f=Math.round(f));var W=Cme(F).map(function(J){return H+l*J});return n(j?W.reverse():W)}return t.domain=function(F){return arguments.length?(e(F),R()):e()},t.range=function(F){return arguments.length?([r,s]=F,r=+r,s=+s,R()):[r,s]},t.rangeRound=function(F){return[r,s]=F,r=+r,s=+s,i=!0,R()},t.bandwidth=function(){return f},t.step=function(){return l},t.round=function(F){return arguments.length?(i=!!F,R()):i},t.padding=function(F){return arguments.length?(x=Math.min(1,S=+F),R()):x},t.paddingInner=function(F){return arguments.length?(x=Math.min(1,F),R()):x},t.paddingOuter=function(F){return arguments.length?(S=+F,R()):S},t.align=function(F){return arguments.length?(I=Math.max(0,Math.min(1,F)),R()):I},t.copy=function(){return dw(e(),[r,s]).round(i).paddingInner(x).paddingOuter(S).align(I)},qd.apply(R(),arguments)}function AY(t){var e=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,delete t.paddingOuter,t.copy=function(){return AY(e())},t}function Dx(){return AY(dw.apply(null,arguments).paddingInner(1))}function Ok(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function TY(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function x2(){}var pw=.7,ET=1/pw,B0="\\s*([+-]?\\d+)\\s*",mw="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Sm="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Ime=/^#([0-9a-f]{3,8})$/,Pme=new RegExp(`^rgb\\(${B0},${B0},${B0}\\)$`),Ome=new RegExp(`^rgb\\(${Sm},${Sm},${Sm}\\)$`),Rme=new RegExp(`^rgba\\(${B0},${B0},${B0},${mw}\\)$`),Dme=new RegExp(`^rgba\\(${Sm},${Sm},${Sm},${mw}\\)$`),Lme=new RegExp(`^hsl\\(${mw},${Sm},${Sm}\\)$`),kme=new RegExp(`^hsla\\(${mw},${Sm},${Sm},${mw}\\)$`),yU={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ok(x2,gw,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:_U,formatHex:_U,formatHex8:Nme,formatHsl:zme,formatRgb:vU,toString:vU});function _U(){return this.rgb().formatHex()}function Nme(){return this.rgb().formatHex8()}function zme(){return EY(this).formatHsl()}function vU(){return this.rgb().formatRgb()}function gw(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Ime.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?bU(e):n===3?new Tf(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?tA(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?tA(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Pme.exec(t))?new Tf(e[1],e[2],e[3],1):(e=Ome.exec(t))?new Tf(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Rme.exec(t))?tA(e[1],e[2],e[3],e[4]):(e=Dme.exec(t))?tA(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Lme.exec(t))?SU(e[1],e[2]/100,e[3]/100,1):(e=kme.exec(t))?SU(e[1],e[2]/100,e[3]/100,e[4]):yU.hasOwnProperty(t)?bU(yU[t]):t==="transparent"?new Tf(NaN,NaN,NaN,0):null}function bU(t){return new Tf(t>>16&255,t>>8&255,t&255,1)}function tA(t,e,n,r){return r<=0&&(t=e=n=NaN),new Tf(t,e,n,r)}function Bme(t){return t instanceof x2||(t=gw(t)),t?(t=t.rgb(),new Tf(t.r,t.g,t.b,t.opacity)):new Tf}function bR(t,e,n,r){return arguments.length===1?Bme(t):new Tf(t,e,n,r??1)}function Tf(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}Ok(Tf,bR,TY(x2,{brighter(t){return t=t==null?ET:Math.pow(ET,t),new Tf(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?pw:Math.pow(pw,t),new Tf(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Tf(G_(this.r),G_(this.g),G_(this.b),MT(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:xU,formatHex:xU,formatHex8:jme,formatRgb:wU,toString:wU}));function xU(){return`#${j_(this.r)}${j_(this.g)}${j_(this.b)}`}function jme(){return`#${j_(this.r)}${j_(this.g)}${j_(this.b)}${j_((isNaN(this.opacity)?1:this.opacity)*255)}`}function wU(){const t=MT(this.opacity);return`${t===1?"rgb(":"rgba("}${G_(this.r)}, ${G_(this.g)}, ${G_(this.b)}${t===1?")":`, ${t})`}`}function MT(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function G_(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function j_(t){return t=G_(t),(t<16?"0":"")+t.toString(16)}function SU(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Ap(t,e,n,r)}function EY(t){if(t instanceof Ap)return new Ap(t.h,t.s,t.l,t.opacity);if(t instanceof x2||(t=gw(t)),!t)return new Ap;if(t instanceof Ap)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,s=Math.min(e,n,r),l=Math.max(e,n,r),f=NaN,i=l-s,x=(l+s)/2;return i?(e===l?f=(n-r)/i+(n<r)*6:n===l?f=(r-e)/i+2:f=(e-n)/i+4,i/=x<.5?l+s:2-l-s,f*=60):i=x>0&&x<1?0:f,new Ap(f,i,x,t.opacity)}function Fme(t,e,n,r){return arguments.length===1?EY(t):new Ap(t,e,n,r??1)}function Ap(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}Ok(Ap,Fme,TY(x2,{brighter(t){return t=t==null?ET:Math.pow(ET,t),new Ap(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?pw:Math.pow(pw,t),new Ap(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,s=2*n-r;return new Tf(kP(t>=240?t-240:t+120,s,r),kP(t,s,r),kP(t<120?t+240:t-120,s,r),this.opacity)},clamp(){return new Ap(AU(this.h),nA(this.s),nA(this.l),MT(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=MT(this.opacity);return`${t===1?"hsl(":"hsla("}${AU(this.h)}, ${nA(this.s)*100}%, ${nA(this.l)*100}%${t===1?")":`, ${t})`}`}}));function AU(t){return t=(t||0)%360,t<0?t+360:t}function nA(t){return Math.max(0,Math.min(1,t||0))}function kP(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const Rk=t=>()=>t;function Ume(t,e){return function(n){return t+n*e}}function qme(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function Vme(t){return(t=+t)==1?MY:function(e,n){return n-e?qme(e,n,t):Rk(isNaN(e)?n:e)}}function MY(t,e){var n=e-t;return n?Ume(t,n):Rk(isNaN(t)?e:t)}const TU=function t(e){var n=Vme(e);function r(s,l){var f=n((s=bR(s)).r,(l=bR(l)).r),i=n(s.g,l.g),x=n(s.b,l.b),S=MY(s.opacity,l.opacity);return function(I){return s.r=f(I),s.g=i(I),s.b=x(I),s.opacity=S(I),s+""}}return r.gamma=t,r}(1);function $me(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),s;return function(l){for(s=0;s<n;++s)r[s]=t[s]*(1-l)+e[s]*l;return r}}function Hme(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Gme(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,s=new Array(r),l=new Array(n),f;for(f=0;f<r;++f)s[f]=F1(t[f],e[f]);for(;f<n;++f)l[f]=e[f];return function(i){for(f=0;f<r;++f)l[f]=s[f](i);return l}}function Wme(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function CT(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function Kme(t,e){var n={},r={},s;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(s in e)s in t?n[s]=F1(t[s],e[s]):r[s]=e[s];return function(l){for(s in n)r[s]=n[s](l);return r}}var xR=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,NP=new RegExp(xR.source,"g");function Yme(t){return function(){return t}}function Xme(t){return function(e){return t(e)+""}}function Zme(t,e){var n=xR.lastIndex=NP.lastIndex=0,r,s,l,f=-1,i=[],x=[];for(t=t+"",e=e+"";(r=xR.exec(t))&&(s=NP.exec(e));)(l=s.index)>n&&(l=e.slice(n,l),i[f]?i[f]+=l:i[++f]=l),(r=r[0])===(s=s[0])?i[f]?i[f]+=s:i[++f]=s:(i[++f]=null,x.push({i:f,x:CT(r,s)})),n=NP.lastIndex;return n<e.length&&(l=e.slice(n),i[f]?i[f]+=l:i[++f]=l),i.length<2?x[0]?Xme(x[0].x):Yme(e):(e=x.length,function(S){for(var I=0,R;I<e;++I)i[(R=x[I]).i]=R.x(S);return i.join("")})}function F1(t,e){var n=typeof e,r;return e==null||n==="boolean"?Rk(e):(n==="number"?CT:n==="string"?(r=gw(e))?(e=r,TU):Zme:e instanceof gw?TU:e instanceof Date?Wme:Hme(e)?$me:Array.isArray(e)?Gme:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?Kme:CT)(t,e)}function Dk(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function Jme(t,e){e===void 0&&(e=t,t=F1);for(var n=0,r=e.length-1,s=e[0],l=new Array(r<0?0:r);n<r;)l[n]=t(s,s=e[++n]);return function(f){var i=Math.max(0,Math.min(r-1,Math.floor(f*=r)));return l[i](f-i)}}function Qme(t){return function(){return t}}function IT(t){return+t}var EU=[0,1];function Yh(t){return t}function wR(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:Qme(isNaN(e)?NaN:.5)}function ege(t,e){var n;return t>e&&(n=t,t=e,e=n),function(r){return Math.max(t,Math.min(e,r))}}function tge(t,e,n){var r=t[0],s=t[1],l=e[0],f=e[1];return s<r?(r=wR(s,r),l=n(f,l)):(r=wR(r,s),l=n(l,f)),function(i){return l(r(i))}}function nge(t,e,n){var r=Math.min(t.length,e.length)-1,s=new Array(r),l=new Array(r),f=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++f<r;)s[f]=wR(t[f],t[f+1]),l[f]=n(e[f],e[f+1]);return function(i){var x=b2(t,i,1,r)-1;return l[x](s[x](i))}}function w2(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function gE(){var t=EU,e=EU,n=F1,r,s,l,f=Yh,i,x,S;function I(){var F=Math.min(t.length,e.length);return f!==Yh&&(f=ege(t[0],t[F-1])),i=F>2?nge:tge,x=S=null,R}function R(F){return F==null||isNaN(F=+F)?l:(x||(x=i(t.map(r),e,n)))(r(f(F)))}return R.invert=function(F){return f(s((S||(S=i(e,t.map(r),CT)))(F)))},R.domain=function(F){return arguments.length?(t=Array.from(F,IT),I()):t.slice()},R.range=function(F){return arguments.length?(e=Array.from(F),I()):e.slice()},R.rangeRound=function(F){return e=Array.from(F),n=Dk,I()},R.clamp=function(F){return arguments.length?(f=F?!0:Yh,I()):f!==Yh},R.interpolate=function(F){return arguments.length?(n=F,I()):n},R.unknown=function(F){return arguments.length?(l=F,R):l},function(F,j){return r=F,s=j,I()}}function Lk(){return gE()(Yh,Yh)}function rge(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function PT(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function a1(t){return t=PT(Math.abs(t)),t?t[1]:NaN}function ige(t,e){return function(n,r){for(var s=n.length,l=[],f=0,i=t[0],x=0;s>0&&i>0&&(x+i+1>r&&(i=Math.max(1,r-x)),l.push(n.substring(s-=i,s+i)),!((x+=i+1)>r));)i=t[f=(f+1)%t.length];return l.reverse().join(e)}}function age(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var sge=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function yw(t){if(!(e=sge.exec(t)))throw new Error("invalid format: "+t);var e;return new kk({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}yw.prototype=kk.prototype;function kk(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}kk.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function oge(t){e:for(var e=t.length,n=1,r=-1,s;n<e;++n)switch(t[n]){case".":r=s=n;break;case"0":r===0&&(r=n),s=n;break;default:if(!+t[n])break e;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(s+1):t}var CY;function lge(t,e){var n=PT(t,e);if(!n)return t+"";var r=n[0],s=n[1],l=s-(CY=Math.max(-8,Math.min(8,Math.floor(s/3)))*3)+1,f=r.length;return l===f?r:l>f?r+new Array(l-f+1).join("0"):l>0?r.slice(0,l)+"."+r.slice(l):"0."+new Array(1-l).join("0")+PT(t,Math.max(0,e+l-1))[0]}function MU(t,e){var n=PT(t,e);if(!n)return t+"";var r=n[0],s=n[1];return s<0?"0."+new Array(-s).join("0")+r:r.length>s+1?r.slice(0,s+1)+"."+r.slice(s+1):r+new Array(s-r.length+2).join("0")}const CU={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:rge,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>MU(t*100,e),r:MU,s:lge,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function IU(t){return t}var PU=Array.prototype.map,OU=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function cge(t){var e=t.grouping===void 0||t.thousands===void 0?IU:ige(PU.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",s=t.decimal===void 0?".":t.decimal+"",l=t.numerals===void 0?IU:age(PU.call(t.numerals,String)),f=t.percent===void 0?"%":t.percent+"",i=t.minus===void 0?"−":t.minus+"",x=t.nan===void 0?"NaN":t.nan+"";function S(R){R=yw(R);var F=R.fill,j=R.align,H=R.sign,G=R.symbol,W=R.zero,J=R.width,ie=R.comma,he=R.precision,ge=R.trim,fe=R.type;fe==="n"?(ie=!0,fe="g"):CU[fe]||(he===void 0&&(he=12),ge=!0,fe="g"),(W||F==="0"&&j==="=")&&(W=!0,F="0",j="=");var ye=G==="$"?n:G==="#"&&/[boxX]/.test(fe)?"0"+fe.toLowerCase():"",pe=G==="$"?r:/[%p]/.test(fe)?f:"",be=CU[fe],Ae=/[defgprs%]/.test(fe);he=he===void 0?6:/[gprs]/.test(fe)?Math.max(1,Math.min(21,he)):Math.max(0,Math.min(20,he));function Oe(ue){var we=ye,ke=pe,De,je,ze;if(fe==="c")ke=be(ue)+ke,ue="";else{ue=+ue;var Ue=ue<0||1/ue<0;if(ue=isNaN(ue)?x:be(Math.abs(ue),he),ge&&(ue=oge(ue)),Ue&&+ue==0&&H!=="+"&&(Ue=!1),we=(Ue?H==="("?H:i:H==="-"||H==="("?"":H)+we,ke=(fe==="s"?OU[8+CY/3]:"")+ke+(Ue&&H==="("?")":""),Ae){for(De=-1,je=ue.length;++De<je;)if(ze=ue.charCodeAt(De),48>ze||ze>57){ke=(ze===46?s+ue.slice(De+1):ue.slice(De))+ke,ue=ue.slice(0,De);break}}}ie&&!W&&(ue=e(ue,1/0));var Fe=we.length+ue.length+ke.length,Qe=Fe<J?new Array(J-Fe+1).join(F):"";switch(ie&&W&&(ue=e(Qe+ue,Qe.length?J-ke.length:1/0),Qe=""),j){case"<":ue=we+ue+ke+Qe;break;case"=":ue=we+Qe+ue+ke;break;case"^":ue=Qe.slice(0,Fe=Qe.length>>1)+we+ue+ke+Qe.slice(Fe);break;default:ue=Qe+we+ue+ke;break}return l(ue)}return Oe.toString=function(){return R+""},Oe}function I(R,F){var j=S((R=yw(R),R.type="f",R)),H=Math.max(-8,Math.min(8,Math.floor(a1(F)/3)))*3,G=Math.pow(10,-H),W=OU[8+H/3];return function(J){return j(G*J)+W}}return{format:S,formatPrefix:I}}var rA,Nk,IY;uge({thousands:",",grouping:[3],currency:["$",""]});function uge(t){return rA=cge(t),Nk=rA.format,IY=rA.formatPrefix,rA}function hge(t){return Math.max(0,-a1(Math.abs(t)))}function fge(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(a1(e)/3)))*3-a1(Math.abs(t)))}function dge(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,a1(e)-a1(t))+1}function PY(t,e,n,r){var s=_R(t,e,n),l;switch(r=yw(r??",f"),r.type){case"s":{var f=Math.max(Math.abs(t),Math.abs(e));return r.precision==null&&!isNaN(l=fge(s,f))&&(r.precision=l),IY(r,f)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(l=dge(s,Math.max(Math.abs(t),Math.abs(e))))&&(r.precision=l-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(l=hge(s))&&(r.precision=l-(r.type==="%")*2);break}}return Nk(r)}function zy(t){var e=t.domain;return t.ticks=function(n){var r=e();return gR(r[0],r[r.length-1],n??10)},t.tickFormat=function(n,r){var s=e();return PY(s[0],s[s.length-1],n??10,r)},t.nice=function(n){n==null&&(n=10);var r=e(),s=0,l=r.length-1,f=r[s],i=r[l],x,S,I=10;for(i<f&&(S=f,f=i,i=S,S=s,s=l,l=S);I-- >0;){if(S=yR(f,i,n),S===x)return r[s]=f,r[l]=i,e(r);if(S>0)f=Math.floor(f/S)*S,i=Math.ceil(i/S)*S;else if(S<0)f=Math.ceil(f*S)/S,i=Math.floor(i*S)/S;else break;x=S}return t},t}function OT(){var t=Lk();return t.copy=function(){return w2(t,OT())},qd.apply(t,arguments),zy(t)}function OY(t){var e;function n(r){return r==null||isNaN(r=+r)?e:r}return n.invert=n,n.domain=n.range=function(r){return arguments.length?(t=Array.from(r,IT),n):t.slice()},n.unknown=function(r){return arguments.length?(e=r,n):e},n.copy=function(){return OY(t).unknown(e)},t=arguments.length?Array.from(t,IT):[0,1],zy(n)}function RY(t,e){t=t.slice();var n=0,r=t.length-1,s=t[n],l=t[r],f;return l<s&&(f=n,n=r,r=f,f=s,s=l,l=f),t[n]=e.floor(s),t[r]=e.ceil(l),t}function RU(t){return Math.log(t)}function DU(t){return Math.exp(t)}function pge(t){return-Math.log(-t)}function mge(t){return-Math.exp(-t)}function gge(t){return isFinite(t)?+("1e"+t):t<0?0:t}function yge(t){return t===10?gge:t===Math.E?Math.exp:e=>Math.pow(t,e)}function _ge(t){return t===Math.E?Math.log:t===10&&Math.log10||t===2&&Math.log2||(t=Math.log(t),e=>Math.log(e)/t)}function LU(t){return(e,n)=>-t(-e,n)}function zk(t){const e=t(RU,DU),n=e.domain;let r=10,s,l;function f(){return s=_ge(r),l=yge(r),n()[0]<0?(s=LU(s),l=LU(l),t(pge,mge)):t(RU,DU),e}return e.base=function(i){return arguments.length?(r=+i,f()):r},e.domain=function(i){return arguments.length?(n(i),f()):n()},e.ticks=i=>{const x=n();let S=x[0],I=x[x.length-1];const R=I<S;R&&([S,I]=[I,S]);let F=s(S),j=s(I),H,G;const W=i==null?10:+i;let J=[];if(!(r%1)&&j-F<W){if(F=Math.floor(F),j=Math.ceil(j),S>0){for(;F<=j;++F)for(H=1;H<r;++H)if(G=F<0?H/l(-F):H*l(F),!(G<S)){if(G>I)break;J.push(G)}}else for(;F<=j;++F)for(H=r-1;H>=1;--H)if(G=F>0?H/l(-F):H*l(F),!(G<S)){if(G>I)break;J.push(G)}J.length*2<W&&(J=gR(S,I,W))}else J=gR(F,j,Math.min(j-F,W)).map(l);return R?J.reverse():J},e.tickFormat=(i,x)=>{if(i==null&&(i=10),x==null&&(x=r===10?"s":","),typeof x!="function"&&(!(r%1)&&(x=yw(x)).precision==null&&(x.trim=!0),x=Nk(x)),i===1/0)return x;const S=Math.max(1,r*i/e.ticks().length);return I=>{let R=I/l(Math.round(s(I)));return R*r<r-.5&&(R*=r),R<=S?x(I):""}},e.nice=()=>n(RY(n(),{floor:i=>l(Math.floor(s(i))),ceil:i=>l(Math.ceil(s(i)))})),e}function DY(){const t=zk(gE()).domain([1,10]);return t.copy=()=>w2(t,DY()).base(t.base()),qd.apply(t,arguments),t}function kU(t){return function(e){return Math.sign(e)*Math.log1p(Math.abs(e/t))}}function NU(t){return function(e){return Math.sign(e)*Math.expm1(Math.abs(e))*t}}function Bk(t){var e=1,n=t(kU(e),NU(e));return n.constant=function(r){return arguments.length?t(kU(e=+r),NU(e)):e},zy(n)}function LY(){var t=Bk(gE());return t.copy=function(){return w2(t,LY()).constant(t.constant())},qd.apply(t,arguments)}function zU(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function vge(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function bge(t){return t<0?-t*t:t*t}function jk(t){var e=t(Yh,Yh),n=1;function r(){return n===1?t(Yh,Yh):n===.5?t(vge,bge):t(zU(n),zU(1/n))}return e.exponent=function(s){return arguments.length?(n=+s,r()):n},zy(e)}function Fk(){var t=jk(gE());return t.copy=function(){return w2(t,Fk()).exponent(t.exponent())},qd.apply(t,arguments),t}function xge(){return Fk.apply(null,arguments).exponent(.5)}function BU(t){return Math.sign(t)*t*t}function wge(t){return Math.sign(t)*Math.sqrt(Math.abs(t))}function kY(){var t=Lk(),e=[0,1],n=!1,r;function s(l){var f=wge(t(l));return isNaN(f)?r:n?Math.round(f):f}return s.invert=function(l){return t.invert(BU(l))},s.domain=function(l){return arguments.length?(t.domain(l),s):t.domain()},s.range=function(l){return arguments.length?(t.range((e=Array.from(l,IT)).map(BU)),s):e.slice()},s.rangeRound=function(l){return s.range(l).round(!0)},s.round=function(l){return arguments.length?(n=!!l,s):n},s.clamp=function(l){return arguments.length?(t.clamp(l),s):t.clamp()},s.unknown=function(l){return arguments.length?(r=l,s):r},s.copy=function(){return kY(t.domain(),e).round(n).clamp(t.clamp()).unknown(r)},qd.apply(s,arguments),zy(s)}function NY(){var t=[],e=[],n=[],r;function s(){var f=0,i=Math.max(1,e.length);for(n=new Array(i-1);++f<i;)n[f-1]=Mme(t,f/i);return l}function l(f){return f==null||isNaN(f=+f)?r:e[b2(n,f)]}return l.invertExtent=function(f){var i=e.indexOf(f);return i<0?[NaN,NaN]:[i>0?n[i-1]:t[0],i<n.length?n[i]:t[t.length-1]]},l.domain=function(f){if(!arguments.length)return t.slice();t=[];for(let i of f)i!=null&&!isNaN(i=+i)&&t.push(i);return t.sort(Ty),s()},l.range=function(f){return arguments.length?(e=Array.from(f),s()):e.slice()},l.unknown=function(f){return arguments.length?(r=f,l):r},l.quantiles=function(){return n.slice()},l.copy=function(){return NY().domain(t).range(e).unknown(r)},qd.apply(l,arguments)}function zY(){var t=0,e=1,n=1,r=[.5],s=[0,1],l;function f(x){return x!=null&&x<=x?s[b2(r,x,0,n)]:l}function i(){var x=-1;for(r=new Array(n);++x<n;)r[x]=((x+1)*e-(x-n)*t)/(n+1);return f}return f.domain=function(x){return arguments.length?([t,e]=x,t=+t,e=+e,i()):[t,e]},f.range=function(x){return arguments.length?(n=(s=Array.from(x)).length-1,i()):s.slice()},f.invertExtent=function(x){var S=s.indexOf(x);return S<0?[NaN,NaN]:S<1?[t,r[0]]:S>=n?[r[n-1],e]:[r[S-1],r[S]]},f.unknown=function(x){return arguments.length&&(l=x),f},f.thresholds=function(){return r.slice()},f.copy=function(){return zY().domain([t,e]).range(s).unknown(l)},qd.apply(zy(f),arguments)}function BY(){var t=[.5],e=[0,1],n,r=1;function s(l){return l!=null&&l<=l?e[b2(t,l,0,r)]:n}return s.domain=function(l){return arguments.length?(t=Array.from(l),r=Math.min(t.length,e.length-1),s):t.slice()},s.range=function(l){return arguments.length?(e=Array.from(l),r=Math.min(t.length,e.length-1),s):e.slice()},s.invertExtent=function(l){var f=e.indexOf(l);return[t[f-1],t[f]]},s.unknown=function(l){return arguments.length?(n=l,s):n},s.copy=function(){return BY().domain(t).range(e).unknown(n)},qd.apply(s,arguments)}const zP=new Date,BP=new Date;function zc(t,e,n,r){function s(l){return t(l=arguments.length===0?new Date:new Date(+l)),l}return s.floor=l=>(t(l=new Date(+l)),l),s.ceil=l=>(t(l=new Date(l-1)),e(l,1),t(l),l),s.round=l=>{const f=s(l),i=s.ceil(l);return l-f<i-l?f:i},s.offset=(l,f)=>(e(l=new Date(+l),f==null?1:Math.floor(f)),l),s.range=(l,f,i)=>{const x=[];if(l=s.ceil(l),i=i==null?1:Math.floor(i),!(l<f)||!(i>0))return x;let S;do x.push(S=new Date(+l)),e(l,i),t(l);while(S<l&&l<f);return x},s.filter=l=>zc(f=>{if(f>=f)for(;t(f),!l(f);)f.setTime(f-1)},(f,i)=>{if(f>=f)if(i<0)for(;++i<=0;)for(;e(f,-1),!l(f););else for(;--i>=0;)for(;e(f,1),!l(f););}),n&&(s.count=(l,f)=>(zP.setTime(+l),BP.setTime(+f),t(zP),t(BP),Math.floor(n(zP,BP))),s.every=l=>(l=Math.floor(l),!isFinite(l)||!(l>0)?null:l>1?s.filter(r?f=>r(f)%l===0:f=>s.count(0,f)%l===0):s)),s}const RT=zc(()=>{},(t,e)=>{t.setTime(+t+e)},(t,e)=>e-t);RT.every=t=>(t=Math.floor(t),!isFinite(t)||!(t>0)?null:t>1?zc(e=>{e.setTime(Math.floor(e/t)*t)},(e,n)=>{e.setTime(+e+n*t)},(e,n)=>(n-e)/t):RT);RT.range;const ig=1e3,Fd=ig*60,ag=Fd*60,_g=ag*24,Uk=_g*7,jU=_g*30,jP=_g*365,F_=zc(t=>{t.setTime(t-t.getMilliseconds())},(t,e)=>{t.setTime(+t+e*ig)},(t,e)=>(e-t)/ig,t=>t.getUTCSeconds());F_.range;const qk=zc(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*ig)},(t,e)=>{t.setTime(+t+e*Fd)},(t,e)=>(e-t)/Fd,t=>t.getMinutes());qk.range;const Vk=zc(t=>{t.setUTCSeconds(0,0)},(t,e)=>{t.setTime(+t+e*Fd)},(t,e)=>(e-t)/Fd,t=>t.getUTCMinutes());Vk.range;const $k=zc(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*ig-t.getMinutes()*Fd)},(t,e)=>{t.setTime(+t+e*ag)},(t,e)=>(e-t)/ag,t=>t.getHours());$k.range;const Hk=zc(t=>{t.setUTCMinutes(0,0,0)},(t,e)=>{t.setTime(+t+e*ag)},(t,e)=>(e-t)/ag,t=>t.getUTCHours());Hk.range;const S2=zc(t=>t.setHours(0,0,0,0),(t,e)=>t.setDate(t.getDate()+e),(t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*Fd)/_g,t=>t.getDate()-1);S2.range;const yE=zc(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/_g,t=>t.getUTCDate()-1);yE.range;const jY=zc(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/_g,t=>Math.floor(t/_g));jY.range;function gv(t){return zc(e=>{e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},(e,n)=>{e.setDate(e.getDate()+n*7)},(e,n)=>(n-e-(n.getTimezoneOffset()-e.getTimezoneOffset())*Fd)/Uk)}const _E=gv(0),DT=gv(1),Sge=gv(2),Age=gv(3),s1=gv(4),Tge=gv(5),Ege=gv(6);_E.range;DT.range;Sge.range;Age.range;s1.range;Tge.range;Ege.range;function yv(t){return zc(e=>{e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCDate(e.getUTCDate()+n*7)},(e,n)=>(n-e)/Uk)}const vE=yv(0),LT=yv(1),Mge=yv(2),Cge=yv(3),o1=yv(4),Ige=yv(5),Pge=yv(6);vE.range;LT.range;Mge.range;Cge.range;o1.range;Ige.range;Pge.range;const Gk=zc(t=>{t.setDate(1),t.setHours(0,0,0,0)},(t,e)=>{t.setMonth(t.getMonth()+e)},(t,e)=>e.getMonth()-t.getMonth()+(e.getFullYear()-t.getFullYear())*12,t=>t.getMonth());Gk.range;const Wk=zc(t=>{t.setUTCDate(1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCMonth(t.getUTCMonth()+e)},(t,e)=>e.getUTCMonth()-t.getUTCMonth()+(e.getUTCFullYear()-t.getUTCFullYear())*12,t=>t.getUTCMonth());Wk.range;const vg=zc(t=>{t.setMonth(0,1),t.setHours(0,0,0,0)},(t,e)=>{t.setFullYear(t.getFullYear()+e)},(t,e)=>e.getFullYear()-t.getFullYear(),t=>t.getFullYear());vg.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:zc(e=>{e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)},(e,n)=>{e.setFullYear(e.getFullYear()+n*t)});vg.range;const bg=zc(t=>{t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCFullYear(t.getUTCFullYear()+e)},(t,e)=>e.getUTCFullYear()-t.getUTCFullYear(),t=>t.getUTCFullYear());bg.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:zc(e=>{e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCFullYear(e.getUTCFullYear()+n*t)});bg.range;function FY(t,e,n,r,s,l){const f=[[F_,1,ig],[F_,5,5*ig],[F_,15,15*ig],[F_,30,30*ig],[l,1,Fd],[l,5,5*Fd],[l,15,15*Fd],[l,30,30*Fd],[s,1,ag],[s,3,3*ag],[s,6,6*ag],[s,12,12*ag],[r,1,_g],[r,2,2*_g],[n,1,Uk],[e,1,jU],[e,3,3*jU],[t,1,jP]];function i(S,I,R){const F=I<S;F&&([S,I]=[I,S]);const j=R&&typeof R.range=="function"?R:x(S,I,R),H=j?j.range(S,+I+1):[];return F?H.reverse():H}function x(S,I,R){const F=Math.abs(I-S)/R,j=Ik(([,,W])=>W).right(f,F);if(j===f.length)return t.every(_R(S/jP,I/jP,R));if(j===0)return RT.every(Math.max(_R(S,I,R),1));const[H,G]=f[F/f[j-1][2]<f[j][2]/F?j-1:j];return H.every(G)}return[i,x]}const[Oge,Rge]=FY(bg,Wk,vE,jY,Hk,Vk),[Dge,Lge]=FY(vg,Gk,_E,S2,$k,qk);function FP(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function UP(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function ix(t,e,n){return{y:t,m:e,d:n,H:0,M:0,S:0,L:0}}function kge(t){var e=t.dateTime,n=t.date,r=t.time,s=t.periods,l=t.days,f=t.shortDays,i=t.months,x=t.shortMonths,S=ax(s),I=sx(s),R=ax(l),F=sx(l),j=ax(f),H=sx(f),G=ax(i),W=sx(i),J=ax(x),ie=sx(x),he={a:Ue,A:Fe,b:Qe,B:Be,c:null,d:HU,e:HU,f:iye,g:pye,G:gye,H:tye,I:nye,j:rye,L:UY,m:aye,M:sye,p:bt,q:xe,Q:KU,s:YU,S:oye,u:lye,U:cye,V:uye,w:hye,W:fye,x:null,X:null,y:dye,Y:mye,Z:yye,"%":WU},ge={a:Le,A:Xe,b:ct,B:vt,c:null,d:GU,e:GU,f:xye,g:Oye,G:Dye,H:_ye,I:vye,j:bye,L:VY,m:wye,M:Sye,p:Nt,q:mt,Q:KU,s:YU,S:Aye,u:Tye,U:Eye,V:Mye,w:Cye,W:Iye,x:null,X:null,y:Pye,Y:Rye,Z:Lye,"%":WU},fe={a:Oe,A:ue,b:we,B:ke,c:De,d:VU,e:VU,f:Zge,g:qU,G:UU,H:$U,I:$U,j:Wge,L:Xge,m:Gge,M:Kge,p:Ae,q:Hge,Q:Qge,s:eye,S:Yge,u:Fge,U:Uge,V:qge,w:jge,W:Vge,x:je,X:ze,y:qU,Y:UU,Z:$ge,"%":Jge};he.x=ye(n,he),he.X=ye(r,he),he.c=ye(e,he),ge.x=ye(n,ge),ge.X=ye(r,ge),ge.c=ye(e,ge);function ye(yt,_e){return function(on){var Kt=[],Pn=-1,Ut=0,cn=yt.length,At,xr,Rn;for(on instanceof Date||(on=new Date(+on));++Pn<cn;)yt.charCodeAt(Pn)===37&&(Kt.push(yt.slice(Ut,Pn)),(xr=FU[At=yt.charAt(++Pn)])!=null?At=yt.charAt(++Pn):xr=At==="e"?" ":"0",(Rn=_e[At])&&(At=Rn(on,xr)),Kt.push(At),Ut=Pn+1);return Kt.push(yt.slice(Ut,Pn)),Kt.join("")}}function pe(yt,_e){return function(on){var Kt=ix(1900,void 0,1),Pn=be(Kt,yt,on+="",0),Ut,cn;if(Pn!=on.length)return null;if("Q"in Kt)return new Date(Kt.Q);if("s"in Kt)return new Date(Kt.s*1e3+("L"in Kt?Kt.L:0));if(_e&&!("Z"in Kt)&&(Kt.Z=0),"p"in Kt&&(Kt.H=Kt.H%12+Kt.p*12),Kt.m===void 0&&(Kt.m="q"in Kt?Kt.q:0),"V"in Kt){if(Kt.V<1||Kt.V>53)return null;"w"in Kt||(Kt.w=1),"Z"in Kt?(Ut=UP(ix(Kt.y,0,1)),cn=Ut.getUTCDay(),Ut=cn>4||cn===0?LT.ceil(Ut):LT(Ut),Ut=yE.offset(Ut,(Kt.V-1)*7),Kt.y=Ut.getUTCFullYear(),Kt.m=Ut.getUTCMonth(),Kt.d=Ut.getUTCDate()+(Kt.w+6)%7):(Ut=FP(ix(Kt.y,0,1)),cn=Ut.getDay(),Ut=cn>4||cn===0?DT.ceil(Ut):DT(Ut),Ut=S2.offset(Ut,(Kt.V-1)*7),Kt.y=Ut.getFullYear(),Kt.m=Ut.getMonth(),Kt.d=Ut.getDate()+(Kt.w+6)%7)}else("W"in Kt||"U"in Kt)&&("w"in Kt||(Kt.w="u"in Kt?Kt.u%7:"W"in Kt?1:0),cn="Z"in Kt?UP(ix(Kt.y,0,1)).getUTCDay():FP(ix(Kt.y,0,1)).getDay(),Kt.m=0,Kt.d="W"in Kt?(Kt.w+6)%7+Kt.W*7-(cn+5)%7:Kt.w+Kt.U*7-(cn+6)%7);return"Z"in Kt?(Kt.H+=Kt.Z/100|0,Kt.M+=Kt.Z%100,UP(Kt)):FP(Kt)}}function be(yt,_e,on,Kt){for(var Pn=0,Ut=_e.length,cn=on.length,At,xr;Pn<Ut;){if(Kt>=cn)return-1;if(At=_e.charCodeAt(Pn++),At===37){if(At=_e.charAt(Pn++),xr=fe[At in FU?_e.charAt(Pn++):At],!xr||(Kt=xr(yt,on,Kt))<0)return-1}else if(At!=on.charCodeAt(Kt++))return-1}return Kt}function Ae(yt,_e,on){var Kt=S.exec(_e.slice(on));return Kt?(yt.p=I.get(Kt[0].toLowerCase()),on+Kt[0].length):-1}function Oe(yt,_e,on){var Kt=j.exec(_e.slice(on));return Kt?(yt.w=H.get(Kt[0].toLowerCase()),on+Kt[0].length):-1}function ue(yt,_e,on){var Kt=R.exec(_e.slice(on));return Kt?(yt.w=F.get(Kt[0].toLowerCase()),on+Kt[0].length):-1}function we(yt,_e,on){var Kt=J.exec(_e.slice(on));return Kt?(yt.m=ie.get(Kt[0].toLowerCase()),on+Kt[0].length):-1}function ke(yt,_e,on){var Kt=G.exec(_e.slice(on));return Kt?(yt.m=W.get(Kt[0].toLowerCase()),on+Kt[0].length):-1}function De(yt,_e,on){return be(yt,e,_e,on)}function je(yt,_e,on){return be(yt,n,_e,on)}function ze(yt,_e,on){return be(yt,r,_e,on)}function Ue(yt){return f[yt.getDay()]}function Fe(yt){return l[yt.getDay()]}function Qe(yt){return x[yt.getMonth()]}function Be(yt){return i[yt.getMonth()]}function bt(yt){return s[+(yt.getHours()>=12)]}function xe(yt){return 1+~~(yt.getMonth()/3)}function Le(yt){return f[yt.getUTCDay()]}function Xe(yt){return l[yt.getUTCDay()]}function ct(yt){return x[yt.getUTCMonth()]}function vt(yt){return i[yt.getUTCMonth()]}function Nt(yt){return s[+(yt.getUTCHours()>=12)]}function mt(yt){return 1+~~(yt.getUTCMonth()/3)}return{format:function(yt){var _e=ye(yt+="",he);return _e.toString=function(){return yt},_e},parse:function(yt){var _e=pe(yt+="",!1);return _e.toString=function(){return yt},_e},utcFormat:function(yt){var _e=ye(yt+="",ge);return _e.toString=function(){return yt},_e},utcParse:function(yt){var _e=pe(yt+="",!0);return _e.toString=function(){return yt},_e}}}var FU={"-":"",_:" ",0:"0"},ru=/^\s*\d+/,Nge=/^%/,zge=/[\\^$*+?|[\]().{}]/g;function ds(t,e,n){var r=t<0?"-":"",s=(r?-t:t)+"",l=s.length;return r+(l<n?new Array(n-l+1).join(e)+s:s)}function Bge(t){return t.replace(zge,"\\$&")}function ax(t){return new RegExp("^(?:"+t.map(Bge).join("|")+")","i")}function sx(t){return new Map(t.map((e,n)=>[e.toLowerCase(),n]))}function jge(t,e,n){var r=ru.exec(e.slice(n,n+1));return r?(t.w=+r[0],n+r[0].length):-1}function Fge(t,e,n){var r=ru.exec(e.slice(n,n+1));return r?(t.u=+r[0],n+r[0].length):-1}function Uge(t,e,n){var r=ru.exec(e.slice(n,n+2));return r?(t.U=+r[0],n+r[0].length):-1}function qge(t,e,n){var r=ru.exec(e.slice(n,n+2));return r?(t.V=+r[0],n+r[0].length):-1}function Vge(t,e,n){var r=ru.exec(e.slice(n,n+2));return r?(t.W=+r[0],n+r[0].length):-1}function UU(t,e,n){var r=ru.exec(e.slice(n,n+4));return r?(t.y=+r[0],n+r[0].length):-1}function qU(t,e,n){var r=ru.exec(e.slice(n,n+2));return r?(t.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function $ge(t,e,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return r?(t.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function Hge(t,e,n){var r=ru.exec(e.slice(n,n+1));return r?(t.q=r[0]*3-3,n+r[0].length):-1}function Gge(t,e,n){var r=ru.exec(e.slice(n,n+2));return r?(t.m=r[0]-1,n+r[0].length):-1}function VU(t,e,n){var r=ru.exec(e.slice(n,n+2));return r?(t.d=+r[0],n+r[0].length):-1}function Wge(t,e,n){var r=ru.exec(e.slice(n,n+3));return r?(t.m=0,t.d=+r[0],n+r[0].length):-1}function $U(t,e,n){var r=ru.exec(e.slice(n,n+2));return r?(t.H=+r[0],n+r[0].length):-1}function Kge(t,e,n){var r=ru.exec(e.slice(n,n+2));return r?(t.M=+r[0],n+r[0].length):-1}function Yge(t,e,n){var r=ru.exec(e.slice(n,n+2));return r?(t.S=+r[0],n+r[0].length):-1}function Xge(t,e,n){var r=ru.exec(e.slice(n,n+3));return r?(t.L=+r[0],n+r[0].length):-1}function Zge(t,e,n){var r=ru.exec(e.slice(n,n+6));return r?(t.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function Jge(t,e,n){var r=Nge.exec(e.slice(n,n+1));return r?n+r[0].length:-1}function Qge(t,e,n){var r=ru.exec(e.slice(n));return r?(t.Q=+r[0],n+r[0].length):-1}function eye(t,e,n){var r=ru.exec(e.slice(n));return r?(t.s=+r[0],n+r[0].length):-1}function HU(t,e){return ds(t.getDate(),e,2)}function tye(t,e){return ds(t.getHours(),e,2)}function nye(t,e){return ds(t.getHours()%12||12,e,2)}function rye(t,e){return ds(1+S2.count(vg(t),t),e,3)}function UY(t,e){return ds(t.getMilliseconds(),e,3)}function iye(t,e){return UY(t,e)+"000"}function aye(t,e){return ds(t.getMonth()+1,e,2)}function sye(t,e){return ds(t.getMinutes(),e,2)}function oye(t,e){return ds(t.getSeconds(),e,2)}function lye(t){var e=t.getDay();return e===0?7:e}function cye(t,e){return ds(_E.count(vg(t)-1,t),e,2)}function qY(t){var e=t.getDay();return e>=4||e===0?s1(t):s1.ceil(t)}function uye(t,e){return t=qY(t),ds(s1.count(vg(t),t)+(vg(t).getDay()===4),e,2)}function hye(t){return t.getDay()}function fye(t,e){return ds(DT.count(vg(t)-1,t),e,2)}function dye(t,e){return ds(t.getFullYear()%100,e,2)}function pye(t,e){return t=qY(t),ds(t.getFullYear()%100,e,2)}function mye(t,e){return ds(t.getFullYear()%1e4,e,4)}function gye(t,e){var n=t.getDay();return t=n>=4||n===0?s1(t):s1.ceil(t),ds(t.getFullYear()%1e4,e,4)}function yye(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+ds(e/60|0,"0",2)+ds(e%60,"0",2)}function GU(t,e){return ds(t.getUTCDate(),e,2)}function _ye(t,e){return ds(t.getUTCHours(),e,2)}function vye(t,e){return ds(t.getUTCHours()%12||12,e,2)}function bye(t,e){return ds(1+yE.count(bg(t),t),e,3)}function VY(t,e){return ds(t.getUTCMilliseconds(),e,3)}function xye(t,e){return VY(t,e)+"000"}function wye(t,e){return ds(t.getUTCMonth()+1,e,2)}function Sye(t,e){return ds(t.getUTCMinutes(),e,2)}function Aye(t,e){return ds(t.getUTCSeconds(),e,2)}function Tye(t){var e=t.getUTCDay();return e===0?7:e}function Eye(t,e){return ds(vE.count(bg(t)-1,t),e,2)}function $Y(t){var e=t.getUTCDay();return e>=4||e===0?o1(t):o1.ceil(t)}function Mye(t,e){return t=$Y(t),ds(o1.count(bg(t),t)+(bg(t).getUTCDay()===4),e,2)}function Cye(t){return t.getUTCDay()}function Iye(t,e){return ds(LT.count(bg(t)-1,t),e,2)}function Pye(t,e){return ds(t.getUTCFullYear()%100,e,2)}function Oye(t,e){return t=$Y(t),ds(t.getUTCFullYear()%100,e,2)}function Rye(t,e){return ds(t.getUTCFullYear()%1e4,e,4)}function Dye(t,e){var n=t.getUTCDay();return t=n>=4||n===0?o1(t):o1.ceil(t),ds(t.getUTCFullYear()%1e4,e,4)}function Lye(){return"+0000"}function WU(){return"%"}function KU(t){return+t}function YU(t){return Math.floor(+t/1e3)}var l0,HY,GY;kye({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function kye(t){return l0=kge(t),HY=l0.format,l0.parse,GY=l0.utcFormat,l0.utcParse,l0}function Nye(t){return new Date(t)}function zye(t){return t instanceof Date?+t:+new Date(+t)}function Kk(t,e,n,r,s,l,f,i,x,S){var I=Lk(),R=I.invert,F=I.domain,j=S(".%L"),H=S(":%S"),G=S("%I:%M"),W=S("%I %p"),J=S("%a %d"),ie=S("%b %d"),he=S("%B"),ge=S("%Y");function fe(ye){return(x(ye)<ye?j:i(ye)<ye?H:f(ye)<ye?G:l(ye)<ye?W:r(ye)<ye?s(ye)<ye?J:ie:n(ye)<ye?he:ge)(ye)}return I.invert=function(ye){return new Date(R(ye))},I.domain=function(ye){return arguments.length?F(Array.from(ye,zye)):F().map(Nye)},I.ticks=function(ye){var pe=F();return t(pe[0],pe[pe.length-1],ye??10)},I.tickFormat=function(ye,pe){return pe==null?fe:S(pe)},I.nice=function(ye){var pe=F();return(!ye||typeof ye.range!="function")&&(ye=e(pe[0],pe[pe.length-1],ye??10)),ye?F(RY(pe,ye)):I},I.copy=function(){return w2(I,Kk(t,e,n,r,s,l,f,i,x,S))},I}function Bye(){return qd.apply(Kk(Dge,Lge,vg,Gk,_E,S2,$k,qk,F_,HY).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function jye(){return qd.apply(Kk(Oge,Rge,bg,Wk,vE,yE,Hk,Vk,F_,GY).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function bE(){var t=0,e=1,n,r,s,l,f=Yh,i=!1,x;function S(R){return R==null||isNaN(R=+R)?x:f(s===0?.5:(R=(l(R)-n)*s,i?Math.max(0,Math.min(1,R)):R))}S.domain=function(R){return arguments.length?([t,e]=R,n=l(t=+t),r=l(e=+e),s=n===r?0:1/(r-n),S):[t,e]},S.clamp=function(R){return arguments.length?(i=!!R,S):i},S.interpolator=function(R){return arguments.length?(f=R,S):f};function I(R){return function(F){var j,H;return arguments.length?([j,H]=F,f=R(j,H),S):[f(0),f(1)]}}return S.range=I(F1),S.rangeRound=I(Dk),S.unknown=function(R){return arguments.length?(x=R,S):x},function(R){return l=R,n=R(t),r=R(e),s=n===r?0:1/(r-n),S}}function By(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function WY(){var t=zy(bE()(Yh));return t.copy=function(){return By(t,WY())},Eg.apply(t,arguments)}function KY(){var t=zk(bE()).domain([1,10]);return t.copy=function(){return By(t,KY()).base(t.base())},Eg.apply(t,arguments)}function YY(){var t=Bk(bE());return t.copy=function(){return By(t,YY()).constant(t.constant())},Eg.apply(t,arguments)}function Yk(){var t=jk(bE());return t.copy=function(){return By(t,Yk()).exponent(t.exponent())},Eg.apply(t,arguments)}function Fye(){return Yk.apply(null,arguments).exponent(.5)}function XY(){var t=[],e=Yh;function n(r){if(r!=null&&!isNaN(r=+r))return e((b2(t,r,1)-1)/(t.length-1))}return n.domain=function(r){if(!arguments.length)return t.slice();t=[];for(let s of r)s!=null&&!isNaN(s=+s)&&t.push(s);return t.sort(Ty),n},n.interpolator=function(r){return arguments.length?(e=r,n):e},n.range=function(){return t.map((r,s)=>e(s/(t.length-1)))},n.quantiles=function(r){return Array.from({length:r+1},(s,l)=>Eme(t,l/r))},n.copy=function(){return XY(e).domain(t)},Eg.apply(n,arguments)}function xE(){var t=0,e=.5,n=1,r=1,s,l,f,i,x,S=Yh,I,R=!1,F;function j(G){return isNaN(G=+G)?F:(G=.5+((G=+I(G))-l)*(r*G<r*l?i:x),S(R?Math.max(0,Math.min(1,G)):G))}j.domain=function(G){return arguments.length?([t,e,n]=G,s=I(t=+t),l=I(e=+e),f=I(n=+n),i=s===l?0:.5/(l-s),x=l===f?0:.5/(f-l),r=l<s?-1:1,j):[t,e,n]},j.clamp=function(G){return arguments.length?(R=!!G,j):R},j.interpolator=function(G){return arguments.length?(S=G,j):S};function H(G){return function(W){var J,ie,he;return arguments.length?([J,ie,he]=W,S=Jme(G,[J,ie,he]),j):[S(0),S(.5),S(1)]}}return j.range=H(F1),j.rangeRound=H(Dk),j.unknown=function(G){return arguments.length?(F=G,j):F},function(G){return I=G,s=G(t),l=G(e),f=G(n),i=s===l?0:.5/(l-s),x=l===f?0:.5/(f-l),r=l<s?-1:1,j}}function ZY(){var t=zy(xE()(Yh));return t.copy=function(){return By(t,ZY())},Eg.apply(t,arguments)}function JY(){var t=zk(xE()).domain([.1,1,10]);return t.copy=function(){return By(t,JY()).base(t.base())},Eg.apply(t,arguments)}function QY(){var t=Bk(xE());return t.copy=function(){return By(t,QY()).constant(t.constant())},Eg.apply(t,arguments)}function Xk(){var t=jk(xE());return t.copy=function(){return By(t,Xk()).exponent(t.exponent())},Eg.apply(t,arguments)}function Uye(){return Xk.apply(null,arguments).exponent(.5)}const XU=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:dw,scaleDiverging:ZY,scaleDivergingLog:JY,scaleDivergingPow:Xk,scaleDivergingSqrt:Uye,scaleDivergingSymlog:QY,scaleIdentity:OY,scaleImplicit:vR,scaleLinear:OT,scaleLog:DY,scaleOrdinal:Pk,scalePoint:Dx,scalePow:Fk,scaleQuantile:NY,scaleQuantize:zY,scaleRadial:kY,scaleSequential:WY,scaleSequentialLog:KY,scaleSequentialPow:Yk,scaleSequentialQuantile:XY,scaleSequentialSqrt:Fye,scaleSequentialSymlog:YY,scaleSqrt:xge,scaleSymlog:LY,scaleThreshold:BY,scaleTime:Bye,scaleUtc:jye,tickFormat:PY},Symbol.toStringTag,{value:"Module"}));var qP,ZU;function wE(){if(ZU)return qP;ZU=1;var t=N1();function e(n,r,s){for(var l=-1,f=n.length;++l<f;){var i=n[l],x=r(i);if(x!=null&&(S===void 0?x===x&&!t(x):s(x,S)))var S=x,I=i}return I}return qP=e,qP}var VP,JU;function eX(){if(JU)return VP;JU=1;function t(e,n){return e>n}return VP=t,VP}var $P,QU;function qye(){if(QU)return $P;QU=1;var t=wE(),e=eX(),n=j1();function r(s){return s&&s.length?t(s,n,e):void 0}return $P=r,$P}var Vye=qye();const _y=Xa(Vye);var HP,e9;function tX(){if(e9)return HP;e9=1;function t(e,n){return e<n}return HP=t,HP}var GP,t9;function $ye(){if(t9)return GP;t9=1;var t=wE(),e=tX(),n=j1();function r(s){return s&&s.length?t(s,n,e):void 0}return GP=r,GP}var Hye=$ye();const SE=Xa(Hye);var WP,n9;function Gye(){if(n9)return WP;n9=1;var t=fk(),e=Om(),n=cY(),r=Cf();function s(l,f){var i=r(l)?t:n;return i(l,e(f,3))}return WP=s,WP}var KP,r9;function Wye(){if(r9)return KP;r9=1;var t=oY(),e=Gye();function n(r,s){return t(e(r,s),1)}return KP=n,KP}var Kye=Wye();const Yye=Xa(Kye);var YP,i9;function Xye(){if(i9)return YP;i9=1;var t=Tk();function e(n,r){return t(n,r)}return YP=e,YP}var Zye=Xye();const av=Xa(Zye);var U1=1e9,Jye={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},Jk,Ho=!0,Ud="[DecimalError] ",W_=Ud+"Invalid argument: ",Zk=Ud+"Exponent out of range: ",q1=Math.floor,O_=Math.pow,Qye=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,nd,Jc=1e7,Mo=7,nX=9007199254740991,kT=q1(nX/Mo),Xr={};Xr.absoluteValue=Xr.abs=function(){var t=new this.constructor(this);return t.s&&(t.s=1),t};Xr.comparedTo=Xr.cmp=function(t){var e,n,r,s,l=this;if(t=new l.constructor(t),l.s!==t.s)return l.s||-t.s;if(l.e!==t.e)return l.e>t.e^l.s<0?1:-1;for(r=l.d.length,s=t.d.length,e=0,n=r<s?r:s;e<n;++e)if(l.d[e]!==t.d[e])return l.d[e]>t.d[e]^l.s<0?1:-1;return r===s?0:r>s^l.s<0?1:-1};Xr.decimalPlaces=Xr.dp=function(){var t=this,e=t.d.length-1,n=(e-t.e)*Mo;if(e=t.d[e],e)for(;e%10==0;e/=10)n--;return n<0?0:n};Xr.dividedBy=Xr.div=function(t){return ug(this,new this.constructor(t))};Xr.dividedToIntegerBy=Xr.idiv=function(t){var e=this,n=e.constructor;return ao(ug(e,new n(t),0,1),n.precision)};Xr.equals=Xr.eq=function(t){return!this.cmp(t)};Xr.exponent=function(){return sc(this)};Xr.greaterThan=Xr.gt=function(t){return this.cmp(t)>0};Xr.greaterThanOrEqualTo=Xr.gte=function(t){return this.cmp(t)>=0};Xr.isInteger=Xr.isint=function(){return this.e>this.d.length-2};Xr.isNegative=Xr.isneg=function(){return this.s<0};Xr.isPositive=Xr.ispos=function(){return this.s>0};Xr.isZero=function(){return this.s===0};Xr.lessThan=Xr.lt=function(t){return this.cmp(t)<0};Xr.lessThanOrEqualTo=Xr.lte=function(t){return this.cmp(t)<1};Xr.logarithm=Xr.log=function(t){var e,n=this,r=n.constructor,s=r.precision,l=s+5;if(t===void 0)t=new r(10);else if(t=new r(t),t.s<1||t.eq(nd))throw Error(Ud+"NaN");if(n.s<1)throw Error(Ud+(n.s?"NaN":"-Infinity"));return n.eq(nd)?new r(0):(Ho=!1,e=ug(_w(n,l),_w(t,l),l),Ho=!0,ao(e,s))};Xr.minus=Xr.sub=function(t){var e=this;return t=new e.constructor(t),e.s==t.s?aX(e,t):rX(e,(t.s=-t.s,t))};Xr.modulo=Xr.mod=function(t){var e,n=this,r=n.constructor,s=r.precision;if(t=new r(t),!t.s)throw Error(Ud+"NaN");return n.s?(Ho=!1,e=ug(n,t,0,1).times(t),Ho=!0,n.minus(e)):ao(new r(n),s)};Xr.naturalExponential=Xr.exp=function(){return iX(this)};Xr.naturalLogarithm=Xr.ln=function(){return _w(this)};Xr.negated=Xr.neg=function(){var t=new this.constructor(this);return t.s=-t.s||0,t};Xr.plus=Xr.add=function(t){var e=this;return t=new e.constructor(t),e.s==t.s?rX(e,t):aX(e,(t.s=-t.s,t))};Xr.precision=Xr.sd=function(t){var e,n,r,s=this;if(t!==void 0&&t!==!!t&&t!==1&&t!==0)throw Error(W_+t);if(e=sc(s)+1,r=s.d.length-1,n=r*Mo+1,r=s.d[r],r){for(;r%10==0;r/=10)n--;for(r=s.d[0];r>=10;r/=10)n++}return t&&e>n?e:n};Xr.squareRoot=Xr.sqrt=function(){var t,e,n,r,s,l,f,i=this,x=i.constructor;if(i.s<1){if(!i.s)return new x(0);throw Error(Ud+"NaN")}for(t=sc(i),Ho=!1,s=Math.sqrt(+i),s==0||s==1/0?(e=ym(i.d),(e.length+t)%2==0&&(e+="0"),s=Math.sqrt(e),t=q1((t+1)/2)-(t<0||t%2),s==1/0?e="5e"+t:(e=s.toExponential(),e=e.slice(0,e.indexOf("e")+1)+t),r=new x(e)):r=new x(s.toString()),n=x.precision,s=f=n+3;;)if(l=r,r=l.plus(ug(i,l,f+2)).times(.5),ym(l.d).slice(0,f)===(e=ym(r.d)).slice(0,f)){if(e=e.slice(f-3,f+1),s==f&&e=="4999"){if(ao(l,n+1,0),l.times(l).eq(i)){r=l;break}}else if(e!="9999")break;f+=4}return Ho=!0,ao(r,n)};Xr.times=Xr.mul=function(t){var e,n,r,s,l,f,i,x,S,I=this,R=I.constructor,F=I.d,j=(t=new R(t)).d;if(!I.s||!t.s)return new R(0);for(t.s*=I.s,n=I.e+t.e,x=F.length,S=j.length,x<S&&(l=F,F=j,j=l,f=x,x=S,S=f),l=[],f=x+S,r=f;r--;)l.push(0);for(r=S;--r>=0;){for(e=0,s=x+r;s>r;)i=l[s]+j[r]*F[s-r-1]+e,l[s--]=i%Jc|0,e=i/Jc|0;l[s]=(l[s]+e)%Jc|0}for(;!l[--f];)l.pop();return e?++n:l.shift(),t.d=l,t.e=n,Ho?ao(t,R.precision):t};Xr.toDecimalPlaces=Xr.todp=function(t,e){var n=this,r=n.constructor;return n=new r(n),t===void 0?n:(Cm(t,0,U1),e===void 0?e=r.rounding:Cm(e,0,8),ao(n,t+sc(n)+1,e))};Xr.toExponential=function(t,e){var n,r=this,s=r.constructor;return t===void 0?n=sv(r,!0):(Cm(t,0,U1),e===void 0?e=s.rounding:Cm(e,0,8),r=ao(new s(r),t+1,e),n=sv(r,!0,t+1)),n};Xr.toFixed=function(t,e){var n,r,s=this,l=s.constructor;return t===void 0?sv(s):(Cm(t,0,U1),e===void 0?e=l.rounding:Cm(e,0,8),r=ao(new l(s),t+sc(s)+1,e),n=sv(r.abs(),!1,t+sc(r)+1),s.isneg()&&!s.isZero()?"-"+n:n)};Xr.toInteger=Xr.toint=function(){var t=this,e=t.constructor;return ao(new e(t),sc(t)+1,e.rounding)};Xr.toNumber=function(){return+this};Xr.toPower=Xr.pow=function(t){var e,n,r,s,l,f,i=this,x=i.constructor,S=12,I=+(t=new x(t));if(!t.s)return new x(nd);if(i=new x(i),!i.s){if(t.s<1)throw Error(Ud+"Infinity");return i}if(i.eq(nd))return i;if(r=x.precision,t.eq(nd))return ao(i,r);if(e=t.e,n=t.d.length-1,f=e>=n,l=i.s,f){if((n=I<0?-I:I)<=nX){for(s=new x(nd),e=Math.ceil(r/Mo+4),Ho=!1;n%2&&(s=s.times(i),s9(s.d,e)),n=q1(n/2),n!==0;)i=i.times(i),s9(i.d,e);return Ho=!0,t.s<0?new x(nd).div(s):ao(s,r)}}else if(l<0)throw Error(Ud+"NaN");return l=l<0&&t.d[Math.max(e,n)]&1?-1:1,i.s=1,Ho=!1,s=t.times(_w(i,r+S)),Ho=!0,s=iX(s),s.s=l,s};Xr.toPrecision=function(t,e){var n,r,s=this,l=s.constructor;return t===void 0?(n=sc(s),r=sv(s,n<=l.toExpNeg||n>=l.toExpPos)):(Cm(t,1,U1),e===void 0?e=l.rounding:Cm(e,0,8),s=ao(new l(s),t,e),n=sc(s),r=sv(s,t<=n||n<=l.toExpNeg,t)),r};Xr.toSignificantDigits=Xr.tosd=function(t,e){var n=this,r=n.constructor;return t===void 0?(t=r.precision,e=r.rounding):(Cm(t,1,U1),e===void 0?e=r.rounding:Cm(e,0,8)),ao(new r(n),t,e)};Xr.toString=Xr.valueOf=Xr.val=Xr.toJSON=Xr[Symbol.for("nodejs.util.inspect.custom")]=function(){var t=this,e=sc(t),n=t.constructor;return sv(t,e<=n.toExpNeg||e>=n.toExpPos)};function rX(t,e){var n,r,s,l,f,i,x,S,I=t.constructor,R=I.precision;if(!t.s||!e.s)return e.s||(e=new I(t)),Ho?ao(e,R):e;if(x=t.d,S=e.d,f=t.e,s=e.e,x=x.slice(),l=f-s,l){for(l<0?(r=x,l=-l,i=S.length):(r=S,s=f,i=x.length),f=Math.ceil(R/Mo),i=f>i?f+1:i+1,l>i&&(l=i,r.length=1),r.reverse();l--;)r.push(0);r.reverse()}for(i=x.length,l=S.length,i-l<0&&(l=i,r=S,S=x,x=r),n=0;l;)n=(x[--l]=x[l]+S[l]+n)/Jc|0,x[l]%=Jc;for(n&&(x.unshift(n),++s),i=x.length;x[--i]==0;)x.pop();return e.d=x,e.e=s,Ho?ao(e,R):e}function Cm(t,e,n){if(t!==~~t||t<e||t>n)throw Error(W_+t)}function ym(t){var e,n,r,s=t.length-1,l="",f=t[0];if(s>0){for(l+=f,e=1;e<s;e++)r=t[e]+"",n=Mo-r.length,n&&(l+=hy(n)),l+=r;f=t[e],r=f+"",n=Mo-r.length,n&&(l+=hy(n))}else if(f===0)return"0";for(;f%10===0;)f/=10;return l+f}var ug=function(){function t(r,s){var l,f=0,i=r.length;for(r=r.slice();i--;)l=r[i]*s+f,r[i]=l%Jc|0,f=l/Jc|0;return f&&r.unshift(f),r}function e(r,s,l,f){var i,x;if(l!=f)x=l>f?1:-1;else for(i=x=0;i<l;i++)if(r[i]!=s[i]){x=r[i]>s[i]?1:-1;break}return x}function n(r,s,l){for(var f=0;l--;)r[l]-=f,f=r[l]<s[l]?1:0,r[l]=f*Jc+r[l]-s[l];for(;!r[0]&&r.length>1;)r.shift()}return function(r,s,l,f){var i,x,S,I,R,F,j,H,G,W,J,ie,he,ge,fe,ye,pe,be,Ae=r.constructor,Oe=r.s==s.s?1:-1,ue=r.d,we=s.d;if(!r.s)return new Ae(r);if(!s.s)throw Error(Ud+"Division by zero");for(x=r.e-s.e,pe=we.length,fe=ue.length,j=new Ae(Oe),H=j.d=[],S=0;we[S]==(ue[S]||0);)++S;if(we[S]>(ue[S]||0)&&--x,l==null?ie=l=Ae.precision:f?ie=l+(sc(r)-sc(s))+1:ie=l,ie<0)return new Ae(0);if(ie=ie/Mo+2|0,S=0,pe==1)for(I=0,we=we[0],ie++;(S<fe||I)&&ie--;S++)he=I*Jc+(ue[S]||0),H[S]=he/we|0,I=he%we|0;else{for(I=Jc/(we[0]+1)|0,I>1&&(we=t(we,I),ue=t(ue,I),pe=we.length,fe=ue.length),ge=pe,G=ue.slice(0,pe),W=G.length;W<pe;)G[W++]=0;be=we.slice(),be.unshift(0),ye=we[0],we[1]>=Jc/2&&++ye;do I=0,i=e(we,G,pe,W),i<0?(J=G[0],pe!=W&&(J=J*Jc+(G[1]||0)),I=J/ye|0,I>1?(I>=Jc&&(I=Jc-1),R=t(we,I),F=R.length,W=G.length,i=e(R,G,F,W),i==1&&(I--,n(R,pe<F?be:we,F))):(I==0&&(i=I=1),R=we.slice()),F=R.length,F<W&&R.unshift(0),n(G,R,W),i==-1&&(W=G.length,i=e(we,G,pe,W),i<1&&(I++,n(G,pe<W?be:we,W))),W=G.length):i===0&&(I++,G=[0]),H[S++]=I,i&&G[0]?G[W++]=ue[ge]||0:(G=[ue[ge]],W=1);while((ge++<fe||G[0]!==void 0)&&ie--)}return H[0]||H.shift(),j.e=x,ao(j,f?l+sc(j)+1:l)}}();function iX(t,e){var n,r,s,l,f,i,x=0,S=0,I=t.constructor,R=I.precision;if(sc(t)>16)throw Error(Zk+sc(t));if(!t.s)return new I(nd);for(Ho=!1,i=R,f=new I(.03125);t.abs().gte(.1);)t=t.times(f),S+=5;for(r=Math.log(O_(2,S))/Math.LN10*2+5|0,i+=r,n=s=l=new I(nd),I.precision=i;;){if(s=ao(s.times(t),i),n=n.times(++x),f=l.plus(ug(s,n,i)),ym(f.d).slice(0,i)===ym(l.d).slice(0,i)){for(;S--;)l=ao(l.times(l),i);return I.precision=R,e==null?(Ho=!0,ao(l,R)):l}l=f}}function sc(t){for(var e=t.e*Mo,n=t.d[0];n>=10;n/=10)e++;return e}function XP(t,e,n){if(e>t.LN10.sd())throw Ho=!0,n&&(t.precision=n),Error(Ud+"LN10 precision limit exceeded");return ao(new t(t.LN10),e)}function hy(t){for(var e="";t--;)e+="0";return e}function _w(t,e){var n,r,s,l,f,i,x,S,I,R=1,F=10,j=t,H=j.d,G=j.constructor,W=G.precision;if(j.s<1)throw Error(Ud+(j.s?"NaN":"-Infinity"));if(j.eq(nd))return new G(0);if(e==null?(Ho=!1,S=W):S=e,j.eq(10))return e==null&&(Ho=!0),XP(G,S);if(S+=F,G.precision=S,n=ym(H),r=n.charAt(0),l=sc(j),Math.abs(l)<15e14){for(;r<7&&r!=1||r==1&&n.charAt(1)>3;)j=j.times(t),n=ym(j.d),r=n.charAt(0),R++;l=sc(j),r>1?(j=new G("0."+n),l++):j=new G(r+"."+n.slice(1))}else return x=XP(G,S+2,W).times(l+""),j=_w(new G(r+"."+n.slice(1)),S-F).plus(x),G.precision=W,e==null?(Ho=!0,ao(j,W)):j;for(i=f=j=ug(j.minus(nd),j.plus(nd),S),I=ao(j.times(j),S),s=3;;){if(f=ao(f.times(I),S),x=i.plus(ug(f,new G(s),S)),ym(x.d).slice(0,S)===ym(i.d).slice(0,S))return i=i.times(2),l!==0&&(i=i.plus(XP(G,S+2,W).times(l+""))),i=ug(i,new G(R),S),G.precision=W,e==null?(Ho=!0,ao(i,W)):i;i=x,s+=2}}function a9(t,e){var n,r,s;for((n=e.indexOf("."))>-1&&(e=e.replace(".","")),(r=e.search(/e/i))>0?(n<0&&(n=r),n+=+e.slice(r+1),e=e.substring(0,r)):n<0&&(n=e.length),r=0;e.charCodeAt(r)===48;)++r;for(s=e.length;e.charCodeAt(s-1)===48;)--s;if(e=e.slice(r,s),e){if(s-=r,n=n-r-1,t.e=q1(n/Mo),t.d=[],r=(n+1)%Mo,n<0&&(r+=Mo),r<s){for(r&&t.d.push(+e.slice(0,r)),s-=Mo;r<s;)t.d.push(+e.slice(r,r+=Mo));e=e.slice(r),r=Mo-e.length}else r-=s;for(;r--;)e+="0";if(t.d.push(+e),Ho&&(t.e>kT||t.e<-kT))throw Error(Zk+n)}else t.s=0,t.e=0,t.d=[0];return t}function ao(t,e,n){var r,s,l,f,i,x,S,I,R=t.d;for(f=1,l=R[0];l>=10;l/=10)f++;if(r=e-f,r<0)r+=Mo,s=e,S=R[I=0];else{if(I=Math.ceil((r+1)/Mo),l=R.length,I>=l)return t;for(S=l=R[I],f=1;l>=10;l/=10)f++;r%=Mo,s=r-Mo+f}if(n!==void 0&&(l=O_(10,f-s-1),i=S/l%10|0,x=e<0||R[I+1]!==void 0||S%l,x=n<4?(i||x)&&(n==0||n==(t.s<0?3:2)):i>5||i==5&&(n==4||x||n==6&&(r>0?s>0?S/O_(10,f-s):0:R[I-1])%10&1||n==(t.s<0?8:7))),e<1||!R[0])return x?(l=sc(t),R.length=1,e=e-l-1,R[0]=O_(10,(Mo-e%Mo)%Mo),t.e=q1(-e/Mo)||0):(R.length=1,R[0]=t.e=t.s=0),t;if(r==0?(R.length=I,l=1,I--):(R.length=I+1,l=O_(10,Mo-r),R[I]=s>0?(S/O_(10,f-s)%O_(10,s)|0)*l:0),x)for(;;)if(I==0){(R[0]+=l)==Jc&&(R[0]=1,++t.e);break}else{if(R[I]+=l,R[I]!=Jc)break;R[I--]=0,l=1}for(r=R.length;R[--r]===0;)R.pop();if(Ho&&(t.e>kT||t.e<-kT))throw Error(Zk+sc(t));return t}function aX(t,e){var n,r,s,l,f,i,x,S,I,R,F=t.constructor,j=F.precision;if(!t.s||!e.s)return e.s?e.s=-e.s:e=new F(t),Ho?ao(e,j):e;if(x=t.d,R=e.d,r=e.e,S=t.e,x=x.slice(),f=S-r,f){for(I=f<0,I?(n=x,f=-f,i=R.length):(n=R,r=S,i=x.length),s=Math.max(Math.ceil(j/Mo),i)+2,f>s&&(f=s,n.length=1),n.reverse(),s=f;s--;)n.push(0);n.reverse()}else{for(s=x.length,i=R.length,I=s<i,I&&(i=s),s=0;s<i;s++)if(x[s]!=R[s]){I=x[s]<R[s];break}f=0}for(I&&(n=x,x=R,R=n,e.s=-e.s),i=x.length,s=R.length-i;s>0;--s)x[i++]=0;for(s=R.length;s>f;){if(x[--s]<R[s]){for(l=s;l&&x[--l]===0;)x[l]=Jc-1;--x[l],x[s]+=Jc}x[s]-=R[s]}for(;x[--i]===0;)x.pop();for(;x[0]===0;x.shift())--r;return x[0]?(e.d=x,e.e=r,Ho?ao(e,j):e):new F(0)}function sv(t,e,n){var r,s=sc(t),l=ym(t.d),f=l.length;return e?(n&&(r=n-f)>0?l=l.charAt(0)+"."+l.slice(1)+hy(r):f>1&&(l=l.charAt(0)+"."+l.slice(1)),l=l+(s<0?"e":"e+")+s):s<0?(l="0."+hy(-s-1)+l,n&&(r=n-f)>0&&(l+=hy(r))):s>=f?(l+=hy(s+1-f),n&&(r=n-s-1)>0&&(l=l+"."+hy(r))):((r=s+1)<f&&(l=l.slice(0,r)+"."+l.slice(r)),n&&(r=n-f)>0&&(s+1===f&&(l+="."),l+=hy(r))),t.s<0?"-"+l:l}function s9(t,e){if(t.length>e)return t.length=e,!0}function sX(t){var e,n,r;function s(l){var f=this;if(!(f instanceof s))return new s(l);if(f.constructor=s,l instanceof s){f.s=l.s,f.e=l.e,f.d=(l=l.d)?l.slice():l;return}if(typeof l=="number"){if(l*0!==0)throw Error(W_+l);if(l>0)f.s=1;else if(l<0)l=-l,f.s=-1;else{f.s=0,f.e=0,f.d=[0];return}if(l===~~l&&l<1e7){f.e=0,f.d=[l];return}return a9(f,l.toString())}else if(typeof l!="string")throw Error(W_+l);if(l.charCodeAt(0)===45?(l=l.slice(1),f.s=-1):f.s=1,Qye.test(l))a9(f,l);else throw Error(W_+l)}if(s.prototype=Xr,s.ROUND_UP=0,s.ROUND_DOWN=1,s.ROUND_CEIL=2,s.ROUND_FLOOR=3,s.ROUND_HALF_UP=4,s.ROUND_HALF_DOWN=5,s.ROUND_HALF_EVEN=6,s.ROUND_HALF_CEIL=7,s.ROUND_HALF_FLOOR=8,s.clone=sX,s.config=s.set=e_e,t===void 0&&(t={}),t)for(r=["precision","rounding","toExpNeg","toExpPos","LN10"],e=0;e<r.length;)t.hasOwnProperty(n=r[e++])||(t[n]=this[n]);return s.config(t),s}function e_e(t){if(!t||typeof t!="object")throw Error(Ud+"Object expected");var e,n,r,s=["precision",1,U1,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(e=0;e<s.length;e+=3)if((r=t[n=s[e]])!==void 0)if(q1(r)===r&&r>=s[e+1]&&r<=s[e+2])this[n]=r;else throw Error(W_+n+": "+r);if((r=t[n="LN10"])!==void 0)if(r==Math.LN10)this[n]=new this(r);else throw Error(W_+n+": "+r);return this}var Jk=sX(Jye);nd=new Jk(1);const Ks=Jk;function t_e(t){return a_e(t)||i_e(t)||r_e(t)||n_e()}function n_e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function r_e(t,e){if(t){if(typeof t=="string")return SR(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return SR(t,e)}}function i_e(t){if(typeof Symbol<"u"&&Symbol.iterator in Object(t))return Array.from(t)}function a_e(t){if(Array.isArray(t))return SR(t)}function SR(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var s_e=function(e){return e},oX={},lX=function(e){return e===oX},o9=function(e){return function n(){return arguments.length===0||arguments.length===1&&lX(arguments.length<=0?void 0:arguments[0])?n:e.apply(void 0,arguments)}},o_e=function t(e,n){return e===1?n:o9(function(){for(var r=arguments.length,s=new Array(r),l=0;l<r;l++)s[l]=arguments[l];var f=s.filter(function(i){return i!==oX}).length;return f>=e?n.apply(void 0,s):t(e-f,o9(function(){for(var i=arguments.length,x=new Array(i),S=0;S<i;S++)x[S]=arguments[S];var I=s.map(function(R){return lX(R)?x.shift():R});return n.apply(void 0,t_e(I).concat(x))}))})},AE=function(e){return o_e(e.length,e)},AR=function(e,n){for(var r=[],s=e;s<n;++s)r[s-e]=s;return r},l_e=AE(function(t,e){return Array.isArray(e)?e.map(t):Object.keys(e).map(function(n){return e[n]}).map(t)}),c_e=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];if(!n.length)return s_e;var s=n.reverse(),l=s[0],f=s.slice(1);return function(){return f.reduce(function(i,x){return x(i)},l.apply(void 0,arguments))}},TR=function(e){return Array.isArray(e)?e.reverse():e.split("").reverse.join("")},cX=function(e){var n=null,r=null;return function(){for(var s=arguments.length,l=new Array(s),f=0;f<s;f++)l[f]=arguments[f];return n&&l.every(function(i,x){return i===n[x]})||(n=l,r=e.apply(void 0,l)),r}};function u_e(t){var e;return t===0?e=1:e=Math.floor(new Ks(t).abs().log(10).toNumber())+1,e}function h_e(t,e,n){for(var r=new Ks(t),s=0,l=[];r.lt(e)&&s<1e5;)l.push(r.toNumber()),r=r.add(n),s++;return l}var f_e=AE(function(t,e,n){var r=+t,s=+e;return r+n*(s-r)}),d_e=AE(function(t,e,n){var r=e-+t;return r=r||1/0,(n-t)/r}),p_e=AE(function(t,e,n){var r=e-+t;return r=r||1/0,Math.max(0,Math.min(1,(n-t)/r))});const TE={rangeStep:h_e,getDigitCount:u_e,interpolateNumber:f_e,uninterpolateNumber:d_e,uninterpolateTruncation:p_e};function ER(t){return y_e(t)||g_e(t)||uX(t)||m_e()}function m_e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function g_e(t){if(typeof Symbol<"u"&&Symbol.iterator in Object(t))return Array.from(t)}function y_e(t){if(Array.isArray(t))return MR(t)}function vw(t,e){return b_e(t)||v_e(t,e)||uX(t,e)||__e()}function __e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uX(t,e){if(t){if(typeof t=="string")return MR(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return MR(t,e)}}function MR(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function v_e(t,e){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(t)))){var n=[],r=!0,s=!1,l=void 0;try{for(var f=t[Symbol.iterator](),i;!(r=(i=f.next()).done)&&(n.push(i.value),!(e&&n.length===e));r=!0);}catch(x){s=!0,l=x}finally{try{!r&&f.return!=null&&f.return()}finally{if(s)throw l}}return n}}function b_e(t){if(Array.isArray(t))return t}function hX(t){var e=vw(t,2),n=e[0],r=e[1],s=n,l=r;return n>r&&(s=r,l=n),[s,l]}function fX(t,e,n){if(t.lte(0))return new Ks(0);var r=TE.getDigitCount(t.toNumber()),s=new Ks(10).pow(r),l=t.div(s),f=r!==1?.05:.1,i=new Ks(Math.ceil(l.div(f).toNumber())).add(n).mul(f),x=i.mul(s);return e?x:new Ks(Math.ceil(x))}function x_e(t,e,n){var r=1,s=new Ks(t);if(!s.isint()&&n){var l=Math.abs(t);l<1?(r=new Ks(10).pow(TE.getDigitCount(t)-1),s=new Ks(Math.floor(s.div(r).toNumber())).mul(r)):l>1&&(s=new Ks(Math.floor(t)))}else t===0?s=new Ks(Math.floor((e-1)/2)):n||(s=new Ks(Math.floor(t)));var f=Math.floor((e-1)/2),i=c_e(l_e(function(x){return s.add(new Ks(x-f).mul(r)).toNumber()}),AR);return i(0,e)}function dX(t,e,n,r){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((e-t)/(n-1)))return{step:new Ks(0),tickMin:new Ks(0),tickMax:new Ks(0)};var l=fX(new Ks(e).sub(t).div(n-1),r,s),f;t<=0&&e>=0?f=new Ks(0):(f=new Ks(t).add(e).div(2),f=f.sub(new Ks(f).mod(l)));var i=Math.ceil(f.sub(t).div(l).toNumber()),x=Math.ceil(new Ks(e).sub(f).div(l).toNumber()),S=i+x+1;return S>n?dX(t,e,n,r,s+1):(S<n&&(x=e>0?x+(n-S):x,i=e>0?i:i+(n-S)),{step:l,tickMin:f.sub(new Ks(i).mul(l)),tickMax:f.add(new Ks(x).mul(l))})}function w_e(t){var e=vw(t,2),n=e[0],r=e[1],s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,f=Math.max(s,2),i=hX([n,r]),x=vw(i,2),S=x[0],I=x[1];if(S===-1/0||I===1/0){var R=I===1/0?[S].concat(ER(AR(0,s-1).map(function(){return 1/0}))):[].concat(ER(AR(0,s-1).map(function(){return-1/0})),[I]);return n>r?TR(R):R}if(S===I)return x_e(S,s,l);var F=dX(S,I,f,l),j=F.step,H=F.tickMin,G=F.tickMax,W=TE.rangeStep(H,G.add(new Ks(.1).mul(j)),j);return n>r?TR(W):W}function S_e(t,e){var n=vw(t,2),r=n[0],s=n[1],l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,f=hX([r,s]),i=vw(f,2),x=i[0],S=i[1];if(x===-1/0||S===1/0)return[r,s];if(x===S)return[x];var I=Math.max(e,2),R=fX(new Ks(S).sub(x).div(I-1),l,0),F=[].concat(ER(TE.rangeStep(new Ks(x),new Ks(S).sub(new Ks(.99).mul(R)),R)),[S]);return r>s?TR(F):F}var A_e=cX(w_e),T_e=cX(S_e),E_e="Invariant failed";function ov(t,e){throw new Error(E_e)}var M_e=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function l1(t){"@babel/helpers - typeof";return l1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l1(t)}function NT(){return NT=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},NT.apply(this,arguments)}function C_e(t,e){return R_e(t)||O_e(t,e)||P_e(t,e)||I_e()}function I_e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function P_e(t,e){if(t){if(typeof t=="string")return l9(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l9(t,e)}}function l9(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function O_e(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r,s,l,f,i=[],x=!0,S=!1;try{if(l=(n=n.call(t)).next,e!==0)for(;!(x=(r=l.call(n)).done)&&(i.push(r.value),i.length!==e);x=!0);}catch(I){S=!0,s=I}finally{try{if(!x&&n.return!=null&&(f=n.return(),Object(f)!==f))return}finally{if(S)throw s}}return i}}function R_e(t){if(Array.isArray(t))return t}function D_e(t,e){if(t==null)return{};var n=L_e(t,e),r,s;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(s=0;s<l.length;s++)r=l[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function L_e(t,e){if(t==null)return{};var n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;n[r]=t[r]}return n}function k_e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function N_e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,gX(r.key),r)}}function z_e(t,e,n){return e&&N_e(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function B_e(t,e,n){return e=zT(e),j_e(t,pX()?Reflect.construct(e,n||[],zT(t).constructor):e.apply(t,n))}function j_e(t,e){if(e&&(l1(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return F_e(t)}function F_e(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function pX(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(pX=function(){return!!t})()}function zT(t){return zT=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},zT(t)}function U_e(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&CR(t,e)}function CR(t,e){return CR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},CR(t,e)}function mX(t,e,n){return e=gX(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function gX(t){var e=q_e(t,"string");return l1(e)=="symbol"?e:e+""}function q_e(t,e){if(l1(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(l1(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var A2=function(t){function e(){return k_e(this,e),B_e(this,e,arguments)}return U_e(e,t),z_e(e,[{key:"render",value:function(){var r=this.props,s=r.offset,l=r.layout,f=r.width,i=r.dataKey,x=r.data,S=r.dataPointFormatter,I=r.xAxis,R=r.yAxis,F=D_e(r,M_e),j=di(F,!1);this.props.direction==="x"&&I.type!=="number"&&ov();var H=x.map(function(G){var W=S(G,i),J=W.x,ie=W.y,he=W.value,ge=W.errorVal;if(!ge)return null;var fe=[],ye,pe;if(Array.isArray(ge)){var be=C_e(ge,2);ye=be[0],pe=be[1]}else ye=pe=ge;if(l==="vertical"){var Ae=I.scale,Oe=ie+s,ue=Oe+f,we=Oe-f,ke=Ae(he-ye),De=Ae(he+pe);fe.push({x1:De,y1:ue,x2:De,y2:we}),fe.push({x1:ke,y1:Oe,x2:De,y2:Oe}),fe.push({x1:ke,y1:ue,x2:ke,y2:we})}else if(l==="horizontal"){var je=R.scale,ze=J+s,Ue=ze-f,Fe=ze+f,Qe=je(he-ye),Be=je(he+pe);fe.push({x1:Ue,y1:Be,x2:Fe,y2:Be}),fe.push({x1:ze,y1:Qe,x2:ze,y2:Be}),fe.push({x1:Ue,y1:Qe,x2:Fe,y2:Qe})}return kt.createElement(Na,NT({className:"recharts-errorBar",key:"bar-".concat(fe.map(function(bt){return"".concat(bt.x1,"-").concat(bt.x2,"-").concat(bt.y1,"-").concat(bt.y2)}))},j),fe.map(function(bt){return kt.createElement("line",NT({},bt,{key:"line-".concat(bt.x1,"-").concat(bt.x2,"-").concat(bt.y1,"-").concat(bt.y2)}))}))});return kt.createElement(Na,{className:"recharts-errorBars"},H)}}])}(kt.Component);mX(A2,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});mX(A2,"displayName","ErrorBar");function bw(t){"@babel/helpers - typeof";return bw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},bw(t)}function c9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function T_(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?c9(Object(n),!0).forEach(function(r){V_e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c9(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function V_e(t,e,n){return e=$_e(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function $_e(t){var e=H_e(t,"string");return bw(e)=="symbol"?e:e+""}function H_e(t,e){if(bw(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(bw(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var yX=function(e){var n=e.children,r=e.formattedGraphicalItems,s=e.legendWidth,l=e.legendContent,f=Qf(n,Nd);if(!f)return null;var i=Nd.defaultProps,x=i!==void 0?T_(T_({},i),f.props):{},S;return f.props&&f.props.payload?S=f.props&&f.props.payload:l==="children"?S=(r||[]).reduce(function(I,R){var F=R.item,j=R.props,H=j.sectors||j.data||[];return I.concat(H.map(function(G){return{type:f.props.iconType||F.props.legendType,value:G.name,color:G.fill,payload:G}}))},[]):S=(r||[]).map(function(I){var R=I.item,F=R.type.defaultProps,j=F!==void 0?T_(T_({},F),R.props):{},H=j.dataKey,G=j.name,W=j.legendType,J=j.hide;return{inactive:J,dataKey:H,type:x.iconType||W||"square",color:Qk(R),value:G||H,payload:j}}),T_(T_(T_({},x),Nd.getWithHeight(f,s)),{},{payload:S,item:f})};function xw(t){"@babel/helpers - typeof";return xw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xw(t)}function u9(t){return Y_e(t)||K_e(t)||W_e(t)||G_e()}function G_e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function W_e(t,e){if(t){if(typeof t=="string")return IR(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return IR(t,e)}}function K_e(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Y_e(t){if(Array.isArray(t))return IR(t)}function IR(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function h9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function bl(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?h9(Object(n),!0).forEach(function(r){j0(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):h9(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function j0(t,e,n){return e=X_e(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function X_e(t){var e=Z_e(t,"string");return xw(e)=="symbol"?e:e+""}function Z_e(t,e){if(xw(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(xw(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function jl(t,e,n){return aa(t)||aa(e)?n:Lc(e)?sd(t,e,n):qi(e)?e(t):n}function Lx(t,e,n,r){var s=Yye(t,function(i){return jl(i,e)});if(n==="number"){var l=s.filter(function(i){return gr(i)||parseFloat(i)});return l.length?[SE(l),_y(l)]:[1/0,-1/0]}var f=r?s.filter(function(i){return!aa(i)}):s;return f.map(function(i){return Lc(i)||i instanceof Date?i:""})}var J_e=function(e){var n,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],s=arguments.length>2?arguments[2]:void 0,l=arguments.length>3?arguments[3]:void 0,f=-1,i=(n=r==null?void 0:r.length)!==null&&n!==void 0?n:0;if(i<=1)return 0;if(l&&l.axisType==="angleAxis"&&Math.abs(Math.abs(l.range[1]-l.range[0])-360)<=1e-6)for(var x=l.range,S=0;S<i;S++){var I=S>0?s[S-1].coordinate:s[i-1].coordinate,R=s[S].coordinate,F=S>=i-1?s[0].coordinate:s[S+1].coordinate,j=void 0;if(Wh(R-I)!==Wh(F-R)){var H=[];if(Wh(F-R)===Wh(x[1]-x[0])){j=F;var G=R+x[1]-x[0];H[0]=Math.min(G,(G+I)/2),H[1]=Math.max(G,(G+I)/2)}else{j=I;var W=F+x[1]-x[0];H[0]=Math.min(R,(W+R)/2),H[1]=Math.max(R,(W+R)/2)}var J=[Math.min(R,(j+R)/2),Math.max(R,(j+R)/2)];if(e>J[0]&&e<=J[1]||e>=H[0]&&e<=H[1]){f=s[S].index;break}}else{var ie=Math.min(I,F),he=Math.max(I,F);if(e>(ie+R)/2&&e<=(he+R)/2){f=s[S].index;break}}}else for(var ge=0;ge<i;ge++)if(ge===0&&e<=(r[ge].coordinate+r[ge+1].coordinate)/2||ge>0&&ge<i-1&&e>(r[ge].coordinate+r[ge-1].coordinate)/2&&e<=(r[ge].coordinate+r[ge+1].coordinate)/2||ge===i-1&&e>(r[ge].coordinate+r[ge-1].coordinate)/2){f=r[ge].index;break}return f},Qk=function(e){var n,r=e,s=r.type.displayName,l=(n=e.type)!==null&&n!==void 0&&n.defaultProps?bl(bl({},e.type.defaultProps),e.props):e.props,f=l.stroke,i=l.fill,x;switch(s){case"Line":x=f;break;case"Area":case"Radar":x=f&&f!=="none"?f:i;break;default:x=i;break}return x},Q_e=function(e){var n=e.barSize,r=e.totalSize,s=e.stackGroups,l=s===void 0?{}:s;if(!l)return{};for(var f={},i=Object.keys(l),x=0,S=i.length;x<S;x++)for(var I=l[i[x]].stackGroups,R=Object.keys(I),F=0,j=R.length;F<j;F++){var H=I[R[F]],G=H.items,W=H.cateAxisId,J=G.filter(function(pe){return cg(pe.type).indexOf("Bar")>=0});if(J&&J.length){var ie=J[0].type.defaultProps,he=ie!==void 0?bl(bl({},ie),J[0].props):J[0].props,ge=he.barSize,fe=he[W];f[fe]||(f[fe]=[]);var ye=aa(ge)?n:ge;f[fe].push({item:J[0],stackList:J.slice(1),barSize:aa(ye)?void 0:Kh(ye,r,0)})}}return f},eve=function(e){var n=e.barGap,r=e.barCategoryGap,s=e.bandSize,l=e.sizeList,f=l===void 0?[]:l,i=e.maxBarSize,x=f.length;if(x<1)return null;var S=Kh(n,s,0,!0),I,R=[];if(f[0].barSize===+f[0].barSize){var F=!1,j=s/x,H=f.reduce(function(ge,fe){return ge+fe.barSize||0},0);H+=(x-1)*S,H>=s&&(H-=(x-1)*S,S=0),H>=s&&j>0&&(F=!0,j*=.9,H=x*j);var G=(s-H)/2>>0,W={offset:G-S,size:0};I=f.reduce(function(ge,fe){var ye={item:fe.item,position:{offset:W.offset+W.size+S,size:F?j:fe.barSize}},pe=[].concat(u9(ge),[ye]);return W=pe[pe.length-1].position,fe.stackList&&fe.stackList.length&&fe.stackList.forEach(function(be){pe.push({item:be,position:W})}),pe},R)}else{var J=Kh(r,s,0,!0);s-2*J-(x-1)*S<=0&&(S=0);var ie=(s-2*J-(x-1)*S)/x;ie>1&&(ie>>=0);var he=i===+i?Math.min(ie,i):ie;I=f.reduce(function(ge,fe,ye){var pe=[].concat(u9(ge),[{item:fe.item,position:{offset:J+(ie+S)*ye+(ie-he)/2,size:he}}]);return fe.stackList&&fe.stackList.length&&fe.stackList.forEach(function(be){pe.push({item:be,position:pe[pe.length-1].position})}),pe},R)}return I},tve=function(e,n,r,s){var l=r.children,f=r.width,i=r.margin,x=f-(i.left||0)-(i.right||0),S=yX({children:l,legendWidth:x});if(S){var I=s||{},R=I.width,F=I.height,j=S.align,H=S.verticalAlign,G=S.layout;if((G==="vertical"||G==="horizontal"&&H==="middle")&&j!=="center"&&gr(e[j]))return bl(bl({},e),{},j0({},j,e[j]+(R||0)));if((G==="horizontal"||G==="vertical"&&j==="center")&&H!=="middle"&&gr(e[H]))return bl(bl({},e),{},j0({},H,e[H]+(F||0)))}return e},nve=function(e,n,r){return aa(n)?!0:e==="horizontal"?n==="yAxis":e==="vertical"||r==="x"?n==="xAxis":r==="y"?n==="yAxis":!0},_X=function(e,n,r,s,l){var f=n.props.children,i=od(f,A2).filter(function(S){return nve(s,l,S.props.direction)});if(i&&i.length){var x=i.map(function(S){return S.props.dataKey});return e.reduce(function(S,I){var R=jl(I,r);if(aa(R))return S;var F=Array.isArray(R)?[SE(R),_y(R)]:[R,R],j=x.reduce(function(H,G){var W=jl(I,G,0),J=F[0]-Math.abs(Array.isArray(W)?W[0]:W),ie=F[1]+Math.abs(Array.isArray(W)?W[1]:W);return[Math.min(J,H[0]),Math.max(ie,H[1])]},[1/0,-1/0]);return[Math.min(j[0],S[0]),Math.max(j[1],S[1])]},[1/0,-1/0])}return null},rve=function(e,n,r,s,l){var f=n.map(function(i){return _X(e,i,r,l,s)}).filter(function(i){return!aa(i)});return f&&f.length?f.reduce(function(i,x){return[Math.min(i[0],x[0]),Math.max(i[1],x[1])]},[1/0,-1/0]):null},vX=function(e,n,r,s,l){var f=n.map(function(x){var S=x.props.dataKey;return r==="number"&&S&&_X(e,x,S,s)||Lx(e,S,r,l)});if(r==="number")return f.reduce(function(x,S){return[Math.min(x[0],S[0]),Math.max(x[1],S[1])]},[1/0,-1/0]);var i={};return f.reduce(function(x,S){for(var I=0,R=S.length;I<R;I++)i[S[I]]||(i[S[I]]=!0,x.push(S[I]));return x},[])},bX=function(e,n){return e==="horizontal"&&n==="xAxis"||e==="vertical"&&n==="yAxis"||e==="centric"&&n==="angleAxis"||e==="radial"&&n==="radiusAxis"},xX=function(e,n,r,s){if(s)return e.map(function(x){return x.coordinate});var l,f,i=e.map(function(x){return x.coordinate===n&&(l=!0),x.coordinate===r&&(f=!0),x.coordinate});return l||i.push(n),f||i.push(r),i},sg=function(e,n,r){if(!e)return null;var s=e.scale,l=e.duplicateDomain,f=e.type,i=e.range,x=e.realScaleType==="scaleBand"?s.bandwidth()/2:2,S=(n||r)&&f==="category"&&s.bandwidth?s.bandwidth()/x:0;if(S=e.axisType==="angleAxis"&&(i==null?void 0:i.length)>=2?Wh(i[0]-i[1])*2*S:S,n&&(e.ticks||e.niceTicks)){var I=(e.ticks||e.niceTicks).map(function(R){var F=l?l.indexOf(R):R;return{coordinate:s(F)+S,value:R,offset:S}});return I.filter(function(R){return!B1(R.coordinate)})}return e.isCategorical&&e.categoricalDomain?e.categoricalDomain.map(function(R,F){return{coordinate:s(R)+S,value:R,index:F,offset:S}}):s.ticks&&!r?s.ticks(e.tickCount).map(function(R){return{coordinate:s(R)+S,value:R,offset:S}}):s.domain().map(function(R,F){return{coordinate:s(R)+S,value:l?l[R]:R,index:F,offset:S}})},ZP=new WeakMap,iA=function(e,n){if(typeof n!="function")return e;ZP.has(e)||ZP.set(e,new WeakMap);var r=ZP.get(e);if(r.has(n))return r.get(n);var s=function(){e.apply(void 0,arguments),n.apply(void 0,arguments)};return r.set(n,s),s},wX=function(e,n,r){var s=e.scale,l=e.type,f=e.layout,i=e.axisType;if(s==="auto")return f==="radial"&&i==="radiusAxis"?{scale:dw(),realScaleType:"band"}:f==="radial"&&i==="angleAxis"?{scale:OT(),realScaleType:"linear"}:l==="category"&&n&&(n.indexOf("LineChart")>=0||n.indexOf("AreaChart")>=0||n.indexOf("ComposedChart")>=0&&!r)?{scale:Dx(),realScaleType:"point"}:l==="category"?{scale:dw(),realScaleType:"band"}:{scale:OT(),realScaleType:"linear"};if(_2(s)){var x="scale".concat(cE(s));return{scale:(XU[x]||Dx)(),realScaleType:XU[x]?x:"point"}}return qi(s)?{scale:s}:{scale:Dx(),realScaleType:"point"}},f9=1e-4,SX=function(e){var n=e.domain();if(!(!n||n.length<=2)){var r=n.length,s=e.range(),l=Math.min(s[0],s[1])-f9,f=Math.max(s[0],s[1])+f9,i=e(n[0]),x=e(n[r-1]);(i<l||i>f||x<l||x>f)&&e.domain([n[0],n[r-1]])}},ive=function(e,n){if(!e)return null;for(var r=0,s=e.length;r<s;r++)if(e[r].item===n)return e[r].position;return null},ave=function(e,n){if(!n||n.length!==2||!gr(n[0])||!gr(n[1]))return e;var r=Math.min(n[0],n[1]),s=Math.max(n[0],n[1]),l=[e[0],e[1]];return(!gr(e[0])||e[0]<r)&&(l[0]=r),(!gr(e[1])||e[1]>s)&&(l[1]=s),l[0]>s&&(l[0]=s),l[1]<r&&(l[1]=r),l},sve=function(e){var n=e.length;if(!(n<=0))for(var r=0,s=e[0].length;r<s;++r)for(var l=0,f=0,i=0;i<n;++i){var x=B1(e[i][r][1])?e[i][r][0]:e[i][r][1];x>=0?(e[i][r][0]=l,e[i][r][1]=l+x,l=e[i][r][1]):(e[i][r][0]=f,e[i][r][1]=f+x,f=e[i][r][1])}},ove=function(e){var n=e.length;if(!(n<=0))for(var r=0,s=e[0].length;r<s;++r)for(var l=0,f=0;f<n;++f){var i=B1(e[f][r][1])?e[f][r][0]:e[f][r][1];i>=0?(e[f][r][0]=l,e[f][r][1]=l+i,l=e[f][r][1]):(e[f][r][0]=0,e[f][r][1]=0)}},lve={sign:sve,expand:Yhe,none:e1,silhouette:Xhe,wiggle:Zhe,positive:ove},cve=function(e,n,r){var s=n.map(function(i){return i.props.dataKey}),l=lve[r],f=Khe().keys(s).value(function(i,x){return+jl(i,x,0)}).order(aR).offset(l);return f(e)},uve=function(e,n,r,s,l,f){if(!e)return null;var i=f?n.reverse():n,x={},S=i.reduce(function(R,F){var j,H=(j=F.type)!==null&&j!==void 0&&j.defaultProps?bl(bl({},F.type.defaultProps),F.props):F.props,G=H.stackId,W=H.hide;if(W)return R;var J=H[r],ie=R[J]||{hasStack:!1,stackGroups:{}};if(Lc(G)){var he=ie.stackGroups[G]||{numericAxisId:r,cateAxisId:s,items:[]};he.items.push(F),ie.hasStack=!0,ie.stackGroups[G]=he}else ie.stackGroups[mv("_stackId_")]={numericAxisId:r,cateAxisId:s,items:[F]};return bl(bl({},R),{},j0({},J,ie))},x),I={};return Object.keys(S).reduce(function(R,F){var j=S[F];if(j.hasStack){var H={};j.stackGroups=Object.keys(j.stackGroups).reduce(function(G,W){var J=j.stackGroups[W];return bl(bl({},G),{},j0({},W,{numericAxisId:r,cateAxisId:s,items:J.items,stackedData:cve(e,J.items,l)}))},H)}return bl(bl({},R),{},j0({},F,j))},I)},AX=function(e,n){var r=n.realScaleType,s=n.type,l=n.tickCount,f=n.originalDomain,i=n.allowDecimals,x=r||n.scale;if(x!=="auto"&&x!=="linear")return null;if(l&&s==="number"&&f&&(f[0]==="auto"||f[1]==="auto")){var S=e.domain();if(!S.length)return null;var I=A_e(S,l,i);return e.domain([SE(I),_y(I)]),{niceTicks:I}}if(l&&s==="number"){var R=e.domain(),F=T_e(R,l,i);return{niceTicks:F}}return null};function BT(t){var e=t.axis,n=t.ticks,r=t.bandSize,s=t.entry,l=t.index,f=t.dataKey;if(e.type==="category"){if(!e.allowDuplicatedCategory&&e.dataKey&&!aa(s[e.dataKey])){var i=dT(n,"value",s[e.dataKey]);if(i)return i.coordinate+r/2}return n[l]?n[l].coordinate+r/2:null}var x=jl(s,aa(f)?e.dataKey:f);return aa(x)?null:e.scale(x)}var d9=function(e){var n=e.axis,r=e.ticks,s=e.offset,l=e.bandSize,f=e.entry,i=e.index;if(n.type==="category")return r[i]?r[i].coordinate+s:null;var x=jl(f,n.dataKey,n.domain[i]);return aa(x)?null:n.scale(x)-l/2+s},hve=function(e){var n=e.numericAxis,r=n.scale.domain();if(n.type==="number"){var s=Math.min(r[0],r[1]),l=Math.max(r[0],r[1]);return s<=0&&l>=0?0:l<0?l:s}return r[0]},fve=function(e,n){var r,s=(r=e.type)!==null&&r!==void 0&&r.defaultProps?bl(bl({},e.type.defaultProps),e.props):e.props,l=s.stackId;if(Lc(l)){var f=n[l];if(f){var i=f.items.indexOf(e);return i>=0?f.stackedData[i]:null}}return null},dve=function(e){return e.reduce(function(n,r){return[SE(r.concat([n[0]]).filter(gr)),_y(r.concat([n[1]]).filter(gr))]},[1/0,-1/0])},TX=function(e,n,r){return Object.keys(e).reduce(function(s,l){var f=e[l],i=f.stackedData,x=i.reduce(function(S,I){var R=dve(I.slice(n,r+1));return[Math.min(S[0],R[0]),Math.max(S[1],R[1])]},[1/0,-1/0]);return[Math.min(x[0],s[0]),Math.max(x[1],s[1])]},[1/0,-1/0]).map(function(s){return s===1/0||s===-1/0?0:s})},p9=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,m9=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,PR=function(e,n,r){if(qi(e))return e(n,r);if(!Array.isArray(e))return n;var s=[];if(gr(e[0]))s[0]=r?e[0]:Math.min(e[0],n[0]);else if(p9.test(e[0])){var l=+p9.exec(e[0])[1];s[0]=n[0]-l}else qi(e[0])?s[0]=e[0](n[0]):s[0]=n[0];if(gr(e[1]))s[1]=r?e[1]:Math.max(e[1],n[1]);else if(m9.test(e[1])){var f=+m9.exec(e[1])[1];s[1]=n[1]+f}else qi(e[1])?s[1]=e[1](n[1]):s[1]=n[1];return s},jT=function(e,n,r){if(e&&e.scale&&e.scale.bandwidth){var s=e.scale.bandwidth();if(!r||s>0)return s}if(e&&n&&n.length>=2){for(var l=Mk(n,function(R){return R.coordinate}),f=1/0,i=1,x=l.length;i<x;i++){var S=l[i],I=l[i-1];f=Math.min((S.coordinate||0)-(I.coordinate||0),f)}return f===1/0?0:f}return r?void 0:0},g9=function(e,n,r){return!e||!e.length||av(e,sd(r,"type.defaultProps.domain"))?n:e},EX=function(e,n){var r=e.type.defaultProps?bl(bl({},e.type.defaultProps),e.props):e.props,s=r.dataKey,l=r.name,f=r.unit,i=r.formatter,x=r.tooltipType,S=r.chartType,I=r.hide;return bl(bl({},di(e,!1)),{},{dataKey:s,unit:f,formatter:i,name:l||s,color:Qk(e),value:jl(n,s),type:x,payload:n,chartType:S,hide:I})};function ww(t){"@babel/helpers - typeof";return ww=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ww(t)}function y9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function eg(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?y9(Object(n),!0).forEach(function(r){MX(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):y9(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function MX(t,e,n){return e=pve(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function pve(t){var e=mve(t,"string");return ww(e)=="symbol"?e:e+""}function mve(t,e){if(ww(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(ww(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function gve(t,e){return bve(t)||vve(t,e)||_ve(t,e)||yve()}function yve(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _ve(t,e){if(t){if(typeof t=="string")return _9(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _9(t,e)}}function _9(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function vve(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r,s,l,f,i=[],x=!0,S=!1;try{if(l=(n=n.call(t)).next,e!==0)for(;!(x=(r=l.call(n)).done)&&(i.push(r.value),i.length!==e);x=!0);}catch(I){S=!0,s=I}finally{try{if(!x&&n.return!=null&&(f=n.return(),Object(f)!==f))return}finally{if(S)throw s}}return i}}function bve(t){if(Array.isArray(t))return t}var FT=Math.PI/180,xve=function(e){return e*180/Math.PI},bo=function(e,n,r,s){return{x:e+Math.cos(-FT*s)*r,y:n+Math.sin(-FT*s)*r}},CX=function(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(e-(r.left||0)-(r.right||0)),Math.abs(n-(r.top||0)-(r.bottom||0)))/2},wve=function(e,n,r,s,l){var f=e.width,i=e.height,x=e.startAngle,S=e.endAngle,I=Kh(e.cx,f,f/2),R=Kh(e.cy,i,i/2),F=CX(f,i,r),j=Kh(e.innerRadius,F,0),H=Kh(e.outerRadius,F,F*.8),G=Object.keys(n);return G.reduce(function(W,J){var ie=n[J],he=ie.domain,ge=ie.reversed,fe;if(aa(ie.range))s==="angleAxis"?fe=[x,S]:s==="radiusAxis"&&(fe=[j,H]),ge&&(fe=[fe[1],fe[0]]);else{fe=ie.range;var ye=fe,pe=gve(ye,2);x=pe[0],S=pe[1]}var be=wX(ie,l),Ae=be.realScaleType,Oe=be.scale;Oe.domain(he).range(fe),SX(Oe);var ue=AX(Oe,eg(eg({},ie),{},{realScaleType:Ae})),we=eg(eg(eg({},ie),ue),{},{range:fe,radius:H,realScaleType:Ae,scale:Oe,cx:I,cy:R,innerRadius:j,outerRadius:H,startAngle:x,endAngle:S});return eg(eg({},W),{},MX({},J,we))},{})},Sve=function(e,n){var r=e.x,s=e.y,l=n.x,f=n.y;return Math.sqrt(Math.pow(r-l,2)+Math.pow(s-f,2))},Ave=function(e,n){var r=e.x,s=e.y,l=n.cx,f=n.cy,i=Sve({x:r,y:s},{x:l,y:f});if(i<=0)return{radius:i};var x=(r-l)/i,S=Math.acos(x);return s>f&&(S=2*Math.PI-S),{radius:i,angle:xve(S),angleInRadian:S}},Tve=function(e){var n=e.startAngle,r=e.endAngle,s=Math.floor(n/360),l=Math.floor(r/360),f=Math.min(s,l);return{startAngle:n-f*360,endAngle:r-f*360}},Eve=function(e,n){var r=n.startAngle,s=n.endAngle,l=Math.floor(r/360),f=Math.floor(s/360),i=Math.min(l,f);return e+i*360},v9=function(e,n){var r=e.x,s=e.y,l=Ave({x:r,y:s},n),f=l.radius,i=l.angle,x=n.innerRadius,S=n.outerRadius;if(f<x||f>S)return!1;if(f===0)return!0;var I=Tve(n),R=I.startAngle,F=I.endAngle,j=i,H;if(R<=F){for(;j>F;)j-=360;for(;j<R;)j+=360;H=j>=R&&j<=F}else{for(;j>R;)j-=360;for(;j<F;)j+=360;H=j>=F&&j<=R}return H?eg(eg({},n),{},{radius:f,angle:Eve(j,n)}):null},IX=function(e){return!st.isValidElement(e)&&!qi(e)&&typeof e!="boolean"?e.className:""};function Sw(t){"@babel/helpers - typeof";return Sw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Sw(t)}var Mve=["offset"];function Cve(t){return Rve(t)||Ove(t)||Pve(t)||Ive()}function Ive(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Pve(t,e){if(t){if(typeof t=="string")return OR(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return OR(t,e)}}function Ove(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Rve(t){if(Array.isArray(t))return OR(t)}function OR(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Dve(t,e){if(t==null)return{};var n=Lve(t,e),r,s;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(s=0;s<l.length;s++)r=l[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function Lve(t,e){if(t==null)return{};var n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;n[r]=t[r]}return n}function b9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function Oc(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?b9(Object(n),!0).forEach(function(r){kve(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):b9(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function kve(t,e,n){return e=Nve(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Nve(t){var e=zve(t,"string");return Sw(e)=="symbol"?e:e+""}function zve(t,e){if(Sw(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(Sw(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Aw(){return Aw=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Aw.apply(this,arguments)}var Bve=function(e){var n=e.value,r=e.formatter,s=aa(e.children)?n:e.children;return qi(r)?r(s):s},jve=function(e,n){var r=Wh(n-e),s=Math.min(Math.abs(n-e),360);return r*s},Fve=function(e,n,r){var s=e.position,l=e.viewBox,f=e.offset,i=e.className,x=l,S=x.cx,I=x.cy,R=x.innerRadius,F=x.outerRadius,j=x.startAngle,H=x.endAngle,G=x.clockWise,W=(R+F)/2,J=jve(j,H),ie=J>=0?1:-1,he,ge;s==="insideStart"?(he=j+ie*f,ge=G):s==="insideEnd"?(he=H-ie*f,ge=!G):s==="end"&&(he=H+ie*f,ge=G),ge=J<=0?ge:!ge;var fe=bo(S,I,W,he),ye=bo(S,I,W,he+(ge?1:-1)*359),pe="M".concat(fe.x,",").concat(fe.y,`
    A`).concat(W,",").concat(W,",0,1,").concat(ge?0:1,`,
    `).concat(ye.x,",").concat(ye.y),be=aa(e.id)?mv("recharts-radial-line-"):e.id;return kt.createElement("text",Aw({},r,{dominantBaseline:"central",className:fa("recharts-radial-bar-label",i)}),kt.createElement("defs",null,kt.createElement("path",{id:be,d:pe})),kt.createElement("textPath",{xlinkHref:"#".concat(be)},n))},Uve=function(e){var n=e.viewBox,r=e.offset,s=e.position,l=n,f=l.cx,i=l.cy,x=l.innerRadius,S=l.outerRadius,I=l.startAngle,R=l.endAngle,F=(I+R)/2;if(s==="outside"){var j=bo(f,i,S+r,F),H=j.x,G=j.y;return{x:H,y:G,textAnchor:H>=f?"start":"end",verticalAnchor:"middle"}}if(s==="center")return{x:f,y:i,textAnchor:"middle",verticalAnchor:"middle"};if(s==="centerTop")return{x:f,y:i,textAnchor:"middle",verticalAnchor:"start"};if(s==="centerBottom")return{x:f,y:i,textAnchor:"middle",verticalAnchor:"end"};var W=(x+S)/2,J=bo(f,i,W,F),ie=J.x,he=J.y;return{x:ie,y:he,textAnchor:"middle",verticalAnchor:"middle"}},qve=function(e){var n=e.viewBox,r=e.parentViewBox,s=e.offset,l=e.position,f=n,i=f.x,x=f.y,S=f.width,I=f.height,R=I>=0?1:-1,F=R*s,j=R>0?"end":"start",H=R>0?"start":"end",G=S>=0?1:-1,W=G*s,J=G>0?"end":"start",ie=G>0?"start":"end";if(l==="top"){var he={x:i+S/2,y:x-R*s,textAnchor:"middle",verticalAnchor:j};return Oc(Oc({},he),r?{height:Math.max(x-r.y,0),width:S}:{})}if(l==="bottom"){var ge={x:i+S/2,y:x+I+F,textAnchor:"middle",verticalAnchor:H};return Oc(Oc({},ge),r?{height:Math.max(r.y+r.height-(x+I),0),width:S}:{})}if(l==="left"){var fe={x:i-W,y:x+I/2,textAnchor:J,verticalAnchor:"middle"};return Oc(Oc({},fe),r?{width:Math.max(fe.x-r.x,0),height:I}:{})}if(l==="right"){var ye={x:i+S+W,y:x+I/2,textAnchor:ie,verticalAnchor:"middle"};return Oc(Oc({},ye),r?{width:Math.max(r.x+r.width-ye.x,0),height:I}:{})}var pe=r?{width:S,height:I}:{};return l==="insideLeft"?Oc({x:i+W,y:x+I/2,textAnchor:ie,verticalAnchor:"middle"},pe):l==="insideRight"?Oc({x:i+S-W,y:x+I/2,textAnchor:J,verticalAnchor:"middle"},pe):l==="insideTop"?Oc({x:i+S/2,y:x+F,textAnchor:"middle",verticalAnchor:H},pe):l==="insideBottom"?Oc({x:i+S/2,y:x+I-F,textAnchor:"middle",verticalAnchor:j},pe):l==="insideTopLeft"?Oc({x:i+W,y:x+F,textAnchor:ie,verticalAnchor:H},pe):l==="insideTopRight"?Oc({x:i+S-W,y:x+F,textAnchor:J,verticalAnchor:H},pe):l==="insideBottomLeft"?Oc({x:i+W,y:x+I-F,textAnchor:ie,verticalAnchor:j},pe):l==="insideBottomRight"?Oc({x:i+S-W,y:x+I-F,textAnchor:J,verticalAnchor:j},pe):z1(l)&&(gr(l.x)||B_(l.x))&&(gr(l.y)||B_(l.y))?Oc({x:i+Kh(l.x,S),y:x+Kh(l.y,I),textAnchor:"end",verticalAnchor:"end"},pe):Oc({x:i+S/2,y:x+I/2,textAnchor:"middle",verticalAnchor:"middle"},pe)},Vve=function(e){return"cx"in e&&gr(e.cx)};function eu(t){var e=t.offset,n=e===void 0?5:e,r=Dve(t,Mve),s=Oc({offset:n},r),l=s.viewBox,f=s.position,i=s.value,x=s.children,S=s.content,I=s.className,R=I===void 0?"":I,F=s.textBreakAll;if(!l||aa(i)&&aa(x)&&!st.isValidElement(S)&&!qi(S))return null;if(st.isValidElement(S))return st.cloneElement(S,s);var j;if(qi(S)){if(j=st.createElement(S,s),st.isValidElement(j))return j}else j=Bve(s);var H=Vve(l),G=di(s,!0);if(H&&(f==="insideStart"||f==="insideEnd"||f==="end"))return Fve(s,j,G);var W=H?Uve(s):qve(s);return kt.createElement(iv,Aw({className:fa("recharts-label",R)},G,W,{breakAll:F}),j)}eu.displayName="Label";var PX=function(e){var n=e.cx,r=e.cy,s=e.angle,l=e.startAngle,f=e.endAngle,i=e.r,x=e.radius,S=e.innerRadius,I=e.outerRadius,R=e.x,F=e.y,j=e.top,H=e.left,G=e.width,W=e.height,J=e.clockWise,ie=e.labelViewBox;if(ie)return ie;if(gr(G)&&gr(W)){if(gr(R)&&gr(F))return{x:R,y:F,width:G,height:W};if(gr(j)&&gr(H))return{x:j,y:H,width:G,height:W}}return gr(R)&&gr(F)?{x:R,y:F,width:0,height:0}:gr(n)&&gr(r)?{cx:n,cy:r,startAngle:l||s||0,endAngle:f||s||0,innerRadius:S||0,outerRadius:I||x||i||0,clockWise:J}:e.viewBox?e.viewBox:{}},$ve=function(e,n){return e?e===!0?kt.createElement(eu,{key:"label-implicit",viewBox:n}):Lc(e)?kt.createElement(eu,{key:"label-implicit",viewBox:n,value:e}):st.isValidElement(e)?e.type===eu?st.cloneElement(e,{key:"label-implicit",viewBox:n}):kt.createElement(eu,{key:"label-implicit",content:e,viewBox:n}):qi(e)?kt.createElement(eu,{key:"label-implicit",content:e,viewBox:n}):z1(e)?kt.createElement(eu,Aw({viewBox:n},e,{key:"label-implicit"})):null:null},Hve=function(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&r&&!e.label)return null;var s=e.children,l=PX(e),f=od(s,eu).map(function(x,S){return st.cloneElement(x,{viewBox:n||l,key:"label-".concat(S)})});if(!r)return f;var i=$ve(e.label,n||l);return[i].concat(Cve(f))};eu.parseViewBox=PX;eu.renderCallByParent=Hve;var JP,x9;function Gve(){if(x9)return JP;x9=1;function t(e){var n=e==null?0:e.length;return n?e[n-1]:void 0}return JP=t,JP}var Wve=Gve();const Kve=Xa(Wve);function Tw(t){"@babel/helpers - typeof";return Tw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Tw(t)}var Yve=["valueAccessor"],Xve=["data","dataKey","clockWise","id","textBreakAll"];function Zve(t){return t0e(t)||e0e(t)||Qve(t)||Jve()}function Jve(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Qve(t,e){if(t){if(typeof t=="string")return RR(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return RR(t,e)}}function e0e(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function t0e(t){if(Array.isArray(t))return RR(t)}function RR(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function UT(){return UT=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},UT.apply(this,arguments)}function w9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function S9(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?w9(Object(n),!0).forEach(function(r){n0e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):w9(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function n0e(t,e,n){return e=r0e(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r0e(t){var e=i0e(t,"string");return Tw(e)=="symbol"?e:e+""}function i0e(t,e){if(Tw(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(Tw(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function A9(t,e){if(t==null)return{};var n=a0e(t,e),r,s;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(s=0;s<l.length;s++)r=l[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function a0e(t,e){if(t==null)return{};var n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;n[r]=t[r]}return n}var s0e=function(e){return Array.isArray(e.value)?Kve(e.value):e.value};function Ep(t){var e=t.valueAccessor,n=e===void 0?s0e:e,r=A9(t,Yve),s=r.data,l=r.dataKey,f=r.clockWise,i=r.id,x=r.textBreakAll,S=A9(r,Xve);return!s||!s.length?null:kt.createElement(Na,{className:"recharts-label-list"},s.map(function(I,R){var F=aa(l)?n(I,R):jl(I&&I.payload,l),j=aa(i)?{}:{id:"".concat(i,"-").concat(R)};return kt.createElement(eu,UT({},di(I,!0),S,j,{parentViewBox:I.parentViewBox,value:F,textBreakAll:x,viewBox:eu.parseViewBox(aa(f)?I:S9(S9({},I),{},{clockWise:f})),key:"label-".concat(R),index:R}))}))}Ep.displayName="LabelList";function o0e(t,e){return t?t===!0?kt.createElement(Ep,{key:"labelList-implicit",data:e}):kt.isValidElement(t)||qi(t)?kt.createElement(Ep,{key:"labelList-implicit",data:e,content:t}):z1(t)?kt.createElement(Ep,UT({data:e},t,{key:"labelList-implicit"})):null:null}function l0e(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!t||!t.children&&n&&!t.label)return null;var r=t.children,s=od(r,Ep).map(function(f,i){return st.cloneElement(f,{data:e,key:"labelList-".concat(i)})});if(!n)return s;var l=o0e(t.label,e);return[l].concat(Zve(s))}Ep.renderCallByParent=l0e;function Ew(t){"@babel/helpers - typeof";return Ew=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ew(t)}function DR(){return DR=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},DR.apply(this,arguments)}function T9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function E9(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?T9(Object(n),!0).forEach(function(r){c0e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):T9(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function c0e(t,e,n){return e=u0e(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function u0e(t){var e=h0e(t,"string");return Ew(e)=="symbol"?e:e+""}function h0e(t,e){if(Ew(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(Ew(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var f0e=function(e,n){var r=Wh(n-e),s=Math.min(Math.abs(n-e),359.999);return r*s},aA=function(e){var n=e.cx,r=e.cy,s=e.radius,l=e.angle,f=e.sign,i=e.isExternal,x=e.cornerRadius,S=e.cornerIsExternal,I=x*(i?1:-1)+s,R=Math.asin(x/I)/FT,F=S?l:l+f*R,j=bo(n,r,I,F),H=bo(n,r,s,F),G=S?l-f*R:l,W=bo(n,r,I*Math.cos(R*FT),G);return{center:j,circleTangency:H,lineTangency:W,theta:R}},OX=function(e){var n=e.cx,r=e.cy,s=e.innerRadius,l=e.outerRadius,f=e.startAngle,i=e.endAngle,x=f0e(f,i),S=f+x,I=bo(n,r,l,f),R=bo(n,r,l,S),F="M ".concat(I.x,",").concat(I.y,`
    A `).concat(l,",").concat(l,`,0,
    `).concat(+(Math.abs(x)>180),",").concat(+(f>S),`,
    `).concat(R.x,",").concat(R.y,`
  `);if(s>0){var j=bo(n,r,s,f),H=bo(n,r,s,S);F+="L ".concat(H.x,",").concat(H.y,`
            A `).concat(s,",").concat(s,`,0,
            `).concat(+(Math.abs(x)>180),",").concat(+(f<=S),`,
            `).concat(j.x,",").concat(j.y," Z")}else F+="L ".concat(n,",").concat(r," Z");return F},d0e=function(e){var n=e.cx,r=e.cy,s=e.innerRadius,l=e.outerRadius,f=e.cornerRadius,i=e.forceCornerRadius,x=e.cornerIsExternal,S=e.startAngle,I=e.endAngle,R=Wh(I-S),F=aA({cx:n,cy:r,radius:l,angle:S,sign:R,cornerRadius:f,cornerIsExternal:x}),j=F.circleTangency,H=F.lineTangency,G=F.theta,W=aA({cx:n,cy:r,radius:l,angle:I,sign:-R,cornerRadius:f,cornerIsExternal:x}),J=W.circleTangency,ie=W.lineTangency,he=W.theta,ge=x?Math.abs(S-I):Math.abs(S-I)-G-he;if(ge<0)return i?"M ".concat(H.x,",").concat(H.y,`
        a`).concat(f,",").concat(f,",0,0,1,").concat(f*2,`,0
        a`).concat(f,",").concat(f,",0,0,1,").concat(-f*2,`,0
      `):OX({cx:n,cy:r,innerRadius:s,outerRadius:l,startAngle:S,endAngle:I});var fe="M ".concat(H.x,",").concat(H.y,`
    A`).concat(f,",").concat(f,",0,0,").concat(+(R<0),",").concat(j.x,",").concat(j.y,`
    A`).concat(l,",").concat(l,",0,").concat(+(ge>180),",").concat(+(R<0),",").concat(J.x,",").concat(J.y,`
    A`).concat(f,",").concat(f,",0,0,").concat(+(R<0),",").concat(ie.x,",").concat(ie.y,`
  `);if(s>0){var ye=aA({cx:n,cy:r,radius:s,angle:S,sign:R,isExternal:!0,cornerRadius:f,cornerIsExternal:x}),pe=ye.circleTangency,be=ye.lineTangency,Ae=ye.theta,Oe=aA({cx:n,cy:r,radius:s,angle:I,sign:-R,isExternal:!0,cornerRadius:f,cornerIsExternal:x}),ue=Oe.circleTangency,we=Oe.lineTangency,ke=Oe.theta,De=x?Math.abs(S-I):Math.abs(S-I)-Ae-ke;if(De<0&&f===0)return"".concat(fe,"L").concat(n,",").concat(r,"Z");fe+="L".concat(we.x,",").concat(we.y,`
      A`).concat(f,",").concat(f,",0,0,").concat(+(R<0),",").concat(ue.x,",").concat(ue.y,`
      A`).concat(s,",").concat(s,",0,").concat(+(De>180),",").concat(+(R>0),",").concat(pe.x,",").concat(pe.y,`
      A`).concat(f,",").concat(f,",0,0,").concat(+(R<0),",").concat(be.x,",").concat(be.y,"Z")}else fe+="L".concat(n,",").concat(r,"Z");return fe},p0e={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},RX=function(e){var n=E9(E9({},p0e),e),r=n.cx,s=n.cy,l=n.innerRadius,f=n.outerRadius,i=n.cornerRadius,x=n.forceCornerRadius,S=n.cornerIsExternal,I=n.startAngle,R=n.endAngle,F=n.className;if(f<l||I===R)return null;var j=fa("recharts-sector",F),H=f-l,G=Kh(i,H,0,!0),W;return G>0&&Math.abs(I-R)<360?W=d0e({cx:r,cy:s,innerRadius:l,outerRadius:f,cornerRadius:Math.min(G,H/2),forceCornerRadius:x,cornerIsExternal:S,startAngle:I,endAngle:R}):W=OX({cx:r,cy:s,innerRadius:l,outerRadius:f,startAngle:I,endAngle:R}),kt.createElement("path",DR({},di(n,!0),{className:j,d:W,role:"img"}))};function Mw(t){"@babel/helpers - typeof";return Mw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mw(t)}function LR(){return LR=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},LR.apply(this,arguments)}function M9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function C9(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?M9(Object(n),!0).forEach(function(r){m0e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):M9(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function m0e(t,e,n){return e=g0e(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function g0e(t){var e=y0e(t,"string");return Mw(e)=="symbol"?e:e+""}function y0e(t,e){if(Mw(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(Mw(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var I9={curveBasisClosed:zhe,curveBasisOpen:Bhe,curveBasis:Nhe,curveBumpX:whe,curveBumpY:She,curveLinearClosed:jhe,curveLinear:hE,curveMonotoneX:Fhe,curveMonotoneY:Uhe,curveNatural:qhe,curveStep:Vhe,curveStepAfter:Hhe,curveStepBefore:$he},sA=function(e){return e.x===+e.x&&e.y===+e.y},ox=function(e){return e.x},lx=function(e){return e.y},_0e=function(e,n){if(qi(e))return e;var r="curve".concat(cE(e));return(r==="curveMonotone"||r==="curveBump")&&n?I9["".concat(r).concat(n==="vertical"?"Y":"X")]:I9[r]||hE},v0e=function(e){var n=e.type,r=n===void 0?"linear":n,s=e.points,l=s===void 0?[]:s,f=e.baseLine,i=e.layout,x=e.connectNulls,S=x===void 0?!1:x,I=_0e(r,i),R=S?l.filter(function(G){return sA(G)}):l,F;if(Array.isArray(f)){var j=S?f.filter(function(G){return sA(G)}):f,H=R.map(function(G,W){return C9(C9({},G),{},{base:j[W]})});return i==="vertical"?F=ZS().y(lx).x1(ox).x0(function(G){return G.base.x}):F=ZS().x(ox).y1(lx).y0(function(G){return G.base.y}),F.defined(sA).curve(I),F(H)}return i==="vertical"&&gr(f)?F=ZS().y(lx).x1(ox).x0(f):gr(f)?F=ZS().x(ox).y1(lx).y0(f):F=PK().x(ox).y(lx),F.defined(sA).curve(I),F(R)},K_=function(e){var n=e.className,r=e.points,s=e.path,l=e.pathRef;if((!r||!r.length)&&!s)return null;var f=r&&r.length?v0e(e):s;return kt.createElement("path",LR({},di(e,!1),pT(e),{className:fa("recharts-curve",n),d:f,ref:l}))},QP={exports:{}},eO,P9;function b0e(){if(P9)return eO;P9=1;var t="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return eO=t,eO}var tO,O9;function x0e(){if(O9)return tO;O9=1;var t=b0e();function e(){}function n(){}return n.resetWarningCache=e,tO=function(){function r(f,i,x,S,I,R){if(R!==t){var F=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw F.name="Invariant Violation",F}}r.isRequired=r;function s(){return r}var l={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:s,element:r,elementType:r,instanceOf:s,node:r,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:n,resetWarningCache:e};return l.PropTypes=l,l},tO}var R9;function w0e(){return R9||(R9=1,QP.exports=x0e()()),QP.exports}var S0e=w0e();const Os=Xa(S0e);var A0e=Object.getOwnPropertyNames,T0e=Object.getOwnPropertySymbols,E0e=Object.prototype.hasOwnProperty;function D9(t,e){return function(r,s,l){return t(r,s,l)&&e(r,s,l)}}function oA(t){return function(n,r,s){if(!n||!r||typeof n!="object"||typeof r!="object")return t(n,r,s);var l=s.cache,f=l.get(n),i=l.get(r);if(f&&i)return f===r&&i===n;l.set(n,r),l.set(r,n);var x=t(n,r,s);return l.delete(n),l.delete(r),x}}function L9(t){return A0e(t).concat(T0e(t))}var M0e=Object.hasOwn||function(t,e){return E0e.call(t,e)};function _v(t,e){return t===e||!t&&!e&&t!==t&&e!==e}var C0e="__v",I0e="__o",P0e="_owner",k9=Object.getOwnPropertyDescriptor,N9=Object.keys;function O0e(t,e,n){var r=t.length;if(e.length!==r)return!1;for(;r-- >0;)if(!n.equals(t[r],e[r],r,r,t,e,n))return!1;return!0}function R0e(t,e){return _v(t.getTime(),e.getTime())}function D0e(t,e){return t.name===e.name&&t.message===e.message&&t.cause===e.cause&&t.stack===e.stack}function L0e(t,e){return t===e}function z9(t,e,n){var r=t.size;if(r!==e.size)return!1;if(!r)return!0;for(var s=new Array(r),l=t.entries(),f,i,x=0;(f=l.next())&&!f.done;){for(var S=e.entries(),I=!1,R=0;(i=S.next())&&!i.done;){if(s[R]){R++;continue}var F=f.value,j=i.value;if(n.equals(F[0],j[0],x,R,t,e,n)&&n.equals(F[1],j[1],F[0],j[0],t,e,n)){I=s[R]=!0;break}R++}if(!I)return!1;x++}return!0}var k0e=_v;function N0e(t,e,n){var r=N9(t),s=r.length;if(N9(e).length!==s)return!1;for(;s-- >0;)if(!DX(t,e,n,r[s]))return!1;return!0}function cx(t,e,n){var r=L9(t),s=r.length;if(L9(e).length!==s)return!1;for(var l,f,i;s-- >0;)if(l=r[s],!DX(t,e,n,l)||(f=k9(t,l),i=k9(e,l),(f||i)&&(!f||!i||f.configurable!==i.configurable||f.enumerable!==i.enumerable||f.writable!==i.writable)))return!1;return!0}function z0e(t,e){return _v(t.valueOf(),e.valueOf())}function B0e(t,e){return t.source===e.source&&t.flags===e.flags}function B9(t,e,n){var r=t.size;if(r!==e.size)return!1;if(!r)return!0;for(var s=new Array(r),l=t.values(),f,i;(f=l.next())&&!f.done;){for(var x=e.values(),S=!1,I=0;(i=x.next())&&!i.done;){if(!s[I]&&n.equals(f.value,i.value,f.value,i.value,t,e,n)){S=s[I]=!0;break}I++}if(!S)return!1}return!0}function j0e(t,e){var n=t.length;if(e.length!==n)return!1;for(;n-- >0;)if(t[n]!==e[n])return!1;return!0}function F0e(t,e){return t.hostname===e.hostname&&t.pathname===e.pathname&&t.protocol===e.protocol&&t.port===e.port&&t.hash===e.hash&&t.username===e.username&&t.password===e.password}function DX(t,e,n,r){return(r===P0e||r===I0e||r===C0e)&&(t.$$typeof||e.$$typeof)?!0:M0e(e,r)&&n.equals(t[r],e[r],r,r,t,e,n)}var U0e="[object Arguments]",q0e="[object Boolean]",V0e="[object Date]",$0e="[object Error]",H0e="[object Map]",G0e="[object Number]",W0e="[object Object]",K0e="[object RegExp]",Y0e="[object Set]",X0e="[object String]",Z0e="[object URL]",J0e=Array.isArray,j9=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,F9=Object.assign,Q0e=Object.prototype.toString.call.bind(Object.prototype.toString);function e1e(t){var e=t.areArraysEqual,n=t.areDatesEqual,r=t.areErrorsEqual,s=t.areFunctionsEqual,l=t.areMapsEqual,f=t.areNumbersEqual,i=t.areObjectsEqual,x=t.arePrimitiveWrappersEqual,S=t.areRegExpsEqual,I=t.areSetsEqual,R=t.areTypedArraysEqual,F=t.areUrlsEqual;return function(H,G,W){if(H===G)return!0;if(H==null||G==null)return!1;var J=typeof H;if(J!==typeof G)return!1;if(J!=="object")return J==="number"?f(H,G,W):J==="function"?s(H,G,W):!1;var ie=H.constructor;if(ie!==G.constructor)return!1;if(ie===Object)return i(H,G,W);if(J0e(H))return e(H,G,W);if(j9!=null&&j9(H))return R(H,G,W);if(ie===Date)return n(H,G,W);if(ie===RegExp)return S(H,G,W);if(ie===Map)return l(H,G,W);if(ie===Set)return I(H,G,W);var he=Q0e(H);return he===V0e?n(H,G,W):he===K0e?S(H,G,W):he===H0e?l(H,G,W):he===Y0e?I(H,G,W):he===W0e?typeof H.then!="function"&&typeof G.then!="function"&&i(H,G,W):he===Z0e?F(H,G,W):he===$0e?r(H,G,W):he===U0e?i(H,G,W):he===q0e||he===G0e||he===X0e?x(H,G,W):!1}}function t1e(t){var e=t.circular,n=t.createCustomConfig,r=t.strict,s={areArraysEqual:r?cx:O0e,areDatesEqual:R0e,areErrorsEqual:D0e,areFunctionsEqual:L0e,areMapsEqual:r?D9(z9,cx):z9,areNumbersEqual:k0e,areObjectsEqual:r?cx:N0e,arePrimitiveWrappersEqual:z0e,areRegExpsEqual:B0e,areSetsEqual:r?D9(B9,cx):B9,areTypedArraysEqual:r?cx:j0e,areUrlsEqual:F0e};if(n&&(s=F9({},s,n(s))),e){var l=oA(s.areArraysEqual),f=oA(s.areMapsEqual),i=oA(s.areObjectsEqual),x=oA(s.areSetsEqual);s=F9({},s,{areArraysEqual:l,areMapsEqual:f,areObjectsEqual:i,areSetsEqual:x})}return s}function n1e(t){return function(e,n,r,s,l,f,i){return t(e,n,i)}}function r1e(t){var e=t.circular,n=t.comparator,r=t.createState,s=t.equals,l=t.strict;if(r)return function(x,S){var I=r(),R=I.cache,F=R===void 0?e?new WeakMap:void 0:R,j=I.meta;return n(x,S,{cache:F,equals:s,meta:j,strict:l})};if(e)return function(x,S){return n(x,S,{cache:new WeakMap,equals:s,meta:void 0,strict:l})};var f={cache:void 0,equals:s,meta:void 0,strict:l};return function(x,S){return n(x,S,f)}}var i1e=jy();jy({strict:!0});jy({circular:!0});jy({circular:!0,strict:!0});jy({createInternalComparator:function(){return _v}});jy({strict:!0,createInternalComparator:function(){return _v}});jy({circular:!0,createInternalComparator:function(){return _v}});jy({circular:!0,createInternalComparator:function(){return _v},strict:!0});function jy(t){t===void 0&&(t={});var e=t.circular,n=e===void 0?!1:e,r=t.createInternalComparator,s=t.createState,l=t.strict,f=l===void 0?!1:l,i=t1e(t),x=e1e(i),S=r?r(x):n1e(x);return r1e({circular:n,comparator:x,createState:s,equals:S,strict:f})}function a1e(t){typeof requestAnimationFrame<"u"&&requestAnimationFrame(t)}function U9(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=-1,r=function s(l){n<0&&(n=l),l-n>e?(t(l),n=-1):a1e(s)};requestAnimationFrame(r)}function kR(t){"@babel/helpers - typeof";return kR=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kR(t)}function s1e(t){return u1e(t)||c1e(t)||l1e(t)||o1e()}function o1e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function l1e(t,e){if(t){if(typeof t=="string")return q9(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return q9(t,e)}}function q9(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function c1e(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function u1e(t){if(Array.isArray(t))return t}function h1e(){var t={},e=function(){return null},n=!1,r=function s(l){if(!n){if(Array.isArray(l)){if(!l.length)return;var f=l,i=s1e(f),x=i[0],S=i.slice(1);if(typeof x=="number"){U9(s.bind(null,S),x);return}s(x),U9(s.bind(null,S));return}kR(l)==="object"&&(t=l,e(t)),typeof l=="function"&&l()}};return{stop:function(){n=!0},start:function(l){n=!1,r(l)},subscribe:function(l){return e=l,function(){e=function(){return null}}}}}function Cw(t){"@babel/helpers - typeof";return Cw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Cw(t)}function V9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function $9(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?V9(Object(n),!0).forEach(function(r){LX(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):V9(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function LX(t,e,n){return e=f1e(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function f1e(t){var e=d1e(t,"string");return Cw(e)==="symbol"?e:String(e)}function d1e(t,e){if(Cw(t)!=="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(Cw(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var p1e=function(e,n){return[Object.keys(e),Object.keys(n)].reduce(function(r,s){return r.filter(function(l){return s.includes(l)})})},m1e=function(e){return e},g1e=function(e){return e.replace(/([A-Z])/g,function(n){return"-".concat(n.toLowerCase())})},kx=function(e,n){return Object.keys(n).reduce(function(r,s){return $9($9({},r),{},LX({},s,e(s,n[s])))},{})},H9=function(e,n,r){return e.map(function(s){return"".concat(g1e(s)," ").concat(n,"ms ").concat(r)}).join(",")};function y1e(t,e){return b1e(t)||v1e(t,e)||kX(t,e)||_1e()}function _1e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function v1e(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r,s,l,f,i=[],x=!0,S=!1;try{if(l=(n=n.call(t)).next,e!==0)for(;!(x=(r=l.call(n)).done)&&(i.push(r.value),i.length!==e);x=!0);}catch(I){S=!0,s=I}finally{try{if(!x&&n.return!=null&&(f=n.return(),Object(f)!==f))return}finally{if(S)throw s}}return i}}function b1e(t){if(Array.isArray(t))return t}function x1e(t){return A1e(t)||S1e(t)||kX(t)||w1e()}function w1e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kX(t,e){if(t){if(typeof t=="string")return NR(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return NR(t,e)}}function S1e(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function A1e(t){if(Array.isArray(t))return NR(t)}function NR(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var qT=1e-4,NX=function(e,n){return[0,3*e,3*n-6*e,3*e-3*n+1]},zX=function(e,n){return e.map(function(r,s){return r*Math.pow(n,s)}).reduce(function(r,s){return r+s})},G9=function(e,n){return function(r){var s=NX(e,n);return zX(s,r)}},T1e=function(e,n){return function(r){var s=NX(e,n),l=[].concat(x1e(s.map(function(f,i){return f*i}).slice(1)),[0]);return zX(l,r)}},W9=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var s=n[0],l=n[1],f=n[2],i=n[3];if(n.length===1)switch(n[0]){case"linear":s=0,l=0,f=1,i=1;break;case"ease":s=.25,l=.1,f=.25,i=1;break;case"ease-in":s=.42,l=0,f=1,i=1;break;case"ease-out":s=.42,l=0,f=.58,i=1;break;case"ease-in-out":s=0,l=0,f=.58,i=1;break;default:{var x=n[0].split("(");if(x[0]==="cubic-bezier"&&x[1].split(")")[0].split(",").length===4){var S=x[1].split(")")[0].split(",").map(function(W){return parseFloat(W)}),I=y1e(S,4);s=I[0],l=I[1],f=I[2],i=I[3]}}}var R=G9(s,f),F=G9(l,i),j=T1e(s,f),H=function(J){return J>1?1:J<0?0:J},G=function(J){for(var ie=J>1?1:J,he=ie,ge=0;ge<8;++ge){var fe=R(he)-ie,ye=j(he);if(Math.abs(fe-ie)<qT||ye<qT)return F(he);he=H(he-fe/ye)}return F(he)};return G.isStepper=!1,G},E1e=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.stiff,r=n===void 0?100:n,s=e.damping,l=s===void 0?8:s,f=e.dt,i=f===void 0?17:f,x=function(I,R,F){var j=-(I-R)*r,H=F*l,G=F+(j-H)*i/1e3,W=F*i/1e3+I;return Math.abs(W-R)<qT&&Math.abs(G)<qT?[R,0]:[W,G]};return x.isStepper=!0,x.dt=i,x},M1e=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var s=n[0];if(typeof s=="string")switch(s){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return W9(s);case"spring":return E1e();default:if(s.split("(")[0]==="cubic-bezier")return W9(s)}return typeof s=="function"?s:null};function Iw(t){"@babel/helpers - typeof";return Iw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Iw(t)}function K9(t){return P1e(t)||I1e(t)||BX(t)||C1e()}function C1e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function I1e(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function P1e(t){if(Array.isArray(t))return BR(t)}function Y9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function Tu(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Y9(Object(n),!0).forEach(function(r){zR(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Y9(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function zR(t,e,n){return e=O1e(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function O1e(t){var e=R1e(t,"string");return Iw(e)==="symbol"?e:String(e)}function R1e(t,e){if(Iw(t)!=="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(Iw(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function D1e(t,e){return N1e(t)||k1e(t,e)||BX(t,e)||L1e()}function L1e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function BX(t,e){if(t){if(typeof t=="string")return BR(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return BR(t,e)}}function BR(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function k1e(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r,s,l,f,i=[],x=!0,S=!1;try{if(l=(n=n.call(t)).next,e!==0)for(;!(x=(r=l.call(n)).done)&&(i.push(r.value),i.length!==e);x=!0);}catch(I){S=!0,s=I}finally{try{if(!x&&n.return!=null&&(f=n.return(),Object(f)!==f))return}finally{if(S)throw s}}return i}}function N1e(t){if(Array.isArray(t))return t}var VT=function(e,n,r){return e+(n-e)*r},jR=function(e){var n=e.from,r=e.to;return n!==r},z1e=function t(e,n,r){var s=kx(function(l,f){if(jR(f)){var i=e(f.from,f.to,f.velocity),x=D1e(i,2),S=x[0],I=x[1];return Tu(Tu({},f),{},{from:S,velocity:I})}return f},n);return r<1?kx(function(l,f){return jR(f)?Tu(Tu({},f),{},{velocity:VT(f.velocity,s[l].velocity,r),from:VT(f.from,s[l].from,r)}):f},n):t(e,s,r-1)};const B1e=function(t,e,n,r,s){var l=p1e(t,e),f=l.reduce(function(W,J){return Tu(Tu({},W),{},zR({},J,[t[J],e[J]]))},{}),i=l.reduce(function(W,J){return Tu(Tu({},W),{},zR({},J,{from:t[J],velocity:0,to:e[J]}))},{}),x=-1,S,I,R=function(){return null},F=function(){return kx(function(J,ie){return ie.from},i)},j=function(){return!Object.values(i).filter(jR).length},H=function(J){S||(S=J);var ie=J-S,he=ie/n.dt;i=z1e(n,i,he),s(Tu(Tu(Tu({},t),e),F())),S=J,j()||(x=requestAnimationFrame(R))},G=function(J){I||(I=J);var ie=(J-I)/r,he=kx(function(fe,ye){return VT.apply(void 0,K9(ye).concat([n(ie)]))},f);if(s(Tu(Tu(Tu({},t),e),he)),ie<1)x=requestAnimationFrame(R);else{var ge=kx(function(fe,ye){return VT.apply(void 0,K9(ye).concat([n(1)]))},f);s(Tu(Tu(Tu({},t),e),ge))}};return R=n.isStepper?H:G,function(){return requestAnimationFrame(R),function(){cancelAnimationFrame(x)}}};function c1(t){"@babel/helpers - typeof";return c1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c1(t)}var j1e=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function F1e(t,e){if(t==null)return{};var n=U1e(t,e),r,s;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(s=0;s<l.length;s++)r=l[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function U1e(t,e){if(t==null)return{};var n={},r=Object.keys(t),s,l;for(l=0;l<r.length;l++)s=r[l],!(e.indexOf(s)>=0)&&(n[s]=t[s]);return n}function nO(t){return H1e(t)||$1e(t)||V1e(t)||q1e()}function q1e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function V1e(t,e){if(t){if(typeof t=="string")return FR(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return FR(t,e)}}function $1e(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function H1e(t){if(Array.isArray(t))return FR(t)}function FR(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function X9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function yp(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?X9(Object(n),!0).forEach(function(r){Ex(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):X9(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Ex(t,e,n){return e=jX(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function G1e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function W1e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,jX(r.key),r)}}function K1e(t,e,n){return e&&W1e(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function jX(t){var e=Y1e(t,"string");return c1(e)==="symbol"?e:String(e)}function Y1e(t,e){if(c1(t)!=="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(c1(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function X1e(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&UR(t,e)}function UR(t,e){return UR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},UR(t,e)}function Z1e(t){var e=J1e();return function(){var r=$T(t),s;if(e){var l=$T(this).constructor;s=Reflect.construct(r,arguments,l)}else s=r.apply(this,arguments);return qR(this,s)}}function qR(t,e){if(e&&(c1(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return VR(t)}function VR(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function J1e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function $T(t){return $T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},$T(t)}var Op=function(t){X1e(n,t);var e=Z1e(n);function n(r,s){var l;G1e(this,n),l=e.call(this,r,s);var f=l.props,i=f.isActive,x=f.attributeName,S=f.from,I=f.to,R=f.steps,F=f.children,j=f.duration;if(l.handleStyleChange=l.handleStyleChange.bind(VR(l)),l.changeStyle=l.changeStyle.bind(VR(l)),!i||j<=0)return l.state={style:{}},typeof F=="function"&&(l.state={style:I}),qR(l);if(R&&R.length)l.state={style:R[0].style};else if(S){if(typeof F=="function")return l.state={style:S},qR(l);l.state={style:x?Ex({},x,S):S}}else l.state={style:{}};return l}return K1e(n,[{key:"componentDidMount",value:function(){var s=this.props,l=s.isActive,f=s.canBegin;this.mounted=!0,!(!l||!f)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(s){var l=this.props,f=l.isActive,i=l.canBegin,x=l.attributeName,S=l.shouldReAnimate,I=l.to,R=l.from,F=this.state.style;if(i){if(!f){var j={style:x?Ex({},x,I):I};this.state&&F&&(x&&F[x]!==I||!x&&F!==I)&&this.setState(j);return}if(!(i1e(s.to,I)&&s.canBegin&&s.isActive)){var H=!s.canBegin||!s.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var G=H||S?R:s.to;if(this.state&&F){var W={style:x?Ex({},x,G):G};(x&&F[x]!==G||!x&&F!==G)&&this.setState(W)}this.runAnimation(yp(yp({},this.props),{},{from:G,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var s=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),s&&s()}},{key:"handleStyleChange",value:function(s){this.changeStyle(s)}},{key:"changeStyle",value:function(s){this.mounted&&this.setState({style:s})}},{key:"runJSAnimation",value:function(s){var l=this,f=s.from,i=s.to,x=s.duration,S=s.easing,I=s.begin,R=s.onAnimationEnd,F=s.onAnimationStart,j=B1e(f,i,M1e(S),x,this.changeStyle),H=function(){l.stopJSAnimation=j()};this.manager.start([F,I,H,x,R])}},{key:"runStepAnimation",value:function(s){var l=this,f=s.steps,i=s.begin,x=s.onAnimationStart,S=f[0],I=S.style,R=S.duration,F=R===void 0?0:R,j=function(G,W,J){if(J===0)return G;var ie=W.duration,he=W.easing,ge=he===void 0?"ease":he,fe=W.style,ye=W.properties,pe=W.onAnimationEnd,be=J>0?f[J-1]:W,Ae=ye||Object.keys(fe);if(typeof ge=="function"||ge==="spring")return[].concat(nO(G),[l.runJSAnimation.bind(l,{from:be.style,to:fe,duration:ie,easing:ge}),ie]);var Oe=H9(Ae,ie,ge),ue=yp(yp(yp({},be.style),fe),{},{transition:Oe});return[].concat(nO(G),[ue,ie,pe]).filter(m1e)};return this.manager.start([x].concat(nO(f.reduce(j,[I,Math.max(F,i)])),[s.onAnimationEnd]))}},{key:"runAnimation",value:function(s){this.manager||(this.manager=h1e());var l=s.begin,f=s.duration,i=s.attributeName,x=s.to,S=s.easing,I=s.onAnimationStart,R=s.onAnimationEnd,F=s.steps,j=s.children,H=this.manager;if(this.unSubscribe=H.subscribe(this.handleStyleChange),typeof S=="function"||typeof j=="function"||S==="spring"){this.runJSAnimation(s);return}if(F.length>1){this.runStepAnimation(s);return}var G=i?Ex({},i,x):x,W=H9(Object.keys(G),f,S);H.start([I,l,yp(yp({},G),{},{transition:W}),f,R])}},{key:"render",value:function(){var s=this.props,l=s.children;s.begin;var f=s.duration;s.attributeName,s.easing;var i=s.isActive;s.steps,s.from,s.to,s.canBegin,s.onAnimationEnd,s.shouldReAnimate,s.onAnimationReStart;var x=F1e(s,j1e),S=st.Children.count(l),I=this.state.style;if(typeof l=="function")return l(I);if(!i||S===0||f<=0)return l;var R=function(j){var H=j.props,G=H.style,W=G===void 0?{}:G,J=H.className,ie=st.cloneElement(j,yp(yp({},x),{},{style:yp(yp({},W),I),className:J}));return ie};return S===1?R(st.Children.only(l)):kt.createElement("div",null,st.Children.map(l,function(F){return R(F)}))}}]),n}(st.PureComponent);Op.displayName="Animate";Op.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};Op.propTypes={from:Os.oneOfType([Os.object,Os.string]),to:Os.oneOfType([Os.object,Os.string]),attributeName:Os.string,duration:Os.number,begin:Os.number,easing:Os.oneOfType([Os.string,Os.func]),steps:Os.arrayOf(Os.shape({duration:Os.number.isRequired,style:Os.object.isRequired,easing:Os.oneOfType([Os.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),Os.func]),properties:Os.arrayOf("string"),onAnimationEnd:Os.func})),children:Os.oneOfType([Os.node,Os.func]),isActive:Os.bool,canBegin:Os.bool,onAnimationEnd:Os.func,shouldReAnimate:Os.bool,onAnimationStart:Os.func,onAnimationReStart:Os.func};function Pw(t){"@babel/helpers - typeof";return Pw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pw(t)}function HT(){return HT=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},HT.apply(this,arguments)}function Q1e(t,e){return rbe(t)||nbe(t,e)||tbe(t,e)||ebe()}function ebe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tbe(t,e){if(t){if(typeof t=="string")return Z9(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Z9(t,e)}}function Z9(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function nbe(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r,s,l,f,i=[],x=!0,S=!1;try{if(l=(n=n.call(t)).next,e!==0)for(;!(x=(r=l.call(n)).done)&&(i.push(r.value),i.length!==e);x=!0);}catch(I){S=!0,s=I}finally{try{if(!x&&n.return!=null&&(f=n.return(),Object(f)!==f))return}finally{if(S)throw s}}return i}}function rbe(t){if(Array.isArray(t))return t}function J9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function Q9(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?J9(Object(n),!0).forEach(function(r){ibe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):J9(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function ibe(t,e,n){return e=abe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function abe(t){var e=sbe(t,"string");return Pw(e)=="symbol"?e:e+""}function sbe(t,e){if(Pw(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(Pw(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var eq=function(e,n,r,s,l){var f=Math.min(Math.abs(r)/2,Math.abs(s)/2),i=s>=0?1:-1,x=r>=0?1:-1,S=s>=0&&r>=0||s<0&&r<0?1:0,I;if(f>0&&l instanceof Array){for(var R=[0,0,0,0],F=0,j=4;F<j;F++)R[F]=l[F]>f?f:l[F];I="M".concat(e,",").concat(n+i*R[0]),R[0]>0&&(I+="A ".concat(R[0],",").concat(R[0],",0,0,").concat(S,",").concat(e+x*R[0],",").concat(n)),I+="L ".concat(e+r-x*R[1],",").concat(n),R[1]>0&&(I+="A ".concat(R[1],",").concat(R[1],",0,0,").concat(S,`,
        `).concat(e+r,",").concat(n+i*R[1])),I+="L ".concat(e+r,",").concat(n+s-i*R[2]),R[2]>0&&(I+="A ".concat(R[2],",").concat(R[2],",0,0,").concat(S,`,
        `).concat(e+r-x*R[2],",").concat(n+s)),I+="L ".concat(e+x*R[3],",").concat(n+s),R[3]>0&&(I+="A ".concat(R[3],",").concat(R[3],",0,0,").concat(S,`,
        `).concat(e,",").concat(n+s-i*R[3])),I+="Z"}else if(f>0&&l===+l&&l>0){var H=Math.min(f,l);I="M ".concat(e,",").concat(n+i*H,`
            A `).concat(H,",").concat(H,",0,0,").concat(S,",").concat(e+x*H,",").concat(n,`
            L `).concat(e+r-x*H,",").concat(n,`
            A `).concat(H,",").concat(H,",0,0,").concat(S,",").concat(e+r,",").concat(n+i*H,`
            L `).concat(e+r,",").concat(n+s-i*H,`
            A `).concat(H,",").concat(H,",0,0,").concat(S,",").concat(e+r-x*H,",").concat(n+s,`
            L `).concat(e+x*H,",").concat(n+s,`
            A `).concat(H,",").concat(H,",0,0,").concat(S,",").concat(e,",").concat(n+s-i*H," Z")}else I="M ".concat(e,",").concat(n," h ").concat(r," v ").concat(s," h ").concat(-r," Z");return I},obe=function(e,n){if(!e||!n)return!1;var r=e.x,s=e.y,l=n.x,f=n.y,i=n.width,x=n.height;if(Math.abs(i)>0&&Math.abs(x)>0){var S=Math.min(l,l+i),I=Math.max(l,l+i),R=Math.min(f,f+x),F=Math.max(f,f+x);return r>=S&&r<=I&&s>=R&&s<=F}return!1},lbe={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},eN=function(e){var n=Q9(Q9({},lbe),e),r=st.useRef(),s=st.useState(-1),l=Q1e(s,2),f=l[0],i=l[1];st.useEffect(function(){if(r.current&&r.current.getTotalLength)try{var ge=r.current.getTotalLength();ge&&i(ge)}catch{}},[]);var x=n.x,S=n.y,I=n.width,R=n.height,F=n.radius,j=n.className,H=n.animationEasing,G=n.animationDuration,W=n.animationBegin,J=n.isAnimationActive,ie=n.isUpdateAnimationActive;if(x!==+x||S!==+S||I!==+I||R!==+R||I===0||R===0)return null;var he=fa("recharts-rectangle",j);return ie?kt.createElement(Op,{canBegin:f>0,from:{width:I,height:R,x,y:S},to:{width:I,height:R,x,y:S},duration:G,animationEasing:H,isActive:ie},function(ge){var fe=ge.width,ye=ge.height,pe=ge.x,be=ge.y;return kt.createElement(Op,{canBegin:f>0,from:"0px ".concat(f===-1?1:f,"px"),to:"".concat(f,"px 0px"),attributeName:"strokeDasharray",begin:W,duration:G,isActive:J,easing:H},kt.createElement("path",HT({},di(n,!0),{className:he,d:eq(pe,be,fe,ye,F),ref:r})))}):kt.createElement("path",HT({},di(n,!0),{className:he,d:eq(x,S,I,R,F)}))},cbe=["points","className","baseLinePoints","connectNulls"];function A0(){return A0=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},A0.apply(this,arguments)}function ube(t,e){if(t==null)return{};var n=hbe(t,e),r,s;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(s=0;s<l.length;s++)r=l[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function hbe(t,e){if(t==null)return{};var n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;n[r]=t[r]}return n}function tq(t){return mbe(t)||pbe(t)||dbe(t)||fbe()}function fbe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dbe(t,e){if(t){if(typeof t=="string")return $R(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $R(t,e)}}function pbe(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function mbe(t){if(Array.isArray(t))return $R(t)}function $R(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var nq=function(e){return e&&e.x===+e.x&&e.y===+e.y},gbe=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],n=[[]];return e.forEach(function(r){nq(r)?n[n.length-1].push(r):n[n.length-1].length>0&&n.push([])}),nq(e[0])&&n[n.length-1].push(e[0]),n[n.length-1].length<=0&&(n=n.slice(0,-1)),n},Nx=function(e,n){var r=gbe(e);n&&(r=[r.reduce(function(l,f){return[].concat(tq(l),tq(f))},[])]);var s=r.map(function(l){return l.reduce(function(f,i,x){return"".concat(f).concat(x===0?"M":"L").concat(i.x,",").concat(i.y)},"")}).join("");return r.length===1?"".concat(s,"Z"):s},ybe=function(e,n,r){var s=Nx(e,r);return"".concat(s.slice(-1)==="Z"?s.slice(0,-1):s,"L").concat(Nx(n.reverse(),r).slice(1))},_be=function(e){var n=e.points,r=e.className,s=e.baseLinePoints,l=e.connectNulls,f=ube(e,cbe);if(!n||!n.length)return null;var i=fa("recharts-polygon",r);if(s&&s.length){var x=f.stroke&&f.stroke!=="none",S=ybe(n,s,l);return kt.createElement("g",{className:i},kt.createElement("path",A0({},di(f,!0),{fill:S.slice(-1)==="Z"?f.fill:"none",stroke:"none",d:S})),x?kt.createElement("path",A0({},di(f,!0),{fill:"none",d:Nx(n,l)})):null,x?kt.createElement("path",A0({},di(f,!0),{fill:"none",d:Nx(s,l)})):null)}var I=Nx(n,l);return kt.createElement("path",A0({},di(f,!0),{fill:I.slice(-1)==="Z"?f.fill:"none",className:i,d:I}))};function HR(){return HR=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},HR.apply(this,arguments)}var T2=function(e){var n=e.cx,r=e.cy,s=e.r,l=e.className,f=fa("recharts-dot",l);return n===+n&&r===+r&&s===+s?kt.createElement("circle",HR({},di(e,!1),pT(e),{className:f,cx:n,cy:r,r:s})):null};function Ow(t){"@babel/helpers - typeof";return Ow=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ow(t)}var vbe=["x","y","top","left","width","height","className"];function GR(){return GR=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},GR.apply(this,arguments)}function rq(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function bbe(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?rq(Object(n),!0).forEach(function(r){xbe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):rq(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function xbe(t,e,n){return e=wbe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function wbe(t){var e=Sbe(t,"string");return Ow(e)=="symbol"?e:e+""}function Sbe(t,e){if(Ow(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(Ow(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Abe(t,e){if(t==null)return{};var n=Tbe(t,e),r,s;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(s=0;s<l.length;s++)r=l[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function Tbe(t,e){if(t==null)return{};var n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;n[r]=t[r]}return n}var Ebe=function(e,n,r,s,l,f){return"M".concat(e,",").concat(l,"v").concat(s,"M").concat(f,",").concat(n,"h").concat(r)},Mbe=function(e){var n=e.x,r=n===void 0?0:n,s=e.y,l=s===void 0?0:s,f=e.top,i=f===void 0?0:f,x=e.left,S=x===void 0?0:x,I=e.width,R=I===void 0?0:I,F=e.height,j=F===void 0?0:F,H=e.className,G=Abe(e,vbe),W=bbe({x:r,y:l,top:i,left:S,width:R,height:j},G);return!gr(r)||!gr(l)||!gr(R)||!gr(j)||!gr(i)||!gr(S)?null:kt.createElement("path",GR({},di(W,!0),{className:fa("recharts-cross",H),d:Ebe(r,l,R,j,i,S)}))},rO,iq;function Cbe(){if(iq)return rO;iq=1;var t=wE(),e=eX(),n=Om();function r(s,l){return s&&s.length?t(s,n(l,2),e):void 0}return rO=r,rO}var Ibe=Cbe();const Pbe=Xa(Ibe);var iO,aq;function Obe(){if(aq)return iO;aq=1;var t=wE(),e=Om(),n=tX();function r(s,l){return s&&s.length?t(s,e(l,2),n):void 0}return iO=r,iO}var Rbe=Obe();const Dbe=Xa(Rbe);var Lbe=["cx","cy","angle","ticks","axisLine"],kbe=["ticks","tick","angle","tickFormatter","stroke"];function u1(t){"@babel/helpers - typeof";return u1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u1(t)}function zx(){return zx=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},zx.apply(this,arguments)}function sq(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function E_(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?sq(Object(n),!0).forEach(function(r){EE(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):sq(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function oq(t,e){if(t==null)return{};var n=Nbe(t,e),r,s;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(s=0;s<l.length;s++)r=l[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function Nbe(t,e){if(t==null)return{};var n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;n[r]=t[r]}return n}function zbe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function lq(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,UX(r.key),r)}}function Bbe(t,e,n){return e&&lq(t.prototype,e),n&&lq(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function jbe(t,e,n){return e=GT(e),Fbe(t,FX()?Reflect.construct(e,n||[],GT(t).constructor):e.apply(t,n))}function Fbe(t,e){if(e&&(u1(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ube(t)}function Ube(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function FX(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(FX=function(){return!!t})()}function GT(t){return GT=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},GT(t)}function qbe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&WR(t,e)}function WR(t,e){return WR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},WR(t,e)}function EE(t,e,n){return e=UX(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function UX(t){var e=Vbe(t,"string");return u1(e)=="symbol"?e:e+""}function Vbe(t,e){if(u1(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(u1(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var ME=function(t){function e(){return zbe(this,e),jbe(this,e,arguments)}return qbe(e,t),Bbe(e,[{key:"getTickValueCoord",value:function(r){var s=r.coordinate,l=this.props,f=l.angle,i=l.cx,x=l.cy;return bo(i,x,s,f)}},{key:"getTickTextAnchor",value:function(){var r=this.props.orientation,s;switch(r){case"left":s="end";break;case"right":s="start";break;default:s="middle";break}return s}},{key:"getViewBox",value:function(){var r=this.props,s=r.cx,l=r.cy,f=r.angle,i=r.ticks,x=Pbe(i,function(I){return I.coordinate||0}),S=Dbe(i,function(I){return I.coordinate||0});return{cx:s,cy:l,startAngle:f,endAngle:f,innerRadius:S.coordinate||0,outerRadius:x.coordinate||0}}},{key:"renderAxisLine",value:function(){var r=this.props,s=r.cx,l=r.cy,f=r.angle,i=r.ticks,x=r.axisLine,S=oq(r,Lbe),I=i.reduce(function(H,G){return[Math.min(H[0],G.coordinate),Math.max(H[1],G.coordinate)]},[1/0,-1/0]),R=bo(s,l,I[0],f),F=bo(s,l,I[1],f),j=E_(E_(E_({},di(S,!1)),{},{fill:"none"},di(x,!1)),{},{x1:R.x,y1:R.y,x2:F.x,y2:F.y});return kt.createElement("line",zx({className:"recharts-polar-radius-axis-line"},j))}},{key:"renderTicks",value:function(){var r=this,s=this.props,l=s.ticks,f=s.tick,i=s.angle,x=s.tickFormatter,S=s.stroke,I=oq(s,kbe),R=this.getTickTextAnchor(),F=di(I,!1),j=di(f,!1),H=l.map(function(G,W){var J=r.getTickValueCoord(G),ie=E_(E_(E_(E_({textAnchor:R,transform:"rotate(".concat(90-i,", ").concat(J.x,", ").concat(J.y,")")},F),{},{stroke:"none",fill:S},j),{},{index:W},J),{},{payload:G});return kt.createElement(Na,zx({className:fa("recharts-polar-radius-axis-tick",IX(f)),key:"tick-".concat(G.coordinate)},rv(r.props,G,W)),e.renderTickItem(f,ie,x?x(G.value,W):G.value))});return kt.createElement(Na,{className:"recharts-polar-radius-axis-ticks"},H)}},{key:"render",value:function(){var r=this.props,s=r.ticks,l=r.axisLine,f=r.tick;return!s||!s.length?null:kt.createElement(Na,{className:fa("recharts-polar-radius-axis",this.props.className)},l&&this.renderAxisLine(),f&&this.renderTicks(),eu.renderCallByParent(this.props,this.getViewBox()))}}],[{key:"renderTickItem",value:function(r,s,l){var f;return kt.isValidElement(r)?f=kt.cloneElement(r,s):qi(r)?f=r(s):f=kt.createElement(iv,zx({},s,{className:"recharts-polar-radius-axis-tick-value"}),l),f}}])}(st.PureComponent);EE(ME,"displayName","PolarRadiusAxis");EE(ME,"axisType","radiusAxis");EE(ME,"defaultProps",{type:"number",radiusAxisId:0,cx:0,cy:0,angle:0,orientation:"right",stroke:"#ccc",axisLine:!0,tick:!0,tickCount:5,allowDataOverflow:!1,scale:"auto",allowDuplicatedCategory:!0});function h1(t){"@babel/helpers - typeof";return h1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h1(t)}function D_(){return D_=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},D_.apply(this,arguments)}function cq(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function M_(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?cq(Object(n),!0).forEach(function(r){CE(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):cq(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function $be(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function uq(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,VX(r.key),r)}}function Hbe(t,e,n){return e&&uq(t.prototype,e),n&&uq(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Gbe(t,e,n){return e=WT(e),Wbe(t,qX()?Reflect.construct(e,n||[],WT(t).constructor):e.apply(t,n))}function Wbe(t,e){if(e&&(h1(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Kbe(t)}function Kbe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function qX(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(qX=function(){return!!t})()}function WT(t){return WT=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},WT(t)}function Ybe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&KR(t,e)}function KR(t,e){return KR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},KR(t,e)}function CE(t,e,n){return e=VX(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function VX(t){var e=Xbe(t,"string");return h1(e)=="symbol"?e:e+""}function Xbe(t,e){if(h1(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(h1(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var Zbe=Math.PI/180,Jbe=1e-5,IE=function(t){function e(){return $be(this,e),Gbe(this,e,arguments)}return Ybe(e,t),Hbe(e,[{key:"getTickLineCoord",value:function(r){var s=this.props,l=s.cx,f=s.cy,i=s.radius,x=s.orientation,S=s.tickSize,I=S||8,R=bo(l,f,i,r.coordinate),F=bo(l,f,i+(x==="inner"?-1:1)*I,r.coordinate);return{x1:R.x,y1:R.y,x2:F.x,y2:F.y}}},{key:"getTickTextAnchor",value:function(r){var s=this.props.orientation,l=Math.cos(-r.coordinate*Zbe),f;return l>Jbe?f=s==="outer"?"start":"end":l<-1e-5?f=s==="outer"?"end":"start":f="middle",f}},{key:"renderAxisLine",value:function(){var r=this.props,s=r.cx,l=r.cy,f=r.radius,i=r.axisLine,x=r.axisLineType,S=M_(M_({},di(this.props,!1)),{},{fill:"none"},di(i,!1));if(x==="circle")return kt.createElement(T2,D_({className:"recharts-polar-angle-axis-line"},S,{cx:s,cy:l,r:f}));var I=this.props.ticks,R=I.map(function(F){return bo(s,l,f,F.coordinate)});return kt.createElement(_be,D_({className:"recharts-polar-angle-axis-line"},S,{points:R}))}},{key:"renderTicks",value:function(){var r=this,s=this.props,l=s.ticks,f=s.tick,i=s.tickLine,x=s.tickFormatter,S=s.stroke,I=di(this.props,!1),R=di(f,!1),F=M_(M_({},I),{},{fill:"none"},di(i,!1)),j=l.map(function(H,G){var W=r.getTickLineCoord(H),J=r.getTickTextAnchor(H),ie=M_(M_(M_({textAnchor:J},I),{},{stroke:"none",fill:S},R),{},{index:G,payload:H,x:W.x2,y:W.y2});return kt.createElement(Na,D_({className:fa("recharts-polar-angle-axis-tick",IX(f)),key:"tick-".concat(H.coordinate)},rv(r.props,H,G)),i&&kt.createElement("line",D_({className:"recharts-polar-angle-axis-tick-line"},F,W)),f&&e.renderTickItem(f,ie,x?x(H.value,G):H.value))});return kt.createElement(Na,{className:"recharts-polar-angle-axis-ticks"},j)}},{key:"render",value:function(){var r=this.props,s=r.ticks,l=r.radius,f=r.axisLine;return l<=0||!s||!s.length?null:kt.createElement(Na,{className:fa("recharts-polar-angle-axis",this.props.className)},f&&this.renderAxisLine(),this.renderTicks())}}],[{key:"renderTickItem",value:function(r,s,l){var f;return kt.isValidElement(r)?f=kt.cloneElement(r,s):qi(r)?f=r(s):f=kt.createElement(iv,D_({},s,{className:"recharts-polar-angle-axis-tick-value"}),l),f}}])}(st.PureComponent);CE(IE,"displayName","PolarAngleAxis");CE(IE,"axisType","angleAxis");CE(IE,"defaultProps",{type:"category",angleAxisId:0,scale:"auto",cx:0,cy:0,orientation:"outer",axisLine:!0,tickLine:!0,tickSize:8,tick:!0,hide:!1,allowDuplicatedCategory:!0});var aO,hq;function Qbe(){if(hq)return aO;hq=1;var t=QK(),e=t(Object.getPrototypeOf,Object);return aO=e,aO}var sO,fq;function exe(){if(fq)return sO;fq=1;var t=Ag(),e=Qbe(),n=Tg(),r="[object Object]",s=Function.prototype,l=Object.prototype,f=s.toString,i=l.hasOwnProperty,x=f.call(Object);function S(I){if(!n(I)||t(I)!=r)return!1;var R=e(I);if(R===null)return!0;var F=i.call(R,"constructor")&&R.constructor;return typeof F=="function"&&F instanceof F&&f.call(F)==x}return sO=S,sO}var txe=exe();const nxe=Xa(txe);var oO,dq;function rxe(){if(dq)return oO;dq=1;var t=Ag(),e=Tg(),n="[object Boolean]";function r(s){return s===!0||s===!1||e(s)&&t(s)==n}return oO=r,oO}var ixe=rxe();const axe=Xa(ixe);function Rw(t){"@babel/helpers - typeof";return Rw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Rw(t)}function KT(){return KT=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},KT.apply(this,arguments)}function sxe(t,e){return uxe(t)||cxe(t,e)||lxe(t,e)||oxe()}function oxe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function lxe(t,e){if(t){if(typeof t=="string")return pq(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pq(t,e)}}function pq(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function cxe(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r,s,l,f,i=[],x=!0,S=!1;try{if(l=(n=n.call(t)).next,e!==0)for(;!(x=(r=l.call(n)).done)&&(i.push(r.value),i.length!==e);x=!0);}catch(I){S=!0,s=I}finally{try{if(!x&&n.return!=null&&(f=n.return(),Object(f)!==f))return}finally{if(S)throw s}}return i}}function uxe(t){if(Array.isArray(t))return t}function mq(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function gq(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?mq(Object(n),!0).forEach(function(r){hxe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):mq(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function hxe(t,e,n){return e=fxe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function fxe(t){var e=dxe(t,"string");return Rw(e)=="symbol"?e:e+""}function dxe(t,e){if(Rw(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(Rw(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var yq=function(e,n,r,s,l){var f=r-s,i;return i="M ".concat(e,",").concat(n),i+="L ".concat(e+r,",").concat(n),i+="L ".concat(e+r-f/2,",").concat(n+l),i+="L ".concat(e+r-f/2-s,",").concat(n+l),i+="L ".concat(e,",").concat(n," Z"),i},pxe={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},mxe=function(e){var n=gq(gq({},pxe),e),r=st.useRef(),s=st.useState(-1),l=sxe(s,2),f=l[0],i=l[1];st.useEffect(function(){if(r.current&&r.current.getTotalLength)try{var he=r.current.getTotalLength();he&&i(he)}catch{}},[]);var x=n.x,S=n.y,I=n.upperWidth,R=n.lowerWidth,F=n.height,j=n.className,H=n.animationEasing,G=n.animationDuration,W=n.animationBegin,J=n.isUpdateAnimationActive;if(x!==+x||S!==+S||I!==+I||R!==+R||F!==+F||I===0&&R===0||F===0)return null;var ie=fa("recharts-trapezoid",j);return J?kt.createElement(Op,{canBegin:f>0,from:{upperWidth:0,lowerWidth:0,height:F,x,y:S},to:{upperWidth:I,lowerWidth:R,height:F,x,y:S},duration:G,animationEasing:H,isActive:J},function(he){var ge=he.upperWidth,fe=he.lowerWidth,ye=he.height,pe=he.x,be=he.y;return kt.createElement(Op,{canBegin:f>0,from:"0px ".concat(f===-1?1:f,"px"),to:"".concat(f,"px 0px"),attributeName:"strokeDasharray",begin:W,duration:G,easing:H},kt.createElement("path",KT({},di(n,!0),{className:ie,d:yq(pe,be,ge,fe,ye),ref:r})))}):kt.createElement("g",null,kt.createElement("path",KT({},di(n,!0),{className:ie,d:yq(x,S,I,R,F)})))},gxe=["option","shapeType","propTransformer","activeClassName","isActive"];function Dw(t){"@babel/helpers - typeof";return Dw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dw(t)}function yxe(t,e){if(t==null)return{};var n=_xe(t,e),r,s;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(s=0;s<l.length;s++)r=l[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function _xe(t,e){if(t==null)return{};var n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;n[r]=t[r]}return n}function _q(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function YT(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?_q(Object(n),!0).forEach(function(r){vxe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_q(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function vxe(t,e,n){return e=bxe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function bxe(t){var e=xxe(t,"string");return Dw(e)=="symbol"?e:e+""}function xxe(t,e){if(Dw(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(Dw(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function wxe(t,e){return YT(YT({},e),t)}function Sxe(t,e){return t==="symbols"}function vq(t){var e=t.shapeType,n=t.elementProps;switch(e){case"rectangle":return kt.createElement(eN,n);case"trapezoid":return kt.createElement(mxe,n);case"sector":return kt.createElement(RX,n);case"symbols":if(Sxe(e))return kt.createElement(vk,n);break;default:return null}}function Axe(t){return st.isValidElement(t)?t.props:t}function $X(t){var e=t.option,n=t.shapeType,r=t.propTransformer,s=r===void 0?wxe:r,l=t.activeClassName,f=l===void 0?"recharts-active-shape":l,i=t.isActive,x=yxe(t,gxe),S;if(st.isValidElement(e))S=st.cloneElement(e,YT(YT({},x),Axe(e)));else if(qi(e))S=e(x);else if(nxe(e)&&!axe(e)){var I=s(e,x);S=kt.createElement(vq,{shapeType:n,elementProps:I})}else{var R=x;S=kt.createElement(vq,{shapeType:n,elementProps:R})}return i?kt.createElement(Na,{className:f},S):S}function PE(t,e){return e!=null&&"trapezoids"in t.props}function OE(t,e){return e!=null&&"sectors"in t.props}function Lw(t,e){return e!=null&&"points"in t.props}function Txe(t,e){var n,r,s=t.x===(e==null||(n=e.labelViewBox)===null||n===void 0?void 0:n.x)||t.x===e.x,l=t.y===(e==null||(r=e.labelViewBox)===null||r===void 0?void 0:r.y)||t.y===e.y;return s&&l}function Exe(t,e){var n=t.endAngle===e.endAngle,r=t.startAngle===e.startAngle;return n&&r}function Mxe(t,e){var n=t.x===e.x,r=t.y===e.y,s=t.z===e.z;return n&&r&&s}function Cxe(t,e){var n;return PE(t,e)?n=Txe:OE(t,e)?n=Exe:Lw(t,e)&&(n=Mxe),n}function Ixe(t,e){var n;return PE(t,e)?n="trapezoids":OE(t,e)?n="sectors":Lw(t,e)&&(n="points"),n}function Pxe(t,e){if(PE(t,e)){var n;return(n=e.tooltipPayload)===null||n===void 0||(n=n[0])===null||n===void 0||(n=n.payload)===null||n===void 0?void 0:n.payload}if(OE(t,e)){var r;return(r=e.tooltipPayload)===null||r===void 0||(r=r[0])===null||r===void 0||(r=r.payload)===null||r===void 0?void 0:r.payload}return Lw(t,e)?e.payload:{}}function Oxe(t){var e=t.activeTooltipItem,n=t.graphicalItem,r=t.itemData,s=Ixe(n,e),l=Pxe(n,e),f=r.filter(function(x,S){var I=av(l,x),R=n.props[s].filter(function(H){var G=Cxe(n,e);return G(H,e)}),F=n.props[s].indexOf(R[R.length-1]),j=S===F;return I&&j}),i=r.indexOf(f[f.length-1]);return i}var IA;function f1(t){"@babel/helpers - typeof";return f1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f1(t)}function T0(){return T0=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},T0.apply(this,arguments)}function bq(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function _o(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?bq(Object(n),!0).forEach(function(r){Bd(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):bq(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Rxe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function xq(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,GX(r.key),r)}}function Dxe(t,e,n){return e&&xq(t.prototype,e),n&&xq(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Lxe(t,e,n){return e=XT(e),kxe(t,HX()?Reflect.construct(e,n||[],XT(t).constructor):e.apply(t,n))}function kxe(t,e){if(e&&(f1(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Nxe(t)}function Nxe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function HX(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(HX=function(){return!!t})()}function XT(t){return XT=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},XT(t)}function zxe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&YR(t,e)}function YR(t,e){return YR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},YR(t,e)}function Bd(t,e,n){return e=GX(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function GX(t){var e=Bxe(t,"string");return f1(e)=="symbol"?e:e+""}function Bxe(t,e){if(f1(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(f1(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var Mg=function(t){function e(n){var r;return Rxe(this,e),r=Lxe(this,e,[n]),Bd(r,"pieRef",null),Bd(r,"sectorRefs",[]),Bd(r,"id",mv("recharts-pie-")),Bd(r,"handleAnimationEnd",function(){var s=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),qi(s)&&s()}),Bd(r,"handleAnimationStart",function(){var s=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),qi(s)&&s()}),r.state={isAnimationFinished:!n.isAnimationActive,prevIsAnimationActive:n.isAnimationActive,prevAnimationId:n.animationId,sectorToFocus:0},r}return zxe(e,t),Dxe(e,[{key:"isActiveIndex",value:function(r){var s=this.props.activeIndex;return Array.isArray(s)?s.indexOf(r)!==-1:r===s}},{key:"hasActiveIndex",value:function(){var r=this.props.activeIndex;return Array.isArray(r)?r.length!==0:r||r===0}},{key:"renderLabels",value:function(r){var s=this.props.isAnimationActive;if(s&&!this.state.isAnimationFinished)return null;var l=this.props,f=l.label,i=l.labelLine,x=l.dataKey,S=l.valueKey,I=di(this.props,!1),R=di(f,!1),F=di(i,!1),j=f&&f.offsetRadius||20,H=r.map(function(G,W){var J=(G.startAngle+G.endAngle)/2,ie=bo(G.cx,G.cy,G.outerRadius+j,J),he=_o(_o(_o(_o({},I),G),{},{stroke:"none"},R),{},{index:W,textAnchor:e.getTextAnchor(ie.x,G.cx)},ie),ge=_o(_o(_o(_o({},I),G),{},{fill:"none",stroke:G.fill},F),{},{index:W,points:[bo(G.cx,G.cy,G.outerRadius,J),ie]}),fe=x;return aa(x)&&aa(S)?fe="value":aa(x)&&(fe=S),kt.createElement(Na,{key:"label-".concat(G.startAngle,"-").concat(G.endAngle,"-").concat(G.midAngle,"-").concat(W)},i&&e.renderLabelLineItem(i,ge,"line"),e.renderLabelItem(f,he,jl(G,fe)))});return kt.createElement(Na,{className:"recharts-pie-labels"},H)}},{key:"renderSectorsStatically",value:function(r){var s=this,l=this.props,f=l.activeShape,i=l.blendStroke,x=l.inactiveShape;return r.map(function(S,I){if((S==null?void 0:S.startAngle)===0&&(S==null?void 0:S.endAngle)===0&&r.length!==1)return null;var R=s.isActiveIndex(I),F=x&&s.hasActiveIndex()?x:null,j=R?f:F,H=_o(_o({},S),{},{stroke:i?S.fill:S.stroke,tabIndex:-1});return kt.createElement(Na,T0({ref:function(W){W&&!s.sectorRefs.includes(W)&&s.sectorRefs.push(W)},tabIndex:-1,className:"recharts-pie-sector"},rv(s.props,S,I),{key:"sector-".concat(S==null?void 0:S.startAngle,"-").concat(S==null?void 0:S.endAngle,"-").concat(S.midAngle,"-").concat(I)}),kt.createElement($X,T0({option:j,isActive:R,shapeType:"sector"},H)))})}},{key:"renderSectorsWithAnimation",value:function(){var r=this,s=this.props,l=s.sectors,f=s.isAnimationActive,i=s.animationBegin,x=s.animationDuration,S=s.animationEasing,I=s.animationId,R=this.state,F=R.prevSectors,j=R.prevIsAnimationActive;return kt.createElement(Op,{begin:i,duration:x,isActive:f,easing:S,from:{t:0},to:{t:1},key:"pie-".concat(I,"-").concat(j),onAnimationStart:this.handleAnimationStart,onAnimationEnd:this.handleAnimationEnd},function(H){var G=H.t,W=[],J=l&&l[0],ie=J.startAngle;return l.forEach(function(he,ge){var fe=F&&F[ge],ye=ge>0?sd(he,"paddingAngle",0):0;if(fe){var pe=Dc(fe.endAngle-fe.startAngle,he.endAngle-he.startAngle),be=_o(_o({},he),{},{startAngle:ie+ye,endAngle:ie+pe(G)+ye});W.push(be),ie=be.endAngle}else{var Ae=he.endAngle,Oe=he.startAngle,ue=Dc(0,Ae-Oe),we=ue(G),ke=_o(_o({},he),{},{startAngle:ie+ye,endAngle:ie+we+ye});W.push(ke),ie=ke.endAngle}}),kt.createElement(Na,null,r.renderSectorsStatically(W))})}},{key:"attachKeyboardHandlers",value:function(r){var s=this;r.onkeydown=function(l){if(!l.altKey)switch(l.key){case"ArrowLeft":{var f=++s.state.sectorToFocus%s.sectorRefs.length;s.sectorRefs[f].focus(),s.setState({sectorToFocus:f});break}case"ArrowRight":{var i=--s.state.sectorToFocus<0?s.sectorRefs.length-1:s.state.sectorToFocus%s.sectorRefs.length;s.sectorRefs[i].focus(),s.setState({sectorToFocus:i});break}case"Escape":{s.sectorRefs[s.state.sectorToFocus].blur(),s.setState({sectorToFocus:0});break}}}}},{key:"renderSectors",value:function(){var r=this.props,s=r.sectors,l=r.isAnimationActive,f=this.state.prevSectors;return l&&s&&s.length&&(!f||!av(f,s))?this.renderSectorsWithAnimation():this.renderSectorsStatically(s)}},{key:"componentDidMount",value:function(){this.pieRef&&this.attachKeyboardHandlers(this.pieRef)}},{key:"render",value:function(){var r=this,s=this.props,l=s.hide,f=s.sectors,i=s.className,x=s.label,S=s.cx,I=s.cy,R=s.innerRadius,F=s.outerRadius,j=s.isAnimationActive,H=this.state.isAnimationFinished;if(l||!f||!f.length||!gr(S)||!gr(I)||!gr(R)||!gr(F))return null;var G=fa("recharts-pie",i);return kt.createElement(Na,{tabIndex:this.props.rootTabIndex,className:G,ref:function(J){r.pieRef=J}},this.renderSectors(),x&&this.renderLabels(f),eu.renderCallByParent(this.props,null,!1),(!j||H)&&Ep.renderCallByParent(this.props,f,!1))}}],[{key:"getDerivedStateFromProps",value:function(r,s){return s.prevIsAnimationActive!==r.isAnimationActive?{prevIsAnimationActive:r.isAnimationActive,prevAnimationId:r.animationId,curSectors:r.sectors,prevSectors:[],isAnimationFinished:!0}:r.isAnimationActive&&r.animationId!==s.prevAnimationId?{prevAnimationId:r.animationId,curSectors:r.sectors,prevSectors:s.curSectors,isAnimationFinished:!0}:r.sectors!==s.curSectors?{curSectors:r.sectors,isAnimationFinished:!0}:null}},{key:"getTextAnchor",value:function(r,s){return r>s?"start":r<s?"end":"middle"}},{key:"renderLabelLineItem",value:function(r,s,l){if(kt.isValidElement(r))return kt.cloneElement(r,s);if(qi(r))return r(s);var f=fa("recharts-pie-label-line",typeof r!="boolean"?r.className:"");return kt.createElement(K_,T0({},s,{key:l,type:"linear",className:f}))}},{key:"renderLabelItem",value:function(r,s,l){if(kt.isValidElement(r))return kt.cloneElement(r,s);var f=l;if(qi(r)&&(f=r(s),kt.isValidElement(f)))return f;var i=fa("recharts-pie-label-text",typeof r!="boolean"&&!qi(r)?r.className:"");return kt.createElement(iv,T0({},s,{alignmentBaseline:"middle",className:i}),f)}}])}(st.PureComponent);IA=Mg;Bd(Mg,"displayName","Pie");Bd(Mg,"defaultProps",{stroke:"#fff",fill:"#808080",legendType:"rect",cx:"50%",cy:"50%",startAngle:0,endAngle:360,innerRadius:0,outerRadius:"80%",paddingAngle:0,labelLine:!0,hide:!1,minAngle:0,isAnimationActive:!Ny.isSsr,animationBegin:400,animationDuration:1500,animationEasing:"ease",nameKey:"name",blendStroke:!1,rootTabIndex:0});Bd(Mg,"parseDeltaAngle",function(t,e){var n=Wh(e-t),r=Math.min(Math.abs(e-t),360);return n*r});Bd(Mg,"getRealPieData",function(t){var e=t.data,n=t.children,r=di(t,!1),s=od(n,uw);return e&&e.length?e.map(function(l,f){return _o(_o(_o({payload:l},r),l),s&&s[f]&&s[f].props)}):s&&s.length?s.map(function(l){return _o(_o({},r),l.props)}):[]});Bd(Mg,"parseCoordinateOfPie",function(t,e){var n=e.top,r=e.left,s=e.width,l=e.height,f=CX(s,l),i=r+Kh(t.cx,s,s/2),x=n+Kh(t.cy,l,l/2),S=Kh(t.innerRadius,f,0),I=Kh(t.outerRadius,f,f*.8),R=t.maxRadius||Math.sqrt(s*s+l*l)/2;return{cx:i,cy:x,innerRadius:S,outerRadius:I,maxRadius:R}});Bd(Mg,"getComposedData",function(t){var e=t.item,n=t.offset,r=e.type.defaultProps!==void 0?_o(_o({},e.type.defaultProps),e.props):e.props,s=IA.getRealPieData(r);if(!s||!s.length)return null;var l=r.cornerRadius,f=r.startAngle,i=r.endAngle,x=r.paddingAngle,S=r.dataKey,I=r.nameKey,R=r.valueKey,F=r.tooltipType,j=Math.abs(r.minAngle),H=IA.parseCoordinateOfPie(r,n),G=IA.parseDeltaAngle(f,i),W=Math.abs(G),J=S;aa(S)&&aa(R)?(Tp(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),J="value"):aa(S)&&(Tp(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),J=R);var ie=s.filter(function(be){return jl(be,J,0)!==0}).length,he=(W>=360?ie:ie-1)*x,ge=W-ie*j-he,fe=s.reduce(function(be,Ae){var Oe=jl(Ae,J,0);return be+(gr(Oe)?Oe:0)},0),ye;if(fe>0){var pe;ye=s.map(function(be,Ae){var Oe=jl(be,J,0),ue=jl(be,I,Ae),we=(gr(Oe)?Oe:0)/fe,ke;Ae?ke=pe.endAngle+Wh(G)*x*(Oe!==0?1:0):ke=f;var De=ke+Wh(G)*((Oe!==0?j:0)+we*ge),je=(ke+De)/2,ze=(H.innerRadius+H.outerRadius)/2,Ue=[{name:ue,value:Oe,payload:be,dataKey:J,type:F}],Fe=bo(H.cx,H.cy,ze,je);return pe=_o(_o(_o({percent:we,cornerRadius:l,name:ue,tooltipPayload:Ue,midAngle:je,middleRadius:ze,tooltipPosition:Fe},be),H),{},{value:jl(be,J),startAngle:ke,endAngle:De,payload:be,paddingAngle:Wh(G)*x}),pe})}return _o(_o({},H),{},{sectors:ye,data:s})});var lO,wq;function jxe(){if(wq)return lO;wq=1;var t=Math.ceil,e=Math.max;function n(r,s,l,f){for(var i=-1,x=e(t((s-r)/(l||1)),0),S=Array(x);x--;)S[f?x:++i]=r,r+=l;return S}return lO=n,lO}var cO,Sq;function WX(){if(Sq)return cO;Sq=1;var t=mY(),e=1/0,n=17976931348623157e292;function r(s){if(!s)return s===0?s:0;if(s=t(s),s===e||s===-1/0){var l=s<0?-1:1;return l*n}return s===s?s:0}return cO=r,cO}var uO,Aq;function Fxe(){if(Aq)return uO;Aq=1;var t=jxe(),e=mE(),n=WX();function r(s){return function(l,f,i){return i&&typeof i!="number"&&e(l,f,i)&&(f=i=void 0),l=n(l),f===void 0?(f=l,l=0):f=n(f),i=i===void 0?l<f?1:-1:n(i),t(l,f,i,s)}}return uO=r,uO}var hO,Tq;function Uxe(){if(Tq)return hO;Tq=1;var t=Fxe(),e=t();return hO=e,hO}var qxe=Uxe();const ZT=Xa(qxe);function kw(t){"@babel/helpers - typeof";return kw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kw(t)}function Eq(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function Mq(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Eq(Object(n),!0).forEach(function(r){KX(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Eq(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function KX(t,e,n){return e=Vxe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Vxe(t){var e=$xe(t,"string");return kw(e)=="symbol"?e:e+""}function $xe(t,e){if(kw(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(kw(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Hxe=["Webkit","Moz","O","ms"],Gxe=function(e,n){var r=e.replace(/(\w)/,function(l){return l.toUpperCase()}),s=Hxe.reduce(function(l,f){return Mq(Mq({},l),{},KX({},f+r,n))},{});return s[e]=n,s};function d1(t){"@babel/helpers - typeof";return d1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d1(t)}function JT(){return JT=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},JT.apply(this,arguments)}function Cq(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function fO(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Cq(Object(n),!0).forEach(function(r){Jf(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Cq(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Wxe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Iq(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,XX(r.key),r)}}function Kxe(t,e,n){return e&&Iq(t.prototype,e),n&&Iq(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Yxe(t,e,n){return e=QT(e),Xxe(t,YX()?Reflect.construct(e,n||[],QT(t).constructor):e.apply(t,n))}function Xxe(t,e){if(e&&(d1(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Zxe(t)}function Zxe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function YX(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(YX=function(){return!!t})()}function QT(t){return QT=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},QT(t)}function Jxe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&XR(t,e)}function XR(t,e){return XR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},XR(t,e)}function Jf(t,e,n){return e=XX(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function XX(t){var e=Qxe(t,"string");return d1(e)=="symbol"?e:e+""}function Qxe(t,e){if(d1(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(d1(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var ewe=function(e){var n=e.data,r=e.startIndex,s=e.endIndex,l=e.x,f=e.width,i=e.travellerWidth;if(!n||!n.length)return{};var x=n.length,S=Dx().domain(ZT(0,x)).range([l,l+f-i]),I=S.domain().map(function(R){return S(R)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:S(r),endX:S(s),scale:S,scaleValues:I}},Pq=function(e){return e.changedTouches&&!!e.changedTouches.length},p1=function(t){function e(n){var r;return Wxe(this,e),r=Yxe(this,e,[n]),Jf(r,"handleDrag",function(s){r.leaveTimer&&(clearTimeout(r.leaveTimer),r.leaveTimer=null),r.state.isTravellerMoving?r.handleTravellerMove(s):r.state.isSlideMoving&&r.handleSlideDrag(s)}),Jf(r,"handleTouchMove",function(s){s.changedTouches!=null&&s.changedTouches.length>0&&r.handleDrag(s.changedTouches[0])}),Jf(r,"handleDragEnd",function(){r.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var s=r.props,l=s.endIndex,f=s.onDragEnd,i=s.startIndex;f==null||f({endIndex:l,startIndex:i})}),r.detachDragEndListener()}),Jf(r,"handleLeaveWrapper",function(){(r.state.isTravellerMoving||r.state.isSlideMoving)&&(r.leaveTimer=window.setTimeout(r.handleDragEnd,r.props.leaveTimeOut))}),Jf(r,"handleEnterSlideOrTraveller",function(){r.setState({isTextActive:!0})}),Jf(r,"handleLeaveSlideOrTraveller",function(){r.setState({isTextActive:!1})}),Jf(r,"handleSlideDragStart",function(s){var l=Pq(s)?s.changedTouches[0]:s;r.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:l.pageX}),r.attachDragEndListener()}),r.travellerDragStartHandlers={startX:r.handleTravellerDragStart.bind(r,"startX"),endX:r.handleTravellerDragStart.bind(r,"endX")},r.state={},r}return Jxe(e,t),Kxe(e,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(r){var s=r.startX,l=r.endX,f=this.state.scaleValues,i=this.props,x=i.gap,S=i.data,I=S.length-1,R=Math.min(s,l),F=Math.max(s,l),j=e.getIndexInRange(f,R),H=e.getIndexInRange(f,F);return{startIndex:j-j%x,endIndex:H===I?I:H-H%x}}},{key:"getTextOfTick",value:function(r){var s=this.props,l=s.data,f=s.tickFormatter,i=s.dataKey,x=jl(l[r],i,r);return qi(f)?f(x,r):x}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(r){var s=this.state,l=s.slideMoveStartX,f=s.startX,i=s.endX,x=this.props,S=x.x,I=x.width,R=x.travellerWidth,F=x.startIndex,j=x.endIndex,H=x.onChange,G=r.pageX-l;G>0?G=Math.min(G,S+I-R-i,S+I-R-f):G<0&&(G=Math.max(G,S-f,S-i));var W=this.getIndex({startX:f+G,endX:i+G});(W.startIndex!==F||W.endIndex!==j)&&H&&H(W),this.setState({startX:f+G,endX:i+G,slideMoveStartX:r.pageX})}},{key:"handleTravellerDragStart",value:function(r,s){var l=Pq(s)?s.changedTouches[0]:s;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:r,brushMoveStartX:l.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(r){var s=this.state,l=s.brushMoveStartX,f=s.movingTravellerId,i=s.endX,x=s.startX,S=this.state[f],I=this.props,R=I.x,F=I.width,j=I.travellerWidth,H=I.onChange,G=I.gap,W=I.data,J={startX:this.state.startX,endX:this.state.endX},ie=r.pageX-l;ie>0?ie=Math.min(ie,R+F-j-S):ie<0&&(ie=Math.max(ie,R-S)),J[f]=S+ie;var he=this.getIndex(J),ge=he.startIndex,fe=he.endIndex,ye=function(){var be=W.length-1;return f==="startX"&&(i>x?ge%G===0:fe%G===0)||i<x&&fe===be||f==="endX"&&(i>x?fe%G===0:ge%G===0)||i>x&&fe===be};this.setState(Jf(Jf({},f,S+ie),"brushMoveStartX",r.pageX),function(){H&&ye()&&H(he)})}},{key:"handleTravellerMoveKeyboard",value:function(r,s){var l=this,f=this.state,i=f.scaleValues,x=f.startX,S=f.endX,I=this.state[s],R=i.indexOf(I);if(R!==-1){var F=R+r;if(!(F===-1||F>=i.length)){var j=i[F];s==="startX"&&j>=S||s==="endX"&&j<=x||this.setState(Jf({},s,j),function(){l.props.onChange(l.getIndex({startX:l.state.startX,endX:l.state.endX}))})}}}},{key:"renderBackground",value:function(){var r=this.props,s=r.x,l=r.y,f=r.width,i=r.height,x=r.fill,S=r.stroke;return kt.createElement("rect",{stroke:S,fill:x,x:s,y:l,width:f,height:i})}},{key:"renderPanorama",value:function(){var r=this.props,s=r.x,l=r.y,f=r.width,i=r.height,x=r.data,S=r.children,I=r.padding,R=st.Children.only(S);return R?kt.cloneElement(R,{x:s,y:l,width:f,height:i,margin:I,compact:!0,data:x}):null}},{key:"renderTravellerLayer",value:function(r,s){var l,f,i=this,x=this.props,S=x.y,I=x.travellerWidth,R=x.height,F=x.traveller,j=x.ariaLabel,H=x.data,G=x.startIndex,W=x.endIndex,J=Math.max(r,this.props.x),ie=fO(fO({},di(this.props,!1)),{},{x:J,y:S,width:I,height:R}),he=j||"Min value: ".concat((l=H[G])===null||l===void 0?void 0:l.name,", Max value: ").concat((f=H[W])===null||f===void 0?void 0:f.name);return kt.createElement(Na,{tabIndex:0,role:"slider","aria-label":he,"aria-valuenow":r,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[s],onTouchStart:this.travellerDragStartHandlers[s],onKeyDown:function(fe){["ArrowLeft","ArrowRight"].includes(fe.key)&&(fe.preventDefault(),fe.stopPropagation(),i.handleTravellerMoveKeyboard(fe.key==="ArrowRight"?1:-1,s))},onFocus:function(){i.setState({isTravellerFocused:!0})},onBlur:function(){i.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},e.renderTraveller(F,ie))}},{key:"renderSlide",value:function(r,s){var l=this.props,f=l.y,i=l.height,x=l.stroke,S=l.travellerWidth,I=Math.min(r,s)+S,R=Math.max(Math.abs(s-r)-S,0);return kt.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:x,fillOpacity:.2,x:I,y:f,width:R,height:i})}},{key:"renderText",value:function(){var r=this.props,s=r.startIndex,l=r.endIndex,f=r.y,i=r.height,x=r.travellerWidth,S=r.stroke,I=this.state,R=I.startX,F=I.endX,j=5,H={pointerEvents:"none",fill:S};return kt.createElement(Na,{className:"recharts-brush-texts"},kt.createElement(iv,JT({textAnchor:"end",verticalAnchor:"middle",x:Math.min(R,F)-j,y:f+i/2},H),this.getTextOfTick(s)),kt.createElement(iv,JT({textAnchor:"start",verticalAnchor:"middle",x:Math.max(R,F)+x+j,y:f+i/2},H),this.getTextOfTick(l)))}},{key:"render",value:function(){var r=this.props,s=r.data,l=r.className,f=r.children,i=r.x,x=r.y,S=r.width,I=r.height,R=r.alwaysShowText,F=this.state,j=F.startX,H=F.endX,G=F.isTextActive,W=F.isSlideMoving,J=F.isTravellerMoving,ie=F.isTravellerFocused;if(!s||!s.length||!gr(i)||!gr(x)||!gr(S)||!gr(I)||S<=0||I<=0)return null;var he=fa("recharts-brush",l),ge=kt.Children.count(f)===1,fe=Gxe("userSelect","none");return kt.createElement(Na,{className:he,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:fe},this.renderBackground(),ge&&this.renderPanorama(),this.renderSlide(j,H),this.renderTravellerLayer(j,"startX"),this.renderTravellerLayer(H,"endX"),(G||W||J||ie||R)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(r){var s=r.x,l=r.y,f=r.width,i=r.height,x=r.stroke,S=Math.floor(l+i/2)-1;return kt.createElement(kt.Fragment,null,kt.createElement("rect",{x:s,y:l,width:f,height:i,fill:x,stroke:"none"}),kt.createElement("line",{x1:s+1,y1:S,x2:s+f-1,y2:S,fill:"none",stroke:"#fff"}),kt.createElement("line",{x1:s+1,y1:S+2,x2:s+f-1,y2:S+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(r,s){var l;return kt.isValidElement(r)?l=kt.cloneElement(r,s):qi(r)?l=r(s):l=e.renderDefaultTraveller(s),l}},{key:"getDerivedStateFromProps",value:function(r,s){var l=r.data,f=r.width,i=r.x,x=r.travellerWidth,S=r.updateId,I=r.startIndex,R=r.endIndex;if(l!==s.prevData||S!==s.prevUpdateId)return fO({prevData:l,prevTravellerWidth:x,prevUpdateId:S,prevX:i,prevWidth:f},l&&l.length?ewe({data:l,width:f,x:i,travellerWidth:x,startIndex:I,endIndex:R}):{scale:null,scaleValues:null});if(s.scale&&(f!==s.prevWidth||i!==s.prevX||x!==s.prevTravellerWidth)){s.scale.range([i,i+f-x]);var F=s.scale.domain().map(function(j){return s.scale(j)});return{prevData:l,prevTravellerWidth:x,prevUpdateId:S,prevX:i,prevWidth:f,startX:s.scale(r.startIndex),endX:s.scale(r.endIndex),scaleValues:F}}return null}},{key:"getIndexInRange",value:function(r,s){for(var l=r.length,f=0,i=l-1;i-f>1;){var x=Math.floor((f+i)/2);r[x]>s?i=x:f=x}return s>=r[i]?i:f}}])}(st.PureComponent);Jf(p1,"displayName","Brush");Jf(p1,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var dO,Oq;function twe(){if(Oq)return dO;Oq=1;var t=Ek();function e(n,r){var s;return t(n,function(l,f,i){return s=r(l,f,i),!s}),!!s}return dO=e,dO}var pO,Rq;function nwe(){if(Rq)return pO;Rq=1;var t=GK(),e=Om(),n=twe(),r=Cf(),s=mE();function l(f,i,x){var S=r(f)?t:n;return x&&s(f,i,x)&&(i=void 0),S(f,e(i,3))}return pO=l,pO}var rwe=nwe();const iwe=Xa(rwe);var Am=function(e,n){var r=e.alwaysShow,s=e.ifOverflow;return r&&(s="extendDomain"),s===n},mO,Dq;function awe(){if(Dq)return mO;Dq=1;var t=uY();function e(n,r,s){r=="__proto__"&&t?t(n,r,{configurable:!0,enumerable:!0,value:s,writable:!0}):n[r]=s}return mO=e,mO}var gO,Lq;function swe(){if(Lq)return gO;Lq=1;var t=awe(),e=lY(),n=Om();function r(s,l){var f={};return l=n(l,3),e(s,function(i,x,S){t(f,x,l(i,x,S))}),f}return gO=r,gO}var owe=swe();const lwe=Xa(owe);var yO,kq;function cwe(){if(kq)return yO;kq=1;function t(e,n){for(var r=-1,s=e==null?0:e.length;++r<s;)if(!n(e[r],r,e))return!1;return!0}return yO=t,yO}var _O,Nq;function uwe(){if(Nq)return _O;Nq=1;var t=Ek();function e(n,r){var s=!0;return t(n,function(l,f,i){return s=!!r(l,f,i),s}),s}return _O=e,_O}var vO,zq;function hwe(){if(zq)return vO;zq=1;var t=cwe(),e=uwe(),n=Om(),r=Cf(),s=mE();function l(f,i,x){var S=r(f)?t:e;return x&&s(f,i,x)&&(i=void 0),S(f,n(i,3))}return vO=l,vO}var fwe=hwe();const ZX=Xa(fwe);var dwe=["x","y"];function Nw(t){"@babel/helpers - typeof";return Nw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Nw(t)}function ZR(){return ZR=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},ZR.apply(this,arguments)}function Bq(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function ux(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Bq(Object(n),!0).forEach(function(r){pwe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Bq(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function pwe(t,e,n){return e=mwe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function mwe(t){var e=gwe(t,"string");return Nw(e)=="symbol"?e:e+""}function gwe(t,e){if(Nw(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(Nw(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function ywe(t,e){if(t==null)return{};var n=_we(t,e),r,s;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(s=0;s<l.length;s++)r=l[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function _we(t,e){if(t==null)return{};var n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;n[r]=t[r]}return n}function vwe(t,e){var n=t.x,r=t.y,s=ywe(t,dwe),l="".concat(n),f=parseInt(l,10),i="".concat(r),x=parseInt(i,10),S="".concat(e.height||s.height),I=parseInt(S,10),R="".concat(e.width||s.width),F=parseInt(R,10);return ux(ux(ux(ux(ux({},e),s),f?{x:f}:{}),x?{y:x}:{}),{},{height:I,width:F,name:e.name,radius:e.radius})}function jq(t){return kt.createElement($X,ZR({shapeType:"rectangle",propTransformer:vwe,activeClassName:"recharts-active-bar"},t))}var bwe=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(r,s){if(typeof e=="number")return e;var l=typeof r=="number";return l?e(r,s):(l||ov(),n)}},xwe=["value","background"],JX;function m1(t){"@babel/helpers - typeof";return m1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m1(t)}function wwe(t,e){if(t==null)return{};var n=Swe(t,e),r,s;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(s=0;s<l.length;s++)r=l[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function Swe(t,e){if(t==null)return{};var n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;n[r]=t[r]}return n}function e5(){return e5=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},e5.apply(this,arguments)}function Fq(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function rc(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Fq(Object(n),!0).forEach(function(r){vy(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Fq(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Awe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Uq(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,eZ(r.key),r)}}function Twe(t,e,n){return e&&Uq(t.prototype,e),n&&Uq(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ewe(t,e,n){return e=t5(e),Mwe(t,QX()?Reflect.construct(e,n||[],t5(t).constructor):e.apply(t,n))}function Mwe(t,e){if(e&&(m1(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Cwe(t)}function Cwe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function QX(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(QX=function(){return!!t})()}function t5(t){return t5=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},t5(t)}function Iwe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&JR(t,e)}function JR(t,e){return JR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},JR(t,e)}function vy(t,e,n){return e=eZ(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function eZ(t){var e=Pwe(t,"string");return m1(e)=="symbol"?e:e+""}function Pwe(t,e){if(m1(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(m1(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var xg=function(t){function e(){var n;Awe(this,e);for(var r=arguments.length,s=new Array(r),l=0;l<r;l++)s[l]=arguments[l];return n=Ewe(this,e,[].concat(s)),vy(n,"state",{isAnimationFinished:!1}),vy(n,"id",mv("recharts-bar-")),vy(n,"handleAnimationEnd",function(){var f=n.props.onAnimationEnd;n.setState({isAnimationFinished:!0}),f&&f()}),vy(n,"handleAnimationStart",function(){var f=n.props.onAnimationStart;n.setState({isAnimationFinished:!1}),f&&f()}),n}return Iwe(e,t),Twe(e,[{key:"renderRectanglesStatically",value:function(r){var s=this,l=this.props,f=l.shape,i=l.dataKey,x=l.activeIndex,S=l.activeBar,I=di(this.props,!1);return r&&r.map(function(R,F){var j=F===x,H=j?S:f,G=rc(rc(rc({},I),R),{},{isActive:j,option:H,index:F,dataKey:i,onAnimationStart:s.handleAnimationStart,onAnimationEnd:s.handleAnimationEnd});return kt.createElement(Na,e5({className:"recharts-bar-rectangle"},rv(s.props,R,F),{key:"rectangle-".concat(R==null?void 0:R.x,"-").concat(R==null?void 0:R.y,"-").concat(R==null?void 0:R.value)}),kt.createElement(jq,G))})}},{key:"renderRectanglesWithAnimation",value:function(){var r=this,s=this.props,l=s.data,f=s.layout,i=s.isAnimationActive,x=s.animationBegin,S=s.animationDuration,I=s.animationEasing,R=s.animationId,F=this.state.prevData;return kt.createElement(Op,{begin:x,duration:S,isActive:i,easing:I,from:{t:0},to:{t:1},key:"bar-".concat(R),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(j){var H=j.t,G=l.map(function(W,J){var ie=F&&F[J];if(ie){var he=Dc(ie.x,W.x),ge=Dc(ie.y,W.y),fe=Dc(ie.width,W.width),ye=Dc(ie.height,W.height);return rc(rc({},W),{},{x:he(H),y:ge(H),width:fe(H),height:ye(H)})}if(f==="horizontal"){var pe=Dc(0,W.height),be=pe(H);return rc(rc({},W),{},{y:W.y+W.height-be,height:be})}var Ae=Dc(0,W.width),Oe=Ae(H);return rc(rc({},W),{},{width:Oe})});return kt.createElement(Na,null,r.renderRectanglesStatically(G))})}},{key:"renderRectangles",value:function(){var r=this.props,s=r.data,l=r.isAnimationActive,f=this.state.prevData;return l&&s&&s.length&&(!f||!av(f,s))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(s)}},{key:"renderBackground",value:function(){var r=this,s=this.props,l=s.data,f=s.dataKey,i=s.activeIndex,x=di(this.props.background,!1);return l.map(function(S,I){S.value;var R=S.background,F=wwe(S,xwe);if(!R)return null;var j=rc(rc(rc(rc(rc({},F),{},{fill:"#eee"},R),x),rv(r.props,S,I)),{},{onAnimationStart:r.handleAnimationStart,onAnimationEnd:r.handleAnimationEnd,dataKey:f,index:I,className:"recharts-bar-background-rectangle"});return kt.createElement(jq,e5({key:"background-bar-".concat(I),option:r.props.background,isActive:I===i},j))})}},{key:"renderErrorBar",value:function(r,s){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var l=this.props,f=l.data,i=l.xAxis,x=l.yAxis,S=l.layout,I=l.children,R=od(I,A2);if(!R)return null;var F=S==="vertical"?f[0].height/2:f[0].width/2,j=function(W,J){var ie=Array.isArray(W.value)?W.value[1]:W.value;return{x:W.x,y:W.y,value:ie,errorVal:jl(W,J)}},H={clipPath:r?"url(#clipPath-".concat(s,")"):null};return kt.createElement(Na,H,R.map(function(G){return kt.cloneElement(G,{key:"error-bar-".concat(s,"-").concat(G.props.dataKey),data:f,xAxis:i,yAxis:x,layout:S,offset:F,dataPointFormatter:j})}))}},{key:"render",value:function(){var r=this.props,s=r.hide,l=r.data,f=r.className,i=r.xAxis,x=r.yAxis,S=r.left,I=r.top,R=r.width,F=r.height,j=r.isAnimationActive,H=r.background,G=r.id;if(s||!l||!l.length)return null;var W=this.state.isAnimationFinished,J=fa("recharts-bar",f),ie=i&&i.allowDataOverflow,he=x&&x.allowDataOverflow,ge=ie||he,fe=aa(G)?this.id:G;return kt.createElement(Na,{className:J},ie||he?kt.createElement("defs",null,kt.createElement("clipPath",{id:"clipPath-".concat(fe)},kt.createElement("rect",{x:ie?S:S-R/2,y:he?I:I-F/2,width:ie?R:R*2,height:he?F:F*2}))):null,kt.createElement(Na,{className:"recharts-bar-rectangles",clipPath:ge?"url(#clipPath-".concat(fe,")"):null},H?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(ge,fe),(!j||W)&&Ep.renderCallByParent(this.props,l))}}],[{key:"getDerivedStateFromProps",value:function(r,s){return r.animationId!==s.prevAnimationId?{prevAnimationId:r.animationId,curData:r.data,prevData:s.curData}:r.data!==s.curData?{curData:r.data}:null}}])}(st.PureComponent);JX=xg;vy(xg,"displayName","Bar");vy(xg,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!Ny.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});vy(xg,"getComposedData",function(t){var e=t.props,n=t.item,r=t.barPosition,s=t.bandSize,l=t.xAxis,f=t.yAxis,i=t.xAxisTicks,x=t.yAxisTicks,S=t.stackedData,I=t.dataStartIndex,R=t.displayedData,F=t.offset,j=ive(r,n);if(!j)return null;var H=e.layout,G=n.type.defaultProps,W=G!==void 0?rc(rc({},G),n.props):n.props,J=W.dataKey,ie=W.children,he=W.minPointSize,ge=H==="horizontal"?f:l,fe=S?ge.scale.domain():null,ye=hve({numericAxis:ge}),pe=od(ie,uw),be=R.map(function(Ae,Oe){var ue,we,ke,De,je,ze;S?ue=ave(S[I+Oe],fe):(ue=jl(Ae,J),Array.isArray(ue)||(ue=[ye,ue]));var Ue=bwe(he,JX.defaultProps.minPointSize)(ue[1],Oe);if(H==="horizontal"){var Fe,Qe=[f.scale(ue[0]),f.scale(ue[1])],Be=Qe[0],bt=Qe[1];we=d9({axis:l,ticks:i,bandSize:s,offset:j.offset,entry:Ae,index:Oe}),ke=(Fe=bt??Be)!==null&&Fe!==void 0?Fe:void 0,De=j.size;var xe=Be-bt;if(je=Number.isNaN(xe)?0:xe,ze={x:we,y:f.y,width:De,height:f.height},Math.abs(Ue)>0&&Math.abs(je)<Math.abs(Ue)){var Le=Wh(je||Ue)*(Math.abs(Ue)-Math.abs(je));ke-=Le,je+=Le}}else{var Xe=[l.scale(ue[0]),l.scale(ue[1])],ct=Xe[0],vt=Xe[1];if(we=ct,ke=d9({axis:f,ticks:x,bandSize:s,offset:j.offset,entry:Ae,index:Oe}),De=vt-ct,je=j.size,ze={x:l.x,y:ke,width:l.width,height:je},Math.abs(Ue)>0&&Math.abs(De)<Math.abs(Ue)){var Nt=Wh(De||Ue)*(Math.abs(Ue)-Math.abs(De));De+=Nt}}return rc(rc(rc({},Ae),{},{x:we,y:ke,width:De,height:je,value:S?ue:ue[1],payload:Ae,background:ze},pe&&pe[Oe]&&pe[Oe].props),{},{tooltipPayload:[EX(n,Ae)],tooltipPosition:{x:we+De/2,y:ke+je/2}})});return rc({data:be,layout:H},F)});function zw(t){"@babel/helpers - typeof";return zw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zw(t)}function Owe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function qq(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,tZ(r.key),r)}}function Rwe(t,e,n){return e&&qq(t.prototype,e),n&&qq(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Vq(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function wp(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Vq(Object(n),!0).forEach(function(r){RE(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Vq(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function RE(t,e,n){return e=tZ(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function tZ(t){var e=Dwe(t,"string");return zw(e)=="symbol"?e:e+""}function Dwe(t,e){if(zw(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(zw(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var tN=function(e,n,r,s,l){var f=e.width,i=e.height,x=e.layout,S=e.children,I=Object.keys(n),R={left:r.left,leftMirror:r.left,right:f-r.right,rightMirror:f-r.right,top:r.top,topMirror:r.top,bottom:i-r.bottom,bottomMirror:i-r.bottom},F=!!Qf(S,xg);return I.reduce(function(j,H){var G=n[H],W=G.orientation,J=G.domain,ie=G.padding,he=ie===void 0?{}:ie,ge=G.mirror,fe=G.reversed,ye="".concat(W).concat(ge?"Mirror":""),pe,be,Ae,Oe,ue;if(G.type==="number"&&(G.padding==="gap"||G.padding==="no-gap")){var we=J[1]-J[0],ke=1/0,De=G.categoricalDomain.sort();if(De.forEach(function(Xe,ct){ct>0&&(ke=Math.min((Xe||0)-(De[ct-1]||0),ke))}),Number.isFinite(ke)){var je=ke/we,ze=G.layout==="vertical"?r.height:r.width;if(G.padding==="gap"&&(pe=je*ze/2),G.padding==="no-gap"){var Ue=Kh(e.barCategoryGap,je*ze),Fe=je*ze/2;pe=Fe-Ue-(Fe-Ue)/ze*Ue}}}s==="xAxis"?be=[r.left+(he.left||0)+(pe||0),r.left+r.width-(he.right||0)-(pe||0)]:s==="yAxis"?be=x==="horizontal"?[r.top+r.height-(he.bottom||0),r.top+(he.top||0)]:[r.top+(he.top||0)+(pe||0),r.top+r.height-(he.bottom||0)-(pe||0)]:be=G.range,fe&&(be=[be[1],be[0]]);var Qe=wX(G,l,F),Be=Qe.scale,bt=Qe.realScaleType;Be.domain(J).range(be),SX(Be);var xe=AX(Be,wp(wp({},G),{},{realScaleType:bt}));s==="xAxis"?(ue=W==="top"&&!ge||W==="bottom"&&ge,Ae=r.left,Oe=R[ye]-ue*G.height):s==="yAxis"&&(ue=W==="left"&&!ge||W==="right"&&ge,Ae=R[ye]-ue*G.width,Oe=r.top);var Le=wp(wp(wp({},G),xe),{},{realScaleType:bt,x:Ae,y:Oe,scale:Be,width:s==="xAxis"?r.width:G.width,height:s==="yAxis"?r.height:G.height});return Le.bandSize=jT(Le,xe),!G.hide&&s==="xAxis"?R[ye]+=(ue?-1:1)*Le.height:G.hide||(R[ye]+=(ue?-1:1)*Le.width),wp(wp({},j),{},RE({},H,Le))},{})},nZ=function(e,n){var r=e.x,s=e.y,l=n.x,f=n.y;return{x:Math.min(r,l),y:Math.min(s,f),width:Math.abs(l-r),height:Math.abs(f-s)}},Lwe=function(e){var n=e.x1,r=e.y1,s=e.x2,l=e.y2;return nZ({x:n,y:r},{x:s,y:l})},rZ=function(){function t(e){Owe(this,t),this.scale=e}return Rwe(t,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=r.bandAware,l=r.position;if(n!==void 0){if(l)switch(l){case"start":return this.scale(n);case"middle":{var f=this.bandwidth?this.bandwidth()/2:0;return this.scale(n)+f}case"end":{var i=this.bandwidth?this.bandwidth():0;return this.scale(n)+i}default:return this.scale(n)}if(s){var x=this.bandwidth?this.bandwidth()/2:0;return this.scale(n)+x}return this.scale(n)}}},{key:"isInRange",value:function(n){var r=this.range(),s=r[0],l=r[r.length-1];return s<=l?n>=s&&n<=l:n>=l&&n<=s}}],[{key:"create",value:function(n){return new t(n)}}])}();RE(rZ,"EPS",1e-4);var nN=function(e){var n=Object.keys(e).reduce(function(r,s){return wp(wp({},r),{},RE({},s,rZ.create(e[s])))},{});return wp(wp({},n),{},{apply:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},f=l.bandAware,i=l.position;return lwe(s,function(x,S){return n[S].apply(x,{bandAware:f,position:i})})},isInRange:function(s){return ZX(s,function(l,f){return n[f].isInRange(l)})}})};function kwe(t){return(t%180+180)%180}var Nwe=function(e){var n=e.width,r=e.height,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,l=kwe(s),f=l*Math.PI/180,i=Math.atan(r/n),x=f>i&&f<Math.PI-i?r/Math.sin(f):n/Math.cos(f);return Math.abs(x)},bO,$q;function zwe(){if($q)return bO;$q=1;var t=Om(),e=v2(),n=dE();function r(s){return function(l,f,i){var x=Object(l);if(!e(l)){var S=t(f,3);l=n(l),f=function(R){return S(x[R],R,x)}}var I=s(l,f,i);return I>-1?x[S?l[I]:I]:void 0}}return bO=r,bO}var xO,Hq;function Bwe(){if(Hq)return xO;Hq=1;var t=WX();function e(n){var r=t(n),s=r%1;return r===r?s?r-s:r:0}return xO=e,xO}var wO,Gq;function jwe(){if(Gq)return wO;Gq=1;var t=rY(),e=Om(),n=Bwe(),r=Math.max;function s(l,f,i){var x=l==null?0:l.length;if(!x)return-1;var S=i==null?0:n(i);return S<0&&(S=r(x+S,0)),t(l,e(f,3),S)}return wO=s,wO}var SO,Wq;function Fwe(){if(Wq)return SO;Wq=1;var t=zwe(),e=jwe(),n=t(e);return SO=n,SO}var Uwe=Fwe();const qwe=Xa(Uwe);var Vwe=_K();const $we=Xa(Vwe);var Hwe=$we(function(t){return{x:t.left,y:t.top,width:t.width,height:t.height}},function(t){return["l",t.left,"t",t.top,"w",t.width,"h",t.height].join("")}),rN=st.createContext(void 0),iN=st.createContext(void 0),iZ=st.createContext(void 0),aZ=st.createContext({}),sZ=st.createContext(void 0),oZ=st.createContext(0),lZ=st.createContext(0),Kq=function(e){var n=e.state,r=n.xAxisMap,s=n.yAxisMap,l=n.offset,f=e.clipPathId,i=e.children,x=e.width,S=e.height,I=Hwe(l);return kt.createElement(rN.Provider,{value:r},kt.createElement(iN.Provider,{value:s},kt.createElement(aZ.Provider,{value:l},kt.createElement(iZ.Provider,{value:I},kt.createElement(sZ.Provider,{value:f},kt.createElement(oZ.Provider,{value:S},kt.createElement(lZ.Provider,{value:x},i)))))))},Gwe=function(){return st.useContext(sZ)},cZ=function(e){var n=st.useContext(rN);n==null&&ov();var r=n[e];return r==null&&ov(),r},Wwe=function(){var e=st.useContext(rN);return gy(e)},Kwe=function(){var e=st.useContext(iN),n=qwe(e,function(r){return ZX(r.domain,Number.isFinite)});return n||gy(e)},uZ=function(e){var n=st.useContext(iN);n==null&&ov();var r=n[e];return r==null&&ov(),r},Ywe=function(){var e=st.useContext(iZ);return e},Xwe=function(){return st.useContext(aZ)},aN=function(){return st.useContext(lZ)},sN=function(){return st.useContext(oZ)};function g1(t){"@babel/helpers - typeof";return g1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g1(t)}function Zwe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Jwe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,fZ(r.key),r)}}function Qwe(t,e,n){return e&&Jwe(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function e2e(t,e,n){return e=n5(e),t2e(t,hZ()?Reflect.construct(e,n||[],n5(t).constructor):e.apply(t,n))}function t2e(t,e){if(e&&(g1(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return n2e(t)}function n2e(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function hZ(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(hZ=function(){return!!t})()}function n5(t){return n5=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},n5(t)}function r2e(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&QR(t,e)}function QR(t,e){return QR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},QR(t,e)}function Yq(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function Xq(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Yq(Object(n),!0).forEach(function(r){oN(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Yq(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function oN(t,e,n){return e=fZ(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function fZ(t){var e=i2e(t,"string");return g1(e)=="symbol"?e:e+""}function i2e(t,e){if(g1(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(g1(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function a2e(t,e){return c2e(t)||l2e(t,e)||o2e(t,e)||s2e()}function s2e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function o2e(t,e){if(t){if(typeof t=="string")return Zq(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Zq(t,e)}}function Zq(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function l2e(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r,s,l,f,i=[],x=!0,S=!1;try{if(l=(n=n.call(t)).next,e!==0)for(;!(x=(r=l.call(n)).done)&&(i.push(r.value),i.length!==e);x=!0);}catch(I){S=!0,s=I}finally{try{if(!x&&n.return!=null&&(f=n.return(),Object(f)!==f))return}finally{if(S)throw s}}return i}}function c2e(t){if(Array.isArray(t))return t}function eD(){return eD=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},eD.apply(this,arguments)}var u2e=function(e,n){var r;return kt.isValidElement(e)?r=kt.cloneElement(e,n):qi(e)?r=e(n):r=kt.createElement("line",eD({},n,{className:"recharts-reference-line-line"})),r},h2e=function(e,n,r,s,l,f,i,x,S){var I=l.x,R=l.y,F=l.width,j=l.height;if(r){var H=S.y,G=e.y.apply(H,{position:f});if(Am(S,"discard")&&!e.y.isInRange(G))return null;var W=[{x:I+F,y:G},{x:I,y:G}];return x==="left"?W.reverse():W}if(n){var J=S.x,ie=e.x.apply(J,{position:f});if(Am(S,"discard")&&!e.x.isInRange(ie))return null;var he=[{x:ie,y:R+j},{x:ie,y:R}];return i==="top"?he.reverse():he}if(s){var ge=S.segment,fe=ge.map(function(ye){return e.apply(ye,{position:f})});return Am(S,"discard")&&iwe(fe,function(ye){return!e.isInRange(ye)})?null:fe}return null};function f2e(t){var e=t.x,n=t.y,r=t.segment,s=t.xAxisId,l=t.yAxisId,f=t.shape,i=t.className,x=t.alwaysShow,S=Gwe(),I=cZ(s),R=uZ(l),F=Ywe();if(!S||!F)return null;Tp(x===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var j=nN({x:I.scale,y:R.scale}),H=Lc(e),G=Lc(n),W=r&&r.length===2,J=h2e(j,H,G,W,F,t.position,I.orientation,R.orientation,t);if(!J)return null;var ie=a2e(J,2),he=ie[0],ge=he.x,fe=he.y,ye=ie[1],pe=ye.x,be=ye.y,Ae=Am(t,"hidden")?"url(#".concat(S,")"):void 0,Oe=Xq(Xq({clipPath:Ae},di(t,!0)),{},{x1:ge,y1:fe,x2:pe,y2:be});return kt.createElement(Na,{className:fa("recharts-reference-line",i)},u2e(f,Oe),eu.renderCallByParent(t,Lwe({x1:ge,y1:fe,x2:pe,y2:be})))}var lN=function(t){function e(){return Zwe(this,e),e2e(this,e,arguments)}return r2e(e,t),Qwe(e,[{key:"render",value:function(){return kt.createElement(f2e,this.props)}}])}(kt.Component);oN(lN,"displayName","ReferenceLine");oN(lN,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function tD(){return tD=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},tD.apply(this,arguments)}function y1(t){"@babel/helpers - typeof";return y1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y1(t)}function Jq(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function Qq(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Jq(Object(n),!0).forEach(function(r){DE(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Jq(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function d2e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p2e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,pZ(r.key),r)}}function m2e(t,e,n){return e&&p2e(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function g2e(t,e,n){return e=r5(e),y2e(t,dZ()?Reflect.construct(e,n||[],r5(t).constructor):e.apply(t,n))}function y2e(t,e){if(e&&(y1(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _2e(t)}function _2e(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function dZ(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(dZ=function(){return!!t})()}function r5(t){return r5=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},r5(t)}function v2e(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&nD(t,e)}function nD(t,e){return nD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},nD(t,e)}function DE(t,e,n){return e=pZ(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function pZ(t){var e=b2e(t,"string");return y1(e)=="symbol"?e:e+""}function b2e(t,e){if(y1(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(y1(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var x2e=function(e){var n=e.x,r=e.y,s=e.xAxis,l=e.yAxis,f=nN({x:s.scale,y:l.scale}),i=f.apply({x:n,y:r},{bandAware:!0});return Am(e,"discard")&&!f.isInRange(i)?null:i},LE=function(t){function e(){return d2e(this,e),g2e(this,e,arguments)}return v2e(e,t),m2e(e,[{key:"render",value:function(){var r=this.props,s=r.x,l=r.y,f=r.r,i=r.alwaysShow,x=r.clipPathId,S=Lc(s),I=Lc(l);if(Tp(i===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!S||!I)return null;var R=x2e(this.props);if(!R)return null;var F=R.x,j=R.y,H=this.props,G=H.shape,W=H.className,J=Am(this.props,"hidden")?"url(#".concat(x,")"):void 0,ie=Qq(Qq({clipPath:J},di(this.props,!0)),{},{cx:F,cy:j});return kt.createElement(Na,{className:fa("recharts-reference-dot",W)},e.renderDot(G,ie),eu.renderCallByParent(this.props,{x:F-f,y:j-f,width:2*f,height:2*f}))}}])}(kt.Component);DE(LE,"displayName","ReferenceDot");DE(LE,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});DE(LE,"renderDot",function(t,e){var n;return kt.isValidElement(t)?n=kt.cloneElement(t,e):qi(t)?n=t(e):n=kt.createElement(T2,tD({},e,{cx:e.cx,cy:e.cy,className:"recharts-reference-dot-dot"})),n});function rD(){return rD=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},rD.apply(this,arguments)}function _1(t){"@babel/helpers - typeof";return _1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_1(t)}function eV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function tV(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?eV(Object(n),!0).forEach(function(r){kE(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):eV(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function w2e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function S2e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,gZ(r.key),r)}}function A2e(t,e,n){return e&&S2e(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function T2e(t,e,n){return e=i5(e),E2e(t,mZ()?Reflect.construct(e,n||[],i5(t).constructor):e.apply(t,n))}function E2e(t,e){if(e&&(_1(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return M2e(t)}function M2e(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function mZ(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(mZ=function(){return!!t})()}function i5(t){return i5=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},i5(t)}function C2e(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&iD(t,e)}function iD(t,e){return iD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},iD(t,e)}function kE(t,e,n){return e=gZ(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function gZ(t){var e=I2e(t,"string");return _1(e)=="symbol"?e:e+""}function I2e(t,e){if(_1(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(_1(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var P2e=function(e,n,r,s,l){var f=l.x1,i=l.x2,x=l.y1,S=l.y2,I=l.xAxis,R=l.yAxis;if(!I||!R)return null;var F=nN({x:I.scale,y:R.scale}),j={x:e?F.x.apply(f,{position:"start"}):F.x.rangeMin,y:r?F.y.apply(x,{position:"start"}):F.y.rangeMin},H={x:n?F.x.apply(i,{position:"end"}):F.x.rangeMax,y:s?F.y.apply(S,{position:"end"}):F.y.rangeMax};return Am(l,"discard")&&(!F.isInRange(j)||!F.isInRange(H))?null:nZ(j,H)},NE=function(t){function e(){return w2e(this,e),T2e(this,e,arguments)}return C2e(e,t),A2e(e,[{key:"render",value:function(){var r=this.props,s=r.x1,l=r.x2,f=r.y1,i=r.y2,x=r.className,S=r.alwaysShow,I=r.clipPathId;Tp(S===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var R=Lc(s),F=Lc(l),j=Lc(f),H=Lc(i),G=this.props.shape;if(!R&&!F&&!j&&!H&&!G)return null;var W=P2e(R,F,j,H,this.props);if(!W&&!G)return null;var J=Am(this.props,"hidden")?"url(#".concat(I,")"):void 0;return kt.createElement(Na,{className:fa("recharts-reference-area",x)},e.renderRect(G,tV(tV({clipPath:J},di(this.props,!0)),W)),eu.renderCallByParent(this.props,W))}}])}(kt.Component);kE(NE,"displayName","ReferenceArea");kE(NE,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});kE(NE,"renderRect",function(t,e){var n;return kt.isValidElement(t)?n=kt.cloneElement(t,e):qi(t)?n=t(e):n=kt.createElement(eN,rD({},e,{className:"recharts-reference-area-rect"})),n});function yZ(t,e,n){if(e<1)return[];if(e===1&&n===void 0)return t;for(var r=[],s=0;s<t.length;s+=e)r.push(t[s]);return r}function O2e(t,e,n){var r={width:t.width+e.width,height:t.height+e.height};return Nwe(r,n)}function R2e(t,e,n){var r=n==="width",s=t.x,l=t.y,f=t.width,i=t.height;return e===1?{start:r?s:l,end:r?s+f:l+i}:{start:r?s+f:l+i,end:r?s:l}}function a5(t,e,n,r,s){if(t*e<t*r||t*e>t*s)return!1;var l=n();return t*(e-t*l/2-r)>=0&&t*(e+t*l/2-s)<=0}function D2e(t,e){return yZ(t,e+1)}function L2e(t,e,n,r,s){for(var l=(r||[]).slice(),f=e.start,i=e.end,x=0,S=1,I=f,R=function(){var H=r==null?void 0:r[x];if(H===void 0)return{v:yZ(r,S)};var G=x,W,J=function(){return W===void 0&&(W=n(H,G)),W},ie=H.coordinate,he=x===0||a5(t,ie,J,I,i);he||(x=0,I=f,S+=1),he&&(I=ie+t*(J()/2+s),x+=S)},F;S<=l.length;)if(F=R(),F)return F.v;return[]}function Bw(t){"@babel/helpers - typeof";return Bw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bw(t)}function nV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function ah(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?nV(Object(n),!0).forEach(function(r){k2e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):nV(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function k2e(t,e,n){return e=N2e(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function N2e(t){var e=z2e(t,"string");return Bw(e)=="symbol"?e:e+""}function z2e(t,e){if(Bw(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(Bw(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function B2e(t,e,n,r,s){for(var l=(r||[]).slice(),f=l.length,i=e.start,x=e.end,S=function(F){var j=l[F],H,G=function(){return H===void 0&&(H=n(j,F)),H};if(F===f-1){var W=t*(j.coordinate+t*G()/2-x);l[F]=j=ah(ah({},j),{},{tickCoord:W>0?j.coordinate-W*t:j.coordinate})}else l[F]=j=ah(ah({},j),{},{tickCoord:j.coordinate});var J=a5(t,j.tickCoord,G,i,x);J&&(x=j.tickCoord-t*(G()/2+s),l[F]=ah(ah({},j),{},{isShow:!0}))},I=f-1;I>=0;I--)S(I);return l}function j2e(t,e,n,r,s,l){var f=(r||[]).slice(),i=f.length,x=e.start,S=e.end;if(l){var I=r[i-1],R=n(I,i-1),F=t*(I.coordinate+t*R/2-S);f[i-1]=I=ah(ah({},I),{},{tickCoord:F>0?I.coordinate-F*t:I.coordinate});var j=a5(t,I.tickCoord,function(){return R},x,S);j&&(S=I.tickCoord-t*(R/2+s),f[i-1]=ah(ah({},I),{},{isShow:!0}))}for(var H=l?i-1:i,G=function(ie){var he=f[ie],ge,fe=function(){return ge===void 0&&(ge=n(he,ie)),ge};if(ie===0){var ye=t*(he.coordinate-t*fe()/2-x);f[ie]=he=ah(ah({},he),{},{tickCoord:ye<0?he.coordinate-ye*t:he.coordinate})}else f[ie]=he=ah(ah({},he),{},{tickCoord:he.coordinate});var pe=a5(t,he.tickCoord,fe,x,S);pe&&(x=he.tickCoord+t*(fe()/2+s),f[ie]=ah(ah({},he),{},{isShow:!0}))},W=0;W<H;W++)G(W);return f}function cN(t,e,n){var r=t.tick,s=t.ticks,l=t.viewBox,f=t.minTickGap,i=t.orientation,x=t.interval,S=t.tickFormatter,I=t.unit,R=t.angle;if(!s||!s.length||!r)return[];if(gr(x)||Ny.isSsr)return D2e(s,typeof x=="number"&&gr(x)?x:0);var F=[],j=i==="top"||i==="bottom"?"width":"height",H=I&&j==="width"?Rx(I,{fontSize:e,letterSpacing:n}):{width:0,height:0},G=function(he,ge){var fe=qi(S)?S(he.value,ge):he.value;return j==="width"?O2e(Rx(fe,{fontSize:e,letterSpacing:n}),H,R):Rx(fe,{fontSize:e,letterSpacing:n})[j]},W=s.length>=2?Wh(s[1].coordinate-s[0].coordinate):1,J=R2e(l,W,j);return x==="equidistantPreserveStart"?L2e(W,J,G,s,f):(x==="preserveStart"||x==="preserveStartEnd"?F=j2e(W,J,G,s,f,x==="preserveStartEnd"):F=B2e(W,J,G,s,f),F.filter(function(ie){return ie.isShow}))}var F2e=["viewBox"],U2e=["viewBox"],q2e=["ticks"];function v1(t){"@babel/helpers - typeof";return v1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v1(t)}function E0(){return E0=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},E0.apply(this,arguments)}function rV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function Hh(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?rV(Object(n),!0).forEach(function(r){uN(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):rV(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function AO(t,e){if(t==null)return{};var n=V2e(t,e),r,s;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(s=0;s<l.length;s++)r=l[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function V2e(t,e){if(t==null)return{};var n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;n[r]=t[r]}return n}function $2e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function iV(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,vZ(r.key),r)}}function H2e(t,e,n){return e&&iV(t.prototype,e),n&&iV(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function G2e(t,e,n){return e=s5(e),W2e(t,_Z()?Reflect.construct(e,n||[],s5(t).constructor):e.apply(t,n))}function W2e(t,e){if(e&&(v1(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return K2e(t)}function K2e(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _Z(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(_Z=function(){return!!t})()}function s5(t){return s5=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},s5(t)}function Y2e(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&aD(t,e)}function aD(t,e){return aD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},aD(t,e)}function uN(t,e,n){return e=vZ(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function vZ(t){var e=X2e(t,"string");return v1(e)=="symbol"?e:e+""}function X2e(t,e){if(v1(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(v1(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var V1=function(t){function e(n){var r;return $2e(this,e),r=G2e(this,e,[n]),r.state={fontSize:"",letterSpacing:""},r}return Y2e(e,t),H2e(e,[{key:"shouldComponentUpdate",value:function(r,s){var l=r.viewBox,f=AO(r,F2e),i=this.props,x=i.viewBox,S=AO(i,U2e);return!z0(l,x)||!z0(f,S)||!z0(s,this.state)}},{key:"componentDidMount",value:function(){var r=this.layerReference;if(r){var s=r.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];s&&this.setState({fontSize:window.getComputedStyle(s).fontSize,letterSpacing:window.getComputedStyle(s).letterSpacing})}}},{key:"getTickLineCoord",value:function(r){var s=this.props,l=s.x,f=s.y,i=s.width,x=s.height,S=s.orientation,I=s.tickSize,R=s.mirror,F=s.tickMargin,j,H,G,W,J,ie,he=R?-1:1,ge=r.tickSize||I,fe=gr(r.tickCoord)?r.tickCoord:r.coordinate;switch(S){case"top":j=H=r.coordinate,W=f+ +!R*x,G=W-he*ge,ie=G-he*F,J=fe;break;case"left":G=W=r.coordinate,H=l+ +!R*i,j=H-he*ge,J=j-he*F,ie=fe;break;case"right":G=W=r.coordinate,H=l+ +R*i,j=H+he*ge,J=j+he*F,ie=fe;break;default:j=H=r.coordinate,W=f+ +R*x,G=W+he*ge,ie=G+he*F,J=fe;break}return{line:{x1:j,y1:G,x2:H,y2:W},tick:{x:J,y:ie}}}},{key:"getTickTextAnchor",value:function(){var r=this.props,s=r.orientation,l=r.mirror,f;switch(s){case"left":f=l?"start":"end";break;case"right":f=l?"end":"start";break;default:f="middle";break}return f}},{key:"getTickVerticalAnchor",value:function(){var r=this.props,s=r.orientation,l=r.mirror,f="end";switch(s){case"left":case"right":f="middle";break;case"top":f=l?"start":"end";break;default:f=l?"end":"start";break}return f}},{key:"renderAxisLine",value:function(){var r=this.props,s=r.x,l=r.y,f=r.width,i=r.height,x=r.orientation,S=r.mirror,I=r.axisLine,R=Hh(Hh(Hh({},di(this.props,!1)),di(I,!1)),{},{fill:"none"});if(x==="top"||x==="bottom"){var F=+(x==="top"&&!S||x==="bottom"&&S);R=Hh(Hh({},R),{},{x1:s,y1:l+F*i,x2:s+f,y2:l+F*i})}else{var j=+(x==="left"&&!S||x==="right"&&S);R=Hh(Hh({},R),{},{x1:s+j*f,y1:l,x2:s+j*f,y2:l+i})}return kt.createElement("line",E0({},R,{className:fa("recharts-cartesian-axis-line",sd(I,"className"))}))}},{key:"renderTicks",value:function(r,s,l){var f=this,i=this.props,x=i.tickLine,S=i.stroke,I=i.tick,R=i.tickFormatter,F=i.unit,j=cN(Hh(Hh({},this.props),{},{ticks:r}),s,l),H=this.getTickTextAnchor(),G=this.getTickVerticalAnchor(),W=di(this.props,!1),J=di(I,!1),ie=Hh(Hh({},W),{},{fill:"none"},di(x,!1)),he=j.map(function(ge,fe){var ye=f.getTickLineCoord(ge),pe=ye.line,be=ye.tick,Ae=Hh(Hh(Hh(Hh({textAnchor:H,verticalAnchor:G},W),{},{stroke:"none",fill:S},J),be),{},{index:fe,payload:ge,visibleTicksCount:j.length,tickFormatter:R});return kt.createElement(Na,E0({className:"recharts-cartesian-axis-tick",key:"tick-".concat(ge.value,"-").concat(ge.coordinate,"-").concat(ge.tickCoord)},rv(f.props,ge,fe)),x&&kt.createElement("line",E0({},ie,pe,{className:fa("recharts-cartesian-axis-tick-line",sd(x,"className"))})),I&&e.renderTickItem(I,Ae,"".concat(qi(R)?R(ge.value,fe):ge.value).concat(F||"")))});return kt.createElement("g",{className:"recharts-cartesian-axis-ticks"},he)}},{key:"render",value:function(){var r=this,s=this.props,l=s.axisLine,f=s.width,i=s.height,x=s.ticksGenerator,S=s.className,I=s.hide;if(I)return null;var R=this.props,F=R.ticks,j=AO(R,q2e),H=F;return qi(x)&&(H=F&&F.length>0?x(this.props):x(j)),f<=0||i<=0||!H||!H.length?null:kt.createElement(Na,{className:fa("recharts-cartesian-axis",S),ref:function(W){r.layerReference=W}},l&&this.renderAxisLine(),this.renderTicks(H,this.state.fontSize,this.state.letterSpacing),eu.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(r,s,l){var f;return kt.isValidElement(r)?f=kt.cloneElement(r,s):qi(r)?f=r(s):f=kt.createElement(iv,E0({},s,{className:"recharts-cartesian-axis-tick-value"}),l),f}}])}(st.Component);uN(V1,"displayName","CartesianAxis");uN(V1,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var Z2e=["x1","y1","x2","y2","key"],J2e=["offset"];function lv(t){"@babel/helpers - typeof";return lv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},lv(t)}function aV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function lh(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?aV(Object(n),!0).forEach(function(r){Q2e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):aV(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Q2e(t,e,n){return e=eSe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function eSe(t){var e=tSe(t,"string");return lv(e)=="symbol"?e:e+""}function tSe(t,e){if(lv(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(lv(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function U_(){return U_=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},U_.apply(this,arguments)}function sV(t,e){if(t==null)return{};var n=nSe(t,e),r,s;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(s=0;s<l.length;s++)r=l[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function nSe(t,e){if(t==null)return{};var n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;n[r]=t[r]}return n}var rSe=function(e){var n=e.fill;if(!n||n==="none")return null;var r=e.fillOpacity,s=e.x,l=e.y,f=e.width,i=e.height,x=e.ry;return kt.createElement("rect",{x:s,y:l,ry:x,width:f,height:i,stroke:"none",fill:n,fillOpacity:r,className:"recharts-cartesian-grid-bg"})};function bZ(t,e){var n;if(kt.isValidElement(t))n=kt.cloneElement(t,e);else if(qi(t))n=t(e);else{var r=e.x1,s=e.y1,l=e.x2,f=e.y2,i=e.key,x=sV(e,Z2e),S=di(x,!1);S.offset;var I=sV(S,J2e);n=kt.createElement("line",U_({},I,{x1:r,y1:s,x2:l,y2:f,fill:"none",key:i}))}return n}function iSe(t){var e=t.x,n=t.width,r=t.horizontal,s=r===void 0?!0:r,l=t.horizontalPoints;if(!s||!l||!l.length)return null;var f=l.map(function(i,x){var S=lh(lh({},t),{},{x1:e,y1:i,x2:e+n,y2:i,key:"line-".concat(x),index:x});return bZ(s,S)});return kt.createElement("g",{className:"recharts-cartesian-grid-horizontal"},f)}function aSe(t){var e=t.y,n=t.height,r=t.vertical,s=r===void 0?!0:r,l=t.verticalPoints;if(!s||!l||!l.length)return null;var f=l.map(function(i,x){var S=lh(lh({},t),{},{x1:i,y1:e,x2:i,y2:e+n,key:"line-".concat(x),index:x});return bZ(s,S)});return kt.createElement("g",{className:"recharts-cartesian-grid-vertical"},f)}function sSe(t){var e=t.horizontalFill,n=t.fillOpacity,r=t.x,s=t.y,l=t.width,f=t.height,i=t.horizontalPoints,x=t.horizontal,S=x===void 0?!0:x;if(!S||!e||!e.length)return null;var I=i.map(function(F){return Math.round(F+s-s)}).sort(function(F,j){return F-j});s!==I[0]&&I.unshift(0);var R=I.map(function(F,j){var H=!I[j+1],G=H?s+f-F:I[j+1]-F;if(G<=0)return null;var W=j%e.length;return kt.createElement("rect",{key:"react-".concat(j),y:F,x:r,height:G,width:l,stroke:"none",fill:e[W],fillOpacity:n,className:"recharts-cartesian-grid-bg"})});return kt.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},R)}function oSe(t){var e=t.vertical,n=e===void 0?!0:e,r=t.verticalFill,s=t.fillOpacity,l=t.x,f=t.y,i=t.width,x=t.height,S=t.verticalPoints;if(!n||!r||!r.length)return null;var I=S.map(function(F){return Math.round(F+l-l)}).sort(function(F,j){return F-j});l!==I[0]&&I.unshift(0);var R=I.map(function(F,j){var H=!I[j+1],G=H?l+i-F:I[j+1]-F;if(G<=0)return null;var W=j%r.length;return kt.createElement("rect",{key:"react-".concat(j),x:F,y:f,width:G,height:x,stroke:"none",fill:r[W],fillOpacity:s,className:"recharts-cartesian-grid-bg"})});return kt.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},R)}var lSe=function(e,n){var r=e.xAxis,s=e.width,l=e.height,f=e.offset;return xX(cN(lh(lh(lh({},V1.defaultProps),r),{},{ticks:sg(r,!0),viewBox:{x:0,y:0,width:s,height:l}})),f.left,f.left+f.width,n)},cSe=function(e,n){var r=e.yAxis,s=e.width,l=e.height,f=e.offset;return xX(cN(lh(lh(lh({},V1.defaultProps),r),{},{ticks:sg(r,!0),viewBox:{x:0,y:0,width:s,height:l}})),f.top,f.top+f.height,n)},c0={horizontal:!0,vertical:!0,stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function dm(t){var e,n,r,s,l,f,i=aN(),x=sN(),S=Xwe(),I=lh(lh({},t),{},{stroke:(e=t.stroke)!==null&&e!==void 0?e:c0.stroke,fill:(n=t.fill)!==null&&n!==void 0?n:c0.fill,horizontal:(r=t.horizontal)!==null&&r!==void 0?r:c0.horizontal,horizontalFill:(s=t.horizontalFill)!==null&&s!==void 0?s:c0.horizontalFill,vertical:(l=t.vertical)!==null&&l!==void 0?l:c0.vertical,verticalFill:(f=t.verticalFill)!==null&&f!==void 0?f:c0.verticalFill,x:gr(t.x)?t.x:S.left,y:gr(t.y)?t.y:S.top,width:gr(t.width)?t.width:S.width,height:gr(t.height)?t.height:S.height}),R=I.x,F=I.y,j=I.width,H=I.height,G=I.syncWithTicks,W=I.horizontalValues,J=I.verticalValues,ie=Wwe(),he=Kwe();if(!gr(j)||j<=0||!gr(H)||H<=0||!gr(R)||R!==+R||!gr(F)||F!==+F)return null;var ge=I.verticalCoordinatesGenerator||lSe,fe=I.horizontalCoordinatesGenerator||cSe,ye=I.horizontalPoints,pe=I.verticalPoints;if((!ye||!ye.length)&&qi(fe)){var be=W&&W.length,Ae=fe({yAxis:he?lh(lh({},he),{},{ticks:be?W:he.ticks}):void 0,width:i,height:x,offset:S},be?!0:G);Tp(Array.isArray(Ae),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(lv(Ae),"]")),Array.isArray(Ae)&&(ye=Ae)}if((!pe||!pe.length)&&qi(ge)){var Oe=J&&J.length,ue=ge({xAxis:ie?lh(lh({},ie),{},{ticks:Oe?J:ie.ticks}):void 0,width:i,height:x,offset:S},Oe?!0:G);Tp(Array.isArray(ue),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(lv(ue),"]")),Array.isArray(ue)&&(pe=ue)}return kt.createElement("g",{className:"recharts-cartesian-grid"},kt.createElement(rSe,{fill:I.fill,fillOpacity:I.fillOpacity,x:I.x,y:I.y,width:I.width,height:I.height,ry:I.ry}),kt.createElement(iSe,U_({},I,{offset:S,horizontalPoints:ye,xAxis:ie,yAxis:he})),kt.createElement(aSe,U_({},I,{offset:S,verticalPoints:pe,xAxis:ie,yAxis:he})),kt.createElement(sSe,U_({},I,{horizontalPoints:ye})),kt.createElement(oSe,U_({},I,{verticalPoints:pe})))}dm.displayName="CartesianGrid";var uSe=["type","layout","connectNulls","ref"],hSe=["key"];function b1(t){"@babel/helpers - typeof";return b1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b1(t)}function oV(t,e){if(t==null)return{};var n=fSe(t,e),r,s;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(s=0;s<l.length;s++)r=l[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function fSe(t,e){if(t==null)return{};var n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;n[r]=t[r]}return n}function Bx(){return Bx=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Bx.apply(this,arguments)}function lV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function Zf(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?lV(Object(n),!0).forEach(function(r){Sp(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):lV(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function u0(t){return gSe(t)||mSe(t)||pSe(t)||dSe()}function dSe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function pSe(t,e){if(t){if(typeof t=="string")return sD(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return sD(t,e)}}function mSe(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function gSe(t){if(Array.isArray(t))return sD(t)}function sD(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function ySe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function cV(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,wZ(r.key),r)}}function _Se(t,e,n){return e&&cV(t.prototype,e),n&&cV(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function vSe(t,e,n){return e=o5(e),bSe(t,xZ()?Reflect.construct(e,n||[],o5(t).constructor):e.apply(t,n))}function bSe(t,e){if(e&&(b1(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return xSe(t)}function xSe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function xZ(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(xZ=function(){return!!t})()}function o5(t){return o5=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},o5(t)}function wSe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&oD(t,e)}function oD(t,e){return oD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},oD(t,e)}function Sp(t,e,n){return e=wZ(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function wZ(t){var e=SSe(t,"string");return b1(e)=="symbol"?e:e+""}function SSe(t,e){if(b1(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(b1(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var E2=function(t){function e(){var n;ySe(this,e);for(var r=arguments.length,s=new Array(r),l=0;l<r;l++)s[l]=arguments[l];return n=vSe(this,e,[].concat(s)),Sp(n,"state",{isAnimationFinished:!0,totalLength:0}),Sp(n,"generateSimpleStrokeDasharray",function(f,i){return"".concat(i,"px ").concat(f-i,"px")}),Sp(n,"getStrokeDasharray",function(f,i,x){var S=x.reduce(function(J,ie){return J+ie});if(!S)return n.generateSimpleStrokeDasharray(i,f);for(var I=Math.floor(f/S),R=f%S,F=i-f,j=[],H=0,G=0;H<x.length;G+=x[H],++H)if(G+x[H]>R){j=[].concat(u0(x.slice(0,H)),[R-G]);break}var W=j.length%2===0?[0,F]:[F];return[].concat(u0(e.repeat(x,I)),u0(j),W).map(function(J){return"".concat(J,"px")}).join(", ")}),Sp(n,"id",mv("recharts-line-")),Sp(n,"pathRef",function(f){n.mainCurve=f}),Sp(n,"handleAnimationEnd",function(){n.setState({isAnimationFinished:!0}),n.props.onAnimationEnd&&n.props.onAnimationEnd()}),Sp(n,"handleAnimationStart",function(){n.setState({isAnimationFinished:!1}),n.props.onAnimationStart&&n.props.onAnimationStart()}),n}return wSe(e,t),_Se(e,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var r=this.getTotalLength();this.setState({totalLength:r})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var r=this.getTotalLength();r!==this.state.totalLength&&this.setState({totalLength:r})}}},{key:"getTotalLength",value:function(){var r=this.mainCurve;try{return r&&r.getTotalLength&&r.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(r,s){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var l=this.props,f=l.points,i=l.xAxis,x=l.yAxis,S=l.layout,I=l.children,R=od(I,A2);if(!R)return null;var F=function(G,W){return{x:G.x,y:G.y,value:G.value,errorVal:jl(G.payload,W)}},j={clipPath:r?"url(#clipPath-".concat(s,")"):null};return kt.createElement(Na,j,R.map(function(H){return kt.cloneElement(H,{key:"bar-".concat(H.props.dataKey),data:f,xAxis:i,yAxis:x,layout:S,dataPointFormatter:F})}))}},{key:"renderDots",value:function(r,s,l){var f=this.props.isAnimationActive;if(f&&!this.state.isAnimationFinished)return null;var i=this.props,x=i.dot,S=i.points,I=i.dataKey,R=di(this.props,!1),F=di(x,!0),j=S.map(function(G,W){var J=Zf(Zf(Zf({key:"dot-".concat(W),r:3},R),F),{},{value:G.value,dataKey:I,cx:G.x,cy:G.y,index:W,payload:G.payload});return e.renderDotItem(x,J)}),H={clipPath:r?"url(#clipPath-".concat(s?"":"dots-").concat(l,")"):null};return kt.createElement(Na,Bx({className:"recharts-line-dots",key:"dots"},H),j)}},{key:"renderCurveStatically",value:function(r,s,l,f){var i=this.props,x=i.type,S=i.layout,I=i.connectNulls;i.ref;var R=oV(i,uSe),F=Zf(Zf(Zf({},di(R,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:s?"url(#clipPath-".concat(l,")"):null,points:r},f),{},{type:x,layout:S,connectNulls:I});return kt.createElement(K_,Bx({},F,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(r,s){var l=this,f=this.props,i=f.points,x=f.strokeDasharray,S=f.isAnimationActive,I=f.animationBegin,R=f.animationDuration,F=f.animationEasing,j=f.animationId,H=f.animateNewValues,G=f.width,W=f.height,J=this.state,ie=J.prevPoints,he=J.totalLength;return kt.createElement(Op,{begin:I,duration:R,isActive:S,easing:F,from:{t:0},to:{t:1},key:"line-".concat(j),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(ge){var fe=ge.t;if(ie){var ye=ie.length/i.length,pe=i.map(function(we,ke){var De=Math.floor(ke*ye);if(ie[De]){var je=ie[De],ze=Dc(je.x,we.x),Ue=Dc(je.y,we.y);return Zf(Zf({},we),{},{x:ze(fe),y:Ue(fe)})}if(H){var Fe=Dc(G*2,we.x),Qe=Dc(W/2,we.y);return Zf(Zf({},we),{},{x:Fe(fe),y:Qe(fe)})}return Zf(Zf({},we),{},{x:we.x,y:we.y})});return l.renderCurveStatically(pe,r,s)}var be=Dc(0,he),Ae=be(fe),Oe;if(x){var ue="".concat(x).split(/[,\s]+/gim).map(function(we){return parseFloat(we)});Oe=l.getStrokeDasharray(Ae,he,ue)}else Oe=l.generateSimpleStrokeDasharray(he,Ae);return l.renderCurveStatically(i,r,s,{strokeDasharray:Oe})})}},{key:"renderCurve",value:function(r,s){var l=this.props,f=l.points,i=l.isAnimationActive,x=this.state,S=x.prevPoints,I=x.totalLength;return i&&f&&f.length&&(!S&&I>0||!av(S,f))?this.renderCurveWithAnimation(r,s):this.renderCurveStatically(f,r,s)}},{key:"render",value:function(){var r,s=this.props,l=s.hide,f=s.dot,i=s.points,x=s.className,S=s.xAxis,I=s.yAxis,R=s.top,F=s.left,j=s.width,H=s.height,G=s.isAnimationActive,W=s.id;if(l||!i||!i.length)return null;var J=this.state.isAnimationFinished,ie=i.length===1,he=fa("recharts-line",x),ge=S&&S.allowDataOverflow,fe=I&&I.allowDataOverflow,ye=ge||fe,pe=aa(W)?this.id:W,be=(r=di(f,!1))!==null&&r!==void 0?r:{r:3,strokeWidth:2},Ae=be.r,Oe=Ae===void 0?3:Ae,ue=be.strokeWidth,we=ue===void 0?2:ue,ke=SK(f)?f:{},De=ke.clipDot,je=De===void 0?!0:De,ze=Oe*2+we;return kt.createElement(Na,{className:he},ge||fe?kt.createElement("defs",null,kt.createElement("clipPath",{id:"clipPath-".concat(pe)},kt.createElement("rect",{x:ge?F:F-j/2,y:fe?R:R-H/2,width:ge?j:j*2,height:fe?H:H*2})),!je&&kt.createElement("clipPath",{id:"clipPath-dots-".concat(pe)},kt.createElement("rect",{x:F-ze/2,y:R-ze/2,width:j+ze,height:H+ze}))):null,!ie&&this.renderCurve(ye,pe),this.renderErrorBar(ye,pe),(ie||f)&&this.renderDots(ye,je,pe),(!G||J)&&Ep.renderCallByParent(this.props,i))}}],[{key:"getDerivedStateFromProps",value:function(r,s){return r.animationId!==s.prevAnimationId?{prevAnimationId:r.animationId,curPoints:r.points,prevPoints:s.curPoints}:r.points!==s.curPoints?{curPoints:r.points}:null}},{key:"repeat",value:function(r,s){for(var l=r.length%2!==0?[].concat(u0(r),[0]):r,f=[],i=0;i<s;++i)f=[].concat(u0(f),u0(l));return f}},{key:"renderDotItem",value:function(r,s){var l;if(kt.isValidElement(r))l=kt.cloneElement(r,s);else if(qi(r))l=r(s);else{var f=s.key,i=oV(s,hSe),x=fa("recharts-line-dot",typeof r!="boolean"?r.className:"");l=kt.createElement(T2,Bx({key:f},i,{className:x}))}return l}}])}(st.PureComponent);Sp(E2,"displayName","Line");Sp(E2,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!Ny.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});Sp(E2,"getComposedData",function(t){var e=t.props,n=t.xAxis,r=t.yAxis,s=t.xAxisTicks,l=t.yAxisTicks,f=t.dataKey,i=t.bandSize,x=t.displayedData,S=t.offset,I=e.layout,R=x.map(function(F,j){var H=jl(F,f);return I==="horizontal"?{x:BT({axis:n,ticks:s,bandSize:i,entry:F,index:j}),y:aa(H)?null:r.scale(H),value:H,payload:F}:{x:aa(H)?null:n.scale(H),y:BT({axis:r,ticks:l,bandSize:i,entry:F,index:j}),value:H,payload:F}});return Zf({points:R,layout:I},S)});var ASe=["layout","type","stroke","connectNulls","isRange","ref"],TSe=["key"],SZ;function x1(t){"@babel/helpers - typeof";return x1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},x1(t)}function AZ(t,e){if(t==null)return{};var n=ESe(t,e),r,s;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(s=0;s<l.length;s++)r=l[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function ESe(t,e){if(t==null)return{};var n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;n[r]=t[r]}return n}function q_(){return q_=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},q_.apply(this,arguments)}function uV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function uy(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?uV(Object(n),!0).forEach(function(r){_m(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):uV(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function MSe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function hV(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,EZ(r.key),r)}}function CSe(t,e,n){return e&&hV(t.prototype,e),n&&hV(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function ISe(t,e,n){return e=l5(e),PSe(t,TZ()?Reflect.construct(e,n||[],l5(t).constructor):e.apply(t,n))}function PSe(t,e){if(e&&(x1(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return OSe(t)}function OSe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function TZ(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(TZ=function(){return!!t})()}function l5(t){return l5=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},l5(t)}function RSe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&lD(t,e)}function lD(t,e){return lD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},lD(t,e)}function _m(t,e,n){return e=EZ(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function EZ(t){var e=DSe(t,"string");return x1(e)=="symbol"?e:e+""}function DSe(t,e){if(x1(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(x1(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var jd=function(t){function e(){var n;MSe(this,e);for(var r=arguments.length,s=new Array(r),l=0;l<r;l++)s[l]=arguments[l];return n=ISe(this,e,[].concat(s)),_m(n,"state",{isAnimationFinished:!0}),_m(n,"id",mv("recharts-area-")),_m(n,"handleAnimationEnd",function(){var f=n.props.onAnimationEnd;n.setState({isAnimationFinished:!0}),qi(f)&&f()}),_m(n,"handleAnimationStart",function(){var f=n.props.onAnimationStart;n.setState({isAnimationFinished:!1}),qi(f)&&f()}),n}return RSe(e,t),CSe(e,[{key:"renderDots",value:function(r,s,l){var f=this.props.isAnimationActive,i=this.state.isAnimationFinished;if(f&&!i)return null;var x=this.props,S=x.dot,I=x.points,R=x.dataKey,F=di(this.props,!1),j=di(S,!0),H=I.map(function(W,J){var ie=uy(uy(uy({key:"dot-".concat(J),r:3},F),j),{},{index:J,cx:W.x,cy:W.y,dataKey:R,value:W.value,payload:W.payload,points:I});return e.renderDotItem(S,ie)}),G={clipPath:r?"url(#clipPath-".concat(s?"":"dots-").concat(l,")"):null};return kt.createElement(Na,q_({className:"recharts-area-dots"},G),H)}},{key:"renderHorizontalRect",value:function(r){var s=this.props,l=s.baseLine,f=s.points,i=s.strokeWidth,x=f[0].x,S=f[f.length-1].x,I=r*Math.abs(x-S),R=_y(f.map(function(F){return F.y||0}));return gr(l)&&typeof l=="number"?R=Math.max(l,R):l&&Array.isArray(l)&&l.length&&(R=Math.max(_y(l.map(function(F){return F.y||0})),R)),gr(R)?kt.createElement("rect",{x:x<S?x:x-I,y:0,width:I,height:Math.floor(R+(i?parseInt("".concat(i),10):1))}):null}},{key:"renderVerticalRect",value:function(r){var s=this.props,l=s.baseLine,f=s.points,i=s.strokeWidth,x=f[0].y,S=f[f.length-1].y,I=r*Math.abs(x-S),R=_y(f.map(function(F){return F.x||0}));return gr(l)&&typeof l=="number"?R=Math.max(l,R):l&&Array.isArray(l)&&l.length&&(R=Math.max(_y(l.map(function(F){return F.x||0})),R)),gr(R)?kt.createElement("rect",{x:0,y:x<S?x:x-I,width:R+(i?parseInt("".concat(i),10):1),height:Math.floor(I)}):null}},{key:"renderClipRect",value:function(r){var s=this.props.layout;return s==="vertical"?this.renderVerticalRect(r):this.renderHorizontalRect(r)}},{key:"renderAreaStatically",value:function(r,s,l,f){var i=this.props,x=i.layout,S=i.type,I=i.stroke,R=i.connectNulls,F=i.isRange;i.ref;var j=AZ(i,ASe);return kt.createElement(Na,{clipPath:l?"url(#clipPath-".concat(f,")"):null},kt.createElement(K_,q_({},di(j,!0),{points:r,connectNulls:R,type:S,baseLine:s,layout:x,stroke:"none",className:"recharts-area-area"})),I!=="none"&&kt.createElement(K_,q_({},di(this.props,!1),{className:"recharts-area-curve",layout:x,type:S,connectNulls:R,fill:"none",points:r})),I!=="none"&&F&&kt.createElement(K_,q_({},di(this.props,!1),{className:"recharts-area-curve",layout:x,type:S,connectNulls:R,fill:"none",points:s})))}},{key:"renderAreaWithAnimation",value:function(r,s){var l=this,f=this.props,i=f.points,x=f.baseLine,S=f.isAnimationActive,I=f.animationBegin,R=f.animationDuration,F=f.animationEasing,j=f.animationId,H=this.state,G=H.prevPoints,W=H.prevBaseLine;return kt.createElement(Op,{begin:I,duration:R,isActive:S,easing:F,from:{t:0},to:{t:1},key:"area-".concat(j),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(J){var ie=J.t;if(G){var he=G.length/i.length,ge=i.map(function(be,Ae){var Oe=Math.floor(Ae*he);if(G[Oe]){var ue=G[Oe],we=Dc(ue.x,be.x),ke=Dc(ue.y,be.y);return uy(uy({},be),{},{x:we(ie),y:ke(ie)})}return be}),fe;if(gr(x)&&typeof x=="number"){var ye=Dc(W,x);fe=ye(ie)}else if(aa(x)||B1(x)){var pe=Dc(W,0);fe=pe(ie)}else fe=x.map(function(be,Ae){var Oe=Math.floor(Ae*he);if(W[Oe]){var ue=W[Oe],we=Dc(ue.x,be.x),ke=Dc(ue.y,be.y);return uy(uy({},be),{},{x:we(ie),y:ke(ie)})}return be});return l.renderAreaStatically(ge,fe,r,s)}return kt.createElement(Na,null,kt.createElement("defs",null,kt.createElement("clipPath",{id:"animationClipPath-".concat(s)},l.renderClipRect(ie))),kt.createElement(Na,{clipPath:"url(#animationClipPath-".concat(s,")")},l.renderAreaStatically(i,x,r,s)))})}},{key:"renderArea",value:function(r,s){var l=this.props,f=l.points,i=l.baseLine,x=l.isAnimationActive,S=this.state,I=S.prevPoints,R=S.prevBaseLine,F=S.totalLength;return x&&f&&f.length&&(!I&&F>0||!av(I,f)||!av(R,i))?this.renderAreaWithAnimation(r,s):this.renderAreaStatically(f,i,r,s)}},{key:"render",value:function(){var r,s=this.props,l=s.hide,f=s.dot,i=s.points,x=s.className,S=s.top,I=s.left,R=s.xAxis,F=s.yAxis,j=s.width,H=s.height,G=s.isAnimationActive,W=s.id;if(l||!i||!i.length)return null;var J=this.state.isAnimationFinished,ie=i.length===1,he=fa("recharts-area",x),ge=R&&R.allowDataOverflow,fe=F&&F.allowDataOverflow,ye=ge||fe,pe=aa(W)?this.id:W,be=(r=di(f,!1))!==null&&r!==void 0?r:{r:3,strokeWidth:2},Ae=be.r,Oe=Ae===void 0?3:Ae,ue=be.strokeWidth,we=ue===void 0?2:ue,ke=SK(f)?f:{},De=ke.clipDot,je=De===void 0?!0:De,ze=Oe*2+we;return kt.createElement(Na,{className:he},ge||fe?kt.createElement("defs",null,kt.createElement("clipPath",{id:"clipPath-".concat(pe)},kt.createElement("rect",{x:ge?I:I-j/2,y:fe?S:S-H/2,width:ge?j:j*2,height:fe?H:H*2})),!je&&kt.createElement("clipPath",{id:"clipPath-dots-".concat(pe)},kt.createElement("rect",{x:I-ze/2,y:S-ze/2,width:j+ze,height:H+ze}))):null,ie?null:this.renderArea(ye,pe),(f||ie)&&this.renderDots(ye,je,pe),(!G||J)&&Ep.renderCallByParent(this.props,i))}}],[{key:"getDerivedStateFromProps",value:function(r,s){return r.animationId!==s.prevAnimationId?{prevAnimationId:r.animationId,curPoints:r.points,curBaseLine:r.baseLine,prevPoints:s.curPoints,prevBaseLine:s.curBaseLine}:r.points!==s.curPoints||r.baseLine!==s.curBaseLine?{curPoints:r.points,curBaseLine:r.baseLine}:null}}])}(st.PureComponent);SZ=jd;_m(jd,"displayName","Area");_m(jd,"defaultProps",{stroke:"#3182bd",fill:"#3182bd",fillOpacity:.6,xAxisId:0,yAxisId:0,legendType:"line",connectNulls:!1,points:[],dot:!1,activeDot:!0,hide:!1,isAnimationActive:!Ny.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"ease"});_m(jd,"getBaseValue",function(t,e,n,r){var s=t.layout,l=t.baseValue,f=e.props.baseValue,i=f??l;if(gr(i)&&typeof i=="number")return i;var x=s==="horizontal"?r:n,S=x.scale.domain();if(x.type==="number"){var I=Math.max(S[0],S[1]),R=Math.min(S[0],S[1]);return i==="dataMin"?R:i==="dataMax"||I<0?I:Math.max(Math.min(S[0],S[1]),0)}return i==="dataMin"?S[0]:i==="dataMax"?S[1]:S[0]});_m(jd,"getComposedData",function(t){var e=t.props,n=t.item,r=t.xAxis,s=t.yAxis,l=t.xAxisTicks,f=t.yAxisTicks,i=t.bandSize,x=t.dataKey,S=t.stackedData,I=t.dataStartIndex,R=t.displayedData,F=t.offset,j=e.layout,H=S&&S.length,G=SZ.getBaseValue(e,n,r,s),W=j==="horizontal",J=!1,ie=R.map(function(ge,fe){var ye;H?ye=S[I+fe]:(ye=jl(ge,x),Array.isArray(ye)?J=!0:ye=[G,ye]);var pe=ye[1]==null||H&&jl(ge,x)==null;return W?{x:BT({axis:r,ticks:l,bandSize:i,entry:ge,index:fe}),y:pe?null:s.scale(ye[1]),value:ye,payload:ge}:{x:pe?null:r.scale(ye[1]),y:BT({axis:s,ticks:f,bandSize:i,entry:ge,index:fe}),value:ye,payload:ge}}),he;return H||J?he=ie.map(function(ge){var fe=Array.isArray(ge.value)?ge.value[0]:null;return W?{x:ge.x,y:fe!=null&&ge.y!=null?s.scale(fe):null}:{x:fe!=null?r.scale(fe):null,y:ge.y}}):he=W?s.scale(G):r.scale(G),uy({points:ie,baseLine:he,layout:j,isRange:J},F)});_m(jd,"renderDotItem",function(t,e){var n;if(kt.isValidElement(t))n=kt.cloneElement(t,e);else if(qi(t))n=t(e);else{var r=fa("recharts-area-dot",typeof t!="boolean"?t.className:""),s=e.key,l=AZ(e,TSe);n=kt.createElement(T2,q_({},l,{key:s,className:r}))}return n});function w1(t){"@babel/helpers - typeof";return w1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w1(t)}function LSe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function kSe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,IZ(r.key),r)}}function NSe(t,e,n){return e&&kSe(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function zSe(t,e,n){return e=c5(e),BSe(t,MZ()?Reflect.construct(e,n||[],c5(t).constructor):e.apply(t,n))}function BSe(t,e){if(e&&(w1(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return jSe(t)}function jSe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function MZ(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(MZ=function(){return!!t})()}function c5(t){return c5=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},c5(t)}function FSe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&cD(t,e)}function cD(t,e){return cD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},cD(t,e)}function CZ(t,e,n){return e=IZ(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function IZ(t){var e=USe(t,"string");return w1(e)=="symbol"?e:e+""}function USe(t,e){if(w1(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(w1(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function uD(){return uD=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},uD.apply(this,arguments)}function qSe(t){var e=t.xAxisId,n=aN(),r=sN(),s=cZ(e);return s==null?null:kt.createElement(V1,uD({},s,{className:fa("recharts-".concat(s.axisType," ").concat(s.axisType),s.className),viewBox:{x:0,y:0,width:n,height:r},ticksGenerator:function(f){return sg(f,!0)}}))}var wf=function(t){function e(){return LSe(this,e),zSe(this,e,arguments)}return FSe(e,t),NSe(e,[{key:"render",value:function(){return kt.createElement(qSe,this.props)}}])}(kt.Component);CZ(wf,"displayName","XAxis");CZ(wf,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function S1(t){"@babel/helpers - typeof";return S1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S1(t)}function VSe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function $Se(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,RZ(r.key),r)}}function HSe(t,e,n){return e&&$Se(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function GSe(t,e,n){return e=u5(e),WSe(t,PZ()?Reflect.construct(e,n||[],u5(t).constructor):e.apply(t,n))}function WSe(t,e){if(e&&(S1(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return KSe(t)}function KSe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function PZ(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(PZ=function(){return!!t})()}function u5(t){return u5=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},u5(t)}function YSe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&hD(t,e)}function hD(t,e){return hD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},hD(t,e)}function OZ(t,e,n){return e=RZ(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function RZ(t){var e=XSe(t,"string");return S1(e)=="symbol"?e:e+""}function XSe(t,e){if(S1(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(S1(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function fD(){return fD=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},fD.apply(this,arguments)}var ZSe=function(e){var n=e.yAxisId,r=aN(),s=sN(),l=uZ(n);return l==null?null:kt.createElement(V1,fD({},l,{className:fa("recharts-".concat(l.axisType," ").concat(l.axisType),l.className),viewBox:{x:0,y:0,width:r,height:s},ticksGenerator:function(i){return sg(i,!0)}}))},Sf=function(t){function e(){return VSe(this,e),GSe(this,e,arguments)}return YSe(e,t),HSe(e,[{key:"render",value:function(){return kt.createElement(ZSe,this.props)}}])}(kt.Component);OZ(Sf,"displayName","YAxis");OZ(Sf,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function fV(t){return tAe(t)||eAe(t)||QSe(t)||JSe()}function JSe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function QSe(t,e){if(t){if(typeof t=="string")return dD(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return dD(t,e)}}function eAe(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function tAe(t){if(Array.isArray(t))return dD(t)}function dD(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var pD=function(e,n,r,s,l){var f=od(e,lN),i=od(e,LE),x=[].concat(fV(f),fV(i)),S=od(e,NE),I="".concat(s,"Id"),R=s[0],F=n;if(x.length&&(F=x.reduce(function(G,W){if(W.props[I]===r&&Am(W.props,"extendDomain")&&gr(W.props[R])){var J=W.props[R];return[Math.min(G[0],J),Math.max(G[1],J)]}return G},F)),S.length){var j="".concat(R,"1"),H="".concat(R,"2");F=S.reduce(function(G,W){if(W.props[I]===r&&Am(W.props,"extendDomain")&&gr(W.props[j])&&gr(W.props[H])){var J=W.props[j],ie=W.props[H];return[Math.min(G[0],J,ie),Math.max(G[1],J,ie)]}return G},F)}return l&&l.length&&(F=l.reduce(function(G,W){return gr(W)?[Math.min(G[0],W),Math.max(G[1],W)]:G},F)),F},TO={exports:{}},dV;function nAe(){return dV||(dV=1,function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1));function s(x,S,I){this.fn=x,this.context=S,this.once=I||!1}function l(x,S,I,R,F){if(typeof I!="function")throw new TypeError("The listener must be a function");var j=new s(I,R||x,F),H=n?n+S:S;return x._events[H]?x._events[H].fn?x._events[H]=[x._events[H],j]:x._events[H].push(j):(x._events[H]=j,x._eventsCount++),x}function f(x,S){--x._eventsCount===0?x._events=new r:delete x._events[S]}function i(){this._events=new r,this._eventsCount=0}i.prototype.eventNames=function(){var S=[],I,R;if(this._eventsCount===0)return S;for(R in I=this._events)e.call(I,R)&&S.push(n?R.slice(1):R);return Object.getOwnPropertySymbols?S.concat(Object.getOwnPropertySymbols(I)):S},i.prototype.listeners=function(S){var I=n?n+S:S,R=this._events[I];if(!R)return[];if(R.fn)return[R.fn];for(var F=0,j=R.length,H=new Array(j);F<j;F++)H[F]=R[F].fn;return H},i.prototype.listenerCount=function(S){var I=n?n+S:S,R=this._events[I];return R?R.fn?1:R.length:0},i.prototype.emit=function(S,I,R,F,j,H){var G=n?n+S:S;if(!this._events[G])return!1;var W=this._events[G],J=arguments.length,ie,he;if(W.fn){switch(W.once&&this.removeListener(S,W.fn,void 0,!0),J){case 1:return W.fn.call(W.context),!0;case 2:return W.fn.call(W.context,I),!0;case 3:return W.fn.call(W.context,I,R),!0;case 4:return W.fn.call(W.context,I,R,F),!0;case 5:return W.fn.call(W.context,I,R,F,j),!0;case 6:return W.fn.call(W.context,I,R,F,j,H),!0}for(he=1,ie=new Array(J-1);he<J;he++)ie[he-1]=arguments[he];W.fn.apply(W.context,ie)}else{var ge=W.length,fe;for(he=0;he<ge;he++)switch(W[he].once&&this.removeListener(S,W[he].fn,void 0,!0),J){case 1:W[he].fn.call(W[he].context);break;case 2:W[he].fn.call(W[he].context,I);break;case 3:W[he].fn.call(W[he].context,I,R);break;case 4:W[he].fn.call(W[he].context,I,R,F);break;default:if(!ie)for(fe=1,ie=new Array(J-1);fe<J;fe++)ie[fe-1]=arguments[fe];W[he].fn.apply(W[he].context,ie)}}return!0},i.prototype.on=function(S,I,R){return l(this,S,I,R,!1)},i.prototype.once=function(S,I,R){return l(this,S,I,R,!0)},i.prototype.removeListener=function(S,I,R,F){var j=n?n+S:S;if(!this._events[j])return this;if(!I)return f(this,j),this;var H=this._events[j];if(H.fn)H.fn===I&&(!F||H.once)&&(!R||H.context===R)&&f(this,j);else{for(var G=0,W=[],J=H.length;G<J;G++)(H[G].fn!==I||F&&!H[G].once||R&&H[G].context!==R)&&W.push(H[G]);W.length?this._events[j]=W.length===1?W[0]:W:f(this,j)}return this},i.prototype.removeAllListeners=function(S){var I;return S?(I=n?n+S:S,this._events[I]&&f(this,I)):(this._events=new r,this._eventsCount=0),this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prefixed=n,i.EventEmitter=i,t.exports=i}(TO)),TO.exports}var rAe=nAe();const iAe=Xa(rAe);var EO=new iAe,MO="recharts.syncMouseEvents";function jw(t){"@babel/helpers - typeof";return jw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jw(t)}function aAe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function sAe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,DZ(r.key),r)}}function oAe(t,e,n){return e&&sAe(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function CO(t,e,n){return e=DZ(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function DZ(t){var e=lAe(t,"string");return jw(e)=="symbol"?e:e+""}function lAe(t,e){if(jw(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(jw(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var cAe=function(){function t(){aAe(this,t),CO(this,"activeIndex",0),CO(this,"coordinateList",[]),CO(this,"layout","horizontal")}return oAe(t,[{key:"setDetails",value:function(n){var r,s=n.coordinateList,l=s===void 0?null:s,f=n.container,i=f===void 0?null:f,x=n.layout,S=x===void 0?null:x,I=n.offset,R=I===void 0?null:I,F=n.mouseHandlerCallback,j=F===void 0?null:F;this.coordinateList=(r=l??this.coordinateList)!==null&&r!==void 0?r:[],this.container=i??this.container,this.layout=S??this.layout,this.offset=R??this.offset,this.mouseHandlerCallback=j??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(n){if(this.coordinateList.length!==0)switch(n.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(n){this.activeIndex=n}},{key:"spoofMouse",value:function(){var n,r;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var s=this.container.getBoundingClientRect(),l=s.x,f=s.y,i=s.height,x=this.coordinateList[this.activeIndex].coordinate,S=((n=window)===null||n===void 0?void 0:n.scrollX)||0,I=((r=window)===null||r===void 0?void 0:r.scrollY)||0,R=l+x+S,F=f+this.offset.top+i/2+I;this.mouseHandlerCallback({pageX:R,pageY:F})}}}])}();function uAe(t,e,n){if(n==="number"&&e===!0&&Array.isArray(t)){var r=t==null?void 0:t[0],s=t==null?void 0:t[1];if(r&&s&&gr(r)&&gr(s))return!0}return!1}function hAe(t,e,n,r){var s=r/2;return{stroke:"none",fill:"#ccc",x:t==="horizontal"?e.x-s:n.left+.5,y:t==="horizontal"?n.top+.5:e.y-s,width:t==="horizontal"?r:n.width-1,height:t==="horizontal"?n.height-1:r}}function LZ(t){var e=t.cx,n=t.cy,r=t.radius,s=t.startAngle,l=t.endAngle,f=bo(e,n,r,s),i=bo(e,n,r,l);return{points:[f,i],cx:e,cy:n,radius:r,startAngle:s,endAngle:l}}function fAe(t,e,n){var r,s,l,f;if(t==="horizontal")r=e.x,l=r,s=n.top,f=n.top+n.height;else if(t==="vertical")s=e.y,f=s,r=n.left,l=n.left+n.width;else if(e.cx!=null&&e.cy!=null)if(t==="centric"){var i=e.cx,x=e.cy,S=e.innerRadius,I=e.outerRadius,R=e.angle,F=bo(i,x,S,R),j=bo(i,x,I,R);r=F.x,s=F.y,l=j.x,f=j.y}else return LZ(e);return[{x:r,y:s},{x:l,y:f}]}function Fw(t){"@babel/helpers - typeof";return Fw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fw(t)}function pV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function lA(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?pV(Object(n),!0).forEach(function(r){dAe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):pV(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function dAe(t,e,n){return e=pAe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function pAe(t){var e=mAe(t,"string");return Fw(e)=="symbol"?e:e+""}function mAe(t,e){if(Fw(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(Fw(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function gAe(t){var e,n,r=t.element,s=t.tooltipEventType,l=t.isActive,f=t.activeCoordinate,i=t.activePayload,x=t.offset,S=t.activeTooltipIndex,I=t.tooltipAxisBandSize,R=t.layout,F=t.chartName,j=(e=r.props.cursor)!==null&&e!==void 0?e:(n=r.type.defaultProps)===null||n===void 0?void 0:n.cursor;if(!r||!j||!l||!f||F!=="ScatterChart"&&s!=="axis")return null;var H,G=K_;if(F==="ScatterChart")H=f,G=Mbe;else if(F==="BarChart")H=hAe(R,f,x,I),G=eN;else if(R==="radial"){var W=LZ(f),J=W.cx,ie=W.cy,he=W.radius,ge=W.startAngle,fe=W.endAngle;H={cx:J,cy:ie,startAngle:ge,endAngle:fe,innerRadius:he,outerRadius:he},G=RX}else H={points:fAe(R,f,x)},G=K_;var ye=lA(lA(lA(lA({stroke:"#ccc",pointerEvents:"none"},x),H),di(j,!1)),{},{payload:i,payloadIndex:S,className:fa("recharts-tooltip-cursor",j.className)});return st.isValidElement(j)?st.cloneElement(j,ye):st.createElement(G,ye)}var yAe=["item"],_Ae=["children","className","width","height","style","compact","title","desc"];function A1(t){"@babel/helpers - typeof";return A1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A1(t)}function M0(){return M0=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},M0.apply(this,arguments)}function mV(t,e){return xAe(t)||bAe(t,e)||NZ(t,e)||vAe()}function vAe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function bAe(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r,s,l,f,i=[],x=!0,S=!1;try{if(l=(n=n.call(t)).next,e!==0)for(;!(x=(r=l.call(n)).done)&&(i.push(r.value),i.length!==e);x=!0);}catch(I){S=!0,s=I}finally{try{if(!x&&n.return!=null&&(f=n.return(),Object(f)!==f))return}finally{if(S)throw s}}return i}}function xAe(t){if(Array.isArray(t))return t}function gV(t,e){if(t==null)return{};var n=wAe(t,e),r,s;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(s=0;s<l.length;s++)r=l[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function wAe(t,e){if(t==null)return{};var n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;n[r]=t[r]}return n}function SAe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function AAe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,zZ(r.key),r)}}function TAe(t,e,n){return e&&AAe(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function EAe(t,e,n){return e=h5(e),MAe(t,kZ()?Reflect.construct(e,n||[],h5(t).constructor):e.apply(t,n))}function MAe(t,e){if(e&&(A1(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return CAe(t)}function CAe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function kZ(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(kZ=function(){return!!t})()}function h5(t){return h5=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},h5(t)}function IAe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&mD(t,e)}function mD(t,e){return mD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},mD(t,e)}function T1(t){return RAe(t)||OAe(t)||NZ(t)||PAe()}function PAe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function NZ(t,e){if(t){if(typeof t=="string")return gD(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return gD(t,e)}}function OAe(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function RAe(t){if(Array.isArray(t))return gD(t)}function gD(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function yV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function Wn(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?yV(Object(n),!0).forEach(function(r){Fi(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):yV(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Fi(t,e,n){return e=zZ(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function zZ(t){var e=DAe(t,"string");return A1(e)=="symbol"?e:e+""}function DAe(t,e){if(A1(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(A1(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var LAe={xAxis:["bottom","top"],yAxis:["left","right"]},kAe={width:"100%",height:"100%"},BZ={x:0,y:0};function cA(t){return t}var NAe=function(e,n){return n==="horizontal"?e.x:n==="vertical"?e.y:n==="centric"?e.angle:e.radius},zAe=function(e,n,r,s){var l=n.find(function(I){return I&&I.index===r});if(l){if(e==="horizontal")return{x:l.coordinate,y:s.y};if(e==="vertical")return{x:s.x,y:l.coordinate};if(e==="centric"){var f=l.coordinate,i=s.radius;return Wn(Wn(Wn({},s),bo(s.cx,s.cy,i,f)),{},{angle:f,radius:i})}var x=l.coordinate,S=s.angle;return Wn(Wn(Wn({},s),bo(s.cx,s.cy,x,S)),{},{angle:S,radius:x})}return BZ},zE=function(e,n){var r=n.graphicalItems,s=n.dataStartIndex,l=n.dataEndIndex,f=(r??[]).reduce(function(i,x){var S=x.props.data;return S&&S.length?[].concat(T1(i),T1(S)):i},[]);return f.length>0?f:e&&e.length&&gr(s)&&gr(l)?e.slice(s,l+1):[]};function jZ(t){return t==="number"?[0,"auto"]:void 0}var yD=function(e,n,r,s){var l=e.graphicalItems,f=e.tooltipAxis,i=zE(n,e);return r<0||!l||!l.length||r>=i.length?null:l.reduce(function(x,S){var I,R=(I=S.props.data)!==null&&I!==void 0?I:n;R&&e.dataStartIndex+e.dataEndIndex!==0&&e.dataEndIndex-e.dataStartIndex>=r&&(R=R.slice(e.dataStartIndex,e.dataEndIndex+1));var F;if(f.dataKey&&!f.allowDuplicatedCategory){var j=R===void 0?i:R;F=dT(j,f.dataKey,s)}else F=R&&R[r]||i[r];return F?[].concat(T1(x),[EX(S,F)]):x},[])},_V=function(e,n,r,s){var l=s||{x:e.chartX,y:e.chartY},f=NAe(l,r),i=e.orderedTooltipTicks,x=e.tooltipAxis,S=e.tooltipTicks,I=J_e(f,i,S,x);if(I>=0&&S){var R=S[I]&&S[I].value,F=yD(e,n,I,R),j=zAe(r,i,I,l);return{activeTooltipIndex:I,activeLabel:R,activePayload:F,activeCoordinate:j}}return null},BAe=function(e,n){var r=n.axes,s=n.graphicalItems,l=n.axisType,f=n.axisIdKey,i=n.stackGroups,x=n.dataStartIndex,S=n.dataEndIndex,I=e.layout,R=e.children,F=e.stackOffset,j=bX(I,l);return r.reduce(function(H,G){var W,J=G.type.defaultProps!==void 0?Wn(Wn({},G.type.defaultProps),G.props):G.props,ie=J.type,he=J.dataKey,ge=J.allowDataOverflow,fe=J.allowDuplicatedCategory,ye=J.scale,pe=J.ticks,be=J.includeHidden,Ae=J[f];if(H[Ae])return H;var Oe=zE(e.data,{graphicalItems:s.filter(function(xe){var Le,Xe=f in xe.props?xe.props[f]:(Le=xe.type.defaultProps)===null||Le===void 0?void 0:Le[f];return Xe===Ae}),dataStartIndex:x,dataEndIndex:S}),ue=Oe.length,we,ke,De;uAe(J.domain,ge,ie)&&(we=PR(J.domain,null,ge),j&&(ie==="number"||ye!=="auto")&&(De=Lx(Oe,he,"category")));var je=jZ(ie);if(!we||we.length===0){var ze,Ue=(ze=J.domain)!==null&&ze!==void 0?ze:je;if(he){if(we=Lx(Oe,he,ie),ie==="category"&&j){var Fe=Wue(we);fe&&Fe?(ke=we,we=ZT(0,ue)):fe||(we=g9(Ue,we,G).reduce(function(xe,Le){return xe.indexOf(Le)>=0?xe:[].concat(T1(xe),[Le])},[]))}else if(ie==="category")fe?we=we.filter(function(xe){return xe!==""&&!aa(xe)}):we=g9(Ue,we,G).reduce(function(xe,Le){return xe.indexOf(Le)>=0||Le===""||aa(Le)?xe:[].concat(T1(xe),[Le])},[]);else if(ie==="number"){var Qe=rve(Oe,s.filter(function(xe){var Le,Xe,ct=f in xe.props?xe.props[f]:(Le=xe.type.defaultProps)===null||Le===void 0?void 0:Le[f],vt="hide"in xe.props?xe.props.hide:(Xe=xe.type.defaultProps)===null||Xe===void 0?void 0:Xe.hide;return ct===Ae&&(be||!vt)}),he,l,I);Qe&&(we=Qe)}j&&(ie==="number"||ye!=="auto")&&(De=Lx(Oe,he,"category"))}else j?we=ZT(0,ue):i&&i[Ae]&&i[Ae].hasStack&&ie==="number"?we=F==="expand"?[0,1]:TX(i[Ae].stackGroups,x,S):we=vX(Oe,s.filter(function(xe){var Le=f in xe.props?xe.props[f]:xe.type.defaultProps[f],Xe="hide"in xe.props?xe.props.hide:xe.type.defaultProps.hide;return Le===Ae&&(be||!Xe)}),ie,I,!0);if(ie==="number")we=pD(R,we,Ae,l,pe),Ue&&(we=PR(Ue,we,ge));else if(ie==="category"&&Ue){var Be=Ue,bt=we.every(function(xe){return Be.indexOf(xe)>=0});bt&&(we=Be)}}return Wn(Wn({},H),{},Fi({},Ae,Wn(Wn({},J),{},{axisType:l,domain:we,categoricalDomain:De,duplicateDomain:ke,originalDomain:(W=J.domain)!==null&&W!==void 0?W:je,isCategorical:j,layout:I})))},{})},jAe=function(e,n){var r=n.graphicalItems,s=n.Axis,l=n.axisType,f=n.axisIdKey,i=n.stackGroups,x=n.dataStartIndex,S=n.dataEndIndex,I=e.layout,R=e.children,F=zE(e.data,{graphicalItems:r,dataStartIndex:x,dataEndIndex:S}),j=F.length,H=bX(I,l),G=-1;return r.reduce(function(W,J){var ie=J.type.defaultProps!==void 0?Wn(Wn({},J.type.defaultProps),J.props):J.props,he=ie[f],ge=jZ("number");if(!W[he]){G++;var fe;return H?fe=ZT(0,j):i&&i[he]&&i[he].hasStack?(fe=TX(i[he].stackGroups,x,S),fe=pD(R,fe,he,l)):(fe=PR(ge,vX(F,r.filter(function(ye){var pe,be,Ae=f in ye.props?ye.props[f]:(pe=ye.type.defaultProps)===null||pe===void 0?void 0:pe[f],Oe="hide"in ye.props?ye.props.hide:(be=ye.type.defaultProps)===null||be===void 0?void 0:be.hide;return Ae===he&&!Oe}),"number",I),s.defaultProps.allowDataOverflow),fe=pD(R,fe,he,l)),Wn(Wn({},W),{},Fi({},he,Wn(Wn({axisType:l},s.defaultProps),{},{hide:!0,orientation:sd(LAe,"".concat(l,".").concat(G%2),null),domain:fe,originalDomain:ge,isCategorical:H,layout:I})))}return W},{})},FAe=function(e,n){var r=n.axisType,s=r===void 0?"xAxis":r,l=n.AxisComp,f=n.graphicalItems,i=n.stackGroups,x=n.dataStartIndex,S=n.dataEndIndex,I=e.children,R="".concat(s,"Id"),F=od(I,l),j={};return F&&F.length?j=BAe(e,{axes:F,graphicalItems:f,axisType:s,axisIdKey:R,stackGroups:i,dataStartIndex:x,dataEndIndex:S}):f&&f.length&&(j=jAe(e,{Axis:l,graphicalItems:f,axisType:s,axisIdKey:R,stackGroups:i,dataStartIndex:x,dataEndIndex:S})),j},UAe=function(e){var n=gy(e),r=sg(n,!1,!0);return{tooltipTicks:r,orderedTooltipTicks:Mk(r,function(s){return s.coordinate}),tooltipAxis:n,tooltipAxisBandSize:jT(n,r)}},vV=function(e){var n=e.children,r=e.defaultShowTooltip,s=Qf(n,p1),l=0,f=0;return e.data&&e.data.length!==0&&(f=e.data.length-1),s&&s.props&&(s.props.startIndex>=0&&(l=s.props.startIndex),s.props.endIndex>=0&&(f=s.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:l,dataEndIndex:f,activeTooltipIndex:-1,isTooltipActive:!!r}},qAe=function(e){return!e||!e.length?!1:e.some(function(n){var r=cg(n&&n.type);return r&&r.indexOf("Bar")>=0})},bV=function(e){return e==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:e==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:e==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},VAe=function(e,n){var r=e.props,s=e.graphicalItems,l=e.xAxisMap,f=l===void 0?{}:l,i=e.yAxisMap,x=i===void 0?{}:i,S=r.width,I=r.height,R=r.children,F=r.margin||{},j=Qf(R,p1),H=Qf(R,Nd),G=Object.keys(x).reduce(function(fe,ye){var pe=x[ye],be=pe.orientation;return!pe.mirror&&!pe.hide?Wn(Wn({},fe),{},Fi({},be,fe[be]+pe.width)):fe},{left:F.left||0,right:F.right||0}),W=Object.keys(f).reduce(function(fe,ye){var pe=f[ye],be=pe.orientation;return!pe.mirror&&!pe.hide?Wn(Wn({},fe),{},Fi({},be,sd(fe,"".concat(be))+pe.height)):fe},{top:F.top||0,bottom:F.bottom||0}),J=Wn(Wn({},W),G),ie=J.bottom;j&&(J.bottom+=j.props.height||p1.defaultProps.height),H&&n&&(J=tve(J,s,r,n));var he=S-J.left-J.right,ge=I-J.top-J.bottom;return Wn(Wn({brushBottom:ie},J),{},{width:Math.max(he,0),height:Math.max(ge,0)})},$Ae=function(e,n){if(n==="xAxis")return e[n].width;if(n==="yAxis")return e[n].height},BE=function(e){var n=e.chartName,r=e.GraphicalChild,s=e.defaultTooltipEventType,l=s===void 0?"axis":s,f=e.validateTooltipEventTypes,i=f===void 0?["axis"]:f,x=e.axisComponents,S=e.legendContent,I=e.formatAxisMap,R=e.defaultProps,F=function(J,ie){var he=ie.graphicalItems,ge=ie.stackGroups,fe=ie.offset,ye=ie.updateId,pe=ie.dataStartIndex,be=ie.dataEndIndex,Ae=J.barSize,Oe=J.layout,ue=J.barGap,we=J.barCategoryGap,ke=J.maxBarSize,De=bV(Oe),je=De.numericAxisName,ze=De.cateAxisName,Ue=qAe(he),Fe=[];return he.forEach(function(Qe,Be){var bt=zE(J.data,{graphicalItems:[Qe],dataStartIndex:pe,dataEndIndex:be}),xe=Qe.type.defaultProps!==void 0?Wn(Wn({},Qe.type.defaultProps),Qe.props):Qe.props,Le=xe.dataKey,Xe=xe.maxBarSize,ct=xe["".concat(je,"Id")],vt=xe["".concat(ze,"Id")],Nt={},mt=x.reduce(function(hr,ur){var Ir=ie["".concat(ur.axisType,"Map")],Un=xe["".concat(ur.axisType,"Id")];Ir&&Ir[Un]||ur.axisType==="zAxis"||ov();var Vr=Ir[Un];return Wn(Wn({},hr),{},Fi(Fi({},ur.axisType,Vr),"".concat(ur.axisType,"Ticks"),sg(Vr)))},Nt),yt=mt[ze],_e=mt["".concat(ze,"Ticks")],on=ge&&ge[ct]&&ge[ct].hasStack&&fve(Qe,ge[ct].stackGroups),Kt=cg(Qe.type).indexOf("Bar")>=0,Pn=jT(yt,_e),Ut=[],cn=Ue&&Q_e({barSize:Ae,stackGroups:ge,totalSize:$Ae(mt,ze)});if(Kt){var At,xr,Rn=aa(Xe)?ke:Xe,Dn=(At=(xr=jT(yt,_e,!0))!==null&&xr!==void 0?xr:Rn)!==null&&At!==void 0?At:0;Ut=eve({barGap:ue,barCategoryGap:we,bandSize:Dn!==Pn?Dn:Pn,sizeList:cn[vt],maxBarSize:Rn}),Dn!==Pn&&(Ut=Ut.map(function(hr){return Wn(Wn({},hr),{},{position:Wn(Wn({},hr.position),{},{offset:hr.position.offset-Dn/2})})}))}var ar=Qe&&Qe.type&&Qe.type.getComposedData;ar&&Fe.push({props:Wn(Wn({},ar(Wn(Wn({},mt),{},{displayedData:bt,props:J,dataKey:Le,item:Qe,bandSize:Pn,barPosition:Ut,offset:fe,stackedData:on,layout:Oe,dataStartIndex:pe,dataEndIndex:be}))),{},Fi(Fi(Fi({key:Qe.key||"item-".concat(Be)},je,mt[je]),ze,mt[ze]),"animationId",ye)),childIndex:ihe(Qe,J.children),item:Qe})}),Fe},j=function(J,ie){var he=J.props,ge=J.dataStartIndex,fe=J.dataEndIndex,ye=J.updateId;if(!OF({props:he}))return null;var pe=he.children,be=he.layout,Ae=he.stackOffset,Oe=he.data,ue=he.reverseStackOrder,we=bV(be),ke=we.numericAxisName,De=we.cateAxisName,je=od(pe,r),ze=uve(Oe,je,"".concat(ke,"Id"),"".concat(De,"Id"),Ae,ue),Ue=x.reduce(function(xe,Le){var Xe="".concat(Le.axisType,"Map");return Wn(Wn({},xe),{},Fi({},Xe,FAe(he,Wn(Wn({},Le),{},{graphicalItems:je,stackGroups:Le.axisType===ke&&ze,dataStartIndex:ge,dataEndIndex:fe}))))},{}),Fe=VAe(Wn(Wn({},Ue),{},{props:he,graphicalItems:je}),ie==null?void 0:ie.legendBBox);Object.keys(Ue).forEach(function(xe){Ue[xe]=I(he,Ue[xe],Fe,xe.replace("Map",""),n)});var Qe=Ue["".concat(De,"Map")],Be=UAe(Qe),bt=F(he,Wn(Wn({},Ue),{},{dataStartIndex:ge,dataEndIndex:fe,updateId:ye,graphicalItems:je,stackGroups:ze,offset:Fe}));return Wn(Wn({formattedGraphicalItems:bt,graphicalItems:je,offset:Fe,stackGroups:ze},Be),Ue)},H=function(W){function J(ie){var he,ge,fe;return SAe(this,J),fe=EAe(this,J,[ie]),Fi(fe,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),Fi(fe,"accessibilityManager",new cAe),Fi(fe,"handleLegendBBoxUpdate",function(ye){if(ye){var pe=fe.state,be=pe.dataStartIndex,Ae=pe.dataEndIndex,Oe=pe.updateId;fe.setState(Wn({legendBBox:ye},j({props:fe.props,dataStartIndex:be,dataEndIndex:Ae,updateId:Oe},Wn(Wn({},fe.state),{},{legendBBox:ye}))))}}),Fi(fe,"handleReceiveSyncEvent",function(ye,pe,be){if(fe.props.syncId===ye){if(be===fe.eventEmitterSymbol&&typeof fe.props.syncMethod!="function")return;fe.applySyncEvent(pe)}}),Fi(fe,"handleBrushChange",function(ye){var pe=ye.startIndex,be=ye.endIndex;if(pe!==fe.state.dataStartIndex||be!==fe.state.dataEndIndex){var Ae=fe.state.updateId;fe.setState(function(){return Wn({dataStartIndex:pe,dataEndIndex:be},j({props:fe.props,dataStartIndex:pe,dataEndIndex:be,updateId:Ae},fe.state))}),fe.triggerSyncEvent({dataStartIndex:pe,dataEndIndex:be})}}),Fi(fe,"handleMouseEnter",function(ye){var pe=fe.getMouseInfo(ye);if(pe){var be=Wn(Wn({},pe),{},{isTooltipActive:!0});fe.setState(be),fe.triggerSyncEvent(be);var Ae=fe.props.onMouseEnter;qi(Ae)&&Ae(be,ye)}}),Fi(fe,"triggeredAfterMouseMove",function(ye){var pe=fe.getMouseInfo(ye),be=pe?Wn(Wn({},pe),{},{isTooltipActive:!0}):{isTooltipActive:!1};fe.setState(be),fe.triggerSyncEvent(be);var Ae=fe.props.onMouseMove;qi(Ae)&&Ae(be,ye)}),Fi(fe,"handleItemMouseEnter",function(ye){fe.setState(function(){return{isTooltipActive:!0,activeItem:ye,activePayload:ye.tooltipPayload,activeCoordinate:ye.tooltipPosition||{x:ye.cx,y:ye.cy}}})}),Fi(fe,"handleItemMouseLeave",function(){fe.setState(function(){return{isTooltipActive:!1}})}),Fi(fe,"handleMouseMove",function(ye){ye.persist(),fe.throttleTriggeredAfterMouseMove(ye)}),Fi(fe,"handleMouseLeave",function(ye){fe.throttleTriggeredAfterMouseMove.cancel();var pe={isTooltipActive:!1};fe.setState(pe),fe.triggerSyncEvent(pe);var be=fe.props.onMouseLeave;qi(be)&&be(pe,ye)}),Fi(fe,"handleOuterEvent",function(ye){var pe=rhe(ye),be=sd(fe.props,"".concat(pe));if(pe&&qi(be)){var Ae,Oe;/.*touch.*/i.test(pe)?Oe=fe.getMouseInfo(ye.changedTouches[0]):Oe=fe.getMouseInfo(ye),be((Ae=Oe)!==null&&Ae!==void 0?Ae:{},ye)}}),Fi(fe,"handleClick",function(ye){var pe=fe.getMouseInfo(ye);if(pe){var be=Wn(Wn({},pe),{},{isTooltipActive:!0});fe.setState(be),fe.triggerSyncEvent(be);var Ae=fe.props.onClick;qi(Ae)&&Ae(be,ye)}}),Fi(fe,"handleMouseDown",function(ye){var pe=fe.props.onMouseDown;if(qi(pe)){var be=fe.getMouseInfo(ye);pe(be,ye)}}),Fi(fe,"handleMouseUp",function(ye){var pe=fe.props.onMouseUp;if(qi(pe)){var be=fe.getMouseInfo(ye);pe(be,ye)}}),Fi(fe,"handleTouchMove",function(ye){ye.changedTouches!=null&&ye.changedTouches.length>0&&fe.throttleTriggeredAfterMouseMove(ye.changedTouches[0])}),Fi(fe,"handleTouchStart",function(ye){ye.changedTouches!=null&&ye.changedTouches.length>0&&fe.handleMouseDown(ye.changedTouches[0])}),Fi(fe,"handleTouchEnd",function(ye){ye.changedTouches!=null&&ye.changedTouches.length>0&&fe.handleMouseUp(ye.changedTouches[0])}),Fi(fe,"handleDoubleClick",function(ye){var pe=fe.props.onDoubleClick;if(qi(pe)){var be=fe.getMouseInfo(ye);pe(be,ye)}}),Fi(fe,"handleContextMenu",function(ye){var pe=fe.props.onContextMenu;if(qi(pe)){var be=fe.getMouseInfo(ye);pe(be,ye)}}),Fi(fe,"triggerSyncEvent",function(ye){fe.props.syncId!==void 0&&EO.emit(MO,fe.props.syncId,ye,fe.eventEmitterSymbol)}),Fi(fe,"applySyncEvent",function(ye){var pe=fe.props,be=pe.layout,Ae=pe.syncMethod,Oe=fe.state.updateId,ue=ye.dataStartIndex,we=ye.dataEndIndex;if(ye.dataStartIndex!==void 0||ye.dataEndIndex!==void 0)fe.setState(Wn({dataStartIndex:ue,dataEndIndex:we},j({props:fe.props,dataStartIndex:ue,dataEndIndex:we,updateId:Oe},fe.state)));else if(ye.activeTooltipIndex!==void 0){var ke=ye.chartX,De=ye.chartY,je=ye.activeTooltipIndex,ze=fe.state,Ue=ze.offset,Fe=ze.tooltipTicks;if(!Ue)return;if(typeof Ae=="function")je=Ae(Fe,ye);else if(Ae==="value"){je=-1;for(var Qe=0;Qe<Fe.length;Qe++)if(Fe[Qe].value===ye.activeLabel){je=Qe;break}}var Be=Wn(Wn({},Ue),{},{x:Ue.left,y:Ue.top}),bt=Math.min(ke,Be.x+Be.width),xe=Math.min(De,Be.y+Be.height),Le=Fe[je]&&Fe[je].value,Xe=yD(fe.state,fe.props.data,je),ct=Fe[je]?{x:be==="horizontal"?Fe[je].coordinate:bt,y:be==="horizontal"?xe:Fe[je].coordinate}:BZ;fe.setState(Wn(Wn({},ye),{},{activeLabel:Le,activeCoordinate:ct,activePayload:Xe,activeTooltipIndex:je}))}else fe.setState(ye)}),Fi(fe,"renderCursor",function(ye){var pe,be=fe.state,Ae=be.isTooltipActive,Oe=be.activeCoordinate,ue=be.activePayload,we=be.offset,ke=be.activeTooltipIndex,De=be.tooltipAxisBandSize,je=fe.getTooltipEventType(),ze=(pe=ye.props.active)!==null&&pe!==void 0?pe:Ae,Ue=fe.props.layout,Fe=ye.key||"_recharts-cursor";return kt.createElement(gAe,{key:Fe,activeCoordinate:Oe,activePayload:ue,activeTooltipIndex:ke,chartName:n,element:ye,isActive:ze,layout:Ue,offset:we,tooltipAxisBandSize:De,tooltipEventType:je})}),Fi(fe,"renderPolarAxis",function(ye,pe,be){var Ae=sd(ye,"type.axisType"),Oe=sd(fe.state,"".concat(Ae,"Map")),ue=ye.type.defaultProps,we=ue!==void 0?Wn(Wn({},ue),ye.props):ye.props,ke=Oe&&Oe[we["".concat(Ae,"Id")]];return st.cloneElement(ye,Wn(Wn({},ke),{},{className:fa(Ae,ke.className),key:ye.key||"".concat(pe,"-").concat(be),ticks:sg(ke,!0)}))}),Fi(fe,"renderPolarGrid",function(ye){var pe=ye.props,be=pe.radialLines,Ae=pe.polarAngles,Oe=pe.polarRadius,ue=fe.state,we=ue.radiusAxisMap,ke=ue.angleAxisMap,De=gy(we),je=gy(ke),ze=je.cx,Ue=je.cy,Fe=je.innerRadius,Qe=je.outerRadius;return st.cloneElement(ye,{polarAngles:Array.isArray(Ae)?Ae:sg(je,!0).map(function(Be){return Be.coordinate}),polarRadius:Array.isArray(Oe)?Oe:sg(De,!0).map(function(Be){return Be.coordinate}),cx:ze,cy:Ue,innerRadius:Fe,outerRadius:Qe,key:ye.key||"polar-grid",radialLines:be})}),Fi(fe,"renderLegend",function(){var ye=fe.state.formattedGraphicalItems,pe=fe.props,be=pe.children,Ae=pe.width,Oe=pe.height,ue=fe.props.margin||{},we=Ae-(ue.left||0)-(ue.right||0),ke=yX({children:be,formattedGraphicalItems:ye,legendWidth:we,legendContent:S});if(!ke)return null;var De=ke.item,je=gV(ke,yAe);return st.cloneElement(De,Wn(Wn({},je),{},{chartWidth:Ae,chartHeight:Oe,margin:ue,onBBoxUpdate:fe.handleLegendBBoxUpdate}))}),Fi(fe,"renderTooltip",function(){var ye,pe=fe.props,be=pe.children,Ae=pe.accessibilityLayer,Oe=Qf(be,Rc);if(!Oe)return null;var ue=fe.state,we=ue.isTooltipActive,ke=ue.activeCoordinate,De=ue.activePayload,je=ue.activeLabel,ze=ue.offset,Ue=(ye=Oe.props.active)!==null&&ye!==void 0?ye:we;return st.cloneElement(Oe,{viewBox:Wn(Wn({},ze),{},{x:ze.left,y:ze.top}),active:Ue,label:je,payload:Ue?De:[],coordinate:ke,accessibilityLayer:Ae})}),Fi(fe,"renderBrush",function(ye){var pe=fe.props,be=pe.margin,Ae=pe.data,Oe=fe.state,ue=Oe.offset,we=Oe.dataStartIndex,ke=Oe.dataEndIndex,De=Oe.updateId;return st.cloneElement(ye,{key:ye.key||"_recharts-brush",onChange:iA(fe.handleBrushChange,ye.props.onChange),data:Ae,x:gr(ye.props.x)?ye.props.x:ue.left,y:gr(ye.props.y)?ye.props.y:ue.top+ue.height+ue.brushBottom-(be.bottom||0),width:gr(ye.props.width)?ye.props.width:ue.width,startIndex:we,endIndex:ke,updateId:"brush-".concat(De)})}),Fi(fe,"renderReferenceElement",function(ye,pe,be){if(!ye)return null;var Ae=fe,Oe=Ae.clipPathId,ue=fe.state,we=ue.xAxisMap,ke=ue.yAxisMap,De=ue.offset,je=ye.type.defaultProps||{},ze=ye.props,Ue=ze.xAxisId,Fe=Ue===void 0?je.xAxisId:Ue,Qe=ze.yAxisId,Be=Qe===void 0?je.yAxisId:Qe;return st.cloneElement(ye,{key:ye.key||"".concat(pe,"-").concat(be),xAxis:we[Fe],yAxis:ke[Be],viewBox:{x:De.left,y:De.top,width:De.width,height:De.height},clipPathId:Oe})}),Fi(fe,"renderActivePoints",function(ye){var pe=ye.item,be=ye.activePoint,Ae=ye.basePoint,Oe=ye.childIndex,ue=ye.isRange,we=[],ke=pe.props.key,De=pe.item.type.defaultProps!==void 0?Wn(Wn({},pe.item.type.defaultProps),pe.item.props):pe.item.props,je=De.activeDot,ze=De.dataKey,Ue=Wn(Wn({index:Oe,dataKey:ze,cx:be.x,cy:be.y,r:4,fill:Qk(pe.item),strokeWidth:2,stroke:"#fff",payload:be.payload,value:be.value},di(je,!1)),pT(je));return we.push(J.renderActiveDot(je,Ue,"".concat(ke,"-activePoint-").concat(Oe))),Ae?we.push(J.renderActiveDot(je,Wn(Wn({},Ue),{},{cx:Ae.x,cy:Ae.y}),"".concat(ke,"-basePoint-").concat(Oe))):ue&&we.push(null),we}),Fi(fe,"renderGraphicChild",function(ye,pe,be){var Ae=fe.filterFormatItem(ye,pe,be);if(!Ae)return null;var Oe=fe.getTooltipEventType(),ue=fe.state,we=ue.isTooltipActive,ke=ue.tooltipAxis,De=ue.activeTooltipIndex,je=ue.activeLabel,ze=fe.props.children,Ue=Qf(ze,Rc),Fe=Ae.props,Qe=Fe.points,Be=Fe.isRange,bt=Fe.baseLine,xe=Ae.item.type.defaultProps!==void 0?Wn(Wn({},Ae.item.type.defaultProps),Ae.item.props):Ae.item.props,Le=xe.activeDot,Xe=xe.hide,ct=xe.activeBar,vt=xe.activeShape,Nt=!!(!Xe&&we&&Ue&&(Le||ct||vt)),mt={};Oe!=="axis"&&Ue&&Ue.props.trigger==="click"?mt={onClick:iA(fe.handleItemMouseEnter,ye.props.onClick)}:Oe!=="axis"&&(mt={onMouseLeave:iA(fe.handleItemMouseLeave,ye.props.onMouseLeave),onMouseEnter:iA(fe.handleItemMouseEnter,ye.props.onMouseEnter)});var yt=st.cloneElement(ye,Wn(Wn({},Ae.props),mt));function _e(ur){return typeof ke.dataKey=="function"?ke.dataKey(ur.payload):null}if(Nt)if(De>=0){var on,Kt;if(ke.dataKey&&!ke.allowDuplicatedCategory){var Pn=typeof ke.dataKey=="function"?_e:"payload.".concat(ke.dataKey.toString());on=dT(Qe,Pn,je),Kt=Be&&bt&&dT(bt,Pn,je)}else on=Qe==null?void 0:Qe[De],Kt=Be&&bt&&bt[De];if(vt||ct){var Ut=ye.props.activeIndex!==void 0?ye.props.activeIndex:De;return[st.cloneElement(ye,Wn(Wn(Wn({},Ae.props),mt),{},{activeIndex:Ut})),null,null]}if(!aa(on))return[yt].concat(T1(fe.renderActivePoints({item:Ae,activePoint:on,basePoint:Kt,childIndex:De,isRange:Be})))}else{var cn,At=(cn=fe.getItemByXY(fe.state.activeCoordinate))!==null&&cn!==void 0?cn:{graphicalItem:yt},xr=At.graphicalItem,Rn=xr.item,Dn=Rn===void 0?ye:Rn,ar=xr.childIndex,hr=Wn(Wn(Wn({},Ae.props),mt),{},{activeIndex:ar});return[st.cloneElement(Dn,hr),null,null]}return Be?[yt,null,null]:[yt,null]}),Fi(fe,"renderCustomized",function(ye,pe,be){return st.cloneElement(ye,Wn(Wn({key:"recharts-customized-".concat(be)},fe.props),fe.state))}),Fi(fe,"renderMap",{CartesianGrid:{handler:cA,once:!0},ReferenceArea:{handler:fe.renderReferenceElement},ReferenceLine:{handler:cA},ReferenceDot:{handler:fe.renderReferenceElement},XAxis:{handler:cA},YAxis:{handler:cA},Brush:{handler:fe.renderBrush,once:!0},Bar:{handler:fe.renderGraphicChild},Line:{handler:fe.renderGraphicChild},Area:{handler:fe.renderGraphicChild},Radar:{handler:fe.renderGraphicChild},RadialBar:{handler:fe.renderGraphicChild},Scatter:{handler:fe.renderGraphicChild},Pie:{handler:fe.renderGraphicChild},Funnel:{handler:fe.renderGraphicChild},Tooltip:{handler:fe.renderCursor,once:!0},PolarGrid:{handler:fe.renderPolarGrid,once:!0},PolarAngleAxis:{handler:fe.renderPolarAxis},PolarRadiusAxis:{handler:fe.renderPolarAxis},Customized:{handler:fe.renderCustomized}}),fe.clipPathId="".concat((he=ie.id)!==null&&he!==void 0?he:mv("recharts"),"-clip"),fe.throttleTriggeredAfterMouseMove=gY(fe.triggeredAfterMouseMove,(ge=ie.throttleDelay)!==null&&ge!==void 0?ge:1e3/60),fe.state={},fe}return IAe(J,W),TAe(J,[{key:"componentDidMount",value:function(){var he,ge;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(he=this.props.margin.left)!==null&&he!==void 0?he:0,top:(ge=this.props.margin.top)!==null&&ge!==void 0?ge:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var he=this.props,ge=he.children,fe=he.data,ye=he.height,pe=he.layout,be=Qf(ge,Rc);if(be){var Ae=be.props.defaultIndex;if(!(typeof Ae!="number"||Ae<0||Ae>this.state.tooltipTicks.length-1)){var Oe=this.state.tooltipTicks[Ae]&&this.state.tooltipTicks[Ae].value,ue=yD(this.state,fe,Ae,Oe),we=this.state.tooltipTicks[Ae].coordinate,ke=(this.state.offset.top+ye)/2,De=pe==="horizontal",je=De?{x:we,y:ke}:{y:we,x:ke},ze=this.state.formattedGraphicalItems.find(function(Fe){var Qe=Fe.item;return Qe.type.name==="Scatter"});ze&&(je=Wn(Wn({},je),ze.props.points[Ae].tooltipPosition),ue=ze.props.points[Ae].tooltipPayload);var Ue={activeTooltipIndex:Ae,isTooltipActive:!0,activeLabel:Oe,activePayload:ue,activeCoordinate:je};this.setState(Ue),this.renderCursor(be),this.accessibilityManager.setIndex(Ae)}}}},{key:"getSnapshotBeforeUpdate",value:function(he,ge){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==ge.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==he.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==he.margin){var fe,ye;this.accessibilityManager.setDetails({offset:{left:(fe=this.props.margin.left)!==null&&fe!==void 0?fe:0,top:(ye=this.props.margin.top)!==null&&ye!==void 0?ye:0}})}return null}},{key:"componentDidUpdate",value:function(he){J4([Qf(he.children,Rc)],[Qf(this.props.children,Rc)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var he=Qf(this.props.children,Rc);if(he&&typeof he.props.shared=="boolean"){var ge=he.props.shared?"axis":"item";return i.indexOf(ge)>=0?ge:l}return l}},{key:"getMouseInfo",value:function(he){if(!this.container)return null;var ge=this.container,fe=ge.getBoundingClientRect(),ye=$pe(fe),pe={chartX:Math.round(he.pageX-ye.left),chartY:Math.round(he.pageY-ye.top)},be=fe.width/ge.offsetWidth||1,Ae=this.inRange(pe.chartX,pe.chartY,be);if(!Ae)return null;var Oe=this.state,ue=Oe.xAxisMap,we=Oe.yAxisMap,ke=this.getTooltipEventType();if(ke!=="axis"&&ue&&we){var De=gy(ue).scale,je=gy(we).scale,ze=De&&De.invert?De.invert(pe.chartX):null,Ue=je&&je.invert?je.invert(pe.chartY):null;return Wn(Wn({},pe),{},{xValue:ze,yValue:Ue})}var Fe=_V(this.state,this.props.data,this.props.layout,Ae);return Fe?Wn(Wn({},pe),Fe):null}},{key:"inRange",value:function(he,ge){var fe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,ye=this.props.layout,pe=he/fe,be=ge/fe;if(ye==="horizontal"||ye==="vertical"){var Ae=this.state.offset,Oe=pe>=Ae.left&&pe<=Ae.left+Ae.width&&be>=Ae.top&&be<=Ae.top+Ae.height;return Oe?{x:pe,y:be}:null}var ue=this.state,we=ue.angleAxisMap,ke=ue.radiusAxisMap;if(we&&ke){var De=gy(we);return v9({x:pe,y:be},De)}return null}},{key:"parseEventsOfWrapper",value:function(){var he=this.props.children,ge=this.getTooltipEventType(),fe=Qf(he,Rc),ye={};fe&&ge==="axis"&&(fe.props.trigger==="click"?ye={onClick:this.handleClick}:ye={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var pe=pT(this.props,this.handleOuterEvent);return Wn(Wn({},pe),ye)}},{key:"addListener",value:function(){EO.on(MO,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){EO.removeListener(MO,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(he,ge,fe){for(var ye=this.state.formattedGraphicalItems,pe=0,be=ye.length;pe<be;pe++){var Ae=ye[pe];if(Ae.item===he||Ae.props.key===he.key||ge===cg(Ae.item.type)&&fe===Ae.childIndex)return Ae}return null}},{key:"renderClipPath",value:function(){var he=this.clipPathId,ge=this.state.offset,fe=ge.left,ye=ge.top,pe=ge.height,be=ge.width;return kt.createElement("defs",null,kt.createElement("clipPath",{id:he},kt.createElement("rect",{x:fe,y:ye,height:pe,width:be})))}},{key:"getXScales",value:function(){var he=this.state.xAxisMap;return he?Object.entries(he).reduce(function(ge,fe){var ye=mV(fe,2),pe=ye[0],be=ye[1];return Wn(Wn({},ge),{},Fi({},pe,be.scale))},{}):null}},{key:"getYScales",value:function(){var he=this.state.yAxisMap;return he?Object.entries(he).reduce(function(ge,fe){var ye=mV(fe,2),pe=ye[0],be=ye[1];return Wn(Wn({},ge),{},Fi({},pe,be.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(he){var ge;return(ge=this.state.xAxisMap)===null||ge===void 0||(ge=ge[he])===null||ge===void 0?void 0:ge.scale}},{key:"getYScaleByAxisId",value:function(he){var ge;return(ge=this.state.yAxisMap)===null||ge===void 0||(ge=ge[he])===null||ge===void 0?void 0:ge.scale}},{key:"getItemByXY",value:function(he){var ge=this.state,fe=ge.formattedGraphicalItems,ye=ge.activeItem;if(fe&&fe.length)for(var pe=0,be=fe.length;pe<be;pe++){var Ae=fe[pe],Oe=Ae.props,ue=Ae.item,we=ue.type.defaultProps!==void 0?Wn(Wn({},ue.type.defaultProps),ue.props):ue.props,ke=cg(ue.type);if(ke==="Bar"){var De=(Oe.data||[]).find(function(Fe){return obe(he,Fe)});if(De)return{graphicalItem:Ae,payload:De}}else if(ke==="RadialBar"){var je=(Oe.data||[]).find(function(Fe){return v9(he,Fe)});if(je)return{graphicalItem:Ae,payload:je}}else if(PE(Ae,ye)||OE(Ae,ye)||Lw(Ae,ye)){var ze=Oxe({graphicalItem:Ae,activeTooltipItem:ye,itemData:we.data}),Ue=we.activeIndex===void 0?ze:we.activeIndex;return{graphicalItem:Wn(Wn({},Ae),{},{childIndex:Ue}),payload:Lw(Ae,ye)?we.data[ze]:Ae.props.data[ze]}}}return null}},{key:"render",value:function(){var he=this;if(!OF(this))return null;var ge=this.props,fe=ge.children,ye=ge.className,pe=ge.width,be=ge.height,Ae=ge.style,Oe=ge.compact,ue=ge.title,we=ge.desc,ke=gV(ge,_Ae),De=di(ke,!1);if(Oe)return kt.createElement(Kq,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},kt.createElement(eR,M0({},De,{width:pe,height:be,title:ue,desc:we}),this.renderClipPath(),DF(fe,this.renderMap)));if(this.props.accessibilityLayer){var je,ze;De.tabIndex=(je=this.props.tabIndex)!==null&&je!==void 0?je:0,De.role=(ze=this.props.role)!==null&&ze!==void 0?ze:"application",De.onKeyDown=function(Fe){he.accessibilityManager.keyboardEvent(Fe)},De.onFocus=function(){he.accessibilityManager.focus()}}var Ue=this.parseEventsOfWrapper();return kt.createElement(Kq,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},kt.createElement("div",M0({className:fa("recharts-wrapper",ye),style:Wn({position:"relative",cursor:"default",width:pe,height:be},Ae)},Ue,{ref:function(Qe){he.container=Qe}}),kt.createElement(eR,M0({},De,{width:pe,height:be,title:ue,desc:we,style:kAe}),this.renderClipPath(),DF(fe,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(st.Component);Fi(H,"displayName",n),Fi(H,"defaultProps",Wn({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},R)),Fi(H,"getDerivedStateFromProps",function(W,J){var ie=W.dataKey,he=W.data,ge=W.children,fe=W.width,ye=W.height,pe=W.layout,be=W.stackOffset,Ae=W.margin,Oe=J.dataStartIndex,ue=J.dataEndIndex;if(J.updateId===void 0){var we=vV(W);return Wn(Wn(Wn({},we),{},{updateId:0},j(Wn(Wn({props:W},we),{},{updateId:0}),J)),{},{prevDataKey:ie,prevData:he,prevWidth:fe,prevHeight:ye,prevLayout:pe,prevStackOffset:be,prevMargin:Ae,prevChildren:ge})}if(ie!==J.prevDataKey||he!==J.prevData||fe!==J.prevWidth||ye!==J.prevHeight||pe!==J.prevLayout||be!==J.prevStackOffset||!z0(Ae,J.prevMargin)){var ke=vV(W),De={chartX:J.chartX,chartY:J.chartY,isTooltipActive:J.isTooltipActive},je=Wn(Wn({},_V(J,he,pe)),{},{updateId:J.updateId+1}),ze=Wn(Wn(Wn({},ke),De),je);return Wn(Wn(Wn({},ze),j(Wn({props:W},ze),J)),{},{prevDataKey:ie,prevData:he,prevWidth:fe,prevHeight:ye,prevLayout:pe,prevStackOffset:be,prevMargin:Ae,prevChildren:ge})}if(!J4(ge,J.prevChildren)){var Ue,Fe,Qe,Be,bt=Qf(ge,p1),xe=bt&&(Ue=(Fe=bt.props)===null||Fe===void 0?void 0:Fe.startIndex)!==null&&Ue!==void 0?Ue:Oe,Le=bt&&(Qe=(Be=bt.props)===null||Be===void 0?void 0:Be.endIndex)!==null&&Qe!==void 0?Qe:ue,Xe=xe!==Oe||Le!==ue,ct=!aa(he),vt=ct&&!Xe?J.updateId:J.updateId+1;return Wn(Wn({updateId:vt},j(Wn(Wn({props:W},J),{},{updateId:vt,dataStartIndex:xe,dataEndIndex:Le}),J)),{},{prevChildren:ge,dataStartIndex:xe,dataEndIndex:Le})}return null}),Fi(H,"renderActiveDot",function(W,J,ie){var he;return st.isValidElement(W)?he=st.cloneElement(W,J):qi(W)?he=W(J):he=kt.createElement(T2,J),kt.createElement(Na,{className:"recharts-active-dot",key:ie},he)});var G=st.forwardRef(function(J,ie){return kt.createElement(H,M0({},J,{ref:ie}))});return G.displayName=H.displayName,G},HAe=BE({chartName:"LineChart",GraphicalChild:E2,axisComponents:[{axisType:"xAxis",AxisComp:wf},{axisType:"yAxis",AxisComp:Sf}],formatAxisMap:tN}),_D=BE({chartName:"BarChart",GraphicalChild:xg,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:wf},{axisType:"yAxis",AxisComp:Sf}],formatAxisMap:tN}),GAe=BE({chartName:"PieChart",GraphicalChild:Mg,validateTooltipEventTypes:["item"],defaultTooltipEventType:"item",legendContent:"children",axisComponents:[{axisType:"angleAxis",AxisComp:IE},{axisType:"radiusAxis",AxisComp:ME}],formatAxisMap:wve,defaultProps:{layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}}),hx=BE({chartName:"AreaChart",GraphicalChild:jd,axisComponents:[{axisType:"xAxis",AxisComp:wf},{axisType:"yAxis",AxisComp:Sf}],formatAxisMap:tN}),PA={exports:{}},WAe=PA.exports,xV;function KAe(){return xV||(xV=1,function(t,e){(function(n,r){t.exports=r()})(WAe,function(){var n=1e3,r=6e4,s=36e5,l="millisecond",f="second",i="minute",x="hour",S="day",I="week",R="month",F="quarter",j="year",H="date",G="Invalid Date",W=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,J=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,ie={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(De){var je=["th","st","nd","rd"],ze=De%100;return"["+De+(je[(ze-20)%10]||je[ze]||je[0])+"]"}},he=function(De,je,ze){var Ue=String(De);return!Ue||Ue.length>=je?De:""+Array(je+1-Ue.length).join(ze)+De},ge={s:he,z:function(De){var je=-De.utcOffset(),ze=Math.abs(je),Ue=Math.floor(ze/60),Fe=ze%60;return(je<=0?"+":"-")+he(Ue,2,"0")+":"+he(Fe,2,"0")},m:function De(je,ze){if(je.date()<ze.date())return-De(ze,je);var Ue=12*(ze.year()-je.year())+(ze.month()-je.month()),Fe=je.clone().add(Ue,R),Qe=ze-Fe<0,Be=je.clone().add(Ue+(Qe?-1:1),R);return+(-(Ue+(ze-Fe)/(Qe?Fe-Be:Be-Fe))||0)},a:function(De){return De<0?Math.ceil(De)||0:Math.floor(De)},p:function(De){return{M:R,y:j,w:I,d:S,D:H,h:x,m:i,s:f,ms:l,Q:F}[De]||String(De||"").toLowerCase().replace(/s$/,"")},u:function(De){return De===void 0}},fe="en",ye={};ye[fe]=ie;var pe="$isDayjsObject",be=function(De){return De instanceof we||!(!De||!De[pe])},Ae=function De(je,ze,Ue){var Fe;if(!je)return fe;if(typeof je=="string"){var Qe=je.toLowerCase();ye[Qe]&&(Fe=Qe),ze&&(ye[Qe]=ze,Fe=Qe);var Be=je.split("-");if(!Fe&&Be.length>1)return De(Be[0])}else{var bt=je.name;ye[bt]=je,Fe=bt}return!Ue&&Fe&&(fe=Fe),Fe||!Ue&&fe},Oe=function(De,je){if(be(De))return De.clone();var ze=typeof je=="object"?je:{};return ze.date=De,ze.args=arguments,new we(ze)},ue=ge;ue.l=Ae,ue.i=be,ue.w=function(De,je){return Oe(De,{locale:je.$L,utc:je.$u,x:je.$x,$offset:je.$offset})};var we=function(){function De(ze){this.$L=Ae(ze.locale,null,!0),this.parse(ze),this.$x=this.$x||ze.x||{},this[pe]=!0}var je=De.prototype;return je.parse=function(ze){this.$d=function(Ue){var Fe=Ue.date,Qe=Ue.utc;if(Fe===null)return new Date(NaN);if(ue.u(Fe))return new Date;if(Fe instanceof Date)return new Date(Fe);if(typeof Fe=="string"&&!/Z$/i.test(Fe)){var Be=Fe.match(W);if(Be){var bt=Be[2]-1||0,xe=(Be[7]||"0").substring(0,3);return Qe?new Date(Date.UTC(Be[1],bt,Be[3]||1,Be[4]||0,Be[5]||0,Be[6]||0,xe)):new Date(Be[1],bt,Be[3]||1,Be[4]||0,Be[5]||0,Be[6]||0,xe)}}return new Date(Fe)}(ze),this.init()},je.init=function(){var ze=this.$d;this.$y=ze.getFullYear(),this.$M=ze.getMonth(),this.$D=ze.getDate(),this.$W=ze.getDay(),this.$H=ze.getHours(),this.$m=ze.getMinutes(),this.$s=ze.getSeconds(),this.$ms=ze.getMilliseconds()},je.$utils=function(){return ue},je.isValid=function(){return this.$d.toString()!==G},je.isSame=function(ze,Ue){var Fe=Oe(ze);return this.startOf(Ue)<=Fe&&Fe<=this.endOf(Ue)},je.isAfter=function(ze,Ue){return Oe(ze)<this.startOf(Ue)},je.isBefore=function(ze,Ue){return this.endOf(Ue)<Oe(ze)},je.$g=function(ze,Ue,Fe){return ue.u(ze)?this[Ue]:this.set(Fe,ze)},je.unix=function(){return Math.floor(this.valueOf()/1e3)},je.valueOf=function(){return this.$d.getTime()},je.startOf=function(ze,Ue){var Fe=this,Qe=!!ue.u(Ue)||Ue,Be=ue.p(ze),bt=function(yt,_e){var on=ue.w(Fe.$u?Date.UTC(Fe.$y,_e,yt):new Date(Fe.$y,_e,yt),Fe);return Qe?on:on.endOf(S)},xe=function(yt,_e){return ue.w(Fe.toDate()[yt].apply(Fe.toDate("s"),(Qe?[0,0,0,0]:[23,59,59,999]).slice(_e)),Fe)},Le=this.$W,Xe=this.$M,ct=this.$D,vt="set"+(this.$u?"UTC":"");switch(Be){case j:return Qe?bt(1,0):bt(31,11);case R:return Qe?bt(1,Xe):bt(0,Xe+1);case I:var Nt=this.$locale().weekStart||0,mt=(Le<Nt?Le+7:Le)-Nt;return bt(Qe?ct-mt:ct+(6-mt),Xe);case S:case H:return xe(vt+"Hours",0);case x:return xe(vt+"Minutes",1);case i:return xe(vt+"Seconds",2);case f:return xe(vt+"Milliseconds",3);default:return this.clone()}},je.endOf=function(ze){return this.startOf(ze,!1)},je.$set=function(ze,Ue){var Fe,Qe=ue.p(ze),Be="set"+(this.$u?"UTC":""),bt=(Fe={},Fe[S]=Be+"Date",Fe[H]=Be+"Date",Fe[R]=Be+"Month",Fe[j]=Be+"FullYear",Fe[x]=Be+"Hours",Fe[i]=Be+"Minutes",Fe[f]=Be+"Seconds",Fe[l]=Be+"Milliseconds",Fe)[Qe],xe=Qe===S?this.$D+(Ue-this.$W):Ue;if(Qe===R||Qe===j){var Le=this.clone().set(H,1);Le.$d[bt](xe),Le.init(),this.$d=Le.set(H,Math.min(this.$D,Le.daysInMonth())).$d}else bt&&this.$d[bt](xe);return this.init(),this},je.set=function(ze,Ue){return this.clone().$set(ze,Ue)},je.get=function(ze){return this[ue.p(ze)]()},je.add=function(ze,Ue){var Fe,Qe=this;ze=Number(ze);var Be=ue.p(Ue),bt=function(Xe){var ct=Oe(Qe);return ue.w(ct.date(ct.date()+Math.round(Xe*ze)),Qe)};if(Be===R)return this.set(R,this.$M+ze);if(Be===j)return this.set(j,this.$y+ze);if(Be===S)return bt(1);if(Be===I)return bt(7);var xe=(Fe={},Fe[i]=r,Fe[x]=s,Fe[f]=n,Fe)[Be]||1,Le=this.$d.getTime()+ze*xe;return ue.w(Le,this)},je.subtract=function(ze,Ue){return this.add(-1*ze,Ue)},je.format=function(ze){var Ue=this,Fe=this.$locale();if(!this.isValid())return Fe.invalidDate||G;var Qe=ze||"YYYY-MM-DDTHH:mm:ssZ",Be=ue.z(this),bt=this.$H,xe=this.$m,Le=this.$M,Xe=Fe.weekdays,ct=Fe.months,vt=Fe.meridiem,Nt=function(_e,on,Kt,Pn){return _e&&(_e[on]||_e(Ue,Qe))||Kt[on].slice(0,Pn)},mt=function(_e){return ue.s(bt%12||12,_e,"0")},yt=vt||function(_e,on,Kt){var Pn=_e<12?"AM":"PM";return Kt?Pn.toLowerCase():Pn};return Qe.replace(J,function(_e,on){return on||function(Kt){switch(Kt){case"YY":return String(Ue.$y).slice(-2);case"YYYY":return ue.s(Ue.$y,4,"0");case"M":return Le+1;case"MM":return ue.s(Le+1,2,"0");case"MMM":return Nt(Fe.monthsShort,Le,ct,3);case"MMMM":return Nt(ct,Le);case"D":return Ue.$D;case"DD":return ue.s(Ue.$D,2,"0");case"d":return String(Ue.$W);case"dd":return Nt(Fe.weekdaysMin,Ue.$W,Xe,2);case"ddd":return Nt(Fe.weekdaysShort,Ue.$W,Xe,3);case"dddd":return Xe[Ue.$W];case"H":return String(bt);case"HH":return ue.s(bt,2,"0");case"h":return mt(1);case"hh":return mt(2);case"a":return yt(bt,xe,!0);case"A":return yt(bt,xe,!1);case"m":return String(xe);case"mm":return ue.s(xe,2,"0");case"s":return String(Ue.$s);case"ss":return ue.s(Ue.$s,2,"0");case"SSS":return ue.s(Ue.$ms,3,"0");case"Z":return Be}return null}(_e)||Be.replace(":","")})},je.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},je.diff=function(ze,Ue,Fe){var Qe,Be=this,bt=ue.p(Ue),xe=Oe(ze),Le=(xe.utcOffset()-this.utcOffset())*r,Xe=this-xe,ct=function(){return ue.m(Be,xe)};switch(bt){case j:Qe=ct()/12;break;case R:Qe=ct();break;case F:Qe=ct()/3;break;case I:Qe=(Xe-Le)/6048e5;break;case S:Qe=(Xe-Le)/864e5;break;case x:Qe=Xe/s;break;case i:Qe=Xe/r;break;case f:Qe=Xe/n;break;default:Qe=Xe}return Fe?Qe:ue.a(Qe)},je.daysInMonth=function(){return this.endOf(R).$D},je.$locale=function(){return ye[this.$L]},je.locale=function(ze,Ue){if(!ze)return this.$L;var Fe=this.clone(),Qe=Ae(ze,Ue,!0);return Qe&&(Fe.$L=Qe),Fe},je.clone=function(){return ue.w(this.$d,this)},je.toDate=function(){return new Date(this.valueOf())},je.toJSON=function(){return this.isValid()?this.toISOString():null},je.toISOString=function(){return this.$d.toISOString()},je.toString=function(){return this.$d.toUTCString()},De}(),ke=we.prototype;return Oe.prototype=ke,[["$ms",l],["$s",f],["$m",i],["$H",x],["$W",S],["$M",R],["$y",j],["$D",H]].forEach(function(De){ke[De[1]]=function(je){return this.$g(je,De[0],De[1])}}),Oe.extend=function(De,je){return De.$i||(De(je,we,Oe),De.$i=!0),Oe},Oe.locale=Ae,Oe.isDayjs=be,Oe.unix=function(De){return Oe(1e3*De)},Oe.en=ye[fe],Oe.Ls=ye,Oe.p={},Oe})}(PA)),PA.exports}var YAe=KAe();const io=Xa(YAe);var OA={exports:{}},XAe=OA.exports,wV;function ZAe(){return wV||(wV=1,function(t,e){(function(n,r){t.exports=r()})(XAe,function(){var n={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},r=/(\[[^[]*\])|([-_:/.,()\s]+)|(A|a|Q|YYYY|YY?|ww?|MM?M?M?|Do|DD?|hh?|HH?|mm?|ss?|S{1,3}|z|ZZ?)/g,s=/\d/,l=/\d\d/,f=/\d\d?/,i=/\d*[^-_:/,()\s\d]+/,x={},S=function(W){return(W=+W)+(W>68?1900:2e3)},I=function(W){return function(J){this[W]=+J}},R=[/[+-]\d\d:?(\d\d)?|Z/,function(W){(this.zone||(this.zone={})).offset=function(J){if(!J||J==="Z")return 0;var ie=J.match(/([+-]|\d\d)/g),he=60*ie[1]+(+ie[2]||0);return he===0?0:ie[0]==="+"?-he:he}(W)}],F=function(W){var J=x[W];return J&&(J.indexOf?J:J.s.concat(J.f))},j=function(W,J){var ie,he=x.meridiem;if(he){for(var ge=1;ge<=24;ge+=1)if(W.indexOf(he(ge,0,J))>-1){ie=ge>12;break}}else ie=W===(J?"pm":"PM");return ie},H={A:[i,function(W){this.afternoon=j(W,!1)}],a:[i,function(W){this.afternoon=j(W,!0)}],Q:[s,function(W){this.month=3*(W-1)+1}],S:[s,function(W){this.milliseconds=100*+W}],SS:[l,function(W){this.milliseconds=10*+W}],SSS:[/\d{3}/,function(W){this.milliseconds=+W}],s:[f,I("seconds")],ss:[f,I("seconds")],m:[f,I("minutes")],mm:[f,I("minutes")],H:[f,I("hours")],h:[f,I("hours")],HH:[f,I("hours")],hh:[f,I("hours")],D:[f,I("day")],DD:[l,I("day")],Do:[i,function(W){var J=x.ordinal,ie=W.match(/\d+/);if(this.day=ie[0],J)for(var he=1;he<=31;he+=1)J(he).replace(/\[|\]/g,"")===W&&(this.day=he)}],w:[f,I("week")],ww:[l,I("week")],M:[f,I("month")],MM:[l,I("month")],MMM:[i,function(W){var J=F("months"),ie=(F("monthsShort")||J.map(function(he){return he.slice(0,3)})).indexOf(W)+1;if(ie<1)throw new Error;this.month=ie%12||ie}],MMMM:[i,function(W){var J=F("months").indexOf(W)+1;if(J<1)throw new Error;this.month=J%12||J}],Y:[/[+-]?\d+/,I("year")],YY:[l,function(W){this.year=S(W)}],YYYY:[/\d{4}/,I("year")],Z:R,ZZ:R};function G(W){var J,ie;J=W,ie=x&&x.formats;for(var he=(W=J.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(Oe,ue,we){var ke=we&&we.toUpperCase();return ue||ie[we]||n[we]||ie[ke].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(De,je,ze){return je||ze.slice(1)})})).match(r),ge=he.length,fe=0;fe<ge;fe+=1){var ye=he[fe],pe=H[ye],be=pe&&pe[0],Ae=pe&&pe[1];he[fe]=Ae?{regex:be,parser:Ae}:ye.replace(/^\[|\]$/g,"")}return function(Oe){for(var ue={},we=0,ke=0;we<ge;we+=1){var De=he[we];if(typeof De=="string")ke+=De.length;else{var je=De.regex,ze=De.parser,Ue=Oe.slice(ke),Fe=je.exec(Ue)[0];ze.call(ue,Fe),Oe=Oe.replace(Fe,"")}}return function(Qe){var Be=Qe.afternoon;if(Be!==void 0){var bt=Qe.hours;Be?bt<12&&(Qe.hours+=12):bt===12&&(Qe.hours=0),delete Qe.afternoon}}(ue),ue}}return function(W,J,ie){ie.p.customParseFormat=!0,W&&W.parseTwoDigitYear&&(S=W.parseTwoDigitYear);var he=J.prototype,ge=he.parse;he.parse=function(fe){var ye=fe.date,pe=fe.utc,be=fe.args;this.$u=pe;var Ae=be[1];if(typeof Ae=="string"){var Oe=be[2]===!0,ue=be[3]===!0,we=Oe||ue,ke=be[2];ue&&(ke=be[2]),x=this.$locale(),!Oe&&ke&&(x=ie.Ls[ke]),this.$d=function(Ue,Fe,Qe,Be){try{if(["x","X"].indexOf(Fe)>-1)return new Date((Fe==="X"?1e3:1)*Ue);var bt=G(Fe)(Ue),xe=bt.year,Le=bt.month,Xe=bt.day,ct=bt.hours,vt=bt.minutes,Nt=bt.seconds,mt=bt.milliseconds,yt=bt.zone,_e=bt.week,on=new Date,Kt=Xe||(xe||Le?1:on.getDate()),Pn=xe||on.getFullYear(),Ut=0;xe&&!Le||(Ut=Le>0?Le-1:on.getMonth());var cn,At=ct||0,xr=vt||0,Rn=Nt||0,Dn=mt||0;return yt?new Date(Date.UTC(Pn,Ut,Kt,At,xr,Rn,Dn+60*yt.offset*1e3)):Qe?new Date(Date.UTC(Pn,Ut,Kt,At,xr,Rn,Dn)):(cn=new Date(Pn,Ut,Kt,At,xr,Rn,Dn),_e&&(cn=Be(cn).week(_e).toDate()),cn)}catch{return new Date("")}}(ye,Ae,pe,ie),this.init(),ke&&ke!==!0&&(this.$L=this.locale(ke).$L),we&&ye!=this.format(Ae)&&(this.$d=new Date("")),x={}}else if(Ae instanceof Array)for(var De=Ae.length,je=1;je<=De;je+=1){be[1]=Ae[je-1];var ze=ie.apply(this,be);if(ze.isValid()){this.$d=ze.$d,this.$L=ze.$L,this.init();break}je===De&&(this.$d=new Date(""))}else ge.call(this,fe)}}})}(OA)),OA.exports}var JAe=ZAe();const QAe=Xa(JAe);io.extend(QAe);td.accessToken="pk.eyJ1IjoiY29jb2xlbW9uMTIiLCJhIjoiY204YTBoMnZpMHplbzJzcTR3dDFmOXc4NiJ9.NqqEHSBe8cn9Gy9knbUqew";const eTe=()=>{const[t,e]=st.useState(""),[n,r]=st.useState(0),[s,l]=st.useState(0),[f,i]=st.useState(!1),[x,S]=st.useState(null),[I,R]=st.useState([]),[F,j]=st.useState({}),[H,G]=st.useState(0),[W,J]=st.useState({totalDistance:0,totalDuration:0,totalCalories:0,totalCarbon:0,totalRevenue:0}),[ie,he]=st.useState({today:0,weekly:0,monthly:0}),[ge,fe]=st.useState(Array(24).fill(0)),[ye,pe]=st.useState(0),be=st.useRef(null),Ae=st.useRef(null),Oe=st.useRef(null),ue=st.useRef({}),we=xe=>{let Le=xe.replace("UTC+","+").replace("UTC-","-");return Le=Le.replace(/([+\-]\d{1,2})$/,"$1:00"),io(Le,"D MMMM YYYY [at] HH:mm:ss Z")},ke=xe=>typeof xe=="string"?we(xe):xe&&typeof xe.toDate=="function"?io(xe.toDate()):io(xe),De=async()=>{try{const xe=await fs(ca(Yr,"bikes"));r(xe.size)}catch(xe){console.error("Error fetching total bikes:",xe)}},je=async()=>{try{const xe=io().startOf("day"),Le=ca(Yr,"ride_history"),Xe=await fs(Le);let ct=0;Xe.forEach(vt=>{const mt=vt.data().rideEndedAt;mt&&ke(mt).isSame(xe,"day")&&ct++}),console.log("Today's total rides:",ct),l(ct)}catch(xe){console.error("Error fetching total rides today:",xe)}},ze=async()=>{try{const xe=io().startOf("day"),Le=ca(Yr,"ride_history"),Xe=await fs(Le);let ct={totalDistance:0,totalDuration:0,totalCalories:0,totalCarbon:0,totalRevenue:0};Xe.forEach(vt=>{var mt,yt,_e;const Nt=vt.data();Nt.rideEndedAt&&ke(Nt.rideEndedAt).isSame(xe,"day")&&(ct.totalDistance+=((mt=Nt.currentMetrics)==null?void 0:mt.distance)||0,ct.totalDuration+=((yt=Nt.currentMetrics)==null?void 0:yt.duration)||0,ct.totalCalories+=((_e=Nt.currentMetrics)==null?void 0:_e.calories)||0,ct.totalCarbon+=Nt.carbonSaved||0,ct.totalRevenue+=Nt.amountPaid||0)}),J({totalDistance:ct.totalDistance||0,totalDuration:ct.totalDuration||0,totalCalories:ct.totalCalories||0,totalCarbon:ct.totalCarbon||0,totalRevenue:ct.totalRevenue||0})}catch(xe){console.error("Error fetching today's metrics:",xe)}},Ue=async()=>{try{const xe=await fs(ca(Yr,"approved_users"));let Le=0,Xe=0,ct=0;const vt=io().startOf("day"),Nt=io().startOf("week"),mt=io().startOf("month");for(const yt of xe.docs){const _e=ca(Yr,"approved_users",yt.id,"rideHistory"),on=await fs(_e);for(const Kt of on.docs){const Pn=Kt.data(),Ut=ke(Pn.rideStartedAt),cn=Pn.amountPaid||0;Ut.isSame(vt,"day")&&(Le+=cn),Ut.isAfter(Nt)&&(Xe+=cn),Ut.isAfter(mt)&&(ct+=cn)}}he({today:Le,weekly:Xe,monthly:ct})}catch(xe){console.error("Error fetching revenue:",xe)}},Fe=async()=>{try{const xe=io().startOf("day"),Le=ca(Yr,"ride_history");return Qm(Le,ct=>{let vt=Array(24).fill(0);ct.forEach(Nt=>{const mt=Nt.data();if(mt.rideEndedAt&&mt.amountPaid){const yt=ke(mt.rideEndedAt);if(yt.isSame(xe,"day")){const _e=yt.hour();vt[_e]+=Number(mt.amountPaid||0)}}}),console.log("Hourly revenue data:",vt),fe(vt)})}catch(xe){console.error("Error fetching hourly revenue:",xe)}},Qe=()=>{try{const xe=ca(Yr,"activeRides"),Le=x0(xe,XS("rideStatus","==","started"));return Qm(Le,async ct=>{const vt=[];for(const Nt of ct.docs){const mt=Nt.data();console.log("Ride data:",mt);try{const yt=ol(Yr,"approved_users",mt.userId),_e=await w0(yt),on=_e.exists()?_e.data():{};console.log("User data:",on);const Kt=ol(Yr,"bikes",mt.bikeId),Pn=await w0(Kt),Ut=Pn.exists()?Pn.data():{};console.log("Bike data:",Ut);let cn="Unknown Station";if(mt.startStation){console.log("Attempting to fetch station with ID:",mt.startStation);const xr=ol(Yr,"stations",mt.startStation),Rn=await w0(xr);if(console.log("Station doc exists:",Rn.exists()),Rn.exists()){const Dn=Rn.data();console.log("Station data:",Dn),cn=Dn.stationName||Dn.name||"Unknown Station"}}const At={rideId:Nt.id,userName:on.name||`${on.first_name||""} ${on.surname||""}`.trim(),startTime:mt.startTime,bikeName:Ut.bikeName||"Unknown Bike",stationName:cn};console.log("Pushing ride info:",At),vt.push(At)}catch(yt){console.error("Error fetching related documents:",yt),console.error("Error details:",{rideId:Nt.id,userId:mt.userId,bikeId:mt.bikeId,startStation:mt.startStation})}}console.log("Final active rides array:",vt),R(vt)})}catch(xe){return console.error("Error in fetchActiveRides:",xe),()=>{}}},Be=()=>{try{const xe=ca(Yr,"admins");return Qm(xe,Le=>{const Xe=Le.docs.reduce((ct,vt)=>{const Nt=vt.data();return Nt.status==="Active"&&Nt.stationAssignedTo?ct+1:ct},0);pe(Xe)})}catch(xe){return console.error("Error fetching active admins:",xe),()=>{}}};st.useEffect(()=>{De(),je(),ze(),Fe(),Ue();const xe=m2.onAuthStateChanged(async Le=>{if(Le)try{const Xe=ol(Yr,"users",Le.uid),ct=await w0(Xe);if(ct.exists()){const vt=ct.data(),Nt=(vt==null?void 0:vt.name)||"Super Admin";e(Nt)}else e("Super Admin")}catch(Xe){console.error("Error fetching user data:",Xe),e("Super Admin")}else e("Unknown User")});return()=>xe()},[]),st.useEffect(()=>{if(!(Ae.current||!be.current))try{Ae.current=new td.Map({container:be.current,style:"mapbox://styles/mapbox/streets-v11",center:[120.9882053036898,14.693467677226026],zoom:12}),Ae.current.addControl(new td.NavigationControl,"top-right");const xe=ca(Yr,"activeRides"),Le=Qm(x0(xe,XS("rideStatus","==","started")),Xe=>{Ae.current});return()=>{Le(),Ae.current&&(Ae.current.remove(),Ae.current=null)}}catch(xe){console.error("Error initializing map:",xe)}},[be.current]),st.useEffect(()=>{if(!Ae.current||!f||!x)return;const xe=Qm(ol(Yr,"activeRides",x),Le=>{const Xe=Le.data();if(Xe&&Xe.locationData){const{latitude:ct,longitude:vt}=Xe.locationData;Oe.current?Oe.current.setLngLat([vt,ct]):Oe.current=new td.Marker({color:"#FF0000",scale:.8}).setLngLat([vt,ct]).addTo(Ae.current),Ae.current.flyTo({center:[vt,ct],zoom:15})}});return()=>{xe(),Oe.current&&(Oe.current.remove(),Oe.current=null)}},[f,x]),st.useEffect(()=>{if(!Ae.current||!f)return;const xe=ca(Yr,"activeRides"),Le=x0(xe,XS("rideStatus","==","started")),Xe=Qm(Le,ct=>{ct.docChanges().forEach(vt=>{const Nt=vt.doc.data(),mt=vt.doc.id;(vt.type==="added"||vt.type==="modified")&&Nt.locationData&&(j(yt=>({...yt,[mt]:Nt.locationData})),ue.current[mt]?ue.current[mt].setLngLat([Nt.locationData.longitude,Nt.locationData.latitude]):ue.current[mt]=new td.Marker({color:"#FF0000",scale:.8}).setLngLat([Nt.locationData.longitude,Nt.locationData.latitude]).setPopup(new td.Popup().setHTML(`Ride ID: ${mt}`)).addTo(Ae.current)),vt.type==="removed"&&(ue.current[mt]&&(ue.current[mt].remove(),delete ue.current[mt]),j(yt=>{const _e={...yt};return delete _e[mt],_e}))})});return()=>{Xe(),Object.values(ue.current).forEach(ct=>ct.remove()),ue.current={}}},[f]),st.useEffect(()=>{const xe=ca(Yr,"activeRides"),Le=x0(xe,XS("rideStatus","==","started")),Xe=Qm(Le,ct=>{G(ct.size)});return()=>Xe()},[]),st.useEffect(()=>{let xe;try{xe=Qe()}catch(Le){console.error("Error setting up active rides listener:",Le)}return()=>{typeof xe=="function"&&xe()}},[]),st.useEffect(()=>{const xe=Be();return()=>{typeof xe=="function"&&xe()}},[]),st.useEffect(()=>{const xe=io().startOf("day"),Le=ca(Yr,"ride_history");let Xe=null;try{Xe=Qm(Le,ct=>{let vt={totalDistance:0,totalDuration:0,totalCalories:0,totalCarbon:0,totalRevenue:0},Nt=Array(24).fill(0),mt=0;ct.forEach(yt=>{const _e=yt.data();if(_e.rideEndedAt){const on=ke(_e.rideEndedAt);if(on.isSame(xe,"day")){vt.totalDistance+=Number(_e.distance||0),vt.totalDuration+=Number(_e.duration||0),vt.totalCalories+=Number(_e.caloriesBurned||0),vt.totalCarbon+=Number(_e.carbonSaved||0),vt.totalRevenue+=Number(_e.amountPaid||0);const Kt=on.hour();Nt[Kt]+=Number(_e.amountPaid||0),mt++}}}),J(vt),fe(Nt),l(mt)})}catch(ct){console.error("Error setting up ride history listener:",ct)}return()=>{typeof Xe=="function"&&Xe()}},[]);const bt=[{name:"Bikes Available",value:n},{name:"Active Users",value:H},{name:"Active Admins",value:ye},{name:"Today's Revenue",value:Number((W==null?void 0:W.totalRevenue)||0)},{name:"Rides Today",value:s}];return ne.jsxs("div",{className:"content-container",children:[ne.jsxs("div",{className:"content-header",children:[ne.jsxs("h1",{className:"content-header__title",children:["Hello ",t,"!"]}),ne.jsx("p",{className:"content-header__subtitle",children:"Keeping the wheels turning for a greener future."})]}),ne.jsx("div",{className:"stats-section",children:bt.map((xe,Le)=>ne.jsxs("div",{className:"stat-card",children:[ne.jsx("h3",{className:"stat-card__title",children:xe.name}),ne.jsx("p",{className:"stat-card__value",children:xe.name==="Today's Revenue"?Number(xe.value).toFixed(2):typeof xe.value>"u"?"0":xe.value})]},Le))}),ne.jsxs("div",{className:"tracking-section",children:[ne.jsxs("div",{className:"active-rides-table",children:[ne.jsx("h3",{className:"section-title",children:"Active Rides"}),ne.jsxs("table",{children:[ne.jsx("thead",{children:ne.jsxs("tr",{children:[ne.jsx("th",{children:"Rider Name"}),ne.jsx("th",{children:"Start Time"}),ne.jsx("th",{children:"Bike Name"}),ne.jsx("th",{children:"Station"})]})}),ne.jsxs("tbody",{children:[I.slice(0,5).map(xe=>ne.jsxs("tr",{children:[ne.jsx("td",{children:xe.userName}),ne.jsx("td",{children:ke(xe.startTime).format("HH:mm:ss")}),ne.jsx("td",{children:xe.bikeName}),ne.jsx("td",{children:xe.stationName})]},xe.rideId)),I.length===0&&ne.jsx("tr",{children:ne.jsx("td",{colSpan:"4",className:"no-rides",children:"No active rides at the moment"})})]})]})]}),ne.jsx("div",{className:"map-container",children:ne.jsx("div",{ref:be,className:"ride-tracking-map"})})]}),ne.jsxs("div",{className:"charts-grid",children:[ne.jsxs("div",{className:"charts-row",children:[ne.jsxs("div",{className:"chart-container",children:[ne.jsx("h3",{className:"chart-title",children:"Today's Ride Metrics"}),ne.jsx(fm,{width:"100%",height:300,children:ne.jsxs(_D,{data:[{name:"Distance",value:parseFloat(W.totalDistance||0),unit:"km"},{name:"Duration",value:parseFloat((W.totalDuration||0)/60),unit:"min"},{name:"Calories",value:parseFloat(W.totalCalories||0),unit:"cal"},{name:"CO2 Saved",value:parseFloat(W.totalCarbon||0),unit:"kg"}],margin:{top:5,right:30,left:20,bottom:60},children:[ne.jsx(dm,{strokeDasharray:"3 3"}),ne.jsx(wf,{dataKey:"name",angle:-45,textAnchor:"end",height:60,tick:{fontSize:12},interval:0}),ne.jsx(Sf,{tickFormatter:xe=>xe.toFixed(2),tick:{fontSize:12}}),ne.jsx(Rc,{formatter:(xe,Le,Xe)=>Xe&&Xe.payload?[`${xe.toFixed(2)} ${Xe.payload.unit}`,Le]:[xe,Le],contentStyle:{fontSize:12}}),ne.jsx(xg,{dataKey:"value",fill:"#009C8C",children:ne.jsx(Ep,{dataKey:"value",position:"top",formatter:(xe,Le)=>Le&&Le.payload?`${xe.toFixed(2)} ${Le.payload.unit}`:xe.toFixed(2),style:{fontSize:"11px"}})})]})})]}),ne.jsxs("div",{className:"chart-container",children:[ne.jsx("h3",{className:"chart-title",children:"System Overview"}),ne.jsx(fm,{width:"100%",height:300,children:ne.jsxs(_D,{data:bt,margin:{top:5,right:30,left:20,bottom:60},children:[ne.jsx(dm,{strokeDasharray:"3 3"}),ne.jsx(wf,{dataKey:"name",angle:-45,textAnchor:"end",height:60,tick:{fontSize:12},interval:0}),ne.jsx(Sf,{tick:{fontSize:12}}),ne.jsx(Rc,{contentStyle:{fontSize:12}}),ne.jsx(xg,{dataKey:"value",fill:"#009C8C"})]})})]})]}),ne.jsxs("div",{className:"revenue-section",children:[ne.jsx("h3",{className:"chart-title",children:"Today's Hourly Revenue"}),ne.jsx(fm,{width:"100%",height:300,children:ne.jsxs(HAe,{data:ge.map((xe,Le)=>({hour:`${String(Le).padStart(2,"0")}:00`,value:xe})),margin:{top:5,right:30,left:20,bottom:5},children:[ne.jsx(dm,{strokeDasharray:"3 3"}),ne.jsx(wf,{dataKey:"hour",tick:{fontSize:12},interval:2}),ne.jsx(Sf,{tick:{fontSize:12},tickFormatter:xe=>`₱${xe.toFixed(2)}`}),ne.jsx(Rc,{formatter:xe=>[`₱${Number(xe).toFixed(2)}`,"Revenue"],contentStyle:{fontSize:12}}),ne.jsx(E2,{type:"monotone",dataKey:"value",stroke:"#4CAF50",strokeWidth:2,dot:{fill:"#4CAF50"}})]})})]})]})]})},IO=()=>ne.jsxs("div",{className:"dashboard",children:[ne.jsx(dK,{})," ",ne.jsxs("div",{className:"dashboard-content",children:[ne.jsx(g2,{})," ",ne.jsx(eTe,{})," "]})]}),lm=()=>{const t=jD(),[e,n]=st.useState(""),[r,s]=st.useState(""),[l,f]=st.useState(""),i=S=>`/ecpcaps/assets/${S}`,x=async S=>{S.preventDefault();try{await wie(m2,e,r),t("/dashboard")}catch(I){f(I.message)}};return ne.jsxs("div",{className:"login-container",children:[ne.jsx("div",{className:"login-logo-container",children:ne.jsx("img",{src:i("ecoridelogo2.png"),alt:"Eco Ride Logo",className:"login-logo"})}),ne.jsx("p",{className:"login-subtitle",children:"Drive Green, Ride Clean!"}),ne.jsx("h2",{className:"login-title",children:"Super Admin Login"}),ne.jsxs("form",{className:"login-form",onSubmit:x,children:[l&&ne.jsx("p",{className:"error",children:l}),ne.jsxs("div",{className:"form-group",children:[ne.jsx("label",{children:"Email"}),ne.jsx("input",{type:"email",value:e,onChange:S=>n(S.target.value),required:!0})]}),ne.jsxs("div",{className:"form-group",children:[ne.jsx("label",{children:"Password"}),ne.jsx("input",{type:"password",required:!0,autoComplete:"current-password",value:r,onChange:S=>s(S.target.value)})]}),ne.jsx("button",{type:"submit",className:"login-button",children:"LOG IN"})]})]})},vv=({children:t})=>ne.jsxs("div",{className:"layout",children:[ne.jsx(dK,{}),ne.jsx("div",{className:"content",children:t})]}),tTe=()=>{const[t,e]=st.useState([]),[n,r]=st.useState(""),[s,l]=st.useState(1),f=5;st.useEffect(()=>{i()},[]);const i=async()=>{try{const j=(await fs(ca(Yr,"approved_users"))).docs.map(H=>({uid:H.id,...H.data()}));e(j)}catch(F){console.error("Error fetching registered users:",F)}},x=st.useMemo(()=>t.filter(F=>`${F.first_name} ${F.middle_name} ${F.surname} ${F.email}`.toLowerCase().includes(n.toLowerCase())),[t,n]),S=Math.ceil(x.length/f),I=st.useMemo(()=>{const F=(s-1)*f;return x.slice(F,F+f)},[x,s]),R=({status:F})=>{switch(F){case"approved":return ne.jsx(Vce,{className:"status-icon approved",title:"Approved"});default:return null}};return ne.jsxs(vv,{children:[ne.jsx(g2,{title:"User Management"}),ne.jsx("div",{className:"user-management",children:ne.jsxs("div",{className:"section",children:[ne.jsx("h2",{children:"Registered Users"}),ne.jsx("input",{type:"text",placeholder:"🔍 Search registered users...",value:n,onChange:F=>r(F.target.value),className:"search-box"}),x.length===0?ne.jsx("p",{children:"No registered users found."}):ne.jsxs("div",{className:"user-list",children:[ne.jsxs("table",{children:[ne.jsx("thead",{children:ne.jsxs("tr",{children:[ne.jsx("th",{children:"Status"}),ne.jsx("th",{children:"Profile Photo"}),ne.jsx("th",{children:"Name"}),ne.jsx("th",{children:"Email"}),ne.jsx("th",{children:"Address"})]})}),ne.jsx("tbody",{children:I.map(F=>ne.jsxs("tr",{children:[ne.jsx("td",{children:ne.jsx(R,{status:F.status})}),ne.jsx("td",{children:F.profile_photo_url?ne.jsx("img",{src:F.profile_photo_url,alt:"Profile",className:"profile-thumbnail"}):ne.jsx("div",{className:"no-photo",children:"No Photo"})}),ne.jsx("td",{children:`${F.first_name} ${F.middle_name} ${F.surname}`}),ne.jsx("td",{children:F.email}),ne.jsx("td",{children:F.address})]},F.uid))})]}),ne.jsxs("div",{className:"pagination",children:[ne.jsx("button",{disabled:s===1,onClick:()=>l(s-1),children:"Previous"}),Array.from({length:S},(F,j)=>ne.jsx("button",{className:s===j+1?"active":"",onClick:()=>l(j+1),children:j+1},j)),ne.jsx("button",{disabled:s===S,onClick:()=>l(s+1),children:"Next"})]})]})]})})]})};function FZ(t,e){return function(){return t.apply(e,arguments)}}const{toString:nTe}=Object.prototype,{getPrototypeOf:hN}=Object,jE=(t=>e=>{const n=nTe.call(e);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Dp=t=>(t=t.toLowerCase(),e=>jE(e)===t),FE=t=>e=>typeof e===t,{isArray:$1}=Array,Uw=FE("undefined");function rTe(t){return t!==null&&!Uw(t)&&t.constructor!==null&&!Uw(t.constructor)&&ld(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const UZ=Dp("ArrayBuffer");function iTe(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&UZ(t.buffer),e}const aTe=FE("string"),ld=FE("function"),qZ=FE("number"),UE=t=>t!==null&&typeof t=="object",sTe=t=>t===!0||t===!1,RA=t=>{if(jE(t)!=="object")return!1;const e=hN(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},oTe=Dp("Date"),lTe=Dp("File"),cTe=Dp("Blob"),uTe=Dp("FileList"),hTe=t=>UE(t)&&ld(t.pipe),fTe=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||ld(t.append)&&((e=jE(t))==="formdata"||e==="object"&&ld(t.toString)&&t.toString()==="[object FormData]"))},dTe=Dp("URLSearchParams"),[pTe,mTe,gTe,yTe]=["ReadableStream","Request","Response","Headers"].map(Dp),_Te=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function M2(t,e,{allOwnKeys:n=!1}={}){if(t===null||typeof t>"u")return;let r,s;if(typeof t!="object"&&(t=[t]),$1(t))for(r=0,s=t.length;r<s;r++)e.call(null,t[r],r,t);else{const l=n?Object.getOwnPropertyNames(t):Object.keys(t),f=l.length;let i;for(r=0;r<f;r++)i=l[r],e.call(null,t[i],i,t)}}function VZ(t,e){e=e.toLowerCase();const n=Object.keys(t);let r=n.length,s;for(;r-- >0;)if(s=n[r],e===s.toLowerCase())return s;return null}const V_=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,$Z=t=>!Uw(t)&&t!==V_;function vD(){const{caseless:t}=$Z(this)&&this||{},e={},n=(r,s)=>{const l=t&&VZ(e,s)||s;RA(e[l])&&RA(r)?e[l]=vD(e[l],r):RA(r)?e[l]=vD({},r):$1(r)?e[l]=r.slice():e[l]=r};for(let r=0,s=arguments.length;r<s;r++)arguments[r]&&M2(arguments[r],n);return e}const vTe=(t,e,n,{allOwnKeys:r}={})=>(M2(e,(s,l)=>{n&&ld(s)?t[l]=FZ(s,n):t[l]=s},{allOwnKeys:r}),t),bTe=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),xTe=(t,e,n,r)=>{t.prototype=Object.create(e.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},wTe=(t,e,n,r)=>{let s,l,f;const i={};if(e=e||{},t==null)return e;do{for(s=Object.getOwnPropertyNames(t),l=s.length;l-- >0;)f=s[l],(!r||r(f,t,e))&&!i[f]&&(e[f]=t[f],i[f]=!0);t=n!==!1&&hN(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},STe=(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const r=t.indexOf(e,n);return r!==-1&&r===n},ATe=t=>{if(!t)return null;if($1(t))return t;let e=t.length;if(!qZ(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},TTe=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&hN(Uint8Array)),ETe=(t,e)=>{const r=(t&&t[Symbol.iterator]).call(t);let s;for(;(s=r.next())&&!s.done;){const l=s.value;e.call(t,l[0],l[1])}},MTe=(t,e)=>{let n;const r=[];for(;(n=t.exec(e))!==null;)r.push(n);return r},CTe=Dp("HTMLFormElement"),ITe=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,r,s){return r.toUpperCase()+s}),SV=(({hasOwnProperty:t})=>(e,n)=>t.call(e,n))(Object.prototype),PTe=Dp("RegExp"),HZ=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),r={};M2(n,(s,l)=>{let f;(f=e(s,l,t))!==!1&&(r[l]=f||s)}),Object.defineProperties(t,r)},OTe=t=>{HZ(t,(e,n)=>{if(ld(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=t[n];if(ld(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},RTe=(t,e)=>{const n={},r=s=>{s.forEach(l=>{n[l]=!0})};return $1(t)?r(t):r(String(t).split(e)),n},DTe=()=>{},LTe=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e;function kTe(t){return!!(t&&ld(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const NTe=t=>{const e=new Array(10),n=(r,s)=>{if(UE(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[s]=r;const l=$1(r)?[]:{};return M2(r,(f,i)=>{const x=n(f,s+1);!Uw(x)&&(l[i]=x)}),e[s]=void 0,l}}return r};return n(t,0)},zTe=Dp("AsyncFunction"),BTe=t=>t&&(UE(t)||ld(t))&&ld(t.then)&&ld(t.catch),GZ=((t,e)=>t?setImmediate:e?((n,r)=>(V_.addEventListener("message",({source:s,data:l})=>{s===V_&&l===n&&r.length&&r.shift()()},!1),s=>{r.push(s),V_.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",ld(V_.postMessage)),jTe=typeof queueMicrotask<"u"?queueMicrotask.bind(V_):typeof process<"u"&&process.nextTick||GZ,jn={isArray:$1,isArrayBuffer:UZ,isBuffer:rTe,isFormData:fTe,isArrayBufferView:iTe,isString:aTe,isNumber:qZ,isBoolean:sTe,isObject:UE,isPlainObject:RA,isReadableStream:pTe,isRequest:mTe,isResponse:gTe,isHeaders:yTe,isUndefined:Uw,isDate:oTe,isFile:lTe,isBlob:cTe,isRegExp:PTe,isFunction:ld,isStream:hTe,isURLSearchParams:dTe,isTypedArray:TTe,isFileList:uTe,forEach:M2,merge:vD,extend:vTe,trim:_Te,stripBOM:bTe,inherits:xTe,toFlatObject:wTe,kindOf:jE,kindOfTest:Dp,endsWith:STe,toArray:ATe,forEachEntry:ETe,matchAll:MTe,isHTMLForm:CTe,hasOwnProperty:SV,hasOwnProp:SV,reduceDescriptors:HZ,freezeMethods:OTe,toObjectSet:RTe,toCamelCase:ITe,noop:DTe,toFiniteNumber:LTe,findKey:VZ,global:V_,isContextDefined:$Z,isSpecCompliantForm:kTe,toJSONObject:NTe,isAsyncFn:zTe,isThenable:BTe,setImmediate:GZ,asap:jTe};function ha(t,e,n,r,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),r&&(this.request=r),s&&(this.response=s,this.status=s.status?s.status:null)}jn.inherits(ha,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:jn.toJSONObject(this.config),code:this.code,status:this.status}}});const WZ=ha.prototype,KZ={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{KZ[t]={value:t}});Object.defineProperties(ha,KZ);Object.defineProperty(WZ,"isAxiosError",{value:!0});ha.from=(t,e,n,r,s,l)=>{const f=Object.create(WZ);return jn.toFlatObject(t,f,function(x){return x!==Error.prototype},i=>i!=="isAxiosError"),ha.call(f,t.message,e,n,r,s),f.cause=t,f.name=t.name,l&&Object.assign(f,l),f};const FTe=null;function bD(t){return jn.isPlainObject(t)||jn.isArray(t)}function YZ(t){return jn.endsWith(t,"[]")?t.slice(0,-2):t}function AV(t,e,n){return t?t.concat(e).map(function(s,l){return s=YZ(s),!n&&l?"["+s+"]":s}).join(n?".":""):e}function UTe(t){return jn.isArray(t)&&!t.some(bD)}const qTe=jn.toFlatObject(jn,{},null,function(e){return/^is[A-Z]/.test(e)});function qE(t,e,n){if(!jn.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,n=jn.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(G,W){return!jn.isUndefined(W[G])});const r=n.metaTokens,s=n.visitor||I,l=n.dots,f=n.indexes,x=(n.Blob||typeof Blob<"u"&&Blob)&&jn.isSpecCompliantForm(e);if(!jn.isFunction(s))throw new TypeError("visitor must be a function");function S(H){if(H===null)return"";if(jn.isDate(H))return H.toISOString();if(!x&&jn.isBlob(H))throw new ha("Blob is not supported. Use a Buffer instead.");return jn.isArrayBuffer(H)||jn.isTypedArray(H)?x&&typeof Blob=="function"?new Blob([H]):Buffer.from(H):H}function I(H,G,W){let J=H;if(H&&!W&&typeof H=="object"){if(jn.endsWith(G,"{}"))G=r?G:G.slice(0,-2),H=JSON.stringify(H);else if(jn.isArray(H)&&UTe(H)||(jn.isFileList(H)||jn.endsWith(G,"[]"))&&(J=jn.toArray(H)))return G=YZ(G),J.forEach(function(he,ge){!(jn.isUndefined(he)||he===null)&&e.append(f===!0?AV([G],ge,l):f===null?G:G+"[]",S(he))}),!1}return bD(H)?!0:(e.append(AV(W,G,l),S(H)),!1)}const R=[],F=Object.assign(qTe,{defaultVisitor:I,convertValue:S,isVisitable:bD});function j(H,G){if(!jn.isUndefined(H)){if(R.indexOf(H)!==-1)throw Error("Circular reference detected in "+G.join("."));R.push(H),jn.forEach(H,function(J,ie){(!(jn.isUndefined(J)||J===null)&&s.call(e,J,jn.isString(ie)?ie.trim():ie,G,F))===!0&&j(J,G?G.concat(ie):[ie])}),R.pop()}}if(!jn.isObject(t))throw new TypeError("data must be an object");return j(t),e}function TV(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function fN(t,e){this._pairs=[],t&&qE(t,this,e)}const XZ=fN.prototype;XZ.append=function(e,n){this._pairs.push([e,n])};XZ.toString=function(e){const n=e?function(r){return e.call(this,r,TV)}:TV;return this._pairs.map(function(s){return n(s[0])+"="+n(s[1])},"").join("&")};function VTe(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function ZZ(t,e,n){if(!e)return t;const r=n&&n.encode||VTe;jn.isFunction(n)&&(n={serialize:n});const s=n&&n.serialize;let l;if(s?l=s(e,n):l=jn.isURLSearchParams(e)?e.toString():new fN(e,n).toString(r),l){const f=t.indexOf("#");f!==-1&&(t=t.slice(0,f)),t+=(t.indexOf("?")===-1?"?":"&")+l}return t}class EV{constructor(){this.handlers=[]}use(e,n,r){return this.handlers.push({fulfilled:e,rejected:n,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){jn.forEach(this.handlers,function(r){r!==null&&e(r)})}}const JZ={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},$Te=typeof URLSearchParams<"u"?URLSearchParams:fN,HTe=typeof FormData<"u"?FormData:null,GTe=typeof Blob<"u"?Blob:null,WTe={isBrowser:!0,classes:{URLSearchParams:$Te,FormData:HTe,Blob:GTe},protocols:["http","https","file","blob","url","data"]},dN=typeof window<"u"&&typeof document<"u",xD=typeof navigator=="object"&&navigator||void 0,KTe=dN&&(!xD||["ReactNative","NativeScript","NS"].indexOf(xD.product)<0),YTe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",XTe=dN&&window.location.href||"http://localhost",ZTe=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:dN,hasStandardBrowserEnv:KTe,hasStandardBrowserWebWorkerEnv:YTe,navigator:xD,origin:XTe},Symbol.toStringTag,{value:"Module"})),ch={...ZTe,...WTe};function JTe(t,e){return qE(t,new ch.classes.URLSearchParams,Object.assign({visitor:function(n,r,s,l){return ch.isNode&&jn.isBuffer(n)?(this.append(r,n.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)}},e))}function QTe(t){return jn.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function e5e(t){const e={},n=Object.keys(t);let r;const s=n.length;let l;for(r=0;r<s;r++)l=n[r],e[l]=t[l];return e}function QZ(t){function e(n,r,s,l){let f=n[l++];if(f==="__proto__")return!0;const i=Number.isFinite(+f),x=l>=n.length;return f=!f&&jn.isArray(s)?s.length:f,x?(jn.hasOwnProp(s,f)?s[f]=[s[f],r]:s[f]=r,!i):((!s[f]||!jn.isObject(s[f]))&&(s[f]=[]),e(n,r,s[f],l)&&jn.isArray(s[f])&&(s[f]=e5e(s[f])),!i)}if(jn.isFormData(t)&&jn.isFunction(t.entries)){const n={};return jn.forEachEntry(t,(r,s)=>{e(QTe(r),s,n,0)}),n}return null}function t5e(t,e,n){if(jn.isString(t))try{return(e||JSON.parse)(t),jn.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(n||JSON.stringify)(t)}const C2={transitional:JZ,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const r=n.getContentType()||"",s=r.indexOf("application/json")>-1,l=jn.isObject(e);if(l&&jn.isHTMLForm(e)&&(e=new FormData(e)),jn.isFormData(e))return s?JSON.stringify(QZ(e)):e;if(jn.isArrayBuffer(e)||jn.isBuffer(e)||jn.isStream(e)||jn.isFile(e)||jn.isBlob(e)||jn.isReadableStream(e))return e;if(jn.isArrayBufferView(e))return e.buffer;if(jn.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let i;if(l){if(r.indexOf("application/x-www-form-urlencoded")>-1)return JTe(e,this.formSerializer).toString();if((i=jn.isFileList(e))||r.indexOf("multipart/form-data")>-1){const x=this.env&&this.env.FormData;return qE(i?{"files[]":e}:e,x&&new x,this.formSerializer)}}return l||s?(n.setContentType("application/json",!1),t5e(e)):e}],transformResponse:[function(e){const n=this.transitional||C2.transitional,r=n&&n.forcedJSONParsing,s=this.responseType==="json";if(jn.isResponse(e)||jn.isReadableStream(e))return e;if(e&&jn.isString(e)&&(r&&!this.responseType||s)){const f=!(n&&n.silentJSONParsing)&&s;try{return JSON.parse(e)}catch(i){if(f)throw i.name==="SyntaxError"?ha.from(i,ha.ERR_BAD_RESPONSE,this,null,this.response):i}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ch.classes.FormData,Blob:ch.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};jn.forEach(["delete","get","head","post","put","patch"],t=>{C2.headers[t]={}});const n5e=jn.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),r5e=t=>{const e={};let n,r,s;return t&&t.split(`
`).forEach(function(f){s=f.indexOf(":"),n=f.substring(0,s).trim().toLowerCase(),r=f.substring(s+1).trim(),!(!n||e[n]&&n5e[n])&&(n==="set-cookie"?e[n]?e[n].push(r):e[n]=[r]:e[n]=e[n]?e[n]+", "+r:r)}),e},MV=Symbol("internals");function fx(t){return t&&String(t).trim().toLowerCase()}function DA(t){return t===!1||t==null?t:jn.isArray(t)?t.map(DA):String(t)}function i5e(t){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(t);)e[r[1]]=r[2];return e}const a5e=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function PO(t,e,n,r,s){if(jn.isFunction(r))return r.call(this,e,n);if(s&&(e=n),!!jn.isString(e)){if(jn.isString(r))return e.indexOf(r)!==-1;if(jn.isRegExp(r))return r.test(e)}}function s5e(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,r)=>n.toUpperCase()+r)}function o5e(t,e){const n=jn.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+n,{value:function(s,l,f){return this[r].call(this,e,s,l,f)},configurable:!0})})}let Mf=class{constructor(e){e&&this.set(e)}set(e,n,r){const s=this;function l(i,x,S){const I=fx(x);if(!I)throw new Error("header name must be a non-empty string");const R=jn.findKey(s,I);(!R||s[R]===void 0||S===!0||S===void 0&&s[R]!==!1)&&(s[R||x]=DA(i))}const f=(i,x)=>jn.forEach(i,(S,I)=>l(S,I,x));if(jn.isPlainObject(e)||e instanceof this.constructor)f(e,n);else if(jn.isString(e)&&(e=e.trim())&&!a5e(e))f(r5e(e),n);else if(jn.isHeaders(e))for(const[i,x]of e.entries())l(x,i,r);else e!=null&&l(n,e,r);return this}get(e,n){if(e=fx(e),e){const r=jn.findKey(this,e);if(r){const s=this[r];if(!n)return s;if(n===!0)return i5e(s);if(jn.isFunction(n))return n.call(this,s,r);if(jn.isRegExp(n))return n.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=fx(e),e){const r=jn.findKey(this,e);return!!(r&&this[r]!==void 0&&(!n||PO(this,this[r],r,n)))}return!1}delete(e,n){const r=this;let s=!1;function l(f){if(f=fx(f),f){const i=jn.findKey(r,f);i&&(!n||PO(r,r[i],i,n))&&(delete r[i],s=!0)}}return jn.isArray(e)?e.forEach(l):l(e),s}clear(e){const n=Object.keys(this);let r=n.length,s=!1;for(;r--;){const l=n[r];(!e||PO(this,this[l],l,e,!0))&&(delete this[l],s=!0)}return s}normalize(e){const n=this,r={};return jn.forEach(this,(s,l)=>{const f=jn.findKey(r,l);if(f){n[f]=DA(s),delete n[l];return}const i=e?s5e(l):String(l).trim();i!==l&&delete n[l],n[i]=DA(s),r[i]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const n=Object.create(null);return jn.forEach(this,(r,s)=>{r!=null&&r!==!1&&(n[s]=e&&jn.isArray(r)?r.join(", "):r)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,n])=>e+": "+n).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...n){const r=new this(e);return n.forEach(s=>r.set(s)),r}static accessor(e){const r=(this[MV]=this[MV]={accessors:{}}).accessors,s=this.prototype;function l(f){const i=fx(f);r[i]||(o5e(s,f),r[i]=!0)}return jn.isArray(e)?e.forEach(l):l(e),this}};Mf.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);jn.reduceDescriptors(Mf.prototype,({value:t},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(r){this[n]=r}}});jn.freezeMethods(Mf);function OO(t,e){const n=this||C2,r=e||n,s=Mf.from(r.headers);let l=r.data;return jn.forEach(t,function(i){l=i.call(n,l,s.normalize(),e?e.status:void 0)}),s.normalize(),l}function eJ(t){return!!(t&&t.__CANCEL__)}function H1(t,e,n){ha.call(this,t??"canceled",ha.ERR_CANCELED,e,n),this.name="CanceledError"}jn.inherits(H1,ha,{__CANCEL__:!0});function tJ(t,e,n){const r=n.config.validateStatus;!n.status||!r||r(n.status)?t(n):e(new ha("Request failed with status code "+n.status,[ha.ERR_BAD_REQUEST,ha.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function l5e(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function c5e(t,e){t=t||10;const n=new Array(t),r=new Array(t);let s=0,l=0,f;return e=e!==void 0?e:1e3,function(x){const S=Date.now(),I=r[l];f||(f=S),n[s]=x,r[s]=S;let R=l,F=0;for(;R!==s;)F+=n[R++],R=R%t;if(s=(s+1)%t,s===l&&(l=(l+1)%t),S-f<e)return;const j=I&&S-I;return j?Math.round(F*1e3/j):void 0}}function u5e(t,e){let n=0,r=1e3/e,s,l;const f=(S,I=Date.now())=>{n=I,s=null,l&&(clearTimeout(l),l=null),t.apply(null,S)};return[(...S)=>{const I=Date.now(),R=I-n;R>=r?f(S,I):(s=S,l||(l=setTimeout(()=>{l=null,f(s)},r-R)))},()=>s&&f(s)]}const f5=(t,e,n=3)=>{let r=0;const s=c5e(50,250);return u5e(l=>{const f=l.loaded,i=l.lengthComputable?l.total:void 0,x=f-r,S=s(x),I=f<=i;r=f;const R={loaded:f,total:i,progress:i?f/i:void 0,bytes:x,rate:S||void 0,estimated:S&&i&&I?(i-f)/S:void 0,event:l,lengthComputable:i!=null,[e?"download":"upload"]:!0};t(R)},n)},CV=(t,e)=>{const n=t!=null;return[r=>e[0]({lengthComputable:n,total:t,loaded:r}),e[1]]},IV=t=>(...e)=>jn.asap(()=>t(...e)),h5e=ch.hasStandardBrowserEnv?((t,e)=>n=>(n=new URL(n,ch.origin),t.protocol===n.protocol&&t.host===n.host&&(e||t.port===n.port)))(new URL(ch.origin),ch.navigator&&/(msie|trident)/i.test(ch.navigator.userAgent)):()=>!0,f5e=ch.hasStandardBrowserEnv?{write(t,e,n,r,s,l){const f=[t+"="+encodeURIComponent(e)];jn.isNumber(n)&&f.push("expires="+new Date(n).toGMTString()),jn.isString(r)&&f.push("path="+r),jn.isString(s)&&f.push("domain="+s),l===!0&&f.push("secure"),document.cookie=f.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function d5e(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function p5e(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function nJ(t,e,n){let r=!d5e(e);return t&&(r||n==!1)?p5e(t,e):e}const PV=t=>t instanceof Mf?{...t}:t;function cv(t,e){e=e||{};const n={};function r(S,I,R,F){return jn.isPlainObject(S)&&jn.isPlainObject(I)?jn.merge.call({caseless:F},S,I):jn.isPlainObject(I)?jn.merge({},I):jn.isArray(I)?I.slice():I}function s(S,I,R,F){if(jn.isUndefined(I)){if(!jn.isUndefined(S))return r(void 0,S,R,F)}else return r(S,I,R,F)}function l(S,I){if(!jn.isUndefined(I))return r(void 0,I)}function f(S,I){if(jn.isUndefined(I)){if(!jn.isUndefined(S))return r(void 0,S)}else return r(void 0,I)}function i(S,I,R){if(R in e)return r(S,I);if(R in t)return r(void 0,S)}const x={url:l,method:l,data:l,baseURL:f,transformRequest:f,transformResponse:f,paramsSerializer:f,timeout:f,timeoutMessage:f,withCredentials:f,withXSRFToken:f,adapter:f,responseType:f,xsrfCookieName:f,xsrfHeaderName:f,onUploadProgress:f,onDownloadProgress:f,decompress:f,maxContentLength:f,maxBodyLength:f,beforeRedirect:f,transport:f,httpAgent:f,httpsAgent:f,cancelToken:f,socketPath:f,responseEncoding:f,validateStatus:i,headers:(S,I,R)=>s(PV(S),PV(I),R,!0)};return jn.forEach(Object.keys(Object.assign({},t,e)),function(I){const R=x[I]||s,F=R(t[I],e[I],I);jn.isUndefined(F)&&R!==i||(n[I]=F)}),n}const rJ=t=>{const e=cv({},t);let{data:n,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:l,headers:f,auth:i}=e;e.headers=f=Mf.from(f),e.url=ZZ(nJ(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),i&&f.set("Authorization","Basic "+btoa((i.username||"")+":"+(i.password?unescape(encodeURIComponent(i.password)):"")));let x;if(jn.isFormData(n)){if(ch.hasStandardBrowserEnv||ch.hasStandardBrowserWebWorkerEnv)f.setContentType(void 0);else if((x=f.getContentType())!==!1){const[S,...I]=x?x.split(";").map(R=>R.trim()).filter(Boolean):[];f.setContentType([S||"multipart/form-data",...I].join("; "))}}if(ch.hasStandardBrowserEnv&&(r&&jn.isFunction(r)&&(r=r(e)),r||r!==!1&&h5e(e.url))){const S=s&&l&&f5e.read(l);S&&f.set(s,S)}return e},m5e=typeof XMLHttpRequest<"u",g5e=m5e&&function(t){return new Promise(function(n,r){const s=rJ(t);let l=s.data;const f=Mf.from(s.headers).normalize();let{responseType:i,onUploadProgress:x,onDownloadProgress:S}=s,I,R,F,j,H;function G(){j&&j(),H&&H(),s.cancelToken&&s.cancelToken.unsubscribe(I),s.signal&&s.signal.removeEventListener("abort",I)}let W=new XMLHttpRequest;W.open(s.method.toUpperCase(),s.url,!0),W.timeout=s.timeout;function J(){if(!W)return;const he=Mf.from("getAllResponseHeaders"in W&&W.getAllResponseHeaders()),fe={data:!i||i==="text"||i==="json"?W.responseText:W.response,status:W.status,statusText:W.statusText,headers:he,config:t,request:W};tJ(function(pe){n(pe),G()},function(pe){r(pe),G()},fe),W=null}"onloadend"in W?W.onloadend=J:W.onreadystatechange=function(){!W||W.readyState!==4||W.status===0&&!(W.responseURL&&W.responseURL.indexOf("file:")===0)||setTimeout(J)},W.onabort=function(){W&&(r(new ha("Request aborted",ha.ECONNABORTED,t,W)),W=null)},W.onerror=function(){r(new ha("Network Error",ha.ERR_NETWORK,t,W)),W=null},W.ontimeout=function(){let ge=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const fe=s.transitional||JZ;s.timeoutErrorMessage&&(ge=s.timeoutErrorMessage),r(new ha(ge,fe.clarifyTimeoutError?ha.ETIMEDOUT:ha.ECONNABORTED,t,W)),W=null},l===void 0&&f.setContentType(null),"setRequestHeader"in W&&jn.forEach(f.toJSON(),function(ge,fe){W.setRequestHeader(fe,ge)}),jn.isUndefined(s.withCredentials)||(W.withCredentials=!!s.withCredentials),i&&i!=="json"&&(W.responseType=s.responseType),S&&([F,H]=f5(S,!0),W.addEventListener("progress",F)),x&&W.upload&&([R,j]=f5(x),W.upload.addEventListener("progress",R),W.upload.addEventListener("loadend",j)),(s.cancelToken||s.signal)&&(I=he=>{W&&(r(!he||he.type?new H1(null,t,W):he),W.abort(),W=null)},s.cancelToken&&s.cancelToken.subscribe(I),s.signal&&(s.signal.aborted?I():s.signal.addEventListener("abort",I)));const ie=l5e(s.url);if(ie&&ch.protocols.indexOf(ie)===-1){r(new ha("Unsupported protocol "+ie+":",ha.ERR_BAD_REQUEST,t));return}W.send(l||null)})},y5e=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let r=new AbortController,s;const l=function(S){if(!s){s=!0,i();const I=S instanceof Error?S:this.reason;r.abort(I instanceof ha?I:new H1(I instanceof Error?I.message:I))}};let f=e&&setTimeout(()=>{f=null,l(new ha(`timeout ${e} of ms exceeded`,ha.ETIMEDOUT))},e);const i=()=>{t&&(f&&clearTimeout(f),f=null,t.forEach(S=>{S.unsubscribe?S.unsubscribe(l):S.removeEventListener("abort",l)}),t=null)};t.forEach(S=>S.addEventListener("abort",l));const{signal:x}=r;return x.unsubscribe=()=>jn.asap(i),x}},_5e=function*(t,e){let n=t.byteLength;if(n<e){yield t;return}let r=0,s;for(;r<n;)s=r+e,yield t.slice(r,s),r=s},v5e=async function*(t,e){for await(const n of b5e(t))yield*_5e(n,e)},b5e=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:n,value:r}=await e.read();if(n)break;yield r}}finally{await e.cancel()}},OV=(t,e,n,r)=>{const s=v5e(t,e);let l=0,f,i=x=>{f||(f=!0,r&&r(x))};return new ReadableStream({async pull(x){try{const{done:S,value:I}=await s.next();if(S){i(),x.close();return}let R=I.byteLength;if(n){let F=l+=R;n(F)}x.enqueue(new Uint8Array(I))}catch(S){throw i(S),S}},cancel(x){return i(x),s.return()}},{highWaterMark:2})},VE=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",iJ=VE&&typeof ReadableStream=="function",x5e=VE&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),aJ=(t,...e)=>{try{return!!t(...e)}catch{return!1}},w5e=iJ&&aJ(()=>{let t=!1;const e=new Request(ch.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),RV=64*1024,wD=iJ&&aJ(()=>jn.isReadableStream(new Response("").body)),d5={stream:wD&&(t=>t.body)};VE&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!d5[e]&&(d5[e]=jn.isFunction(t[e])?n=>n[e]():(n,r)=>{throw new ha(`Response type '${e}' is not supported`,ha.ERR_NOT_SUPPORT,r)})})})(new Response);const S5e=async t=>{if(t==null)return 0;if(jn.isBlob(t))return t.size;if(jn.isSpecCompliantForm(t))return(await new Request(ch.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(jn.isArrayBufferView(t)||jn.isArrayBuffer(t))return t.byteLength;if(jn.isURLSearchParams(t)&&(t=t+""),jn.isString(t))return(await x5e(t)).byteLength},A5e=async(t,e)=>{const n=jn.toFiniteNumber(t.getContentLength());return n??S5e(e)},T5e=VE&&(async t=>{let{url:e,method:n,data:r,signal:s,cancelToken:l,timeout:f,onDownloadProgress:i,onUploadProgress:x,responseType:S,headers:I,withCredentials:R="same-origin",fetchOptions:F}=rJ(t);S=S?(S+"").toLowerCase():"text";let j=y5e([s,l&&l.toAbortSignal()],f),H;const G=j&&j.unsubscribe&&(()=>{j.unsubscribe()});let W;try{if(x&&w5e&&n!=="get"&&n!=="head"&&(W=await A5e(I,r))!==0){let fe=new Request(e,{method:"POST",body:r,duplex:"half"}),ye;if(jn.isFormData(r)&&(ye=fe.headers.get("content-type"))&&I.setContentType(ye),fe.body){const[pe,be]=CV(W,f5(IV(x)));r=OV(fe.body,RV,pe,be)}}jn.isString(R)||(R=R?"include":"omit");const J="credentials"in Request.prototype;H=new Request(e,{...F,signal:j,method:n.toUpperCase(),headers:I.normalize().toJSON(),body:r,duplex:"half",credentials:J?R:void 0});let ie=await fetch(H);const he=wD&&(S==="stream"||S==="response");if(wD&&(i||he&&G)){const fe={};["status","statusText","headers"].forEach(Ae=>{fe[Ae]=ie[Ae]});const ye=jn.toFiniteNumber(ie.headers.get("content-length")),[pe,be]=i&&CV(ye,f5(IV(i),!0))||[];ie=new Response(OV(ie.body,RV,pe,()=>{be&&be(),G&&G()}),fe)}S=S||"text";let ge=await d5[jn.findKey(d5,S)||"text"](ie,t);return!he&&G&&G(),await new Promise((fe,ye)=>{tJ(fe,ye,{data:ge,headers:Mf.from(ie.headers),status:ie.status,statusText:ie.statusText,config:t,request:H})})}catch(J){throw G&&G(),J&&J.name==="TypeError"&&/fetch/i.test(J.message)?Object.assign(new ha("Network Error",ha.ERR_NETWORK,t,H),{cause:J.cause||J}):ha.from(J,J&&J.code,t,H)}}),SD={http:FTe,xhr:g5e,fetch:T5e};jn.forEach(SD,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const DV=t=>`- ${t}`,E5e=t=>jn.isFunction(t)||t===null||t===!1,sJ={getAdapter:t=>{t=jn.isArray(t)?t:[t];const{length:e}=t;let n,r;const s={};for(let l=0;l<e;l++){n=t[l];let f;if(r=n,!E5e(n)&&(r=SD[(f=String(n)).toLowerCase()],r===void 0))throw new ha(`Unknown adapter '${f}'`);if(r)break;s[f||"#"+l]=r}if(!r){const l=Object.entries(s).map(([i,x])=>`adapter ${i} `+(x===!1?"is not supported by the environment":"is not available in the build"));let f=e?l.length>1?`since :
`+l.map(DV).join(`
`):" "+DV(l[0]):"as no adapter specified";throw new ha("There is no suitable adapter to dispatch the request "+f,"ERR_NOT_SUPPORT")}return r},adapters:SD};function RO(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new H1(null,t)}function LV(t){return RO(t),t.headers=Mf.from(t.headers),t.data=OO.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),sJ.getAdapter(t.adapter||C2.adapter)(t).then(function(r){return RO(t),r.data=OO.call(t,t.transformResponse,r),r.headers=Mf.from(r.headers),r},function(r){return eJ(r)||(RO(t),r&&r.response&&(r.response.data=OO.call(t,t.transformResponse,r.response),r.response.headers=Mf.from(r.response.headers))),Promise.reject(r)})}const oJ="1.8.4",$E={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{$E[t]=function(r){return typeof r===t||"a"+(e<1?"n ":" ")+t}});const kV={};$E.transitional=function(e,n,r){function s(l,f){return"[Axios v"+oJ+"] Transitional option '"+l+"'"+f+(r?". "+r:"")}return(l,f,i)=>{if(e===!1)throw new ha(s(f," has been removed"+(n?" in "+n:"")),ha.ERR_DEPRECATED);return n&&!kV[f]&&(kV[f]=!0,console.warn(s(f," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(l,f,i):!0}};$E.spelling=function(e){return(n,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};function M5e(t,e,n){if(typeof t!="object")throw new ha("options must be an object",ha.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let s=r.length;for(;s-- >0;){const l=r[s],f=e[l];if(f){const i=t[l],x=i===void 0||f(i,l,t);if(x!==!0)throw new ha("option "+l+" must be "+x,ha.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new ha("Unknown option "+l,ha.ERR_BAD_OPTION)}}const LA={assertOptions:M5e,validators:$E},cm=LA.validators;let Y_=class{constructor(e){this.defaults=e,this.interceptors={request:new EV,response:new EV}}async request(e,n){try{return await this._request(e,n)}catch(r){if(r instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const l=s.stack?s.stack.replace(/^.+\n/,""):"";try{r.stack?l&&!String(r.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+l):r.stack=l}catch{}}throw r}}_request(e,n){typeof e=="string"?(n=n||{},n.url=e):n=e||{},n=cv(this.defaults,n);const{transitional:r,paramsSerializer:s,headers:l}=n;r!==void 0&&LA.assertOptions(r,{silentJSONParsing:cm.transitional(cm.boolean),forcedJSONParsing:cm.transitional(cm.boolean),clarifyTimeoutError:cm.transitional(cm.boolean)},!1),s!=null&&(jn.isFunction(s)?n.paramsSerializer={serialize:s}:LA.assertOptions(s,{encode:cm.function,serialize:cm.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),LA.assertOptions(n,{baseUrl:cm.spelling("baseURL"),withXsrfToken:cm.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let f=l&&jn.merge(l.common,l[n.method]);l&&jn.forEach(["delete","get","head","post","put","patch","common"],H=>{delete l[H]}),n.headers=Mf.concat(f,l);const i=[];let x=!0;this.interceptors.request.forEach(function(G){typeof G.runWhen=="function"&&G.runWhen(n)===!1||(x=x&&G.synchronous,i.unshift(G.fulfilled,G.rejected))});const S=[];this.interceptors.response.forEach(function(G){S.push(G.fulfilled,G.rejected)});let I,R=0,F;if(!x){const H=[LV.bind(this),void 0];for(H.unshift.apply(H,i),H.push.apply(H,S),F=H.length,I=Promise.resolve(n);R<F;)I=I.then(H[R++],H[R++]);return I}F=i.length;let j=n;for(R=0;R<F;){const H=i[R++],G=i[R++];try{j=H(j)}catch(W){G.call(this,W);break}}try{I=LV.call(this,j)}catch(H){return Promise.reject(H)}for(R=0,F=S.length;R<F;)I=I.then(S[R++],S[R++]);return I}getUri(e){e=cv(this.defaults,e);const n=nJ(e.baseURL,e.url,e.allowAbsoluteUrls);return ZZ(n,e.params,e.paramsSerializer)}};jn.forEach(["delete","get","head","options"],function(e){Y_.prototype[e]=function(n,r){return this.request(cv(r||{},{method:e,url:n,data:(r||{}).data}))}});jn.forEach(["post","put","patch"],function(e){function n(r){return function(l,f,i){return this.request(cv(i||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:l,data:f}))}}Y_.prototype[e]=n(),Y_.prototype[e+"Form"]=n(!0)});let C5e=class lJ{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(l){n=l});const r=this;this.promise.then(s=>{if(!r._listeners)return;let l=r._listeners.length;for(;l-- >0;)r._listeners[l](s);r._listeners=null}),this.promise.then=s=>{let l;const f=new Promise(i=>{r.subscribe(i),l=i}).then(s);return f.cancel=function(){r.unsubscribe(l)},f},e(function(l,f,i){r.reason||(r.reason=new H1(l,f,i),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=r=>{e.abort(r)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new lJ(function(s){e=s}),cancel:e}}};function I5e(t){return function(n){return t.apply(null,n)}}function P5e(t){return jn.isObject(t)&&t.isAxiosError===!0}const AD={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(AD).forEach(([t,e])=>{AD[e]=t});function cJ(t){const e=new Y_(t),n=FZ(Y_.prototype.request,e);return jn.extend(n,Y_.prototype,e,{allOwnKeys:!0}),jn.extend(n,e,null,{allOwnKeys:!0}),n.create=function(s){return cJ(cv(t,s))},n}const Go=cJ(C2);Go.Axios=Y_;Go.CanceledError=H1;Go.CancelToken=C5e;Go.isCancel=eJ;Go.VERSION=oJ;Go.toFormData=qE;Go.AxiosError=ha;Go.Cancel=Go.CanceledError;Go.all=function(e){return Promise.all(e)};Go.spread=I5e;Go.isAxiosError=P5e;Go.mergeConfig=cv;Go.AxiosHeaders=Mf;Go.formToJSON=t=>QZ(jn.isHTMLForm(t)?new FormData(t):t);Go.getAdapter=sJ.getAdapter;Go.HttpStatusCode=AD;Go.default=Go;const{Axios:N3e,AxiosError:z3e,CanceledError:B3e,isCancel:j3e,CancelToken:F3e,VERSION:U3e,all:q3e,Cancel:V3e,isAxiosError:$3e,spread:H3e,toFormData:G3e,AxiosHeaders:W3e,HttpStatusCode:K3e,formToJSON:Y3e,getAdapter:X3e,mergeConfig:Z3e}=Go;var h0={},DO,NV;function O5e(){return NV||(NV=1,DO=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}),DO}var LO={},oy={},zV;function bv(){if(zV)return oy;zV=1;let t;const e=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];return oy.getSymbolSize=function(r){if(!r)throw new Error('"version" cannot be null or undefined');if(r<1||r>40)throw new Error('"version" should be in range from 1 to 40');return r*4+17},oy.getSymbolTotalCodewords=function(r){return e[r]},oy.getBCHDigit=function(n){let r=0;for(;n!==0;)r++,n>>>=1;return r},oy.setToSJISFunction=function(r){if(typeof r!="function")throw new Error('"toSJISFunc" is not a valid function.');t=r},oy.isKanjiModeEnabled=function(){return typeof t<"u"},oy.toSJIS=function(r){return t(r)},oy}var kO={},BV;function pN(){return BV||(BV=1,function(t){t.L={bit:1},t.M={bit:0},t.Q={bit:3},t.H={bit:2};function e(n){if(typeof n!="string")throw new Error("Param is not a string");switch(n.toLowerCase()){case"l":case"low":return t.L;case"m":case"medium":return t.M;case"q":case"quartile":return t.Q;case"h":case"high":return t.H;default:throw new Error("Unknown EC Level: "+n)}}t.isValid=function(r){return r&&typeof r.bit<"u"&&r.bit>=0&&r.bit<4},t.from=function(r,s){if(t.isValid(r))return r;try{return e(r)}catch{return s}}}(kO)),kO}var NO,jV;function R5e(){if(jV)return NO;jV=1;function t(){this.buffer=[],this.length=0}return t.prototype={get:function(e){const n=Math.floor(e/8);return(this.buffer[n]>>>7-e%8&1)===1},put:function(e,n){for(let r=0;r<n;r++)this.putBit((e>>>n-r-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(e){const n=Math.floor(this.length/8);this.buffer.length<=n&&this.buffer.push(0),e&&(this.buffer[n]|=128>>>this.length%8),this.length++}},NO=t,NO}var zO,FV;function D5e(){if(FV)return zO;FV=1;function t(e){if(!e||e<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=e,this.data=new Uint8Array(e*e),this.reservedBit=new Uint8Array(e*e)}return t.prototype.set=function(e,n,r,s){const l=e*this.size+n;this.data[l]=r,s&&(this.reservedBit[l]=!0)},t.prototype.get=function(e,n){return this.data[e*this.size+n]},t.prototype.xor=function(e,n,r){this.data[e*this.size+n]^=r},t.prototype.isReserved=function(e,n){return this.reservedBit[e*this.size+n]},zO=t,zO}var BO={},UV;function L5e(){return UV||(UV=1,function(t){const e=bv().getSymbolSize;t.getRowColCoords=function(r){if(r===1)return[];const s=Math.floor(r/7)+2,l=e(r),f=l===145?26:Math.ceil((l-13)/(2*s-2))*2,i=[l-7];for(let x=1;x<s-1;x++)i[x]=i[x-1]-f;return i.push(6),i.reverse()},t.getPositions=function(r){const s=[],l=t.getRowColCoords(r),f=l.length;for(let i=0;i<f;i++)for(let x=0;x<f;x++)i===0&&x===0||i===0&&x===f-1||i===f-1&&x===0||s.push([l[i],l[x]]);return s}}(BO)),BO}var jO={},qV;function k5e(){if(qV)return jO;qV=1;const t=bv().getSymbolSize,e=7;return jO.getPositions=function(r){const s=t(r);return[[0,0],[s-e,0],[0,s-e]]},jO}var FO={},VV;function N5e(){return VV||(VV=1,function(t){t.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const e={N1:3,N2:3,N3:40,N4:10};t.isValid=function(s){return s!=null&&s!==""&&!isNaN(s)&&s>=0&&s<=7},t.from=function(s){return t.isValid(s)?parseInt(s,10):void 0},t.getPenaltyN1=function(s){const l=s.size;let f=0,i=0,x=0,S=null,I=null;for(let R=0;R<l;R++){i=x=0,S=I=null;for(let F=0;F<l;F++){let j=s.get(R,F);j===S?i++:(i>=5&&(f+=e.N1+(i-5)),S=j,i=1),j=s.get(F,R),j===I?x++:(x>=5&&(f+=e.N1+(x-5)),I=j,x=1)}i>=5&&(f+=e.N1+(i-5)),x>=5&&(f+=e.N1+(x-5))}return f},t.getPenaltyN2=function(s){const l=s.size;let f=0;for(let i=0;i<l-1;i++)for(let x=0;x<l-1;x++){const S=s.get(i,x)+s.get(i,x+1)+s.get(i+1,x)+s.get(i+1,x+1);(S===4||S===0)&&f++}return f*e.N2},t.getPenaltyN3=function(s){const l=s.size;let f=0,i=0,x=0;for(let S=0;S<l;S++){i=x=0;for(let I=0;I<l;I++)i=i<<1&2047|s.get(S,I),I>=10&&(i===1488||i===93)&&f++,x=x<<1&2047|s.get(I,S),I>=10&&(x===1488||x===93)&&f++}return f*e.N3},t.getPenaltyN4=function(s){let l=0;const f=s.data.length;for(let x=0;x<f;x++)l+=s.data[x];return Math.abs(Math.ceil(l*100/f/5)-10)*e.N4};function n(r,s,l){switch(r){case t.Patterns.PATTERN000:return(s+l)%2===0;case t.Patterns.PATTERN001:return s%2===0;case t.Patterns.PATTERN010:return l%3===0;case t.Patterns.PATTERN011:return(s+l)%3===0;case t.Patterns.PATTERN100:return(Math.floor(s/2)+Math.floor(l/3))%2===0;case t.Patterns.PATTERN101:return s*l%2+s*l%3===0;case t.Patterns.PATTERN110:return(s*l%2+s*l%3)%2===0;case t.Patterns.PATTERN111:return(s*l%3+(s+l)%2)%2===0;default:throw new Error("bad maskPattern:"+r)}}t.applyMask=function(s,l){const f=l.size;for(let i=0;i<f;i++)for(let x=0;x<f;x++)l.isReserved(x,i)||l.xor(x,i,n(s,x,i))},t.getBestMask=function(s,l){const f=Object.keys(t.Patterns).length;let i=0,x=1/0;for(let S=0;S<f;S++){l(S),t.applyMask(S,s);const I=t.getPenaltyN1(s)+t.getPenaltyN2(s)+t.getPenaltyN3(s)+t.getPenaltyN4(s);t.applyMask(S,s),I<x&&(x=I,i=S)}return i}}(FO)),FO}var uA={},$V;function uJ(){if($V)return uA;$V=1;const t=pN(),e=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],n=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];return uA.getBlocksCount=function(s,l){switch(l){case t.L:return e[(s-1)*4+0];case t.M:return e[(s-1)*4+1];case t.Q:return e[(s-1)*4+2];case t.H:return e[(s-1)*4+3];default:return}},uA.getTotalCodewordsCount=function(s,l){switch(l){case t.L:return n[(s-1)*4+0];case t.M:return n[(s-1)*4+1];case t.Q:return n[(s-1)*4+2];case t.H:return n[(s-1)*4+3];default:return}},uA}var UO={},dx={},HV;function z5e(){if(HV)return dx;HV=1;const t=new Uint8Array(512),e=new Uint8Array(256);return function(){let r=1;for(let s=0;s<255;s++)t[s]=r,e[r]=s,r<<=1,r&256&&(r^=285);for(let s=255;s<512;s++)t[s]=t[s-255]}(),dx.log=function(r){if(r<1)throw new Error("log("+r+")");return e[r]},dx.exp=function(r){return t[r]},dx.mul=function(r,s){return r===0||s===0?0:t[e[r]+e[s]]},dx}var GV;function B5e(){return GV||(GV=1,function(t){const e=z5e();t.mul=function(r,s){const l=new Uint8Array(r.length+s.length-1);for(let f=0;f<r.length;f++)for(let i=0;i<s.length;i++)l[f+i]^=e.mul(r[f],s[i]);return l},t.mod=function(r,s){let l=new Uint8Array(r);for(;l.length-s.length>=0;){const f=l[0];for(let x=0;x<s.length;x++)l[x]^=e.mul(s[x],f);let i=0;for(;i<l.length&&l[i]===0;)i++;l=l.slice(i)}return l},t.generateECPolynomial=function(r){let s=new Uint8Array([1]);for(let l=0;l<r;l++)s=t.mul(s,new Uint8Array([1,e.exp(l)]));return s}}(UO)),UO}var qO,WV;function j5e(){if(WV)return qO;WV=1;const t=B5e();function e(n){this.genPoly=void 0,this.degree=n,this.degree&&this.initialize(this.degree)}return e.prototype.initialize=function(r){this.degree=r,this.genPoly=t.generateECPolynomial(this.degree)},e.prototype.encode=function(r){if(!this.genPoly)throw new Error("Encoder not initialized");const s=new Uint8Array(r.length+this.degree);s.set(r);const l=t.mod(s,this.genPoly),f=this.degree-l.length;if(f>0){const i=new Uint8Array(this.degree);return i.set(l,f),i}return l},qO=e,qO}var VO={},$O={},HO={},KV;function hJ(){return KV||(KV=1,HO.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40}),HO}var um={},YV;function fJ(){if(YV)return um;YV=1;const t="[0-9]+",e="[A-Z $%*+\\-./:]+";let n="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";n=n.replace(/u/g,"\\u");const r="(?:(?![A-Z0-9 $%*+\\-./:]|"+n+`)(?:.|[\r
]))+`;um.KANJI=new RegExp(n,"g"),um.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),um.BYTE=new RegExp(r,"g"),um.NUMERIC=new RegExp(t,"g"),um.ALPHANUMERIC=new RegExp(e,"g");const s=new RegExp("^"+n+"$"),l=new RegExp("^"+t+"$"),f=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");return um.testKanji=function(x){return s.test(x)},um.testNumeric=function(x){return l.test(x)},um.testAlphanumeric=function(x){return f.test(x)},um}var XV;function xv(){return XV||(XV=1,function(t){const e=hJ(),n=fJ();t.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},t.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},t.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},t.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},t.MIXED={bit:-1},t.getCharCountIndicator=function(l,f){if(!l.ccBits)throw new Error("Invalid mode: "+l);if(!e.isValid(f))throw new Error("Invalid version: "+f);return f>=1&&f<10?l.ccBits[0]:f<27?l.ccBits[1]:l.ccBits[2]},t.getBestModeForData=function(l){return n.testNumeric(l)?t.NUMERIC:n.testAlphanumeric(l)?t.ALPHANUMERIC:n.testKanji(l)?t.KANJI:t.BYTE},t.toString=function(l){if(l&&l.id)return l.id;throw new Error("Invalid mode")},t.isValid=function(l){return l&&l.bit&&l.ccBits};function r(s){if(typeof s!="string")throw new Error("Param is not a string");switch(s.toLowerCase()){case"numeric":return t.NUMERIC;case"alphanumeric":return t.ALPHANUMERIC;case"kanji":return t.KANJI;case"byte":return t.BYTE;default:throw new Error("Unknown mode: "+s)}}t.from=function(l,f){if(t.isValid(l))return l;try{return r(l)}catch{return f}}}($O)),$O}var ZV;function F5e(){return ZV||(ZV=1,function(t){const e=bv(),n=uJ(),r=pN(),s=xv(),l=hJ(),f=7973,i=e.getBCHDigit(f);function x(F,j,H){for(let G=1;G<=40;G++)if(j<=t.getCapacity(G,H,F))return G}function S(F,j){return s.getCharCountIndicator(F,j)+4}function I(F,j){let H=0;return F.forEach(function(G){const W=S(G.mode,j);H+=W+G.getBitsLength()}),H}function R(F,j){for(let H=1;H<=40;H++)if(I(F,H)<=t.getCapacity(H,j,s.MIXED))return H}t.from=function(j,H){return l.isValid(j)?parseInt(j,10):H},t.getCapacity=function(j,H,G){if(!l.isValid(j))throw new Error("Invalid QR Code version");typeof G>"u"&&(G=s.BYTE);const W=e.getSymbolTotalCodewords(j),J=n.getTotalCodewordsCount(j,H),ie=(W-J)*8;if(G===s.MIXED)return ie;const he=ie-S(G,j);switch(G){case s.NUMERIC:return Math.floor(he/10*3);case s.ALPHANUMERIC:return Math.floor(he/11*2);case s.KANJI:return Math.floor(he/13);case s.BYTE:default:return Math.floor(he/8)}},t.getBestVersionForData=function(j,H){let G;const W=r.from(H,r.M);if(Array.isArray(j)){if(j.length>1)return R(j,W);if(j.length===0)return 1;G=j[0]}else G=j;return x(G.mode,G.getLength(),W)},t.getEncodedBits=function(j){if(!l.isValid(j)||j<7)throw new Error("Invalid QR Code version");let H=j<<12;for(;e.getBCHDigit(H)-i>=0;)H^=f<<e.getBCHDigit(H)-i;return j<<12|H}}(VO)),VO}var GO={},JV;function U5e(){if(JV)return GO;JV=1;const t=bv(),e=1335,n=21522,r=t.getBCHDigit(e);return GO.getEncodedBits=function(l,f){const i=l.bit<<3|f;let x=i<<10;for(;t.getBCHDigit(x)-r>=0;)x^=e<<t.getBCHDigit(x)-r;return(i<<10|x)^n},GO}var WO={},KO,QV;function q5e(){if(QV)return KO;QV=1;const t=xv();function e(n){this.mode=t.NUMERIC,this.data=n.toString()}return e.getBitsLength=function(r){return 10*Math.floor(r/3)+(r%3?r%3*3+1:0)},e.prototype.getLength=function(){return this.data.length},e.prototype.getBitsLength=function(){return e.getBitsLength(this.data.length)},e.prototype.write=function(r){let s,l,f;for(s=0;s+3<=this.data.length;s+=3)l=this.data.substr(s,3),f=parseInt(l,10),r.put(f,10);const i=this.data.length-s;i>0&&(l=this.data.substr(s),f=parseInt(l,10),r.put(f,i*3+1))},KO=e,KO}var YO,e$;function V5e(){if(e$)return YO;e$=1;const t=xv(),e=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function n(r){this.mode=t.ALPHANUMERIC,this.data=r}return n.getBitsLength=function(s){return 11*Math.floor(s/2)+6*(s%2)},n.prototype.getLength=function(){return this.data.length},n.prototype.getBitsLength=function(){return n.getBitsLength(this.data.length)},n.prototype.write=function(s){let l;for(l=0;l+2<=this.data.length;l+=2){let f=e.indexOf(this.data[l])*45;f+=e.indexOf(this.data[l+1]),s.put(f,11)}this.data.length%2&&s.put(e.indexOf(this.data[l]),6)},YO=n,YO}var XO,t$;function $5e(){if(t$)return XO;t$=1;const t=xv();function e(n){this.mode=t.BYTE,typeof n=="string"?this.data=new TextEncoder().encode(n):this.data=new Uint8Array(n)}return e.getBitsLength=function(r){return r*8},e.prototype.getLength=function(){return this.data.length},e.prototype.getBitsLength=function(){return e.getBitsLength(this.data.length)},e.prototype.write=function(n){for(let r=0,s=this.data.length;r<s;r++)n.put(this.data[r],8)},XO=e,XO}var ZO,n$;function H5e(){if(n$)return ZO;n$=1;const t=xv(),e=bv();function n(r){this.mode=t.KANJI,this.data=r}return n.getBitsLength=function(s){return s*13},n.prototype.getLength=function(){return this.data.length},n.prototype.getBitsLength=function(){return n.getBitsLength(this.data.length)},n.prototype.write=function(r){let s;for(s=0;s<this.data.length;s++){let l=e.toSJIS(this.data[s]);if(l>=33088&&l<=40956)l-=33088;else if(l>=57408&&l<=60351)l-=49472;else throw new Error("Invalid SJIS character: "+this.data[s]+`
Make sure your charset is UTF-8`);l=(l>>>8&255)*192+(l&255),r.put(l,13)}},ZO=n,ZO}var JO={exports:{}},r$;function G5e(){return r$||(r$=1,function(t){var e={single_source_shortest_paths:function(n,r,s){var l={},f={};f[r]=0;var i=e.PriorityQueue.make();i.push(r,0);for(var x,S,I,R,F,j,H,G,W;!i.empty();){x=i.pop(),S=x.value,R=x.cost,F=n[S]||{};for(I in F)F.hasOwnProperty(I)&&(j=F[I],H=R+j,G=f[I],W=typeof f[I]>"u",(W||G>H)&&(f[I]=H,i.push(I,H),l[I]=S))}if(typeof s<"u"&&typeof f[s]>"u"){var J=["Could not find a path from ",r," to ",s,"."].join("");throw new Error(J)}return l},extract_shortest_path_from_predecessor_list:function(n,r){for(var s=[],l=r;l;)s.push(l),n[l],l=n[l];return s.reverse(),s},find_path:function(n,r,s){var l=e.single_source_shortest_paths(n,r,s);return e.extract_shortest_path_from_predecessor_list(l,s)},PriorityQueue:{make:function(n){var r=e.PriorityQueue,s={},l;n=n||{};for(l in r)r.hasOwnProperty(l)&&(s[l]=r[l]);return s.queue=[],s.sorter=n.sorter||r.default_sorter,s},default_sorter:function(n,r){return n.cost-r.cost},push:function(n,r){var s={value:n,cost:r};this.queue.push(s),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};t.exports=e}(JO)),JO.exports}var i$;function W5e(){return i$||(i$=1,function(t){const e=xv(),n=q5e(),r=V5e(),s=$5e(),l=H5e(),f=fJ(),i=bv(),x=G5e();function S(J){return unescape(encodeURIComponent(J)).length}function I(J,ie,he){const ge=[];let fe;for(;(fe=J.exec(he))!==null;)ge.push({data:fe[0],index:fe.index,mode:ie,length:fe[0].length});return ge}function R(J){const ie=I(f.NUMERIC,e.NUMERIC,J),he=I(f.ALPHANUMERIC,e.ALPHANUMERIC,J);let ge,fe;return i.isKanjiModeEnabled()?(ge=I(f.BYTE,e.BYTE,J),fe=I(f.KANJI,e.KANJI,J)):(ge=I(f.BYTE_KANJI,e.BYTE,J),fe=[]),ie.concat(he,ge,fe).sort(function(pe,be){return pe.index-be.index}).map(function(pe){return{data:pe.data,mode:pe.mode,length:pe.length}})}function F(J,ie){switch(ie){case e.NUMERIC:return n.getBitsLength(J);case e.ALPHANUMERIC:return r.getBitsLength(J);case e.KANJI:return l.getBitsLength(J);case e.BYTE:return s.getBitsLength(J)}}function j(J){return J.reduce(function(ie,he){const ge=ie.length-1>=0?ie[ie.length-1]:null;return ge&&ge.mode===he.mode?(ie[ie.length-1].data+=he.data,ie):(ie.push(he),ie)},[])}function H(J){const ie=[];for(let he=0;he<J.length;he++){const ge=J[he];switch(ge.mode){case e.NUMERIC:ie.push([ge,{data:ge.data,mode:e.ALPHANUMERIC,length:ge.length},{data:ge.data,mode:e.BYTE,length:ge.length}]);break;case e.ALPHANUMERIC:ie.push([ge,{data:ge.data,mode:e.BYTE,length:ge.length}]);break;case e.KANJI:ie.push([ge,{data:ge.data,mode:e.BYTE,length:S(ge.data)}]);break;case e.BYTE:ie.push([{data:ge.data,mode:e.BYTE,length:S(ge.data)}])}}return ie}function G(J,ie){const he={},ge={start:{}};let fe=["start"];for(let ye=0;ye<J.length;ye++){const pe=J[ye],be=[];for(let Ae=0;Ae<pe.length;Ae++){const Oe=pe[Ae],ue=""+ye+Ae;be.push(ue),he[ue]={node:Oe,lastCount:0},ge[ue]={};for(let we=0;we<fe.length;we++){const ke=fe[we];he[ke]&&he[ke].node.mode===Oe.mode?(ge[ke][ue]=F(he[ke].lastCount+Oe.length,Oe.mode)-F(he[ke].lastCount,Oe.mode),he[ke].lastCount+=Oe.length):(he[ke]&&(he[ke].lastCount=Oe.length),ge[ke][ue]=F(Oe.length,Oe.mode)+4+e.getCharCountIndicator(Oe.mode,ie))}}fe=be}for(let ye=0;ye<fe.length;ye++)ge[fe[ye]].end=0;return{map:ge,table:he}}function W(J,ie){let he;const ge=e.getBestModeForData(J);if(he=e.from(ie,ge),he!==e.BYTE&&he.bit<ge.bit)throw new Error('"'+J+'" cannot be encoded with mode '+e.toString(he)+`.
 Suggested mode is: `+e.toString(ge));switch(he===e.KANJI&&!i.isKanjiModeEnabled()&&(he=e.BYTE),he){case e.NUMERIC:return new n(J);case e.ALPHANUMERIC:return new r(J);case e.KANJI:return new l(J);case e.BYTE:return new s(J)}}t.fromArray=function(ie){return ie.reduce(function(he,ge){return typeof ge=="string"?he.push(W(ge,null)):ge.data&&he.push(W(ge.data,ge.mode)),he},[])},t.fromString=function(ie,he){const ge=R(ie,i.isKanjiModeEnabled()),fe=H(ge),ye=G(fe,he),pe=x.find_path(ye.map,"start","end"),be=[];for(let Ae=1;Ae<pe.length-1;Ae++)be.push(ye.table[pe[Ae]].node);return t.fromArray(j(be))},t.rawSplit=function(ie){return t.fromArray(R(ie,i.isKanjiModeEnabled()))}}(WO)),WO}var a$;function K5e(){if(a$)return LO;a$=1;const t=bv(),e=pN(),n=R5e(),r=D5e(),s=L5e(),l=k5e(),f=N5e(),i=uJ(),x=j5e(),S=F5e(),I=U5e(),R=xv(),F=W5e();function j(ye,pe){const be=ye.size,Ae=l.getPositions(pe);for(let Oe=0;Oe<Ae.length;Oe++){const ue=Ae[Oe][0],we=Ae[Oe][1];for(let ke=-1;ke<=7;ke++)if(!(ue+ke<=-1||be<=ue+ke))for(let De=-1;De<=7;De++)we+De<=-1||be<=we+De||(ke>=0&&ke<=6&&(De===0||De===6)||De>=0&&De<=6&&(ke===0||ke===6)||ke>=2&&ke<=4&&De>=2&&De<=4?ye.set(ue+ke,we+De,!0,!0):ye.set(ue+ke,we+De,!1,!0))}}function H(ye){const pe=ye.size;for(let be=8;be<pe-8;be++){const Ae=be%2===0;ye.set(be,6,Ae,!0),ye.set(6,be,Ae,!0)}}function G(ye,pe){const be=s.getPositions(pe);for(let Ae=0;Ae<be.length;Ae++){const Oe=be[Ae][0],ue=be[Ae][1];for(let we=-2;we<=2;we++)for(let ke=-2;ke<=2;ke++)we===-2||we===2||ke===-2||ke===2||we===0&&ke===0?ye.set(Oe+we,ue+ke,!0,!0):ye.set(Oe+we,ue+ke,!1,!0)}}function W(ye,pe){const be=ye.size,Ae=S.getEncodedBits(pe);let Oe,ue,we;for(let ke=0;ke<18;ke++)Oe=Math.floor(ke/3),ue=ke%3+be-8-3,we=(Ae>>ke&1)===1,ye.set(Oe,ue,we,!0),ye.set(ue,Oe,we,!0)}function J(ye,pe,be){const Ae=ye.size,Oe=I.getEncodedBits(pe,be);let ue,we;for(ue=0;ue<15;ue++)we=(Oe>>ue&1)===1,ue<6?ye.set(ue,8,we,!0):ue<8?ye.set(ue+1,8,we,!0):ye.set(Ae-15+ue,8,we,!0),ue<8?ye.set(8,Ae-ue-1,we,!0):ue<9?ye.set(8,15-ue-1+1,we,!0):ye.set(8,15-ue-1,we,!0);ye.set(Ae-8,8,1,!0)}function ie(ye,pe){const be=ye.size;let Ae=-1,Oe=be-1,ue=7,we=0;for(let ke=be-1;ke>0;ke-=2)for(ke===6&&ke--;;){for(let De=0;De<2;De++)if(!ye.isReserved(Oe,ke-De)){let je=!1;we<pe.length&&(je=(pe[we]>>>ue&1)===1),ye.set(Oe,ke-De,je),ue--,ue===-1&&(we++,ue=7)}if(Oe+=Ae,Oe<0||be<=Oe){Oe-=Ae,Ae=-Ae;break}}}function he(ye,pe,be){const Ae=new n;be.forEach(function(De){Ae.put(De.mode.bit,4),Ae.put(De.getLength(),R.getCharCountIndicator(De.mode,ye)),De.write(Ae)});const Oe=t.getSymbolTotalCodewords(ye),ue=i.getTotalCodewordsCount(ye,pe),we=(Oe-ue)*8;for(Ae.getLengthInBits()+4<=we&&Ae.put(0,4);Ae.getLengthInBits()%8!==0;)Ae.putBit(0);const ke=(we-Ae.getLengthInBits())/8;for(let De=0;De<ke;De++)Ae.put(De%2?17:236,8);return ge(Ae,ye,pe)}function ge(ye,pe,be){const Ae=t.getSymbolTotalCodewords(pe),Oe=i.getTotalCodewordsCount(pe,be),ue=Ae-Oe,we=i.getBlocksCount(pe,be),ke=Ae%we,De=we-ke,je=Math.floor(Ae/we),ze=Math.floor(ue/we),Ue=ze+1,Fe=je-ze,Qe=new x(Fe);let Be=0;const bt=new Array(we),xe=new Array(we);let Le=0;const Xe=new Uint8Array(ye.buffer);for(let yt=0;yt<we;yt++){const _e=yt<De?ze:Ue;bt[yt]=Xe.slice(Be,Be+_e),xe[yt]=Qe.encode(bt[yt]),Be+=_e,Le=Math.max(Le,_e)}const ct=new Uint8Array(Ae);let vt=0,Nt,mt;for(Nt=0;Nt<Le;Nt++)for(mt=0;mt<we;mt++)Nt<bt[mt].length&&(ct[vt++]=bt[mt][Nt]);for(Nt=0;Nt<Fe;Nt++)for(mt=0;mt<we;mt++)ct[vt++]=xe[mt][Nt];return ct}function fe(ye,pe,be,Ae){let Oe;if(Array.isArray(ye))Oe=F.fromArray(ye);else if(typeof ye=="string"){let je=pe;if(!je){const ze=F.rawSplit(ye);je=S.getBestVersionForData(ze,be)}Oe=F.fromString(ye,je||40)}else throw new Error("Invalid data");const ue=S.getBestVersionForData(Oe,be);if(!ue)throw new Error("The amount of data is too big to be stored in a QR Code");if(!pe)pe=ue;else if(pe<ue)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+ue+`.
`);const we=he(pe,be,Oe),ke=t.getSymbolSize(pe),De=new r(ke);return j(De,pe),H(De),G(De,pe),J(De,be,0),pe>=7&&W(De,pe),ie(De,we),isNaN(Ae)&&(Ae=f.getBestMask(De,J.bind(null,De,be))),f.applyMask(Ae,De),J(De,be,Ae),{modules:De,version:pe,errorCorrectionLevel:be,maskPattern:Ae,segments:Oe}}return LO.create=function(pe,be){if(typeof pe>"u"||pe==="")throw new Error("No input text");let Ae=e.M,Oe,ue;return typeof be<"u"&&(Ae=e.from(be.errorCorrectionLevel,e.M),Oe=S.from(be.version),ue=f.from(be.maskPattern),be.toSJISFunc&&t.setToSJISFunction(be.toSJISFunc)),fe(pe,Oe,Ae,ue)},LO}var QO={},e4={},s$;function dJ(){return s$||(s$=1,function(t){function e(n){if(typeof n=="number"&&(n=n.toString()),typeof n!="string")throw new Error("Color should be defined as hex string");let r=n.slice().replace("#","").split("");if(r.length<3||r.length===5||r.length>8)throw new Error("Invalid hex color: "+n);(r.length===3||r.length===4)&&(r=Array.prototype.concat.apply([],r.map(function(l){return[l,l]}))),r.length===6&&r.push("F","F");const s=parseInt(r.join(""),16);return{r:s>>24&255,g:s>>16&255,b:s>>8&255,a:s&255,hex:"#"+r.slice(0,6).join("")}}t.getOptions=function(r){r||(r={}),r.color||(r.color={});const s=typeof r.margin>"u"||r.margin===null||r.margin<0?4:r.margin,l=r.width&&r.width>=21?r.width:void 0,f=r.scale||4;return{width:l,scale:l?4:f,margin:s,color:{dark:e(r.color.dark||"#000000ff"),light:e(r.color.light||"#ffffffff")},type:r.type,rendererOpts:r.rendererOpts||{}}},t.getScale=function(r,s){return s.width&&s.width>=r+s.margin*2?s.width/(r+s.margin*2):s.scale},t.getImageWidth=function(r,s){const l=t.getScale(r,s);return Math.floor((r+s.margin*2)*l)},t.qrToImageData=function(r,s,l){const f=s.modules.size,i=s.modules.data,x=t.getScale(f,l),S=Math.floor((f+l.margin*2)*x),I=l.margin*x,R=[l.color.light,l.color.dark];for(let F=0;F<S;F++)for(let j=0;j<S;j++){let H=(F*S+j)*4,G=l.color.light;if(F>=I&&j>=I&&F<S-I&&j<S-I){const W=Math.floor((F-I)/x),J=Math.floor((j-I)/x);G=R[i[W*f+J]?1:0]}r[H++]=G.r,r[H++]=G.g,r[H++]=G.b,r[H]=G.a}}}(e4)),e4}var o$;function Y5e(){return o$||(o$=1,function(t){const e=dJ();function n(s,l,f){s.clearRect(0,0,l.width,l.height),l.style||(l.style={}),l.height=f,l.width=f,l.style.height=f+"px",l.style.width=f+"px"}function r(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}t.render=function(l,f,i){let x=i,S=f;typeof x>"u"&&(!f||!f.getContext)&&(x=f,f=void 0),f||(S=r()),x=e.getOptions(x);const I=e.getImageWidth(l.modules.size,x),R=S.getContext("2d"),F=R.createImageData(I,I);return e.qrToImageData(F.data,l,x),n(R,S,I),R.putImageData(F,0,0),S},t.renderToDataURL=function(l,f,i){let x=i;typeof x>"u"&&(!f||!f.getContext)&&(x=f,f=void 0),x||(x={});const S=t.render(l,f,x),I=x.type||"image/png",R=x.rendererOpts||{};return S.toDataURL(I,R.quality)}}(QO)),QO}var t4={},l$;function X5e(){if(l$)return t4;l$=1;const t=dJ();function e(s,l){const f=s.a/255,i=l+'="'+s.hex+'"';return f<1?i+" "+l+'-opacity="'+f.toFixed(2).slice(1)+'"':i}function n(s,l,f){let i=s+l;return typeof f<"u"&&(i+=" "+f),i}function r(s,l,f){let i="",x=0,S=!1,I=0;for(let R=0;R<s.length;R++){const F=Math.floor(R%l),j=Math.floor(R/l);!F&&!S&&(S=!0),s[R]?(I++,R>0&&F>0&&s[R-1]||(i+=S?n("M",F+f,.5+j+f):n("m",x,0),x=0,S=!1),F+1<l&&s[R+1]||(i+=n("h",I),I=0)):x++}return i}return t4.render=function(l,f,i){const x=t.getOptions(f),S=l.modules.size,I=l.modules.data,R=S+x.margin*2,F=x.color.light.a?"<path "+e(x.color.light,"fill")+' d="M0 0h'+R+"v"+R+'H0z"/>':"",j="<path "+e(x.color.dark,"stroke")+' d="'+r(I,S,x.margin)+'"/>',H='viewBox="0 0 '+R+" "+R+'"',W='<svg xmlns="http://www.w3.org/2000/svg" '+(x.width?'width="'+x.width+'" height="'+x.width+'" ':"")+H+' shape-rendering="crispEdges">'+F+j+`</svg>
`;return typeof i=="function"&&i(null,W),W},t4}var c$;function Z5e(){if(c$)return h0;c$=1;const t=O5e(),e=K5e(),n=Y5e(),r=X5e();function s(l,f,i,x,S){const I=[].slice.call(arguments,1),R=I.length,F=typeof I[R-1]=="function";if(!F&&!t())throw new Error("Callback required as last argument");if(F){if(R<2)throw new Error("Too few arguments provided");R===2?(S=i,i=f,f=x=void 0):R===3&&(f.getContext&&typeof S>"u"?(S=x,x=void 0):(S=x,x=i,i=f,f=void 0))}else{if(R<1)throw new Error("Too few arguments provided");return R===1?(i=f,f=x=void 0):R===2&&!f.getContext&&(x=i,i=f,f=void 0),new Promise(function(j,H){try{const G=e.create(i,x);j(l(G,f,x))}catch(G){H(G)}})}try{const j=e.create(i,x);S(null,l(j,f,x))}catch(j){S(j)}}return h0.create=e.create,h0.toCanvas=s.bind(null,n.render),h0.toDataURL=s.bind(null,n.renderToDataURL),h0.toString=s.bind(null,function(l,f,i){return r.render(l,i)}),h0}var J5e=Z5e();const Q5e=Xa(J5e),eEe="modulepreload",tEe=function(t){return"/ecpcaps/"+t},u$={},TD=function(e,n,r){let s=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),i=(f==null?void 0:f.nonce)||(f==null?void 0:f.getAttribute("nonce"));s=Promise.allSettled(n.map(x=>{if(x=tEe(x),x in u$)return;u$[x]=!0;const S=x.endsWith(".css"),I=S?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${x}"]${I}`))return;const R=document.createElement("link");if(R.rel=S?"stylesheet":eEe,S||(R.as="script"),R.crossOrigin="",R.href=x,i&&R.setAttribute("nonce",i),document.head.appendChild(R),S)return new Promise((F,j)=>{R.addEventListener("load",F),R.addEventListener("error",()=>j(new Error(`Unable to preload CSS for ${x}`)))})}))}function l(f){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=f,window.dispatchEvent(i),!i.defaultPrevented)throw f}return s.then(f=>{for(const i of f||[])i.status==="rejected"&&l(i.reason);return e().catch(l)})};function ks(t){"@babel/helpers - typeof";return ks=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ks(t)}var uh=Uint8Array,id=Uint16Array,mN=Int32Array,HE=new uh([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),GE=new uh([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ED=new uh([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),pJ=function(t,e){for(var n=new id(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];for(var s=new mN(n[30]),r=1;r<30;++r)for(var l=n[r];l<n[r+1];++l)s[l]=l-n[r]<<5|r;return{b:n,r:s}},mJ=pJ(HE,2),gJ=mJ.b,MD=mJ.r;gJ[28]=258,MD[258]=28;var yJ=pJ(GE,0),nEe=yJ.b,h$=yJ.r,CD=new id(32768);for(var Io=0;Io<32768;++Io){var ly=(Io&43690)>>1|(Io&21845)<<1;ly=(ly&52428)>>2|(ly&13107)<<2,ly=(ly&61680)>>4|(ly&3855)<<4,CD[Io]=((ly&65280)>>8|(ly&255)<<8)>>1}var Tm=function(t,e,n){for(var r=t.length,s=0,l=new id(e);s<r;++s)t[s]&&++l[t[s]-1];var f=new id(e);for(s=1;s<e;++s)f[s]=f[s-1]+l[s-1]<<1;var i;if(n){i=new id(1<<e);var x=15-e;for(s=0;s<r;++s)if(t[s])for(var S=s<<4|t[s],I=e-t[s],R=f[t[s]-1]++<<I,F=R|(1<<I)-1;R<=F;++R)i[CD[R]>>x]=S}else for(i=new id(r),s=0;s<r;++s)t[s]&&(i[s]=CD[f[t[s]-1]++]>>15-t[s]);return i},Cy=new uh(288);for(var Io=0;Io<144;++Io)Cy[Io]=8;for(var Io=144;Io<256;++Io)Cy[Io]=9;for(var Io=256;Io<280;++Io)Cy[Io]=7;for(var Io=280;Io<288;++Io)Cy[Io]=8;var qw=new uh(32);for(var Io=0;Io<32;++Io)qw[Io]=5;var rEe=Tm(Cy,9,0),iEe=Tm(Cy,9,1),aEe=Tm(qw,5,0),sEe=Tm(qw,5,1),n4=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},_p=function(t,e,n){var r=e/8|0;return(t[r]|t[r+1]<<8)>>(e&7)&n},r4=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(e&7)},gN=function(t){return(t+7)/8|0},_J=function(t,e,n){return(n==null||n>t.length)&&(n=t.length),new uh(t.subarray(e,n))},oEe=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],xp=function(t,e,n){var r=new Error(e||oEe[t]);if(r.code=t,Error.captureStackTrace&&Error.captureStackTrace(r,xp),!n)throw r;return r},lEe=function(t,e,n,r){var s=t.length,l=0;if(!s||e.f&&!e.l)return n||new uh(0);var f=!n,i=f||e.i!=2,x=e.i;f&&(n=new uh(s*3));var S=function(on){var Kt=n.length;if(on>Kt){var Pn=new uh(Math.max(Kt*2,on));Pn.set(n),n=Pn}},I=e.f||0,R=e.p||0,F=e.b||0,j=e.l,H=e.d,G=e.m,W=e.n,J=s*8;do{if(!j){I=_p(t,R,1);var ie=_p(t,R+1,3);if(R+=3,ie)if(ie==1)j=iEe,H=sEe,G=9,W=5;else if(ie==2){var ye=_p(t,R,31)+257,pe=_p(t,R+10,15)+4,be=ye+_p(t,R+5,31)+1;R+=14;for(var Ae=new uh(be),Oe=new uh(19),ue=0;ue<pe;++ue)Oe[ED[ue]]=_p(t,R+ue*3,7);R+=pe*3;for(var we=n4(Oe),ke=(1<<we)-1,De=Tm(Oe,we,1),ue=0;ue<be;){var je=De[_p(t,R,ke)];R+=je&15;var he=je>>4;if(he<16)Ae[ue++]=he;else{var ze=0,Ue=0;for(he==16?(Ue=3+_p(t,R,3),R+=2,ze=Ae[ue-1]):he==17?(Ue=3+_p(t,R,7),R+=3):he==18&&(Ue=11+_p(t,R,127),R+=7);Ue--;)Ae[ue++]=ze}}var Fe=Ae.subarray(0,ye),Qe=Ae.subarray(ye);G=n4(Fe),W=n4(Qe),j=Tm(Fe,G,1),H=Tm(Qe,W,1)}else xp(1);else{var he=gN(R)+4,ge=t[he-4]|t[he-3]<<8,fe=he+ge;if(fe>s){x&&xp(0);break}i&&S(F+ge),n.set(t.subarray(he,fe),F),e.b=F+=ge,e.p=R=fe*8,e.f=I;continue}if(R>J){x&&xp(0);break}}i&&S(F+131072);for(var Be=(1<<G)-1,bt=(1<<W)-1,xe=R;;xe=R){var ze=j[r4(t,R)&Be],Le=ze>>4;if(R+=ze&15,R>J){x&&xp(0);break}if(ze||xp(2),Le<256)n[F++]=Le;else if(Le==256){xe=R,j=null;break}else{var Xe=Le-254;if(Le>264){var ue=Le-257,ct=HE[ue];Xe=_p(t,R,(1<<ct)-1)+gJ[ue],R+=ct}var vt=H[r4(t,R)&bt],Nt=vt>>4;vt||xp(3),R+=vt&15;var Qe=nEe[Nt];if(Nt>3){var ct=GE[Nt];Qe+=r4(t,R)&(1<<ct)-1,R+=ct}if(R>J){x&&xp(0);break}i&&S(F+131072);var mt=F+Xe;if(F<Qe){var yt=l-Qe,_e=Math.min(Qe,mt);for(yt+F<0&&xp(3);F<_e;++F)n[F]=r[yt+F]}for(;F<mt;++F)n[F]=n[F-Qe]}}e.l=j,e.p=xe,e.b=F,e.f=I,j&&(I=1,e.m=G,e.d=H,e.n=W)}while(!I);return F!=n.length&&f?_J(n,0,F):n.subarray(0,F)},Jm=function(t,e,n){n<<=e&7;var r=e/8|0;t[r]|=n,t[r+1]|=n>>8},px=function(t,e,n){n<<=e&7;var r=e/8|0;t[r]|=n,t[r+1]|=n>>8,t[r+2]|=n>>16},i4=function(t,e){for(var n=[],r=0;r<t.length;++r)t[r]&&n.push({s:r,f:t[r]});var s=n.length,l=n.slice();if(!s)return{t:bJ,l:0};if(s==1){var f=new uh(n[0].s+1);return f[n[0].s]=1,{t:f,l:1}}n.sort(function(fe,ye){return fe.f-ye.f}),n.push({s:-1,f:25001});var i=n[0],x=n[1],S=0,I=1,R=2;for(n[0]={s:-1,f:i.f+x.f,l:i,r:x};I!=s-1;)i=n[n[S].f<n[R].f?S++:R++],x=n[S!=I&&n[S].f<n[R].f?S++:R++],n[I++]={s:-1,f:i.f+x.f,l:i,r:x};for(var F=l[0].s,r=1;r<s;++r)l[r].s>F&&(F=l[r].s);var j=new id(F+1),H=ID(n[I-1],j,0);if(H>e){var r=0,G=0,W=H-e,J=1<<W;for(l.sort(function(ye,pe){return j[pe.s]-j[ye.s]||ye.f-pe.f});r<s;++r){var ie=l[r].s;if(j[ie]>e)G+=J-(1<<H-j[ie]),j[ie]=e;else break}for(G>>=W;G>0;){var he=l[r].s;j[he]<e?G-=1<<e-j[he]++-1:++r}for(;r>=0&&G;--r){var ge=l[r].s;j[ge]==e&&(--j[ge],++G)}H=e}return{t:new uh(j),l:H}},ID=function(t,e,n){return t.s==-1?Math.max(ID(t.l,e,n+1),ID(t.r,e,n+1)):e[t.s]=n},f$=function(t){for(var e=t.length;e&&!t[--e];);for(var n=new id(++e),r=0,s=t[0],l=1,f=function(x){n[r++]=x},i=1;i<=e;++i)if(t[i]==s&&i!=e)++l;else{if(!s&&l>2){for(;l>138;l-=138)f(32754);l>2&&(f(l>10?l-11<<5|28690:l-3<<5|12305),l=0)}else if(l>3){for(f(s),--l;l>6;l-=6)f(8304);l>2&&(f(l-3<<5|8208),l=0)}for(;l--;)f(s);l=1,s=t[i]}return{c:n.subarray(0,r),n:e}},mx=function(t,e){for(var n=0,r=0;r<e.length;++r)n+=t[r]*e[r];return n},vJ=function(t,e,n){var r=n.length,s=gN(e+2);t[s]=r&255,t[s+1]=r>>8,t[s+2]=t[s]^255,t[s+3]=t[s+1]^255;for(var l=0;l<r;++l)t[s+l+4]=n[l];return(s+4+r)*8},d$=function(t,e,n,r,s,l,f,i,x,S,I){Jm(e,I++,n),++s[256];for(var R=i4(s,15),F=R.t,j=R.l,H=i4(l,15),G=H.t,W=H.l,J=f$(F),ie=J.c,he=J.n,ge=f$(G),fe=ge.c,ye=ge.n,pe=new id(19),be=0;be<ie.length;++be)++pe[ie[be]&31];for(var be=0;be<fe.length;++be)++pe[fe[be]&31];for(var Ae=i4(pe,7),Oe=Ae.t,ue=Ae.l,we=19;we>4&&!Oe[ED[we-1]];--we);var ke=S+5<<3,De=mx(s,Cy)+mx(l,qw)+f,je=mx(s,F)+mx(l,G)+f+14+3*we+mx(pe,Oe)+2*pe[16]+3*pe[17]+7*pe[18];if(x>=0&&ke<=De&&ke<=je)return vJ(e,I,t.subarray(x,x+S));var ze,Ue,Fe,Qe;if(Jm(e,I,1+(je<De)),I+=2,je<De){ze=Tm(F,j,0),Ue=F,Fe=Tm(G,W,0),Qe=G;var Be=Tm(Oe,ue,0);Jm(e,I,he-257),Jm(e,I+5,ye-1),Jm(e,I+10,we-4),I+=14;for(var be=0;be<we;++be)Jm(e,I+3*be,Oe[ED[be]]);I+=3*we;for(var bt=[ie,fe],xe=0;xe<2;++xe)for(var Le=bt[xe],be=0;be<Le.length;++be){var Xe=Le[be]&31;Jm(e,I,Be[Xe]),I+=Oe[Xe],Xe>15&&(Jm(e,I,Le[be]>>5&127),I+=Le[be]>>12)}}else ze=rEe,Ue=Cy,Fe=aEe,Qe=qw;for(var be=0;be<i;++be){var ct=r[be];if(ct>255){var Xe=ct>>18&31;px(e,I,ze[Xe+257]),I+=Ue[Xe+257],Xe>7&&(Jm(e,I,ct>>23&31),I+=HE[Xe]);var vt=ct&31;px(e,I,Fe[vt]),I+=Qe[vt],vt>3&&(px(e,I,ct>>5&8191),I+=GE[vt])}else px(e,I,ze[ct]),I+=Ue[ct]}return px(e,I,ze[256]),I+Ue[256]},cEe=new mN([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),bJ=new uh(0),uEe=function(t,e,n,r,s,l){var f=l.z||t.length,i=new uh(r+f+5*(1+Math.ceil(f/7e3))+s),x=i.subarray(r,i.length-s),S=l.l,I=(l.r||0)&7;if(e){I&&(x[0]=l.r>>3);for(var R=cEe[e-1],F=R>>13,j=R&8191,H=(1<<n)-1,G=l.p||new id(32768),W=l.h||new id(H+1),J=Math.ceil(n/3),ie=2*J,he=function(Ut){return(t[Ut]^t[Ut+1]<<J^t[Ut+2]<<ie)&H},ge=new mN(25e3),fe=new id(288),ye=new id(32),pe=0,be=0,Ae=l.i||0,Oe=0,ue=l.w||0,we=0;Ae+2<f;++Ae){var ke=he(Ae),De=Ae&32767,je=W[ke];if(G[De]=je,W[ke]=De,ue<=Ae){var ze=f-Ae;if((pe>7e3||Oe>24576)&&(ze>423||!S)){I=d$(t,x,0,ge,fe,ye,be,Oe,we,Ae-we,I),Oe=pe=be=0,we=Ae;for(var Ue=0;Ue<286;++Ue)fe[Ue]=0;for(var Ue=0;Ue<30;++Ue)ye[Ue]=0}var Fe=2,Qe=0,Be=j,bt=De-je&32767;if(ze>2&&ke==he(Ae-bt))for(var xe=Math.min(F,ze)-1,Le=Math.min(32767,Ae),Xe=Math.min(258,ze);bt<=Le&&--Be&&De!=je;){if(t[Ae+Fe]==t[Ae+Fe-bt]){for(var ct=0;ct<Xe&&t[Ae+ct]==t[Ae+ct-bt];++ct);if(ct>Fe){if(Fe=ct,Qe=bt,ct>xe)break;for(var vt=Math.min(bt,ct-2),Nt=0,Ue=0;Ue<vt;++Ue){var mt=Ae-bt+Ue&32767,yt=G[mt],_e=mt-yt&32767;_e>Nt&&(Nt=_e,je=mt)}}}De=je,je=G[De],bt+=De-je&32767}if(Qe){ge[Oe++]=268435456|MD[Fe]<<18|h$[Qe];var on=MD[Fe]&31,Kt=h$[Qe]&31;be+=HE[on]+GE[Kt],++fe[257+on],++ye[Kt],ue=Ae+Fe,++pe}else ge[Oe++]=t[Ae],++fe[t[Ae]]}}for(Ae=Math.max(Ae,ue);Ae<f;++Ae)ge[Oe++]=t[Ae],++fe[t[Ae]];I=d$(t,x,S,ge,fe,ye,be,Oe,we,Ae-we,I),S||(l.r=I&7|x[I/8|0]<<3,I-=7,l.h=W,l.p=G,l.i=Ae,l.w=ue)}else{for(var Ae=l.w||0;Ae<f+S;Ae+=65535){var Pn=Ae+65535;Pn>=f&&(x[I/8|0]=S,Pn=f),I=vJ(x,I+1,t.subarray(Ae,Pn))}l.i=f}return _J(i,0,r+gN(I)+s)},xJ=function(){var t=1,e=0;return{p:function(n){for(var r=t,s=e,l=n.length|0,f=0;f!=l;){for(var i=Math.min(f+2655,l);f<i;++f)s+=r+=n[f];r=(r&65535)+15*(r>>16),s=(s&65535)+15*(s>>16)}t=r,e=s},d:function(){return t%=65521,e%=65521,(t&255)<<24|(t&65280)<<8|(e&255)<<8|e>>8}}},hEe=function(t,e,n,r,s){if(!s&&(s={l:1},e.dictionary)){var l=e.dictionary.subarray(-32768),f=new uh(l.length+t.length);f.set(l),f.set(t,l.length),t=f,s.w=l.length}return uEe(t,e.level==null?6:e.level,e.mem==null?s.l?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):20:12+e.mem,n,r,s)},wJ=function(t,e,n){for(;n;++e)t[e]=n,n>>>=8},fEe=function(t,e){var n=e.level,r=n==0?0:n<6?1:n==9?3:2;if(t[0]=120,t[1]=r<<6|(e.dictionary&&32),t[1]|=31-(t[0]<<8|t[1])%31,e.dictionary){var s=xJ();s.p(e.dictionary),wJ(t,2,s.d())}},dEe=function(t,e){return((t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31)&&xp(6,"invalid zlib data"),(t[1]>>5&1)==1&&xp(6,"invalid zlib data: "+(t[1]&32?"need":"unexpected")+" dictionary"),(t[1]>>3&4)+2};function PD(t,e){e||(e={});var n=xJ();n.p(t);var r=hEe(t,e,e.dictionary?6:2,4);return fEe(r,e),wJ(r,r.length-4,n.d()),r}function pEe(t,e){return lEe(t.subarray(dEe(t),-4),{i:2},e,e)}var mEe=typeof TextDecoder<"u"&&new TextDecoder,gEe=0;try{mEe.decode(bJ,{stream:!0}),gEe=1}catch{}var Wi=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function a4(){Wi.console&&typeof Wi.console.log=="function"&&Wi.console.log.apply(Wi.console,arguments)}var ro={log:a4,warn:function(t){Wi.console&&(typeof Wi.console.warn=="function"?Wi.console.warn.apply(Wi.console,arguments):a4.call(null,arguments))},error:function(t){Wi.console&&(typeof Wi.console.error=="function"?Wi.console.error.apply(Wi.console,arguments):a4(t))}};function s4(t,e,n){var r=new XMLHttpRequest;r.open("GET",t),r.responseType="blob",r.onload=function(){R_(r.response,e,n)},r.onerror=function(){ro.error("could not download file")},r.send()}function p$(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch{}return e.status>=200&&e.status<=299}function hA(t){try{t.dispatchEvent(new MouseEvent("click"))}catch{var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var jx,OD,R_=Wi.saveAs||((typeof window>"u"?"undefined":ks(window))!=="object"||window!==Wi?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(t,e,n){var r=Wi.URL||Wi.webkitURL,s=document.createElement("a");e=e||t.name||"download",s.download=e,s.rel="noopener",typeof t=="string"?(s.href=t,s.origin!==location.origin?p$(s.href)?s4(t,e,n):hA(s,s.target="_blank"):hA(s)):(s.href=r.createObjectURL(t),setTimeout(function(){r.revokeObjectURL(s.href)},4e4),setTimeout(function(){hA(s)},0))}:"msSaveOrOpenBlob"in navigator?function(t,e,n){if(e=e||t.name||"download",typeof t=="string")if(p$(t))s4(t,e,n);else{var r=document.createElement("a");r.href=t,r.target="_blank",setTimeout(function(){hA(r)})}else navigator.msSaveOrOpenBlob(function(s,l){return l===void 0?l={autoBom:!1}:ks(l)!=="object"&&(ro.warn("Deprecated: Expected third argument to be a object"),l={autoBom:!l}),l.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(s.type)?new Blob(["\uFEFF",s],{type:s.type}):s}(t,n),e)}:function(t,e,n,r){if((r=r||open("","_blank"))&&(r.document.title=r.document.body.innerText="downloading..."),typeof t=="string")return s4(t,e,n);var s=t.type==="application/octet-stream",l=/constructor/i.test(Wi.HTMLElement)||Wi.safari,f=/CriOS\/[\d]+/.test(navigator.userAgent);if((f||s&&l)&&(typeof FileReader>"u"?"undefined":ks(FileReader))==="object"){var i=new FileReader;i.onloadend=function(){var I=i.result;I=f?I:I.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=I:location=I,r=null},i.readAsDataURL(t)}else{var x=Wi.URL||Wi.webkitURL,S=x.createObjectURL(t);r?r.location=S:location.href=S,r=null,setTimeout(function(){x.revokeObjectURL(S)},4e4)}});/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */function SJ(t){var e;t=t||"",this.ok=!1,t.charAt(0)=="#"&&(t=t.substr(1,6)),t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[t=(t=t.replace(/ /g,"")).toLowerCase()]||t;for(var n=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(i){return[parseInt(i[1]),parseInt(i[2]),parseInt(i[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(i){return[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(i){return[parseInt(i[1]+i[1],16),parseInt(i[2]+i[2],16),parseInt(i[3]+i[3],16)]}}],r=0;r<n.length;r++){var s=n[r].re,l=n[r].process,f=s.exec(t);f&&(e=l(f),this.r=e[0],this.g=e[1],this.b=e[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var i=this.r.toString(16),x=this.g.toString(16),S=this.b.toString(16);return i.length==1&&(i="0"+i),x.length==1&&(x="0"+x),S.length==1&&(S="0"+S),"#"+i+x+S}}/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */function o4(t,e){var n=t[0],r=t[1],s=t[2],l=t[3];n=th(n,r,s,l,e[0],7,-680876936),l=th(l,n,r,s,e[1],12,-389564586),s=th(s,l,n,r,e[2],17,606105819),r=th(r,s,l,n,e[3],22,-1044525330),n=th(n,r,s,l,e[4],7,-176418897),l=th(l,n,r,s,e[5],12,1200080426),s=th(s,l,n,r,e[6],17,-1473231341),r=th(r,s,l,n,e[7],22,-45705983),n=th(n,r,s,l,e[8],7,1770035416),l=th(l,n,r,s,e[9],12,-1958414417),s=th(s,l,n,r,e[10],17,-42063),r=th(r,s,l,n,e[11],22,-1990404162),n=th(n,r,s,l,e[12],7,1804603682),l=th(l,n,r,s,e[13],12,-40341101),s=th(s,l,n,r,e[14],17,-1502002290),n=nh(n,r=th(r,s,l,n,e[15],22,1236535329),s,l,e[1],5,-165796510),l=nh(l,n,r,s,e[6],9,-1069501632),s=nh(s,l,n,r,e[11],14,643717713),r=nh(r,s,l,n,e[0],20,-373897302),n=nh(n,r,s,l,e[5],5,-701558691),l=nh(l,n,r,s,e[10],9,38016083),s=nh(s,l,n,r,e[15],14,-660478335),r=nh(r,s,l,n,e[4],20,-405537848),n=nh(n,r,s,l,e[9],5,568446438),l=nh(l,n,r,s,e[14],9,-1019803690),s=nh(s,l,n,r,e[3],14,-187363961),r=nh(r,s,l,n,e[8],20,1163531501),n=nh(n,r,s,l,e[13],5,-1444681467),l=nh(l,n,r,s,e[2],9,-51403784),s=nh(s,l,n,r,e[7],14,1735328473),n=rh(n,r=nh(r,s,l,n,e[12],20,-1926607734),s,l,e[5],4,-378558),l=rh(l,n,r,s,e[8],11,-2022574463),s=rh(s,l,n,r,e[11],16,1839030562),r=rh(r,s,l,n,e[14],23,-35309556),n=rh(n,r,s,l,e[1],4,-1530992060),l=rh(l,n,r,s,e[4],11,1272893353),s=rh(s,l,n,r,e[7],16,-155497632),r=rh(r,s,l,n,e[10],23,-1094730640),n=rh(n,r,s,l,e[13],4,681279174),l=rh(l,n,r,s,e[0],11,-358537222),s=rh(s,l,n,r,e[3],16,-722521979),r=rh(r,s,l,n,e[6],23,76029189),n=rh(n,r,s,l,e[9],4,-640364487),l=rh(l,n,r,s,e[12],11,-421815835),s=rh(s,l,n,r,e[15],16,530742520),n=ih(n,r=rh(r,s,l,n,e[2],23,-995338651),s,l,e[0],6,-198630844),l=ih(l,n,r,s,e[7],10,1126891415),s=ih(s,l,n,r,e[14],15,-1416354905),r=ih(r,s,l,n,e[5],21,-57434055),n=ih(n,r,s,l,e[12],6,1700485571),l=ih(l,n,r,s,e[3],10,-1894986606),s=ih(s,l,n,r,e[10],15,-1051523),r=ih(r,s,l,n,e[1],21,-2054922799),n=ih(n,r,s,l,e[8],6,1873313359),l=ih(l,n,r,s,e[15],10,-30611744),s=ih(s,l,n,r,e[6],15,-1560198380),r=ih(r,s,l,n,e[13],21,1309151649),n=ih(n,r,s,l,e[4],6,-145523070),l=ih(l,n,r,s,e[11],10,-1120210379),s=ih(s,l,n,r,e[2],15,718787259),r=ih(r,s,l,n,e[9],21,-343485551),t[0]=by(n,t[0]),t[1]=by(r,t[1]),t[2]=by(s,t[2]),t[3]=by(l,t[3])}function WE(t,e,n,r,s,l){return e=by(by(e,t),by(r,l)),by(e<<s|e>>>32-s,n)}function th(t,e,n,r,s,l,f){return WE(e&n|~e&r,t,e,s,l,f)}function nh(t,e,n,r,s,l,f){return WE(e&r|n&~r,t,e,s,l,f)}function rh(t,e,n,r,s,l,f){return WE(e^n^r,t,e,s,l,f)}function ih(t,e,n,r,s,l,f){return WE(n^(e|~r),t,e,s,l,f)}function AJ(t){var e,n=t.length,r=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=t.length;e+=64)o4(r,yEe(t.substring(e-64,e)));t=t.substring(e-64);var s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<t.length;e++)s[e>>2]|=t.charCodeAt(e)<<(e%4<<3);if(s[e>>2]|=128<<(e%4<<3),e>55)for(o4(r,s),e=0;e<16;e++)s[e]=0;return s[14]=8*n,o4(r,s),r}function yEe(t){var e,n=[];for(e=0;e<64;e+=4)n[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return n}jx=Wi.atob.bind(Wi),OD=Wi.btoa.bind(Wi);var m$="0123456789abcdef".split("");function _Ee(t){for(var e="",n=0;n<4;n++)e+=m$[t>>8*n+4&15]+m$[t>>8*n&15];return e}function vEe(t){return String.fromCharCode((255&t)>>0,(65280&t)>>8,(16711680&t)>>16,(4278190080&t)>>24)}function RD(t){return AJ(t).map(vEe).join("")}var bEe=function(t){for(var e=0;e<t.length;e++)t[e]=_Ee(t[e]);return t.join("")}(AJ("hello"))!="5d41402abc4b2a76b9719d911017c592";function by(t,e){if(bEe){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}return t+e&4294967295}/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */function DD(t,e){var n,r,s,l;if(t!==n){for(var f=(s=t,l=1+(256/t.length>>0),new Array(l+1).join(s)),i=[],x=0;x<256;x++)i[x]=x;var S=0;for(x=0;x<256;x++){var I=i[x];S=(S+I+f.charCodeAt(x))%256,i[x]=i[S],i[S]=I}n=t,r=i}else i=r;var R=e.length,F=0,j=0,H="";for(x=0;x<R;x++)j=(j+(I=i[F=(F+1)%256]))%256,i[F]=i[j],i[j]=I,f=i[(i[F]+i[j])%256],H+=String.fromCharCode(e.charCodeAt(x)^f);return H}/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */var g$={print:4,modify:8,copy:16,"annot-forms":32};function y0(t,e,n,r){this.v=1,this.r=2;var s=192;t.forEach(function(i){if(g$.perm!==void 0)throw new Error("Invalid permission: "+i);s+=g$[i]}),this.padding="(¿N^NuAd\0NVÿú\b..\0¶Ðh>/\f©þdSiz";var l=(e+this.padding).substr(0,32),f=(n+this.padding).substr(0,32);this.O=this.processOwnerPassword(l,f),this.P=-(1+(255^s)),this.encryptionKey=RD(l+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(r)).substr(0,5),this.U=DD(this.encryptionKey,this.padding)}function _0(t){if(/[^\u0000-\u00ff]/.test(t))throw new Error("Invalid PDF Name Object: "+t+", Only accept ASCII characters.");for(var e="",n=t.length,r=0;r<n;r++){var s=t.charCodeAt(r);s<33||s===35||s===37||s===40||s===41||s===47||s===60||s===62||s===91||s===93||s===123||s===125||s>126?e+="#"+("0"+s.toString(16)).slice(-2):e+=t[r]}return e}function y$(t){if(ks(t)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var e={};this.subscribe=function(n,r,s){if(s=s||!1,typeof n!="string"||typeof r!="function"||typeof s!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");e.hasOwnProperty(n)||(e[n]={});var l=Math.random().toString(35);return e[n][l]=[r,!!s],l},this.unsubscribe=function(n){for(var r in e)if(e[r][n])return delete e[r][n],Object.keys(e[r]).length===0&&delete e[r],!0;return!1},this.publish=function(n){if(e.hasOwnProperty(n)){var r=Array.prototype.slice.call(arguments,1),s=[];for(var l in e[n]){var f=e[n][l];try{f[0].apply(t,r)}catch(i){Wi.console&&ro.error("jsPDF PubSub Error",i.message,i)}f[1]&&s.push(l)}s.length&&s.forEach(this.unsubscribe)}},this.getTopics=function(){return e}}function p5(t){if(!(this instanceof p5))return new p5(t);var e="opacity,stroke-opacity".split(",");for(var n in t)t.hasOwnProperty(n)&&e.indexOf(n)>=0&&(this[n]=t[n]);this.id="",this.objectNumber=-1}function TJ(t,e){this.gState=t,this.matrix=e,this.id="",this.objectNumber=-1}function L_(t,e,n,r,s){if(!(this instanceof L_))return new L_(t,e,n,r,s);this.type=t==="axial"?2:3,this.coords=e,this.colors=n,TJ.call(this,r,s)}function C0(t,e,n,r,s){if(!(this instanceof C0))return new C0(t,e,n,r,s);this.boundingBox=t,this.xStep=e,this.yStep=n,this.stream="",this.cloneIndex=0,TJ.call(this,r,s)}function Ui(t){var e,n=typeof arguments[0]=="string"?arguments[0]:"p",r=arguments[1],s=arguments[2],l=arguments[3],f=[],i=1,x=16,S="S",I=null;ks(t=t||{})==="object"&&(n=t.orientation,r=t.unit||r,s=t.format||s,l=t.compress||t.compressPdf||l,(I=t.encryption||null)!==null&&(I.userPassword=I.userPassword||"",I.ownerPassword=I.ownerPassword||"",I.userPermissions=I.userPermissions||[]),i=typeof t.userUnit=="number"?Math.abs(t.userUnit):1,t.precision!==void 0&&(e=t.precision),t.floatPrecision!==void 0&&(x=t.floatPrecision),S=t.defaultPathOperation||"S"),f=t.filters||(l===!0?["FlateEncode"]:f),r=r||"mm",n=(""+(n||"P")).toLowerCase();var R=t.putOnlyUsedFonts||!1,F={},j={internal:{},__private__:{}};j.__private__.PubSub=y$;var H="1.3",G=j.__private__.getPdfVersion=function(){return H};j.__private__.setPdfVersion=function(se){H=se};var W={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};j.__private__.getPageFormats=function(){return W};var J=j.__private__.getPageFormat=function(se){return W[se]};s=s||"a4";var ie={COMPAT:"compat",ADVANCED:"advanced"},he=ie.COMPAT;function ge(){this.saveGraphicsState(),At(new Re(hn,0,0,-hn,0,Hl()*hn).toString()+" cm"),this.setFontSize(this.getFontSize()/hn),S="n",he=ie.ADVANCED}function fe(){this.restoreGraphicsState(),S="S",he=ie.COMPAT}var ye=j.__private__.combineFontStyleAndFontWeight=function(se,Ge){if(se=="bold"&&Ge=="normal"||se=="bold"&&Ge==400||se=="normal"&&Ge=="italic"||se=="bold"&&Ge=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return Ge&&(se=Ge==400||Ge==="normal"?se==="italic"?"italic":"normal":Ge!=700&&Ge!=="bold"||se!=="normal"?(Ge==700?"bold":Ge)+""+se:"bold"),se};j.advancedAPI=function(se){var Ge=he===ie.COMPAT;return Ge&&ge.call(this),typeof se!="function"||(se(this),Ge&&fe.call(this)),this},j.compatAPI=function(se){var Ge=he===ie.ADVANCED;return Ge&&fe.call(this),typeof se!="function"||(se(this),Ge&&ge.call(this)),this},j.isAdvancedAPI=function(){return he===ie.ADVANCED};var pe,be=function(se){if(he!==ie.ADVANCED)throw new Error(se+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},Ae=j.roundToPrecision=j.__private__.roundToPrecision=function(se,Ge){var Rt=e||Ge;if(isNaN(se)||isNaN(Rt))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return se.toFixed(Rt).replace(/0+$/,"")};pe=j.hpf=j.__private__.hpf=typeof x=="number"?function(se){if(isNaN(se))throw new Error("Invalid argument passed to jsPDF.hpf");return Ae(se,x)}:x==="smart"?function(se){if(isNaN(se))throw new Error("Invalid argument passed to jsPDF.hpf");return Ae(se,se>-1&&se<1?16:5)}:function(se){if(isNaN(se))throw new Error("Invalid argument passed to jsPDF.hpf");return Ae(se,16)};var Oe=j.f2=j.__private__.f2=function(se){if(isNaN(se))throw new Error("Invalid argument passed to jsPDF.f2");return Ae(se,2)},ue=j.__private__.f3=function(se){if(isNaN(se))throw new Error("Invalid argument passed to jsPDF.f3");return Ae(se,3)},we=j.scale=j.__private__.scale=function(se){if(isNaN(se))throw new Error("Invalid argument passed to jsPDF.scale");return he===ie.COMPAT?se*hn:he===ie.ADVANCED?se:void 0},ke=function(se){return he===ie.COMPAT?Hl()-se:he===ie.ADVANCED?se:void 0},De=function(se){return we(ke(se))};j.__private__.setPrecision=j.setPrecision=function(se){typeof parseInt(se,10)=="number"&&(e=parseInt(se,10))};var je,ze="00000000000000000000000000000000",Ue=j.__private__.getFileId=function(){return ze},Fe=j.__private__.setFileId=function(se){return ze=se!==void 0&&/^[a-fA-F0-9]{32}$/.test(se)?se.toUpperCase():ze.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),I!==null&&(oo=new y0(I.userPermissions,I.userPassword,I.ownerPassword,ze)),ze};j.setFileId=function(se){return Fe(se),this},j.getFileId=function(){return Ue()};var Qe=j.__private__.convertDateToPDFDate=function(se){var Ge=se.getTimezoneOffset(),Rt=Ge<0?"+":"-",Yt=Math.floor(Math.abs(Ge/60)),dn=Math.abs(Ge%60),kn=[Rt,Xe(Yt),"'",Xe(dn),"'"].join("");return["D:",se.getFullYear(),Xe(se.getMonth()+1),Xe(se.getDate()),Xe(se.getHours()),Xe(se.getMinutes()),Xe(se.getSeconds()),kn].join("")},Be=j.__private__.convertPDFDateToDate=function(se){var Ge=parseInt(se.substr(2,4),10),Rt=parseInt(se.substr(6,2),10)-1,Yt=parseInt(se.substr(8,2),10),dn=parseInt(se.substr(10,2),10),kn=parseInt(se.substr(12,2),10),rr=parseInt(se.substr(14,2),10);return new Date(Ge,Rt,Yt,dn,kn,rr,0)},bt=j.__private__.setCreationDate=function(se){var Ge;if(se===void 0&&(se=new Date),se instanceof Date)Ge=Qe(se);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(se))throw new Error("Invalid argument passed to jsPDF.setCreationDate");Ge=se}return je=Ge},xe=j.__private__.getCreationDate=function(se){var Ge=je;return se==="jsDate"&&(Ge=Be(je)),Ge};j.setCreationDate=function(se){return bt(se),this},j.getCreationDate=function(se){return xe(se)};var Le,Xe=j.__private__.padd2=function(se){return("0"+parseInt(se)).slice(-2)},ct=j.__private__.padd2Hex=function(se){return("00"+(se=se.toString())).substr(se.length)},vt=0,Nt=[],mt=[],yt=0,_e=[],on=[],Kt=!1,Pn=mt,Ut=function(){vt=0,yt=0,mt=[],Nt=[],_e=[],Gt=Ft(),$t=Ft()};j.__private__.setCustomOutputDestination=function(se){Kt=!0,Pn=se};var cn=function(se){Kt||(Pn=se)};j.__private__.resetCustomOutputDestination=function(){Kt=!1,Pn=mt};var At=j.__private__.out=function(se){return se=se.toString(),yt+=se.length+1,Pn.push(se),Pn},xr=j.__private__.write=function(se){return At(arguments.length===1?se.toString():Array.prototype.join.call(arguments," "))},Rn=j.__private__.getArrayBuffer=function(se){for(var Ge=se.length,Rt=new ArrayBuffer(Ge),Yt=new Uint8Array(Rt);Ge--;)Yt[Ge]=se.charCodeAt(Ge);return Rt},Dn=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];j.__private__.getStandardFonts=function(){return Dn};var ar=t.fontSize||16;j.__private__.setFontSize=j.setFontSize=function(se){return ar=he===ie.ADVANCED?se/hn:se,this};var hr,ur=j.__private__.getFontSize=j.getFontSize=function(){return he===ie.COMPAT?ar:ar*hn},Ir=t.R2L||!1;j.__private__.setR2L=j.setR2L=function(se){return Ir=se,this},j.__private__.getR2L=j.getR2L=function(){return Ir};var Un,Vr=j.__private__.setZoomMode=function(se){var Ge=[void 0,null,"fullwidth","fullheight","fullpage","original"];if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(se))hr=se;else if(isNaN(se)){if(Ge.indexOf(se)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+se+'" is not recognized.');hr=se}else hr=parseInt(se,10)};j.__private__.getZoomMode=function(){return hr};var pi,Li=j.__private__.setPageMode=function(se){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(se)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+se+'" is not recognized.');Un=se};j.__private__.getPageMode=function(){return Un};var wi=j.__private__.setLayoutMode=function(se){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(se)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+se+'" is not recognized.');pi=se};j.__private__.getLayoutMode=function(){return pi},j.__private__.setDisplayMode=j.setDisplayMode=function(se,Ge,Rt){return Vr(se),wi(Ge),Li(Rt),this};var xn={title:"",subject:"",author:"",keywords:"",creator:""};j.__private__.getDocumentProperty=function(se){if(Object.keys(xn).indexOf(se)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return xn[se]},j.__private__.getDocumentProperties=function(){return xn},j.__private__.setDocumentProperties=j.setProperties=j.setDocumentProperties=function(se){for(var Ge in xn)xn.hasOwnProperty(Ge)&&se[Ge]&&(xn[Ge]=se[Ge]);return this},j.__private__.setDocumentProperty=function(se,Ge){if(Object.keys(xn).indexOf(se)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return xn[se]=Ge};var Xn,hn,er,yr,Vi,ki={},mi={},ti=[],Pr={},ys={},Fa={},Za={},Oo=null,Ia=0,fi=[],la=new y$(j),Iu=t.hotfixes||[],zs={},Zt={},Ee=[],Re=function se(Ge,Rt,Yt,dn,kn,rr){if(!(this instanceof se))return new se(Ge,Rt,Yt,dn,kn,rr);isNaN(Ge)&&(Ge=1),isNaN(Rt)&&(Rt=0),isNaN(Yt)&&(Yt=0),isNaN(dn)&&(dn=1),isNaN(kn)&&(kn=0),isNaN(rr)&&(rr=0),this._matrix=[Ge,Rt,Yt,dn,kn,rr]};Object.defineProperty(Re.prototype,"sx",{get:function(){return this._matrix[0]},set:function(se){this._matrix[0]=se}}),Object.defineProperty(Re.prototype,"shy",{get:function(){return this._matrix[1]},set:function(se){this._matrix[1]=se}}),Object.defineProperty(Re.prototype,"shx",{get:function(){return this._matrix[2]},set:function(se){this._matrix[2]=se}}),Object.defineProperty(Re.prototype,"sy",{get:function(){return this._matrix[3]},set:function(se){this._matrix[3]=se}}),Object.defineProperty(Re.prototype,"tx",{get:function(){return this._matrix[4]},set:function(se){this._matrix[4]=se}}),Object.defineProperty(Re.prototype,"ty",{get:function(){return this._matrix[5]},set:function(se){this._matrix[5]=se}}),Object.defineProperty(Re.prototype,"a",{get:function(){return this._matrix[0]},set:function(se){this._matrix[0]=se}}),Object.defineProperty(Re.prototype,"b",{get:function(){return this._matrix[1]},set:function(se){this._matrix[1]=se}}),Object.defineProperty(Re.prototype,"c",{get:function(){return this._matrix[2]},set:function(se){this._matrix[2]=se}}),Object.defineProperty(Re.prototype,"d",{get:function(){return this._matrix[3]},set:function(se){this._matrix[3]=se}}),Object.defineProperty(Re.prototype,"e",{get:function(){return this._matrix[4]},set:function(se){this._matrix[4]=se}}),Object.defineProperty(Re.prototype,"f",{get:function(){return this._matrix[5]},set:function(se){this._matrix[5]=se}}),Object.defineProperty(Re.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Re.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Re.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Re.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),Re.prototype.join=function(se){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(pe).join(se)},Re.prototype.multiply=function(se){var Ge=se.sx*this.sx+se.shy*this.shx,Rt=se.sx*this.shy+se.shy*this.sy,Yt=se.shx*this.sx+se.sy*this.shx,dn=se.shx*this.shy+se.sy*this.sy,kn=se.tx*this.sx+se.ty*this.shx+this.tx,rr=se.tx*this.shy+se.ty*this.sy+this.ty;return new Re(Ge,Rt,Yt,dn,kn,rr)},Re.prototype.decompose=function(){var se=this.sx,Ge=this.shy,Rt=this.shx,Yt=this.sy,dn=this.tx,kn=this.ty,rr=Math.sqrt(se*se+Ge*Ge),wr=(se/=rr)*Rt+(Ge/=rr)*Yt;Rt-=se*wr,Yt-=Ge*wr;var Wr=Math.sqrt(Rt*Rt+Yt*Yt);return wr/=Wr,se*(Yt/=Wr)<Ge*(Rt/=Wr)&&(se=-se,Ge=-Ge,wr=-wr,rr=-rr),{scale:new Re(rr,0,0,Wr,0,0),translate:new Re(1,0,0,1,dn,kn),rotate:new Re(se,Ge,-Ge,se,0,0),skew:new Re(1,0,wr,1,0,0)}},Re.prototype.toString=function(se){return this.join(" ")},Re.prototype.inversed=function(){var se=this.sx,Ge=this.shy,Rt=this.shx,Yt=this.sy,dn=this.tx,kn=this.ty,rr=1/(se*Yt-Ge*Rt),wr=Yt*rr,Wr=-Ge*rr,Ai=-Rt*rr,Pi=se*rr;return new Re(wr,Wr,Ai,Pi,-wr*dn-Ai*kn,-Wr*dn-Pi*kn)},Re.prototype.applyToPoint=function(se){var Ge=se.x*this.sx+se.y*this.shx+this.tx,Rt=se.x*this.shy+se.y*this.sy+this.ty;return new hc(Ge,Rt)},Re.prototype.applyToRectangle=function(se){var Ge=this.applyToPoint(se),Rt=this.applyToPoint(new hc(se.x+se.w,se.y+se.h));return new fc(Ge.x,Ge.y,Rt.x-Ge.x,Rt.y-Ge.y)},Re.prototype.clone=function(){var se=this.sx,Ge=this.shy,Rt=this.shx,Yt=this.sy,dn=this.tx,kn=this.ty;return new Re(se,Ge,Rt,Yt,dn,kn)},j.Matrix=Re;var tt=j.matrixMult=function(se,Ge){return Ge.multiply(se)},gt=new Re(1,0,0,1,0,0);j.unitMatrix=j.identityMatrix=gt;var ft=function(se,Ge){if(!ys[se]){var Rt=(Ge instanceof L_?"Sh":"P")+(Object.keys(Pr).length+1).toString(10);Ge.id=Rt,ys[se]=Rt,Pr[Rt]=Ge,la.publish("addPattern",Ge)}};j.ShadingPattern=L_,j.TilingPattern=C0,j.addShadingPattern=function(se,Ge){return be("addShadingPattern()"),ft(se,Ge),this},j.beginTilingPattern=function(se){be("beginTilingPattern()"),$l(se.boundingBox[0],se.boundingBox[1],se.boundingBox[2]-se.boundingBox[0],se.boundingBox[3]-se.boundingBox[1],se.matrix)},j.endTilingPattern=function(se,Ge){be("endTilingPattern()"),Ge.stream=on[Le].join(`
`),ft(se,Ge),la.publish("endTilingPattern",Ge),Ee.pop().restore()};var Tt=j.__private__.newObject=function(){var se=Ft();return Ct(se,!0),se},Ft=j.__private__.newObjectDeferred=function(){return vt++,Nt[vt]=function(){return yt},vt},Ct=function(se,Ge){return Ge=typeof Ge=="boolean"&&Ge,Nt[se]=yt,Ge&&At(se+" 0 obj"),se},Ht=j.__private__.newAdditionalObject=function(){var se={objId:Ft(),content:""};return _e.push(se),se},Gt=Ft(),$t=Ft(),Sn=j.__private__.decodeColorString=function(se){var Ge=se.split(" ");if(Ge.length!==2||Ge[1]!=="g"&&Ge[1]!=="G")Ge.length===5&&(Ge[4]==="k"||Ge[4]==="K")&&(Ge=[(1-Ge[0])*(1-Ge[3]),(1-Ge[1])*(1-Ge[3]),(1-Ge[2])*(1-Ge[3]),"r"]);else{var Rt=parseFloat(Ge[0]);Ge=[Rt,Rt,Rt,"r"]}for(var Yt="#",dn=0;dn<3;dn++)Yt+=("0"+Math.floor(255*parseFloat(Ge[dn])).toString(16)).slice(-2);return Yt},Nn=j.__private__.encodeColorString=function(se){var Ge;typeof se=="string"&&(se={ch1:se});var Rt=se.ch1,Yt=se.ch2,dn=se.ch3,kn=se.ch4,rr=se.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof Rt=="string"&&Rt.charAt(0)!=="#"){var wr=new SJ(Rt);if(wr.ok)Rt=wr.toHex();else if(!/^\d*\.?\d*$/.test(Rt))throw new Error('Invalid color "'+Rt+'" passed to jsPDF.encodeColorString.')}if(typeof Rt=="string"&&/^#[0-9A-Fa-f]{3}$/.test(Rt)&&(Rt="#"+Rt[1]+Rt[1]+Rt[2]+Rt[2]+Rt[3]+Rt[3]),typeof Rt=="string"&&/^#[0-9A-Fa-f]{6}$/.test(Rt)){var Wr=parseInt(Rt.substr(1),16);Rt=Wr>>16&255,Yt=Wr>>8&255,dn=255&Wr}if(Yt===void 0||kn===void 0&&Rt===Yt&&Yt===dn)if(typeof Rt=="string")Ge=Rt+" "+rr[0];else switch(se.precision){case 2:Ge=Oe(Rt/255)+" "+rr[0];break;case 3:default:Ge=ue(Rt/255)+" "+rr[0]}else if(kn===void 0||ks(kn)==="object"){if(kn&&!isNaN(kn.a)&&kn.a===0)return Ge=["1.","1.","1.",rr[1]].join(" ");if(typeof Rt=="string")Ge=[Rt,Yt,dn,rr[1]].join(" ");else switch(se.precision){case 2:Ge=[Oe(Rt/255),Oe(Yt/255),Oe(dn/255),rr[1]].join(" ");break;default:case 3:Ge=[ue(Rt/255),ue(Yt/255),ue(dn/255),rr[1]].join(" ")}}else if(typeof Rt=="string")Ge=[Rt,Yt,dn,kn,rr[2]].join(" ");else switch(se.precision){case 2:Ge=[Oe(Rt),Oe(Yt),Oe(dn),Oe(kn),rr[2]].join(" ");break;case 3:default:Ge=[ue(Rt),ue(Yt),ue(dn),ue(kn),rr[2]].join(" ")}return Ge},qn=j.__private__.getFilters=function(){return f},vr=j.__private__.putStream=function(se){var Ge=(se=se||{}).data||"",Rt=se.filters||qn(),Yt=se.alreadyAppliedFilters||[],dn=se.addLength1||!1,kn=Ge.length,rr=se.objectId,wr=function(Ja){return Ja};if(I!==null&&rr===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");I!==null&&(wr=oo.encryptor(rr,0));var Wr={};Rt===!0&&(Rt=["FlateEncode"]);var Ai=se.additionalKeyValues||[],Pi=(Wr=Ui.API.processDataByFilters!==void 0?Ui.API.processDataByFilters(Ge,Rt):{data:Ge,reverseChain:[]}).reverseChain+(Array.isArray(Yt)?Yt.join(" "):Yt.toString());if(Wr.data.length!==0&&(Ai.push({key:"Length",value:Wr.data.length}),dn===!0&&Ai.push({key:"Length1",value:kn})),Pi.length!=0)if(Pi.split("/").length-1==1)Ai.push({key:"Filter",value:Pi});else{Ai.push({key:"Filter",value:"["+Pi+"]"});for(var pa=0;pa<Ai.length;pa+=1)if(Ai[pa].key==="DecodeParms"){for(var Ss=[],As=0;As<Wr.reverseChain.split("/").length-1;As+=1)Ss.push("null");Ss.push(Ai[pa].value),Ai[pa].value="["+Ss.join(" ")+"]"}}At("<<");for(var Xs=0;Xs<Ai.length;Xs++)At("/"+Ai[Xs].key+" "+Ai[Xs].value);At(">>"),Wr.data.length!==0&&(At("stream"),At(wr(Wr.data)),At("endstream"))},Or=j.__private__.putPage=function(se){var Ge=se.number,Rt=se.data,Yt=se.objId,dn=se.contentsObjId;Ct(Yt,!0),At("<</Type /Page"),At("/Parent "+se.rootDictionaryObjId+" 0 R"),At("/Resources "+se.resourceDictionaryObjId+" 0 R"),At("/MediaBox ["+parseFloat(pe(se.mediaBox.bottomLeftX))+" "+parseFloat(pe(se.mediaBox.bottomLeftY))+" "+pe(se.mediaBox.topRightX)+" "+pe(se.mediaBox.topRightY)+"]"),se.cropBox!==null&&At("/CropBox ["+pe(se.cropBox.bottomLeftX)+" "+pe(se.cropBox.bottomLeftY)+" "+pe(se.cropBox.topRightX)+" "+pe(se.cropBox.topRightY)+"]"),se.bleedBox!==null&&At("/BleedBox ["+pe(se.bleedBox.bottomLeftX)+" "+pe(se.bleedBox.bottomLeftY)+" "+pe(se.bleedBox.topRightX)+" "+pe(se.bleedBox.topRightY)+"]"),se.trimBox!==null&&At("/TrimBox ["+pe(se.trimBox.bottomLeftX)+" "+pe(se.trimBox.bottomLeftY)+" "+pe(se.trimBox.topRightX)+" "+pe(se.trimBox.topRightY)+"]"),se.artBox!==null&&At("/ArtBox ["+pe(se.artBox.bottomLeftX)+" "+pe(se.artBox.bottomLeftY)+" "+pe(se.artBox.topRightX)+" "+pe(se.artBox.topRightY)+"]"),typeof se.userUnit=="number"&&se.userUnit!==1&&At("/UserUnit "+se.userUnit),la.publish("putPage",{objId:Yt,pageContext:fi[Ge],pageNumber:Ge,page:Rt}),At("/Contents "+dn+" 0 R"),At(">>"),At("endobj");var kn=Rt.join(`
`);return he===ie.ADVANCED&&(kn+=`
Q`),Ct(dn,!0),vr({data:kn,filters:qn(),objectId:dn}),At("endobj"),Yt},Rr=j.__private__.putPages=function(){var se,Ge,Rt=[];for(se=1;se<=Ia;se++)fi[se].objId=Ft(),fi[se].contentsObjId=Ft();for(se=1;se<=Ia;se++)Rt.push(Or({number:se,data:on[se],objId:fi[se].objId,contentsObjId:fi[se].contentsObjId,mediaBox:fi[se].mediaBox,cropBox:fi[se].cropBox,bleedBox:fi[se].bleedBox,trimBox:fi[se].trimBox,artBox:fi[se].artBox,userUnit:fi[se].userUnit,rootDictionaryObjId:Gt,resourceDictionaryObjId:$t}));Ct(Gt,!0),At("<</Type /Pages");var Yt="/Kids [";for(Ge=0;Ge<Ia;Ge++)Yt+=Rt[Ge]+" 0 R ";At(Yt+"]"),At("/Count "+Ia),At(">>"),At("endobj"),la.publish("postPutPages")},qr=function(se){la.publish("putFont",{font:se,out:At,newObject:Tt,putStream:vr}),se.isAlreadyPutted!==!0&&(se.objectNumber=Tt(),At("<<"),At("/Type /Font"),At("/BaseFont /"+_0(se.postScriptName)),At("/Subtype /Type1"),typeof se.encoding=="string"&&At("/Encoding /"+se.encoding),At("/FirstChar 32"),At("/LastChar 255"),At(">>"),At("endobj"))},Ri=function(){for(var se in ki)ki.hasOwnProperty(se)&&(R===!1||R===!0&&F.hasOwnProperty(se))&&qr(ki[se])},Xi=function(se){se.objectNumber=Tt();var Ge=[];Ge.push({key:"Type",value:"/XObject"}),Ge.push({key:"Subtype",value:"/Form"}),Ge.push({key:"BBox",value:"["+[pe(se.x),pe(se.y),pe(se.x+se.width),pe(se.y+se.height)].join(" ")+"]"}),Ge.push({key:"Matrix",value:"["+se.matrix.toString()+"]"});var Rt=se.pages[1].join(`
`);vr({data:Rt,additionalKeyValues:Ge,objectId:se.objectNumber}),At("endobj")},Hr=function(){for(var se in zs)zs.hasOwnProperty(se)&&Xi(zs[se])},gi=function(se,Ge){var Rt,Yt=[],dn=1/(Ge-1);for(Rt=0;Rt<1;Rt+=dn)Yt.push(Rt);if(Yt.push(1),se[0].offset!=0){var kn={offset:0,color:se[0].color};se.unshift(kn)}if(se[se.length-1].offset!=1){var rr={offset:1,color:se[se.length-1].color};se.push(rr)}for(var wr="",Wr=0,Ai=0;Ai<Yt.length;Ai++){for(Rt=Yt[Ai];Rt>se[Wr+1].offset;)Wr++;var Pi=se[Wr].offset,pa=(Rt-Pi)/(se[Wr+1].offset-Pi),Ss=se[Wr].color,As=se[Wr+1].color;wr+=ct(Math.round((1-pa)*Ss[0]+pa*As[0]).toString(16))+ct(Math.round((1-pa)*Ss[1]+pa*As[1]).toString(16))+ct(Math.round((1-pa)*Ss[2]+pa*As[2]).toString(16))}return wr.trim()},Gr=function(se,Ge){Ge||(Ge=21);var Rt=Tt(),Yt=gi(se.colors,Ge),dn=[];dn.push({key:"FunctionType",value:"0"}),dn.push({key:"Domain",value:"[0.0 1.0]"}),dn.push({key:"Size",value:"["+Ge+"]"}),dn.push({key:"BitsPerSample",value:"8"}),dn.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),dn.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),vr({data:Yt,additionalKeyValues:dn,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:Rt}),At("endobj"),se.objectNumber=Tt(),At("<< /ShadingType "+se.type),At("/ColorSpace /DeviceRGB");var kn="/Coords ["+pe(parseFloat(se.coords[0]))+" "+pe(parseFloat(se.coords[1]))+" ";se.type===2?kn+=pe(parseFloat(se.coords[2]))+" "+pe(parseFloat(se.coords[3])):kn+=pe(parseFloat(se.coords[2]))+" "+pe(parseFloat(se.coords[3]))+" "+pe(parseFloat(se.coords[4]))+" "+pe(parseFloat(se.coords[5])),At(kn+="]"),se.matrix&&At("/Matrix ["+se.matrix.toString()+"]"),At("/Function "+Rt+" 0 R"),At("/Extend [true true]"),At(">>"),At("endobj")},Ni=function(se,Ge){var Rt=Ft(),Yt=Tt();Ge.push({resourcesOid:Rt,objectOid:Yt}),se.objectNumber=Yt;var dn=[];dn.push({key:"Type",value:"/Pattern"}),dn.push({key:"PatternType",value:"1"}),dn.push({key:"PaintType",value:"1"}),dn.push({key:"TilingType",value:"1"}),dn.push({key:"BBox",value:"["+se.boundingBox.map(pe).join(" ")+"]"}),dn.push({key:"XStep",value:pe(se.xStep)}),dn.push({key:"YStep",value:pe(se.yStep)}),dn.push({key:"Resources",value:Rt+" 0 R"}),se.matrix&&dn.push({key:"Matrix",value:"["+se.matrix.toString()+"]"}),vr({data:se.stream,additionalKeyValues:dn,objectId:se.objectNumber}),At("endobj")},Pa=function(se){var Ge;for(Ge in Pr)Pr.hasOwnProperty(Ge)&&(Pr[Ge]instanceof L_?Gr(Pr[Ge]):Pr[Ge]instanceof C0&&Ni(Pr[Ge],se))},Ua=function(se){for(var Ge in se.objectNumber=Tt(),At("<<"),se)switch(Ge){case"opacity":At("/ca "+Oe(se[Ge]));break;case"stroke-opacity":At("/CA "+Oe(se[Ge]))}At(">>"),At("endobj")},_s=function(){var se;for(se in Fa)Fa.hasOwnProperty(se)&&Ua(Fa[se])},vs=function(){for(var se in At("/XObject <<"),zs)zs.hasOwnProperty(se)&&zs[se].objectNumber>=0&&At("/"+se+" "+zs[se].objectNumber+" 0 R");la.publish("putXobjectDict"),At(">>")},Ro=function(){oo.oid=Tt(),At("<<"),At("/Filter /Standard"),At("/V "+oo.v),At("/R "+oo.r),At("/U <"+oo.toHexString(oo.U)+">"),At("/O <"+oo.toHexString(oo.O)+">"),At("/P "+oo.P),At(">>"),At("endobj")},bs=function(){for(var se in At("/Font <<"),ki)ki.hasOwnProperty(se)&&(R===!1||R===!0&&F.hasOwnProperty(se))&&At("/"+se+" "+ki[se].objectNumber+" 0 R");At(">>")},Bs=function(){if(Object.keys(Pr).length>0){for(var se in At("/Shading <<"),Pr)Pr.hasOwnProperty(se)&&Pr[se]instanceof L_&&Pr[se].objectNumber>=0&&At("/"+se+" "+Pr[se].objectNumber+" 0 R");la.publish("putShadingPatternDict"),At(">>")}},iu=function(se){if(Object.keys(Pr).length>0){for(var Ge in At("/Pattern <<"),Pr)Pr.hasOwnProperty(Ge)&&Pr[Ge]instanceof j.TilingPattern&&Pr[Ge].objectNumber>=0&&Pr[Ge].objectNumber<se&&At("/"+Ge+" "+Pr[Ge].objectNumber+" 0 R");la.publish("putTilingPatternDict"),At(">>")}},Wo=function(){if(Object.keys(Fa).length>0){var se;for(se in At("/ExtGState <<"),Fa)Fa.hasOwnProperty(se)&&Fa[se].objectNumber>=0&&At("/"+se+" "+Fa[se].objectNumber+" 0 R");la.publish("putGStateDict"),At(">>")}},Oa=function(se){Ct(se.resourcesOid,!0),At("<<"),At("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),bs(),Bs(),iu(se.objectOid),Wo(),vs(),At(">>"),At("endobj")},Fl=function(){var se=[];Ri(),_s(),Hr(),Pa(se),la.publish("putResources"),se.forEach(Oa),Oa({resourcesOid:$t,objectOid:Number.MAX_SAFE_INTEGER}),la.publish("postPutResources")},Do=function(){la.publish("putAdditionalObjects");for(var se=0;se<_e.length;se++){var Ge=_e[se];Ct(Ge.objId,!0),At(Ge.content),At("endobj")}la.publish("postPutAdditionalObjects")},gh=function(se){mi[se.fontName]=mi[se.fontName]||{},mi[se.fontName][se.fontStyle]=se.id},Pu=function(se,Ge,Rt,Yt,dn){var kn={id:"F"+(Object.keys(ki).length+1).toString(10),postScriptName:se,fontName:Ge,fontStyle:Rt,encoding:Yt,isStandardFont:dn||!1,metadata:{}};return la.publish("addFont",{font:kn,instance:this}),ki[kn.id]=kn,gh(kn),kn.id},Jh=function(se){for(var Ge=0,Rt=Dn.length;Ge<Rt;Ge++){var Yt=Pu.call(this,se[Ge][0],se[Ge][1],se[Ge][2],Dn[Ge][3],!0);R===!1&&(F[Yt]=!0);var dn=se[Ge][0].split("-");gh({id:Yt,fontName:dn[0],fontStyle:dn[1]||""})}la.publish("addFonts",{fonts:ki,dictionary:mi})},lc=function(se){return se.foo=function(){try{return se.apply(this,arguments)}catch(Yt){var Ge=Yt.stack||"";~Ge.indexOf(" at ")&&(Ge=Ge.split(" at ")[1]);var Rt="Error in function "+Ge.split(`
`)[0].split("<")[0]+": "+Yt.message;if(!Wi.console)throw new Error(Rt);Wi.console.error(Rt,Yt),Wi.alert&&alert(Rt)}},se.foo.bar=se,se.foo},Ou=function(se,Ge){var Rt,Yt,dn,kn,rr,wr,Wr,Ai,Pi;if(dn=(Ge=Ge||{}).sourceEncoding||"Unicode",rr=Ge.outputEncoding,(Ge.autoencode||rr)&&ki[Xn].metadata&&ki[Xn].metadata[dn]&&ki[Xn].metadata[dn].encoding&&(kn=ki[Xn].metadata[dn].encoding,!rr&&ki[Xn].encoding&&(rr=ki[Xn].encoding),!rr&&kn.codePages&&(rr=kn.codePages[0]),typeof rr=="string"&&(rr=kn[rr]),rr)){for(Wr=!1,wr=[],Rt=0,Yt=se.length;Rt<Yt;Rt++)(Ai=rr[se.charCodeAt(Rt)])?wr.push(String.fromCharCode(Ai)):wr.push(se[Rt]),wr[Rt].charCodeAt(0)>>8&&(Wr=!0);se=wr.join("")}for(Rt=se.length;Wr===void 0&&Rt!==0;)se.charCodeAt(Rt-1)>>8&&(Wr=!0),Rt--;if(!Wr)return se;for(wr=Ge.noBOM?[]:[254,255],Rt=0,Yt=se.length;Rt<Yt;Rt++){if((Pi=(Ai=se.charCodeAt(Rt))>>8)>>8)throw new Error("Character at position "+Rt+" of string '"+se+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");wr.push(Pi),wr.push(Ai-(Pi<<8))}return String.fromCharCode.apply(void 0,wr)},cl=j.__private__.pdfEscape=j.pdfEscape=function(se,Ge){return Ou(se,Ge).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Ys=j.__private__.beginPage=function(se){on[++Ia]=[],fi[Ia]={objId:0,contentsObjId:0,userUnit:Number(i),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(se[0]),topRightY:Number(se[1])}},cc(Ia),cn(on[Le])},Lo=function(se,Ge){var Rt,Yt,dn;switch(n=Ge||n,typeof se=="string"&&(Rt=J(se.toLowerCase()),Array.isArray(Rt)&&(Yt=Rt[0],dn=Rt[1])),Array.isArray(se)&&(Yt=se[0]*hn,dn=se[1]*hn),isNaN(Yt)&&(Yt=s[0],dn=s[1]),(Yt>14400||dn>14400)&&(ro.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),Yt=Math.min(14400,Yt),dn=Math.min(14400,dn)),s=[Yt,dn],n.substr(0,1)){case"l":dn>Yt&&(s=[dn,Yt]);break;case"p":Yt>dn&&(s=[dn,Yt])}Ys(s),vh(Ta),At(wl),Pf!==0&&At(Pf+" J"),Bo!==0&&At(Bo+" j"),la.publish("addPage",{pageNumber:Ia})},Ul=function(se){se>0&&se<=Ia&&(on.splice(se,1),fi.splice(se,1),Ia--,Le>Ia&&(Le=Ia),this.setPage(Le))},cc=function(se){se>0&&se<=Ia&&(Le=se)},so=j.__private__.getNumberOfPages=j.getNumberOfPages=function(){return on.length-1},ko=function(se,Ge,Rt){var Yt,dn=void 0;return Rt=Rt||{},se=se!==void 0?se:ki[Xn].fontName,Ge=Ge!==void 0?Ge:ki[Xn].fontStyle,Yt=se.toLowerCase(),mi[Yt]!==void 0&&mi[Yt][Ge]!==void 0?dn=mi[Yt][Ge]:mi[se]!==void 0&&mi[se][Ge]!==void 0?dn=mi[se][Ge]:Rt.disableWarning===!1&&ro.warn("Unable to look up font label for font '"+se+"', '"+Ge+"'. Refer to getFontList() for available fonts."),dn||Rt.noFallback||(dn=mi.times[Ge])==null&&(dn=mi.times.normal),dn},yh=j.__private__.putInfo=function(){var se=Tt(),Ge=function(Yt){return Yt};for(var Rt in I!==null&&(Ge=oo.encryptor(se,0)),At("<<"),At("/Producer ("+cl(Ge("jsPDF "+Ui.version))+")"),xn)xn.hasOwnProperty(Rt)&&xn[Rt]&&At("/"+Rt.substr(0,1).toUpperCase()+Rt.substr(1)+" ("+cl(Ge(xn[Rt]))+")");At("/CreationDate ("+cl(Ge(je))+")"),At(">>"),At("endobj")},Bc=j.__private__.putCatalog=function(se){var Ge=(se=se||{}).rootDictionaryObjId||Gt;switch(Tt(),At("<<"),At("/Type /Catalog"),At("/Pages "+Ge+" 0 R"),hr||(hr="fullwidth"),hr){case"fullwidth":At("/OpenAction [3 0 R /FitH null]");break;case"fullheight":At("/OpenAction [3 0 R /FitV null]");break;case"fullpage":At("/OpenAction [3 0 R /Fit]");break;case"original":At("/OpenAction [3 0 R /XYZ null null 1]");break;default:var Rt=""+hr;Rt.substr(Rt.length-1)==="%"&&(hr=parseInt(hr)/100),typeof hr=="number"&&At("/OpenAction [3 0 R /XYZ null null "+Oe(hr)+"]")}switch(pi||(pi="continuous"),pi){case"continuous":At("/PageLayout /OneColumn");break;case"single":At("/PageLayout /SinglePage");break;case"two":case"twoleft":At("/PageLayout /TwoColumnLeft");break;case"tworight":At("/PageLayout /TwoColumnRight")}Un&&At("/PageMode /"+Un),la.publish("putCatalog"),At(">>"),At("endobj")},ud=j.__private__.putTrailer=function(){At("trailer"),At("<<"),At("/Size "+(vt+1)),At("/Root "+vt+" 0 R"),At("/Info "+(vt-1)+" 0 R"),I!==null&&At("/Encrypt "+oo.oid+" 0 R"),At("/ID [ <"+ze+"> <"+ze+"> ]"),At(">>")},ql=j.__private__.putHeader=function(){At("%PDF-"+H),At("%ºß¬à")},No=j.__private__.putXRef=function(){var se="0000000000";At("xref"),At("0 "+(vt+1)),At("0000000000 65535 f ");for(var Ge=1;Ge<=vt;Ge++)typeof Nt[Ge]=="function"?At((se+Nt[Ge]()).slice(-10)+" 00000 n "):Nt[Ge]!==void 0?At((se+Nt[Ge]).slice(-10)+" 00000 n "):At("0000000000 00000 n ")},jc=j.__private__.buildDocument=function(){Ut(),cn(mt),la.publish("buildDocument"),ql(),Rr(),Do(),Fl(),I!==null&&Ro(),yh(),Bc();var se=yt;return No(),ud(),At("startxref"),At(""+se),At("%%EOF"),cn(on[Le]),mt.join(`
`)},Qh=j.__private__.getBlob=function(se){return new Blob([Rn(se)],{type:"application/pdf"})},Ko=j.output=j.__private__.output=lc(function(se,Ge){switch(typeof(Ge=Ge||{})=="string"?Ge={filename:Ge}:Ge.filename=Ge.filename||"generated.pdf",se){case void 0:return jc();case"save":j.save(Ge.filename);break;case"arraybuffer":return Rn(jc());case"blob":return Qh(jc());case"bloburi":case"bloburl":if(Wi.URL!==void 0&&typeof Wi.URL.createObjectURL=="function")return Wi.URL&&Wi.URL.createObjectURL(Qh(jc()))||void 0;ro.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var Rt="",Yt=jc();try{Rt=OD(Yt)}catch{Rt=OD(unescape(encodeURIComponent(Yt)))}return"data:application/pdf;filename="+Ge.filename+";base64,"+Rt;case"pdfobjectnewwindow":if(Object.prototype.toString.call(Wi)==="[object Window]"){var dn="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",kn=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';Ge.pdfObjectUrl&&(dn=Ge.pdfObjectUrl,kn="");var rr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+dn+'"'+kn+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(Ge)+");<\/script></body></html>",wr=Wi.open();return wr!==null&&wr.document.write(rr),wr}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(Wi)==="[object Window]"){var Wr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(Ge.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+Ge.filename+'" width="500px" height="400px" /></body></html>',Ai=Wi.open();if(Ai!==null){Ai.document.write(Wr);var Pi=this;Ai.document.documentElement.querySelector("#pdfViewer").onload=function(){Ai.document.title=Ge.filename,Ai.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(Pi.output("bloburl"))}}return Ai}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(Wi)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var pa='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",Ge)+'"></iframe></body></html>',Ss=Wi.open();if(Ss!==null&&(Ss.document.write(pa),Ss.document.title=Ge.filename),Ss||typeof safari>"u")return Ss;break;case"datauri":case"dataurl":return Wi.document.location.href=this.output("datauristring",Ge);default:return null}}),Ei=function(se){return Array.isArray(Iu)===!0&&Iu.indexOf(se)>-1};switch(r){case"pt":hn=1;break;case"mm":hn=72/25.4;break;case"cm":hn=72/2.54;break;case"in":hn=72;break;case"px":hn=Ei("px_scaling")==1?.75:96/72;break;case"pc":case"em":hn=12;break;case"ex":hn=6;break;default:if(typeof r!="number")throw new Error("Invalid unit: "+r);hn=r}var oo=null;bt(),Fe();var dr=function(se){return I!==null?oo.encryptor(se,0):function(Ge){return Ge}},Ru=j.__private__.getPageInfo=j.getPageInfo=function(se){if(isNaN(se)||se%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:fi[se].objId,pageNumber:se,pageContext:fi[se]}},yi=j.__private__.getPageInfoByObjId=function(se){if(isNaN(se)||se%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var Ge in fi)if(fi[Ge].objId===se)break;return Ru(Ge)},ef=j.__private__.getCurrentPageInfo=j.getCurrentPageInfo=function(){return{objId:fi[Le].objId,pageNumber:Le,pageContext:fi[Le]}};j.addPage=function(){return Lo.apply(this,arguments),this},j.setPage=function(){return cc.apply(this,arguments),cn.call(this,on[Le]),this},j.insertPage=function(se){return this.addPage(),this.movePage(Le,se),this},j.movePage=function(se,Ge){var Rt,Yt;if(se>Ge){Rt=on[se],Yt=fi[se];for(var dn=se;dn>Ge;dn--)on[dn]=on[dn-1],fi[dn]=fi[dn-1];on[Ge]=Rt,fi[Ge]=Yt,this.setPage(Ge)}else if(se<Ge){Rt=on[se],Yt=fi[se];for(var kn=se;kn<Ge;kn++)on[kn]=on[kn+1],fi[kn]=fi[kn+1];on[Ge]=Rt,fi[Ge]=Yt,this.setPage(Ge)}return this},j.deletePage=function(){return Ul.apply(this,arguments),this},j.__private__.text=j.text=function(se,Ge,Rt,Yt,dn){var kn,rr,wr,Wr,Ai,Pi,pa,Ss,As,Xs=(Yt=Yt||{}).scope||this;if(typeof se=="number"&&typeof Ge=="number"&&(typeof Rt=="string"||Array.isArray(Rt))){var Ja=Rt;Rt=Ge,Ge=se,se=Ja}if(arguments[3]instanceof Re?(be("The transform parameter of text() with a Matrix value"),As=dn):(wr=arguments[4],Wr=arguments[5],ks(pa=arguments[3])==="object"&&pa!==null||(typeof wr=="string"&&(Wr=wr,wr=null),typeof pa=="string"&&(Wr=pa,pa=null),typeof pa=="number"&&(wr=pa,pa=null),Yt={flags:pa,angle:wr,align:Wr})),isNaN(Ge)||isNaN(Rt)||se==null)throw new Error("Invalid arguments passed to jsPDF.text");if(se.length===0)return Xs;var Mr="",sr=!1,ul=typeof Yt.lineHeightFactor=="number"?Yt.lineHeightFactor:za,Sr=Xs.internal.scaleFactor;function dc(Yi){return Yi=Yi.split("	").join(Array(Yt.TabLen||9).join(" ")),cl(Yi,pa)}function Gl(Yi){for(var ea,$a=Yi.concat(),rs=[],Yl=$a.length;Yl--;)typeof(ea=$a.shift())=="string"?rs.push(ea):Array.isArray(Yi)&&(ea.length===1||ea[1]===void 0&&ea[2]===void 0)?rs.push(ea[0]):rs.push([ea[0],ea[1],ea[2]]);return rs}function br(Yi,ea){var $a;if(typeof Yi=="string")$a=ea(Yi)[0];else if(Array.isArray(Yi)){for(var rs,Yl,Bu=Yi.concat(),Zo=[],Xl=Bu.length;Xl--;)typeof(rs=Bu.shift())=="string"?Zo.push(ea(rs)[0]):Array.isArray(rs)&&typeof rs[0]=="string"&&(Yl=ea(rs[0],rs[1],rs[2]),Zo.push([Yl[0],Yl[1],Yl[2]]));$a=Zo}return $a}var nf=!1,Wl=!0;if(typeof se=="string")nf=!0;else if(Array.isArray(se)){var cu=se.concat();rr=[];for(var wh,Ts=cu.length;Ts--;)(typeof(wh=cu.shift())!="string"||Array.isArray(wh)&&typeof wh[0]!="string")&&(Wl=!1);nf=Wl}if(nf===!1)throw new Error('Type of text must be string or Array. "'+se+'" is not recognized.');typeof se=="string"&&(se=se.match(/[\r?\n]/)?se.split(/\r\n|\r|\n/g):[se]);var ya=ar/Xs.internal.scaleFactor,uu=ya*(ul-1);switch(Yt.baseline){case"bottom":Rt-=uu;break;case"top":Rt+=ya-uu;break;case"hanging":Rt+=ya-2*uu;break;case"middle":Rt+=ya/2-uu}if((Pi=Yt.maxWidth||0)>0&&(typeof se=="string"?se=Xs.splitTextToSize(se,Pi):Object.prototype.toString.call(se)==="[object Array]"&&(se=se.reduce(function(Yi,ea){return Yi.concat(Xs.splitTextToSize(ea,Pi))},[]))),kn={text:se,x:Ge,y:Rt,options:Yt,mutex:{pdfEscape:cl,activeFontKey:Xn,fonts:ki,activeFontSize:ar}},la.publish("preProcessText",kn),se=kn.text,wr=(Yt=kn.options).angle,!(As instanceof Re)&&wr&&typeof wr=="number"){wr*=Math.PI/180,Yt.rotationDirection===0&&(wr=-wr),he===ie.ADVANCED&&(wr=-wr);var On=Math.cos(wr),Sh=Math.sin(wr);As=new Re(On,Sh,-Sh,On,0,0)}else wr&&wr instanceof Re&&(As=wr);he!==ie.ADVANCED||As||(As=gt),(Ai=Yt.charSpace||Vl)!==void 0&&(Mr+=pe(we(Ai))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(Ss=Yt.horizontalScale)!==void 0&&(Mr+=pe(100*Ss)+` Tz
`),Yt.lang;var Vs=-1,co=Yt.renderingMode!==void 0?Yt.renderingMode:Yt.stroke,dd=Xs.internal.getCurrentPageInfo().pageContext;switch(co){case 0:case!1:case"fill":Vs=0;break;case 1:case!0:case"stroke":Vs=1;break;case 2:case"fillThenStroke":Vs=2;break;case 3:case"invisible":Vs=3;break;case 4:case"fillAndAddForClipping":Vs=4;break;case 5:case"strokeAndAddPathForClipping":Vs=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":Vs=6;break;case 7:case"addToPathForClipping":Vs=7}var Of=dd.usedRenderingMode!==void 0?dd.usedRenderingMode:-1;Vs!==-1?Mr+=Vs+` Tr
`:Of!==-1&&(Mr+=`0 Tr
`),Vs!==-1&&(dd.usedRenderingMode=Vs),Wr=Yt.align||"left";var uo,Rs=ar*ul,Sl=Xs.internal.pageSize.getWidth(),Du=ki[Xn];Ai=Yt.charSpace||Vl,Pi=Yt.maxWidth||0,pa=Object.assign({autoencode:!0,noBOM:!0},Yt.flags);var Kl=[],rf=function(Yi){return Xs.getStringUnitWidth(Yi,{font:Du,charSpace:Ai,fontSize:ar,doKerning:!1})*ar/Sr};if(Object.prototype.toString.call(se)==="[object Array]"){var Al;rr=Gl(se),Wr!=="left"&&(uo=rr.map(rf));var xo,Ah=0;if(Wr==="right"){Ge-=uo[0],se=[],Ts=rr.length;for(var Lu=0;Lu<Ts;Lu++)Lu===0?(xo=Yo(Ge),Al=os(Rt)):(xo=we(Ah-uo[Lu]),Al=-Rs),se.push([rr[Lu],xo,Al]),Ah=uo[Lu]}else if(Wr==="center"){Ge-=uo[0]/2,se=[],Ts=rr.length;for(var Tl=0;Tl<Ts;Tl++)Tl===0?(xo=Yo(Ge),Al=os(Rt)):(xo=we((Ah-uo[Tl])/2),Al=-Rs),se.push([rr[Tl],xo,Al]),Ah=uo[Tl]}else if(Wr==="left"){se=[],Ts=rr.length;for(var hu=0;hu<Ts;hu++)se.push(rr[hu])}else if(Wr==="justify"&&Du.encoding==="Identity-H"){se=[],Ts=rr.length,Pi=Pi!==0?Pi:Sl;for(var pc=0,Va=0;Va<Ts;Va++)if(Al=Va===0?os(Rt):-Rs,xo=Va===0?Yo(Ge):pc,Va<Ts-1){var pd=we((Pi-uo[Va])/(rr[Va].split(" ").length-1)),Zs=rr[Va].split(" ");se.push([Zs[0]+" ",xo,Al]),pc=0;for(var ho=1;ho<Zs.length;ho++){var Th=(rf(Zs[ho-1]+" "+Zs[ho])-rf(Zs[ho]))*Sr+pd;ho==Zs.length-1?se.push([Zs[ho],Th,0]):se.push([Zs[ho]+" ",Th,0]),pc-=Th}}else se.push([rr[Va],xo,Al]);se.push(["",pc,0])}else{if(Wr!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(se=[],Ts=rr.length,Pi=Pi!==0?Pi:Sl,Va=0;Va<Ts;Va++)Al=Va===0?os(Rt):-Rs,xo=Va===0?Yo(Ge):0,Va<Ts-1?Kl.push(pe(we((Pi-uo[Va])/(rr[Va].split(" ").length-1)))):Kl.push(0),se.push([rr[Va],xo,Al])}}var Eh=typeof Yt.R2L=="boolean"?Yt.R2L:Ir;Eh===!0&&(se=br(se,function(Yi,ea,$a){return[Yi.split("").reverse().join(""),ea,$a]})),kn={text:se,x:Ge,y:Rt,options:Yt,mutex:{pdfEscape:cl,activeFontKey:Xn,fonts:ki,activeFontSize:ar}},la.publish("postProcessText",kn),se=kn.text,sr=kn.mutex.isHex||!1;var Js=ki[Xn].encoding;Js!=="WinAnsiEncoding"&&Js!=="StandardEncoding"||(se=br(se,function(Yi,ea,$a){return[dc(Yi),ea,$a]})),rr=Gl(se),se=[];for(var ku,fu,mc,Nu=0,gc=1,zu=Array.isArray(rr[0])?gc:Nu,du="",Uc=function(Yi,ea,$a){var rs="";return $a instanceof Re?($a=typeof Yt.angle=="number"?tt($a,new Re(1,0,0,1,Yi,ea)):tt(new Re(1,0,0,1,Yi,ea),$a),he===ie.ADVANCED&&($a=tt(new Re(1,0,0,-1,0,0),$a)),rs=$a.join(" ")+` Tm
`):rs=pe(Yi)+" "+pe(ea)+` Td
`,rs},jo=0;jo<rr.length;jo++){switch(du="",zu){case gc:mc=(sr?"<":"(")+rr[jo][0]+(sr?">":")"),ku=parseFloat(rr[jo][1]),fu=parseFloat(rr[jo][2]);break;case Nu:mc=(sr?"<":"(")+rr[jo]+(sr?">":")"),ku=Yo(Ge),fu=os(Rt)}Kl!==void 0&&Kl[jo]!==void 0&&(du=Kl[jo]+` Tw
`),jo===0?se.push(du+Uc(ku,fu,As)+mc):zu===Nu?se.push(du+mc):zu===gc&&se.push(du+Uc(ku,fu,As)+mc)}se=zu===Nu?se.join(` Tj
T* `):se.join(` Tj
`),se+=` Tj
`;var ls=`BT
/`;return ls+=Xn+" "+ar+` Tf
`,ls+=pe(ar*ul)+` TL
`,ls+=qa+`
`,ls+=Mr,ls+=se,At(ls+="ET"),F[Xn]=!0,Xs};var Si=j.__private__.clip=j.clip=function(se){return At(se==="evenodd"?"W*":"W"),this};j.clipEvenOdd=function(){return Si("evenodd")},j.__private__.discardPath=j.discardPath=function(){return At("n"),this};var js=j.__private__.isValidStyle=function(se){var Ge=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(se)!==-1&&(Ge=!0),Ge};j.__private__.setDefaultPathOperation=j.setDefaultPathOperation=function(se){return js(se)&&(S=se),this};var au=j.__private__.getStyle=j.getStyle=function(se){var Ge=S;switch(se){case"D":case"S":Ge="S";break;case"F":Ge="f";break;case"FD":case"DF":Ge="B";break;case"f":case"f*":case"B":case"B*":Ge=se}return Ge},su=j.close=function(){return At("h"),this};j.stroke=function(){return At("S"),this},j.fill=function(se){return Jn("f",se),this},j.fillEvenOdd=function(se){return Jn("f*",se),this},j.fillStroke=function(se){return Jn("B",se),this},j.fillStrokeEvenOdd=function(se){return Jn("B*",se),this};var Jn=function(se,Ge){ks(Ge)==="object"?Fs(Ge,se):At(se)},ri=function(se){se===null||he===ie.ADVANCED&&se===void 0||(se=au(se),At(se))};function _i(se,Ge,Rt,Yt,dn){var kn=new C0(Ge||this.boundingBox,Rt||this.xStep,Yt||this.yStep,this.gState,dn||this.matrix);kn.stream=this.stream;var rr=se+"$$"+this.cloneIndex+++"$$";return ft(rr,kn),kn}var Fs=function(se,Ge){var Rt=ys[se.key],Yt=Pr[Rt];if(Yt instanceof L_)At("q"),At(_h(Ge)),Yt.gState&&j.setGState(Yt.gState),At(se.matrix.toString()+" cm"),At("/"+Rt+" sh"),At("Q");else if(Yt instanceof C0){var dn=new Re(1,0,0,-1,0,Hl());se.matrix&&(dn=dn.multiply(se.matrix||gt),Rt=_i.call(Yt,se.key,se.boundingBox,se.xStep,se.yStep,dn).id),At("q"),At("/Pattern cs"),At("/"+Rt+" scn"),Yt.gState&&j.setGState(Yt.gState),At(Ge),At("Q")}},_h=function(se){switch(se){case"f":case"F":return"W n";case"f*":return"W* n";case"B":return"W S";case"B*":return"W* S";case"S":return"W S";case"n":return"W n"}},li=j.moveTo=function(se,Ge){return At(pe(we(se))+" "+pe(De(Ge))+" m"),this},zo=j.lineTo=function(se,Ge){return At(pe(we(se))+" "+pe(De(Ge))+" l"),this},uc=j.curveTo=function(se,Ge,Rt,Yt,dn,kn){return At([pe(we(se)),pe(De(Ge)),pe(we(Rt)),pe(De(Yt)),pe(we(dn)),pe(De(kn)),"c"].join(" ")),this};j.__private__.line=j.line=function(se,Ge,Rt,Yt,dn){if(isNaN(se)||isNaN(Ge)||isNaN(Rt)||isNaN(Yt)||!js(dn))throw new Error("Invalid arguments passed to jsPDF.line");return he===ie.COMPAT?this.lines([[Rt-se,Yt-Ge]],se,Ge,[1,1],dn||"S"):this.lines([[Rt-se,Yt-Ge]],se,Ge,[1,1]).stroke()},j.__private__.lines=j.lines=function(se,Ge,Rt,Yt,dn,kn){var rr,wr,Wr,Ai,Pi,pa,Ss,As,Xs,Ja,Mr,sr;if(typeof se=="number"&&(sr=Rt,Rt=Ge,Ge=se,se=sr),Yt=Yt||[1,1],kn=kn||!1,isNaN(Ge)||isNaN(Rt)||!Array.isArray(se)||!Array.isArray(Yt)||!js(dn)||typeof kn!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(li(Ge,Rt),rr=Yt[0],wr=Yt[1],Ai=se.length,Ja=Ge,Mr=Rt,Wr=0;Wr<Ai;Wr++)(Pi=se[Wr]).length===2?(Ja=Pi[0]*rr+Ja,Mr=Pi[1]*wr+Mr,zo(Ja,Mr)):(pa=Pi[0]*rr+Ja,Ss=Pi[1]*wr+Mr,As=Pi[2]*rr+Ja,Xs=Pi[3]*wr+Mr,Ja=Pi[4]*rr+Ja,Mr=Pi[5]*wr+Mr,uc(pa,Ss,As,Xs,Ja,Mr));return kn&&su(),ri(dn),this},j.path=function(se){for(var Ge=0;Ge<se.length;Ge++){var Rt=se[Ge],Yt=Rt.c;switch(Rt.op){case"m":li(Yt[0],Yt[1]);break;case"l":zo(Yt[0],Yt[1]);break;case"c":uc.apply(this,Yt);break;case"h":su()}}return this},j.__private__.rect=j.rect=function(se,Ge,Rt,Yt,dn){if(isNaN(se)||isNaN(Ge)||isNaN(Rt)||isNaN(Yt)||!js(dn))throw new Error("Invalid arguments passed to jsPDF.rect");return he===ie.COMPAT&&(Yt=-Yt),At([pe(we(se)),pe(De(Ge)),pe(we(Rt)),pe(we(Yt)),"re"].join(" ")),ri(dn),this},j.__private__.triangle=j.triangle=function(se,Ge,Rt,Yt,dn,kn,rr){if(isNaN(se)||isNaN(Ge)||isNaN(Rt)||isNaN(Yt)||isNaN(dn)||isNaN(kn)||!js(rr))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[Rt-se,Yt-Ge],[dn-Rt,kn-Yt],[se-dn,Ge-kn]],se,Ge,[1,1],rr,!0),this},j.__private__.roundedRect=j.roundedRect=function(se,Ge,Rt,Yt,dn,kn,rr){if(isNaN(se)||isNaN(Ge)||isNaN(Rt)||isNaN(Yt)||isNaN(dn)||isNaN(kn)||!js(rr))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var wr=4/3*(Math.SQRT2-1);return dn=Math.min(dn,.5*Rt),kn=Math.min(kn,.5*Yt),this.lines([[Rt-2*dn,0],[dn*wr,0,dn,kn-kn*wr,dn,kn],[0,Yt-2*kn],[0,kn*wr,-dn*wr,kn,-dn,kn],[2*dn-Rt,0],[-dn*wr,0,-dn,-kn*wr,-dn,-kn],[0,2*kn-Yt],[0,-kn*wr,dn*wr,-kn,dn,-kn]],se+dn,Ge,[1,1],rr,!0),this},j.__private__.ellipse=j.ellipse=function(se,Ge,Rt,Yt,dn){if(isNaN(se)||isNaN(Ge)||isNaN(Rt)||isNaN(Yt)||!js(dn))throw new Error("Invalid arguments passed to jsPDF.ellipse");var kn=4/3*(Math.SQRT2-1)*Rt,rr=4/3*(Math.SQRT2-1)*Yt;return li(se+Rt,Ge),uc(se+Rt,Ge-rr,se+kn,Ge-Yt,se,Ge-Yt),uc(se-kn,Ge-Yt,se-Rt,Ge-rr,se-Rt,Ge),uc(se-Rt,Ge+rr,se-kn,Ge+Yt,se,Ge+Yt),uc(se+kn,Ge+Yt,se+Rt,Ge+rr,se+Rt,Ge),ri(dn),this},j.__private__.circle=j.circle=function(se,Ge,Rt,Yt){if(isNaN(se)||isNaN(Ge)||isNaN(Rt)||!js(Yt))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(se,Ge,Rt,Rt,Yt)},j.setFont=function(se,Ge,Rt){return Rt&&(Ge=ye(Ge,Rt)),Xn=ko(se,Ge,{disableWarning:!1}),this};var xs=j.__private__.getFont=j.getFont=function(){return ki[ko.apply(j,arguments)]};j.__private__.getFontList=j.getFontList=function(){var se,Ge,Rt={};for(se in mi)if(mi.hasOwnProperty(se))for(Ge in Rt[se]=[],mi[se])mi[se].hasOwnProperty(Ge)&&Rt[se].push(Ge);return Rt},j.addFont=function(se,Ge,Rt,Yt,dn){var kn=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&kn.indexOf(arguments[3])!==-1?dn=arguments[3]:arguments[3]&&kn.indexOf(arguments[3])==-1&&(Rt=ye(Rt,Yt)),dn=dn||"Identity-H",Pu.call(this,se,Ge,Rt,dn)};var za,Ta=t.lineWidth||.200025,lo=j.__private__.getLineWidth=j.getLineWidth=function(){return Ta},vh=j.__private__.setLineWidth=j.setLineWidth=function(se){return Ta=se,At(pe(we(se))+" w"),this};j.__private__.setLineDash=Ui.API.setLineDash=Ui.API.setLineDashPattern=function(se,Ge){if(se=se||[],Ge=Ge||0,isNaN(Ge)||!Array.isArray(se))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return se=se.map(function(Rt){return pe(we(Rt))}).join(" "),Ge=pe(we(Ge)),At("["+se+"] "+Ge+" d"),this};var tf=j.__private__.getLineHeight=j.getLineHeight=function(){return ar*za};j.__private__.getLineHeight=j.getLineHeight=function(){return ar*za};var ou=j.__private__.setLineHeightFactor=j.setLineHeightFactor=function(se){return typeof(se=se||1.15)=="number"&&(za=se),this},lu=j.__private__.getLineHeightFactor=j.getLineHeightFactor=function(){return za};ou(t.lineHeight);var Yo=j.__private__.getHorizontalCoordinate=function(se){return we(se)},os=j.__private__.getVerticalCoordinate=function(se){return he===ie.ADVANCED?se:fi[Le].mediaBox.topRightY-fi[Le].mediaBox.bottomLeftY-we(se)},Fc=j.__private__.getHorizontalCoordinateString=j.getHorizontalCoordinateString=function(se){return pe(Yo(se))},ws=j.__private__.getVerticalCoordinateString=j.getVerticalCoordinateString=function(se){return pe(os(se))},wl=t.strokeColor||"0 G";j.__private__.getStrokeColor=j.getDrawColor=function(){return Sn(wl)},j.__private__.setStrokeColor=j.setDrawColor=function(se,Ge,Rt,Yt){return wl=Nn({ch1:se,ch2:Ge,ch3:Rt,ch4:Yt,pdfColorType:"draw",precision:2}),At(wl),this};var Xo=t.fillColor||"0 g";j.__private__.getFillColor=j.getFillColor=function(){return Sn(Xo)},j.__private__.setFillColor=j.setFillColor=function(se,Ge,Rt,Yt){return Xo=Nn({ch1:se,ch2:Ge,ch3:Rt,ch4:Yt,pdfColorType:"fill",precision:2}),At(Xo),this};var qa=t.textColor||"0 g",Us=j.__private__.getTextColor=j.getTextColor=function(){return Sn(qa)};j.__private__.setTextColor=j.setTextColor=function(se,Ge,Rt,Yt){return qa=Nn({ch1:se,ch2:Ge,ch3:Rt,ch4:Yt,pdfColorType:"text",precision:3}),this};var Vl=t.charSpace,ns=j.__private__.getCharSpace=j.getCharSpace=function(){return parseFloat(Vl||0)};j.__private__.setCharSpace=j.setCharSpace=function(se){if(isNaN(se))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Vl=se,this};var Pf=0;j.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},j.__private__.setLineCap=j.setLineCap=function(se){var Ge=j.CapJoinStyles[se];if(Ge===void 0)throw new Error("Line cap style of '"+se+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Pf=Ge,At(Ge+" J"),this};var Bo=0;j.__private__.setLineJoin=j.setLineJoin=function(se){var Ge=j.CapJoinStyles[se];if(Ge===void 0)throw new Error("Line join style of '"+se+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Bo=Ge,At(Ge+" j"),this},j.__private__.setLineMiterLimit=j.__private__.setMiterLimit=j.setLineMiterLimit=j.setMiterLimit=function(se){if(se=se||0,isNaN(se))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return At(pe(we(se))+" M"),this},j.GState=p5,j.setGState=function(se){(se=typeof se=="string"?Fa[Za[se]]:bh(null,se)).equals(Oo)||(At("/"+se.id+" gs"),Oo=se)};var bh=function(se,Ge){if(!se||!Za[se]){var Rt=!1;for(var Yt in Fa)if(Fa.hasOwnProperty(Yt)&&Fa[Yt].equals(Ge)){Rt=!0;break}if(Rt)Ge=Fa[Yt];else{var dn="GS"+(Object.keys(Fa).length+1).toString(10);Fa[dn]=Ge,Ge.id=dn}return se&&(Za[se]=Ge.id),la.publish("addGState",Ge),Ge}};j.addGState=function(se,Ge){return bh(se,Ge),this},j.saveGraphicsState=function(){return At("q"),ti.push({key:Xn,size:ar,color:qa}),this},j.restoreGraphicsState=function(){At("Q");var se=ti.pop();return Xn=se.key,ar=se.size,qa=se.color,Oo=null,this},j.setCurrentTransformationMatrix=function(se){return At(se.toString()+" cm"),this},j.comment=function(se){return At("#"+se),this};var hc=function(se,Ge){var Rt=se||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return Rt},set:function(kn){isNaN(kn)||(Rt=parseFloat(kn))}});var Yt=Ge||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return Yt},set:function(kn){isNaN(kn)||(Yt=parseFloat(kn))}});var dn="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return dn},set:function(kn){dn=kn.toString()}}),this},fc=function(se,Ge,Rt,Yt){hc.call(this,se,Ge),this.type="rect";var dn=Rt||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return dn},set:function(rr){isNaN(rr)||(dn=parseFloat(rr))}});var kn=Yt||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return kn},set:function(rr){isNaN(rr)||(kn=parseFloat(rr))}}),this},Vd=function(){this.page=Ia,this.currentPage=Le,this.pages=on.slice(0),this.pagesContext=fi.slice(0),this.x=er,this.y=yr,this.matrix=Vi,this.width=qs(Le),this.height=Hl(Le),this.outputDestination=Pn,this.id="",this.objectNumber=-1};Vd.prototype.restore=function(){Ia=this.page,Le=this.currentPage,fi=this.pagesContext,on=this.pages,er=this.x,yr=this.y,Vi=this.matrix,hd(Le,this.width),fd(Le,this.height),Pn=this.outputDestination};var $l=function(se,Ge,Rt,Yt,dn){Ee.push(new Vd),Ia=Le=0,on=[],er=se,yr=Ge,Vi=dn,Ys([Rt,Yt])},Dm=function(se){if(Zt[se])Ee.pop().restore();else{var Ge=new Vd,Rt="Xo"+(Object.keys(zs).length+1).toString(10);Ge.id=Rt,Zt[se]=Rt,zs[Rt]=Ge,la.publish("addFormObject",Ge),Ee.pop().restore()}};for(var xh in j.beginFormObject=function(se,Ge,Rt,Yt,dn){return $l(se,Ge,Rt,Yt,dn),this},j.endFormObject=function(se){return Dm(se),this},j.doFormObject=function(se,Ge){var Rt=zs[Zt[se]];return At("q"),At(Ge.toString()+" cm"),At("/"+Rt.id+" Do"),At("Q"),this},j.getFormObject=function(se){var Ge=zs[Zt[se]];return{x:Ge.x,y:Ge.y,width:Ge.width,height:Ge.height,matrix:Ge.matrix}},j.save=function(se,Ge){return se=se||"generated.pdf",(Ge=Ge||{}).returnPromise=Ge.returnPromise||!1,Ge.returnPromise===!1?(R_(Qh(jc()),se),typeof R_.unload=="function"&&Wi.setTimeout&&setTimeout(R_.unload,911),this):new Promise(function(Rt,Yt){try{var dn=R_(Qh(jc()),se);typeof R_.unload=="function"&&Wi.setTimeout&&setTimeout(R_.unload,911),Rt(dn)}catch(kn){Yt(kn.message)}})},Ui.API)Ui.API.hasOwnProperty(xh)&&(xh==="events"&&Ui.API.events.length?function(se,Ge){var Rt,Yt,dn;for(dn=Ge.length-1;dn!==-1;dn--)Rt=Ge[dn][0],Yt=Ge[dn][1],se.subscribe.apply(se,[Rt].concat(typeof Yt=="function"?[Yt]:Yt))}(la,Ui.API.events):j[xh]=Ui.API[xh]);var qs=j.getPageWidth=function(se){return(fi[se=se||Le].mediaBox.topRightX-fi[se].mediaBox.bottomLeftX)/hn},hd=j.setPageWidth=function(se,Ge){fi[se].mediaBox.topRightX=Ge*hn+fi[se].mediaBox.bottomLeftX},Hl=j.getPageHeight=function(se){return(fi[se=se||Le].mediaBox.topRightY-fi[se].mediaBox.bottomLeftY)/hn},fd=j.setPageHeight=function(se,Ge){fi[se].mediaBox.topRightY=Ge*hn+fi[se].mediaBox.bottomLeftY};return j.internal={pdfEscape:cl,getStyle:au,getFont:xs,getFontSize:ur,getCharSpace:ns,getTextColor:Us,getLineHeight:tf,getLineHeightFactor:lu,getLineWidth:lo,write:xr,getHorizontalCoordinate:Yo,getVerticalCoordinate:os,getCoordinateString:Fc,getVerticalCoordinateString:ws,collections:{},newObject:Tt,newAdditionalObject:Ht,newObjectDeferred:Ft,newObjectDeferredBegin:Ct,getFilters:qn,putStream:vr,events:la,scaleFactor:hn,pageSize:{getWidth:function(){return qs(Le)},setWidth:function(se){hd(Le,se)},getHeight:function(){return Hl(Le)},setHeight:function(se){fd(Le,se)}},encryptionOptions:I,encryption:oo,getEncryptor:dr,output:Ko,getNumberOfPages:so,pages:on,out:At,f2:Oe,f3:ue,getPageInfo:Ru,getPageInfoByObjId:yi,getCurrentPageInfo:ef,getPDFVersion:G,Point:hc,Rectangle:fc,Matrix:Re,hasHotfix:Ei},Object.defineProperty(j.internal.pageSize,"width",{get:function(){return qs(Le)},set:function(se){hd(Le,se)},enumerable:!0,configurable:!0}),Object.defineProperty(j.internal.pageSize,"height",{get:function(){return Hl(Le)},set:function(se){fd(Le,se)},enumerable:!0,configurable:!0}),Jh.call(j,Dn),Xn="F1",Lo(s,n),la.publish("initialized"),j}y0.prototype.lsbFirstWord=function(t){return String.fromCharCode(t>>0&255,t>>8&255,t>>16&255,t>>24&255)},y0.prototype.toHexString=function(t){return t.split("").map(function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)}).join("")},y0.prototype.hexToBytes=function(t){for(var e=[],n=0;n<t.length;n+=2)e.push(String.fromCharCode(parseInt(t.substr(n,2),16)));return e.join("")},y0.prototype.processOwnerPassword=function(t,e){return DD(RD(e).substr(0,5),t)},y0.prototype.encryptor=function(t,e){var n=RD(this.encryptionKey+String.fromCharCode(255&t,t>>8&255,t>>16&255,255&e,e>>8&255)).substr(0,10);return function(r){return DD(n,r)}},p5.prototype.equals=function(t){var e,n="id,objectNumber,equals";if(!t||ks(t)!==ks(this))return!1;var r=0;for(e in this)if(!(n.indexOf(e)>=0)){if(this.hasOwnProperty(e)&&!t.hasOwnProperty(e)||this[e]!==t[e])return!1;r++}for(e in t)t.hasOwnProperty(e)&&n.indexOf(e)<0&&r--;return r===0},Ui.API={events:[]},Ui.version="3.0.1";var vl=Ui.API,yN=1,wv=function(t){return t.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},f0=function(t){return t.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},oa=function(t){return t.toFixed(2)},cy=function(t){return t.toFixed(5)};vl.__acroform__={};var If=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t},_$=function(t){return t*yN},hm=function(t){var e=new MJ,n=ei.internal.getHeight(t)||0,r=ei.internal.getWidth(t)||0;return e.BBox=[0,0,Number(oa(r)),Number(oa(n))],e},xEe=vl.__acroform__.setBit=function(t,e){if(t=t||0,e=e||0,isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return t|=1<<e},wEe=vl.__acroform__.clearBit=function(t,e){if(t=t||0,e=e||0,isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return t&=~(1<<e)},SEe=vl.__acroform__.getBit=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return(t&1<<e)==0?0:1},Nl=vl.__acroform__.getBitForPdf=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return SEe(t,e-1)},zl=vl.__acroform__.setBitForPdf=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return xEe(t,e-1)},Bl=vl.__acroform__.clearBitForPdf=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return wEe(t,e-1)},AEe=vl.__acroform__.calculateCoordinates=function(t,e){var n=e.internal.getHorizontalCoordinate,r=e.internal.getVerticalCoordinate,s=t[0],l=t[1],f=t[2],i=t[3],x={};return x.lowerLeft_X=n(s)||0,x.lowerLeft_Y=r(l+i)||0,x.upperRight_X=n(s+f)||0,x.upperRight_Y=r(l)||0,[Number(oa(x.lowerLeft_X)),Number(oa(x.lowerLeft_Y)),Number(oa(x.upperRight_X)),Number(oa(x.upperRight_Y))]},TEe=function(t){if(t.appearanceStreamContent)return t.appearanceStreamContent;if(t.V||t.DV){var e=[],n=t._V||t.DV,r=LD(t,n),s=t.scope.internal.getFont(t.fontName,t.fontStyle).id;e.push("/Tx BMC"),e.push("q"),e.push("BT"),e.push(t.scope.__private__.encodeColorString(t.color)),e.push("/"+s+" "+oa(r.fontSize)+" Tf"),e.push("1 0 0 1 0 0 Tm"),e.push(r.text),e.push("ET"),e.push("Q"),e.push("EMC");var l=hm(t);return l.scope=t.scope,l.stream=e.join(`
`),l}},LD=function(t,e){var n=t.fontSize===0?t.maxFontSize:t.fontSize,r={text:"",fontSize:""},s=(e=(e=e.substr(0,1)=="("?e.substr(1):e).substr(e.length-1)==")"?e.substr(0,e.length-1):e).split(" ");s=t.multiline?s.map(function(ue){return ue.split(`
`)}):s.map(function(ue){return[ue]});var l=n,f=ei.internal.getHeight(t)||0;f=f<0?-f:f;var i=ei.internal.getWidth(t)||0;i=i<0?-i:i;var x=function(ue,we,ke){if(ue+1<s.length){var De=we+" "+s[ue+1][0];return fA(De,t,ke).width<=i-4}return!1};l++;e:for(;l>0;){e="",l--;var S,I,R=fA("3",t,l).height,F=t.multiline?f-l:(f-R)/2,j=F+=2,H=0,G=0,W=0;if(l<=0){e=`(...) Tj
`,e+="% Width of Text: "+fA(e,t,l=12).width+", FieldWidth:"+i+`
`;break}for(var J="",ie=0,he=0;he<s.length;he++)if(s.hasOwnProperty(he)){var ge=!1;if(s[he].length!==1&&W!==s[he].length-1){if((R+2)*(ie+2)+2>f)continue e;J+=s[he][W],ge=!0,G=he,he--}else{J=(J+=s[he][W]+" ").substr(J.length-1)==" "?J.substr(0,J.length-1):J;var fe=parseInt(he),ye=x(fe,J,l),pe=he>=s.length-1;if(ye&&!pe){J+=" ",W=0;continue}if(ye||pe){if(pe)G=fe;else if(t.multiline&&(R+2)*(ie+2)+2>f)continue e}else{if(!t.multiline||(R+2)*(ie+2)+2>f)continue e;G=fe}}for(var be="",Ae=H;Ae<=G;Ae++){var Oe=s[Ae];if(t.multiline){if(Ae===G){be+=Oe[W]+" ",W=(W+1)%Oe.length;continue}if(Ae===H){be+=Oe[Oe.length-1]+" ";continue}}be+=Oe[0]+" "}switch(be=be.substr(be.length-1)==" "?be.substr(0,be.length-1):be,I=fA(be,t,l).width,t.textAlign){case"right":S=i-I-2;break;case"center":S=(i-I)/2;break;case"left":default:S=2}e+=oa(S)+" "+oa(j)+` Td
`,e+="("+wv(be)+`) Tj
`,e+=-oa(S)+` 0 Td
`,j=-(l+2),I=0,H=ge?G:G+1,ie++,J=""}break}return r.text=e,r.fontSize=l,r},fA=function(t,e,n){var r=e.scope.internal.getFont(e.fontName,e.fontStyle),s=e.scope.getStringUnitWidth(t,{font:r,fontSize:parseFloat(n),charSpace:0})*parseFloat(n);return{height:e.scope.getStringUnitWidth("3",{font:r,fontSize:parseFloat(n),charSpace:0})*parseFloat(n)*1.5,width:s}},EEe={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},MEe=function(t,e){var n={type:"reference",object:t};e.internal.getPageInfo(t.page).pageContext.annotations.find(function(r){return r.type===n.type&&r.object===n.object})===void 0&&e.internal.getPageInfo(t.page).pageContext.annotations.push(n)},CEe=function(t,e){for(var n in t)if(t.hasOwnProperty(n)){var r=n,s=t[n];e.internal.newObjectDeferredBegin(s.objId,!0),ks(s)==="object"&&typeof s.putStream=="function"&&s.putStream(),delete t[r]}},IEe=function(t,e){if(e.scope=t,t.internal!==void 0&&(t.internal.acroformPlugin===void 0||t.internal.acroformPlugin.isInitialized===!1)){if(Lp.FieldNum=0,t.internal.acroformPlugin=JSON.parse(JSON.stringify(EEe)),t.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");yN=t.internal.scaleFactor,t.internal.acroformPlugin.acroFormDictionaryRoot=new CJ,t.internal.acroformPlugin.acroFormDictionaryRoot.scope=t,t.internal.acroformPlugin.acroFormDictionaryRoot._eventID=t.internal.events.subscribe("postPutResources",function(){(function(n){n.internal.events.unsubscribe(n.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete n.internal.acroformPlugin.acroFormDictionaryRoot._eventID,n.internal.acroformPlugin.printedOut=!0})(t)}),t.internal.events.subscribe("buildDocument",function(){(function(n){n.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var r=n.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var s in r)if(r.hasOwnProperty(s)){var l=r[s];l.objId=void 0,l.hasAnnotation&&MEe(l,n)}})(t)}),t.internal.events.subscribe("putCatalog",function(){(function(n){if(n.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");n.internal.write("/AcroForm "+n.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(t)}),t.internal.events.subscribe("postPutPages",function(n){(function(r,s){var l=!r;for(var f in r||(s.internal.newObjectDeferredBegin(s.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),s.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),r=r||s.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(r.hasOwnProperty(f)){var i=r[f],x=[],S=i.Rect;if(i.Rect&&(i.Rect=AEe(i.Rect,s)),s.internal.newObjectDeferredBegin(i.objId,!0),i.DA=ei.createDefaultAppearanceStream(i),ks(i)==="object"&&typeof i.getKeyValueListForStream=="function"&&(x=i.getKeyValueListForStream()),i.Rect=S,i.hasAppearanceStream&&!i.appearanceStreamContent){var I=TEe(i);x.push({key:"AP",value:"<</N "+I+">>"}),s.internal.acroformPlugin.xForms.push(I)}if(i.appearanceStreamContent){var R="";for(var F in i.appearanceStreamContent)if(i.appearanceStreamContent.hasOwnProperty(F)){var j=i.appearanceStreamContent[F];if(R+="/"+F+" ",R+="<<",Object.keys(j).length>=1||Array.isArray(j)){for(var f in j)if(j.hasOwnProperty(f)){var H=j[f];typeof H=="function"&&(H=H.call(s,i)),R+="/"+f+" "+H+" ",s.internal.acroformPlugin.xForms.indexOf(H)>=0||s.internal.acroformPlugin.xForms.push(H)}}else typeof(H=j)=="function"&&(H=H.call(s,i)),R+="/"+f+" "+H,s.internal.acroformPlugin.xForms.indexOf(H)>=0||s.internal.acroformPlugin.xForms.push(H);R+=">>"}x.push({key:"AP",value:`<<
`+R+">>"})}s.internal.putStream({additionalKeyValues:x,objectId:i.objId}),s.internal.out("endobj")}l&&CEe(s.internal.acroformPlugin.xForms,s)})(n,t)}),t.internal.acroformPlugin.isInitialized=!0}},EJ=vl.__acroform__.arrayToPdfArray=function(t,e,n){var r=function(f){return f};if(Array.isArray(t)){for(var s="[",l=0;l<t.length;l++)switch(l!==0&&(s+=" "),ks(t[l])){case"boolean":case"number":case"object":s+=t[l].toString();break;case"string":t[l].substr(0,1)!=="/"?(e!==void 0&&n&&(r=n.internal.getEncryptor(e)),s+="("+wv(r(t[l].toString()))+")"):s+=t[l].toString()}return s+="]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},l4=function(t,e,n){var r=function(s){return s};return e!==void 0&&n&&(r=n.internal.getEncryptor(e)),(t=t||"").toString(),t="("+wv(r(t))+")"},vm=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(t){this._objId=t}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};vm.prototype.toString=function(){return this.objId+" 0 R"},vm.prototype.putStream=function(){var t=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:t,objectId:this.objId}),this.scope.internal.out("endobj")},vm.prototype.getKeyValueListForStream=function(){var t=[],e=Object.getOwnPropertyNames(this).filter(function(l){return l!="content"&&l!="appearanceStreamContent"&&l!="scope"&&l!="objId"&&l.substring(0,1)!="_"});for(var n in e)if(Object.getOwnPropertyDescriptor(this,e[n]).configurable===!1){var r=e[n],s=this[r];s&&(Array.isArray(s)?t.push({key:r,value:EJ(s,this.objId,this.scope)}):s instanceof vm?(s.scope=this.scope,t.push({key:r,value:s.objId+" 0 R"})):typeof s!="function"&&t.push({key:r,value:s}))}return t};var MJ=function(){vm.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var t,e=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return e},set:function(n){e=n}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(n){t=n.trim()},get:function(){return t||null}})};If(MJ,vm);var CJ=function(){vm.call(this);var t,e=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return e.length>0?e:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return e}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(t){var n=function(r){return r};return this.scope&&(n=this.scope.internal.getEncryptor(this.objId)),"("+wv(n(t))+")"}},set:function(n){t=n}})};If(CJ,vm);var Lp=function t(){vm.call(this);var e=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return e},set:function(J){if(isNaN(J))throw new Error('Invalid value "'+J+'" for attribute F supplied.');e=J}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!Nl(e,3)},set:function(J){J?this.F=zl(e,3):this.F=Bl(e,3)}});var n=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return n},set:function(J){if(isNaN(J))throw new Error('Invalid value "'+J+'" for attribute Ff supplied.');n=J}});var r=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(r.length!==0)return r},set:function(J){r=J!==void 0?J:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[0])?0:r[0]},set:function(J){r[0]=J}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[1])?0:r[1]},set:function(J){r[1]=J}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[2])?0:r[2]},set:function(J){r[2]=J}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[3])?0:r[3]},set:function(J){r[3]=J}});var s="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return s},set:function(J){switch(J){case"/Btn":case"/Tx":case"/Ch":case"/Sig":s=J;break;default:throw new Error('Invalid value "'+J+'" for attribute FT supplied.')}}});var l=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!l||l.length<1){if(this instanceof m5)return;l="FieldObject"+t.FieldNum++}var J=function(ie){return ie};return this.scope&&(J=this.scope.internal.getEncryptor(this.objId)),"("+wv(J(l))+")"},set:function(J){l=J.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return l},set:function(J){l=J}});var f="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return f},set:function(J){f=J}});var i="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return i},set:function(J){i=J}});var x=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return x},set:function(J){x=J}});var S=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return S===void 0?50/yN:S},set:function(J){S=J}});var I="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return I},set:function(J){I=J}});var R="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!R||this instanceof m5||this instanceof X_))return l4(R,this.objId,this.scope)},set:function(J){J=J.toString(),R=J}});var F=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(F)return this instanceof Qc?F:l4(F,this.objId,this.scope)},set:function(J){J=J.toString(),F=this instanceof Qc?J:J.substr(0,1)==="("?f0(J.substr(1,J.length-2)):f0(J)}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Qc?f0(F.substr(1,F.length-1)):F},set:function(J){J=J.toString(),F=this instanceof Qc?"/"+J:J}});var j=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(j)return j},set:function(J){this.V=J}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(j)return this instanceof Qc?j:l4(j,this.objId,this.scope)},set:function(J){J=J.toString(),j=this instanceof Qc?J:J.substr(0,1)==="("?f0(J.substr(1,J.length-2)):f0(J)}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Qc?f0(j.substr(1,j.length-1)):j},set:function(J){J=J.toString(),j=this instanceof Qc?"/"+J:J}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var H,G=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return G},set:function(J){J=!!J,G=J}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(H)return H},set:function(J){H=J}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!Nl(this.Ff,1)},set:function(J){J?this.Ff=zl(this.Ff,1):this.Ff=Bl(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!Nl(this.Ff,2)},set:function(J){J?this.Ff=zl(this.Ff,2):this.Ff=Bl(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!Nl(this.Ff,3)},set:function(J){J?this.Ff=zl(this.Ff,3):this.Ff=Bl(this.Ff,3)}});var W=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(W!==null)return W},set:function(J){if([0,1,2].indexOf(J)===-1)throw new Error('Invalid value "'+J+'" for attribute Q supplied.');W=J}}),Object.defineProperty(this,"textAlign",{get:function(){var J;switch(W){case 0:default:J="left";break;case 1:J="center";break;case 2:J="right"}return J},configurable:!0,enumerable:!0,set:function(J){switch(J){case"right":case 2:W=2;break;case"center":case 1:W=1;break;case"left":case 0:default:W=0}}})};If(Lp,vm);var F0=function(){Lp.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var t=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return t},set:function(n){t=n}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return t},set:function(n){t=n}});var e=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return EJ(e,this.objId,this.scope)},set:function(n){var r,s;s=[],typeof(r=n)=="string"&&(s=function(l,f,i){i||(i=1);for(var x,S=[];x=f.exec(l);)S.push(x[i]);return S}(r,/\((.*?)\)/g)),e=s}}),this.getOptions=function(){return e},this.setOptions=function(n){e=n,this.sort&&e.sort()},this.addOption=function(n){n=(n=n||"").toString(),e.push(n),this.sort&&e.sort()},this.removeOption=function(n,r){for(r=r||!1,n=(n=n||"").toString();e.indexOf(n)!==-1&&(e.splice(e.indexOf(n),1),r!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!Nl(this.Ff,18)},set:function(n){n?this.Ff=zl(this.Ff,18):this.Ff=Bl(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!Nl(this.Ff,19)},set:function(n){this.combo===!0&&(n?this.Ff=zl(this.Ff,19):this.Ff=Bl(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!Nl(this.Ff,20)},set:function(n){n?(this.Ff=zl(this.Ff,20),e.sort()):this.Ff=Bl(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!Nl(this.Ff,22)},set:function(n){n?this.Ff=zl(this.Ff,22):this.Ff=Bl(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Nl(this.Ff,23)},set:function(n){n?this.Ff=zl(this.Ff,23):this.Ff=Bl(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!Nl(this.Ff,27)},set:function(n){n?this.Ff=zl(this.Ff,27):this.Ff=Bl(this.Ff,27)}}),this.hasAppearanceStream=!1};If(F0,Lp);var U0=function(){F0.call(this),this.fontName="helvetica",this.combo=!1};If(U0,F0);var q0=function(){U0.call(this),this.combo=!0};If(q0,U0);var kA=function(){q0.call(this),this.edit=!0};If(kA,q0);var Qc=function(){Lp.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!Nl(this.Ff,15)},set:function(n){n?this.Ff=zl(this.Ff,15):this.Ff=Bl(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!Nl(this.Ff,16)},set:function(n){n?this.Ff=zl(this.Ff,16):this.Ff=Bl(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!Nl(this.Ff,17)},set:function(n){n?this.Ff=zl(this.Ff,17):this.Ff=Bl(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!Nl(this.Ff,26)},set:function(n){n?this.Ff=zl(this.Ff,26):this.Ff=Bl(this.Ff,26)}});var t,e={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var n=function(l){return l};if(this.scope&&(n=this.scope.internal.getEncryptor(this.objId)),Object.keys(e).length!==0){var r,s=[];for(r in s.push("<<"),e)s.push("/"+r+" ("+wv(n(e[r]))+")");return s.push(">>"),s.join(`
`)}},set:function(n){ks(n)==="object"&&(e=n)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return e.CA||""},set:function(n){typeof n=="string"&&(e.CA=n)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return t},set:function(n){t=n}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return t.substr(1,t.length-1)},set:function(n){t="/"+n}})};If(Qc,Lp);var NA=function(){Qc.call(this),this.pushButton=!0};If(NA,Qc);var V0=function(){Qc.call(this),this.radio=!0,this.pushButton=!1;var t=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return t},set:function(e){t=e!==void 0?e:[]}})};If(V0,Qc);var m5=function(){var t,e;Lp.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return t},set:function(s){t=s}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return e},set:function(s){e=s}});var n,r={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var s=function(i){return i};this.scope&&(s=this.scope.internal.getEncryptor(this.objId));var l,f=[];for(l in f.push("<<"),r)f.push("/"+l+" ("+wv(s(r[l]))+")");return f.push(">>"),f.join(`
`)},set:function(s){ks(s)==="object"&&(r=s)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return r.CA||""},set:function(s){typeof s=="string"&&(r.CA=s)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return n},set:function(s){n=s}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return n.substr(1,n.length-1)},set:function(s){n="/"+s}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=ei.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};If(m5,Lp),V0.prototype.setAppearance=function(t){if(!("createAppearanceStream"in t)||!("getCA"in t))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var e in this.Kids)if(this.Kids.hasOwnProperty(e)){var n=this.Kids[e];n.appearanceStreamContent=t.createAppearanceStream(n.optionName),n.caption=t.getCA()}},V0.prototype.createOption=function(t){var e=new m5;return e.Parent=this,e.optionName=t,this.Kids.push(e),PEe.call(this.scope,e),e};var zA=function(){Qc.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=ei.CheckBox.createAppearanceStream()};If(zA,Qc);var X_=function(){Lp.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!Nl(this.Ff,13)},set:function(e){e?this.Ff=zl(this.Ff,13):this.Ff=Bl(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!Nl(this.Ff,21)},set:function(e){e?this.Ff=zl(this.Ff,21):this.Ff=Bl(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Nl(this.Ff,23)},set:function(e){e?this.Ff=zl(this.Ff,23):this.Ff=Bl(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!Nl(this.Ff,24)},set:function(e){e?this.Ff=zl(this.Ff,24):this.Ff=Bl(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!Nl(this.Ff,25)},set:function(e){e?this.Ff=zl(this.Ff,25):this.Ff=Bl(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!Nl(this.Ff,26)},set:function(e){e?this.Ff=zl(this.Ff,26):this.Ff=Bl(this.Ff,26)}});var t=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return t},set:function(e){Number.isInteger(e)&&(t=e)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};If(X_,Lp);var BA=function(){X_.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!Nl(this.Ff,14)},set:function(t){t?this.Ff=zl(this.Ff,14):this.Ff=Bl(this.Ff,14)}}),this.password=!0};If(BA,X_);var ei={CheckBox:{createAppearanceStream:function(){return{N:{On:ei.CheckBox.YesNormal},D:{On:ei.CheckBox.YesPushDown,Off:ei.CheckBox.OffPushDown}}},YesPushDown:function(t){var e=hm(t);e.scope=t.scope;var n=[],r=t.scope.internal.getFont(t.fontName,t.fontStyle).id,s=t.scope.__private__.encodeColorString(t.color),l=LD(t,t.caption);return n.push("0.749023 g"),n.push("0 0 "+oa(ei.internal.getWidth(t))+" "+oa(ei.internal.getHeight(t))+" re"),n.push("f"),n.push("BMC"),n.push("q"),n.push("0 0 1 rg"),n.push("/"+r+" "+oa(l.fontSize)+" Tf "+s),n.push("BT"),n.push(l.text),n.push("ET"),n.push("Q"),n.push("EMC"),e.stream=n.join(`
`),e},YesNormal:function(t){var e=hm(t);e.scope=t.scope;var n=t.scope.internal.getFont(t.fontName,t.fontStyle).id,r=t.scope.__private__.encodeColorString(t.color),s=[],l=ei.internal.getHeight(t),f=ei.internal.getWidth(t),i=LD(t,t.caption);return s.push("1 g"),s.push("0 0 "+oa(f)+" "+oa(l)+" re"),s.push("f"),s.push("q"),s.push("0 0 1 rg"),s.push("0 0 "+oa(f-1)+" "+oa(l-1)+" re"),s.push("W"),s.push("n"),s.push("0 g"),s.push("BT"),s.push("/"+n+" "+oa(i.fontSize)+" Tf "+r),s.push(i.text),s.push("ET"),s.push("Q"),e.stream=s.join(`
`),e},OffPushDown:function(t){var e=hm(t);e.scope=t.scope;var n=[];return n.push("0.749023 g"),n.push("0 0 "+oa(ei.internal.getWidth(t))+" "+oa(ei.internal.getHeight(t))+" re"),n.push("f"),e.stream=n.join(`
`),e}},RadioButton:{Circle:{createAppearanceStream:function(t){var e={D:{Off:ei.RadioButton.Circle.OffPushDown},N:{}};return e.N[t]=ei.RadioButton.Circle.YesNormal,e.D[t]=ei.RadioButton.Circle.YesPushDown,e},getCA:function(){return"l"},YesNormal:function(t){var e=hm(t);e.scope=t.scope;var n=[],r=ei.internal.getWidth(t)<=ei.internal.getHeight(t)?ei.internal.getWidth(t)/4:ei.internal.getHeight(t)/4;r=Number((.9*r).toFixed(5));var s=ei.internal.Bezier_C,l=Number((r*s).toFixed(5));return n.push("q"),n.push("1 0 0 1 "+cy(ei.internal.getWidth(t)/2)+" "+cy(ei.internal.getHeight(t)/2)+" cm"),n.push(r+" 0 m"),n.push(r+" "+l+" "+l+" "+r+" 0 "+r+" c"),n.push("-"+l+" "+r+" -"+r+" "+l+" -"+r+" 0 c"),n.push("-"+r+" -"+l+" -"+l+" -"+r+" 0 -"+r+" c"),n.push(l+" -"+r+" "+r+" -"+l+" "+r+" 0 c"),n.push("f"),n.push("Q"),e.stream=n.join(`
`),e},YesPushDown:function(t){var e=hm(t);e.scope=t.scope;var n=[],r=ei.internal.getWidth(t)<=ei.internal.getHeight(t)?ei.internal.getWidth(t)/4:ei.internal.getHeight(t)/4;r=Number((.9*r).toFixed(5));var s=Number((2*r).toFixed(5)),l=Number((s*ei.internal.Bezier_C).toFixed(5)),f=Number((r*ei.internal.Bezier_C).toFixed(5));return n.push("0.749023 g"),n.push("q"),n.push("1 0 0 1 "+cy(ei.internal.getWidth(t)/2)+" "+cy(ei.internal.getHeight(t)/2)+" cm"),n.push(s+" 0 m"),n.push(s+" "+l+" "+l+" "+s+" 0 "+s+" c"),n.push("-"+l+" "+s+" -"+s+" "+l+" -"+s+" 0 c"),n.push("-"+s+" -"+l+" -"+l+" -"+s+" 0 -"+s+" c"),n.push(l+" -"+s+" "+s+" -"+l+" "+s+" 0 c"),n.push("f"),n.push("Q"),n.push("0 g"),n.push("q"),n.push("1 0 0 1 "+cy(ei.internal.getWidth(t)/2)+" "+cy(ei.internal.getHeight(t)/2)+" cm"),n.push(r+" 0 m"),n.push(r+" "+f+" "+f+" "+r+" 0 "+r+" c"),n.push("-"+f+" "+r+" -"+r+" "+f+" -"+r+" 0 c"),n.push("-"+r+" -"+f+" -"+f+" -"+r+" 0 -"+r+" c"),n.push(f+" -"+r+" "+r+" -"+f+" "+r+" 0 c"),n.push("f"),n.push("Q"),e.stream=n.join(`
`),e},OffPushDown:function(t){var e=hm(t);e.scope=t.scope;var n=[],r=ei.internal.getWidth(t)<=ei.internal.getHeight(t)?ei.internal.getWidth(t)/4:ei.internal.getHeight(t)/4;r=Number((.9*r).toFixed(5));var s=Number((2*r).toFixed(5)),l=Number((s*ei.internal.Bezier_C).toFixed(5));return n.push("0.749023 g"),n.push("q"),n.push("1 0 0 1 "+cy(ei.internal.getWidth(t)/2)+" "+cy(ei.internal.getHeight(t)/2)+" cm"),n.push(s+" 0 m"),n.push(s+" "+l+" "+l+" "+s+" 0 "+s+" c"),n.push("-"+l+" "+s+" -"+s+" "+l+" -"+s+" 0 c"),n.push("-"+s+" -"+l+" -"+l+" -"+s+" 0 -"+s+" c"),n.push(l+" -"+s+" "+s+" -"+l+" "+s+" 0 c"),n.push("f"),n.push("Q"),e.stream=n.join(`
`),e}},Cross:{createAppearanceStream:function(t){var e={D:{Off:ei.RadioButton.Cross.OffPushDown},N:{}};return e.N[t]=ei.RadioButton.Cross.YesNormal,e.D[t]=ei.RadioButton.Cross.YesPushDown,e},getCA:function(){return"8"},YesNormal:function(t){var e=hm(t);e.scope=t.scope;var n=[],r=ei.internal.calculateCross(t);return n.push("q"),n.push("1 1 "+oa(ei.internal.getWidth(t)-2)+" "+oa(ei.internal.getHeight(t)-2)+" re"),n.push("W"),n.push("n"),n.push(oa(r.x1.x)+" "+oa(r.x1.y)+" m"),n.push(oa(r.x2.x)+" "+oa(r.x2.y)+" l"),n.push(oa(r.x4.x)+" "+oa(r.x4.y)+" m"),n.push(oa(r.x3.x)+" "+oa(r.x3.y)+" l"),n.push("s"),n.push("Q"),e.stream=n.join(`
`),e},YesPushDown:function(t){var e=hm(t);e.scope=t.scope;var n=ei.internal.calculateCross(t),r=[];return r.push("0.749023 g"),r.push("0 0 "+oa(ei.internal.getWidth(t))+" "+oa(ei.internal.getHeight(t))+" re"),r.push("f"),r.push("q"),r.push("1 1 "+oa(ei.internal.getWidth(t)-2)+" "+oa(ei.internal.getHeight(t)-2)+" re"),r.push("W"),r.push("n"),r.push(oa(n.x1.x)+" "+oa(n.x1.y)+" m"),r.push(oa(n.x2.x)+" "+oa(n.x2.y)+" l"),r.push(oa(n.x4.x)+" "+oa(n.x4.y)+" m"),r.push(oa(n.x3.x)+" "+oa(n.x3.y)+" l"),r.push("s"),r.push("Q"),e.stream=r.join(`
`),e},OffPushDown:function(t){var e=hm(t);e.scope=t.scope;var n=[];return n.push("0.749023 g"),n.push("0 0 "+oa(ei.internal.getWidth(t))+" "+oa(ei.internal.getHeight(t))+" re"),n.push("f"),e.stream=n.join(`
`),e}}},createDefaultAppearanceStream:function(t){var e=t.scope.internal.getFont(t.fontName,t.fontStyle).id,n=t.scope.__private__.encodeColorString(t.color);return"/"+e+" "+t.fontSize+" Tf "+n}};ei.internal={Bezier_C:.551915024494,calculateCross:function(t){var e=ei.internal.getWidth(t),n=ei.internal.getHeight(t),r=Math.min(e,n);return{x1:{x:(e-r)/2,y:(n-r)/2+r},x2:{x:(e-r)/2+r,y:(n-r)/2},x3:{x:(e-r)/2,y:(n-r)/2},x4:{x:(e-r)/2+r,y:(n-r)/2+r}}}},ei.internal.getWidth=function(t){var e=0;return ks(t)==="object"&&(e=_$(t.Rect[2])),e},ei.internal.getHeight=function(t){var e=0;return ks(t)==="object"&&(e=_$(t.Rect[3])),e};var PEe=vl.addField=function(t){if(IEe(this,t),!(t instanceof Lp))throw new Error("Invalid argument passed to jsPDF.addField.");var e;return(e=t).scope.internal.acroformPlugin.printedOut&&(e.scope.internal.acroformPlugin.printedOut=!1,e.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),e.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(e),t.page=t.scope.internal.getCurrentPageInfo().pageNumber,this};vl.AcroFormChoiceField=F0,vl.AcroFormListBox=U0,vl.AcroFormComboBox=q0,vl.AcroFormEditBox=kA,vl.AcroFormButton=Qc,vl.AcroFormPushButton=NA,vl.AcroFormRadioButton=V0,vl.AcroFormCheckBox=zA,vl.AcroFormTextField=X_,vl.AcroFormPasswordField=BA,vl.AcroFormAppearance=ei,vl.AcroForm={ChoiceField:F0,ListBox:U0,ComboBox:q0,EditBox:kA,Button:Qc,PushButton:NA,RadioButton:V0,CheckBox:zA,TextField:X_,PasswordField:BA,Appearance:ei},Ui.AcroForm={ChoiceField:F0,ListBox:U0,ComboBox:q0,EditBox:kA,Button:Qc,PushButton:NA,RadioButton:V0,CheckBox:zA,TextField:X_,PasswordField:BA,Appearance:ei};Ui.AcroForm;function IJ(t){return t.reduce(function(e,n,r){return e[n]=r,e},{})}(function(t){t.__addimage__={};var e="UNKNOWN",n={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},r=t.__addimage__.getImageFileTypeByImageData=function(ue,we){var ke,De,je,ze,Ue,Fe=e;if((we=we||e)==="RGBA"||ue.data!==void 0&&ue.data instanceof Uint8ClampedArray&&"height"in ue&&"width"in ue)return"RGBA";if(ye(ue))for(Ue in n)for(je=n[Ue],ke=0;ke<je.length;ke+=1){for(ze=!0,De=0;De<je[ke].length;De+=1)if(je[ke][De]!==void 0&&je[ke][De]!==ue[De]){ze=!1;break}if(ze===!0){Fe=Ue;break}}else for(Ue in n)for(je=n[Ue],ke=0;ke<je.length;ke+=1){for(ze=!0,De=0;De<je[ke].length;De+=1)if(je[ke][De]!==void 0&&je[ke][De]!==ue.charCodeAt(De)){ze=!1;break}if(ze===!0){Fe=Ue;break}}return Fe===e&&we!==e&&(Fe=we),Fe},s=function ue(we){for(var ke=this.internal.write,De=this.internal.putStream,je=(0,this.internal.getFilters)();je.indexOf("FlateEncode")!==-1;)je.splice(je.indexOf("FlateEncode"),1);we.objectId=this.internal.newObject();var ze=[];if(ze.push({key:"Type",value:"/XObject"}),ze.push({key:"Subtype",value:"/Image"}),ze.push({key:"Width",value:we.width}),ze.push({key:"Height",value:we.height}),we.colorSpace===W.INDEXED?ze.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(we.palette.length/3-1)+" "+("sMask"in we&&we.sMask!==void 0?we.objectId+2:we.objectId+1)+" 0 R]"}):(ze.push({key:"ColorSpace",value:"/"+we.colorSpace}),we.colorSpace===W.DEVICE_CMYK&&ze.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),ze.push({key:"BitsPerComponent",value:we.bitsPerComponent}),"decodeParameters"in we&&we.decodeParameters!==void 0&&ze.push({key:"DecodeParms",value:"<<"+we.decodeParameters+">>"}),"transparency"in we&&Array.isArray(we.transparency)){for(var Ue="",Fe=0,Qe=we.transparency.length;Fe<Qe;Fe++)Ue+=we.transparency[Fe]+" "+we.transparency[Fe]+" ";ze.push({key:"Mask",value:"["+Ue+"]"})}we.sMask!==void 0&&ze.push({key:"SMask",value:we.objectId+1+" 0 R"});var Be=we.filter!==void 0?["/"+we.filter]:void 0;if(De({data:we.data,additionalKeyValues:ze,alreadyAppliedFilters:Be,objectId:we.objectId}),ke("endobj"),"sMask"in we&&we.sMask!==void 0){var bt="/Predictor "+we.predictor+" /Colors 1 /BitsPerComponent "+we.bitsPerComponent+" /Columns "+we.width,xe={width:we.width,height:we.height,colorSpace:"DeviceGray",bitsPerComponent:we.bitsPerComponent,decodeParameters:bt,data:we.sMask};"filter"in we&&(xe.filter=we.filter),ue.call(this,xe)}if(we.colorSpace===W.INDEXED){var Le=this.internal.newObject();De({data:be(new Uint8Array(we.palette)),objectId:Le}),ke("endobj")}},l=function(){var ue=this.internal.collections.addImage_images;for(var we in ue)s.call(this,ue[we])},f=function(){var ue,we=this.internal.collections.addImage_images,ke=this.internal.write;for(var De in we)ke("/I"+(ue=we[De]).index,ue.objectId,"0","R")},i=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",l),this.internal.events.subscribe("putXobjectDict",f))},x=function(){var ue=this.internal.collections.addImage_images;return i.call(this),ue},S=function(){return Object.keys(this.internal.collections.addImage_images).length},I=function(ue){return typeof t["process"+ue.toUpperCase()]=="function"},R=function(ue){return ks(ue)==="object"&&ue.nodeType===1},F=function(ue,we){if(ue.nodeName==="IMG"&&ue.hasAttribute("src")){var ke=""+ue.getAttribute("src");if(ke.indexOf("data:image/")===0)return jx(unescape(ke).split("base64,").pop());var De=t.loadFile(ke,!0);if(De!==void 0)return De}if(ue.nodeName==="CANVAS"){if(ue.width===0||ue.height===0)throw new Error("Given canvas must have data. Canvas width: "+ue.width+", height: "+ue.height);var je;switch(we){case"PNG":je="image/png";break;case"WEBP":je="image/webp";break;case"JPEG":case"JPG":default:je="image/jpeg"}return jx(ue.toDataURL(je,1).split("base64,").pop())}},j=function(ue){var we=this.internal.collections.addImage_images;if(we){for(var ke in we)if(ue===we[ke].alias)return we[ke]}},H=function(ue,we,ke){return ue||we||(ue=-96,we=-96),ue<0&&(ue=-1*ke.width*72/ue/this.internal.scaleFactor),we<0&&(we=-1*ke.height*72/we/this.internal.scaleFactor),ue===0&&(ue=we*ke.width/ke.height),we===0&&(we=ue*ke.height/ke.width),[ue,we]},G=function(ue,we,ke,De,je,ze){var Ue=H.call(this,ke,De,je),Fe=this.internal.getCoordinateString,Qe=this.internal.getVerticalCoordinateString,Be=x.call(this);if(ke=Ue[0],De=Ue[1],Be[je.index]=je,ze){ze*=Math.PI/180;var bt=Math.cos(ze),xe=Math.sin(ze),Le=function(ct){return ct.toFixed(4)},Xe=[Le(bt),Le(xe),Le(-1*xe),Le(bt),0,0,"cm"]}this.internal.write("q"),ze?(this.internal.write([1,"0","0",1,Fe(ue),Qe(we+De),"cm"].join(" ")),this.internal.write(Xe.join(" ")),this.internal.write([Fe(ke),"0","0",Fe(De),"0","0","cm"].join(" "))):this.internal.write([Fe(ke),"0","0",Fe(De),Fe(ue),Qe(we+De),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+je.index+" Do"),this.internal.write("Q")},W=t.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};t.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var J=t.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},ie=t.__addimage__.sHashCode=function(ue){var we,ke,De=0;if(typeof ue=="string")for(ke=ue.length,we=0;we<ke;we++)De=(De<<5)-De+ue.charCodeAt(we),De|=0;else if(ye(ue))for(ke=ue.byteLength/2,we=0;we<ke;we++)De=(De<<5)-De+ue[we],De|=0;return De},he=t.__addimage__.validateStringAsBase64=function(ue){(ue=ue||"").toString().trim();var we=!0;return ue.length===0&&(we=!1),ue.length%4!=0&&(we=!1),/^[A-Za-z0-9+/]+$/.test(ue.substr(0,ue.length-2))===!1&&(we=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(ue.substr(-2))===!1&&(we=!1),we},ge=t.__addimage__.extractImageFromDataUrl=function(ue){if(ue==null||!(ue=ue.trim()).startsWith("data:"))return null;var we=ue.indexOf(",");return we<0?null:ue.substring(0,we).trim().endsWith("base64")?ue.substring(we+1):null},fe=t.__addimage__.supportsArrayBuffer=function(){return typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"};t.__addimage__.isArrayBuffer=function(ue){return fe()&&ue instanceof ArrayBuffer};var ye=t.__addimage__.isArrayBufferView=function(ue){return fe()&&typeof Uint32Array<"u"&&(ue instanceof Int8Array||ue instanceof Uint8Array||typeof Uint8ClampedArray<"u"&&ue instanceof Uint8ClampedArray||ue instanceof Int16Array||ue instanceof Uint16Array||ue instanceof Int32Array||ue instanceof Uint32Array||ue instanceof Float32Array||ue instanceof Float64Array)},pe=t.__addimage__.binaryStringToUint8Array=function(ue){for(var we=ue.length,ke=new Uint8Array(we),De=0;De<we;De++)ke[De]=ue.charCodeAt(De);return ke},be=t.__addimage__.arrayBufferToBinaryString=function(ue){for(var we="",ke=ye(ue)?ue:new Uint8Array(ue),De=0;De<ke.length;De+=8192)we+=String.fromCharCode.apply(null,ke.subarray(De,De+8192));return we};t.addImage=function(){var ue,we,ke,De,je,ze,Ue,Fe,Qe;if(typeof arguments[1]=="number"?(we=e,ke=arguments[1],De=arguments[2],je=arguments[3],ze=arguments[4],Ue=arguments[5],Fe=arguments[6],Qe=arguments[7]):(we=arguments[1],ke=arguments[2],De=arguments[3],je=arguments[4],ze=arguments[5],Ue=arguments[6],Fe=arguments[7],Qe=arguments[8]),ks(ue=arguments[0])==="object"&&!R(ue)&&"imageData"in ue){var Be=ue;ue=Be.imageData,we=Be.format||we||e,ke=Be.x||ke||0,De=Be.y||De||0,je=Be.w||Be.width||je,ze=Be.h||Be.height||ze,Ue=Be.alias||Ue,Fe=Be.compression||Fe,Qe=Be.rotation||Be.angle||Qe}var bt=this.internal.getFilters();if(Fe===void 0&&bt.indexOf("FlateEncode")!==-1&&(Fe="SLOW"),isNaN(ke)||isNaN(De))throw new Error("Invalid coordinates passed to jsPDF.addImage");i.call(this);var xe=Ae.call(this,ue,we,Ue,Fe);return G.call(this,ke,De,je,ze,xe,Qe),this};var Ae=function(ue,we,ke,De){var je,ze,Ue;if(typeof ue=="string"&&r(ue)===e){ue=unescape(ue);var Fe=Oe(ue,!1);(Fe!==""||(Fe=t.loadFile(ue,!0))!==void 0)&&(ue=Fe)}if(R(ue)&&(ue=F(ue,we)),we=r(ue,we),!I(we))throw new Error("addImage does not support files of type '"+we+"', please ensure that a plugin for '"+we+"' support is added.");if(((Ue=ke)==null||Ue.length===0)&&(ke=function(Qe){return typeof Qe=="string"||ye(Qe)?ie(Qe):ye(Qe.data)?ie(Qe.data):null}(ue)),(je=j.call(this,ke))||(fe()&&(ue instanceof Uint8Array||we==="RGBA"||(ze=ue,ue=pe(ue))),je=this["process"+we.toUpperCase()](ue,S.call(this),ke,function(Qe){return Qe&&typeof Qe=="string"&&(Qe=Qe.toUpperCase()),Qe in t.image_compression?Qe:J.NONE}(De),ze)),!je)throw new Error("An unknown error occurred whilst processing the image.");return je},Oe=t.__addimage__.convertBase64ToBinaryString=function(ue,we){we=typeof we!="boolean"||we;var ke,De="";if(typeof ue=="string"){var je;ke=(je=ge(ue))!==null&&je!==void 0?je:ue;try{De=jx(ke)}catch(ze){if(we)throw he(ke)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+ze.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return De};t.getImageProperties=function(ue){var we,ke,De="";if(R(ue)&&(ue=F(ue)),typeof ue=="string"&&r(ue)===e&&((De=Oe(ue,!1))===""&&(De=t.loadFile(ue)||""),ue=De),ke=r(ue),!I(ke))throw new Error("addImage does not support files of type '"+ke+"', please ensure that a plugin for '"+ke+"' support is added.");if(!fe()||ue instanceof Uint8Array||(ue=pe(ue)),!(we=this["process"+ke.toUpperCase()](ue)))throw new Error("An unknown error occurred whilst processing the image");return we.fileType=ke,we}})(Ui.API),function(t){var e=function(n){if(n!==void 0&&n!="")return!0};Ui.API.events.push(["addPage",function(n){this.internal.getPageInfo(n.pageNumber).pageContext.annotations=[]}]),t.events.push(["putPage",function(n){for(var r,s,l,f=this.internal.getCoordinateString,i=this.internal.getVerticalCoordinateString,x=this.internal.getPageInfoByObjId(n.objId),S=n.pageContext.annotations,I=!1,R=0;R<S.length&&!I;R++)switch((r=S[R]).type){case"link":(e(r.options.url)||e(r.options.pageNumber))&&(I=!0);break;case"reference":case"text":case"freetext":I=!0}if(I!=0){this.internal.write("/Annots [");for(var F=0;F<S.length;F++){r=S[F];var j=this.internal.pdfEscape,H=this.internal.getEncryptor(n.objId);switch(r.type){case"reference":this.internal.write(" "+r.object.objId+" 0 R ");break;case"text":var G=this.internal.newAdditionalObject(),W=this.internal.newAdditionalObject(),J=this.internal.getEncryptor(G.objId),ie=r.title||"Note";l="<</Type /Annot /Subtype /Text "+(s="/Rect ["+f(r.bounds.x)+" "+i(r.bounds.y+r.bounds.h)+" "+f(r.bounds.x+r.bounds.w)+" "+i(r.bounds.y)+"] ")+"/Contents ("+j(J(r.contents))+")",l+=" /Popup "+W.objId+" 0 R",l+=" /P "+x.objId+" 0 R",l+=" /T ("+j(J(ie))+") >>",G.content=l;var he=G.objId+" 0 R";l="<</Type /Annot /Subtype /Popup "+(s="/Rect ["+f(r.bounds.x+30)+" "+i(r.bounds.y+r.bounds.h)+" "+f(r.bounds.x+r.bounds.w+30)+" "+i(r.bounds.y)+"] ")+" /Parent "+he,r.open&&(l+=" /Open true"),l+=" >>",W.content=l,this.internal.write(G.objId,"0 R",W.objId,"0 R");break;case"freetext":s="/Rect ["+f(r.bounds.x)+" "+i(r.bounds.y)+" "+f(r.bounds.x+r.bounds.w)+" "+i(r.bounds.y+r.bounds.h)+"] ";var ge=r.color||"#000000";l="<</Type /Annot /Subtype /FreeText "+s+"/Contents ("+j(H(r.contents))+")",l+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+ge+")",l+=" /Border [0 0 0]",l+=" >>",this.internal.write(l);break;case"link":if(r.options.name){var fe=this.annotations._nameMap[r.options.name];r.options.pageNumber=fe.page,r.options.top=fe.y}else r.options.top||(r.options.top=0);if(s="/Rect ["+r.finalBounds.x+" "+r.finalBounds.y+" "+r.finalBounds.w+" "+r.finalBounds.h+"] ",l="",r.options.url)l="<</Type /Annot /Subtype /Link "+s+"/Border [0 0 0] /A <</S /URI /URI ("+j(H(r.options.url))+") >>";else if(r.options.pageNumber)switch(l="<</Type /Annot /Subtype /Link "+s+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(r.options.pageNumber).objId+" 0 R",r.options.magFactor=r.options.magFactor||"XYZ",r.options.magFactor){case"Fit":l+=" /Fit]";break;case"FitH":l+=" /FitH "+r.options.top+"]";break;case"FitV":r.options.left=r.options.left||0,l+=" /FitV "+r.options.left+"]";break;case"XYZ":default:var ye=i(r.options.top);r.options.left=r.options.left||0,r.options.zoom===void 0&&(r.options.zoom=0),l+=" /XYZ "+r.options.left+" "+ye+" "+r.options.zoom+"]"}l!=""&&(l+=" >>",this.internal.write(l))}}this.internal.write("]")}}]),t.createAnnotation=function(n){var r=this.internal.getCurrentPageInfo();switch(n.type){case"link":this.link(n.bounds.x,n.bounds.y,n.bounds.w,n.bounds.h,n);break;case"text":case"freetext":r.pageContext.annotations.push(n)}},t.link=function(n,r,s,l,f){var i=this.internal.getCurrentPageInfo(),x=this.internal.getCoordinateString,S=this.internal.getVerticalCoordinateString;i.pageContext.annotations.push({finalBounds:{x:x(n),y:S(r),w:x(n+s),h:S(r+l)},options:f,type:"link"})},t.textWithLink=function(n,r,s,l){var f,i,x=this.getTextWidth(n),S=this.internal.getLineHeight()/this.internal.scaleFactor;if(l.maxWidth!==void 0){i=l.maxWidth;var I=this.splitTextToSize(n,i).length;f=Math.ceil(S*I)}else i=x,f=S;return this.text(n,r,s,l),s+=.2*S,l.align==="center"&&(r-=x/2),l.align==="right"&&(r-=x),this.link(r,s-S,i,f,l),x},t.getTextWidth=function(n){var r=this.internal.getFontSize();return this.getStringUnitWidth(n)*r/this.internal.scaleFactor}}(Ui.API),function(t){var e={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},n={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},r={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},s=[1570,1571,1573,1575];t.__arabicParser__={};var l=t.__arabicParser__.isInArabicSubstitutionA=function(G){return e[G.charCodeAt(0)]!==void 0},f=t.__arabicParser__.isArabicLetter=function(G){return typeof G=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(G)},i=t.__arabicParser__.isArabicEndLetter=function(G){return f(G)&&l(G)&&e[G.charCodeAt(0)].length<=2},x=t.__arabicParser__.isArabicAlfLetter=function(G){return f(G)&&s.indexOf(G.charCodeAt(0))>=0};t.__arabicParser__.arabicLetterHasIsolatedForm=function(G){return f(G)&&l(G)&&e[G.charCodeAt(0)].length>=1};var S=t.__arabicParser__.arabicLetterHasFinalForm=function(G){return f(G)&&l(G)&&e[G.charCodeAt(0)].length>=2};t.__arabicParser__.arabicLetterHasInitialForm=function(G){return f(G)&&l(G)&&e[G.charCodeAt(0)].length>=3};var I=t.__arabicParser__.arabicLetterHasMedialForm=function(G){return f(G)&&l(G)&&e[G.charCodeAt(0)].length==4},R=t.__arabicParser__.resolveLigatures=function(G){var W=0,J=n,ie="",he=0;for(W=0;W<G.length;W+=1)J[G.charCodeAt(W)]!==void 0?(he++,typeof(J=J[G.charCodeAt(W)])=="number"&&(ie+=String.fromCharCode(J),J=n,he=0),W===G.length-1&&(J=n,ie+=G.charAt(W-(he-1)),W-=he-1,he=0)):(J=n,ie+=G.charAt(W-he),W-=he,he=0);return ie};t.__arabicParser__.isArabicDiacritic=function(G){return G!==void 0&&r[G.charCodeAt(0)]!==void 0};var F=t.__arabicParser__.getCorrectForm=function(G,W,J){return f(G)?l(G)===!1?-1:!S(G)||!f(W)&&!f(J)||!f(J)&&i(W)||i(G)&&!f(W)||i(G)&&x(W)||i(G)&&i(W)?0:I(G)&&f(W)&&!i(W)&&f(J)&&S(J)?3:i(G)||!f(J)?1:2:-1},j=function(G){var W=0,J=0,ie=0,he="",ge="",fe="",ye=(G=G||"").split("\\s+"),pe=[];for(W=0;W<ye.length;W+=1){for(pe.push(""),J=0;J<ye[W].length;J+=1)he=ye[W][J],ge=ye[W][J-1],fe=ye[W][J+1],f(he)?(ie=F(he,ge,fe),pe[W]+=ie!==-1?String.fromCharCode(e[he.charCodeAt(0)][ie]):he):pe[W]+=he;pe[W]=R(pe[W])}return pe.join(" ")},H=t.__arabicParser__.processArabic=t.processArabic=function(){var G,W=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,J=[];if(Array.isArray(W)){var ie=0;for(J=[],ie=0;ie<W.length;ie+=1)Array.isArray(W[ie])?J.push([j(W[ie][0]),W[ie][1],W[ie][2]]):J.push([j(W[ie])]);G=J}else G=j(W);return typeof arguments[0]=="string"?G:(arguments[0].text=G,arguments[0])};t.events.push(["preProcessText",H])}(Ui.API),Ui.API.autoPrint=function(t){var e;switch((t=t||{}).variant=t.variant||"non-conform",t.variant){case"javascript":this.addJS("print({});");break;case"non-conform":default:this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+e+" 0 R")})}return this},function(t){var e=function(){var n=void 0;Object.defineProperty(this,"pdf",{get:function(){return n},set:function(i){n=i}});var r=150;Object.defineProperty(this,"width",{get:function(){return r},set:function(i){r=isNaN(i)||Number.isInteger(i)===!1||i<0?150:i,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=r+1)}});var s=300;Object.defineProperty(this,"height",{get:function(){return s},set:function(i){s=isNaN(i)||Number.isInteger(i)===!1||i<0?300:i,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=s+1)}});var l=[];Object.defineProperty(this,"childNodes",{get:function(){return l},set:function(i){l=i}});var f={};Object.defineProperty(this,"style",{get:function(){return f},set:function(i){f=i}}),Object.defineProperty(this,"parentNode",{})};e.prototype.getContext=function(n,r){var s;if((n=n||"2d")!=="2d")return null;for(s in r)this.pdf.context2d.hasOwnProperty(s)&&(this.pdf.context2d[s]=r[s]);return this.pdf.context2d._canvas=this,this.pdf.context2d},e.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},t.events.push(["initialized",function(){this.canvas=new e,this.canvas.pdf=this}])}(Ui.API),function(t){var e={left:0,top:0,bottom:0,right:0},n=!1,r=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},e),this.internal.__cell__.margins.width=this.getPageWidth(),s.call(this))},s=function(){this.internal.__cell__.lastCell=new l,this.internal.__cell__.pages=1},l=function(){var x=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return x},set:function(G){x=G}});var S=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return S},set:function(G){S=G}});var I=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return I},set:function(G){I=G}});var R=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return R},set:function(G){R=G}});var F=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return F},set:function(G){F=G}});var j=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return j},set:function(G){j=G}});var H=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return H},set:function(G){H=G}}),this};l.prototype.clone=function(){return new l(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},l.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},t.setHeaderFunction=function(x){return r.call(this),this.internal.__cell__.headerFunction=typeof x=="function"?x:void 0,this},t.getTextDimensions=function(x,S){r.call(this);var I=(S=S||{}).fontSize||this.getFontSize(),R=S.font||this.getFont(),F=S.scaleFactor||this.internal.scaleFactor,j=0,H=0,G=0,W=this;if(!Array.isArray(x)&&typeof x!="string"){if(typeof x!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");x=String(x)}var J=S.maxWidth;J>0?typeof x=="string"?x=this.splitTextToSize(x,J):Object.prototype.toString.call(x)==="[object Array]"&&(x=x.reduce(function(he,ge){return he.concat(W.splitTextToSize(ge,J))},[])):x=Array.isArray(x)?x:[x];for(var ie=0;ie<x.length;ie++)j<(G=this.getStringUnitWidth(x[ie],{font:R})*I)&&(j=G);return j!==0&&(H=x.length),{w:j/=F,h:Math.max((H*I*this.getLineHeightFactor()-I*(this.getLineHeightFactor()-1))/F,0)}},t.cellAddPage=function(){r.call(this),this.addPage();var x=this.internal.__cell__.margins||e;return this.internal.__cell__.lastCell=new l(x.left,x.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var f=t.cell=function(){var x;x=arguments[0]instanceof l?arguments[0]:new l(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),r.call(this);var S=this.internal.__cell__.lastCell,I=this.internal.__cell__.padding,R=this.internal.__cell__.margins||e,F=this.internal.__cell__.tableHeaderRow,j=this.internal.__cell__.printHeaders;return S.lineNumber!==void 0&&(S.lineNumber===x.lineNumber?(x.x=(S.x||0)+(S.width||0),x.y=S.y||0):S.y+S.height+x.height+R.bottom>this.getPageHeight()?(this.cellAddPage(),x.y=R.top,j&&F&&(this.printHeaderRow(x.lineNumber,!0),x.y+=F[0].height)):x.y=S.y+S.height||x.y),x.text[0]!==void 0&&(this.rect(x.x,x.y,x.width,x.height,n===!0?"FD":void 0),x.align==="right"?this.text(x.text,x.x+x.width-I,x.y+I,{align:"right",baseline:"top"}):x.align==="center"?this.text(x.text,x.x+x.width/2,x.y+I,{align:"center",baseline:"top",maxWidth:x.width-I-I}):this.text(x.text,x.x+I,x.y+I,{align:"left",baseline:"top",maxWidth:x.width-I-I})),this.internal.__cell__.lastCell=x,this};t.table=function(x,S,I,R,F){if(r.call(this),!I)throw new Error("No data for PDF table.");var j,H,G,W,J=[],ie=[],he=[],ge={},fe={},ye=[],pe=[],be=(F=F||{}).autoSize||!1,Ae=F.printHeaders!==!1,Oe=F.css&&F.css["font-size"]!==void 0?16*F.css["font-size"]:F.fontSize||12,ue=F.margins||Object.assign({width:this.getPageWidth()},e),we=typeof F.padding=="number"?F.padding:3,ke=F.headerBackgroundColor||"#c8c8c8",De=F.headerTextColor||"#000";if(s.call(this),this.internal.__cell__.printHeaders=Ae,this.internal.__cell__.margins=ue,this.internal.__cell__.table_font_size=Oe,this.internal.__cell__.padding=we,this.internal.__cell__.headerBackgroundColor=ke,this.internal.__cell__.headerTextColor=De,this.setFontSize(Oe),R==null)ie=J=Object.keys(I[0]),he=J.map(function(){return"left"});else if(Array.isArray(R)&&ks(R[0])==="object")for(J=R.map(function(Be){return Be.name}),ie=R.map(function(Be){return Be.prompt||Be.name||""}),he=R.map(function(Be){return Be.align||"left"}),j=0;j<R.length;j+=1)fe[R[j].name]=R[j].width*(19.049976/25.4);else Array.isArray(R)&&typeof R[0]=="string"&&(ie=J=R,he=J.map(function(){return"left"}));if(be||Array.isArray(R)&&typeof R[0]=="string")for(j=0;j<J.length;j+=1){for(ge[W=J[j]]=I.map(function(Be){return Be[W]}),this.setFont(void 0,"bold"),ye.push(this.getTextDimensions(ie[j],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),H=ge[W],this.setFont(void 0,"normal"),G=0;G<H.length;G+=1)ye.push(this.getTextDimensions(H[G],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);fe[W]=Math.max.apply(null,ye)+we+we,ye=[]}if(Ae){var je={};for(j=0;j<J.length;j+=1)je[J[j]]={},je[J[j]].text=ie[j],je[J[j]].align=he[j];var ze=i.call(this,je,fe);pe=J.map(function(Be){return new l(x,S,fe[Be],ze,je[Be].text,void 0,je[Be].align)}),this.setTableHeaderRow(pe),this.printHeaderRow(1,!1)}var Ue=R.reduce(function(Be,bt){return Be[bt.name]=bt.align,Be},{});for(j=0;j<I.length;j+=1){"rowStart"in F&&F.rowStart instanceof Function&&F.rowStart({row:j,data:I[j]},this);var Fe=i.call(this,I[j],fe);for(G=0;G<J.length;G+=1){var Qe=I[j][J[G]];"cellStart"in F&&F.cellStart instanceof Function&&F.cellStart({row:j,col:G,data:Qe},this),f.call(this,new l(x,S,fe[J[G]],Fe,Qe,j+2,Ue[J[G]]))}}return this.internal.__cell__.table_x=x,this.internal.__cell__.table_y=S,this};var i=function(x,S){var I=this.internal.__cell__.padding,R=this.internal.__cell__.table_font_size,F=this.internal.scaleFactor;return Object.keys(x).map(function(j){var H=x[j];return this.splitTextToSize(H.hasOwnProperty("text")?H.text:H,S[j]-I-I)},this).map(function(j){return this.getLineHeightFactor()*j.length*R/F+I+I},this).reduce(function(j,H){return Math.max(j,H)},0)};t.setTableHeaderRow=function(x){r.call(this),this.internal.__cell__.tableHeaderRow=x},t.printHeaderRow=function(x,S){if(r.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var I;if(n=!0,typeof this.internal.__cell__.headerFunction=="function"){var R=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new l(R[0],R[1],R[2],R[3],void 0,-1)}this.setFont(void 0,"bold");for(var F=[],j=0;j<this.internal.__cell__.tableHeaderRow.length;j+=1){I=this.internal.__cell__.tableHeaderRow[j].clone(),S&&(I.y=this.internal.__cell__.margins.top||0,F.push(I)),I.lineNumber=x;var H=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),f.call(this,I),this.setTextColor(H)}F.length>0&&this.setTableHeaderRow(F),this.setFont(void 0,"normal"),n=!1}}(Ui.API);var PJ={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},OJ=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],kD=IJ(OJ),RJ=[100,200,300,400,500,600,700,800,900],OEe=IJ(RJ);function ND(t){var e=t.family.replace(/"|'/g,"").toLowerCase(),n=function(l){return PJ[l=l||"normal"]?l:"normal"}(t.style),r=function(l){if(!l)return 400;if(typeof l=="number")return l>=100&&l<=900&&l%100==0?l:400;if(/^\d00$/.test(l))return parseInt(l);switch(l){case"bold":return 700;case"normal":default:return 400}}(t.weight),s=function(l){return typeof kD[l=l||"normal"]=="number"?l:"normal"}(t.stretch);return{family:e,style:n,weight:r,stretch:s,src:t.src||[],ref:t.ref||{name:e,style:[s,n,r].join(" ")}}}function v$(t,e,n,r){var s;for(s=n;s>=0&&s<e.length;s+=r)if(t[e[s]])return t[e[s]];for(s=n;s>=0&&s<e.length;s-=r)if(t[e[s]])return t[e[s]]}var REe={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},b$={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function x$(t){return[t.stretch,t.style,t.weight,t.family].join(" ")}function DEe(t,e,n){for(var r=(n=n||{}).defaultFontFamily||"times",s=Object.assign({},REe,n.genericFontFamilies||{}),l=null,f=null,i=0;i<e.length;++i)if(s[(l=ND(e[i])).family]&&(l.family=s[l.family]),t.hasOwnProperty(l.family)){f=t[l.family];break}if(!(f=f||t[r]))throw new Error("Could not find a font-family for the rule '"+x$(l)+"' and default family '"+r+"'.");if(f=function(x,S){if(S[x])return S[x];var I=kD[x],R=I<=kD.normal?-1:1,F=v$(S,OJ,I,R);if(!F)throw new Error("Could not find a matching font-stretch value for "+x);return F}(l.stretch,f),f=function(x,S){if(S[x])return S[x];for(var I=PJ[x],R=0;R<I.length;++R)if(S[I[R]])return S[I[R]];throw new Error("Could not find a matching font-style for "+x)}(l.style,f),!(f=function(x,S){if(S[x])return S[x];if(x===400&&S[500])return S[500];if(x===500&&S[400])return S[400];var I=OEe[x],R=v$(S,RJ,I,x<400?-1:1);if(!R)throw new Error("Could not find a matching font-weight for value "+x);return R}(l.weight,f)))throw new Error("Failed to resolve a font for the rule '"+x$(l)+"'.");return f}function w$(t){return t.trimLeft()}function LEe(t,e){for(var n=0;n<t.length;){if(t.charAt(n)===e)return[t.substring(0,n),t.substring(n+1)];n+=1}return null}function kEe(t){var e=t.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return e===null?null:[e[0],t.substring(e[0].length)]}var dA,S$,A$,c4=["times"];(function(t){var e,n,r,s,l,f,i,x,S,I=function(xe){return xe=xe||{},this.isStrokeTransparent=xe.isStrokeTransparent||!1,this.strokeOpacity=xe.strokeOpacity||1,this.strokeStyle=xe.strokeStyle||"#000000",this.fillStyle=xe.fillStyle||"#000000",this.isFillTransparent=xe.isFillTransparent||!1,this.fillOpacity=xe.fillOpacity||1,this.font=xe.font||"10px sans-serif",this.textBaseline=xe.textBaseline||"alphabetic",this.textAlign=xe.textAlign||"left",this.lineWidth=xe.lineWidth||1,this.lineJoin=xe.lineJoin||"miter",this.lineCap=xe.lineCap||"butt",this.path=xe.path||[],this.transform=xe.transform!==void 0?xe.transform.clone():new x,this.globalCompositeOperation=xe.globalCompositeOperation||"normal",this.globalAlpha=xe.globalAlpha||1,this.clip_path=xe.clip_path||[],this.currentPoint=xe.currentPoint||new f,this.miterLimit=xe.miterLimit||10,this.lastPoint=xe.lastPoint||new f,this.lineDashOffset=xe.lineDashOffset||0,this.lineDash=xe.lineDash||[],this.margin=xe.margin||[0,0,0,0],this.prevPageLastElemOffset=xe.prevPageLastElemOffset||0,this.ignoreClearRect=typeof xe.ignoreClearRect!="boolean"||xe.ignoreClearRect,this};t.events.push(["initialized",function(){this.context2d=new R(this),e=this.internal.f2,n=this.internal.getCoordinateString,r=this.internal.getVerticalCoordinateString,s=this.internal.getHorizontalCoordinate,l=this.internal.getVerticalCoordinate,f=this.internal.Point,i=this.internal.Rectangle,x=this.internal.Matrix,S=new I}]);var R=function(xe){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var Le=xe;Object.defineProperty(this,"pdf",{get:function(){return Le}});var Xe=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return Xe},set:function(cn){Xe=!!cn}});var ct=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return ct},set:function(cn){ct=!!cn}});var vt=0;Object.defineProperty(this,"posX",{get:function(){return vt},set:function(cn){isNaN(cn)||(vt=cn)}});var Nt=0;Object.defineProperty(this,"posY",{get:function(){return Nt},set:function(cn){isNaN(cn)||(Nt=cn)}}),Object.defineProperty(this,"margin",{get:function(){return S.margin},set:function(cn){var At;typeof cn=="number"?At=[cn,cn,cn,cn]:((At=new Array(4))[0]=cn[0],At[1]=cn.length>=2?cn[1]:At[0],At[2]=cn.length>=3?cn[2]:At[0],At[3]=cn.length>=4?cn[3]:At[1]),S.margin=At}});var mt=!1;Object.defineProperty(this,"autoPaging",{get:function(){return mt},set:function(cn){mt=cn}});var yt=0;Object.defineProperty(this,"lastBreak",{get:function(){return yt},set:function(cn){yt=cn}});var _e=[];Object.defineProperty(this,"pageBreaks",{get:function(){return _e},set:function(cn){_e=cn}}),Object.defineProperty(this,"ctx",{get:function(){return S},set:function(cn){cn instanceof I&&(S=cn)}}),Object.defineProperty(this,"path",{get:function(){return S.path},set:function(cn){S.path=cn}});var on=[];Object.defineProperty(this,"ctxStack",{get:function(){return on},set:function(cn){on=cn}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(cn){var At;At=F(cn),this.ctx.fillStyle=At.style,this.ctx.isFillTransparent=At.a===0,this.ctx.fillOpacity=At.a,this.pdf.setFillColor(At.r,At.g,At.b,{a:At.a}),this.pdf.setTextColor(At.r,At.g,At.b,{a:At.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(cn){var At=F(cn);this.ctx.strokeStyle=At.style,this.ctx.isStrokeTransparent=At.a===0,this.ctx.strokeOpacity=At.a,At.a===0?this.pdf.setDrawColor(255,255,255):(At.a,this.pdf.setDrawColor(At.r,At.g,At.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(cn){["butt","round","square"].indexOf(cn)!==-1&&(this.ctx.lineCap=cn,this.pdf.setLineCap(cn))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(cn){isNaN(cn)||(this.ctx.lineWidth=cn,this.pdf.setLineWidth(cn))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(cn){["bevel","round","miter"].indexOf(cn)!==-1&&(this.ctx.lineJoin=cn,this.pdf.setLineJoin(cn))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(cn){isNaN(cn)||(this.ctx.miterLimit=cn,this.pdf.setMiterLimit(cn))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(cn){this.ctx.textBaseline=cn}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(cn){["right","end","center","left","start"].indexOf(cn)!==-1&&(this.ctx.textAlign=cn)}});var Kt=null;function Pn(cn,At){if(Kt===null){var xr=function(Rn){var Dn=[];return Object.keys(Rn).forEach(function(ar){Rn[ar].forEach(function(hr){var ur=null;switch(hr){case"bold":ur={family:ar,weight:"bold"};break;case"italic":ur={family:ar,style:"italic"};break;case"bolditalic":ur={family:ar,weight:"bold",style:"italic"};break;case"":case"normal":ur={family:ar}}ur!==null&&(ur.ref={name:ar,style:hr},Dn.push(ur))})}),Dn}(cn.getFontList());Kt=function(Rn){for(var Dn={},ar=0;ar<Rn.length;++ar){var hr=ND(Rn[ar]),ur=hr.family,Ir=hr.stretch,Un=hr.style,Vr=hr.weight;Dn[ur]=Dn[ur]||{},Dn[ur][Ir]=Dn[ur][Ir]||{},Dn[ur][Ir][Un]=Dn[ur][Ir][Un]||{},Dn[ur][Ir][Un][Vr]=hr}return Dn}(xr.concat(At))}return Kt}var Ut=null;Object.defineProperty(this,"fontFaces",{get:function(){return Ut},set:function(cn){Kt=null,Ut=cn}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(cn){var At;if(this.ctx.font=cn,(At=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(cn))!==null){var xr=At[1];At[2];var Rn=At[3],Dn=At[4];At[5];var ar=At[6],hr=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(Dn)[2];Dn=Math.floor(hr==="px"?parseFloat(Dn)*this.pdf.internal.scaleFactor:hr==="em"?parseFloat(Dn)*this.pdf.getFontSize():parseFloat(Dn)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(Dn);var ur=function(xn){var Xn,hn,er=[],yr=xn.trim();if(yr==="")return c4;if(yr in b$)return[b$[yr]];for(;yr!=="";){switch(hn=null,Xn=(yr=w$(yr)).charAt(0)){case'"':case"'":hn=LEe(yr.substring(1),Xn);break;default:hn=kEe(yr)}if(hn===null||(er.push(hn[0]),(yr=w$(hn[1]))!==""&&yr.charAt(0)!==","))return c4;yr=yr.replace(/^,/,"")}return er}(ar);if(this.fontFaces){var Ir=DEe(Pn(this.pdf,this.fontFaces),ur.map(function(xn){return{family:xn,stretch:"normal",weight:Rn,style:xr}}));this.pdf.setFont(Ir.ref.name,Ir.ref.style)}else{var Un="";(Rn==="bold"||parseInt(Rn,10)>=700||xr==="bold")&&(Un="bold"),xr==="italic"&&(Un+="italic"),Un.length===0&&(Un="normal");for(var Vr="",pi={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},Li=0;Li<ur.length;Li++){if(this.pdf.internal.getFont(ur[Li],Un,{noFallback:!0,disableWarning:!0})!==void 0){Vr=ur[Li];break}if(Un==="bolditalic"&&this.pdf.internal.getFont(ur[Li],"bold",{noFallback:!0,disableWarning:!0})!==void 0)Vr=ur[Li],Un="bold";else if(this.pdf.internal.getFont(ur[Li],"normal",{noFallback:!0,disableWarning:!0})!==void 0){Vr=ur[Li],Un="normal";break}}if(Vr===""){for(var wi=0;wi<ur.length;wi++)if(pi[ur[wi]]){Vr=pi[ur[wi]];break}}Vr=Vr===""?"Times":Vr,this.pdf.setFont(Vr,Un)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(cn){this.ctx.globalCompositeOperation=cn}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(cn){this.ctx.globalAlpha=cn}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(cn){this.ctx.lineDashOffset=cn,bt.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(cn){this.ctx.lineDash=cn,bt.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(cn){this.ctx.ignoreClearRect=!!cn}})};R.prototype.setLineDash=function(xe){this.lineDash=xe},R.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},R.prototype.fill=function(){ge.call(this,"fill",!1)},R.prototype.stroke=function(){ge.call(this,"stroke",!1)},R.prototype.beginPath=function(){this.path=[{type:"begin"}]},R.prototype.moveTo=function(xe,Le){if(isNaN(xe)||isNaN(Le))throw ro.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var Xe=this.ctx.transform.applyToPoint(new f(xe,Le));this.path.push({type:"mt",x:Xe.x,y:Xe.y}),this.ctx.lastPoint=new f(xe,Le)},R.prototype.closePath=function(){var xe=new f(0,0),Le=0;for(Le=this.path.length-1;Le!==-1;Le--)if(this.path[Le].type==="begin"&&ks(this.path[Le+1])==="object"&&typeof this.path[Le+1].x=="number"){xe=new f(this.path[Le+1].x,this.path[Le+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new f(xe.x,xe.y)},R.prototype.lineTo=function(xe,Le){if(isNaN(xe)||isNaN(Le))throw ro.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var Xe=this.ctx.transform.applyToPoint(new f(xe,Le));this.path.push({type:"lt",x:Xe.x,y:Xe.y}),this.ctx.lastPoint=new f(Xe.x,Xe.y)},R.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),ge.call(this,null,!0)},R.prototype.quadraticCurveTo=function(xe,Le,Xe,ct){if(isNaN(Xe)||isNaN(ct)||isNaN(xe)||isNaN(Le))throw ro.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var vt=this.ctx.transform.applyToPoint(new f(Xe,ct)),Nt=this.ctx.transform.applyToPoint(new f(xe,Le));this.path.push({type:"qct",x1:Nt.x,y1:Nt.y,x:vt.x,y:vt.y}),this.ctx.lastPoint=new f(vt.x,vt.y)},R.prototype.bezierCurveTo=function(xe,Le,Xe,ct,vt,Nt){if(isNaN(vt)||isNaN(Nt)||isNaN(xe)||isNaN(Le)||isNaN(Xe)||isNaN(ct))throw ro.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var mt=this.ctx.transform.applyToPoint(new f(vt,Nt)),yt=this.ctx.transform.applyToPoint(new f(xe,Le)),_e=this.ctx.transform.applyToPoint(new f(Xe,ct));this.path.push({type:"bct",x1:yt.x,y1:yt.y,x2:_e.x,y2:_e.y,x:mt.x,y:mt.y}),this.ctx.lastPoint=new f(mt.x,mt.y)},R.prototype.arc=function(xe,Le,Xe,ct,vt,Nt){if(isNaN(xe)||isNaN(Le)||isNaN(Xe)||isNaN(ct)||isNaN(vt))throw ro.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(Nt=!!Nt,!this.ctx.transform.isIdentity){var mt=this.ctx.transform.applyToPoint(new f(xe,Le));xe=mt.x,Le=mt.y;var yt=this.ctx.transform.applyToPoint(new f(0,Xe)),_e=this.ctx.transform.applyToPoint(new f(0,0));Xe=Math.sqrt(Math.pow(yt.x-_e.x,2)+Math.pow(yt.y-_e.y,2))}Math.abs(vt-ct)>=2*Math.PI&&(ct=0,vt=2*Math.PI),this.path.push({type:"arc",x:xe,y:Le,radius:Xe,startAngle:ct,endAngle:vt,counterclockwise:Nt})},R.prototype.arcTo=function(xe,Le,Xe,ct,vt){throw new Error("arcTo not implemented.")},R.prototype.rect=function(xe,Le,Xe,ct){if(isNaN(xe)||isNaN(Le)||isNaN(Xe)||isNaN(ct))throw ro.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(xe,Le),this.lineTo(xe+Xe,Le),this.lineTo(xe+Xe,Le+ct),this.lineTo(xe,Le+ct),this.lineTo(xe,Le),this.lineTo(xe+Xe,Le),this.lineTo(xe,Le)},R.prototype.fillRect=function(xe,Le,Xe,ct){if(isNaN(xe)||isNaN(Le)||isNaN(Xe)||isNaN(ct))throw ro.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!j.call(this)){var vt={};this.lineCap!=="butt"&&(vt.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(vt.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(xe,Le,Xe,ct),this.fill(),vt.hasOwnProperty("lineCap")&&(this.lineCap=vt.lineCap),vt.hasOwnProperty("lineJoin")&&(this.lineJoin=vt.lineJoin)}},R.prototype.strokeRect=function(xe,Le,Xe,ct){if(isNaN(xe)||isNaN(Le)||isNaN(Xe)||isNaN(ct))throw ro.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");H.call(this)||(this.beginPath(),this.rect(xe,Le,Xe,ct),this.stroke())},R.prototype.clearRect=function(xe,Le,Xe,ct){if(isNaN(xe)||isNaN(Le)||isNaN(Xe)||isNaN(ct))throw ro.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(xe,Le,Xe,ct))},R.prototype.save=function(xe){xe=typeof xe!="boolean"||xe;for(var Le=this.pdf.internal.getCurrentPageInfo().pageNumber,Xe=0;Xe<this.pdf.internal.getNumberOfPages();Xe++)this.pdf.setPage(Xe+1),this.pdf.internal.out("q");if(this.pdf.setPage(Le),xe){this.ctx.fontSize=this.pdf.internal.getFontSize();var ct=new I(this.ctx);this.ctxStack.push(this.ctx),this.ctx=ct}},R.prototype.restore=function(xe){xe=typeof xe!="boolean"||xe;for(var Le=this.pdf.internal.getCurrentPageInfo().pageNumber,Xe=0;Xe<this.pdf.internal.getNumberOfPages();Xe++)this.pdf.setPage(Xe+1),this.pdf.internal.out("Q");this.pdf.setPage(Le),xe&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},R.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var F=function(xe){var Le,Xe,ct,vt;if(xe.isCanvasGradient===!0&&(xe=xe.getColor()),!xe)return{r:0,g:0,b:0,a:0,style:xe};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(xe))Le=0,Xe=0,ct=0,vt=0;else{var Nt=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(xe);if(Nt!==null)Le=parseInt(Nt[1]),Xe=parseInt(Nt[2]),ct=parseInt(Nt[3]),vt=1;else if((Nt=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(xe))!==null)Le=parseInt(Nt[1]),Xe=parseInt(Nt[2]),ct=parseInt(Nt[3]),vt=parseFloat(Nt[4]);else{if(vt=1,typeof xe=="string"&&xe.charAt(0)!=="#"){var mt=new SJ(xe);xe=mt.ok?mt.toHex():"#000000"}xe.length===4?(Le=xe.substring(1,2),Le+=Le,Xe=xe.substring(2,3),Xe+=Xe,ct=xe.substring(3,4),ct+=ct):(Le=xe.substring(1,3),Xe=xe.substring(3,5),ct=xe.substring(5,7)),Le=parseInt(Le,16),Xe=parseInt(Xe,16),ct=parseInt(ct,16)}}return{r:Le,g:Xe,b:ct,a:vt,style:xe}},j=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},H=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};R.prototype.fillText=function(xe,Le,Xe,ct){if(isNaN(Le)||isNaN(Xe)||typeof xe!="string")throw ro.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(ct=isNaN(ct)?void 0:ct,!j.call(this)){var vt=Fe(this.ctx.transform.rotation),Nt=this.ctx.transform.scaleX;we.call(this,{text:xe,x:Le,y:Xe,scale:Nt,angle:vt,align:this.textAlign,maxWidth:ct})}},R.prototype.strokeText=function(xe,Le,Xe,ct){if(isNaN(Le)||isNaN(Xe)||typeof xe!="string")throw ro.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!H.call(this)){ct=isNaN(ct)?void 0:ct;var vt=Fe(this.ctx.transform.rotation),Nt=this.ctx.transform.scaleX;we.call(this,{text:xe,x:Le,y:Xe,scale:Nt,renderingMode:"stroke",angle:vt,align:this.textAlign,maxWidth:ct})}},R.prototype.measureText=function(xe){if(typeof xe!="string")throw ro.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var Le=this.pdf,Xe=this.pdf.internal.scaleFactor,ct=Le.internal.getFontSize(),vt=Le.getStringUnitWidth(xe)*ct/Le.internal.scaleFactor,Nt=function(mt){var yt=(mt=mt||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return yt}}),this};return new Nt({width:vt*=Math.round(96*Xe/72*1e4)/1e4})},R.prototype.scale=function(xe,Le){if(isNaN(xe)||isNaN(Le))throw ro.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var Xe=new x(xe,0,0,Le,0,0);this.ctx.transform=this.ctx.transform.multiply(Xe)},R.prototype.rotate=function(xe){if(isNaN(xe))throw ro.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var Le=new x(Math.cos(xe),Math.sin(xe),-Math.sin(xe),Math.cos(xe),0,0);this.ctx.transform=this.ctx.transform.multiply(Le)},R.prototype.translate=function(xe,Le){if(isNaN(xe)||isNaN(Le))throw ro.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var Xe=new x(1,0,0,1,xe,Le);this.ctx.transform=this.ctx.transform.multiply(Xe)},R.prototype.transform=function(xe,Le,Xe,ct,vt,Nt){if(isNaN(xe)||isNaN(Le)||isNaN(Xe)||isNaN(ct)||isNaN(vt)||isNaN(Nt))throw ro.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var mt=new x(xe,Le,Xe,ct,vt,Nt);this.ctx.transform=this.ctx.transform.multiply(mt)},R.prototype.setTransform=function(xe,Le,Xe,ct,vt,Nt){xe=isNaN(xe)?1:xe,Le=isNaN(Le)?0:Le,Xe=isNaN(Xe)?0:Xe,ct=isNaN(ct)?1:ct,vt=isNaN(vt)?0:vt,Nt=isNaN(Nt)?0:Nt,this.ctx.transform=new x(xe,Le,Xe,ct,vt,Nt)};var G=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};R.prototype.drawImage=function(xe,Le,Xe,ct,vt,Nt,mt,yt,_e){var on=this.pdf.getImageProperties(xe),Kt=1,Pn=1,Ut=1,cn=1;ct!==void 0&&yt!==void 0&&(Ut=yt/ct,cn=_e/vt,Kt=on.width/ct*yt/ct,Pn=on.height/vt*_e/vt),Nt===void 0&&(Nt=Le,mt=Xe,Le=0,Xe=0),ct!==void 0&&yt===void 0&&(yt=ct,_e=vt),ct===void 0&&yt===void 0&&(yt=on.width,_e=on.height);for(var At,xr=this.ctx.transform.decompose(),Rn=Fe(xr.rotate.shx),Dn=new x,ar=(Dn=(Dn=(Dn=Dn.multiply(xr.translate)).multiply(xr.skew)).multiply(xr.scale)).applyToRectangle(new i(Nt-Le*Ut,mt-Xe*cn,ct*Kt,vt*Pn)),hr=W.call(this,ar),ur=[],Ir=0;Ir<hr.length;Ir+=1)ur.indexOf(hr[Ir])===-1&&ur.push(hr[Ir]);if(he(ur),this.autoPaging)for(var Un=ur[0],Vr=ur[ur.length-1],pi=Un;pi<Vr+1;pi++){this.pdf.setPage(pi);var Li=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],wi=pi===1?this.posY+this.margin[0]:this.margin[0],xn=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Xn=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],hn=pi===1?0:xn+(pi-2)*Xn;if(this.ctx.clip_path.length!==0){var er=this.path;At=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=ie(At,this.posX+this.margin[3],-hn+wi+this.ctx.prevPageLastElemOffset),fe.call(this,"fill",!0),this.path=er}var yr=JSON.parse(JSON.stringify(ar));yr=ie([yr],this.posX+this.margin[3],-hn+wi+this.ctx.prevPageLastElemOffset)[0];var Vi=(pi>Un||pi<Vr)&&G.call(this);Vi&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Li,Xn,null).clip().discardPath()),this.pdf.addImage(xe,"JPEG",yr.x,yr.y,yr.w,yr.h,null,null,Rn),Vi&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(xe,"JPEG",ar.x,ar.y,ar.w,ar.h,null,null,Rn)};var W=function(xe,Le,Xe){var ct=[];Le=Le||this.pdf.internal.pageSize.width,Xe=Xe||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var vt=this.posY+this.ctx.prevPageLastElemOffset;switch(xe.type){default:case"mt":case"lt":ct.push(Math.floor((xe.y+vt)/Xe)+1);break;case"arc":ct.push(Math.floor((xe.y+vt-xe.radius)/Xe)+1),ct.push(Math.floor((xe.y+vt+xe.radius)/Xe)+1);break;case"qct":var Nt=Qe(this.ctx.lastPoint.x,this.ctx.lastPoint.y,xe.x1,xe.y1,xe.x,xe.y);ct.push(Math.floor((Nt.y+vt)/Xe)+1),ct.push(Math.floor((Nt.y+Nt.h+vt)/Xe)+1);break;case"bct":var mt=Be(this.ctx.lastPoint.x,this.ctx.lastPoint.y,xe.x1,xe.y1,xe.x2,xe.y2,xe.x,xe.y);ct.push(Math.floor((mt.y+vt)/Xe)+1),ct.push(Math.floor((mt.y+mt.h+vt)/Xe)+1);break;case"rect":ct.push(Math.floor((xe.y+vt)/Xe)+1),ct.push(Math.floor((xe.y+xe.h+vt)/Xe)+1)}for(var yt=0;yt<ct.length;yt+=1)for(;this.pdf.internal.getNumberOfPages()<ct[yt];)J.call(this);return ct},J=function(){var xe=this.fillStyle,Le=this.strokeStyle,Xe=this.font,ct=this.lineCap,vt=this.lineWidth,Nt=this.lineJoin;this.pdf.addPage(),this.fillStyle=xe,this.strokeStyle=Le,this.font=Xe,this.lineCap=ct,this.lineWidth=vt,this.lineJoin=Nt},ie=function(xe,Le,Xe){for(var ct=0;ct<xe.length;ct++)switch(xe[ct].type){case"bct":xe[ct].x2+=Le,xe[ct].y2+=Xe;case"qct":xe[ct].x1+=Le,xe[ct].y1+=Xe;case"mt":case"lt":case"arc":default:xe[ct].x+=Le,xe[ct].y+=Xe}return xe},he=function(xe){return xe.sort(function(Le,Xe){return Le-Xe})},ge=function(xe,Le){for(var Xe,ct,vt=this.fillStyle,Nt=this.strokeStyle,mt=this.lineCap,yt=this.lineWidth,_e=Math.abs(yt*this.ctx.transform.scaleX),on=this.lineJoin,Kt=JSON.parse(JSON.stringify(this.path)),Pn=JSON.parse(JSON.stringify(this.path)),Ut=[],cn=0;cn<Pn.length;cn++)if(Pn[cn].x!==void 0)for(var At=W.call(this,Pn[cn]),xr=0;xr<At.length;xr+=1)Ut.indexOf(At[xr])===-1&&Ut.push(At[xr]);for(var Rn=0;Rn<Ut.length;Rn++)for(;this.pdf.internal.getNumberOfPages()<Ut[Rn];)J.call(this);if(he(Ut),this.autoPaging)for(var Dn=Ut[0],ar=Ut[Ut.length-1],hr=Dn;hr<ar+1;hr++){this.pdf.setPage(hr),this.fillStyle=vt,this.strokeStyle=Nt,this.lineCap=mt,this.lineWidth=_e,this.lineJoin=on;var ur=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Ir=hr===1?this.posY+this.margin[0]:this.margin[0],Un=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Vr=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],pi=hr===1?0:Un+(hr-2)*Vr;if(this.ctx.clip_path.length!==0){var Li=this.path;Xe=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=ie(Xe,this.posX+this.margin[3],-pi+Ir+this.ctx.prevPageLastElemOffset),fe.call(this,xe,!0),this.path=Li}if(ct=JSON.parse(JSON.stringify(Kt)),this.path=ie(ct,this.posX+this.margin[3],-pi+Ir+this.ctx.prevPageLastElemOffset),Le===!1||hr===0){var wi=(hr>Dn||hr<ar)&&G.call(this);wi&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],ur,Vr,null).clip().discardPath()),fe.call(this,xe,Le),wi&&this.pdf.restoreGraphicsState()}this.lineWidth=yt}else this.lineWidth=_e,fe.call(this,xe,Le),this.lineWidth=yt;this.path=Kt},fe=function(xe,Le){if((xe!=="stroke"||Le||!H.call(this))&&(xe==="stroke"||Le||!j.call(this))){for(var Xe,ct,vt=[],Nt=this.path,mt=0;mt<Nt.length;mt++){var yt=Nt[mt];switch(yt.type){case"begin":vt.push({begin:!0});break;case"close":vt.push({close:!0});break;case"mt":vt.push({start:yt,deltas:[],abs:[]});break;case"lt":var _e=vt.length;if(Nt[mt-1]&&!isNaN(Nt[mt-1].x)&&(Xe=[yt.x-Nt[mt-1].x,yt.y-Nt[mt-1].y],_e>0)){for(;_e>=0;_e--)if(vt[_e-1].close!==!0&&vt[_e-1].begin!==!0){vt[_e-1].deltas.push(Xe),vt[_e-1].abs.push(yt);break}}break;case"bct":Xe=[yt.x1-Nt[mt-1].x,yt.y1-Nt[mt-1].y,yt.x2-Nt[mt-1].x,yt.y2-Nt[mt-1].y,yt.x-Nt[mt-1].x,yt.y-Nt[mt-1].y],vt[vt.length-1].deltas.push(Xe);break;case"qct":var on=Nt[mt-1].x+2/3*(yt.x1-Nt[mt-1].x),Kt=Nt[mt-1].y+2/3*(yt.y1-Nt[mt-1].y),Pn=yt.x+2/3*(yt.x1-yt.x),Ut=yt.y+2/3*(yt.y1-yt.y),cn=yt.x,At=yt.y;Xe=[on-Nt[mt-1].x,Kt-Nt[mt-1].y,Pn-Nt[mt-1].x,Ut-Nt[mt-1].y,cn-Nt[mt-1].x,At-Nt[mt-1].y],vt[vt.length-1].deltas.push(Xe);break;case"arc":vt.push({deltas:[],abs:[],arc:!0}),Array.isArray(vt[vt.length-1].abs)&&vt[vt.length-1].abs.push(yt)}}ct=Le?null:xe==="stroke"?"stroke":"fill";for(var xr=!1,Rn=0;Rn<vt.length;Rn++)if(vt[Rn].arc)for(var Dn=vt[Rn].abs,ar=0;ar<Dn.length;ar++){var hr=Dn[ar];hr.type==="arc"?be.call(this,hr.x,hr.y,hr.radius,hr.startAngle,hr.endAngle,hr.counterclockwise,void 0,Le,!xr):ke.call(this,hr.x,hr.y),xr=!0}else if(vt[Rn].close===!0)this.pdf.internal.out("h"),xr=!1;else if(vt[Rn].begin!==!0){var ur=vt[Rn].start.x,Ir=vt[Rn].start.y;De.call(this,vt[Rn].deltas,ur,Ir),xr=!0}ct&&Ae.call(this,ct),Le&&Oe.call(this)}},ye=function(xe){var Le=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,Xe=Le*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return xe-Xe;case"top":return xe+Le-Xe;case"hanging":return xe+Le-2*Xe;case"middle":return xe+Le/2-Xe;case"ideographic":return xe;case"alphabetic":default:return xe}},pe=function(xe){return xe+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};R.prototype.createLinearGradient=function(){var xe=function(){};return xe.colorStops=[],xe.addColorStop=function(Le,Xe){this.colorStops.push([Le,Xe])},xe.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},xe.isCanvasGradient=!0,xe},R.prototype.createPattern=function(){return this.createLinearGradient()},R.prototype.createRadialGradient=function(){return this.createLinearGradient()};var be=function(xe,Le,Xe,ct,vt,Nt,mt,yt,_e){for(var on=ze.call(this,Xe,ct,vt,Nt),Kt=0;Kt<on.length;Kt++){var Pn=on[Kt];Kt===0&&(_e?ue.call(this,Pn.x1+xe,Pn.y1+Le):ke.call(this,Pn.x1+xe,Pn.y1+Le)),je.call(this,xe,Le,Pn.x2,Pn.y2,Pn.x3,Pn.y3,Pn.x4,Pn.y4)}yt?Oe.call(this):Ae.call(this,mt)},Ae=function(xe){switch(xe){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},Oe=function(){this.pdf.clip(),this.pdf.discardPath()},ue=function(xe,Le){this.pdf.internal.out(n(xe)+" "+r(Le)+" m")},we=function(xe){var Le;switch(xe.align){case"right":case"end":Le="right";break;case"center":Le="center";break;case"left":case"start":default:Le="left"}var Xe=this.pdf.getTextDimensions(xe.text),ct=ye.call(this,xe.y),vt=pe.call(this,ct)-Xe.h,Nt=this.ctx.transform.applyToPoint(new f(xe.x,ct)),mt=this.ctx.transform.decompose(),yt=new x;yt=(yt=(yt=yt.multiply(mt.translate)).multiply(mt.skew)).multiply(mt.scale);for(var _e,on,Kt,Pn=this.ctx.transform.applyToRectangle(new i(xe.x,ct,Xe.w,Xe.h)),Ut=yt.applyToRectangle(new i(xe.x,vt,Xe.w,Xe.h)),cn=W.call(this,Ut),At=[],xr=0;xr<cn.length;xr+=1)At.indexOf(cn[xr])===-1&&At.push(cn[xr]);if(he(At),this.autoPaging)for(var Rn=At[0],Dn=At[At.length-1],ar=Rn;ar<Dn+1;ar++){this.pdf.setPage(ar);var hr=ar===1?this.posY+this.margin[0]:this.margin[0],ur=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Ir=this.pdf.internal.pageSize.height-this.margin[2],Un=Ir-this.margin[0],Vr=this.pdf.internal.pageSize.width-this.margin[1],pi=Vr-this.margin[3],Li=ar===1?0:ur+(ar-2)*Un;if(this.ctx.clip_path.length!==0){var wi=this.path;_e=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=ie(_e,this.posX+this.margin[3],-1*Li+hr),fe.call(this,"fill",!0),this.path=wi}var xn=ie([JSON.parse(JSON.stringify(Ut))],this.posX+this.margin[3],-Li+hr+this.ctx.prevPageLastElemOffset)[0];xe.scale>=.01&&(on=this.pdf.internal.getFontSize(),this.pdf.setFontSize(on*xe.scale),Kt=this.lineWidth,this.lineWidth=Kt*xe.scale);var Xn=this.autoPaging!=="text";if(Xn||xn.y+xn.h<=Ir){if(Xn||xn.y>=hr&&xn.x<=Vr){var hn=Xn?xe.text:this.pdf.splitTextToSize(xe.text,xe.maxWidth||Vr-xn.x)[0],er=ie([JSON.parse(JSON.stringify(Pn))],this.posX+this.margin[3],-Li+hr+this.ctx.prevPageLastElemOffset)[0],yr=Xn&&(ar>Rn||ar<Dn)&&G.call(this);yr&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],pi,Un,null).clip().discardPath()),this.pdf.text(hn,er.x,er.y,{angle:xe.angle,align:Le,renderingMode:xe.renderingMode}),yr&&this.pdf.restoreGraphicsState()}}else xn.y<Ir&&(this.ctx.prevPageLastElemOffset+=Ir-xn.y);xe.scale>=.01&&(this.pdf.setFontSize(on),this.lineWidth=Kt)}else xe.scale>=.01&&(on=this.pdf.internal.getFontSize(),this.pdf.setFontSize(on*xe.scale),Kt=this.lineWidth,this.lineWidth=Kt*xe.scale),this.pdf.text(xe.text,Nt.x+this.posX,Nt.y+this.posY,{angle:xe.angle,align:Le,renderingMode:xe.renderingMode,maxWidth:xe.maxWidth}),xe.scale>=.01&&(this.pdf.setFontSize(on),this.lineWidth=Kt)},ke=function(xe,Le,Xe,ct){Xe=Xe||0,ct=ct||0,this.pdf.internal.out(n(xe+Xe)+" "+r(Le+ct)+" l")},De=function(xe,Le,Xe){return this.pdf.lines(xe,Le,Xe,null,null)},je=function(xe,Le,Xe,ct,vt,Nt,mt,yt){this.pdf.internal.out([e(s(Xe+xe)),e(l(ct+Le)),e(s(vt+xe)),e(l(Nt+Le)),e(s(mt+xe)),e(l(yt+Le)),"c"].join(" "))},ze=function(xe,Le,Xe,ct){for(var vt=2*Math.PI,Nt=Math.PI/2;Le>Xe;)Le-=vt;var mt=Math.abs(Xe-Le);mt<vt&&ct&&(mt=vt-mt);for(var yt=[],_e=ct?-1:1,on=Le;mt>1e-5;){var Kt=on+_e*Math.min(mt,Nt);yt.push(Ue.call(this,xe,on,Kt)),mt-=Math.abs(Kt-on),on=Kt}return yt},Ue=function(xe,Le,Xe){var ct=(Xe-Le)/2,vt=xe*Math.cos(ct),Nt=xe*Math.sin(ct),mt=vt,yt=-Nt,_e=mt*mt+yt*yt,on=_e+mt*vt+yt*Nt,Kt=4/3*(Math.sqrt(2*_e*on)-on)/(mt*Nt-yt*vt),Pn=mt-Kt*yt,Ut=yt+Kt*mt,cn=Pn,At=-Ut,xr=ct+Le,Rn=Math.cos(xr),Dn=Math.sin(xr);return{x1:xe*Math.cos(Le),y1:xe*Math.sin(Le),x2:Pn*Rn-Ut*Dn,y2:Pn*Dn+Ut*Rn,x3:cn*Rn-At*Dn,y3:cn*Dn+At*Rn,x4:xe*Math.cos(Xe),y4:xe*Math.sin(Xe)}},Fe=function(xe){return 180*xe/Math.PI},Qe=function(xe,Le,Xe,ct,vt,Nt){var mt=xe+.5*(Xe-xe),yt=Le+.5*(ct-Le),_e=vt+.5*(Xe-vt),on=Nt+.5*(ct-Nt),Kt=Math.min(xe,vt,mt,_e),Pn=Math.max(xe,vt,mt,_e),Ut=Math.min(Le,Nt,yt,on),cn=Math.max(Le,Nt,yt,on);return new i(Kt,Ut,Pn-Kt,cn-Ut)},Be=function(xe,Le,Xe,ct,vt,Nt,mt,yt){var _e,on,Kt,Pn,Ut,cn,At,xr,Rn,Dn,ar,hr,ur,Ir,Un=Xe-xe,Vr=ct-Le,pi=vt-Xe,Li=Nt-ct,wi=mt-vt,xn=yt-Nt;for(on=0;on<41;on++)Rn=(At=(Kt=xe+(_e=on/40)*Un)+_e*((Ut=Xe+_e*pi)-Kt))+_e*(Ut+_e*(vt+_e*wi-Ut)-At),Dn=(xr=(Pn=Le+_e*Vr)+_e*((cn=ct+_e*Li)-Pn))+_e*(cn+_e*(Nt+_e*xn-cn)-xr),on==0?(ar=Rn,hr=Dn,ur=Rn,Ir=Dn):(ar=Math.min(ar,Rn),hr=Math.min(hr,Dn),ur=Math.max(ur,Rn),Ir=Math.max(Ir,Dn));return new i(Math.round(ar),Math.round(hr),Math.round(ur-ar),Math.round(Ir-hr))},bt=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var xe,Le,Xe=(xe=this.ctx.lineDash,Le=this.ctx.lineDashOffset,JSON.stringify({lineDash:xe,lineDashOffset:Le}));this.prevLineDash!==Xe&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=Xe)}}})(Ui.API),function(t){var e=function(l){var f,i,x,S,I,R,F,j,H,G;for(i=[],x=0,S=(l+=f="\0\0\0\0".slice(l.length%4||4)).length;S>x;x+=4)(I=(l.charCodeAt(x)<<24)+(l.charCodeAt(x+1)<<16)+(l.charCodeAt(x+2)<<8)+l.charCodeAt(x+3))!==0?(R=(I=((I=((I=((I=(I-(G=I%85))/85)-(H=I%85))/85)-(j=I%85))/85)-(F=I%85))/85)%85,i.push(R+33,F+33,j+33,H+33,G+33)):i.push(122);return function(W,J){for(var ie=J;ie>0;ie--)W.pop()}(i,f.length),String.fromCharCode.apply(String,i)+"~>"},n=function(l){var f,i,x,S,I,R=String,F="length",j=255,H="charCodeAt",G="slice",W="replace";for(l[G](-2),l=l[G](0,-2)[W](/\s/g,"")[W]("z","!!!!!"),x=[],S=0,I=(l+=f="uuuuu"[G](l[F]%5||5))[F];I>S;S+=5)i=52200625*(l[H](S)-33)+614125*(l[H](S+1)-33)+7225*(l[H](S+2)-33)+85*(l[H](S+3)-33)+(l[H](S+4)-33),x.push(j&i>>24,j&i>>16,j&i>>8,j&i);return function(J,ie){for(var he=ie;he>0;he--)J.pop()}(x,f[F]),R.fromCharCode.apply(R,x)},r=function(l){var f=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((l=l.replace(/\s/g,"")).indexOf(">")!==-1&&(l=l.substr(0,l.indexOf(">"))),l.length%2&&(l+="0"),f.test(l)===!1)return"";for(var i="",x=0;x<l.length;x+=2)i+=String.fromCharCode("0x"+(l[x]+l[x+1]));return i},s=function(l){for(var f=new Uint8Array(l.length),i=l.length;i--;)f[i]=l.charCodeAt(i);return l=(f=PD(f)).reduce(function(x,S){return x+String.fromCharCode(S)},"")};t.processDataByFilters=function(l,f){var i=0,x=l||"",S=[];for(typeof(f=f||[])=="string"&&(f=[f]),i=0;i<f.length;i+=1)switch(f[i]){case"ASCII85Decode":case"/ASCII85Decode":x=n(x),S.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":x=e(x),S.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":x=r(x),S.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":x=x.split("").map(function(I){return("0"+I.charCodeAt().toString(16)).slice(-2)}).join("")+">",S.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":x=s(x),S.push("/FlateDecode");break;default:throw new Error('The filter: "'+f[i]+'" is not implemented')}return{data:x,reverseChain:S.reverse().join(" ")}}}(Ui.API),function(t){t.loadFile=function(e,n,r){return function(s,l,f){l=l!==!1,f=typeof f=="function"?f:function(){};var i=void 0;try{i=function(x,S,I){var R=new XMLHttpRequest,F=0,j=function(H){var G=H.length,W=[],J=String.fromCharCode;for(F=0;F<G;F+=1)W.push(J(255&H.charCodeAt(F)));return W.join("")};if(R.open("GET",x,!S),R.overrideMimeType("text/plain; charset=x-user-defined"),S===!1&&(R.onload=function(){R.status===200?I(j(this.responseText)):I(void 0)}),R.send(null),S&&R.status===200)return j(R.responseText)}(s,l,f)}catch{}return i}(e,n,r)},t.loadImageFile=t.loadFile}(Ui.API),function(t){function e(){return(Wi.html2canvas?Promise.resolve(Wi.html2canvas):TD(()=>import("./html2canvas.esm-CBrSDip1.js"),[])).catch(function(f){return Promise.reject(new Error("Could not load html2canvas: "+f))}).then(function(f){return f.default?f.default:f})}function n(){return(Wi.DOMPurify?Promise.resolve(Wi.DOMPurify):TD(()=>import("./purify.es-Ci5xwkH_.js"),[])).catch(function(f){return Promise.reject(new Error("Could not load dompurify: "+f))}).then(function(f){return f.default?f.default:f})}var r=function(f){var i=ks(f);return i==="undefined"?"undefined":i==="string"||f instanceof String?"string":i==="number"||f instanceof Number?"number":i==="function"||f instanceof Function?"function":f&&f.constructor===Array?"array":f&&f.nodeType===1?"element":i==="object"?"object":"unknown"},s=function(f,i){var x=document.createElement(f);for(var S in i.className&&(x.className=i.className),i.innerHTML&&i.dompurify&&(x.innerHTML=i.dompurify.sanitize(i.innerHTML)),i.style)x.style[S]=i.style[S];return x},l=function f(i){var x=Object.assign(f.convert(Promise.resolve()),JSON.parse(JSON.stringify(f.template))),S=f.convert(Promise.resolve(),x);return S=(S=S.setProgress(1,f,1,[f])).set(i)};(l.prototype=Object.create(Promise.prototype)).constructor=l,l.convert=function(f,i){return f.__proto__=i||l.prototype,f},l.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},l.prototype.from=function(f,i){return this.then(function(){switch(i=i||function(x){switch(r(x)){case"string":return"string";case"element":return x.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(f)){case"string":return this.then(n).then(function(x){return this.set({src:s("div",{innerHTML:f,dompurify:x})})});case"element":return this.set({src:f});case"canvas":return this.set({canvas:f});case"img":return this.set({img:f});default:return this.error("Unknown source type.")}})},l.prototype.to=function(f){switch(f){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},l.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var f={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},i=function x(S,I){for(var R=S.nodeType===3?document.createTextNode(S.nodeValue):S.cloneNode(!1),F=S.firstChild;F;F=F.nextSibling)I!==!0&&F.nodeType===1&&F.nodeName==="SCRIPT"||R.appendChild(x(F,I));return S.nodeType===1&&(S.nodeName==="CANVAS"?(R.width=S.width,R.height=S.height,R.getContext("2d").drawImage(S,0,0)):S.nodeName!=="TEXTAREA"&&S.nodeName!=="SELECT"||(R.value=S.value),R.addEventListener("load",function(){R.scrollTop=S.scrollTop,R.scrollLeft=S.scrollLeft},!0)),R}(this.prop.src,this.opt.html2canvas.javascriptEnabled);i.tagName==="BODY"&&(f.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=s("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=s("div",{className:"html2pdf__container",style:f}),this.prop.container.appendChild(i),this.prop.container.firstChild.appendChild(s("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},l.prototype.toCanvas=function(){var f=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(f).then(e).then(function(i){var x=Object.assign({},this.opt.html2canvas);return delete x.onrendered,i(this.prop.container,x)}).then(function(i){(this.opt.html2canvas.onrendered||function(){})(i),this.prop.canvas=i,document.body.removeChild(this.prop.overlay)})},l.prototype.toContext2d=function(){var f=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(f).then(e).then(function(i){var x=this.opt.jsPDF,S=this.opt.fontFaces,I=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,R=Object.assign({async:!0,allowTaint:!0,scale:I,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete R.onrendered,x.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,x.context2d.posX=this.opt.x,x.context2d.posY=this.opt.y,x.context2d.margin=this.opt.margin,x.context2d.fontFaces=S,S)for(var F=0;F<S.length;++F){var j=S[F],H=j.src.find(function(G){return G.format==="truetype"});H&&x.addFont(H.url,j.ref.name,j.ref.style)}return R.windowHeight=R.windowHeight||0,R.windowHeight=R.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):R.windowHeight,x.context2d.save(!0),i(this.prop.container,R)}).then(function(i){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(i),this.prop.canvas=i,document.body.removeChild(this.prop.overlay)})},l.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var f=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=f})},l.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},l.prototype.output=function(f,i,x){return(x=x||"pdf").toLowerCase()==="img"||x.toLowerCase()==="image"?this.outputImg(f,i):this.outputPdf(f,i)},l.prototype.outputPdf=function(f,i){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(f,i)})},l.prototype.outputImg=function(f){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(f){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+f+'" is not supported.'}})},l.prototype.save=function(f){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(f?{filename:f}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},l.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},l.prototype.set=function(f){if(r(f)!=="object")return this;var i=Object.keys(f||{}).map(function(x){if(x in l.template.prop)return function(){this.prop[x]=f[x]};switch(x){case"margin":return this.setMargin.bind(this,f.margin);case"jsPDF":return function(){return this.opt.jsPDF=f.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,f.pageSize);default:return function(){this.opt[x]=f[x]}}},this);return this.then(function(){return this.thenList(i)})},l.prototype.get=function(f,i){return this.then(function(){var x=f in l.template.prop?this.prop[f]:this.opt[f];return i?i(x):x})},l.prototype.setMargin=function(f){return this.then(function(){switch(r(f)){case"number":f=[f,f,f,f];case"array":if(f.length===2&&(f=[f[0],f[1],f[0],f[1]]),f.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=f}).then(this.setPageSize)},l.prototype.setPageSize=function(f){function i(x,S){return Math.floor(x*S/72*96)}return this.then(function(){(f=f||Ui.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(f.inner={width:f.width-this.opt.margin[1]-this.opt.margin[3],height:f.height-this.opt.margin[0]-this.opt.margin[2]},f.inner.px={width:i(f.inner.width,f.k),height:i(f.inner.height,f.k)},f.inner.ratio=f.inner.height/f.inner.width),this.prop.pageSize=f})},l.prototype.setProgress=function(f,i,x,S){return f!=null&&(this.progress.val=f),i!=null&&(this.progress.state=i),x!=null&&(this.progress.n=x),S!=null&&(this.progress.stack=S),this.progress.ratio=this.progress.val/this.progress.state,this},l.prototype.updateProgress=function(f,i,x,S){return this.setProgress(f?this.progress.val+f:null,i||null,x?this.progress.n+x:null,S?this.progress.stack.concat(S):null)},l.prototype.then=function(f,i){var x=this;return this.thenCore(f,i,function(S,I){return x.updateProgress(null,null,1,[S]),Promise.prototype.then.call(this,function(R){return x.updateProgress(null,S),R}).then(S,I).then(function(R){return x.updateProgress(1),R})})},l.prototype.thenCore=function(f,i,x){x=x||Promise.prototype.then,f&&(f=f.bind(this)),i&&(i=i.bind(this));var S=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?this:l.convert(Object.assign({},this),Promise.prototype),I=x.call(S,f,i);return l.convert(I,this.__proto__)},l.prototype.thenExternal=function(f,i){return Promise.prototype.then.call(this,f,i)},l.prototype.thenList=function(f){var i=this;return f.forEach(function(x){i=i.thenCore(x)}),i},l.prototype.catch=function(f){f&&(f=f.bind(this));var i=Promise.prototype.catch.call(this,f);return l.convert(i,this)},l.prototype.catchExternal=function(f){return Promise.prototype.catch.call(this,f)},l.prototype.error=function(f){return this.then(function(){throw new Error(f)})},l.prototype.using=l.prototype.set,l.prototype.saveAs=l.prototype.save,l.prototype.export=l.prototype.output,l.prototype.run=l.prototype.then,Ui.getPageSize=function(f,i,x){if(ks(f)==="object"){var S=f;f=S.orientation,i=S.unit||i,x=S.format||x}i=i||"mm",x=x||"a4",f=(""+(f||"P")).toLowerCase();var I,R=(""+x).toLowerCase(),F={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(i){case"pt":I=1;break;case"mm":I=72/25.4;break;case"cm":I=72/2.54;break;case"in":I=72;break;case"px":I=.75;break;case"pc":case"em":I=12;break;case"ex":I=6;break;default:throw"Invalid unit: "+i}var j,H=0,G=0;if(F.hasOwnProperty(R))H=F[R][1]/I,G=F[R][0]/I;else try{H=x[1],G=x[0]}catch{throw new Error("Invalid format: "+x)}if(f==="p"||f==="portrait")f="p",G>H&&(j=G,G=H,H=j);else{if(f!=="l"&&f!=="landscape")throw"Invalid orientation: "+f;f="l",H>G&&(j=G,G=H,H=j)}return{width:G,height:H,unit:i,k:I,orientation:f}},t.html=function(f,i){(i=i||{}).callback=i.callback||function(){},i.html2canvas=i.html2canvas||{},i.html2canvas.canvas=i.html2canvas.canvas||this.canvas,i.jsPDF=i.jsPDF||this,i.fontFaces=i.fontFaces?i.fontFaces.map(ND):null;var x=new l(i);return i.worker?x:x.from(f).doCallback()}}(Ui.API),Ui.API.addJS=function(t){return A$=t,this.internal.events.subscribe("postPutResources",function(){dA=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(dA+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),S$=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+A$+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){dA!==void 0&&S$!==void 0&&this.internal.out("/Names <</JavaScript "+dA+" 0 R>>")}),this},function(t){var e;t.events.push(["postPutResources",function(){var n=this,r=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var s=n.outline.render().split(/\r\n/),l=0;l<s.length;l++){var f=s[l],i=r.exec(f);if(i!=null){var x=i[1];n.internal.newObjectDeferredBegin(x,!1)}n.internal.write(f)}if(this.outline.createNamedDestinations){var S=this.internal.pages.length,I=[];for(l=0;l<S;l++){var R=n.internal.newObject();I.push(R);var F=n.internal.getPageInfo(l+1);n.internal.write("<< /D["+F.objId+" 0 R /XYZ null null null]>> endobj")}var j=n.internal.newObject();for(n.internal.write("<< /Names [ "),l=0;l<I.length;l++)n.internal.write("(page_"+(l+1)+")"+I[l]+" 0 R");n.internal.write(" ] >>","endobj"),e=n.internal.newObject(),n.internal.write("<< /Dests "+j+" 0 R"),n.internal.write(">>","endobj")}}]),t.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+e+" 0 R"))}]),t.events.push(["initialized",function(){var n=this;n.outline={createNamedDestinations:!1,root:{children:[]}},n.outline.add=function(r,s,l){var f={title:s,options:l,children:[]};return r==null&&(r=this.root),r.children.push(f),f},n.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=n,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},n.outline.genIds_r=function(r){r.id=n.internal.newObjectDeferred();for(var s=0;s<r.children.length;s++)this.genIds_r(r.children[s])},n.outline.renderRoot=function(r){this.objStart(r),this.line("/Type /Outlines"),r.children.length>0&&(this.line("/First "+this.makeRef(r.children[0])),this.line("/Last "+this.makeRef(r.children[r.children.length-1]))),this.line("/Count "+this.count_r({count:0},r)),this.objEnd()},n.outline.renderItems=function(r){for(var s=this.ctx.pdf.internal.getVerticalCoordinateString,l=0;l<r.children.length;l++){var f=r.children[l];this.objStart(f),this.line("/Title "+this.makeString(f.title)),this.line("/Parent "+this.makeRef(r)),l>0&&this.line("/Prev "+this.makeRef(r.children[l-1])),l<r.children.length-1&&this.line("/Next "+this.makeRef(r.children[l+1])),f.children.length>0&&(this.line("/First "+this.makeRef(f.children[0])),this.line("/Last "+this.makeRef(f.children[f.children.length-1])));var i=this.count=this.count_r({count:0},f);if(i>0&&this.line("/Count "+i),f.options&&f.options.pageNumber){var x=n.internal.getPageInfo(f.options.pageNumber);this.line("/Dest ["+x.objId+" 0 R /XYZ 0 "+s(0)+" 0]")}this.objEnd()}for(var S=0;S<r.children.length;S++)this.renderItems(r.children[S])},n.outline.line=function(r){this.ctx.val+=r+`\r
`},n.outline.makeRef=function(r){return r.id+" 0 R"},n.outline.makeString=function(r){return"("+n.internal.pdfEscape(r)+")"},n.outline.objStart=function(r){this.ctx.val+=`\r
`+r.id+` 0 obj\r
<<\r
`},n.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},n.outline.count_r=function(r,s){for(var l=0;l<s.children.length;l++)r.count++,this.count_r(r,s.children[l]);return r.count}}])}(Ui.API),function(t){var e=[192,193,194,195,196,197,198,199];t.processJPEG=function(n,r,s,l,f,i){var x,S=this.decode.DCT_DECODE,I=null;if(typeof n=="string"||this.__addimage__.isArrayBuffer(n)||this.__addimage__.isArrayBufferView(n)){switch(n=f||n,n=this.__addimage__.isArrayBuffer(n)?new Uint8Array(n):n,(x=function(R){for(var F,j=256*R.charCodeAt(4)+R.charCodeAt(5),H=R.length,G={width:0,height:0,numcomponents:1},W=4;W<H;W+=2){if(W+=j,e.indexOf(R.charCodeAt(W+1))!==-1){F=256*R.charCodeAt(W+5)+R.charCodeAt(W+6),G={width:256*R.charCodeAt(W+7)+R.charCodeAt(W+8),height:F,numcomponents:R.charCodeAt(W+9)};break}j=256*R.charCodeAt(W+2)+R.charCodeAt(W+3)}return G}(n=this.__addimage__.isArrayBufferView(n)?this.__addimage__.arrayBufferToBinaryString(n):n)).numcomponents){case 1:i=this.color_spaces.DEVICE_GRAY;break;case 4:i=this.color_spaces.DEVICE_CMYK;break;case 3:i=this.color_spaces.DEVICE_RGB}I={data:n,width:x.width,height:x.height,colorSpace:i,bitsPerComponent:8,filter:S,index:r,alias:s}}return I}}(Ui.API);var d0,pA,T$,E$,M$,NEe=function(){var t,e,n;function r(l){var f,i,x,S,I,R,F,j,H,G,W,J,ie,he;for(this.data=l,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},R=null;;){switch(f=this.readUInt32(),H=(function(){var ge,fe;for(fe=[],ge=0;ge<4;++ge)fe.push(String.fromCharCode(this.data[this.pos++]));return fe}).call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(f);break;case"fcTL":R&&this.animation.frames.push(R),this.pos+=4,R={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},I=this.readUInt16(),S=this.readUInt16()||100,R.delay=1e3*I/S,R.disposeOp=this.data[this.pos++],R.blendOp=this.data[this.pos++],R.data=[];break;case"IDAT":case"fdAT":for(H==="fdAT"&&(this.pos+=4,f-=4),l=(R!=null?R.data:void 0)||this.imgData,J=0;0<=f?J<f:J>f;0<=f?++J:--J)l.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(x=this.palette.length/3,this.transparency.indexed=this.read(f),this.transparency.indexed.length>x)throw new Error("More transparent colors than palette size");if((G=x-this.transparency.indexed.length)>0)for(ie=0;0<=G?ie<G:ie>G;0<=G?++ie:--ie)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(f)[0];break;case 2:this.transparency.rgb=this.read(f)}break;case"tEXt":F=(W=this.read(f)).indexOf(0),j=String.fromCharCode.apply(String,W.slice(0,F)),this.text[j]=String.fromCharCode.apply(String,W.slice(F+1));break;case"IEND":return R&&this.animation.frames.push(R),this.colors=(function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}).call(this),this.hasAlphaChannel=(he=this.colorType)===4||he===6,i=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*i,this.colorSpace=(function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}).call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=f}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}r.prototype.read=function(l){var f,i;for(i=[],f=0;0<=l?f<l:f>l;0<=l?++f:--f)i.push(this.data[this.pos++]);return i},r.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},r.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},r.prototype.decodePixels=function(l){var f=this.pixelBitlength/8,i=new Uint8Array(this.width*this.height*f),x=0,S=this;if(l==null&&(l=this.imgData),l.length===0)return new Uint8Array(0);function I(R,F,j,H){var G,W,J,ie,he,ge,fe,ye,pe,be,Ae,Oe,ue,we,ke,De,je,ze,Ue,Fe,Qe,Be=Math.ceil((S.width-R)/j),bt=Math.ceil((S.height-F)/H),xe=S.width==Be&&S.height==bt;for(we=f*Be,Oe=xe?i:new Uint8Array(we*bt),ge=l.length,ue=0,W=0;ue<bt&&x<ge;){switch(l[x++]){case 0:for(ie=je=0;je<we;ie=je+=1)Oe[W++]=l[x++];break;case 1:for(ie=ze=0;ze<we;ie=ze+=1)G=l[x++],he=ie<f?0:Oe[W-f],Oe[W++]=(G+he)%256;break;case 2:for(ie=Ue=0;Ue<we;ie=Ue+=1)G=l[x++],J=(ie-ie%f)/f,ke=ue&&Oe[(ue-1)*we+J*f+ie%f],Oe[W++]=(ke+G)%256;break;case 3:for(ie=Fe=0;Fe<we;ie=Fe+=1)G=l[x++],J=(ie-ie%f)/f,he=ie<f?0:Oe[W-f],ke=ue&&Oe[(ue-1)*we+J*f+ie%f],Oe[W++]=(G+Math.floor((he+ke)/2))%256;break;case 4:for(ie=Qe=0;Qe<we;ie=Qe+=1)G=l[x++],J=(ie-ie%f)/f,he=ie<f?0:Oe[W-f],ue===0?ke=De=0:(ke=Oe[(ue-1)*we+J*f+ie%f],De=J&&Oe[(ue-1)*we+(J-1)*f+ie%f]),fe=he+ke-De,ye=Math.abs(fe-he),be=Math.abs(fe-ke),Ae=Math.abs(fe-De),pe=ye<=be&&ye<=Ae?he:be<=Ae?ke:De,Oe[W++]=(G+pe)%256;break;default:throw new Error("Invalid filter algorithm: "+l[x-1])}if(!xe){var Le=((F+ue*H)*S.width+R)*f,Xe=ue*we;for(ie=0;ie<Be;ie+=1){for(var ct=0;ct<f;ct+=1)i[Le++]=Oe[Xe++];Le+=(j-1)*f}}ue++}}return l=pEe(l),S.interlaceMethod==1?(I(0,0,8,8),I(4,0,8,8),I(0,4,4,8),I(2,0,4,4),I(0,2,2,4),I(1,0,2,2),I(0,1,1,2)):I(0,0,1,1),i},r.prototype.decodePalette=function(){var l,f,i,x,S,I,R,F,j;for(i=this.palette,I=this.transparency.indexed||[],S=new Uint8Array((I.length||0)+i.length),x=0,l=0,f=R=0,F=i.length;R<F;f=R+=3)S[x++]=i[f],S[x++]=i[f+1],S[x++]=i[f+2],S[x++]=(j=I[l++])!=null?j:255;return S},r.prototype.copyToImageData=function(l,f){var i,x,S,I,R,F,j,H,G,W,J;if(x=this.colors,G=null,i=this.hasAlphaChannel,this.palette.length&&(G=(J=this._decodedPalette)!=null?J:this._decodedPalette=this.decodePalette(),x=4,i=!0),H=(S=l.data||l).length,R=G||f,I=F=0,x===1)for(;I<H;)j=G?4*f[I/4]:F,W=R[j++],S[I++]=W,S[I++]=W,S[I++]=W,S[I++]=i?R[j++]:255,F=j;else for(;I<H;)j=G?4*f[I/4]:F,S[I++]=R[j++],S[I++]=R[j++],S[I++]=R[j++],S[I++]=i?R[j++]:255,F=j},r.prototype.decode=function(){var l;return l=new Uint8Array(this.width*this.height*4),this.copyToImageData(l,this.decodePixels()),l};var s=function(){if(Object.prototype.toString.call(Wi)==="[object Window]"){try{e=Wi.document.createElement("canvas"),n=e.getContext("2d")}catch{return!1}return!0}return!1};return s(),t=function(l){var f;if(s()===!0)return n.width=l.width,n.height=l.height,n.clearRect(0,0,l.width,l.height),n.putImageData(l,0,0),(f=new Image).src=e.toDataURL(),f;throw new Error("This method requires a Browser with Canvas-capability.")},r.prototype.decodeFrames=function(l){var f,i,x,S,I,R,F,j;if(this.animation){for(j=[],i=I=0,R=(F=this.animation.frames).length;I<R;i=++I)f=F[i],x=l.createImageData(f.width,f.height),S=this.decodePixels(new Uint8Array(f.data)),this.copyToImageData(x,S),f.imageData=x,j.push(f.image=t(x));return j}},r.prototype.renderFrame=function(l,f){var i,x,S;return i=(x=this.animation.frames)[f],S=x[f-1],f===0&&l.clearRect(0,0,this.width,this.height),(S!=null?S.disposeOp:void 0)===1?l.clearRect(S.xOffset,S.yOffset,S.width,S.height):(S!=null?S.disposeOp:void 0)===2&&l.putImageData(S.imageData,S.xOffset,S.yOffset),i.blendOp===0&&l.clearRect(i.xOffset,i.yOffset,i.width,i.height),l.drawImage(i.image,i.xOffset,i.yOffset)},r.prototype.animate=function(l){var f,i,x,S,I,R,F=this;return i=0,R=this.animation,S=R.numFrames,x=R.frames,I=R.numPlays,(f=function(){var j,H;if(j=i++%S,H=x[j],F.renderFrame(l,j),S>1&&i/S<I)return F.animation._timeout=setTimeout(f,H.delay)})()},r.prototype.stopAnimation=function(){var l;return clearTimeout((l=this.animation)!=null?l._timeout:void 0)},r.prototype.render=function(l){var f,i;return l._png&&l._png.stopAnimation(),l._png=this,l.width=this.width,l.height=this.height,f=l.getContext("2d"),this.animation?(this.decodeFrames(f),this.animate(f)):(i=f.createImageData(this.width,this.height),this.copyToImageData(i,this.decodePixels()),f.putImageData(i,0,0))},r}();/**
 * @license
 *
 * Copyright (c) 2014 James Robb, https://github.com/jamesbrobb
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * ====================================================================
 *//**
 * @license
 * (c) Dean McNamee <dean@gmail.com>, 2013.
 *
 * https://github.com/deanm/omggif
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 *
 * omggif is a JavaScript implementation of a GIF 89a encoder and decoder,
 * including animation and compression.  It does not rely on any specific
 * underlying system, so should run in the browser, Node, or Plask.
 */function zEe(t){var e=0;if(t[e++]!==71||t[e++]!==73||t[e++]!==70||t[e++]!==56||(t[e++]+1&253)!=56||t[e++]!==97)throw new Error("Invalid GIF 87a/89a header.");var n=t[e++]|t[e++]<<8,r=t[e++]|t[e++]<<8,s=t[e++],l=s>>7,f=1<<(7&s)+1;t[e++],t[e++];var i=null,x=null;l&&(i=e,x=f,e+=3*f);var S=!0,I=[],R=0,F=null,j=0,H=null;for(this.width=n,this.height=r;S&&e<t.length;)switch(t[e++]){case 33:switch(t[e++]){case 255:if(t[e]!==11||t[e+1]==78&&t[e+2]==69&&t[e+3]==84&&t[e+4]==83&&t[e+5]==67&&t[e+6]==65&&t[e+7]==80&&t[e+8]==69&&t[e+9]==50&&t[e+10]==46&&t[e+11]==48&&t[e+12]==3&&t[e+13]==1&&t[e+16]==0)e+=14,H=t[e++]|t[e++]<<8,e++;else for(e+=12;;){if(!((ue=t[e++])>=0))throw Error("Invalid block size");if(ue===0)break;e+=ue}break;case 249:if(t[e++]!==4||t[e+4]!==0)throw new Error("Invalid graphics extension block.");var G=t[e++];R=t[e++]|t[e++]<<8,F=t[e++],(1&G)==0&&(F=null),j=G>>2&7,e++;break;case 254:for(;;){if(!((ue=t[e++])>=0))throw Error("Invalid block size");if(ue===0)break;e+=ue}break;default:throw new Error("Unknown graphic control label: 0x"+t[e-1].toString(16))}break;case 44:var W=t[e++]|t[e++]<<8,J=t[e++]|t[e++]<<8,ie=t[e++]|t[e++]<<8,he=t[e++]|t[e++]<<8,ge=t[e++],fe=ge>>6&1,ye=1<<(7&ge)+1,pe=i,be=x,Ae=!1;ge>>7&&(Ae=!0,pe=e,be=ye,e+=3*ye);var Oe=e;for(e++;;){var ue;if(!((ue=t[e++])>=0))throw Error("Invalid block size");if(ue===0)break;e+=ue}I.push({x:W,y:J,width:ie,height:he,has_local_palette:Ae,palette_offset:pe,palette_size:be,data_offset:Oe,data_length:e-Oe,transparent_index:F,interlaced:!!fe,delay:R,disposal:j});break;case 59:S=!1;break;default:throw new Error("Unknown gif block: 0x"+t[e-1].toString(16))}this.numFrames=function(){return I.length},this.loopCount=function(){return H},this.frameInfo=function(we){if(we<0||we>=I.length)throw new Error("Frame index out of range.");return I[we]},this.decodeAndBlitFrameBGRA=function(we,ke){var De=this.frameInfo(we),je=De.width*De.height,ze=new Uint8Array(je);C$(t,De.data_offset,ze,je);var Ue=De.palette_offset,Fe=De.transparent_index;Fe===null&&(Fe=256);var Qe=De.width,Be=n-Qe,bt=Qe,xe=4*(De.y*n+De.x),Le=4*((De.y+De.height)*n+De.x),Xe=xe,ct=4*Be;De.interlaced===!0&&(ct+=4*n*7);for(var vt=8,Nt=0,mt=ze.length;Nt<mt;++Nt){var yt=ze[Nt];if(bt===0&&(bt=Qe,(Xe+=ct)>=Le&&(ct=4*Be+4*n*(vt-1),Xe=xe+(Qe+Be)*(vt<<1),vt>>=1)),yt===Fe)Xe+=4;else{var _e=t[Ue+3*yt],on=t[Ue+3*yt+1],Kt=t[Ue+3*yt+2];ke[Xe++]=Kt,ke[Xe++]=on,ke[Xe++]=_e,ke[Xe++]=255}--bt}},this.decodeAndBlitFrameRGBA=function(we,ke){var De=this.frameInfo(we),je=De.width*De.height,ze=new Uint8Array(je);C$(t,De.data_offset,ze,je);var Ue=De.palette_offset,Fe=De.transparent_index;Fe===null&&(Fe=256);var Qe=De.width,Be=n-Qe,bt=Qe,xe=4*(De.y*n+De.x),Le=4*((De.y+De.height)*n+De.x),Xe=xe,ct=4*Be;De.interlaced===!0&&(ct+=4*n*7);for(var vt=8,Nt=0,mt=ze.length;Nt<mt;++Nt){var yt=ze[Nt];if(bt===0&&(bt=Qe,(Xe+=ct)>=Le&&(ct=4*Be+4*n*(vt-1),Xe=xe+(Qe+Be)*(vt<<1),vt>>=1)),yt===Fe)Xe+=4;else{var _e=t[Ue+3*yt],on=t[Ue+3*yt+1],Kt=t[Ue+3*yt+2];ke[Xe++]=_e,ke[Xe++]=on,ke[Xe++]=Kt,ke[Xe++]=255}--bt}}}function C$(t,e,n,r){for(var s=t[e++],l=1<<s,f=l+1,i=f+1,x=s+1,S=(1<<x)-1,I=0,R=0,F=0,j=t[e++],H=new Int32Array(4096),G=null;;){for(;I<16&&j!==0;)R|=t[e++]<<I,I+=8,j===1?j=t[e++]:--j;if(I<x)break;var W=R&S;if(R>>=x,I-=x,W!==l){if(W===f)break;for(var J=W<i?W:G,ie=0,he=J;he>l;)he=H[he]>>8,++ie;var ge=he;if(F+ie+(J!==W?1:0)>r)return void ro.log("Warning, gif stream longer than expected.");n[F++]=ge;var fe=F+=ie;for(J!==W&&(n[F++]=ge),he=J;ie--;)he=H[he],n[--fe]=255&he,he>>=8;G!==null&&i<4096&&(H[i++]=G<<8|ge,i>=S+1&&x<12&&(++x,S=S<<1|1)),G=W}else i=f+1,S=(1<<(x=s+1))-1,G=null}return F!==r&&ro.log("Warning, gif stream shorter than expected."),n}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function u4(t){var e,n,r,s,l,f=Math.floor,i=new Array(64),x=new Array(64),S=new Array(64),I=new Array(64),R=new Array(65535),F=new Array(65535),j=new Array(64),H=new Array(64),G=[],W=0,J=7,ie=new Array(64),he=new Array(64),ge=new Array(64),fe=new Array(256),ye=new Array(2048),pe=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],be=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],Ae=[0,1,2,3,4,5,6,7,8,9,10,11],Oe=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],ue=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],we=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],ke=[0,1,2,3,4,5,6,7,8,9,10,11],De=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],je=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function ze(xe,Le){for(var Xe=0,ct=0,vt=new Array,Nt=1;Nt<=16;Nt++){for(var mt=1;mt<=xe[Nt];mt++)vt[Le[ct]]=[],vt[Le[ct]][0]=Xe,vt[Le[ct]][1]=Nt,ct++,Xe++;Xe*=2}return vt}function Ue(xe){for(var Le=xe[0],Xe=xe[1]-1;Xe>=0;)Le&1<<Xe&&(W|=1<<J),Xe--,--J<0&&(W==255?(Fe(255),Fe(0)):Fe(W),J=7,W=0)}function Fe(xe){G.push(xe)}function Qe(xe){Fe(xe>>8&255),Fe(255&xe)}function Be(xe,Le,Xe,ct,vt){for(var Nt,mt=vt[0],yt=vt[240],_e=function(Dn,ar){var hr,ur,Ir,Un,Vr,pi,Li,wi,xn,Xn,hn=0;for(xn=0;xn<8;++xn){hr=Dn[hn],ur=Dn[hn+1],Ir=Dn[hn+2],Un=Dn[hn+3],Vr=Dn[hn+4],pi=Dn[hn+5],Li=Dn[hn+6];var er=hr+(wi=Dn[hn+7]),yr=hr-wi,Vi=ur+Li,ki=ur-Li,mi=Ir+pi,ti=Ir-pi,Pr=Un+Vr,ys=Un-Vr,Fa=er+Pr,Za=er-Pr,Oo=Vi+mi,Ia=Vi-mi;Dn[hn]=Fa+Oo,Dn[hn+4]=Fa-Oo;var fi=.707106781*(Ia+Za);Dn[hn+2]=Za+fi,Dn[hn+6]=Za-fi;var la=.382683433*((Fa=ys+ti)-(Ia=ki+yr)),Iu=.5411961*Fa+la,zs=1.306562965*Ia+la,Zt=.707106781*(Oo=ti+ki),Ee=yr+Zt,Re=yr-Zt;Dn[hn+5]=Re+Iu,Dn[hn+3]=Re-Iu,Dn[hn+1]=Ee+zs,Dn[hn+7]=Ee-zs,hn+=8}for(hn=0,xn=0;xn<8;++xn){hr=Dn[hn],ur=Dn[hn+8],Ir=Dn[hn+16],Un=Dn[hn+24],Vr=Dn[hn+32],pi=Dn[hn+40],Li=Dn[hn+48];var tt=hr+(wi=Dn[hn+56]),gt=hr-wi,ft=ur+Li,Tt=ur-Li,Ft=Ir+pi,Ct=Ir-pi,Ht=Un+Vr,Gt=Un-Vr,$t=tt+Ht,Sn=tt-Ht,Nn=ft+Ft,qn=ft-Ft;Dn[hn]=$t+Nn,Dn[hn+32]=$t-Nn;var vr=.707106781*(qn+Sn);Dn[hn+16]=Sn+vr,Dn[hn+48]=Sn-vr;var Or=.382683433*(($t=Gt+Ct)-(qn=Tt+gt)),Rr=.5411961*$t+Or,qr=1.306562965*qn+Or,Ri=.707106781*(Nn=Ct+Tt),Xi=gt+Ri,Hr=gt-Ri;Dn[hn+40]=Hr+Rr,Dn[hn+24]=Hr-Rr,Dn[hn+8]=Xi+qr,Dn[hn+56]=Xi-qr,hn++}for(xn=0;xn<64;++xn)Xn=Dn[xn]*ar[xn],j[xn]=Xn>0?Xn+.5|0:Xn-.5|0;return j}(xe,Le),on=0;on<64;++on)H[pe[on]]=_e[on];var Kt=H[0]-Xe;Xe=H[0],Kt==0?Ue(ct[0]):(Ue(ct[F[Nt=32767+Kt]]),Ue(R[Nt]));for(var Pn=63;Pn>0&&H[Pn]==0;)Pn--;if(Pn==0)return Ue(mt),Xe;for(var Ut,cn=1;cn<=Pn;){for(var At=cn;H[cn]==0&&cn<=Pn;)++cn;var xr=cn-At;if(xr>=16){Ut=xr>>4;for(var Rn=1;Rn<=Ut;++Rn)Ue(yt);xr&=15}Nt=32767+H[cn],Ue(vt[(xr<<4)+F[Nt]]),Ue(R[Nt]),cn++}return Pn!=63&&Ue(mt),Xe}function bt(xe){xe=Math.min(Math.max(xe,1),100),l!=xe&&(function(Le){for(var Xe=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],ct=0;ct<64;ct++){var vt=f((Xe[ct]*Le+50)/100);vt=Math.min(Math.max(vt,1),255),i[pe[ct]]=vt}for(var Nt=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],mt=0;mt<64;mt++){var yt=f((Nt[mt]*Le+50)/100);yt=Math.min(Math.max(yt,1),255),x[pe[mt]]=yt}for(var _e=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],on=0,Kt=0;Kt<8;Kt++)for(var Pn=0;Pn<8;Pn++)S[on]=1/(i[pe[on]]*_e[Kt]*_e[Pn]*8),I[on]=1/(x[pe[on]]*_e[Kt]*_e[Pn]*8),on++}(xe<50?Math.floor(5e3/xe):Math.floor(200-2*xe)),l=xe)}this.encode=function(xe,Le){Le&&bt(Le),G=new Array,W=0,J=7,Qe(65496),Qe(65504),Qe(16),Fe(74),Fe(70),Fe(73),Fe(70),Fe(0),Fe(1),Fe(1),Fe(0),Qe(1),Qe(1),Fe(0),Fe(0),function(){Qe(65499),Qe(132),Fe(0);for(var ur=0;ur<64;ur++)Fe(i[ur]);Fe(1);for(var Ir=0;Ir<64;Ir++)Fe(x[Ir])}(),function(ur,Ir){Qe(65472),Qe(17),Fe(8),Qe(Ir),Qe(ur),Fe(3),Fe(1),Fe(17),Fe(0),Fe(2),Fe(17),Fe(1),Fe(3),Fe(17),Fe(1)}(xe.width,xe.height),function(){Qe(65476),Qe(418),Fe(0);for(var ur=0;ur<16;ur++)Fe(be[ur+1]);for(var Ir=0;Ir<=11;Ir++)Fe(Ae[Ir]);Fe(16);for(var Un=0;Un<16;Un++)Fe(Oe[Un+1]);for(var Vr=0;Vr<=161;Vr++)Fe(ue[Vr]);Fe(1);for(var pi=0;pi<16;pi++)Fe(we[pi+1]);for(var Li=0;Li<=11;Li++)Fe(ke[Li]);Fe(17);for(var wi=0;wi<16;wi++)Fe(De[wi+1]);for(var xn=0;xn<=161;xn++)Fe(je[xn])}(),Qe(65498),Qe(12),Fe(3),Fe(1),Fe(0),Fe(2),Fe(17),Fe(3),Fe(17),Fe(0),Fe(63),Fe(0);var Xe=0,ct=0,vt=0;W=0,J=7,this.encode.displayName="_encode_";for(var Nt,mt,yt,_e,on,Kt,Pn,Ut,cn,At=xe.data,xr=xe.width,Rn=xe.height,Dn=4*xr,ar=0;ar<Rn;){for(Nt=0;Nt<Dn;){for(on=Dn*ar+Nt,Pn=-1,Ut=0,cn=0;cn<64;cn++)Kt=on+(Ut=cn>>3)*Dn+(Pn=4*(7&cn)),ar+Ut>=Rn&&(Kt-=Dn*(ar+1+Ut-Rn)),Nt+Pn>=Dn&&(Kt-=Nt+Pn-Dn+4),mt=At[Kt++],yt=At[Kt++],_e=At[Kt++],ie[cn]=(ye[mt]+ye[yt+256>>0]+ye[_e+512>>0]>>16)-128,he[cn]=(ye[mt+768>>0]+ye[yt+1024>>0]+ye[_e+1280>>0]>>16)-128,ge[cn]=(ye[mt+1280>>0]+ye[yt+1536>>0]+ye[_e+1792>>0]>>16)-128;Xe=Be(ie,S,Xe,e,r),ct=Be(he,I,ct,n,s),vt=Be(ge,I,vt,n,s),Nt+=32}ar+=8}if(J>=0){var hr=[];hr[1]=J+1,hr[0]=(1<<J+1)-1,Ue(hr)}return Qe(65497),new Uint8Array(G)},t=t||50,function(){for(var xe=String.fromCharCode,Le=0;Le<256;Le++)fe[Le]=xe(Le)}(),e=ze(be,Ae),n=ze(we,ke),r=ze(Oe,ue),s=ze(De,je),function(){for(var xe=1,Le=2,Xe=1;Xe<=15;Xe++){for(var ct=xe;ct<Le;ct++)F[32767+ct]=Xe,R[32767+ct]=[],R[32767+ct][1]=Xe,R[32767+ct][0]=ct;for(var vt=-(Le-1);vt<=-xe;vt++)F[32767+vt]=Xe,R[32767+vt]=[],R[32767+vt][1]=Xe,R[32767+vt][0]=Le-1+vt;xe<<=1,Le<<=1}}(),function(){for(var xe=0;xe<256;xe++)ye[xe]=19595*xe,ye[xe+256>>0]=38470*xe,ye[xe+512>>0]=7471*xe+32768,ye[xe+768>>0]=-11059*xe,ye[xe+1024>>0]=-21709*xe,ye[xe+1280>>0]=32768*xe+8421375,ye[xe+1536>>0]=-27439*xe,ye[xe+1792>>0]=-5329*xe}(),bt(t)}/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */function vp(t,e){if(this.pos=0,this.buffer=t,this.datav=new DataView(t.buffer),this.is_with_alpha=!!e,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function I$(t){function e(be){if(!be)throw Error("assert :P")}function n(be,Ae,Oe){for(var ue=0;4>ue;ue++)if(be[Ae+ue]!=Oe.charCodeAt(ue))return!0;return!1}function r(be,Ae,Oe,ue,we){for(var ke=0;ke<we;ke++)be[Ae+ke]=Oe[ue+ke]}function s(be,Ae,Oe,ue){for(var we=0;we<ue;we++)be[Ae+we]=Oe}function l(be){return new Int32Array(be)}function f(be,Ae){for(var Oe=[],ue=0;ue<be;ue++)Oe.push(new Ae);return Oe}function i(be,Ae){var Oe=[];return function ue(we,ke,De){for(var je=De[ke],ze=0;ze<je&&(we.push(De.length>ke+1?[]:new Ae),!(De.length<ke+1));ze++)ue(we[ze],ke+1,De)}(Oe,0,be),Oe}var x=function(){var be=this;function Ae(q,Z){for(var de=1<<Z-1>>>0;q&de;)de>>>=1;return de?(q&de-1)+de:q}function Oe(q,Z,de,Ie,Ve){e(!(Ie%de));do q[Z+(Ie-=de)]=Ve;while(0<Ie)}function ue(q,Z,de,Ie,Ve){if(e(2328>=Ve),512>=Ve)var Ze=l(512);else if((Ze=l(Ve))==null)return 0;return function(et,at,ut,St,Jt,Mt){var vn,nn,wn=at,pn=1<<ut,_t=l(16),en=l(16);for(e(Jt!=0),e(St!=null),e(et!=null),e(0<ut),nn=0;nn<Jt;++nn){if(15<St[nn])return 0;++_t[St[nn]]}if(_t[0]==Jt)return 0;for(en[1]=0,vn=1;15>vn;++vn){if(_t[vn]>1<<vn)return 0;en[vn+1]=en[vn]+_t[vn]}for(nn=0;nn<Jt;++nn)vn=St[nn],0<St[nn]&&(Mt[en[vn]++]=nn);if(en[15]==1)return(St=new we).g=0,St.value=Mt[0],Oe(et,wn,1,pn,St),pn;var Vn,Yn=-1,Gn=pn-1,Tr=0,pr=1,ii=1,cr=1<<ut;for(nn=0,vn=1,Jt=2;vn<=ut;++vn,Jt<<=1){if(pr+=ii<<=1,0>(ii-=_t[vn]))return 0;for(;0<_t[vn];--_t[vn])(St=new we).g=vn,St.value=Mt[nn++],Oe(et,wn+Tr,Jt,cr,St),Tr=Ae(Tr,vn)}for(vn=ut+1,Jt=2;15>=vn;++vn,Jt<<=1){if(pr+=ii<<=1,0>(ii-=_t[vn]))return 0;for(;0<_t[vn];--_t[vn]){if(St=new we,(Tr&Gn)!=Yn){for(wn+=cr,Vn=1<<(Yn=vn)-ut;15>Yn&&!(0>=(Vn-=_t[Yn]));)++Yn,Vn<<=1;pn+=cr=1<<(Vn=Yn-ut),et[at+(Yn=Tr&Gn)].g=Vn+ut,et[at+Yn].value=wn-at-Yn}St.g=vn-ut,St.value=Mt[nn++],Oe(et,wn+(Tr>>ut),Jt,cr,St),Tr=Ae(Tr,vn)}}return pr!=2*en[15]-1?0:pn}(q,Z,de,Ie,Ve,Ze)}function we(){this.value=this.g=0}function ke(){this.value=this.g=0}function De(){this.G=f(5,we),this.H=l(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=f(Ts,ke)}function je(q,Z,de,Ie){e(q!=null),e(Z!=null),e(2147483648>Ie),q.Ca=254,q.I=0,q.b=-8,q.Ka=0,q.oa=Z,q.pa=de,q.Jd=Z,q.Yc=de+Ie,q.Zc=4<=Ie?de+Ie-4+1:de,Nt(q)}function ze(q,Z){for(var de=0;0<Z--;)de|=yt(q,128)<<Z;return de}function Ue(q,Z){var de=ze(q,Z);return mt(q)?-de:de}function Fe(q,Z,de,Ie){var Ve,Ze=0;for(e(q!=null),e(Z!=null),e(4294967288>Ie),q.Sb=Ie,q.Ra=0,q.u=0,q.h=0,4<Ie&&(Ie=4),Ve=0;Ve<Ie;++Ve)Ze+=Z[de+Ve]<<8*Ve;q.Ra=Ze,q.bb=Ie,q.oa=Z,q.pa=de}function Qe(q){for(;8<=q.u&&q.bb<q.Sb;)q.Ra>>>=8,q.Ra+=q.oa[q.pa+q.bb]<<On-8>>>0,++q.bb,q.u-=8;Xe(q)&&(q.h=1,q.u=0)}function Be(q,Z){if(e(0<=Z),!q.h&&Z<=uu){var de=Le(q)&ya[Z];return q.u+=Z,Qe(q),de}return q.h=1,q.u=0}function bt(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function xe(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function Le(q){return q.Ra>>>(q.u&On-1)>>>0}function Xe(q){return e(q.bb<=q.Sb),q.h||q.bb==q.Sb&&q.u>On}function ct(q,Z){q.u=Z,q.h=Xe(q)}function vt(q){q.u>=Sh&&(e(q.u>=Sh),Qe(q))}function Nt(q){e(q!=null&&q.oa!=null),q.pa<q.Zc?(q.I=(q.oa[q.pa++]|q.I<<8)>>>0,q.b+=8):(e(q!=null&&q.oa!=null),q.pa<q.Yc?(q.b+=8,q.I=q.oa[q.pa++]|q.I<<8):q.Ka?q.b=0:(q.I<<=8,q.b+=8,q.Ka=1))}function mt(q){return ze(q,1)}function yt(q,Z){var de=q.Ca;0>q.b&&Nt(q);var Ie=q.b,Ve=de*Z>>>8,Ze=(q.I>>>Ie>Ve)+0;for(Ze?(de-=Ve,q.I-=Ve+1<<Ie>>>0):de=Ve+1,Ie=de,Ve=0;256<=Ie;)Ve+=8,Ie>>=8;return Ie=7^Ve+Vs[Ie],q.b-=Ie,q.Ca=(de<<Ie)-1,Ze}function _e(q,Z,de){q[Z+0]=de>>24&255,q[Z+1]=de>>16&255,q[Z+2]=de>>8&255,q[Z+3]=de>>0&255}function on(q,Z){return q[Z+0]<<0|q[Z+1]<<8}function Kt(q,Z){return on(q,Z)|q[Z+2]<<16}function Pn(q,Z){return on(q,Z)|on(q,Z+2)<<16}function Ut(q,Z){var de=1<<Z;return e(q!=null),e(0<Z),q.X=l(de),q.X==null?0:(q.Mb=32-Z,q.Xa=Z,1)}function cn(q,Z){e(q!=null),e(Z!=null),e(q.Xa==Z.Xa),r(Z.X,0,q.X,0,1<<Z.Xa)}function At(){this.X=[],this.Xa=this.Mb=0}function xr(q,Z,de,Ie){e(de!=null),e(Ie!=null);var Ve=de[0],Ze=Ie[0];return Ve==0&&(Ve=(q*Ze+Z/2)/Z),Ze==0&&(Ze=(Z*Ve+q/2)/q),0>=Ve||0>=Ze?0:(de[0]=Ve,Ie[0]=Ze,1)}function Rn(q,Z){return q+(1<<Z)-1>>>Z}function Dn(q,Z){return((4278255360&q)+(4278255360&Z)>>>0&4278255360)+((16711935&q)+(16711935&Z)>>>0&16711935)>>>0}function ar(q,Z){be[Z]=function(de,Ie,Ve,Ze,et,at,ut){var St;for(St=0;St<et;++St){var Jt=be[q](at[ut+St-1],Ve,Ze+St);at[ut+St]=Dn(de[Ie+St],Jt)}}}function hr(){this.ud=this.hd=this.jd=0}function ur(q,Z){return((4278124286&(q^Z))>>>1)+(q&Z)>>>0}function Ir(q){return 0<=q&&256>q?q:0>q?0:255<q?255:void 0}function Un(q,Z){return Ir(q+(q-Z+.5>>1))}function Vr(q,Z,de){return Math.abs(Z-de)-Math.abs(q-de)}function pi(q,Z,de,Ie,Ve,Ze,et){for(Ie=Ze[et-1],de=0;de<Ve;++de)Ze[et+de]=Ie=Dn(q[Z+de],Ie)}function Li(q,Z,de,Ie,Ve){var Ze;for(Ze=0;Ze<de;++Ze){var et=q[Z+Ze],at=et>>8&255,ut=16711935&(ut=(ut=16711935&et)+((at<<16)+at));Ie[Ve+Ze]=(4278255360&et)+ut>>>0}}function wi(q,Z){Z.jd=q>>0&255,Z.hd=q>>8&255,Z.ud=q>>16&255}function xn(q,Z,de,Ie,Ve,Ze){var et;for(et=0;et<Ie;++et){var at=Z[de+et],ut=at>>>8,St=at,Jt=255&(Jt=(Jt=at>>>16)+((q.jd<<24>>24)*(ut<<24>>24)>>>5));St=255&(St=(St=St+((q.hd<<24>>24)*(ut<<24>>24)>>>5))+((q.ud<<24>>24)*(Jt<<24>>24)>>>5)),Ve[Ze+et]=(4278255360&at)+(Jt<<16)+St}}function Xn(q,Z,de,Ie,Ve){be[Z]=function(Ze,et,at,ut,St,Jt,Mt,vn,nn){for(ut=Mt;ut<vn;++ut)for(Mt=0;Mt<nn;++Mt)St[Jt++]=Ve(at[Ie(Ze[et++])])},be[q]=function(Ze,et,at,ut,St,Jt,Mt){var vn=8>>Ze.b,nn=Ze.Ea,wn=Ze.K[0],pn=Ze.w;if(8>vn)for(Ze=(1<<Ze.b)-1,pn=(1<<vn)-1;et<at;++et){var _t,en=0;for(_t=0;_t<nn;++_t)_t&Ze||(en=Ie(ut[St++])),Jt[Mt++]=Ve(wn[en&pn]),en>>=vn}else be["VP8LMapColor"+de](ut,St,wn,pn,Jt,Mt,et,at,nn)}}function hn(q,Z,de,Ie,Ve){for(de=Z+de;Z<de;){var Ze=q[Z++];Ie[Ve++]=Ze>>16&255,Ie[Ve++]=Ze>>8&255,Ie[Ve++]=Ze>>0&255}}function er(q,Z,de,Ie,Ve){for(de=Z+de;Z<de;){var Ze=q[Z++];Ie[Ve++]=Ze>>16&255,Ie[Ve++]=Ze>>8&255,Ie[Ve++]=Ze>>0&255,Ie[Ve++]=Ze>>24&255}}function yr(q,Z,de,Ie,Ve){for(de=Z+de;Z<de;){var Ze=(et=q[Z++])>>16&240|et>>12&15,et=et>>0&240|et>>28&15;Ie[Ve++]=Ze,Ie[Ve++]=et}}function Vi(q,Z,de,Ie,Ve){for(de=Z+de;Z<de;){var Ze=(et=q[Z++])>>16&248|et>>13&7,et=et>>5&224|et>>3&31;Ie[Ve++]=Ze,Ie[Ve++]=et}}function ki(q,Z,de,Ie,Ve){for(de=Z+de;Z<de;){var Ze=q[Z++];Ie[Ve++]=Ze>>0&255,Ie[Ve++]=Ze>>8&255,Ie[Ve++]=Ze>>16&255}}function mi(q,Z,de,Ie,Ve,Ze){if(Ze==0)for(de=Z+de;Z<de;)_e(Ie,((Ze=q[Z++])[0]>>24|Ze[1]>>8&65280|Ze[2]<<8&16711680|Ze[3]<<24)>>>0),Ve+=32;else r(Ie,Ve,q,Z,de)}function ti(q,Z){be[Z][0]=be[q+"0"],be[Z][1]=be[q+"1"],be[Z][2]=be[q+"2"],be[Z][3]=be[q+"3"],be[Z][4]=be[q+"4"],be[Z][5]=be[q+"5"],be[Z][6]=be[q+"6"],be[Z][7]=be[q+"7"],be[Z][8]=be[q+"8"],be[Z][9]=be[q+"9"],be[Z][10]=be[q+"10"],be[Z][11]=be[q+"11"],be[Z][12]=be[q+"12"],be[Z][13]=be[q+"13"],be[Z][14]=be[q+"0"],be[Z][15]=be[q+"0"]}function Pr(q){return q==yc||q==qc||q==mu||q==Np}function ys(){this.eb=[],this.size=this.A=this.fb=0}function Fa(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function Za(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new ys,this.f.kb=new Fa,this.sd=null}function Oo(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function Ia(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function fi(q){return alert("todo:WebPSamplerProcessPlane"),q.T}function la(q,Z){var de=q.T,Ie=Z.ba.f.RGBA,Ve=Ie.eb,Ze=Ie.fb+q.ka*Ie.A,et=el[Z.ba.S],at=q.y,ut=q.O,St=q.f,Jt=q.N,Mt=q.ea,vn=q.W,nn=Z.cc,wn=Z.dc,pn=Z.Mc,_t=Z.Nc,en=q.ka,Vn=q.ka+q.T,Yn=q.U,Gn=Yn+1>>1;for(en==0?et(at,ut,null,null,St,Jt,Mt,vn,St,Jt,Mt,vn,Ve,Ze,null,null,Yn):(et(Z.ec,Z.fc,at,ut,nn,wn,pn,_t,St,Jt,Mt,vn,Ve,Ze-Ie.A,Ve,Ze,Yn),++de);en+2<Vn;en+=2)nn=St,wn=Jt,pn=Mt,_t=vn,Jt+=q.Rc,vn+=q.Rc,Ze+=2*Ie.A,et(at,(ut+=2*q.fa)-q.fa,at,ut,nn,wn,pn,_t,St,Jt,Mt,vn,Ve,Ze-Ie.A,Ve,Ze,Yn);return ut+=q.fa,q.j+Vn<q.o?(r(Z.ec,Z.fc,at,ut,Yn),r(Z.cc,Z.dc,St,Jt,Gn),r(Z.Mc,Z.Nc,Mt,vn,Gn),de--):1&Vn||et(at,ut,null,null,St,Jt,Mt,vn,St,Jt,Mt,vn,Ve,Ze+Ie.A,null,null,Yn),de}function Iu(q,Z,de){var Ie=q.F,Ve=[q.J];if(Ie!=null){var Ze=q.U,et=Z.ba.S,at=et==Jo||et==mu;Z=Z.ba.f.RGBA;var ut=[0],St=q.ka;ut[0]=q.T,q.Kb&&(St==0?--ut[0]:(--St,Ve[0]-=q.width),q.j+q.ka+q.T==q.o&&(ut[0]=q.o-q.j-St));var Jt=Z.eb;St=Z.fb+St*Z.A,q=ea(Ie,Ve[0],q.width,Ze,ut,Jt,St+(at?0:3),Z.A),e(de==ut),q&&Pr(et)&&ls(Jt,St,at,Ze,ut,Z.A)}return 0}function zs(q){var Z=q.ma,de=Z.ba.S,Ie=11>de,Ve=de==Mh||de==Rf||de==Jo||de==hl||de==12||Pr(de);if(Z.memory=null,Z.Ib=null,Z.Jb=null,Z.Nd=null,!Wl(Z.Oa,q,Ve?11:12))return 0;if(Ve&&Pr(de)&&rr(),q.da)alert("todo:use_scaling");else{if(Ie){if(Z.Ib=fi,q.Kb){if(de=q.U+1>>1,Z.memory=l(q.U+2*de),Z.memory==null)return 0;Z.ec=Z.memory,Z.fc=0,Z.cc=Z.ec,Z.dc=Z.fc+q.U,Z.Mc=Z.cc,Z.Nc=Z.dc+de,Z.Ib=la,rr()}}else alert("todo:EmitYUV");Ve&&(Z.Jb=Iu,Ie&&dn())}if(Ie&&!$c){for(q=0;256>q;++q)Vu[q]=89858*(q-128)+bc>>Oh,$u[q]=-22014*(q-128)+bc,Dh[q]=-45773*(q-128),Hd[q]=113618*(q-128)+bc>>Oh;for(q=Rh;q<qu;++q)Z=76283*(q-16)+bc>>Oh,Ds[q-Rh]=ul(Z,255),jp[q-Rh]=ul(Z+8>>4,15);$c=1}return 1}function Zt(q){var Z=q.ma,de=q.U,Ie=q.T;return e(!(1&q.ka)),0>=de||0>=Ie?0:(de=Z.Ib(q,Z),Z.Jb!=null&&Z.Jb(q,Z,de),Z.Dc+=de,1)}function Ee(q){q.ma.memory=null}function Re(q,Z,de,Ie){return Be(q,8)!=47?0:(Z[0]=Be(q,14)+1,de[0]=Be(q,14)+1,Ie[0]=Be(q,1),Be(q,3)!=0?0:!q.h)}function tt(q,Z){if(4>q)return q+1;var de=q-2>>1;return(2+(1&q)<<de)+Be(Z,de)+1}function gt(q,Z){return 120<Z?Z-120:1<=(de=((de=Zl[Z-1])>>4)*q+(8-(15&de)))?de:1;var de}function ft(q,Z,de){var Ie=Le(de),Ve=q[Z+=255&Ie].g-8;return 0<Ve&&(ct(de,de.u+8),Ie=Le(de),Z+=q[Z].value,Z+=Ie&(1<<Ve)-1),ct(de,de.u+q[Z].g),q[Z].value}function Tt(q,Z,de){return de.g+=q.g,de.value+=q.value<<Z>>>0,e(8>=de.g),q.g}function Ft(q,Z,de){var Ie=q.xc;return e((Z=Ie==0?0:q.vc[q.md*(de>>Ie)+(Z>>Ie)])<q.Wb),q.Ya[Z]}function Ct(q,Z,de,Ie){var Ve=q.ab,Ze=q.c*Z,et=q.C;Z=et+Z;var at=de,ut=Ie;for(Ie=q.Ta,de=q.Ua;0<Ve--;){var St=q.gc[Ve],Jt=et,Mt=Z,vn=at,nn=ut,wn=(ut=Ie,at=de,St.Ea);switch(e(Jt<Mt),e(Mt<=St.nc),St.hc){case 2:Of(vn,nn,(Mt-Jt)*wn,ut,at);break;case 0:var pn=Jt,_t=Mt,en=ut,Vn=at,Yn=(cr=St).Ea;pn==0&&(co(vn,nn,null,null,1,en,Vn),pi(vn,nn+1,0,0,Yn-1,en,Vn+1),nn+=Yn,Vn+=Yn,++pn);for(var Gn=1<<cr.b,Tr=Gn-1,pr=Rn(Yn,cr.b),ii=cr.K,cr=cr.w+(pn>>cr.b)*pr;pn<_t;){var va=ii,Ea=cr,$i=1;for(dd(vn,nn,en,Vn-Yn,1,en,Vn);$i<Yn;){var ta=($i&~Tr)+Gn;ta>Yn&&(ta=Yn),(0,Kl[va[Ea++]>>8&15])(vn,nn+ +$i,en,Vn+$i-Yn,ta-$i,en,Vn+$i),$i=ta}nn+=Yn,Vn+=Yn,++pn&Tr||(cr+=pr)}Mt!=St.nc&&r(ut,at-wn,ut,at+(Mt-Jt-1)*wn,wn);break;case 1:for(wn=vn,_t=nn,Yn=(vn=St.Ea)-(Vn=vn&~(en=(nn=1<<St.b)-1)),pn=Rn(vn,St.b),Gn=St.K,St=St.w+(Jt>>St.b)*pn;Jt<Mt;){for(Tr=Gn,pr=St,ii=new hr,cr=_t+Vn,va=_t+vn;_t<cr;)wi(Tr[pr++],ii),rf(ii,wn,_t,nn,ut,at),_t+=nn,at+=nn;_t<va&&(wi(Tr[pr++],ii),rf(ii,wn,_t,Yn,ut,at),_t+=Yn,at+=Yn),++Jt&en||(St+=pn)}break;case 3:if(vn==ut&&nn==at&&0<St.b){for(_t=ut,vn=wn=at+(Mt-Jt)*wn-(Vn=(Mt-Jt)*Rn(St.Ea,St.b)),nn=ut,en=at,pn=[],Vn=(Yn=Vn)-1;0<=Vn;--Vn)pn[Vn]=nn[en+Vn];for(Vn=Yn-1;0<=Vn;--Vn)_t[vn+Vn]=pn[Vn];uo(St,Jt,Mt,ut,wn,ut,at)}else uo(St,Jt,Mt,vn,nn,ut,at)}at=Ie,ut=de}ut!=de&&r(Ie,de,at,ut,Ze)}function Ht(q,Z){var de=q.V,Ie=q.Ba+q.c*q.C,Ve=Z-q.C;if(e(Z<=q.l.o),e(16>=Ve),0<Ve){var Ze=q.l,et=q.Ta,at=q.Ua,ut=Ze.width;if(Ct(q,Ve,de,Ie),Ve=at=[at],e((de=q.C)<(Ie=Z)),e(Ze.v<Ze.va),Ie>Ze.o&&(Ie=Ze.o),de<Ze.j){var St=Ze.j-de;de=Ze.j,Ve[0]+=St*ut}if(de>=Ie?de=0:(Ve[0]+=4*Ze.v,Ze.ka=de-Ze.j,Ze.U=Ze.va-Ze.v,Ze.T=Ie-de,de=1),de){if(at=at[0],11>(de=q.ca).S){var Jt=de.f.RGBA,Mt=(Ie=de.S,Ve=Ze.U,Ze=Ze.T,St=Jt.eb,Jt.A),vn=Ze;for(Jt=Jt.fb+q.Ma*Jt.A;0<vn--;){var nn=et,wn=at,pn=Ve,_t=St,en=Jt;switch(Ie){case pu:Al(nn,wn,pn,_t,en);break;case Mh:xo(nn,wn,pn,_t,en);break;case yc:xo(nn,wn,pn,_t,en),ls(_t,en,0,pn,1,0);break;case ua:Tl(nn,wn,pn,_t,en);break;case Rf:mi(nn,wn,pn,_t,en,1);break;case qc:mi(nn,wn,pn,_t,en,1),ls(_t,en,0,pn,1,0);break;case Jo:mi(nn,wn,pn,_t,en,0);break;case mu:mi(nn,wn,pn,_t,en,0),ls(_t,en,1,pn,1,0);break;case hl:Ah(nn,wn,pn,_t,en);break;case Np:Ah(nn,wn,pn,_t,en),Yi(_t,en,pn,1,0);break;case Fu:Lu(nn,wn,pn,_t,en);break;default:e(0)}at+=ut,Jt+=Mt}q.Ma+=Ze}else alert("todo:EmitRescaledRowsYUVA");e(q.Ma<=de.height)}}q.C=Z,e(q.C<=q.i)}function Gt(q){var Z;if(0<q.ua)return 0;for(Z=0;Z<q.Wb;++Z){var de=q.Ya[Z].G,Ie=q.Ya[Z].H;if(0<de[1][Ie[1]+0].g||0<de[2][Ie[2]+0].g||0<de[3][Ie[3]+0].g)return 0}return 1}function $t(q,Z,de,Ie,Ve,Ze){if(q.Z!=0){var et=q.qd,at=q.rd;for(e(fl[q.Z]!=null);Z<de;++Z)fl[q.Z](et,at,Ie,Ve,Ie,Ve,Ze),et=Ie,at=Ve,Ve+=Ze;q.qd=et,q.rd=at}}function Sn(q,Z){var de=q.l.ma,Ie=de.Z==0||de.Z==1?q.l.j:q.C;if(Ie=q.C<Ie?Ie:q.C,e(Z<=q.l.o),Z>Ie){var Ve=q.l.width,Ze=de.ca,et=de.tb+Ve*Ie,at=q.V,ut=q.Ba+q.c*Ie,St=q.gc;e(q.ab==1),e(St[0].hc==3),Sl(St[0],Ie,Z,at,ut,Ze,et),$t(de,Ie,Z,Ze,et,Ve)}q.C=q.Ma=Z}function Nn(q,Z,de,Ie,Ve,Ze,et){var at=q.$/Ie,ut=q.$%Ie,St=q.m,Jt=q.s,Mt=de+q.$,vn=Mt;Ve=de+Ie*Ve;var nn=de+Ie*Ze,wn=280+Jt.ua,pn=q.Pb?at:16777216,_t=0<Jt.ua?Jt.Wa:null,en=Jt.wc,Vn=Mt<nn?Ft(Jt,ut,at):null;e(q.C<Ze),e(nn<=Ve);var Yn=!1;e:for(;;){for(;Yn||Mt<nn;){var Gn=0;if(at>=pn){var Tr=Mt-de;e((pn=q).Pb),pn.wd=pn.m,pn.xd=Tr,0<pn.s.ua&&cn(pn.s.Wa,pn.s.vb),pn=at+$d}if(ut&en||(Vn=Ft(Jt,ut,at)),e(Vn!=null),Vn.Qb&&(Z[Mt]=Vn.qb,Yn=!0),!Yn)if(vt(St),Vn.jc){Gn=St,Tr=Z;var pr=Mt,ii=Vn.pd[Le(Gn)&Ts-1];e(Vn.jc),256>ii.g?(ct(Gn,Gn.u+ii.g),Tr[pr]=ii.value,Gn=0):(ct(Gn,Gn.u+ii.g-256),e(256<=ii.value),Gn=ii.value),Gn==0&&(Yn=!0)}else Gn=ft(Vn.G[0],Vn.H[0],St);if(St.h)break;if(Yn||256>Gn){if(!Yn)if(Vn.nd)Z[Mt]=(Vn.qb|Gn<<8)>>>0;else{if(vt(St),Yn=ft(Vn.G[1],Vn.H[1],St),vt(St),Tr=ft(Vn.G[2],Vn.H[2],St),pr=ft(Vn.G[3],Vn.H[3],St),St.h)break;Z[Mt]=(pr<<24|Yn<<16|Gn<<8|Tr)>>>0}if(Yn=!1,++Mt,++ut>=Ie&&(ut=0,++at,et!=null&&at<=Ze&&!(at%16)&&et(q,at),_t!=null))for(;vn<Mt;)Gn=Z[vn++],_t.X[(506832829*Gn&4294967295)>>>_t.Mb]=Gn}else if(280>Gn){if(Gn=tt(Gn-256,St),Tr=ft(Vn.G[4],Vn.H[4],St),vt(St),Tr=gt(Ie,Tr=tt(Tr,St)),St.h)break;if(Mt-de<Tr||Ve-Mt<Gn)break e;for(pr=0;pr<Gn;++pr)Z[Mt+pr]=Z[Mt+pr-Tr];for(Mt+=Gn,ut+=Gn;ut>=Ie;)ut-=Ie,++at,et!=null&&at<=Ze&&!(at%16)&&et(q,at);if(e(Mt<=Ve),ut&en&&(Vn=Ft(Jt,ut,at)),_t!=null)for(;vn<Mt;)Gn=Z[vn++],_t.X[(506832829*Gn&4294967295)>>>_t.Mb]=Gn}else{if(!(Gn<wn))break e;for(Yn=Gn-280,e(_t!=null);vn<Mt;)Gn=Z[vn++],_t.X[(506832829*Gn&4294967295)>>>_t.Mb]=Gn;Gn=Mt,e(!(Yn>>>(Tr=_t).Xa)),Z[Gn]=Tr.X[Yn],Yn=!0}Yn||e(St.h==Xe(St))}if(q.Pb&&St.h&&Mt<Ve)e(q.m.h),q.a=5,q.m=q.wd,q.$=q.xd,0<q.s.ua&&cn(q.s.vb,q.s.Wa);else{if(St.h)break e;et!=null&&et(q,at>Ze?Ze:at),q.a=0,q.$=Mt-de}return 1}return q.a=3,0}function qn(q){e(q!=null),q.vc=null,q.yc=null,q.Ya=null;var Z=q.Wa;Z!=null&&(Z.X=null),q.vb=null,e(q!=null)}function vr(){var q=new Dm;return q==null?null:(q.a=0,q.xb=zf,ti("Predictor","VP8LPredictors"),ti("Predictor","VP8LPredictors_C"),ti("PredictorAdd","VP8LPredictorsAdd"),ti("PredictorAdd","VP8LPredictorsAdd_C"),Of=Li,rf=xn,Al=hn,xo=er,Ah=yr,Lu=Vi,Tl=ki,be.VP8LMapColor32b=Rs,be.VP8LMapColor8b=Du,q)}function Or(q,Z,de,Ie,Ve){var Ze=1,et=[q],at=[Z],ut=Ie.m,St=Ie.s,Jt=null,Mt=0;e:for(;;){if(de)for(;Ze&&Be(ut,1);){var vn=et,nn=at,wn=Ie,pn=1,_t=wn.m,en=wn.gc[wn.ab],Vn=Be(_t,2);if(wn.Oc&1<<Vn)Ze=0;else{switch(wn.Oc|=1<<Vn,en.hc=Vn,en.Ea=vn[0],en.nc=nn[0],en.K=[null],++wn.ab,e(4>=wn.ab),Vn){case 0:case 1:en.b=Be(_t,3)+2,pn=Or(Rn(en.Ea,en.b),Rn(en.nc,en.b),0,wn,en.K),en.K=en.K[0];break;case 3:var Yn,Gn=Be(_t,8)+1,Tr=16<Gn?0:4<Gn?1:2<Gn?2:3;if(vn[0]=Rn(en.Ea,Tr),en.b=Tr,Yn=pn=Or(Gn,1,0,wn,en.K)){var pr,ii=Gn,cr=en,va=1<<(8>>cr.b),Ea=l(va);if(Ea==null)Yn=0;else{var $i=cr.K[0],ta=cr.w;for(Ea[0]=cr.K[0][0],pr=1;pr<1*ii;++pr)Ea[pr]=Dn($i[ta+pr],Ea[pr-1]);for(;pr<4*va;++pr)Ea[pr]=0;cr.K[0]=null,cr.K[0]=Ea,Yn=1}}pn=Yn;break;case 2:break;default:e(0)}Ze=pn}}if(et=et[0],at=at[0],Ze&&Be(ut,1)&&!(Ze=1<=(Mt=Be(ut,4))&&11>=Mt)){Ie.a=3;break e}var Ga;if(Ga=Ze)t:{var Bi,vi,cs,Ba=Ie,ji=et,fo=at,ba=Mt,is=de,bi=Ba.m,ka=Ba.s,$s=[null],wo=1,nl=0,Cl=_c[ba];n:for(;;){if(is&&Be(bi,1)){var Es=Be(bi,3)+2,Il=Rn(ji,Es),xc=Rn(fo,Es),En=Il*xc;if(!Or(Il,xc,0,Ba,$s))break n;for($s=$s[0],ka.xc=Es,Bi=0;Bi<En;++Bi){var Fn=$s[Bi]>>8&65535;$s[Bi]=Fn,Fn>=wo&&(wo=Fn+1)}}if(bi.h)break n;for(vi=0;5>vi;++vi){var Wa=Qo[vi];!vi&&0<ba&&(Wa+=1<<ba),nl<Wa&&(nl=Wa)}var Ra=f(wo*Cl,we),qt=wo,Up=f(qt,De);if(Up==null)var sf=null;else e(65536>=qt),sf=Up;var of=l(nl);if(sf==null||of==null||Ra==null){Ba.a=1;break n}var lf=Ra;for(Bi=cs=0;Bi<wo;++Bi){var wc=sf[Bi],cf=wc.G,Hc=wc.H,Nm=0,Gd=1,zm=0;for(vi=0;5>vi;++vi){Wa=Qo[vi],cf[vi]=lf,Hc[vi]=cs,!vi&&0<ba&&(Wa+=1<<ba);i:{var uf,Pl=Wa,Ff=Ba,Hu=of,Gu=lf,Wd=cs,Wu=0,rl=Ff.m,Bm=Be(rl,1);if(s(Hu,0,0,Pl),Bm){var eo=Be(rl,1)+1,Pg=Be(rl,1),hf=Be(rl,Pg==0?1:8);Hu[hf]=1,eo==2&&(Hu[hf=Be(rl,8)]=1);var na=1}else{var Mi=l(19),Kd=Be(rl,4)+4;if(19<Kd){Ff.a=3;var Sc=0;break i}for(uf=0;uf<Kd;++uf)Mi[_a[uf]]=Be(rl,3);var Lh=void 0,Ac=void 0,Ku=Ff,vd=Mi,Uf=Pl,Ol=Hu,bd=0,So=Ku.m,kh=8,Yd=f(128,we);r:for(;ue(Yd,0,7,vd,19);){if(Be(So,1)){var Xd=2+2*Be(So,3);if((Lh=2+Be(So,Xd))>Uf)break r}else Lh=Uf;for(Ac=0;Ac<Uf&&Lh--;){vt(So);var ff=Yd[0+(127&Le(So))];ct(So,So.u+ff.g);var Yu=ff.value;if(16>Yu)Ol[Ac++]=Yu,Yu!=0&&(kh=Yu);else{var Xu=Yu==16,Zd=Yu-16,Nh=Lf[Zd],Tc=Be(So,Df[Zd])+Nh;if(Ac+Tc>Uf)break r;for(var _u=Xu?kh:0;0<Tc--;)Ol[Ac++]=_u}}bd=1;break r}bd||(Ku.a=3),na=bd}(na=na&&!rl.h)&&(Wu=ue(Gu,Wd,8,Hu,Pl)),na&&Wu!=0?Sc=Wu:(Ff.a=3,Sc=0)}if(Sc==0)break n;if(Gd&&Ha[vi]==1&&(Gd=lf[cs].g==0),Nm+=lf[cs].g,cs+=Sc,3>=vi){var Jl,vu=of[0];for(Jl=1;Jl<Wa;++Jl)of[Jl]>vu&&(vu=of[Jl]);zm+=vu}}if(wc.nd=Gd,wc.Qb=0,Gd&&(wc.qb=(cf[3][Hc[3]+0].value<<24|cf[1][Hc[1]+0].value<<16|cf[2][Hc[2]+0].value)>>>0,Nm==0&&256>cf[0][Hc[0]+0].value&&(wc.Qb=1,wc.qb+=cf[0][Hc[0]+0].value<<8)),wc.jc=!wc.Qb&&6>zm,wc.jc){var Ms,Ql=wc;for(Ms=0;Ms<Ts;++Ms){var Gc=Ms,Hs=Ql.pd[Gc],Ec=Ql.G[0][Ql.H[0]+Gc];256<=Ec.value?(Hs.g=Ec.g+256,Hs.value=Ec.value):(Hs.g=0,Hs.value=0,Gc>>=Tt(Ec,8,Hs),Gc>>=Tt(Ql.G[1][Ql.H[1]+Gc],16,Hs),Gc>>=Tt(Ql.G[2][Ql.H[2]+Gc],0,Hs),Tt(Ql.G[3][Ql.H[3]+Gc],24,Hs))}}}ka.vc=$s,ka.Wb=wo,ka.Ya=sf,ka.yc=Ra,Ga=1;break t}Ga=0}if(!(Ze=Ga)){Ie.a=3;break e}if(0<Mt){if(St.ua=1<<Mt,!Ut(St.Wa,Mt)){Ie.a=1,Ze=0;break e}}else St.ua=0;var df=Ie,Jd=et,qf=at,pf=df.s,zh=pf.xc;if(df.c=Jd,df.i=qf,pf.md=Rn(Jd,zh),pf.wc=zh==0?-1:(1<<zh)-1,de){Ie.xb=Ig;break e}if((Jt=l(et*at))==null){Ie.a=1,Ze=0;break e}Ze=(Ze=Nn(Ie,Jt,0,et,at,at,null))&&!ut.h;break e}return Ze?(Ve!=null?Ve[0]=Jt:(e(Jt==null),e(de)),Ie.$=0,de||qn(St)):qn(St),Ze}function Rr(q,Z){var de=q.c*q.i,Ie=de+Z+16*Z;return e(q.c<=Z),q.V=l(Ie),q.V==null?(q.Ta=null,q.Ua=0,q.a=1,0):(q.Ta=q.V,q.Ua=q.Ba+de+Z,1)}function qr(q,Z){var de=q.C,Ie=Z-de,Ve=q.V,Ze=q.Ba+q.c*de;for(e(Z<=q.l.o);0<Ie;){var et=16<Ie?16:Ie,at=q.l.ma,ut=q.l.width,St=ut*et,Jt=at.ca,Mt=at.tb+ut*de,vn=q.Ta,nn=q.Ua;Ct(q,et,Ve,Ze),$a(vn,nn,Jt,Mt,St),$t(at,de,de+et,Jt,Mt,ut),Ie-=et,Ve+=et*q.c,de+=et}e(de==Z),q.C=q.Ma=Z}function Ri(){this.ub=this.yd=this.td=this.Rb=0}function Xi(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function Hr(){this.Fb=this.Bb=this.Cb=0,this.Zb=l(4),this.Lb=l(4)}function gi(){this.Yb=function(){var q=[];return function Z(de,Ie,Ve){for(var Ze=Ve[Ie],et=0;et<Ze&&(de.push(Ve.length>Ie+1?[]:0),!(Ve.length<Ie+1));et++)Z(de[et],Ie+1,Ve)}(q,0,[3,11]),q}()}function Gr(){this.jb=l(3),this.Wc=i([4,8],gi),this.Xc=i([4,17],gi)}function Ni(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new l(4),this.od=new l(4)}function Pa(){this.ld=this.La=this.dd=this.tc=0}function Ua(){this.Na=this.la=0}function _s(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function vs(){this.ad=l(384),this.Za=0,this.Ob=l(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function Ro(){this.uc=this.M=this.Nb=0,this.wa=Array(new Pa),this.Y=0,this.ya=Array(new vs),this.aa=0,this.l=new iu}function bs(){this.y=l(16),this.f=l(8),this.ea=l(8)}function Bs(){this.cb=this.a=0,this.sc="",this.m=new bt,this.Od=new Ri,this.Kc=new Xi,this.ed=new Ni,this.Qa=new Hr,this.Ic=this.$c=this.Aa=0,this.D=new Ro,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=f(8,bt),this.ia=0,this.pb=f(4,_s),this.Pa=new Gr,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new bs),this.Hd=0,this.rb=Array(new Ua),this.sb=0,this.wa=Array(new Pa),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new vs),this.L=this.aa=0,this.gd=i([4,2],Pa),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function iu(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function Wo(){var q=new Bs;return q!=null&&(q.a=0,q.sc="OK",q.cb=0,q.Xb=0,Ch||(Ch=gh)),q}function Oa(q,Z,de){return q.a==0&&(q.a=Z,q.sc=de,q.cb=0),0}function Fl(q,Z,de){return 3<=de&&q[Z+0]==157&&q[Z+1]==1&&q[Z+2]==42}function Do(q,Z){if(q==null)return 0;if(q.a=0,q.sc="OK",Z==null)return Oa(q,2,"null VP8Io passed to VP8GetHeaders()");var de=Z.data,Ie=Z.w,Ve=Z.ha;if(4>Ve)return Oa(q,7,"Truncated header.");var Ze=de[Ie+0]|de[Ie+1]<<8|de[Ie+2]<<16,et=q.Od;if(et.Rb=!(1&Ze),et.td=Ze>>1&7,et.yd=Ze>>4&1,et.ub=Ze>>5,3<et.td)return Oa(q,3,"Incorrect keyframe parameters.");if(!et.yd)return Oa(q,4,"Frame not displayable.");Ie+=3,Ve-=3;var at=q.Kc;if(et.Rb){if(7>Ve)return Oa(q,7,"cannot parse picture header");if(!Fl(de,Ie,Ve))return Oa(q,3,"Bad code word");at.c=16383&(de[Ie+4]<<8|de[Ie+3]),at.Td=de[Ie+4]>>6,at.i=16383&(de[Ie+6]<<8|de[Ie+5]),at.Ud=de[Ie+6]>>6,Ie+=7,Ve-=7,q.za=at.c+15>>4,q.Ub=at.i+15>>4,Z.width=at.c,Z.height=at.i,Z.Da=0,Z.j=0,Z.v=0,Z.va=Z.width,Z.o=Z.height,Z.da=0,Z.ib=Z.width,Z.hb=Z.height,Z.U=Z.width,Z.T=Z.height,s((Ze=q.Pa).jb,0,255,Ze.jb.length),e((Ze=q.Qa)!=null),Ze.Cb=0,Ze.Bb=0,Ze.Fb=1,s(Ze.Zb,0,0,Ze.Zb.length),s(Ze.Lb,0,0,Ze.Lb)}if(et.ub>Ve)return Oa(q,7,"bad partition length");je(Ze=q.m,de,Ie,et.ub),Ie+=et.ub,Ve-=et.ub,et.Rb&&(at.Ld=mt(Ze),at.Kd=mt(Ze)),at=q.Qa;var ut,St=q.Pa;if(e(Ze!=null),e(at!=null),at.Cb=mt(Ze),at.Cb){if(at.Bb=mt(Ze),mt(Ze)){for(at.Fb=mt(Ze),ut=0;4>ut;++ut)at.Zb[ut]=mt(Ze)?Ue(Ze,7):0;for(ut=0;4>ut;++ut)at.Lb[ut]=mt(Ze)?Ue(Ze,6):0}if(at.Bb)for(ut=0;3>ut;++ut)St.jb[ut]=mt(Ze)?ze(Ze,8):255}else at.Bb=0;if(Ze.Ka)return Oa(q,3,"cannot parse segment header");if((at=q.ed).zd=mt(Ze),at.Tb=ze(Ze,6),at.wb=ze(Ze,3),at.Pc=mt(Ze),at.Pc&&mt(Ze)){for(St=0;4>St;++St)mt(Ze)&&(at.vd[St]=Ue(Ze,6));for(St=0;4>St;++St)mt(Ze)&&(at.od[St]=Ue(Ze,6))}if(q.L=at.Tb==0?0:at.zd?1:2,Ze.Ka)return Oa(q,3,"cannot parse filter header");var Jt=Ve;if(Ve=ut=Ie,Ie=ut+Jt,at=Jt,q.Xb=(1<<ze(q.m,2))-1,Jt<3*(St=q.Xb))de=7;else{for(ut+=3*St,at-=3*St,Jt=0;Jt<St;++Jt){var Mt=de[Ve+0]|de[Ve+1]<<8|de[Ve+2]<<16;Mt>at&&(Mt=at),je(q.Jc[+Jt],de,ut,Mt),ut+=Mt,at-=Mt,Ve+=3}je(q.Jc[+St],de,ut,at),de=ut<Ie?0:5}if(de!=0)return Oa(q,de,"cannot parse partitions");for(de=ze(ut=q.m,7),Ve=mt(ut)?Ue(ut,4):0,Ie=mt(ut)?Ue(ut,4):0,at=mt(ut)?Ue(ut,4):0,St=mt(ut)?Ue(ut,4):0,ut=mt(ut)?Ue(ut,4):0,Jt=q.Qa,Mt=0;4>Mt;++Mt){if(Jt.Cb){var vn=Jt.Zb[Mt];Jt.Fb||(vn+=de)}else{if(0<Mt){q.pb[Mt]=q.pb[0];continue}vn=de}var nn=q.pb[Mt];nn.Sc[0]=gu[ul(vn+Ve,127)],nn.Sc[1]=md[ul(vn+0,127)],nn.Eb[0]=2*gu[ul(vn+Ie,127)],nn.Eb[1]=101581*md[ul(vn+at,127)]>>16,8>nn.Eb[1]&&(nn.Eb[1]=8),nn.Qc[0]=gu[ul(vn+St,117)],nn.Qc[1]=md[ul(vn+ut,127)],nn.lc=vn+ut}if(!et.Rb)return Oa(q,4,"Not a key frame.");for(mt(Ze),et=q.Pa,de=0;4>de;++de){for(Ve=0;8>Ve;++Ve)for(Ie=0;3>Ie;++Ie)for(at=0;11>at;++at)St=yt(Ze,af[de][Ve][Ie][at])?ze(Ze,8):gd[de][Ve][Ie][at],et.Wc[de][Ve].Yb[Ie][at]=St;for(Ve=0;17>Ve;++Ve)et.Xc[de][Ve]=et.Wc[de][Cg[Ve]]}return q.kc=mt(Ze),q.kc&&(q.Bd=ze(Ze,8)),q.cb=1}function gh(q,Z,de,Ie,Ve,Ze,et){var at=Z[Ve].Yb[de];for(de=0;16>Ve;++Ve){if(!yt(q,at[de+0]))return Ve;for(;!yt(q,at[de+1]);)if(at=Z[++Ve].Yb[0],de=0,Ve==16)return 16;var ut=Z[Ve+1].Yb;if(yt(q,at[de+2])){var St=q,Jt=0;if(yt(St,(vn=at)[(Mt=de)+3]))if(yt(St,vn[Mt+6])){for(at=0,Mt=2*(Jt=yt(St,vn[Mt+8]))+(vn=yt(St,vn[Mt+9+Jt])),Jt=0,vn=kf[Mt];vn[at];++at)Jt+=Jt+yt(St,vn[at]);Jt+=3+(8<<Mt)}else yt(St,vn[Mt+7])?(Jt=7+2*yt(St,165),Jt+=yt(St,145)):Jt=5+yt(St,159);else Jt=yt(St,vn[Mt+4])?3+yt(St,vn[Mt+5]):2;at=ut[2]}else Jt=1,at=ut[1];ut=et+Nf[Ve],0>(St=q).b&&Nt(St);var Mt,vn=St.b,nn=(Mt=St.Ca>>1)-(St.I>>vn)>>31;--St.b,St.Ca+=nn,St.Ca|=1,St.I-=(Mt+1&nn)<<vn,Ze[ut]=((Jt^nn)-nn)*Ie[(0<Ve)+0]}return 16}function Pu(q){var Z=q.rb[q.sb-1];Z.la=0,Z.Na=0,s(q.zc,0,0,q.zc.length),q.ja=0}function Jh(q,Z){if(q==null)return 0;if(Z==null)return Oa(q,2,"NULL VP8Io parameter in VP8Decode().");if(!q.cb&&!Do(q,Z))return 0;if(e(q.cb),Z.ac==null||Z.ac(Z)){Z.ob&&(q.L=0);var de=_d[q.L];if(q.L==2?(q.yb=0,q.zb=0):(q.yb=Z.v-de>>4,q.zb=Z.j-de>>4,0>q.yb&&(q.yb=0),0>q.zb&&(q.zb=0)),q.Va=Z.o+15+de>>4,q.Hb=Z.va+15+de>>4,q.Hb>q.za&&(q.Hb=q.za),q.Va>q.Ub&&(q.Va=q.Ub),0<q.L){var Ie=q.ed;for(de=0;4>de;++de){var Ve;if(q.Qa.Cb){var Ze=q.Qa.Lb[de];q.Qa.Fb||(Ze+=Ie.Tb)}else Ze=Ie.Tb;for(Ve=0;1>=Ve;++Ve){var et=q.gd[de][Ve],at=Ze;if(Ie.Pc&&(at+=Ie.vd[0],Ve&&(at+=Ie.od[0])),0<(at=0>at?0:63<at?63:at)){var ut=at;0<Ie.wb&&(ut=4<Ie.wb?ut>>2:ut>>1)>9-Ie.wb&&(ut=9-Ie.wb),1>ut&&(ut=1),et.dd=ut,et.tc=2*at+ut,et.ld=40<=at?2:15<=at?1:0}else et.tc=0;et.La=Ve}}}de=0}else Oa(q,6,"Frame setup failed"),de=q.a;if(de=de==0){if(de){q.$c=0,0<q.Aa||(q.Ic=Qs);e:{de=q.Ic,Ie=4*(ut=q.za);var St=32*ut,Jt=ut+1,Mt=0<q.L?ut*(0<q.Aa?2:1):0,vn=(q.Aa==2?2:1)*ut;if((et=Ie+832+(Ve=3*(16*de+_d[q.L])/2*St)+(Ze=q.Fa!=null&&0<q.Fa.length?q.Kc.c*q.Kc.i:0))!=et)de=0;else{if(et>q.Vb){if(q.Vb=0,q.Ec=l(et),q.Fc=0,q.Ec==null){de=Oa(q,1,"no memory during frame initialization.");break e}q.Vb=et}et=q.Ec,at=q.Fc,q.Ac=et,q.Bc=at,at+=Ie,q.Gd=f(St,bs),q.Hd=0,q.rb=f(Jt+1,Ua),q.sb=1,q.wa=Mt?f(Mt,Pa):null,q.Y=0,q.D.Nb=0,q.D.wa=q.wa,q.D.Y=q.Y,0<q.Aa&&(q.D.Y+=ut),e(!0),q.oc=et,q.pc=at,at+=832,q.ya=f(vn,vs),q.aa=0,q.D.ya=q.ya,q.D.aa=q.aa,q.Aa==2&&(q.D.aa+=ut),q.R=16*ut,q.B=8*ut,ut=(St=_d[q.L])*q.R,St=St/2*q.B,q.sa=et,q.ta=at+ut,q.qa=q.sa,q.ra=q.ta+16*de*q.R+St,q.Ha=q.qa,q.Ia=q.ra+8*de*q.B+St,q.$c=0,at+=Ve,q.mb=Ze?et:null,q.nb=Ze?at:null,e(at+Ze<=q.Fc+q.Vb),Pu(q),s(q.Ac,q.Bc,0,Ie),de=1}}if(de){if(Z.ka=0,Z.y=q.sa,Z.O=q.ta,Z.f=q.qa,Z.N=q.ra,Z.ea=q.Ha,Z.Vd=q.Ia,Z.fa=q.R,Z.Rc=q.B,Z.F=null,Z.J=0,!Xl){for(de=-255;255>=de;++de)rs[255+de]=0>de?-de:de;for(de=-1020;1020>=de;++de)Yl[1020+de]=-128>de?-128:127<de?127:de;for(de=-112;112>=de;++de)Bu[112+de]=-16>de?-16:15<de?15:de;for(de=-255;510>=de;++de)Zo[255+de]=0>de?0:255<de?255:de;Xl=1}hu=yh,pc=Ul,pd=cc,Zs=so,ho=ko,Va=Lo,Th=Xo,Eh=qa,Js=ns,ku=Pf,fu=Us,mc=Vl,Nu=Bo,gc=bh,zu=lu,du=Yo,Uc=os,jo=Fc,Vc[0]=js,Vc[1]=ud,Vc[2]=ef,Vc[3]=Si,Vc[4]=au,Vc[5]=Jn,Vc[6]=su,Vc[7]=ri,Vc[8]=Fs,Vc[9]=_i,yu[0]=Ei,yu[1]=No,yu[2]=jc,yu[3]=Qh,yu[4]=oo,yu[5]=dr,yu[6]=Ru,vc[0]=uc,vc[1]=ql,vc[2]=_h,vc[3]=li,vc[4]=za,vc[5]=xs,vc[6]=Ta,de=1}else de=0}de&&(de=function(nn,wn){for(nn.M=0;nn.M<nn.Va;++nn.M){var pn,_t=nn.Jc[nn.M&nn.Xb],en=nn.m,Vn=nn;for(pn=0;pn<Vn.za;++pn){var Yn=en,Gn=Vn,Tr=Gn.Ac,pr=Gn.Bc+4*pn,ii=Gn.zc,cr=Gn.ya[Gn.aa+pn];if(Gn.Qa.Bb?cr.$b=yt(Yn,Gn.Pa.jb[0])?2+yt(Yn,Gn.Pa.jb[2]):yt(Yn,Gn.Pa.jb[1]):cr.$b=0,Gn.kc&&(cr.Ad=yt(Yn,Gn.Bd)),cr.Za=!yt(Yn,145)+0,cr.Za){var va=cr.Ob,Ea=0;for(Gn=0;4>Gn;++Gn){var $i,ta=ii[0+Gn];for($i=0;4>$i;++$i){ta=Lm[Tr[pr+$i]][ta];for(var Ga=Ih[yt(Yn,ta[0])];0<Ga;)Ga=Ih[2*Ga+yt(Yn,ta[Ga])];ta=-Ga,Tr[pr+$i]=ta}r(va,Ea,Tr,pr,4),Ea+=4,ii[0+Gn]=ta}}else ta=yt(Yn,156)?yt(Yn,128)?1:3:yt(Yn,163)?2:0,cr.Ob[0]=ta,s(Tr,pr,ta,4),s(ii,0,ta,4);cr.Dd=yt(Yn,142)?yt(Yn,114)?yt(Yn,183)?1:3:2:0}if(Vn.m.Ka)return Oa(nn,7,"Premature end-of-partition0 encountered.");for(;nn.ja<nn.za;++nn.ja){if(Vn=_t,Yn=(en=nn).rb[en.sb-1],Tr=en.rb[en.sb+en.ja],pn=en.ya[en.aa+en.ja],pr=en.kc?pn.Ad:0)Yn.la=Tr.la=0,pn.Za||(Yn.Na=Tr.Na=0),pn.Hc=0,pn.Gc=0,pn.ia=0;else{var Bi,vi;if(Yn=Tr,Tr=Vn,pr=en.Pa.Xc,ii=en.ya[en.aa+en.ja],cr=en.pb[ii.$b],Gn=ii.ad,va=0,Ea=en.rb[en.sb-1],ta=$i=0,s(Gn,va,0,384),ii.Za)var cs=0,Ba=pr[3];else{Ga=l(16);var ji=Yn.Na+Ea.Na;if(ji=Ch(Tr,pr[1],ji,cr.Eb,0,Ga,0),Yn.Na=Ea.Na=(0<ji)+0,1<ji)hu(Ga,0,Gn,va);else{var fo=Ga[0]+3>>3;for(Ga=0;256>Ga;Ga+=16)Gn[va+Ga]=fo}cs=1,Ba=pr[0]}var ba=15&Yn.la,is=15&Ea.la;for(Ga=0;4>Ga;++Ga){var bi=1&is;for(fo=vi=0;4>fo;++fo)ba=ba>>1|(bi=(ji=Ch(Tr,Ba,ji=bi+(1&ba),cr.Sc,cs,Gn,va))>cs)<<7,vi=vi<<2|(3<ji?3:1<ji?2:Gn[va+0]!=0),va+=16;ba>>=4,is=is>>1|bi<<7,$i=($i<<8|vi)>>>0}for(Ba=ba,cs=is>>4,Bi=0;4>Bi;Bi+=2){for(vi=0,ba=Yn.la>>4+Bi,is=Ea.la>>4+Bi,Ga=0;2>Ga;++Ga){for(bi=1&is,fo=0;2>fo;++fo)ji=bi+(1&ba),ba=ba>>1|(bi=0<(ji=Ch(Tr,pr[2],ji,cr.Qc,0,Gn,va)))<<3,vi=vi<<2|(3<ji?3:1<ji?2:Gn[va+0]!=0),va+=16;ba>>=2,is=is>>1|bi<<5}ta|=vi<<4*Bi,Ba|=ba<<4<<Bi,cs|=(240&is)<<Bi}Yn.la=Ba,Ea.la=cs,ii.Hc=$i,ii.Gc=ta,ii.ia=43690&ta?0:cr.ia,pr=!($i|ta)}if(0<en.L&&(en.wa[en.Y+en.ja]=en.gd[pn.$b][pn.Za],en.wa[en.Y+en.ja].La|=!pr),Vn.Ka)return Oa(nn,7,"Premature end-of-file encountered.")}if(Pu(nn),en=wn,Vn=1,pn=(_t=nn).D,Yn=0<_t.L&&_t.M>=_t.zb&&_t.M<=_t.Va,_t.Aa==0)e:{if(pn.M=_t.M,pn.uc=Yn,br(_t,pn),Vn=1,pn=(vi=_t.D).Nb,Yn=(ta=_d[_t.L])*_t.R,Tr=ta/2*_t.B,Ga=16*pn*_t.R,fo=8*pn*_t.B,pr=_t.sa,ii=_t.ta-Yn+Ga,cr=_t.qa,Gn=_t.ra-Tr+fo,va=_t.Ha,Ea=_t.Ia-Tr+fo,is=(ba=vi.M)==0,$i=ba>=_t.Va-1,_t.Aa==2&&br(_t,vi),vi.uc)for(bi=(ji=_t).D.M,e(ji.D.uc),vi=ji.yb;vi<ji.Hb;++vi){cs=vi,Ba=bi;var ka=($s=(Wa=ji).D).Nb;Bi=Wa.R;var $s=$s.wa[$s.Y+cs],wo=Wa.sa,nl=Wa.ta+16*ka*Bi+16*cs,Cl=$s.dd,Es=$s.tc;if(Es!=0)if(e(3<=Es),Wa.L==1)0<cs&&du(wo,nl,Bi,Es+4),$s.La&&jo(wo,nl,Bi,Es),0<Ba&&zu(wo,nl,Bi,Es+4),$s.La&&Uc(wo,nl,Bi,Es);else{var Il=Wa.B,xc=Wa.qa,En=Wa.ra+8*ka*Il+8*cs,Fn=Wa.Ha,Wa=Wa.Ia+8*ka*Il+8*cs;ka=$s.ld,0<cs&&(Eh(wo,nl,Bi,Es+4,Cl,ka),ku(xc,En,Fn,Wa,Il,Es+4,Cl,ka)),$s.La&&(mc(wo,nl,Bi,Es,Cl,ka),gc(xc,En,Fn,Wa,Il,Es,Cl,ka)),0<Ba&&(Th(wo,nl,Bi,Es+4,Cl,ka),Js(xc,En,Fn,Wa,Il,Es+4,Cl,ka)),$s.La&&(fu(wo,nl,Bi,Es,Cl,ka),Nu(xc,En,Fn,Wa,Il,Es,Cl,ka))}}if(_t.ia&&alert("todo:DitherRow"),en.put!=null){if(vi=16*ba,ba=16*(ba+1),is?(en.y=_t.sa,en.O=_t.ta+Ga,en.f=_t.qa,en.N=_t.ra+fo,en.ea=_t.Ha,en.W=_t.Ia+fo):(vi-=ta,en.y=pr,en.O=ii,en.f=cr,en.N=Gn,en.ea=va,en.W=Ea),$i||(ba-=ta),ba>en.o&&(ba=en.o),en.F=null,en.J=null,_t.Fa!=null&&0<_t.Fa.length&&vi<ba&&(en.J=fd(_t,en,vi,ba-vi),en.F=_t.mb,en.F==null&&en.F.length==0)){Vn=Oa(_t,3,"Could not decode alpha data.");break e}vi<en.j&&(ta=en.j-vi,vi=en.j,e(!(1&ta)),en.O+=_t.R*ta,en.N+=_t.B*(ta>>1),en.W+=_t.B*(ta>>1),en.F!=null&&(en.J+=en.width*ta)),vi<ba&&(en.O+=en.v,en.N+=en.v>>1,en.W+=en.v>>1,en.F!=null&&(en.J+=en.v),en.ka=vi-en.j,en.U=en.va-en.v,en.T=ba-vi,Vn=en.put(en))}pn+1!=_t.Ic||$i||(r(_t.sa,_t.ta-Yn,pr,ii+16*_t.R,Yn),r(_t.qa,_t.ra-Tr,cr,Gn+8*_t.B,Tr),r(_t.Ha,_t.Ia-Tr,va,Ea+8*_t.B,Tr))}if(!Vn)return Oa(nn,6,"Output aborted.")}return 1}(q,Z)),Z.bc!=null&&Z.bc(Z),de&=1}return de?(q.cb=0,de):0}function lc(q,Z,de,Ie,Ve){Ve=q[Z+de+32*Ie]+(Ve>>3),q[Z+de+32*Ie]=-256&Ve?0>Ve?0:255:Ve}function Ou(q,Z,de,Ie,Ve,Ze){lc(q,Z,0,de,Ie+Ve),lc(q,Z,1,de,Ie+Ze),lc(q,Z,2,de,Ie-Ze),lc(q,Z,3,de,Ie-Ve)}function cl(q){return(20091*q>>16)+q}function Ys(q,Z,de,Ie){var Ve,Ze=0,et=l(16);for(Ve=0;4>Ve;++Ve){var at=q[Z+0]+q[Z+8],ut=q[Z+0]-q[Z+8],St=(35468*q[Z+4]>>16)-cl(q[Z+12]),Jt=cl(q[Z+4])+(35468*q[Z+12]>>16);et[Ze+0]=at+Jt,et[Ze+1]=ut+St,et[Ze+2]=ut-St,et[Ze+3]=at-Jt,Ze+=4,Z++}for(Ve=Ze=0;4>Ve;++Ve)at=(q=et[Ze+0]+4)+et[Ze+8],ut=q-et[Ze+8],St=(35468*et[Ze+4]>>16)-cl(et[Ze+12]),lc(de,Ie,0,0,at+(Jt=cl(et[Ze+4])+(35468*et[Ze+12]>>16))),lc(de,Ie,1,0,ut+St),lc(de,Ie,2,0,ut-St),lc(de,Ie,3,0,at-Jt),Ze++,Ie+=32}function Lo(q,Z,de,Ie){var Ve=q[Z+0]+4,Ze=35468*q[Z+4]>>16,et=cl(q[Z+4]),at=35468*q[Z+1]>>16;Ou(de,Ie,0,Ve+et,q=cl(q[Z+1]),at),Ou(de,Ie,1,Ve+Ze,q,at),Ou(de,Ie,2,Ve-Ze,q,at),Ou(de,Ie,3,Ve-et,q,at)}function Ul(q,Z,de,Ie,Ve){Ys(q,Z,de,Ie),Ve&&Ys(q,Z+16,de,Ie+4)}function cc(q,Z,de,Ie){pc(q,Z+0,de,Ie,1),pc(q,Z+32,de,Ie+128,1)}function so(q,Z,de,Ie){var Ve;for(q=q[Z+0]+4,Ve=0;4>Ve;++Ve)for(Z=0;4>Z;++Z)lc(de,Ie,Z,Ve,q)}function ko(q,Z,de,Ie){q[Z+0]&&Zs(q,Z+0,de,Ie),q[Z+16]&&Zs(q,Z+16,de,Ie+4),q[Z+32]&&Zs(q,Z+32,de,Ie+128),q[Z+48]&&Zs(q,Z+48,de,Ie+128+4)}function yh(q,Z,de,Ie){var Ve,Ze=l(16);for(Ve=0;4>Ve;++Ve){var et=q[Z+0+Ve]+q[Z+12+Ve],at=q[Z+4+Ve]+q[Z+8+Ve],ut=q[Z+4+Ve]-q[Z+8+Ve],St=q[Z+0+Ve]-q[Z+12+Ve];Ze[0+Ve]=et+at,Ze[8+Ve]=et-at,Ze[4+Ve]=St+ut,Ze[12+Ve]=St-ut}for(Ve=0;4>Ve;++Ve)et=(q=Ze[0+4*Ve]+3)+Ze[3+4*Ve],at=Ze[1+4*Ve]+Ze[2+4*Ve],ut=Ze[1+4*Ve]-Ze[2+4*Ve],St=q-Ze[3+4*Ve],de[Ie+0]=et+at>>3,de[Ie+16]=St+ut>>3,de[Ie+32]=et-at>>3,de[Ie+48]=St-ut>>3,Ie+=64}function Bc(q,Z,de){var Ie,Ve=Z-32,Ze=El,et=255-q[Ve-1];for(Ie=0;Ie<de;++Ie){var at,ut=Ze,St=et+q[Z-1];for(at=0;at<de;++at)q[Z+at]=ut[St+q[Ve+at]];Z+=32}}function ud(q,Z){Bc(q,Z,4)}function ql(q,Z){Bc(q,Z,8)}function No(q,Z){Bc(q,Z,16)}function jc(q,Z){var de;for(de=0;16>de;++de)r(q,Z+32*de,q,Z-32,16)}function Qh(q,Z){var de;for(de=16;0<de;--de)s(q,Z,q[Z-1],16),Z+=32}function Ko(q,Z,de){var Ie;for(Ie=0;16>Ie;++Ie)s(Z,de+32*Ie,q,16)}function Ei(q,Z){var de,Ie=16;for(de=0;16>de;++de)Ie+=q[Z-1+32*de]+q[Z+de-32];Ko(Ie>>5,q,Z)}function oo(q,Z){var de,Ie=8;for(de=0;16>de;++de)Ie+=q[Z-1+32*de];Ko(Ie>>4,q,Z)}function dr(q,Z){var de,Ie=8;for(de=0;16>de;++de)Ie+=q[Z+de-32];Ko(Ie>>4,q,Z)}function Ru(q,Z){Ko(128,q,Z)}function yi(q,Z,de){return q+2*Z+de+2>>2}function ef(q,Z){var de,Ie=Z-32;for(Ie=new Uint8Array([yi(q[Ie-1],q[Ie+0],q[Ie+1]),yi(q[Ie+0],q[Ie+1],q[Ie+2]),yi(q[Ie+1],q[Ie+2],q[Ie+3]),yi(q[Ie+2],q[Ie+3],q[Ie+4])]),de=0;4>de;++de)r(q,Z+32*de,Ie,0,Ie.length)}function Si(q,Z){var de=q[Z-1],Ie=q[Z-1+32],Ve=q[Z-1+64],Ze=q[Z-1+96];_e(q,Z+0,16843009*yi(q[Z-1-32],de,Ie)),_e(q,Z+32,16843009*yi(de,Ie,Ve)),_e(q,Z+64,16843009*yi(Ie,Ve,Ze)),_e(q,Z+96,16843009*yi(Ve,Ze,Ze))}function js(q,Z){var de,Ie=4;for(de=0;4>de;++de)Ie+=q[Z+de-32]+q[Z-1+32*de];for(Ie>>=3,de=0;4>de;++de)s(q,Z+32*de,Ie,4)}function au(q,Z){var de=q[Z-1+0],Ie=q[Z-1+32],Ve=q[Z-1+64],Ze=q[Z-1-32],et=q[Z+0-32],at=q[Z+1-32],ut=q[Z+2-32],St=q[Z+3-32];q[Z+0+96]=yi(Ie,Ve,q[Z-1+96]),q[Z+1+96]=q[Z+0+64]=yi(de,Ie,Ve),q[Z+2+96]=q[Z+1+64]=q[Z+0+32]=yi(Ze,de,Ie),q[Z+3+96]=q[Z+2+64]=q[Z+1+32]=q[Z+0+0]=yi(et,Ze,de),q[Z+3+64]=q[Z+2+32]=q[Z+1+0]=yi(at,et,Ze),q[Z+3+32]=q[Z+2+0]=yi(ut,at,et),q[Z+3+0]=yi(St,ut,at)}function su(q,Z){var de=q[Z+1-32],Ie=q[Z+2-32],Ve=q[Z+3-32],Ze=q[Z+4-32],et=q[Z+5-32],at=q[Z+6-32],ut=q[Z+7-32];q[Z+0+0]=yi(q[Z+0-32],de,Ie),q[Z+1+0]=q[Z+0+32]=yi(de,Ie,Ve),q[Z+2+0]=q[Z+1+32]=q[Z+0+64]=yi(Ie,Ve,Ze),q[Z+3+0]=q[Z+2+32]=q[Z+1+64]=q[Z+0+96]=yi(Ve,Ze,et),q[Z+3+32]=q[Z+2+64]=q[Z+1+96]=yi(Ze,et,at),q[Z+3+64]=q[Z+2+96]=yi(et,at,ut),q[Z+3+96]=yi(at,ut,ut)}function Jn(q,Z){var de=q[Z-1+0],Ie=q[Z-1+32],Ve=q[Z-1+64],Ze=q[Z-1-32],et=q[Z+0-32],at=q[Z+1-32],ut=q[Z+2-32],St=q[Z+3-32];q[Z+0+0]=q[Z+1+64]=Ze+et+1>>1,q[Z+1+0]=q[Z+2+64]=et+at+1>>1,q[Z+2+0]=q[Z+3+64]=at+ut+1>>1,q[Z+3+0]=ut+St+1>>1,q[Z+0+96]=yi(Ve,Ie,de),q[Z+0+64]=yi(Ie,de,Ze),q[Z+0+32]=q[Z+1+96]=yi(de,Ze,et),q[Z+1+32]=q[Z+2+96]=yi(Ze,et,at),q[Z+2+32]=q[Z+3+96]=yi(et,at,ut),q[Z+3+32]=yi(at,ut,St)}function ri(q,Z){var de=q[Z+0-32],Ie=q[Z+1-32],Ve=q[Z+2-32],Ze=q[Z+3-32],et=q[Z+4-32],at=q[Z+5-32],ut=q[Z+6-32],St=q[Z+7-32];q[Z+0+0]=de+Ie+1>>1,q[Z+1+0]=q[Z+0+64]=Ie+Ve+1>>1,q[Z+2+0]=q[Z+1+64]=Ve+Ze+1>>1,q[Z+3+0]=q[Z+2+64]=Ze+et+1>>1,q[Z+0+32]=yi(de,Ie,Ve),q[Z+1+32]=q[Z+0+96]=yi(Ie,Ve,Ze),q[Z+2+32]=q[Z+1+96]=yi(Ve,Ze,et),q[Z+3+32]=q[Z+2+96]=yi(Ze,et,at),q[Z+3+64]=yi(et,at,ut),q[Z+3+96]=yi(at,ut,St)}function _i(q,Z){var de=q[Z-1+0],Ie=q[Z-1+32],Ve=q[Z-1+64],Ze=q[Z-1+96];q[Z+0+0]=de+Ie+1>>1,q[Z+2+0]=q[Z+0+32]=Ie+Ve+1>>1,q[Z+2+32]=q[Z+0+64]=Ve+Ze+1>>1,q[Z+1+0]=yi(de,Ie,Ve),q[Z+3+0]=q[Z+1+32]=yi(Ie,Ve,Ze),q[Z+3+32]=q[Z+1+64]=yi(Ve,Ze,Ze),q[Z+3+64]=q[Z+2+64]=q[Z+0+96]=q[Z+1+96]=q[Z+2+96]=q[Z+3+96]=Ze}function Fs(q,Z){var de=q[Z-1+0],Ie=q[Z-1+32],Ve=q[Z-1+64],Ze=q[Z-1+96],et=q[Z-1-32],at=q[Z+0-32],ut=q[Z+1-32],St=q[Z+2-32];q[Z+0+0]=q[Z+2+32]=de+et+1>>1,q[Z+0+32]=q[Z+2+64]=Ie+de+1>>1,q[Z+0+64]=q[Z+2+96]=Ve+Ie+1>>1,q[Z+0+96]=Ze+Ve+1>>1,q[Z+3+0]=yi(at,ut,St),q[Z+2+0]=yi(et,at,ut),q[Z+1+0]=q[Z+3+32]=yi(de,et,at),q[Z+1+32]=q[Z+3+64]=yi(Ie,de,et),q[Z+1+64]=q[Z+3+96]=yi(Ve,Ie,de),q[Z+1+96]=yi(Ze,Ve,Ie)}function _h(q,Z){var de;for(de=0;8>de;++de)r(q,Z+32*de,q,Z-32,8)}function li(q,Z){var de;for(de=0;8>de;++de)s(q,Z,q[Z-1],8),Z+=32}function zo(q,Z,de){var Ie;for(Ie=0;8>Ie;++Ie)s(Z,de+32*Ie,q,8)}function uc(q,Z){var de,Ie=8;for(de=0;8>de;++de)Ie+=q[Z+de-32]+q[Z-1+32*de];zo(Ie>>4,q,Z)}function xs(q,Z){var de,Ie=4;for(de=0;8>de;++de)Ie+=q[Z+de-32];zo(Ie>>3,q,Z)}function za(q,Z){var de,Ie=4;for(de=0;8>de;++de)Ie+=q[Z-1+32*de];zo(Ie>>3,q,Z)}function Ta(q,Z){zo(128,q,Z)}function lo(q,Z,de){var Ie=q[Z-de],Ve=q[Z+0],Ze=3*(Ve-Ie)+ni[1020+q[Z-2*de]-q[Z+de]],et=ju[112+(Ze+4>>3)];q[Z-de]=El[255+Ie+ju[112+(Ze+3>>3)]],q[Z+0]=El[255+Ve-et]}function vh(q,Z,de,Ie){var Ve=q[Z+0],Ze=q[Z+de];return Qa[255+q[Z-2*de]-q[Z-de]]>Ie||Qa[255+Ze-Ve]>Ie}function tf(q,Z,de,Ie){return 4*Qa[255+q[Z-de]-q[Z+0]]+Qa[255+q[Z-2*de]-q[Z+de]]<=Ie}function ou(q,Z,de,Ie,Ve){var Ze=q[Z-3*de],et=q[Z-2*de],at=q[Z-de],ut=q[Z+0],St=q[Z+de],Jt=q[Z+2*de],Mt=q[Z+3*de];return 4*Qa[255+at-ut]+Qa[255+et-St]>Ie?0:Qa[255+q[Z-4*de]-Ze]<=Ve&&Qa[255+Ze-et]<=Ve&&Qa[255+et-at]<=Ve&&Qa[255+Mt-Jt]<=Ve&&Qa[255+Jt-St]<=Ve&&Qa[255+St-ut]<=Ve}function lu(q,Z,de,Ie){var Ve=2*Ie+1;for(Ie=0;16>Ie;++Ie)tf(q,Z+Ie,de,Ve)&&lo(q,Z+Ie,de)}function Yo(q,Z,de,Ie){var Ve=2*Ie+1;for(Ie=0;16>Ie;++Ie)tf(q,Z+Ie*de,1,Ve)&&lo(q,Z+Ie*de,1)}function os(q,Z,de,Ie){var Ve;for(Ve=3;0<Ve;--Ve)lu(q,Z+=4*de,de,Ie)}function Fc(q,Z,de,Ie){var Ve;for(Ve=3;0<Ve;--Ve)Yo(q,Z+=4,de,Ie)}function ws(q,Z,de,Ie,Ve,Ze,et,at){for(Ze=2*Ze+1;0<Ve--;){if(ou(q,Z,de,Ze,et))if(vh(q,Z,de,at))lo(q,Z,de);else{var ut=q,St=Z,Jt=de,Mt=ut[St-2*Jt],vn=ut[St-Jt],nn=ut[St+0],wn=ut[St+Jt],pn=ut[St+2*Jt],_t=27*(Vn=ni[1020+3*(nn-vn)+ni[1020+Mt-wn]])+63>>7,en=18*Vn+63>>7,Vn=9*Vn+63>>7;ut[St-3*Jt]=El[255+ut[St-3*Jt]+Vn],ut[St-2*Jt]=El[255+Mt+en],ut[St-Jt]=El[255+vn+_t],ut[St+0]=El[255+nn-_t],ut[St+Jt]=El[255+wn-en],ut[St+2*Jt]=El[255+pn-Vn]}Z+=Ie}}function wl(q,Z,de,Ie,Ve,Ze,et,at){for(Ze=2*Ze+1;0<Ve--;){if(ou(q,Z,de,Ze,et))if(vh(q,Z,de,at))lo(q,Z,de);else{var ut=q,St=Z,Jt=de,Mt=ut[St-Jt],vn=ut[St+0],nn=ut[St+Jt],wn=ju[112+((pn=3*(vn-Mt))+4>>3)],pn=ju[112+(pn+3>>3)],_t=wn+1>>1;ut[St-2*Jt]=El[255+ut[St-2*Jt]+_t],ut[St-Jt]=El[255+Mt+pn],ut[St+0]=El[255+vn-wn],ut[St+Jt]=El[255+nn-_t]}Z+=Ie}}function Xo(q,Z,de,Ie,Ve,Ze){ws(q,Z,de,1,16,Ie,Ve,Ze)}function qa(q,Z,de,Ie,Ve,Ze){ws(q,Z,1,de,16,Ie,Ve,Ze)}function Us(q,Z,de,Ie,Ve,Ze){var et;for(et=3;0<et;--et)wl(q,Z+=4*de,de,1,16,Ie,Ve,Ze)}function Vl(q,Z,de,Ie,Ve,Ze){var et;for(et=3;0<et;--et)wl(q,Z+=4,1,de,16,Ie,Ve,Ze)}function ns(q,Z,de,Ie,Ve,Ze,et,at){ws(q,Z,Ve,1,8,Ze,et,at),ws(de,Ie,Ve,1,8,Ze,et,at)}function Pf(q,Z,de,Ie,Ve,Ze,et,at){ws(q,Z,1,Ve,8,Ze,et,at),ws(de,Ie,1,Ve,8,Ze,et,at)}function Bo(q,Z,de,Ie,Ve,Ze,et,at){wl(q,Z+4*Ve,Ve,1,8,Ze,et,at),wl(de,Ie+4*Ve,Ve,1,8,Ze,et,at)}function bh(q,Z,de,Ie,Ve,Ze,et,at){wl(q,Z+4,1,Ve,8,Ze,et,at),wl(de,Ie+4,1,Ve,8,Ze,et,at)}function hc(){this.ba=new Za,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new Ia,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function fc(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function Vd(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function $l(){this.ua=0,this.Wa=new At,this.vb=new At,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new De,this.yc=new we}function Dm(){this.xb=this.a=0,this.l=new iu,this.ca=new Za,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new xe,this.Pb=0,this.wd=new xe,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new $l,this.ab=0,this.gc=f(4,Vd),this.Oc=0}function xh(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new iu,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function qs(q,Z,de,Ie,Ve,Ze,et){for(q=q==null?0:q[Z+0],Z=0;Z<et;++Z)Ve[Ze+Z]=q+de[Ie+Z]&255,q=Ve[Ze+Z]}function hd(q,Z,de,Ie,Ve,Ze,et){var at;if(q==null)qs(null,null,de,Ie,Ve,Ze,et);else for(at=0;at<et;++at)Ve[Ze+at]=q[Z+at]+de[Ie+at]&255}function Hl(q,Z,de,Ie,Ve,Ze,et){if(q==null)qs(null,null,de,Ie,Ve,Ze,et);else{var at,ut=q[Z+0],St=ut,Jt=ut;for(at=0;at<et;++at)St=Jt+(ut=q[Z+at])-St,Jt=de[Ie+at]+(-256&St?0>St?0:255:St)&255,St=ut,Ve[Ze+at]=Jt}}function fd(q,Z,de,Ie){var Ve=Z.width,Ze=Z.o;if(e(q!=null&&Z!=null),0>de||0>=Ie||de+Ie>Ze)return null;if(!q.Cc){if(q.ga==null){var et;if(q.ga=new xh,(et=q.ga==null)||(et=Z.width*Z.o,e(q.Gb.length==0),q.Gb=l(et),q.Uc=0,q.Gb==null?et=0:(q.mb=q.Gb,q.nb=q.Uc,q.rc=null,et=1),et=!et),!et){et=q.ga;var at=q.Fa,ut=q.P,St=q.qc,Jt=q.mb,Mt=q.nb,vn=ut+1,nn=St-1,wn=et.l;if(e(at!=null&&Jt!=null&&Z!=null),fl[0]=null,fl[1]=qs,fl[2]=hd,fl[3]=Hl,et.ca=Jt,et.tb=Mt,et.c=Z.width,et.i=Z.height,e(0<et.c&&0<et.i),1>=St)Z=0;else if(et.$a=at[ut+0]>>0&3,et.Z=at[ut+0]>>2&3,et.Lc=at[ut+0]>>4&3,ut=at[ut+0]>>6&3,0>et.$a||1<et.$a||4<=et.Z||1<et.Lc||ut)Z=0;else if(wn.put=Zt,wn.ac=zs,wn.bc=Ee,wn.ma=et,wn.width=Z.width,wn.height=Z.height,wn.Da=Z.Da,wn.v=Z.v,wn.va=Z.va,wn.j=Z.j,wn.o=Z.o,et.$a)e:{e(et.$a==1),Z=vr();t:for(;;){if(Z==null){Z=0;break e}if(e(et!=null),et.mc=Z,Z.c=et.c,Z.i=et.i,Z.l=et.l,Z.l.ma=et,Z.l.width=et.c,Z.l.height=et.i,Z.a=0,Fe(Z.m,at,vn,nn),!Or(et.c,et.i,1,Z,null)||(Z.ab==1&&Z.gc[0].hc==3&&Gt(Z.s)?(et.ic=1,at=Z.c*Z.i,Z.Ta=null,Z.Ua=0,Z.V=l(at),Z.Ba=0,Z.V==null?(Z.a=1,Z=0):Z=1):(et.ic=0,Z=Rr(Z,et.c)),!Z))break t;Z=1;break e}et.mc=null,Z=0}else Z=nn>=et.c*et.i;et=!Z}if(et)return null;q.ga.Lc!=1?q.Ga=0:Ie=Ze-de}e(q.ga!=null),e(de+Ie<=Ze);e:{if(Z=(at=q.ga).c,Ze=at.l.o,at.$a==0){if(vn=q.rc,nn=q.Vc,wn=q.Fa,ut=q.P+1+de*Z,St=q.mb,Jt=q.nb+de*Z,e(ut<=q.P+q.qc),at.Z!=0)for(e(fl[at.Z]!=null),et=0;et<Ie;++et)fl[at.Z](vn,nn,wn,ut,St,Jt,Z),vn=St,nn=Jt,Jt+=Z,ut+=Z;else for(et=0;et<Ie;++et)r(St,Jt,wn,ut,Z),vn=St,nn=Jt,Jt+=Z,ut+=Z;q.rc=vn,q.Vc=nn}else{if(e(at.mc!=null),Z=de+Ie,e((et=at.mc)!=null),e(Z<=et.i),et.C>=Z)Z=1;else if(at.ic||dn(),at.ic){at=et.V,vn=et.Ba,nn=et.c;var pn=et.i,_t=(wn=1,ut=et.$/nn,St=et.$%nn,Jt=et.m,Mt=et.s,et.$),en=nn*pn,Vn=nn*Z,Yn=Mt.wc,Gn=_t<Vn?Ft(Mt,St,ut):null;e(_t<=en),e(Z<=pn),e(Gt(Mt));t:for(;;){for(;!Jt.h&&_t<Vn;){if(St&Yn||(Gn=Ft(Mt,St,ut)),e(Gn!=null),vt(Jt),256>(pn=ft(Gn.G[0],Gn.H[0],Jt)))at[vn+_t]=pn,++_t,++St>=nn&&(St=0,++ut<=Z&&!(ut%16)&&Sn(et,ut));else{if(!(280>pn)){wn=0;break t}pn=tt(pn-256,Jt);var Tr,pr=ft(Gn.G[4],Gn.H[4],Jt);if(vt(Jt),!(_t>=(pr=gt(nn,pr=tt(pr,Jt)))&&en-_t>=pn)){wn=0;break t}for(Tr=0;Tr<pn;++Tr)at[vn+_t+Tr]=at[vn+_t+Tr-pr];for(_t+=pn,St+=pn;St>=nn;)St-=nn,++ut<=Z&&!(ut%16)&&Sn(et,ut);_t<Vn&&St&Yn&&(Gn=Ft(Mt,St,ut))}e(Jt.h==Xe(Jt))}Sn(et,ut>Z?Z:ut);break t}!wn||Jt.h&&_t<en?(wn=0,et.a=Jt.h?5:3):et.$=_t,Z=wn}else Z=Nn(et,et.V,et.Ba,et.c,et.i,Z,qr);if(!Z){Ie=0;break e}}de+Ie>=Ze&&(q.Cc=1),Ie=1}if(!Ie)return null;if(q.Cc&&((Ie=q.ga)!=null&&(Ie.mc=null),q.ga=null,0<q.Ga))return alert("todo:WebPDequantizeLevels"),null}return q.nb+de*Ve}function se(q,Z,de,Ie,Ve,Ze){for(;0<Ve--;){var et,at=q,ut=Z+(de?1:0),St=q,Jt=Z+(de?0:3);for(et=0;et<Ie;++et){var Mt=St[Jt+4*et];Mt!=255&&(Mt*=32897,at[ut+4*et+0]=at[ut+4*et+0]*Mt>>23,at[ut+4*et+1]=at[ut+4*et+1]*Mt>>23,at[ut+4*et+2]=at[ut+4*et+2]*Mt>>23)}Z+=Ze}}function Ge(q,Z,de,Ie,Ve){for(;0<Ie--;){var Ze;for(Ze=0;Ze<de;++Ze){var et=q[Z+2*Ze+0],at=15&(St=q[Z+2*Ze+1]),ut=4369*at,St=(240&St|St>>4)*ut>>16;q[Z+2*Ze+0]=(240&et|et>>4)*ut>>16&240|(15&et|et<<4)*ut>>16>>4&15,q[Z+2*Ze+1]=240&St|at}Z+=Ve}}function Rt(q,Z,de,Ie,Ve,Ze,et,at){var ut,St,Jt=255;for(St=0;St<Ve;++St){for(ut=0;ut<Ie;++ut){var Mt=q[Z+ut];Ze[et+4*ut]=Mt,Jt&=Mt}Z+=de,et+=at}return Jt!=255}function Yt(q,Z,de,Ie,Ve){var Ze;for(Ze=0;Ze<Ve;++Ze)de[Ie+Ze]=q[Z+Ze]>>8}function dn(){ls=se,Yi=Ge,ea=Rt,$a=Yt}function kn(q,Z,de){be[q]=function(Ie,Ve,Ze,et,at,ut,St,Jt,Mt,vn,nn,wn,pn,_t,en,Vn,Yn){var Gn,Tr=Yn-1>>1,pr=at[ut+0]|St[Jt+0]<<16,ii=Mt[vn+0]|nn[wn+0]<<16;e(Ie!=null);var cr=3*pr+ii+131074>>2;for(Z(Ie[Ve+0],255&cr,cr>>16,pn,_t),Ze!=null&&(cr=3*ii+pr+131074>>2,Z(Ze[et+0],255&cr,cr>>16,en,Vn)),Gn=1;Gn<=Tr;++Gn){var va=at[ut+Gn]|St[Jt+Gn]<<16,Ea=Mt[vn+Gn]|nn[wn+Gn]<<16,$i=pr+va+ii+Ea+524296,ta=$i+2*(va+ii)>>3;cr=ta+pr>>1,pr=($i=$i+2*(pr+Ea)>>3)+va>>1,Z(Ie[Ve+2*Gn-1],255&cr,cr>>16,pn,_t+(2*Gn-1)*de),Z(Ie[Ve+2*Gn-0],255&pr,pr>>16,pn,_t+(2*Gn-0)*de),Ze!=null&&(cr=$i+ii>>1,pr=ta+Ea>>1,Z(Ze[et+2*Gn-1],255&cr,cr>>16,en,Vn+(2*Gn-1)*de),Z(Ze[et+2*Gn+0],255&pr,pr>>16,en,Vn+(2*Gn+0)*de)),pr=va,ii=Ea}1&Yn||(cr=3*pr+ii+131074>>2,Z(Ie[Ve+Yn-1],255&cr,cr>>16,pn,_t+(Yn-1)*de),Ze!=null&&(cr=3*ii+pr+131074>>2,Z(Ze[et+Yn-1],255&cr,cr>>16,en,Vn+(Yn-1)*de)))}}function rr(){el[pu]=Bf,el[Mh]=zp,el[ua]=Ph,el[Rf]=Bp,el[Jo]=Uu,el[hl]=yd,el[Fu]=tl,el[yc]=zp,el[qc]=Bp,el[mu]=Uu,el[Np]=yd}function wr(q){return q&-16384?0>q?0:255:q>>Ml}function Wr(q,Z){return wr((19077*q>>8)+(26149*Z>>8)-14234)}function Ai(q,Z,de){return wr((19077*q>>8)-(6419*Z>>8)-(13320*de>>8)+8708)}function Pi(q,Z){return wr((19077*q>>8)+(33050*Z>>8)-17685)}function pa(q,Z,de,Ie,Ve){Ie[Ve+0]=Wr(q,de),Ie[Ve+1]=Ai(q,Z,de),Ie[Ve+2]=Pi(q,Z)}function Ss(q,Z,de,Ie,Ve){Ie[Ve+0]=Pi(q,Z),Ie[Ve+1]=Ai(q,Z,de),Ie[Ve+2]=Wr(q,de)}function As(q,Z,de,Ie,Ve){var Ze=Ai(q,Z,de);Z=Ze<<3&224|Pi(q,Z)>>3,Ie[Ve+0]=248&Wr(q,de)|Ze>>5,Ie[Ve+1]=Z}function Xs(q,Z,de,Ie,Ve){var Ze=240&Pi(q,Z)|15;Ie[Ve+0]=240&Wr(q,de)|Ai(q,Z,de)>>4,Ie[Ve+1]=Ze}function Ja(q,Z,de,Ie,Ve){Ie[Ve+0]=255,pa(q,Z,de,Ie,Ve+1)}function Mr(q,Z,de,Ie,Ve){Ss(q,Z,de,Ie,Ve),Ie[Ve+3]=255}function sr(q,Z,de,Ie,Ve){pa(q,Z,de,Ie,Ve),Ie[Ve+3]=255}function ul(q,Z){return 0>q?0:q>Z?Z:q}function Sr(q,Z,de){be[q]=function(Ie,Ve,Ze,et,at,ut,St,Jt,Mt){for(var vn=Jt+(-2&Mt)*de;Jt!=vn;)Z(Ie[Ve+0],Ze[et+0],at[ut+0],St,Jt),Z(Ie[Ve+1],Ze[et+0],at[ut+0],St,Jt+de),Ve+=2,++et,++ut,Jt+=2*de;1&Mt&&Z(Ie[Ve+0],Ze[et+0],at[ut+0],St,Jt)}}function dc(q,Z,de){return de==0?q==0?Z==0?6:5:Z==0?4:0:de}function Gl(q,Z,de,Ie,Ve){switch(q>>>30){case 3:pc(Z,de,Ie,Ve,0);break;case 2:Va(Z,de,Ie,Ve);break;case 1:Zs(Z,de,Ie,Ve)}}function br(q,Z){var de,Ie,Ve=Z.M,Ze=Z.Nb,et=q.oc,at=q.pc+40,ut=q.oc,St=q.pc+584,Jt=q.oc,Mt=q.pc+600;for(de=0;16>de;++de)et[at+32*de-1]=129;for(de=0;8>de;++de)ut[St+32*de-1]=129,Jt[Mt+32*de-1]=129;for(0<Ve?et[at-1-32]=ut[St-1-32]=Jt[Mt-1-32]=129:(s(et,at-32-1,127,21),s(ut,St-32-1,127,9),s(Jt,Mt-32-1,127,9)),Ie=0;Ie<q.za;++Ie){var vn=Z.ya[Z.aa+Ie];if(0<Ie){for(de=-1;16>de;++de)r(et,at+32*de-4,et,at+32*de+12,4);for(de=-1;8>de;++de)r(ut,St+32*de-4,ut,St+32*de+4,4),r(Jt,Mt+32*de-4,Jt,Mt+32*de+4,4)}var nn=q.Gd,wn=q.Hd+Ie,pn=vn.ad,_t=vn.Hc;if(0<Ve&&(r(et,at-32,nn[wn].y,0,16),r(ut,St-32,nn[wn].f,0,8),r(Jt,Mt-32,nn[wn].ea,0,8)),vn.Za){var en=et,Vn=at-32+16;for(0<Ve&&(Ie>=q.za-1?s(en,Vn,nn[wn].y[15],4):r(en,Vn,nn[wn+1].y,0,4)),de=0;4>de;de++)en[Vn+128+de]=en[Vn+256+de]=en[Vn+384+de]=en[Vn+0+de];for(de=0;16>de;++de,_t<<=2)en=et,Vn=at+km[de],Vc[vn.Ob[de]](en,Vn),Gl(_t,pn,16*+de,en,Vn)}else if(en=dc(Ie,Ve,vn.Ob[0]),yu[en](et,at),_t!=0)for(de=0;16>de;++de,_t<<=2)Gl(_t,pn,16*+de,et,at+km[de]);for(de=vn.Gc,en=dc(Ie,Ve,vn.Dd),vc[en](ut,St),vc[en](Jt,Mt),_t=pn,en=ut,Vn=St,255&(vn=de>>0)&&(170&vn?pd(_t,256,en,Vn):ho(_t,256,en,Vn)),vn=Jt,_t=Mt,255&(de>>=8)&&(170&de?pd(pn,320,vn,_t):ho(pn,320,vn,_t)),Ve<q.Ub-1&&(r(nn[wn].y,0,et,at+480,16),r(nn[wn].f,0,ut,St+224,8),r(nn[wn].ea,0,Jt,Mt+224,8)),de=8*Ze*q.B,nn=q.sa,wn=q.ta+16*Ie+16*Ze*q.R,pn=q.qa,vn=q.ra+8*Ie+de,_t=q.Ha,en=q.Ia+8*Ie+de,de=0;16>de;++de)r(nn,wn+de*q.R,et,at+32*de,16);for(de=0;8>de;++de)r(pn,vn+de*q.B,ut,St+32*de,8),r(_t,en+de*q.B,Jt,Mt+32*de,8)}}function nf(q,Z,de,Ie,Ve,Ze,et,at,ut){var St=[0],Jt=[0],Mt=0,vn=ut!=null?ut.kd:0,nn=ut??new fc;if(q==null||12>de)return 7;nn.data=q,nn.w=Z,nn.ha=de,Z=[Z],de=[de],nn.gb=[nn.gb];e:{var wn=Z,pn=de,_t=nn.gb;if(e(q!=null),e(pn!=null),e(_t!=null),_t[0]=0,12<=pn[0]&&!n(q,wn[0],"RIFF")){if(n(q,wn[0]+8,"WEBP")){_t=3;break e}var en=Pn(q,wn[0]+4);if(12>en||4294967286<en){_t=3;break e}if(vn&&en>pn[0]-8){_t=7;break e}_t[0]=en,wn[0]+=12,pn[0]-=12}_t=0}if(_t!=0)return _t;for(en=0<nn.gb[0],de=de[0];;){e:{var Vn=q;pn=Z,_t=de;var Yn=St,Gn=Jt,Tr=wn=[0];if((cr=Mt=[Mt])[0]=0,8>_t[0])_t=7;else{if(!n(Vn,pn[0],"VP8X")){if(Pn(Vn,pn[0]+4)!=10){_t=3;break e}if(18>_t[0]){_t=7;break e}var pr=Pn(Vn,pn[0]+8),ii=1+Kt(Vn,pn[0]+12);if(2147483648<=ii*(Vn=1+Kt(Vn,pn[0]+15))){_t=3;break e}Tr!=null&&(Tr[0]=pr),Yn!=null&&(Yn[0]=ii),Gn!=null&&(Gn[0]=Vn),pn[0]+=18,_t[0]-=18,cr[0]=1}_t=0}}if(Mt=Mt[0],wn=wn[0],_t!=0)return _t;if(pn=!!(2&wn),!en&&Mt)return 3;if(Ze!=null&&(Ze[0]=!!(16&wn)),et!=null&&(et[0]=pn),at!=null&&(at[0]=0),et=St[0],wn=Jt[0],Mt&&pn&&ut==null){_t=0;break}if(4>de){_t=7;break}if(en&&Mt||!en&&!Mt&&!n(q,Z[0],"ALPH")){de=[de],nn.na=[nn.na],nn.P=[nn.P],nn.Sa=[nn.Sa];e:{pr=q,_t=Z,en=de;var cr=nn.gb;Yn=nn.na,Gn=nn.P,Tr=nn.Sa,ii=22,e(pr!=null),e(en!=null),Vn=_t[0];var va=en[0];for(e(Yn!=null),e(Tr!=null),Yn[0]=null,Gn[0]=null,Tr[0]=0;;){if(_t[0]=Vn,en[0]=va,8>va){_t=7;break e}var Ea=Pn(pr,Vn+4);if(4294967286<Ea){_t=3;break e}var $i=8+Ea+1&-2;if(ii+=$i,0<cr&&ii>cr){_t=3;break e}if(!n(pr,Vn,"VP8 ")||!n(pr,Vn,"VP8L")){_t=0;break e}if(va[0]<$i){_t=7;break e}n(pr,Vn,"ALPH")||(Yn[0]=pr,Gn[0]=Vn+8,Tr[0]=Ea),Vn+=$i,va-=$i}}if(de=de[0],nn.na=nn.na[0],nn.P=nn.P[0],nn.Sa=nn.Sa[0],_t!=0)break}de=[de],nn.Ja=[nn.Ja],nn.xa=[nn.xa];e:if(cr=q,_t=Z,en=de,Yn=nn.gb[0],Gn=nn.Ja,Tr=nn.xa,pr=_t[0],Vn=!n(cr,pr,"VP8 "),ii=!n(cr,pr,"VP8L"),e(cr!=null),e(en!=null),e(Gn!=null),e(Tr!=null),8>en[0])_t=7;else{if(Vn||ii){if(cr=Pn(cr,pr+4),12<=Yn&&cr>Yn-12){_t=3;break e}if(vn&&cr>en[0]-8){_t=7;break e}Gn[0]=cr,_t[0]+=8,en[0]-=8,Tr[0]=ii}else Tr[0]=5<=en[0]&&cr[pr+0]==47&&!(cr[pr+4]>>5),Gn[0]=en[0];_t=0}if(de=de[0],nn.Ja=nn.Ja[0],nn.xa=nn.xa[0],Z=Z[0],_t!=0)break;if(4294967286<nn.Ja)return 3;if(at==null||pn||(at[0]=nn.xa?2:1),et=[et],wn=[wn],nn.xa){if(5>de){_t=7;break}at=et,vn=wn,pn=Ze,q==null||5>de?q=0:5<=de&&q[Z+0]==47&&!(q[Z+4]>>5)?(en=[0],cr=[0],Yn=[0],Fe(Gn=new xe,q,Z,de),Re(Gn,en,cr,Yn)?(at!=null&&(at[0]=en[0]),vn!=null&&(vn[0]=cr[0]),pn!=null&&(pn[0]=Yn[0]),q=1):q=0):q=0}else{if(10>de){_t=7;break}at=wn,q==null||10>de||!Fl(q,Z+3,de-3)?q=0:(vn=q[Z+0]|q[Z+1]<<8|q[Z+2]<<16,pn=16383&(q[Z+7]<<8|q[Z+6]),q=16383&(q[Z+9]<<8|q[Z+8]),1&vn||3<(vn>>1&7)||!(vn>>4&1)||vn>>5>=nn.Ja||!pn||!q?q=0:(et&&(et[0]=pn),at&&(at[0]=q),q=1))}if(!q||(et=et[0],wn=wn[0],Mt&&(St[0]!=et||Jt[0]!=wn)))return 3;ut!=null&&(ut[0]=nn,ut.offset=Z-ut.w,e(4294967286>Z-ut.w),e(ut.offset==ut.ha-de));break}return _t==0||_t==7&&Mt&&ut==null?(Ze!=null&&(Ze[0]|=nn.na!=null&&0<nn.na.length),Ie!=null&&(Ie[0]=et),Ve!=null&&(Ve[0]=wn),0):_t}function Wl(q,Z,de){var Ie=Z.width,Ve=Z.height,Ze=0,et=0,at=Ie,ut=Ve;if(Z.Da=q!=null&&0<q.Da,Z.Da&&(at=q.cd,ut=q.bd,Ze=q.v,et=q.j,11>de||(Ze&=-2,et&=-2),0>Ze||0>et||0>=at||0>=ut||Ze+at>Ie||et+ut>Ve))return 0;if(Z.v=Ze,Z.j=et,Z.va=Ze+at,Z.o=et+ut,Z.U=at,Z.T=ut,Z.da=q!=null&&0<q.da,Z.da){if(!xr(at,ut,de=[q.ib],Ze=[q.hb]))return 0;Z.ib=de[0],Z.hb=Ze[0]}return Z.ob=q!=null&&q.ob,Z.Kb=q==null||!q.Sd,Z.da&&(Z.ob=Z.ib<3*Ie/4&&Z.hb<3*Ve/4,Z.Kb=0),1}function cu(q){if(q==null)return 2;if(11>q.S){var Z=q.f.RGBA;Z.fb+=(q.height-1)*Z.A,Z.A=-Z.A}else Z=q.f.kb,q=q.height,Z.O+=(q-1)*Z.fa,Z.fa=-Z.fa,Z.N+=(q-1>>1)*Z.Ab,Z.Ab=-Z.Ab,Z.W+=(q-1>>1)*Z.Db,Z.Db=-Z.Db,Z.F!=null&&(Z.J+=(q-1)*Z.lb,Z.lb=-Z.lb);return 0}function wh(q,Z,de,Ie){if(Ie==null||0>=q||0>=Z)return 2;if(de!=null){if(de.Da){var Ve=de.cd,Ze=de.bd,et=-2&de.v,at=-2&de.j;if(0>et||0>at||0>=Ve||0>=Ze||et+Ve>q||at+Ze>Z)return 2;q=Ve,Z=Ze}if(de.da){if(!xr(q,Z,Ve=[de.ib],Ze=[de.hb]))return 2;q=Ve[0],Z=Ze[0]}}Ie.width=q,Ie.height=Z;e:{var ut=Ie.width,St=Ie.height;if(q=Ie.S,0>=ut||0>=St||!(q>=pu&&13>q))q=2;else{if(0>=Ie.Rd&&Ie.sd==null){et=Ze=Ve=Z=0;var Jt=(at=ut*jf[q])*St;if(11>q||(Ze=(St+1)/2*(Z=(ut+1)/2),q==12&&(et=(Ve=ut)*St)),(St=l(Jt+2*Ze+et))==null){q=1;break e}Ie.sd=St,11>q?((ut=Ie.f.RGBA).eb=St,ut.fb=0,ut.A=at,ut.size=Jt):((ut=Ie.f.kb).y=St,ut.O=0,ut.fa=at,ut.Fd=Jt,ut.f=St,ut.N=0+Jt,ut.Ab=Z,ut.Cd=Ze,ut.ea=St,ut.W=0+Jt+Ze,ut.Db=Z,ut.Ed=Ze,q==12&&(ut.F=St,ut.J=0+Jt+2*Ze),ut.Tc=et,ut.lb=Ve)}if(Z=1,Ve=Ie.S,Ze=Ie.width,et=Ie.height,Ve>=pu&&13>Ve)if(11>Ve)q=Ie.f.RGBA,Z&=(at=Math.abs(q.A))*(et-1)+Ze<=q.size,Z&=at>=Ze*jf[Ve],Z&=q.eb!=null;else{q=Ie.f.kb,at=(Ze+1)/2,Jt=(et+1)/2,ut=Math.abs(q.fa),St=Math.abs(q.Ab);var Mt=Math.abs(q.Db),vn=Math.abs(q.lb),nn=vn*(et-1)+Ze;Z&=ut*(et-1)+Ze<=q.Fd,Z&=St*(Jt-1)+at<=q.Cd,Z=(Z&=Mt*(Jt-1)+at<=q.Ed)&ut>=Ze&St>=at&Mt>=at,Z&=q.y!=null,Z&=q.f!=null,Z&=q.ea!=null,Ve==12&&(Z&=vn>=Ze,Z&=nn<=q.Tc,Z&=q.F!=null)}else Z=0;q=Z?0:2}}return q!=0||de!=null&&de.fd&&(q=cu(Ie)),q}var Ts=64,ya=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],uu=24,On=32,Sh=8,Vs=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];ar("Predictor0","PredictorAdd0"),be.Predictor0=function(){return 4278190080},be.Predictor1=function(q){return q},be.Predictor2=function(q,Z,de){return Z[de+0]},be.Predictor3=function(q,Z,de){return Z[de+1]},be.Predictor4=function(q,Z,de){return Z[de-1]},be.Predictor5=function(q,Z,de){return ur(ur(q,Z[de+1]),Z[de+0])},be.Predictor6=function(q,Z,de){return ur(q,Z[de-1])},be.Predictor7=function(q,Z,de){return ur(q,Z[de+0])},be.Predictor8=function(q,Z,de){return ur(Z[de-1],Z[de+0])},be.Predictor9=function(q,Z,de){return ur(Z[de+0],Z[de+1])},be.Predictor10=function(q,Z,de){return ur(ur(q,Z[de-1]),ur(Z[de+0],Z[de+1]))},be.Predictor11=function(q,Z,de){var Ie=Z[de+0];return 0>=Vr(Ie>>24&255,q>>24&255,(Z=Z[de-1])>>24&255)+Vr(Ie>>16&255,q>>16&255,Z>>16&255)+Vr(Ie>>8&255,q>>8&255,Z>>8&255)+Vr(255&Ie,255&q,255&Z)?Ie:q},be.Predictor12=function(q,Z,de){var Ie=Z[de+0];return(Ir((q>>24&255)+(Ie>>24&255)-((Z=Z[de-1])>>24&255))<<24|Ir((q>>16&255)+(Ie>>16&255)-(Z>>16&255))<<16|Ir((q>>8&255)+(Ie>>8&255)-(Z>>8&255))<<8|Ir((255&q)+(255&Ie)-(255&Z)))>>>0},be.Predictor13=function(q,Z,de){var Ie=Z[de-1];return(Un((q=ur(q,Z[de+0]))>>24&255,Ie>>24&255)<<24|Un(q>>16&255,Ie>>16&255)<<16|Un(q>>8&255,Ie>>8&255)<<8|Un(q>>0&255,Ie>>0&255))>>>0};var co=be.PredictorAdd0;be.PredictorAdd1=pi,ar("Predictor2","PredictorAdd2"),ar("Predictor3","PredictorAdd3"),ar("Predictor4","PredictorAdd4"),ar("Predictor5","PredictorAdd5"),ar("Predictor6","PredictorAdd6"),ar("Predictor7","PredictorAdd7"),ar("Predictor8","PredictorAdd8"),ar("Predictor9","PredictorAdd9"),ar("Predictor10","PredictorAdd10"),ar("Predictor11","PredictorAdd11"),ar("Predictor12","PredictorAdd12"),ar("Predictor13","PredictorAdd13");var dd=be.PredictorAdd2;Xn("ColorIndexInverseTransform","MapARGB","32b",function(q){return q>>8&255},function(q){return q}),Xn("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(q){return q},function(q){return q>>8&255});var Of,uo=be.ColorIndexInverseTransform,Rs=be.MapARGB,Sl=be.VP8LColorIndexInverseTransformAlpha,Du=be.MapAlpha,Kl=be.VP8LPredictorsAdd=[];Kl.length=16,(be.VP8LPredictors=[]).length=16,(be.VP8LPredictorsAdd_C=[]).length=16,(be.VP8LPredictors_C=[]).length=16;var rf,Al,xo,Ah,Lu,Tl,hu,pc,Va,pd,Zs,ho,Th,Eh,Js,ku,fu,mc,Nu,gc,zu,du,Uc,jo,ls,Yi,ea,$a,rs=l(511),Yl=l(2041),Bu=l(225),Zo=l(767),Xl=0,ni=Yl,ju=Bu,El=Zo,Qa=rs,pu=0,Mh=1,ua=2,Rf=3,Jo=4,hl=5,Fu=6,yc=7,qc=8,mu=9,Np=10,Df=[2,3,7],Lf=[3,3,11],Qo=[280,256,256,256,40],Ha=[0,1,1,1,0],_a=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Zl=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],_c=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],$d=8,gu=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],md=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],Ch=null,kf=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],Nf=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],Ih=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],gd=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],Lm=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],af=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],Cg=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],yu=[],Vc=[],vc=[],Ig=1,zf=2,fl=[],el=[];kn("UpsampleRgbLinePair",pa,3),kn("UpsampleBgrLinePair",Ss,3),kn("UpsampleRgbaLinePair",sr,4),kn("UpsampleBgraLinePair",Mr,4),kn("UpsampleArgbLinePair",Ja,4),kn("UpsampleRgba4444LinePair",Xs,2),kn("UpsampleRgb565LinePair",As,2);var Bf=be.UpsampleRgbLinePair,Ph=be.UpsampleBgrLinePair,zp=be.UpsampleRgbaLinePair,Bp=be.UpsampleBgraLinePair,Uu=be.UpsampleArgbLinePair,yd=be.UpsampleRgba4444LinePair,tl=be.UpsampleRgb565LinePair,Oh=16,bc=1<<Oh-1,Rh=-227,qu=482,Ml=6,$c=0,Vu=l(256),Hd=l(256),Dh=l(256),$u=l(256),Ds=l(qu-Rh),jp=l(qu-Rh);Sr("YuvToRgbRow",pa,3),Sr("YuvToBgrRow",Ss,3),Sr("YuvToRgbaRow",sr,4),Sr("YuvToBgraRow",Mr,4),Sr("YuvToArgbRow",Ja,4),Sr("YuvToRgba4444Row",Xs,2),Sr("YuvToRgb565Row",As,2);var km=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],_d=[0,2,8],Fp=[8,7,6,4,4,2,2,2,1,1,1,1],Qs=1;this.WebPDecodeRGBA=function(q,Z,de,Ie,Ve){var Ze=Mh,et=new hc,at=new Za;et.ba=at,at.S=Ze,at.width=[at.width],at.height=[at.height];var ut=at.width,St=at.height,Jt=new Oo;if(Jt==null||q==null)var Mt=2;else e(Jt!=null),Mt=nf(q,Z,de,Jt.width,Jt.height,Jt.Pd,Jt.Qd,Jt.format,null);if(Mt!=0?ut=0:(ut!=null&&(ut[0]=Jt.width[0]),St!=null&&(St[0]=Jt.height[0]),ut=1),ut){at.width=at.width[0],at.height=at.height[0],Ie!=null&&(Ie[0]=at.width),Ve!=null&&(Ve[0]=at.height);e:{if(Ie=new iu,(Ve=new fc).data=q,Ve.w=Z,Ve.ha=de,Ve.kd=1,Z=[0],e(Ve!=null),((q=nf(Ve.data,Ve.w,Ve.ha,null,null,null,Z,null,Ve))==0||q==7)&&Z[0]&&(q=4),(Z=q)==0){if(e(et!=null),Ie.data=Ve.data,Ie.w=Ve.w+Ve.offset,Ie.ha=Ve.ha-Ve.offset,Ie.put=Zt,Ie.ac=zs,Ie.bc=Ee,Ie.ma=et,Ve.xa){if((q=vr())==null){et=1;break e}if(function(vn,nn){var wn=[0],pn=[0],_t=[0];t:for(;;){if(vn==null)return 0;if(nn==null)return vn.a=2,0;if(vn.l=nn,vn.a=0,Fe(vn.m,nn.data,nn.w,nn.ha),!Re(vn.m,wn,pn,_t)){vn.a=3;break t}if(vn.xb=zf,nn.width=wn[0],nn.height=pn[0],!Or(wn[0],pn[0],1,vn,null))break t;return 1}return e(vn.a!=0),0}(q,Ie)){if(Ie=(Z=wh(Ie.width,Ie.height,et.Oa,et.ba))==0){t:{Ie=q;n:for(;;){if(Ie==null){Ie=0;break t}if(e(Ie.s.yc!=null),e(Ie.s.Ya!=null),e(0<Ie.s.Wb),e((de=Ie.l)!=null),e((Ve=de.ma)!=null),Ie.xb!=0){if(Ie.ca=Ve.ba,Ie.tb=Ve.tb,e(Ie.ca!=null),!Wl(Ve.Oa,de,Rf)){Ie.a=2;break n}if(!Rr(Ie,de.width)||de.da)break n;if((de.da||Pr(Ie.ca.S))&&dn(),11>Ie.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),Ie.ca.f.kb.F!=null&&dn()),Ie.Pb&&0<Ie.s.ua&&Ie.s.vb.X==null&&!Ut(Ie.s.vb,Ie.s.Wa.Xa)){Ie.a=1;break n}Ie.xb=0}if(!Nn(Ie,Ie.V,Ie.Ba,Ie.c,Ie.i,de.o,Ht))break n;Ve.Dc=Ie.Ma,Ie=1;break t}e(Ie.a!=0),Ie=0}Ie=!Ie}Ie&&(Z=q.a)}else Z=q.a}else{if((q=new Wo)==null){et=1;break e}if(q.Fa=Ve.na,q.P=Ve.P,q.qc=Ve.Sa,Do(q,Ie)){if((Z=wh(Ie.width,Ie.height,et.Oa,et.ba))==0){if(q.Aa=0,de=et.Oa,e((Ve=q)!=null),de!=null){if(0<(ut=0>(ut=de.Md)?0:100<ut?255:255*ut/100)){for(St=Jt=0;4>St;++St)12>(Mt=Ve.pb[St]).lc&&(Mt.ia=ut*Fp[0>Mt.lc?0:Mt.lc]>>3),Jt|=Mt.ia;Jt&&(alert("todo:VP8InitRandom"),Ve.ia=1)}Ve.Ga=de.Id,100<Ve.Ga?Ve.Ga=100:0>Ve.Ga&&(Ve.Ga=0)}Jh(q,Ie)||(Z=q.a)}}else Z=q.a}Z==0&&et.Oa!=null&&et.Oa.fd&&(Z=cu(et.ba))}et=Z}Ze=et!=0?null:11>Ze?at.f.RGBA.eb:at.f.kb.y}else Ze=null;return Ze};var jf=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function S(be,Ae){for(var Oe="",ue=0;ue<4;ue++)Oe+=String.fromCharCode(be[Ae++]);return Oe}function I(be,Ae){return(be[Ae+0]<<0|be[Ae+1]<<8|be[Ae+2]<<16)>>>0}function R(be,Ae){return(be[Ae+0]<<0|be[Ae+1]<<8|be[Ae+2]<<16|be[Ae+3]<<24)>>>0}new x;var F=[0],j=[0],H=[],G=new x,W=t,J=function(be,Ae){var Oe={},ue=0,we=!1,ke=0,De=0;if(Oe.frames=[],!function(Le,Xe,ct,vt){for(var Nt=0;Nt<vt;Nt++)if(Le[Xe+Nt]!=ct.charCodeAt(Nt))return!0;return!1}(be,Ae,"RIFF",4)){for(R(be,Ae+=4),Ae+=8;Ae<be.length;){var je=S(be,Ae),ze=R(be,Ae+=4);Ae+=4;var Ue=ze+(1&ze);switch(je){case"VP8 ":case"VP8L":Oe.frames[ue]===void 0&&(Oe.frames[ue]={}),(Be=Oe.frames[ue]).src_off=we?De:Ae-8,Be.src_size=ke+ze+8,ue++,we&&(we=!1,ke=0,De=0);break;case"VP8X":(Be=Oe.header={}).feature_flags=be[Ae];var Fe=Ae+4;Be.canvas_width=1+I(be,Fe),Fe+=3,Be.canvas_height=1+I(be,Fe),Fe+=3;break;case"ALPH":we=!0,ke=Ue+8,De=Ae-8;break;case"ANIM":(Be=Oe.header).bgcolor=R(be,Ae),Fe=Ae+4,Be.loop_count=(bt=be)[(xe=Fe)+0]<<0|bt[xe+1]<<8,Fe+=2;break;case"ANMF":var Qe,Be;(Be=Oe.frames[ue]={}).offset_x=2*I(be,Ae),Ae+=3,Be.offset_y=2*I(be,Ae),Ae+=3,Be.width=1+I(be,Ae),Ae+=3,Be.height=1+I(be,Ae),Ae+=3,Be.duration=I(be,Ae),Ae+=3,Qe=be[Ae++],Be.dispose=1&Qe,Be.blend=Qe>>1&1}je!="ANMF"&&(Ae+=Ue)}var bt,xe;return Oe}}(W,0);J.response=W,J.rgbaoutput=!0,J.dataurl=!1;var ie=J.header?J.header:null,he=J.frames?J.frames:null;if(ie){ie.loop_counter=ie.loop_count,F=[ie.canvas_height],j=[ie.canvas_width];for(var ge=0;ge<he.length&&he[ge].blend!=0;ge++);}var fe=he[0],ye=G.WebPDecodeRGBA(W,fe.src_off,fe.src_size,j,F);fe.rgba=ye,fe.imgwidth=j[0],fe.imgheight=F[0];for(var pe=0;pe<j[0]*F[0]*4;pe++)H[pe]=ye[pe];return this.width=j,this.height=F,this.data=H,this}(function(t){var e=function(){return typeof PD=="function"},n=function(F,j,H,G){var W=4,J=f;switch(G){case t.image_compression.FAST:W=1,J=l;break;case t.image_compression.MEDIUM:W=6,J=i;break;case t.image_compression.SLOW:W=9,J=x}F=r(F,j,H,J);var ie=PD(F,{level:W});return t.__addimage__.arrayBufferToBinaryString(ie)},r=function(F,j,H,G){for(var W,J,ie,he=F.length/j,ge=new Uint8Array(F.length+he),fe=I(),ye=0;ye<he;ye+=1){if(ie=ye*j,W=F.subarray(ie,ie+j),G)ge.set(G(W,H,J),ie+ye);else{for(var pe,be=fe.length,Ae=[];pe<be;pe+=1)Ae[pe]=fe[pe](W,H,J);var Oe=R(Ae.concat());ge.set(Ae[Oe],ie+ye)}J=W}return ge},s=function(F){var j=Array.apply([],F);return j.unshift(0),j},l=function(F,j){var H,G=[],W=F.length;G[0]=1;for(var J=0;J<W;J+=1)H=F[J-j]||0,G[J+1]=F[J]-H+256&255;return G},f=function(F,j,H){var G,W=[],J=F.length;W[0]=2;for(var ie=0;ie<J;ie+=1)G=H&&H[ie]||0,W[ie+1]=F[ie]-G+256&255;return W},i=function(F,j,H){var G,W,J=[],ie=F.length;J[0]=3;for(var he=0;he<ie;he+=1)G=F[he-j]||0,W=H&&H[he]||0,J[he+1]=F[he]+256-(G+W>>>1)&255;return J},x=function(F,j,H){var G,W,J,ie,he=[],ge=F.length;he[0]=4;for(var fe=0;fe<ge;fe+=1)G=F[fe-j]||0,W=H&&H[fe]||0,J=H&&H[fe-j]||0,ie=S(G,W,J),he[fe+1]=F[fe]-ie+256&255;return he},S=function(F,j,H){if(F===j&&j===H)return F;var G=Math.abs(j-H),W=Math.abs(F-H),J=Math.abs(F+j-H-H);return G<=W&&G<=J?F:W<=J?j:H},I=function(){return[s,l,f,i,x]},R=function(F){var j=F.map(function(H){return H.reduce(function(G,W){return G+Math.abs(W)},0)});return j.indexOf(Math.min.apply(null,j))};t.processPNG=function(F,j,H,G){var W,J,ie,he,ge,fe,ye,pe,be,Ae,Oe,ue,we,ke,De,je=this.decode.FLATE_DECODE,ze="";if(this.__addimage__.isArrayBuffer(F)&&(F=new Uint8Array(F)),this.__addimage__.isArrayBufferView(F)){if(F=(ie=new NEe(F)).imgData,J=ie.bits,W=ie.colorSpace,ge=ie.colors,[4,6].indexOf(ie.colorType)!==-1){if(ie.bits===8){be=(pe=ie.pixelBitlength==32?new Uint32Array(ie.decodePixels().buffer):ie.pixelBitlength==16?new Uint16Array(ie.decodePixels().buffer):new Uint8Array(ie.decodePixels().buffer)).length,Oe=new Uint8Array(be*ie.colors),Ae=new Uint8Array(be);var Ue,Fe=ie.pixelBitlength-ie.bits;for(ke=0,De=0;ke<be;ke++){for(we=pe[ke],Ue=0;Ue<Fe;)Oe[De++]=we>>>Ue&255,Ue+=ie.bits;Ae[ke]=we>>>Ue&255}}if(ie.bits===16){be=(pe=new Uint32Array(ie.decodePixels().buffer)).length,Oe=new Uint8Array(be*(32/ie.pixelBitlength)*ie.colors),Ae=new Uint8Array(be*(32/ie.pixelBitlength)),ue=ie.colors>1,ke=0,De=0;for(var Qe=0;ke<be;)we=pe[ke++],Oe[De++]=we>>>0&255,ue&&(Oe[De++]=we>>>16&255,we=pe[ke++],Oe[De++]=we>>>0&255),Ae[Qe++]=we>>>16&255;J=8}G!==t.image_compression.NONE&&e()?(F=n(Oe,ie.width*ie.colors,ie.colors,G),ye=n(Ae,ie.width,1,G)):(F=Oe,ye=Ae,je=void 0)}if(ie.colorType===3&&(W=this.color_spaces.INDEXED,fe=ie.palette,ie.transparency.indexed)){var Be=ie.transparency.indexed,bt=0;for(ke=0,be=Be.length;ke<be;++ke)bt+=Be[ke];if((bt/=255)===be-1&&Be.indexOf(0)!==-1)he=[Be.indexOf(0)];else if(bt!==be){for(pe=ie.decodePixels(),Ae=new Uint8Array(pe.length),ke=0,be=pe.length;ke<be;ke++)Ae[ke]=Be[pe[ke]];ye=n(Ae,ie.width,1)}}var xe=function(Le){var Xe;switch(Le){case t.image_compression.FAST:Xe=11;break;case t.image_compression.MEDIUM:Xe=13;break;case t.image_compression.SLOW:Xe=14;break;default:Xe=12}return Xe}(G);return je===this.decode.FLATE_DECODE&&(ze="/Predictor "+xe+" "),ze+="/Colors "+ge+" /BitsPerComponent "+J+" /Columns "+ie.width,(this.__addimage__.isArrayBuffer(F)||this.__addimage__.isArrayBufferView(F))&&(F=this.__addimage__.arrayBufferToBinaryString(F)),(ye&&this.__addimage__.isArrayBuffer(ye)||this.__addimage__.isArrayBufferView(ye))&&(ye=this.__addimage__.arrayBufferToBinaryString(ye)),{alias:H,data:F,index:j,filter:je,decodeParameters:ze,transparency:he,palette:fe,sMask:ye,predictor:xe,width:ie.width,height:ie.height,bitsPerComponent:J,colorSpace:W}}}})(Ui.API),function(t){t.processGIF89A=function(e,n,r,s){var l=new zEe(e),f=l.width,i=l.height,x=[];l.decodeAndBlitFrameRGBA(0,x);var S={data:x,width:f,height:i},I=new u4(100).encode(S,100);return t.processJPEG.call(this,I,n,r,s)},t.processGIF87A=t.processGIF89A}(Ui.API),vp.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var t=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(t);for(var e=0;e<t;e++){var n=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),l=this.datav.getUint8(this.pos++,!0);this.palette[e]={red:s,green:r,blue:n,quad:l}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},vp.prototype.parseBGR=function(){this.pos=this.offset;try{var t="bit"+this.bitPP,e=this.width*this.height*4;this.data=new Uint8Array(e),this[t]()}catch(n){ro.log("bit decode error:"+n)}},vp.prototype.bit1=function(){var t,e=Math.ceil(this.width/8),n=e%4;for(t=this.height-1;t>=0;t--){for(var r=this.bottom_up?t:this.height-1-t,s=0;s<e;s++)for(var l=this.datav.getUint8(this.pos++,!0),f=r*this.width*4+8*s*4,i=0;i<8&&8*s+i<this.width;i++){var x=this.palette[l>>7-i&1];this.data[f+4*i]=x.blue,this.data[f+4*i+1]=x.green,this.data[f+4*i+2]=x.red,this.data[f+4*i+3]=255}n!==0&&(this.pos+=4-n)}},vp.prototype.bit4=function(){for(var t=Math.ceil(this.width/2),e=t%4,n=this.height-1;n>=0;n--){for(var r=this.bottom_up?n:this.height-1-n,s=0;s<t;s++){var l=this.datav.getUint8(this.pos++,!0),f=r*this.width*4+2*s*4,i=l>>4,x=15&l,S=this.palette[i];if(this.data[f]=S.blue,this.data[f+1]=S.green,this.data[f+2]=S.red,this.data[f+3]=255,2*s+1>=this.width)break;S=this.palette[x],this.data[f+4]=S.blue,this.data[f+4+1]=S.green,this.data[f+4+2]=S.red,this.data[f+4+3]=255}e!==0&&(this.pos+=4-e)}},vp.prototype.bit8=function(){for(var t=this.width%4,e=this.height-1;e>=0;e--){for(var n=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var s=this.datav.getUint8(this.pos++,!0),l=n*this.width*4+4*r;if(s<this.palette.length){var f=this.palette[s];this.data[l]=f.red,this.data[l+1]=f.green,this.data[l+2]=f.blue,this.data[l+3]=255}else this.data[l]=255,this.data[l+1]=255,this.data[l+2]=255,this.data[l+3]=255}t!==0&&(this.pos+=4-t)}},vp.prototype.bit15=function(){for(var t=this.width%3,e=parseInt("11111",2),n=this.height-1;n>=0;n--){for(var r=this.bottom_up?n:this.height-1-n,s=0;s<this.width;s++){var l=this.datav.getUint16(this.pos,!0);this.pos+=2;var f=(l&e)/e*255|0,i=(l>>5&e)/e*255|0,x=(l>>10&e)/e*255|0,S=l>>15?255:0,I=r*this.width*4+4*s;this.data[I]=x,this.data[I+1]=i,this.data[I+2]=f,this.data[I+3]=S}this.pos+=t}},vp.prototype.bit16=function(){for(var t=this.width%3,e=parseInt("11111",2),n=parseInt("111111",2),r=this.height-1;r>=0;r--){for(var s=this.bottom_up?r:this.height-1-r,l=0;l<this.width;l++){var f=this.datav.getUint16(this.pos,!0);this.pos+=2;var i=(f&e)/e*255|0,x=(f>>5&n)/n*255|0,S=(f>>11)/e*255|0,I=s*this.width*4+4*l;this.data[I]=S,this.data[I+1]=x,this.data[I+2]=i,this.data[I+3]=255}this.pos+=t}},vp.prototype.bit24=function(){for(var t=this.height-1;t>=0;t--){for(var e=this.bottom_up?t:this.height-1-t,n=0;n<this.width;n++){var r=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),l=this.datav.getUint8(this.pos++,!0),f=e*this.width*4+4*n;this.data[f]=l,this.data[f+1]=s,this.data[f+2]=r,this.data[f+3]=255}this.pos+=this.width%4}},vp.prototype.bit32=function(){for(var t=this.height-1;t>=0;t--)for(var e=this.bottom_up?t:this.height-1-t,n=0;n<this.width;n++){var r=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),l=this.datav.getUint8(this.pos++,!0),f=this.datav.getUint8(this.pos++,!0),i=e*this.width*4+4*n;this.data[i]=l,this.data[i+1]=s,this.data[i+2]=r,this.data[i+3]=f}},vp.prototype.getData=function(){return this.data},function(t){t.processBMP=function(e,n,r,s){var l=new vp(e,!1),f=l.width,i=l.height,x={data:l.getData(),width:f,height:i},S=new u4(100).encode(x,100);return t.processJPEG.call(this,S,n,r,s)}}(Ui.API),I$.prototype.getData=function(){return this.data},function(t){t.processWEBP=function(e,n,r,s){var l=new I$(e),f=l.width,i=l.height,x={data:l.getData(),width:f,height:i},S=new u4(100).encode(x,100);return t.processJPEG.call(this,S,n,r,s)}}(Ui.API),Ui.API.processRGBA=function(t,e,n){for(var r=t.data,s=r.length,l=new Uint8Array(s/4*3),f=new Uint8Array(s/4),i=0,x=0,S=0;S<s;S+=4){var I=r[S],R=r[S+1],F=r[S+2],j=r[S+3];l[i++]=I,l[i++]=R,l[i++]=F,f[x++]=j}var H=this.__addimage__.arrayBufferToBinaryString(l);return{alpha:this.__addimage__.arrayBufferToBinaryString(f),data:H,index:e,alias:n,colorSpace:"DeviceRGB",bitsPerComponent:8,width:t.width,height:t.height}},Ui.API.setLanguage=function(t){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[t]!==void 0&&(this.internal.languageSettings.languageCode=t,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},d0=Ui.API,pA=d0.getCharWidthsArray=function(t,e){var n,r,s=(e=e||{}).font||this.internal.getFont(),l=e.fontSize||this.internal.getFontSize(),f=e.charSpace||this.internal.getCharSpace(),i=e.widths?e.widths:s.metadata.Unicode.widths,x=i.fof?i.fof:1,S=e.kerning?e.kerning:s.metadata.Unicode.kerning,I=S.fof?S.fof:1,R=e.doKerning!==!1,F=0,j=t.length,H=0,G=i[0]||x,W=[];for(n=0;n<j;n++)r=t.charCodeAt(n),typeof s.metadata.widthOfString=="function"?W.push((s.metadata.widthOfGlyph(s.metadata.characterToGlyph(r))+f*(1e3/l)||0)/1e3):(F=R&&ks(S[r])==="object"&&!isNaN(parseInt(S[r][H],10))?S[r][H]/I:0,W.push((i[r]||G)/x+F)),H=r;return W},T$=d0.getStringUnitWidth=function(t,e){var n=(e=e||{}).fontSize||this.internal.getFontSize(),r=e.font||this.internal.getFont(),s=e.charSpace||this.internal.getCharSpace();return d0.processArabic&&(t=d0.processArabic(t)),typeof r.metadata.widthOfString=="function"?r.metadata.widthOfString(t,n,s)/n:pA.apply(this,arguments).reduce(function(l,f){return l+f},0)},E$=function(t,e,n,r){for(var s=[],l=0,f=t.length,i=0;l!==f&&i+e[l]<n;)i+=e[l],l++;s.push(t.slice(0,l));var x=l;for(i=0;l!==f;)i+e[l]>r&&(s.push(t.slice(x,l)),i=0,x=l),i+=e[l],l++;return x!==l&&s.push(t.slice(x,l)),s},M$=function(t,e,n){n||(n={});var r,s,l,f,i,x,S,I=[],R=[I],F=n.textIndent||0,j=0,H=0,G=t.split(" "),W=pA.apply(this,[" ",n])[0];if(x=n.lineIndent===-1?G[0].length+2:n.lineIndent||0){var J=Array(x).join(" "),ie=[];G.map(function(ge){(ge=ge.split(/\s*\n/)).length>1?ie=ie.concat(ge.map(function(fe,ye){return(ye&&fe.length?`
`:"")+fe})):ie.push(ge[0])}),G=ie,x=T$.apply(this,[J,n])}for(l=0,f=G.length;l<f;l++){var he=0;if(r=G[l],x&&r[0]==`
`&&(r=r.substr(1),he=1),F+j+(H=(s=pA.apply(this,[r,n])).reduce(function(ge,fe){return ge+fe},0))>e||he){if(H>e){for(i=E$.apply(this,[r,s,e-(F+j),e]),I.push(i.shift()),I=[i.pop()];i.length;)R.push([i.shift()]);H=s.slice(r.length-(I[0]?I[0].length:0)).reduce(function(ge,fe){return ge+fe},0)}else I=[r];R.push(I),F=H+x,j=W}else I.push(r),F+=j+H,j=W}return S=x?function(ge,fe){return(fe?J:"")+ge.join(" ")}:function(ge){return ge.join(" ")},R.map(S)},d0.splitTextToSize=function(t,e,n){var r,s=(n=n||{}).fontSize||this.internal.getFontSize(),l=(function(I){if(I.widths&&I.kerning)return{widths:I.widths,kerning:I.kerning};var R=this.internal.getFont(I.fontName,I.fontStyle);return R.metadata.Unicode?{widths:R.metadata.Unicode.widths||{0:1},kerning:R.metadata.Unicode.kerning||{}}:{font:R.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,n);r=Array.isArray(t)?t:String(t).split(/\r?\n/);var f=1*this.internal.scaleFactor*e/s;l.textIndent=n.textIndent?1*n.textIndent*this.internal.scaleFactor/s:0,l.lineIndent=n.lineIndent;var i,x,S=[];for(i=0,x=r.length;i<x;i++)S=S.concat(M$.apply(this,[r[i],f,l]));return S},function(t){t.__fontmetrics__=t.__fontmetrics__||{};for(var e="klmnopqrstuvwxyz",n={},r={},s=0;s<e.length;s++)n[e[s]]="0123456789abcdef"[s],r["0123456789abcdef"[s]]=e[s];var l=function(R){return"0x"+parseInt(R,10).toString(16)},f=t.__fontmetrics__.compress=function(R){var F,j,H,G,W=["{"];for(var J in R){if(F=R[J],isNaN(parseInt(J,10))?j="'"+J+"'":(J=parseInt(J,10),j=(j=l(J).slice(2)).slice(0,-1)+r[j.slice(-1)]),typeof F=="number")F<0?(H=l(F).slice(3),G="-"):(H=l(F).slice(2),G=""),H=G+H.slice(0,-1)+r[H.slice(-1)];else{if(ks(F)!=="object")throw new Error("Don't know what to do with value type "+ks(F)+".");H=f(F)}W.push(j+H)}return W.push("}"),W.join("")},i=t.__fontmetrics__.uncompress=function(R){if(typeof R!="string")throw new Error("Invalid argument passed to uncompress.");for(var F,j,H,G,W={},J=1,ie=W,he=[],ge="",fe="",ye=R.length-1,pe=1;pe<ye;pe+=1)(G=R[pe])=="'"?F?(H=F.join(""),F=void 0):F=[]:F?F.push(G):G=="{"?(he.push([ie,H]),ie={},H=void 0):G=="}"?((j=he.pop())[0][j[1]]=ie,H=void 0,ie=j[0]):G=="-"?J=-1:H===void 0?n.hasOwnProperty(G)?(ge+=n[G],H=parseInt(ge,16)*J,J=1,ge=""):ge+=G:n.hasOwnProperty(G)?(fe+=n[G],ie[H]=parseInt(fe,16)*J,J=1,H=void 0,fe=""):fe+=G;return W},x={codePages:["WinAnsiEncoding"],WinAnsiEncoding:i("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},S={Unicode:{Courier:x,"Courier-Bold":x,"Courier-BoldOblique":x,"Courier-Oblique":x,Helvetica:x,"Helvetica-Bold":x,"Helvetica-BoldOblique":x,"Helvetica-Oblique":x,"Times-Roman":x,"Times-Bold":x,"Times-BoldItalic":x,"Times-Italic":x}},I={Unicode:{"Courier-Oblique":i("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":i("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":i("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:i("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":i("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":i("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:i("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:i("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":i("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:i("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":i("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":i("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":i("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":i("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};t.events.push(["addFont",function(R){var F=R.font,j=I.Unicode[F.postScriptName];j&&(F.metadata.Unicode={},F.metadata.Unicode.widths=j.widths,F.metadata.Unicode.kerning=j.kerning);var H=S.Unicode[F.postScriptName];H&&(F.metadata.Unicode.encoding=H,F.encoding=H.codePages[0])}])}(Ui.API),function(t){var e=function(n){for(var r=n.length,s=new Uint8Array(r),l=0;l<r;l++)s[l]=n.charCodeAt(l);return s};t.API.events.push(["addFont",function(n){var r=void 0,s=n.font,l=n.instance;if(!s.isStandardFont){if(l===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+s.postScriptName+"').");if(typeof(r=l.existsFileInVFS(s.postScriptName)===!1?l.loadFile(s.postScriptName):l.getFileFromVFS(s.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+s.postScriptName+"').");(function(f,i){i=/^\x00\x01\x00\x00/.test(i)?e(i):e(jx(i)),f.metadata=t.API.TTFFont.open(i),f.metadata.Unicode=f.metadata.Unicode||{encoding:{},kerning:{},widths:[]},f.metadata.glyIdsUsed=[0]})(s,r)}}])}(Ui),function(t){function e(){return(Wi.canvg?Promise.resolve(Wi.canvg):TD(()=>import("./index.es-DI37r0sZ.js"),[])).catch(function(n){return Promise.reject(new Error("Could not load canvg: "+n))}).then(function(n){return n.default?n.default:n})}Ui.API.addSvgAsImage=function(n,r,s,l,f,i,x,S){if(isNaN(r)||isNaN(s))throw ro.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(l)||isNaN(f))throw ro.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var I=document.createElement("canvas");I.width=l,I.height=f;var R=I.getContext("2d");R.fillStyle="#fff",R.fillRect(0,0,I.width,I.height);var F={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},j=this;return e().then(function(H){return H.fromString(R,n,F)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(H){return H.render(F)}).then(function(){j.addImage(I.toDataURL("image/jpeg",1),r,s,l,f,x,S)})}}(),Ui.API.putTotalPages=function(t){var e,n=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(e=new RegExp(t,"g"),n=this.internal.getNumberOfPages()):(e=new RegExp(this.pdfEscape16(t,this.internal.getFont()),"g"),n=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var r=1;r<=this.internal.getNumberOfPages();r++)for(var s=0;s<this.internal.pages[r].length;s++)this.internal.pages[r][s]=this.internal.pages[r][s].replace(e,n);return this},Ui.API.viewerPreferences=function(t,e){var n;t=t||{},e=e||!1;var r,s,l,f={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},i=Object.keys(f),x=[],S=0,I=0,R=0;function F(H,G){var W,J=!1;for(W=0;W<H.length;W+=1)H[W]===G&&(J=!0);return J}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(f)),this.internal.viewerpreferences.isSubscribed=!1),n=this.internal.viewerpreferences.configuration,t==="reset"||e===!0){var j=i.length;for(R=0;R<j;R+=1)n[i[R]].value=n[i[R]].defaultValue,n[i[R]].explicitSet=!1}if(ks(t)==="object"){for(s in t)if(l=t[s],F(i,s)&&l!==void 0){if(n[s].type==="boolean"&&typeof l=="boolean")n[s].value=l;else if(n[s].type==="name"&&F(n[s].valueSet,l))n[s].value=l;else if(n[s].type==="integer"&&Number.isInteger(l))n[s].value=l;else if(n[s].type==="array"){for(S=0;S<l.length;S+=1)if(r=!0,l[S].length===1&&typeof l[S][0]=="number")x.push(String(l[S]-1));else if(l[S].length>1){for(I=0;I<l[S].length;I+=1)typeof l[S][I]!="number"&&(r=!1);r===!0&&x.push([l[S][0]-1,l[S][1]-1].join(" "))}n[s].value="["+x.join(" ")+"]"}else n[s].value=n[s].defaultValue;n[s].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var H,G=[];for(H in n)n[H].explicitSet===!0&&(n[H].type==="name"?G.push("/"+H+" /"+n[H].value):G.push("/"+H+" "+n[H].value));G.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+G.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=n,this},function(t){var e=function(){var r='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',s=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),l=unescape(encodeURIComponent(r)),f=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),i=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),x=unescape(encodeURIComponent("</x:xmpmeta>")),S=l.length+f.length+i.length+s.length+x.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+S+" >>"),this.internal.write("stream"),this.internal.write(s+l+f+i+x),this.internal.write("endstream"),this.internal.write("endobj")},n=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};t.addMetadata=function(r,s){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:r,namespaceuri:s||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",n),this.internal.events.subscribe("postPutResources",e)),this}}(Ui.API),function(t){var e=t.API,n=e.pdfEscape16=function(l,f){for(var i,x=f.metadata.Unicode.widths,S=["","0","00","000","0000"],I=[""],R=0,F=l.length;R<F;++R){if(i=f.metadata.characterToGlyph(l.charCodeAt(R)),f.metadata.glyIdsUsed.push(i),f.metadata.toUnicode[i]=l.charCodeAt(R),x.indexOf(i)==-1&&(x.push(i),x.push([parseInt(f.metadata.widthOfGlyph(i),10)])),i=="0")return I.join("");i=i.toString(16),I.push(S[4-i.length],i)}return I.join("")},r=function(l){var f,i,x,S,I,R,F;for(I=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,x=[],R=0,F=(i=Object.keys(l).sort(function(j,H){return j-H})).length;R<F;R++)f=i[R],x.length>=100&&(I+=`
`+x.length+` beginbfchar
`+x.join(`
`)+`
endbfchar`,x=[]),l[f]!==void 0&&l[f]!==null&&typeof l[f].toString=="function"&&(S=("0000"+l[f].toString(16)).slice(-4),f=("0000"+(+f).toString(16)).slice(-4),x.push("<"+f+"><"+S+">"));return x.length&&(I+=`
`+x.length+` beginbfchar
`+x.join(`
`)+`
endbfchar
`),I+=`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};e.events.push(["putFont",function(l){(function(f){var i=f.font,x=f.out,S=f.newObject,I=f.putStream;if(i.metadata instanceof t.API.TTFFont&&i.encoding==="Identity-H"){for(var R=i.metadata.Unicode.widths,F=i.metadata.subset.encode(i.metadata.glyIdsUsed,1),j="",H=0;H<F.length;H++)j+=String.fromCharCode(F[H]);var G=S();I({data:j,addLength1:!0,objectId:G}),x("endobj");var W=S();I({data:r(i.metadata.toUnicode),addLength1:!0,objectId:W}),x("endobj");var J=S();x("<<"),x("/Type /FontDescriptor"),x("/FontName /"+_0(i.fontName)),x("/FontFile2 "+G+" 0 R"),x("/FontBBox "+t.API.PDFObject.convert(i.metadata.bbox)),x("/Flags "+i.metadata.flags),x("/StemV "+i.metadata.stemV),x("/ItalicAngle "+i.metadata.italicAngle),x("/Ascent "+i.metadata.ascender),x("/Descent "+i.metadata.decender),x("/CapHeight "+i.metadata.capHeight),x(">>"),x("endobj");var ie=S();x("<<"),x("/Type /Font"),x("/BaseFont /"+_0(i.fontName)),x("/FontDescriptor "+J+" 0 R"),x("/W "+t.API.PDFObject.convert(R)),x("/CIDToGIDMap /Identity"),x("/DW 1000"),x("/Subtype /CIDFontType2"),x("/CIDSystemInfo"),x("<<"),x("/Supplement 0"),x("/Registry (Adobe)"),x("/Ordering ("+i.encoding+")"),x(">>"),x(">>"),x("endobj"),i.objectNumber=S(),x("<<"),x("/Type /Font"),x("/Subtype /Type0"),x("/ToUnicode "+W+" 0 R"),x("/BaseFont /"+_0(i.fontName)),x("/Encoding /"+i.encoding),x("/DescendantFonts ["+ie+" 0 R]"),x(">>"),x("endobj"),i.isAlreadyPutted=!0}})(l)}]),e.events.push(["putFont",function(l){(function(f){var i=f.font,x=f.out,S=f.newObject,I=f.putStream;if(i.metadata instanceof t.API.TTFFont&&i.encoding==="WinAnsiEncoding"){for(var R=i.metadata.rawData,F="",j=0;j<R.length;j++)F+=String.fromCharCode(R[j]);var H=S();I({data:F,addLength1:!0,objectId:H}),x("endobj");var G=S();I({data:r(i.metadata.toUnicode),addLength1:!0,objectId:G}),x("endobj");var W=S();x("<<"),x("/Descent "+i.metadata.decender),x("/CapHeight "+i.metadata.capHeight),x("/StemV "+i.metadata.stemV),x("/Type /FontDescriptor"),x("/FontFile2 "+H+" 0 R"),x("/Flags 96"),x("/FontBBox "+t.API.PDFObject.convert(i.metadata.bbox)),x("/FontName /"+_0(i.fontName)),x("/ItalicAngle "+i.metadata.italicAngle),x("/Ascent "+i.metadata.ascender),x(">>"),x("endobj"),i.objectNumber=S();for(var J=0;J<i.metadata.hmtx.widths.length;J++)i.metadata.hmtx.widths[J]=parseInt(i.metadata.hmtx.widths[J]*(1e3/i.metadata.head.unitsPerEm));x("<</Subtype/TrueType/Type/Font/ToUnicode "+G+" 0 R/BaseFont/"+_0(i.fontName)+"/FontDescriptor "+W+" 0 R/Encoding/"+i.encoding+" /FirstChar 29 /LastChar 255 /Widths "+t.API.PDFObject.convert(i.metadata.hmtx.widths)+">>"),x("endobj"),i.isAlreadyPutted=!0}})(l)}]);var s=function(l){var f,i=l.text||"",x=l.x,S=l.y,I=l.options||{},R=l.mutex||{},F=R.pdfEscape,j=R.activeFontKey,H=R.fonts,G=j,W="",J=0,ie="",he=H[G].encoding;if(H[G].encoding!=="Identity-H")return{text:i,x,y:S,options:I,mutex:R};for(ie=i,G=j,Array.isArray(i)&&(ie=i[0]),J=0;J<ie.length;J+=1)H[G].metadata.hasOwnProperty("cmap")&&(f=H[G].metadata.cmap.unicode.codeMap[ie[J].charCodeAt(0)]),f||ie[J].charCodeAt(0)<256&&H[G].metadata.hasOwnProperty("Unicode")?W+=ie[J]:W+="";var ge="";return parseInt(G.slice(1))<14||he==="WinAnsiEncoding"?ge=F(W,G).split("").map(function(fe){return fe.charCodeAt(0).toString(16)}).join(""):he==="Identity-H"&&(ge=n(W,H[G])),R.isHex=!0,{text:ge,x,y:S,options:I,mutex:R}};e.events.push(["postProcessText",function(l){var f=l.text||"",i=[],x={text:f,x:l.x,y:l.y,options:l.options,mutex:l.mutex};if(Array.isArray(f)){var S=0;for(S=0;S<f.length;S+=1)Array.isArray(f[S])&&f[S].length===3?i.push([s(Object.assign({},x,{text:f[S][0]})).text,f[S][1],f[S][2]]):i.push(s(Object.assign({},x,{text:f[S]})).text);l.text=i}else l.text=s(Object.assign({},x,{text:f})).text}])}(Ui),function(t){var e=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};t.existsFileInVFS=function(n){return e.call(this),this.internal.vFS[n]!==void 0},t.addFileToVFS=function(n,r){return e.call(this),this.internal.vFS[n]=r,this},t.getFileFromVFS=function(n){return e.call(this),this.internal.vFS[n]!==void 0?this.internal.vFS[n]:null}}(Ui.API),function(t){t.__bidiEngine__=t.prototype.__bidiEngine__=function(r){var s,l,f,i,x,S,I,R=e,F=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],j=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],H={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},G={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},W=["(",")","(","<",">","<","[","]","[","{","}","{","«","»","«","‹","›","‹","⁅","⁆","⁅","⁽","⁾","⁽","₍","₎","₍","≤","≥","≤","〈","〉","〈","﹙","﹚","﹙","﹛","﹜","﹛","﹝","﹞","﹝","﹤","﹥","﹤"],J=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),ie=!1,he=0;this.__bidiEngine__={};var ge=function(ue){var we=ue.charCodeAt(),ke=we>>8,De=G[ke];return De!==void 0?R[256*De+(255&we)]:ke===252||ke===253?"AL":J.test(ke)?"L":ke===8?"R":"N"},fe=function(ue){for(var we,ke=0;ke<ue.length;ke++){if((we=ge(ue.charAt(ke)))==="L")return!1;if(we==="R")return!0}return!1},ye=function(ue,we,ke,De){var je,ze,Ue,Fe,Qe=we[De];switch(Qe){case"L":case"R":ie=!1;break;case"N":case"AN":break;case"EN":ie&&(Qe="AN");break;case"AL":ie=!0,Qe="R";break;case"WS":Qe="N";break;case"CS":De<1||De+1>=we.length||(je=ke[De-1])!=="EN"&&je!=="AN"||(ze=we[De+1])!=="EN"&&ze!=="AN"?Qe="N":ie&&(ze="AN"),Qe=ze===je?ze:"N";break;case"ES":Qe=(je=De>0?ke[De-1]:"B")==="EN"&&De+1<we.length&&we[De+1]==="EN"?"EN":"N";break;case"ET":if(De>0&&ke[De-1]==="EN"){Qe="EN";break}if(ie){Qe="N";break}for(Ue=De+1,Fe=we.length;Ue<Fe&&we[Ue]==="ET";)Ue++;Qe=Ue<Fe&&we[Ue]==="EN"?"EN":"N";break;case"NSM":if(f&&!i){for(Fe=we.length,Ue=De+1;Ue<Fe&&we[Ue]==="NSM";)Ue++;if(Ue<Fe){var Be=ue[De],bt=Be>=1425&&Be<=2303||Be===64286;if(je=we[Ue],bt&&(je==="R"||je==="AL")){Qe="R";break}}}Qe=De<1||(je=we[De-1])==="B"?"N":ke[De-1];break;case"B":ie=!1,s=!0,Qe=he;break;case"S":l=!0,Qe="N";break;case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":ie=!1;break;case"BN":Qe="N"}return Qe},pe=function(ue,we,ke){var De=ue.split("");return ke&&be(De,ke,{hiLevel:he}),De.reverse(),we&&we.reverse(),De.join("")},be=function(ue,we,ke){var De,je,ze,Ue,Fe,Qe=-1,Be=ue.length,bt=0,xe=[],Le=he?j:F,Xe=[];for(ie=!1,s=!1,l=!1,je=0;je<Be;je++)Xe[je]=ge(ue[je]);for(ze=0;ze<Be;ze++){if(Fe=bt,xe[ze]=ye(ue,Xe,xe,ze),De=240&(bt=Le[Fe][H[xe[ze]]]),bt&=15,we[ze]=Ue=Le[bt][5],De>0)if(De===16){for(je=Qe;je<ze;je++)we[je]=1;Qe=-1}else Qe=-1;if(Le[bt][6])Qe===-1&&(Qe=ze);else if(Qe>-1){for(je=Qe;je<ze;je++)we[je]=Ue;Qe=-1}Xe[ze]==="B"&&(we[ze]=0),ke.hiLevel|=Ue}l&&function(ct,vt,Nt){for(var mt=0;mt<Nt;mt++)if(ct[mt]==="S"){vt[mt]=he;for(var yt=mt-1;yt>=0&&ct[yt]==="WS";yt--)vt[yt]=he}}(Xe,we,Be)},Ae=function(ue,we,ke,De,je){if(!(je.hiLevel<ue)){if(ue===1&&he===1&&!s)return we.reverse(),void(ke&&ke.reverse());for(var ze,Ue,Fe,Qe,Be=we.length,bt=0;bt<Be;){if(De[bt]>=ue){for(Fe=bt+1;Fe<Be&&De[Fe]>=ue;)Fe++;for(Qe=bt,Ue=Fe-1;Qe<Ue;Qe++,Ue--)ze=we[Qe],we[Qe]=we[Ue],we[Ue]=ze,ke&&(ze=ke[Qe],ke[Qe]=ke[Ue],ke[Ue]=ze);bt=Fe}bt++}}},Oe=function(ue,we,ke){var De=ue.split(""),je={hiLevel:he};return ke||(ke=[]),be(De,ke,je),function(ze,Ue,Fe){if(Fe.hiLevel!==0&&I)for(var Qe,Be=0;Be<ze.length;Be++)Ue[Be]===1&&(Qe=W.indexOf(ze[Be]))>=0&&(ze[Be]=W[Qe+1])}(De,ke,je),Ae(2,De,we,ke,je),Ae(1,De,we,ke,je),De.join("")};return this.__bidiEngine__.doBidiReorder=function(ue,we,ke){if(function(je,ze){if(ze)for(var Ue=0;Ue<je.length;Ue++)ze[Ue]=Ue;i===void 0&&(i=fe(je)),S===void 0&&(S=fe(je))}(ue,we),f||!x||S)if(f&&x&&i^S)he=i?1:0,ue=pe(ue,we,ke);else if(!f&&x&&S)he=i?1:0,ue=Oe(ue,we,ke),ue=pe(ue,we);else if(!f||i||x||S){if(f&&!x&&i^S)ue=pe(ue,we),i?(he=0,ue=Oe(ue,we,ke)):(he=1,ue=Oe(ue,we,ke),ue=pe(ue,we));else if(f&&i&&!x&&S)he=1,ue=Oe(ue,we,ke),ue=pe(ue,we);else if(!f&&!x&&i^S){var De=I;i?(he=1,ue=Oe(ue,we,ke),he=0,I=!1,ue=Oe(ue,we,ke),I=De):(he=0,ue=Oe(ue,we,ke),ue=pe(ue,we),he=1,I=!1,ue=Oe(ue,we,ke),I=De,ue=pe(ue,we))}}else he=0,ue=Oe(ue,we,ke);else he=i?1:0,ue=Oe(ue,we,ke);return ue},this.__bidiEngine__.setOptions=function(ue){ue&&(f=ue.isInputVisual,x=ue.isOutputVisual,i=ue.isInputRtl,S=ue.isOutputRtl,I=ue.isSymmetricSwapping)},this.__bidiEngine__.setOptions(r),this.__bidiEngine__};var e=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],n=new t.__bidiEngine__({isInputVisual:!0});t.API.events.push(["postProcessText",function(r){var s=r.text;r.x,r.y;var l=r.options||{};r.mutex,l.lang;var f=[];if(l.isInputVisual=typeof l.isInputVisual!="boolean"||l.isInputVisual,n.setOptions(l),Object.prototype.toString.call(s)==="[object Array]"){var i=0;for(f=[],i=0;i<s.length;i+=1)Object.prototype.toString.call(s[i])==="[object Array]"?f.push([n.doBidiReorder(s[i][0]),s[i][1],s[i][2]]):f.push([n.doBidiReorder(s[i])]);r.text=f}else r.text=n.doBidiReorder(s);n.setOptions({isInputVisual:!0})}])}(Ui),Ui.API.TTFFont=function(){function t(e){var n;if(this.rawData=e,n=this.contents=new Iy(e),this.contents.pos=4,n.readString(4)==="ttcf")throw new Error("TTCF not supported.");n.pos=0,this.parse(),this.subset=new JEe(this),this.registerTTF()}return t.open=function(e){return new t(e)},t.prototype.parse=function(){return this.directory=new BEe(this.contents),this.head=new FEe(this),this.name=new HEe(this),this.cmap=new DJ(this),this.toUnicode={},this.hhea=new UEe(this),this.maxp=new GEe(this),this.hmtx=new WEe(this),this.post=new VEe(this),this.os2=new qEe(this),this.loca=new ZEe(this),this.glyf=new KEe(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},t.prototype.registerTTF=function(){var e,n,r,s,l;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var f,i,x,S;for(S=[],f=0,i=(x=this.bbox).length;f<i;f++)e=x[f],S.push(Math.round(e*this.scaleFactor));return S}).call(this),this.stemV=0,this.post.exists?(r=255&(s=this.post.italic_angle),(32768&(n=s>>16))!=0&&(n=-(1+(65535^n))),this.italicAngle=+(n+"."+r)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(l=this.familyClass)===1||l===2||l===3||l===4||l===5||l===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},t.prototype.characterToGlyph=function(e){var n;return((n=this.cmap.unicode)!=null?n.codeMap[e]:void 0)||0},t.prototype.widthOfGlyph=function(e){var n;return n=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*n},t.prototype.widthOfString=function(e,n,r){var s,l,f,i;for(f=0,l=0,i=(e=""+e).length;0<=i?l<i:l>i;l=0<=i?++l:--l)s=e.charCodeAt(l),f+=this.widthOfGlyph(this.characterToGlyph(s))+r*(1e3/n)||0;return f*(n/1e3)},t.prototype.lineHeight=function(e,n){var r;return n==null&&(n=!1),r=n?this.lineGap:0,(this.ascender+r-this.decender)/1e3*e},t}();var kp,Iy=function(){function t(e){this.data=e??[],this.pos=0,this.length=this.data.length}return t.prototype.readByte=function(){return this.data[this.pos++]},t.prototype.writeByte=function(e){return this.data[this.pos++]=e},t.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},t.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},t.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},t.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},t.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},t.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},t.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},t.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},t.prototype.readString=function(e){var n,r;for(r=[],n=0;0<=e?n<e:n>e;n=0<=e?++n:--n)r[n]=String.fromCharCode(this.readByte());return r.join("")},t.prototype.writeString=function(e){var n,r,s;for(s=[],n=0,r=e.length;0<=r?n<r:n>r;n=0<=r?++n:--n)s.push(this.writeByte(e.charCodeAt(n)));return s},t.prototype.readShort=function(){return this.readInt16()},t.prototype.writeShort=function(e){return this.writeInt16(e)},t.prototype.readLongLong=function(){var e,n,r,s,l,f,i,x;return e=this.readByte(),n=this.readByte(),r=this.readByte(),s=this.readByte(),l=this.readByte(),f=this.readByte(),i=this.readByte(),x=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^n)+1099511627776*(255^r)+4294967296*(255^s)+16777216*(255^l)+65536*(255^f)+256*(255^i)+(255^x)+1):72057594037927940*e+281474976710656*n+1099511627776*r+4294967296*s+16777216*l+65536*f+256*i+x},t.prototype.writeLongLong=function(e){var n,r;return n=Math.floor(e/4294967296),r=4294967295&e,this.writeByte(n>>24&255),this.writeByte(n>>16&255),this.writeByte(n>>8&255),this.writeByte(255&n),this.writeByte(r>>24&255),this.writeByte(r>>16&255),this.writeByte(r>>8&255),this.writeByte(255&r)},t.prototype.readInt=function(){return this.readInt32()},t.prototype.writeInt=function(e){return this.writeInt32(e)},t.prototype.read=function(e){var n,r;for(n=[],r=0;0<=e?r<e:r>e;r=0<=e?++r:--r)n.push(this.readByte());return n},t.prototype.write=function(e){var n,r,s,l;for(l=[],r=0,s=e.length;r<s;r++)n=e[r],l.push(this.writeByte(n));return l},t}(),BEe=function(){var t;function e(n){var r,s,l;for(this.scalarType=n.readInt(),this.tableCount=n.readShort(),this.searchRange=n.readShort(),this.entrySelector=n.readShort(),this.rangeShift=n.readShort(),this.tables={},s=0,l=this.tableCount;0<=l?s<l:s>l;s=0<=l?++s:--s)r={tag:n.readString(4),checksum:n.readInt(),offset:n.readInt(),length:n.readInt()},this.tables[r.tag]=r}return e.prototype.encode=function(n){var r,s,l,f,i,x,S,I,R,F,j,H,G;for(G in j=Object.keys(n).length,x=Math.log(2),R=16*Math.floor(Math.log(j)/x),f=Math.floor(R/x),I=16*j-R,(s=new Iy).writeInt(this.scalarType),s.writeShort(j),s.writeShort(R),s.writeShort(f),s.writeShort(I),l=16*j,S=s.pos+l,i=null,H=[],n)for(F=n[G],s.writeString(G),s.writeInt(t(F)),s.writeInt(S),s.writeInt(F.length),H=H.concat(F),G==="head"&&(i=S),S+=F.length;S%4;)H.push(0),S++;return s.write(H),r=2981146554-t(s.data),s.pos=i+8,s.writeUInt32(r),s.data},t=function(n){var r,s,l,f;for(n=LJ.call(n);n.length%4;)n.push(0);for(l=new Iy(n),s=0,r=0,f=n.length;r<f;r=r+=4)s+=l.readUInt32();return 4294967295&s},e}(),jEe={}.hasOwnProperty,Rm=function(t,e){for(var n in e)jEe.call(e,n)&&(t[n]=e[n]);function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};kp=function(){function t(e){var n;this.file=e,n=this.file.directory.tables[this.tag],this.exists=!!n,n&&(this.offset=n.offset,this.length=n.length,this.parse(this.file.contents))}return t.prototype.parse=function(){},t.prototype.encode=function(){},t.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},t}();var FEe=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return Rm(e,kp),e.prototype.tag="head",e.prototype.parse=function(n){return n.pos=this.offset,this.version=n.readInt(),this.revision=n.readInt(),this.checkSumAdjustment=n.readInt(),this.magicNumber=n.readInt(),this.flags=n.readShort(),this.unitsPerEm=n.readShort(),this.created=n.readLongLong(),this.modified=n.readLongLong(),this.xMin=n.readShort(),this.yMin=n.readShort(),this.xMax=n.readShort(),this.yMax=n.readShort(),this.macStyle=n.readShort(),this.lowestRecPPEM=n.readShort(),this.fontDirectionHint=n.readShort(),this.indexToLocFormat=n.readShort(),this.glyphDataFormat=n.readShort()},e.prototype.encode=function(n){var r;return(r=new Iy).writeInt(this.version),r.writeInt(this.revision),r.writeInt(this.checkSumAdjustment),r.writeInt(this.magicNumber),r.writeShort(this.flags),r.writeShort(this.unitsPerEm),r.writeLongLong(this.created),r.writeLongLong(this.modified),r.writeShort(this.xMin),r.writeShort(this.yMin),r.writeShort(this.xMax),r.writeShort(this.yMax),r.writeShort(this.macStyle),r.writeShort(this.lowestRecPPEM),r.writeShort(this.fontDirectionHint),r.writeShort(n),r.writeShort(this.glyphDataFormat),r.data},e}(),P$=function(){function t(e,n){var r,s,l,f,i,x,S,I,R,F,j,H,G,W,J,ie,he;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=n+e.readInt(),R=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(x=0;x<256;++x)this.codeMap[x]=e.readByte();break;case 4:for(j=e.readUInt16(),F=j/2,e.pos+=6,l=function(){var ge,fe;for(fe=[],x=ge=0;0<=F?ge<F:ge>F;x=0<=F?++ge:--ge)fe.push(e.readUInt16());return fe}(),e.pos+=2,G=function(){var ge,fe;for(fe=[],x=ge=0;0<=F?ge<F:ge>F;x=0<=F?++ge:--ge)fe.push(e.readUInt16());return fe}(),S=function(){var ge,fe;for(fe=[],x=ge=0;0<=F?ge<F:ge>F;x=0<=F?++ge:--ge)fe.push(e.readUInt16());return fe}(),I=function(){var ge,fe;for(fe=[],x=ge=0;0<=F?ge<F:ge>F;x=0<=F?++ge:--ge)fe.push(e.readUInt16());return fe}(),s=(this.length-e.pos+this.offset)/2,i=function(){var ge,fe;for(fe=[],x=ge=0;0<=s?ge<s:ge>s;x=0<=s?++ge:--ge)fe.push(e.readUInt16());return fe}(),x=J=0,he=l.length;J<he;x=++J)for(W=l[x],r=ie=H=G[x];H<=W?ie<=W:ie>=W;r=H<=W?++ie:--ie)I[x]===0?f=r+S[x]:(f=i[I[x]/2+(r-H)-(F-x)]||0)!==0&&(f+=S[x]),this.codeMap[r]=65535&f}e.pos=R}return t.encode=function(e,n){var r,s,l,f,i,x,S,I,R,F,j,H,G,W,J,ie,he,ge,fe,ye,pe,be,Ae,Oe,ue,we,ke,De,je,ze,Ue,Fe,Qe,Be,bt,xe,Le,Xe,ct,vt,Nt,mt,yt,_e,on,Kt;switch(De=new Iy,f=Object.keys(e).sort(function(Pn,Ut){return Pn-Ut}),n){case"macroman":for(G=0,W=function(){var Pn=[];for(H=0;H<256;++H)Pn.push(0);return Pn}(),ie={0:0},l={},je=0,Qe=f.length;je<Qe;je++)ie[yt=e[s=f[je]]]==null&&(ie[yt]=++G),l[s]={old:e[s],new:ie[e[s]]},W[s]=ie[e[s]];return De.writeUInt16(1),De.writeUInt16(0),De.writeUInt32(12),De.writeUInt16(0),De.writeUInt16(262),De.writeUInt16(0),De.write(W),{charMap:l,subtable:De.data,maxGlyphID:G+1};case"unicode":for(we=[],R=[],he=0,ie={},r={},J=S=null,ze=0,Be=f.length;ze<Be;ze++)ie[fe=e[s=f[ze]]]==null&&(ie[fe]=++he),r[s]={old:fe,new:ie[fe]},i=ie[fe]-s,J!=null&&i===S||(J&&R.push(J),we.push(s),S=i),J=s;for(J&&R.push(J),R.push(65535),we.push(65535),Oe=2*(Ae=we.length),be=2*Math.pow(Math.log(Ae)/Math.LN2,2),F=Math.log(be/2)/Math.LN2,pe=2*Ae-be,x=[],ye=[],j=[],H=Ue=0,bt=we.length;Ue<bt;H=++Ue){if(ue=we[H],I=R[H],ue===65535){x.push(0),ye.push(0);break}if(ue-(ke=r[ue].new)>=32768)for(x.push(0),ye.push(2*(j.length+Ae-H)),s=Fe=ue;ue<=I?Fe<=I:Fe>=I;s=ue<=I?++Fe:--Fe)j.push(r[s].new);else x.push(ke-ue),ye.push(0)}for(De.writeUInt16(3),De.writeUInt16(1),De.writeUInt32(12),De.writeUInt16(4),De.writeUInt16(16+8*Ae+2*j.length),De.writeUInt16(0),De.writeUInt16(Oe),De.writeUInt16(be),De.writeUInt16(F),De.writeUInt16(pe),Nt=0,xe=R.length;Nt<xe;Nt++)s=R[Nt],De.writeUInt16(s);for(De.writeUInt16(0),mt=0,Le=we.length;mt<Le;mt++)s=we[mt],De.writeUInt16(s);for(_e=0,Xe=x.length;_e<Xe;_e++)i=x[_e],De.writeUInt16(i);for(on=0,ct=ye.length;on<ct;on++)ge=ye[on],De.writeUInt16(ge);for(Kt=0,vt=j.length;Kt<vt;Kt++)G=j[Kt],De.writeUInt16(G);return{charMap:r,subtable:De.data,maxGlyphID:he+1}}},t}(),DJ=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return Rm(e,kp),e.prototype.tag="cmap",e.prototype.parse=function(n){var r,s,l;for(n.pos=this.offset,this.version=n.readUInt16(),l=n.readUInt16(),this.tables=[],this.unicode=null,s=0;0<=l?s<l:s>l;s=0<=l?++s:--s)r=new P$(n,this.offset),this.tables.push(r),r.isUnicode&&this.unicode==null&&(this.unicode=r);return!0},e.encode=function(n,r){var s,l;return r==null&&(r="macroman"),s=P$.encode(n,r),(l=new Iy).writeUInt16(0),l.writeUInt16(1),s.table=l.data.concat(s.subtable),s},e}(),UEe=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return Rm(e,kp),e.prototype.tag="hhea",e.prototype.parse=function(n){return n.pos=this.offset,this.version=n.readInt(),this.ascender=n.readShort(),this.decender=n.readShort(),this.lineGap=n.readShort(),this.advanceWidthMax=n.readShort(),this.minLeftSideBearing=n.readShort(),this.minRightSideBearing=n.readShort(),this.xMaxExtent=n.readShort(),this.caretSlopeRise=n.readShort(),this.caretSlopeRun=n.readShort(),this.caretOffset=n.readShort(),n.pos+=8,this.metricDataFormat=n.readShort(),this.numberOfMetrics=n.readUInt16()},e}(),qEe=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return Rm(e,kp),e.prototype.tag="OS/2",e.prototype.parse=function(n){if(n.pos=this.offset,this.version=n.readUInt16(),this.averageCharWidth=n.readShort(),this.weightClass=n.readUInt16(),this.widthClass=n.readUInt16(),this.type=n.readShort(),this.ySubscriptXSize=n.readShort(),this.ySubscriptYSize=n.readShort(),this.ySubscriptXOffset=n.readShort(),this.ySubscriptYOffset=n.readShort(),this.ySuperscriptXSize=n.readShort(),this.ySuperscriptYSize=n.readShort(),this.ySuperscriptXOffset=n.readShort(),this.ySuperscriptYOffset=n.readShort(),this.yStrikeoutSize=n.readShort(),this.yStrikeoutPosition=n.readShort(),this.familyClass=n.readShort(),this.panose=function(){var r,s;for(s=[],r=0;r<10;++r)s.push(n.readByte());return s}(),this.charRange=function(){var r,s;for(s=[],r=0;r<4;++r)s.push(n.readInt());return s}(),this.vendorID=n.readString(4),this.selection=n.readShort(),this.firstCharIndex=n.readShort(),this.lastCharIndex=n.readShort(),this.version>0&&(this.ascent=n.readShort(),this.descent=n.readShort(),this.lineGap=n.readShort(),this.winAscent=n.readShort(),this.winDescent=n.readShort(),this.codePageRange=function(){var r,s;for(s=[],r=0;r<2;r=++r)s.push(n.readInt());return s}(),this.version>1))return this.xHeight=n.readShort(),this.capHeight=n.readShort(),this.defaultChar=n.readShort(),this.breakChar=n.readShort(),this.maxContext=n.readShort()},e}(),VEe=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return Rm(e,kp),e.prototype.tag="post",e.prototype.parse=function(n){var r,s,l;switch(n.pos=this.offset,this.format=n.readInt(),this.italicAngle=n.readInt(),this.underlinePosition=n.readShort(),this.underlineThickness=n.readShort(),this.isFixedPitch=n.readInt(),this.minMemType42=n.readInt(),this.maxMemType42=n.readInt(),this.minMemType1=n.readInt(),this.maxMemType1=n.readInt(),this.format){case 65536:break;case 131072:var f;for(s=n.readUInt16(),this.glyphNameIndex=[],f=0;0<=s?f<s:f>s;f=0<=s?++f:--f)this.glyphNameIndex.push(n.readUInt16());for(this.names=[],l=[];n.pos<this.offset+this.length;)r=n.readByte(),l.push(this.names.push(n.readString(r)));return l;case 151552:return s=n.readUInt16(),this.offsets=n.read(s);case 196608:break;case 262144:return this.map=(function(){var i,x,S;for(S=[],f=i=0,x=this.file.maxp.numGlyphs;0<=x?i<x:i>x;f=0<=x?++i:--i)S.push(n.readUInt32());return S}).call(this)}},e}(),$Ee=function(t,e){this.raw=t,this.length=t.length,this.platformID=e.platformID,this.encodingID=e.encodingID,this.languageID=e.languageID},HEe=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return Rm(e,kp),e.prototype.tag="name",e.prototype.parse=function(n){var r,s,l,f,i,x,S,I,R,F,j;for(n.pos=this.offset,n.readShort(),r=n.readShort(),x=n.readShort(),s=[],f=0;0<=r?f<r:f>r;f=0<=r?++f:--f)s.push({platformID:n.readShort(),encodingID:n.readShort(),languageID:n.readShort(),nameID:n.readShort(),length:n.readShort(),offset:this.offset+x+n.readShort()});for(S={},f=R=0,F=s.length;R<F;f=++R)l=s[f],n.pos=l.offset,I=n.readString(l.length),i=new $Ee(I,l),S[j=l.nameID]==null&&(S[j]=[]),S[l.nameID].push(i);this.strings=S,this.copyright=S[0],this.fontFamily=S[1],this.fontSubfamily=S[2],this.uniqueSubfamily=S[3],this.fontName=S[4],this.version=S[5];try{this.postscriptName=S[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=S[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=S[7],this.manufacturer=S[8],this.designer=S[9],this.description=S[10],this.vendorUrl=S[11],this.designerUrl=S[12],this.license=S[13],this.licenseUrl=S[14],this.preferredFamily=S[15],this.preferredSubfamily=S[17],this.compatibleFull=S[18],this.sampleText=S[19]},e}(),GEe=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return Rm(e,kp),e.prototype.tag="maxp",e.prototype.parse=function(n){return n.pos=this.offset,this.version=n.readInt(),this.numGlyphs=n.readUInt16(),this.maxPoints=n.readUInt16(),this.maxContours=n.readUInt16(),this.maxCompositePoints=n.readUInt16(),this.maxComponentContours=n.readUInt16(),this.maxZones=n.readUInt16(),this.maxTwilightPoints=n.readUInt16(),this.maxStorage=n.readUInt16(),this.maxFunctionDefs=n.readUInt16(),this.maxInstructionDefs=n.readUInt16(),this.maxStackElements=n.readUInt16(),this.maxSizeOfInstructions=n.readUInt16(),this.maxComponentElements=n.readUInt16(),this.maxComponentDepth=n.readUInt16()},e}(),WEe=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return Rm(e,kp),e.prototype.tag="hmtx",e.prototype.parse=function(n){var r,s,l,f,i,x,S;for(n.pos=this.offset,this.metrics=[],r=0,x=this.file.hhea.numberOfMetrics;0<=x?r<x:r>x;r=0<=x?++r:--r)this.metrics.push({advance:n.readUInt16(),lsb:n.readInt16()});for(l=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var I,R;for(R=[],r=I=0;0<=l?I<l:I>l;r=0<=l?++I:--I)R.push(n.readInt16());return R}(),this.widths=(function(){var I,R,F,j;for(j=[],I=0,R=(F=this.metrics).length;I<R;I++)f=F[I],j.push(f.advance);return j}).call(this),s=this.widths[this.widths.length-1],S=[],r=i=0;0<=l?i<l:i>l;r=0<=l?++i:--i)S.push(this.widths.push(s));return S},e.prototype.forGlyph=function(n){return n in this.metrics?this.metrics[n]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[n-this.metrics.length]}},e}(),LJ=[].slice,KEe=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return Rm(e,kp),e.prototype.tag="glyf",e.prototype.parse=function(){return this.cache={}},e.prototype.glyphFor=function(n){var r,s,l,f,i,x,S,I,R,F;return n in this.cache?this.cache[n]:(f=this.file.loca,r=this.file.contents,s=f.indexOf(n),(l=f.lengthOf(n))===0?this.cache[n]=null:(r.pos=this.offset+s,i=(x=new Iy(r.read(l))).readShort(),I=x.readShort(),F=x.readShort(),S=x.readShort(),R=x.readShort(),this.cache[n]=i===-1?new XEe(x,I,F,S,R):new YEe(x,i,I,F,S,R),this.cache[n]))},e.prototype.encode=function(n,r,s){var l,f,i,x,S;for(i=[],f=[],x=0,S=r.length;x<S;x++)l=n[r[x]],f.push(i.length),l&&(i=i.concat(l.encode(s)));return f.push(i.length),{table:i,offsets:f}},e}(),YEe=function(){function t(e,n,r,s,l,f){this.raw=e,this.numberOfContours=n,this.xMin=r,this.yMin=s,this.xMax=l,this.yMax=f,this.compound=!1}return t.prototype.encode=function(){return this.raw.data},t}(),XEe=function(){function t(e,n,r,s,l){var f,i;for(this.raw=e,this.xMin=n,this.yMin=r,this.xMax=s,this.yMax=l,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],f=this.raw;i=f.readShort(),this.glyphOffsets.push(f.pos),this.glyphIDs.push(f.readUInt16()),32&i;)f.pos+=1&i?4:2,128&i?f.pos+=8:64&i?f.pos+=4:8&i&&(f.pos+=2)}return t.prototype.encode=function(){var e,n,r;for(n=new Iy(LJ.call(this.raw.data)),e=0,r=this.glyphIDs.length;e<r;++e)n.pos=this.glyphOffsets[e];return n.data},t}(),ZEe=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return Rm(e,kp),e.prototype.tag="loca",e.prototype.parse=function(n){var r,s;return n.pos=this.offset,r=this.file.head.indexToLocFormat,this.offsets=r===0?(function(){var l,f;for(f=[],s=0,l=this.length;s<l;s+=2)f.push(2*n.readUInt16());return f}).call(this):(function(){var l,f;for(f=[],s=0,l=this.length;s<l;s+=4)f.push(n.readUInt32());return f}).call(this)},e.prototype.indexOf=function(n){return this.offsets[n]},e.prototype.lengthOf=function(n){return this.offsets[n+1]-this.offsets[n]},e.prototype.encode=function(n,r){for(var s=new Uint32Array(this.offsets.length),l=0,f=0,i=0;i<s.length;++i)if(s[i]=l,f<r.length&&r[f]==i){++f,s[i]=l;var x=this.offsets[i],S=this.offsets[i+1]-x;S>0&&(l+=S)}for(var I=new Array(4*s.length),R=0;R<s.length;++R)I[4*R+3]=255&s[R],I[4*R+2]=(65280&s[R])>>8,I[4*R+1]=(16711680&s[R])>>16,I[4*R]=(4278190080&s[R])>>24;return I},e}(),JEe=function(){function t(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return t.prototype.generateCmap=function(){var e,n,r,s,l;for(n in s=this.font.cmap.tables[0].codeMap,e={},l=this.subset)r=l[n],e[n]=s[r];return e},t.prototype.glyphsFor=function(e){var n,r,s,l,f,i,x;for(s={},f=0,i=e.length;f<i;f++)s[l=e[f]]=this.font.glyf.glyphFor(l);for(l in n=[],s)(r=s[l])!=null&&r.compound&&n.push.apply(n,r.glyphIDs);if(n.length>0)for(l in x=this.glyphsFor(n))r=x[l],s[l]=r;return s},t.prototype.encode=function(e,n){var r,s,l,f,i,x,S,I,R,F,j,H,G,W,J;for(s in r=DJ.encode(this.generateCmap(),"unicode"),f=this.glyphsFor(e),j={0:0},J=r.charMap)j[(x=J[s]).old]=x.new;for(H in F=r.maxGlyphID,f)H in j||(j[H]=F++);return I=function(ie){var he,ge;for(he in ge={},ie)ge[ie[he]]=he;return ge}(j),R=Object.keys(I).sort(function(ie,he){return ie-he}),G=function(){var ie,he,ge;for(ge=[],ie=0,he=R.length;ie<he;ie++)i=R[ie],ge.push(I[i]);return ge}(),l=this.font.glyf.encode(f,G,j),S=this.font.loca.encode(l.offsets,G),W={cmap:this.font.cmap.raw(),glyf:l.table,loca:S,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(n)},this.font.os2.exists&&(W["OS/2"]=this.font.os2.raw()),this.font.directory.encode(W)},t}();Ui.API.PDFObject=function(){var t;function e(){}return t=function(n,r){return(Array(r+1).join("0")+n).slice(-r)},e.convert=function(n){var r,s,l,f;if(Array.isArray(n))return"["+function(){var i,x,S;for(S=[],i=0,x=n.length;i<x;i++)r=n[i],S.push(e.convert(r));return S}().join(" ")+"]";if(typeof n=="string")return"/"+n;if(n!=null&&n.isString)return"("+n+")";if(n instanceof Date)return"(D:"+t(n.getUTCFullYear(),4)+t(n.getUTCMonth(),2)+t(n.getUTCDate(),2)+t(n.getUTCHours(),2)+t(n.getUTCMinutes(),2)+t(n.getUTCSeconds(),2)+"Z)";if({}.toString.call(n)==="[object Object]"){for(s in l=["<<"],n)f=n[s],l.push("/"+s+" "+e.convert(f));return l.push(">>"),l.join(`
`)}return""+n},e}();const QEe=()=>{const[t,e]=st.useState("available"),[n,r]=st.useState("bike"),[s,l]=st.useState(null),[f,i]=st.useState([]),[x,S]=st.useState(null),[I,R]=st.useState(""),[F,j]=st.useState(!1),[H,G]=st.useState(!1),[W,J]=st.useState(null),[ie,he]=st.useState(!1),[ge,fe]=st.useState(""),[ye,pe]=st.useState(""),[be,Ae]=st.useState("all"),[Oe,ue]=st.useState(1),[we]=st.useState(10);st.useEffect(()=>{ke()},[]);const ke=async()=>{const yt=(await fs(ca(Yr,"bikes"))).docs.map(_e=>({id:_e.id,..._e.data()}));i(yt)},De=mt=>{l(mt.target.files[0])},je=()=>{const mt=f.filter(Kt=>Kt.bikeCategory==="Regular Bicycle").length+1,yt=f.filter(Kt=>Kt.bikeCategory==="Electric Bicycle").length+1;return`${ye==="Regular Bicycle"?"BK":"EBK"}-${String(ye==="Regular Bicycle"?mt:yt).padStart(3,"0")}`},ze=async()=>{if(!s)return null;const mt=new FormData;mt.append("bikePhoto",s);try{return(await Go.post("http://192.168.6.200:4000/api/upload-bike-photo",mt,{headers:{"Content-Type":"multipart/form-data"}})).data.bikePhotoUrl}catch(yt){return console.error("Error uploading image:",yt),null}},Ue=async mt=>{mt.preventDefault();const yt=await ze();if(!yt){alert("Image upload failed. Try again.");return}const on={bikeId:je(),bikeName:ge,bikeCategory:ye,bikeType:n,imageUrl:yt,bikeStatus:"Available",isAvailable:!0,createdAt:new Date};try{await ak(ca(Yr,"bikes"),on),alert("Bike added successfully!"),i([...f,on]),j(!1),Be()}catch(Kt){console.error("Error adding bike:",Kt)}},Fe=async mt=>{mt.preventDefault();const yt=await ze(),_e={bikeName:ge,bikeCategory:ye,bikeType:n,bikeStatus:t,imageUrl:yt||x.imageUrl};try{await ed(ol(Yr,"bikes",x.id),_e),alert("Bike updated successfully!"),S(null),G(!1),ke(),Be()}catch(on){console.error("Error updating bike:",on)}},Qe=(mt,yt)=>{yt.stopPropagation(),S(mt),fe(mt.bikeName),pe(mt.bikeCategory),r(mt.bikeType),e(mt.bikeStatus),G(!0)},Be=()=>{fe(""),pe(""),r(""),l(null),e("Available"),S(null)},bt=async()=>{const mt=new Ui,yt=40,_e=5,on=3;let Kt=10,Pn=10;for(let Ut=0;Ut<f.length;Ut++){const cn=f[Ut];try{const At=await Q5e.toDataURL(cn.id,{type:"image/jpeg"});At?(mt.text(`Bike ID: ${cn.bikeId}`,Kt,Pn+yt+5),mt.addImage(At,"JPEG",Kt,Pn,yt,yt),Kt+=yt+_e,(Ut+1)%on===0&&(Kt=10,Pn+=yt+20),Pn+yt+20>mt.internal.pageSize.height&&(mt.addPage(),Kt=10,Pn=10)):console.error("QR code generation failed for bike:",cn.bikeId)}catch(At){console.error("Error generating QR code: ",At)}}mt.save("bike_qr_codes.pdf")},xe=mt=>{R(mt.target.value.toUpperCase()),ue(1)},Le=mt=>{Ae(mt.target.value),ue(1)},Xe=Oe*we,ct=Xe-we,vt=Math.ceil(f.length/we),Nt=()=>{const mt=f.filter(_e=>_e.bikeCategory==="Regular Bicycle").length,yt=f.filter(_e=>_e.bikeCategory==="Electric Bicycle").length;return{regularBikes:mt,electricBikes:yt}};return ne.jsxs(vv,{children:[ne.jsx(g2,{title:"Bike Management"}),ne.jsxs("div",{className:"bike-management-container",children:[ne.jsx("div",{className:"bike-management-header",children:ne.jsx("h2",{children:"Bike Management"})}),ne.jsxs("div",{className:"search-container",children:[ne.jsx("input",{type:"text",placeholder:"🔍 Search by Bike ID (e.g., BK-001)...",className:"search-box",value:I,onChange:xe}),ne.jsxs("button",{className:"add-bike-btn",onClick:()=>j(!0),children:[ne.jsx(sk,{})," Add Bike"]}),ne.jsx("button",{className:"generate-pdf-btn",onClick:bt,children:"Generate QR (PDF)"}),ne.jsxs("div",{className:"sort-container",children:[ne.jsx("label",{className:"sort-label",children:"Sort By:"}),ne.jsxs("select",{value:be,onChange:Le,className:"sort-dropdown",children:[ne.jsx("option",{value:"all",children:"All Bikes"}),ne.jsx("option",{value:"Regular Bicycle",children:"Regular Bikes"}),ne.jsx("option",{value:"Electric Bicycle",children:"Electric Bikes"}),ne.jsxs("optgroup",{label:"Status",children:[ne.jsx("option",{value:"Available",children:"Available"}),ne.jsx("option",{value:"In Use",children:"In Use"}),ne.jsx("option",{value:"To Repair",children:"To Repair"}),ne.jsx("option",{value:"To Replace",children:"To Replace"}),ne.jsx("option",{value:"Retired",children:"Retired"})]})]})]})]}),F&&ne.jsx("div",{className:"modal-overlay",children:ne.jsxs("div",{className:"modal-content",children:[ne.jsx("h2",{children:"Adding New Bike"}),ne.jsxs("form",{className:"bike-form",onSubmit:Ue,children:[ne.jsx("div",{className:"upload-box",children:ne.jsxs("label",{className:"upload-label",children:[ne.jsx(xj,{})," Upload Bike Image",ne.jsx("input",{type:"file",accept:"image/*",onChange:De,required:!0})]})}),ne.jsx("label",{children:"Bike Name:"}),ne.jsx("input",{type:"text",value:ge,onChange:mt=>fe(mt.target.value),required:!0}),ne.jsx("label",{children:"Category of Bike:"}),ne.jsxs("select",{value:ye,onChange:mt=>pe(mt.target.value),required:!0,children:[ne.jsx("option",{value:"",children:"Select Category"}),ne.jsx("option",{value:"Regular Bicycle",children:"Regular Bicycle"}),ne.jsx("option",{value:"Electric Bicycle",children:"Electric Bicycle"})]}),ne.jsx("label",{children:"Bike Type:"}),ne.jsxs("select",{value:n,onChange:mt=>r(mt.target.value),required:!0,children:[ne.jsx("option",{value:"",children:"Select Bike Type"}),ne.jsx("option",{value:"Road Bike",children:"Road Bike"}),ne.jsx("option",{value:"Mountain Bike",children:"Mountain Bike"}),ne.jsx("option",{value:"City Bike",children:"City Bike"}),ne.jsx("option",{value:"Fat Bike",children:"Fat Bike"}),ne.jsx("option",{value:"BMX",children:"BMX"}),ne.jsx("option",{value:"Electric Bike",children:"Electric Bike"})]}),ne.jsxs("div",{className:"modal-buttons",children:[ne.jsx("button",{type:"submit",className:"save-btn",children:"Save"}),ne.jsx("button",{type:"button",className:"cancel-btn",onClick:()=>j(!1),children:"Cancel"})]})]})]})}),ne.jsxs("div",{className:"bike-stats-overlay",children:[ne.jsxs("div",{className:"stat-card",children:[ne.jsx("h3",{children:"Regular Bikes"}),ne.jsx("p",{children:Nt().regularBikes})]}),ne.jsxs("div",{className:"stat-card",children:[ne.jsx("h3",{children:"Electric Bikes"}),ne.jsx("p",{children:Nt().electricBikes})]})]}),ne.jsx("div",{className:"bike-list",children:ne.jsxs("table",{children:[ne.jsx("thead",{children:ne.jsxs("tr",{children:[ne.jsx("th",{children:"Bike Name"}),ne.jsx("th",{children:"Bike ID"}),ne.jsx("th",{children:"Category"}),ne.jsx("th",{children:"Type"}),ne.jsx("th",{children:"Image"}),ne.jsx("th",{children:"Status"}),ne.jsx("th",{children:"Action"})]})}),ne.jsx("tbody",{children:f.filter(mt=>mt.bikeId.toUpperCase().includes(I)&&(be==="all"||be==="Regular Bicycle"&&mt.bikeCategory==="Regular Bicycle"||be==="Electric Bicycle"&&mt.bikeCategory==="Electric Bicycle"||mt.bikeStatus===be)).slice(ct,Xe).map(mt=>ne.jsxs("tr",{onClick:()=>{J(mt),he(!0)},className:"clickable-row",children:[ne.jsx("td",{children:mt.bikeName||"No Name"}),ne.jsx("td",{children:ne.jsx("strong",{children:mt.bikeId})}),ne.jsx("td",{children:mt.bikeCategory}),ne.jsx("td",{children:mt.bikeType}),ne.jsx("td",{children:ne.jsx("img",{src:mt.imageUrl,alt:mt.bikeName,className:"table-bike-image",onClick:yt=>{yt.stopPropagation(),J(mt),he(!0)}})}),ne.jsx("td",{children:ne.jsx("div",{className:`status-container status-${mt.bikeStatus.replace(/\s+/g,"-")}`,children:mt.bikeStatus})}),ne.jsx("td",{children:ne.jsx("button",{className:"edit-btn",onClick:yt=>Qe(mt,yt),children:ne.jsx(N0,{})})})]},mt.id))})]})}),ie&&W&&ne.jsx("div",{className:"modal-overlay",children:ne.jsxs("div",{className:"modal-content",children:[ne.jsx("h2",{children:"Bike Details"}),ne.jsx("div",{className:"bike-image-container",children:ne.jsx("img",{src:W.imageUrl,alt:"Bike",className:"bike-preview"})}),ne.jsxs("p",{children:[ne.jsx("strong",{children:"Bike Name:"})," ",W.bikeName]}),ne.jsxs("p",{children:[ne.jsx("strong",{children:"Bike ID:"})," ",W.bikeId]}),ne.jsxs("p",{children:[ne.jsx("strong",{children:"Category:"})," ",W.bikeCategory]}),ne.jsxs("p",{children:[ne.jsx("strong",{children:"Bike Type:"})," ",W.bikeType]}),ne.jsxs("p",{children:[ne.jsx("strong",{children:"Status:"})," ",W.bikeStatus]}),ne.jsx("div",{className:"modal-buttons",children:ne.jsx("button",{className:"cancel-btn",onClick:()=>he(!1),children:"Close"})})]})}),H&&x&&ne.jsx("div",{className:"modal-overlay",children:ne.jsxs("div",{className:"modal-content",children:[ne.jsx("h2",{children:"Edit Bike"}),ne.jsxs("form",{className:"bike-form",onSubmit:Fe,children:[ne.jsxs("div",{className:"upload-box",children:[ne.jsxs("label",{className:"upload-label",children:[ne.jsx(xj,{})," Upload New Image",ne.jsx("input",{type:"file",accept:"image/*",onChange:De})]}),x.imageUrl&&ne.jsx("img",{src:x.imageUrl,alt:"Current Bike",className:"bike-preview"})]}),ne.jsx("label",{children:"Bike Name:"}),ne.jsx("input",{type:"text",value:ge,onChange:mt=>fe(mt.target.value),required:!0}),ne.jsx("label",{children:"Category of Bike:"}),ne.jsxs("select",{value:ye,onChange:mt=>pe(mt.target.value),required:!0,children:[ne.jsx("option",{value:"",children:"Select Category"}),ne.jsx("option",{value:"Regular Bicycle",children:"Regular Bicycle"}),ne.jsx("option",{value:"Electric Bicycle",children:"Electric Bicycle"})]}),ne.jsx("label",{children:"Bike Type:"}),ne.jsxs("select",{value:n,onChange:mt=>r(mt.target.value),required:!0,children:[ne.jsx("option",{value:"",children:"Select Bike Type"}),ne.jsx("option",{value:"Road Bike",children:"Road Bike"}),ne.jsx("option",{value:"Mountain Bike",children:"Mountain Bike"}),ne.jsx("option",{value:"City Bike",children:"City Bike"}),ne.jsx("option",{value:"Fat Bike",children:"Fat Bike"}),ne.jsx("option",{value:"BMX",children:"BMX"}),ne.jsx("option",{value:"Electric Bike",children:"Electric Bike"})]}),ne.jsx("label",{children:"Status:"}),ne.jsxs("select",{value:t,onChange:mt=>e(mt.target.value),required:!0,children:[ne.jsx("option",{value:"Available",children:"Available"}),ne.jsx("option",{value:"To Repair",children:"To Repair"}),ne.jsx("option",{value:"To Replace",children:"To Replace"}),ne.jsx("option",{value:"Retired",children:"Retired"})]}),ne.jsxs("div",{className:"modal-buttons",children:[ne.jsx("button",{type:"submit",className:"save-btn",children:"Update"}),ne.jsx("button",{type:"button",className:"cancel-btn",onClick:()=>{G(!1),Be()},children:"Cancel"})]})]})]})})]}),ne.jsxs("div",{className:"pagination-controls",children:[ne.jsx("button",{className:"pagination-button",onClick:()=>ue(Oe-1),disabled:Oe===1,children:"Previous"}),ne.jsxs("span",{className:"pagination-info",children:["Page ",Oe," of ",vt]}),ne.jsx("button",{className:"pagination-button",onClick:()=>ue(Oe+1),disabled:Oe===vt,children:"Next"})]})]})},e3e="/ecpcaps/assets/bike_icon-CFICwI6a.png";td.accessToken="pk.eyJ1IjoiY29jb2xlbW9uMTIiLCJhIjoiY204YTBoMnZpMHplbzJzcTR3dDFmOXc4NiJ9.NqqEHSBe8cn9Gy9knbUqew";const t3e=({onEditStation:t})=>{const[e,n]=st.useState(null),[r,s]=st.useState([]),[l,f]=st.useState(null),[i,x]=st.useState(!1),[S,I]=st.useState([]),[R,F]=st.useState(!0),[j,H]=st.useState([]),[G,W]=st.useState(""),[J,ie]=st.useState("all"),[he,ge]=st.useState([]);st.useEffect(()=>{if(!e){const pe=new td.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[120.9882053036898,14.693467677226026],zoom:12});pe.on("load",()=>{n(pe)})}},[e]),st.useEffect(()=>e?(r.forEach(be=>be.remove()),(async()=>{try{const be=await fs(ca(Yr,"stations")),Ae=await fs(ca(Yr,"admins")),Oe={};Ae.docs.forEach(we=>{const ke=we.data();Oe[we.id]={name:ke.name,profilePhoto:ke.profilePhoto}});const ue=[];if(be.docs.forEach(we=>{const ke=we.data(),De=ke.tanodAssigned||[],je=Array.isArray(De)?De:[De],ze={id:we.id,...ke,tanodAssigned:je,tanodAssignedName:je.map(Ue=>{var Fe;return((Fe=Oe[Ue])==null?void 0:Fe.name)||"Unknown"}).join(", "),tanodAssignedAvatar:je.map(Ue=>{var Fe;return(Fe=Oe[Ue])==null?void 0:Fe.profilePhoto}).filter(Ue=>Ue)};if(ze.coordinates&&Array.isArray(ze.coordinates)&&ze.coordinates.length===2){const Ue=document.createElement("div");Ue.className="custom-marker";const Fe=document.createElement("div");Fe.className="station-name",Fe.textContent=ze.stationName,Ue.appendChild(Fe);const Qe=document.createElement("img");Qe.src=e3e,Qe.className="marker-icon",Ue.appendChild(Qe),Ue.addEventListener("click",()=>{f(ze),x(!0)});const Be=new td.Marker(Ue).setLngLat([ze.coordinates[1],ze.coordinates[0]]).addTo(e);ue.push(Be)}}),s(ue),ue.length>0){const we=new td.LngLatBounds;be.docs.forEach(ke=>{const De=ke.data();De.coordinates&&Array.isArray(De.coordinates)&&De.coordinates.length===2&&we.extend([De.coordinates[1],De.coordinates[0]])}),e.fitBounds(we,{padding:50})}}catch(be){console.error("Error fetching stations:",be)}})(),()=>{r.forEach(be=>be.remove())}):void 0,[e]);const fe=async()=>{try{const be=(await fs(ca(Yr,"admins"))).docs.map(Ae=>({id:Ae.id,...Ae.data()}));ge(be)}catch(pe){console.error("Error fetching admins:",pe)}};st.useEffect(()=>{fe()},[]);const ye=({station:pe,onClose:be})=>{const[Ae,Oe]=st.useState(!1),[ue,we]=st.useState(!1),[ke,De]=st.useState(!1),[je,ze]=st.useState([]),[Ue,Fe]=st.useState([]),[Qe,Be]=st.useState([]),[bt,xe]=st.useState([]),[Le,Xe]=st.useState(0),[ct,vt]=st.useState(!1),[Nt,mt]=st.useState(!1),[yt,_e]=st.useState(!1),[on,Kt]=st.useState(null),[Pn,Ut]=st.useState(!1),[cn,At]=st.useState([]),[xr,Rn]=st.useState(!1),[Dn,ar]=st.useState(!1),[hr,ur]=st.useState(null),[Ir,Un]=st.useState([]);st.useEffect(()=>{Vr(),pi(),Li()},[pe.id]);const Vr=async()=>{try{const er=(await fs(ca(Yr,"bikes"))).docs.map(yr=>({id:yr.id,...yr.data()})).filter(yr=>yr.stationAssigned===pe.id);Be(er)}catch(hn){console.error("Error fetching station bikes:",hn)}},pi=async()=>{try{const er=(await fs(ca(Yr,"bikes"))).docs.map(yr=>({id:yr.id,...yr.data()})).filter(yr=>!yr.stationAssigned);xe(er)}catch(hn){console.error("Error fetching unassigned bikes:",hn)}},Li=async()=>{try{const er=(await fs(ca(Yr,"admins"))).docs.map(yr=>({id:yr.id,...yr.data()})).filter(yr=>{var Vi;return!((Vi=pe.tanodAssigned)!=null&&Vi.includes(yr.id))&&!yr.stationAssignedTo});At(er)}catch(hn){console.error("Error fetching unassigned admins:",hn)}},wi=async()=>{try{Oe(!0);const hn=je.map(er=>ed(ol(Yr,"bikes",er),{stationAssigned:null}));await Promise.all(hn),we(!1),ze([]),Vr()}catch(hn){console.error("Error removing bikes:",hn),alert("Failed to remove bikes")}finally{Oe(!1)}},xn=async()=>{try{Oe(!0);const hn=Ue.map(er=>ed(ol(Yr,"bikes",er),{stationAssigned:pe.id}));await Promise.all(hn),De(!1),Fe([]),Vr()}catch(hn){console.error("Error adding bikes:",hn),alert("Failed to add bikes")}finally{Oe(!1)}},Xn=async hn=>{try{Oe(!0);const er=pe.tanodAssigned||[];await ed(ol(Yr,"stations",pe.id),{tanodAssigned:[...er,...hn]});const yr=hn.map(Vi=>ed(ol(Yr,"admins",Vi),{stationAssignedTo:pe.id}));await Promise.all(yr),Ut(!1),window.location.reload()}catch(er){console.error("Error assigning admins:",er),alert("Failed to assign admins")}finally{Oe(!1)}};return ne.jsx("div",{className:"map-modal-overlay",children:ne.jsxs("div",{className:"map-modal-content large",children:[ne.jsxs("div",{className:"modal-header",children:[ne.jsxs("div",{className:"station-header",children:[ne.jsx("h2",{children:pe.stationName}),ne.jsx("p",{className:"station-address",children:pe.stationAddress})]}),ne.jsx("button",{className:"close-button",onClick:be,children:"×"})]}),ne.jsxs("div",{className:"modal-body",children:[ne.jsxs("div",{className:"admin-section",children:[ne.jsxs("div",{className:"count-card",children:[ne.jsxs("div",{className:"count-header",children:[ne.jsx("h3",{children:"Station Admin"}),ne.jsx("button",{className:"edit-btn",onClick:()=>Ut(!Pn),children:ne.jsx(N0,{})})]}),Pn&&ne.jsx("div",{className:"action-dropdown",children:ne.jsx("button",{onClick:()=>{Rn(!0),ar(!1),Ut(!1),Li()},children:"Add Admin"})})]}),ne.jsx("div",{className:"admin-content",children:xr?ne.jsxs("div",{className:"admin-list",children:[ne.jsx("h4",{children:"Select Admin to Assign"}),ne.jsx("div",{className:"admin-grid",children:cn.map(hn=>ne.jsxs("div",{className:"admin-card",children:[ne.jsx("input",{type:"checkbox",className:"admin-checkbox",checked:Ir.includes(hn.id),onChange:er=>{er.target.checked?Un([...Ir,hn.id]):Un(Ir.filter(yr=>yr!==hn.id))}}),ne.jsx("img",{src:hn.profilePhoto||"/default-avatar.png",alt:hn.name,className:"admin-photo"}),ne.jsx("span",{className:"admin-name",children:hn.name})]},hn.id))}),ne.jsxs("div",{className:"action-buttons",children:[ne.jsx("button",{className:"save-btn",onClick:()=>{Ir.length>0&&Xn(Ir)},disabled:Ir.length===0||Ae,children:Ae?"Saving...":"Save Changes"}),ne.jsx("button",{className:"discard-btn",onClick:()=>{Rn(!1),Un([])},children:"Discard Changes"})]})]}):ne.jsx("div",{className:"admin-profile",children:Array.isArray(pe.tanodAssigned)&&pe.tanodAssigned.length>0?pe.tanodAssigned.map(hn=>{const er=he.find(yr=>yr.id===hn);return ne.jsxs("div",{className:"admin-avatar",children:[ne.jsx("img",{src:(er==null?void 0:er.profilePhoto)||"/default-avatar.png",alt:er==null?void 0:er.name}),ne.jsx("span",{children:(er==null?void 0:er.name)||"Unknown Admin"})]},hn)}):ne.jsx("div",{className:"no-admin",children:ne.jsx("span",{children:"No Admin Assigned"})})})})]}),ne.jsxs("div",{className:"bikes-section",children:[ne.jsxs("div",{className:"bikes-header-section",children:[ne.jsx("h3",{children:"Station Bikes"}),ne.jsx("div",{className:"counts-section",children:ne.jsxs("div",{className:"count-cards",children:[ne.jsxs("div",{className:"count-card",children:[ne.jsxs("div",{className:"count-header",children:[ne.jsxs("span",{children:["Regular Bikes:"," ",Qe.filter(hn=>hn.bikeCategory==="Regular Bicycle").length]}),ne.jsx("button",{className:"edit-btn",onClick:()=>mt(!Nt),children:ne.jsx(N0,{})})]}),Nt&&ne.jsxs("div",{className:"action-dropdown",children:[ne.jsx("button",{onClick:()=>{De(!0),we(!1),Kt("Regular"),mt(!1)},children:"Add Bikes"}),ne.jsx("button",{onClick:()=>{we(!0),De(!1),Kt("Regular"),mt(!1)},children:"Remove Bikes"})]})]}),ne.jsxs("div",{className:"count-card",children:[ne.jsxs("div",{className:"count-header",children:[ne.jsxs("span",{children:["E-Bikes:"," ",Qe.filter(hn=>hn.bikeCategory==="Electric Bicycle").length]}),ne.jsx("button",{className:"edit-btn",onClick:()=>_e(!yt),children:ne.jsx(N0,{})})]}),yt&&ne.jsxs("div",{className:"action-dropdown",children:[ne.jsx("button",{onClick:()=>{De(!0),we(!1),Kt("Electric"),_e(!1)},children:"Add E-Bikes"}),ne.jsx("button",{onClick:()=>{we(!0),De(!1),Kt("Electric"),_e(!1)},children:"Remove E-Bikes"})]})]})]})})]}),ne.jsx("div",{className:"bikes-content",children:ne.jsx("div",{className:"bikes-grid",children:(ue||ke?ue?Qe.filter(hn=>on==="Regular"?hn.bikeCategory==="Regular Bicycle":hn.bikeCategory==="Electric Bicycle"):bt.filter(hn=>on==="Regular"?hn.bikeCategory==="Regular Bicycle":hn.bikeCategory==="Electric Bicycle"):Qe).slice(Le*6,(Le+1)*6).map(hn=>ne.jsxs("div",{className:"bike-card",children:[(ue||ke)&&ne.jsx("input",{type:"checkbox",className:"bike-checkbox",checked:ue?je.includes(hn.id):Ue.includes(hn.id),onChange:er=>{const yr=ue?ze:Fe,Vi=ue?je:Ue;er.target.checked?yr([...Vi,hn.id]):yr(Vi.filter(ki=>ki!==hn.id))}}),ne.jsx("img",{src:hn.imageUrl||"/default-bike.png",alt:hn.bikeName}),ne.jsxs("div",{className:"bike-info",children:[ne.jsx("span",{className:"bike-id",children:hn.bikeId}),ne.jsx("span",{className:"bike-name",children:hn.bikeName})]})]},hn.id))})}),ne.jsxs("div",{className:"bikes-footer",children:[ne.jsxs("div",{className:"pagination",children:[ne.jsx("button",{onClick:()=>Xe(hn=>hn-1),disabled:Le===0,className:"page-btn",children:ne.jsx($ce,{})}),ne.jsxs("span",{children:["Page ",Le+1]}),ne.jsx("button",{onClick:()=>Xe(hn=>hn+1),disabled:(Le+1)*6>=(ue?Qe.length:ke?bt.length:Qe.length),className:"page-btn",children:ne.jsx(Hce,{})})]}),(ue||ke)&&ne.jsxs("div",{className:"action-buttons",children:[ne.jsx("button",{className:"save-btn",onClick:ue?wi:xn,disabled:Ae||(ue?je.length===0:Ue.length===0),children:Ae?"Saving...":"Save Changes"}),ne.jsx("button",{className:"discard-btn",onClick:()=>{we(!1),De(!1),ze([]),Fe([]),Kt(null)},children:"Discard Changes"})]})]})]})]})]})})};return ne.jsxs("div",{className:"map-container",children:[ne.jsx("div",{id:"map",className:"map-element"}),i&&ne.jsx(ye,{station:l,onClose:()=>x(!1)})]})};td.accessToken="pk.eyJ1IjoiY29jb2xlbW9uMTIiLCJhIjoiY204YTBoMnZpMHplbzJzcTR3dDFmOXc4NiJ9.NqqEHSBe8cn9Gy9knbUqew";const n3e=({onSelectLocation:t,isSelectingLocation:e})=>{const n=st.useRef(null),r=st.useRef(null),s=st.useRef(null);return st.useEffect(()=>{if(!r.current)return r.current=new td.Map({container:n.current,style:"mapbox://styles/mapbox/streets-v11",center:[120.9882053036898,14.693467677226026],zoom:12}),()=>{r.current&&(r.current.remove(),r.current=null)}},[]),st.useEffect(()=>{if(!r.current)return;const l=f=>{e&&(s.current&&s.current.remove(),s.current=new td.Marker({draggable:!0,color:"#FF0000",scale:.8}).setLngLat([f.lngLat.lng,f.lngLat.lat]).addTo(r.current),s.current.on("dragend",()=>{const i=s.current.getLngLat();t([i.lat,i.lng])}),t([f.lngLat.lat,f.lngLat.lng]))};return e?(r.current.getCanvas().style.cursor="crosshair",r.current.on("click",l)):(r.current.getCanvas().style.cursor="",r.current.off("click",l)),()=>{r.current&&(r.current.off("click",l),r.current.getCanvas().style.cursor=""),s.current&&(s.current.remove(),s.current=null)}},[e,t]),ne.jsx("div",{ref:n,className:"add-station-map"})},r3e=()=>{const[t,e]=st.useState([]),[n,r]=st.useState([]),[s,l]=st.useState(!1),[f,i]=st.useState(!1),[x,S]=st.useState(null),[I,R]=st.useState(!1),[F,j]=st.useState(null),[H,G]=st.useState(""),[W,J]=st.useState(""),[ie,he]=st.useState(""),[ge,fe]=st.useState(""),[ye,pe]=st.useState([]),[be,Ae]=st.useState([]),[Oe,ue]=st.useState([]),[we,ke]=st.useState([]),[De,je]=st.useState(!1),[ze,Ue]=st.useState(!1),[Fe,Qe]=st.useState(!1),[Be,bt]=st.useState(!1),[xe,Le]=st.useState([]),[Xe,ct]=st.useState([]),[vt,Nt]=st.useState(!1),[mt,yt]=st.useState(!1),[_e,on]=st.useState("");st.useEffect(()=>{Kt(),Pn(),Ut(),cn()},[]);const Kt=async()=>{try{const Xn=(await fs(ca(Yr,"admins"))).docs.map(hn=>({id:hn.id,...hn.data()}));ct(Xn)}catch(xn){console.error("Error fetching all admins:",xn)}},Pn=async()=>{try{const hn=(await fs(ca(Yr,"admins"))).docs.map(er=>({id:er.id,...er.data()})).filter(er=>!er.stationAssignedTo);Le(hn)}catch(xn){console.error("Error fetching unassigned admins:",xn)}},Ut=async()=>{try{const xn=await fs(ca(Yr,"admins")),Xn={};xn.docs.forEach(mi=>{const ti=mi.data();Xn[mi.id]=ti.name});const er=(await fs(ca(Yr,"stations"))).docs.map(mi=>{const ti=mi.data(),Pr=ti.tanodAssigned||[],ys=Array.isArray(Pr)?Pr:[Pr];return{id:mi.id,...ti,tanodAssignedID:ys,tanodAssignedName:ys.map(Fa=>Xn[Fa]||"Unknown").join(", ")||"Not Assigned"}}),Vi=(await fs(ca(Yr,"bikes"))).docs.map(mi=>({id:mi.id,...mi.data()})),ki=er.map(mi=>{const ti=Vi.filter(ys=>ys.stationAssigned===mi.id&&ys.bikeCategory==="Regular Bicycle"&&ys.bikeStatus==="Available"&&ys.isAvailable===!0).length,Pr=Vi.filter(ys=>ys.stationAssigned===mi.id&&ys.bikeCategory==="Electric Bicycle"&&ys.bikeStatus==="Available"&&ys.isAvailable===!0).length;return{...mi,totalRegularBikes:ti,totalElectricBikes:Pr}});e(ki)}catch(xn){console.error("Error fetching stations:",xn)}},cn=async()=>{const Xn=(await fs(ca(Yr,"bikes"))).docs.map(er=>({id:er.id,...er.data()})),hn=Xn.filter(er=>!er.stationAssigned&&er.bikeStatus==="Available"&&er.isAvailable===!0);r(Xn),ue(hn.filter(er=>er.bikeCategory==="Regular Bicycle")),ke(hn.filter(er=>er.bikeCategory==="Electric Bicycle"))},At=async xn=>{if(window.confirm("Are you sure you want to delete this station?"))try{const Xn=ol(Yr,"stations",xn),er=(await w0(Xn)).data(),yr=(er==null?void 0:er.tanodAssigned)||[],ki=(Array.isArray(yr)?yr:[yr]).map(mi=>ed(ol(Yr,"admins",mi),{stationAssignedTo:null}));await Promise.all(ki),await oK(Xn)}catch(Xn){console.error("Error deleting station:",Xn)}},xr=async xn=>{S(xn),G(xn.stationName||""),J(xn.stationAddress||""),fe(xn.coordinates||""),he(xn.tanodAssignedID||""),i(!0);const hn=(await fs(ca(Yr,"bikes"))).docs.map(er=>({id:er.id,...er.data()}));pe(hn.filter(er=>er.bikeCategory==="Regular Bicycle"&&er.stationAssigned===xn.id).map(er=>er.id)),Ae(hn.filter(er=>er.bikeCategory==="Electric Bicycle"&&er.stationAssigned===xn.id).map(er=>er.id)),cn()},Rn=()=>{S(null),G(""),J(""),fe(""),he(""),pe([]),Ae([]),Nt(!1),l(!0)},Dn=async(xn,Xn)=>{try{const hn=await Go.get(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${xn}&lon=${Xn}`);J(hn.data.display_name||"Unknown Address")}catch(hn){console.error("Error fetching address:",hn)}},ar=xn=>{const Xn=xn.target.value;fe(Xn);const[hn,er]=Xn.split(",");hn&&er&&Dn(hn.trim(),er.trim())},hr=xn=>{fe(xn.join(",")),Dn(xn[0],xn[1])},ur=async xn=>{if(xn.preventDefault(),!ie){alert("Please select an admin (or allow none).");return}try{const Xn=typeof ge=="string"?ge.split(",").map(yr=>parseFloat(yr.trim())):[],hn=Array.isArray(ie)?ie:[ie];let er;if(x)er=ol(Yr,"stations",x.id),await ed(er,{stationName:H,stationAddress:W,coordinates:Xn,tanodAssigned:hn}),on("Station updated successfully!"),i(!1);else{const yr={stationName:H,stationAddress:W,coordinates:Xn,tanodAssigned:hn};er=await ak(ca(Yr,"stations"),yr),on("Station added successfully!"),l(!1)}if(er&&er.id){const yr=hn.map(Vi=>ed(ol(Yr,"admins",Vi),{stationAssignedTo:er.id}));await Promise.all(yr),await Ir(er.id),Pn(),Ut(),yt(!0),setTimeout(()=>{yt(!1)},2e3)}}catch(Xn){console.error("Error saving station:",Xn)}},Ir=async xn=>{try{for(const Xn of ye){const hn=ol(Yr,"bikes",Xn);await ed(hn,{stationAssigned:xn})}for(const Xn of be){const hn=ol(Yr,"bikes",Xn);await ed(hn,{stationAssigned:xn})}console.log("Bikes assigned successfully:",xn)}catch(Xn){console.error("Error assigning bikes:",Xn)}},Un=xn=>{xn==="Regular Bicycle"?Ue(!0):je(!0)},Vr=xn=>{xn==="Regular Bicycle"?(Qe(!0),bt(!1)):(bt(!0),Qe(!1))},pi=async(xn,Xn)=>{try{const hn=ol(Yr,"bikes",xn);await ed(hn,{stationAssigned:null}),Xn==="Regular Bicycle"?pe(er=>er.filter(yr=>yr!==xn)):Ae(er=>er.filter(yr=>yr!==xn)),cn(),console.log(`Bike ${xn} unassigned successfully.`)}catch(hn){console.error("Error unassigning bike:",hn)}},Li=({station:xn,onClose:Xn})=>ne.jsx("div",{className:"modal-overlay",onClick:Xn,children:ne.jsxs("div",{className:"modal-content",onClick:hn=>hn.stopPropagation(),children:[ne.jsx("h2",{children:xn.stationName}),ne.jsxs("p",{children:[ne.jsx("strong",{children:"Address:"})," ",xn.stationAddress]}),ne.jsxs("p",{children:[ne.jsx("strong",{children:"Coordinates:"})," ",xn.coordinates]}),ne.jsxs("p",{children:[ne.jsx("strong",{children:"Tanod Assigned:"})," ",xn.tanodAssignedName||"Not Assigned"]}),ne.jsxs("p",{children:[ne.jsx("strong",{children:"Total Bikes:"})," ",xn.totalRegularBikes||0," ","(Regular), ",xn.totalElectricBikes||0," (Electric)"]}),ne.jsx("button",{className:"cancel-btn",onClick:Xn,children:"Close"})]})}),wi=({message:xn})=>ne.jsx("div",{className:"success-overlay",children:ne.jsxs("div",{className:"success-content",children:[ne.jsx("div",{className:"success-icon",children:"✓"}),ne.jsx("p",{children:xn})]})});return ne.jsxs(vv,{children:[ne.jsx(g2,{title:"Station Management"}),ne.jsxs("div",{className:"station-management-container",children:[ne.jsxs("div",{className:"station-management-header",children:[ne.jsx("h2",{children:"Station Overview"}),ne.jsxs("button",{className:"add-station-btn",onClick:Rn,children:[ne.jsx(sk,{})," Add New Station"]})]}),ne.jsxs("div",{className:"station-map-section",children:[ne.jsx("h2",{children:"Station Locations"}),ne.jsx("div",{className:"map-container",children:ne.jsx(t3e,{onEditStation:xn=>{xr(xn)}})})]}),ne.jsx("div",{className:"station-list",children:ne.jsxs("table",{children:[ne.jsx("thead",{children:ne.jsxs("tr",{children:[ne.jsx("th",{children:"Station Name"}),ne.jsx("th",{children:"Station Address"}),ne.jsx("th",{children:"Total Bikes"}),ne.jsx("th",{children:"Total E-Bikes"}),ne.jsx("th",{children:"Tanod Assigned"}),ne.jsx("th",{children:"Action"})]})}),ne.jsx("tbody",{children:t.length>0?t.map(xn=>ne.jsxs("tr",{children:[ne.jsx("td",{children:ne.jsx("strong",{children:xn.stationName})}),ne.jsx("td",{children:ne.jsx("span",{onClick:()=>{j(xn),R(!0)},style:{cursor:"pointer",color:"#00796b"},children:xn.stationAddress})}),ne.jsx("td",{children:xn.totalRegularBikes||0}),ne.jsx("td",{children:xn.totalElectricBikes||0}),ne.jsx("td",{children:ne.jsx("strong",{children:xn.tanodAssignedName||"Not Assigned"})}),ne.jsx("td",{children:ne.jsx("button",{className:"delete-btn",onClick:()=>At(xn.id),children:ne.jsx(fK,{})})})]},xn.id)):ne.jsx("tr",{children:ne.jsx("td",{colSpan:"6",style:{textAlign:"center",padding:"10px"},children:"No stations available"})})})]})}),I&&F&&ne.jsx(Li,{station:F,onClose:()=>R(!1)}),s&&ne.jsx("div",{className:"modal-overlay",children:ne.jsxs("div",{className:"modal-content large",children:[ne.jsxs("div",{className:"modal-header",children:[ne.jsx("h2",{children:"Add Station"}),ne.jsx("button",{className:"close-modal-btn",onClick:()=>{Nt(!1),l(!1)},children:ne.jsx(Wce,{})})]}),ne.jsxs("form",{onSubmit:ur,children:[ne.jsx("label",{children:"Station Name:"}),ne.jsx("input",{type:"text",value:H,onChange:xn=>G(xn.target.value),required:!0}),ne.jsx("label",{children:"Location:"}),ne.jsxs("div",{className:"location-selection",children:[ne.jsxs("div",{className:"coordinates-input",children:[ne.jsx("input",{type:"text",value:ge,onChange:ar,placeholder:"Click on map or enter lat,long",readOnly:!0}),ne.jsx("button",{type:"button",className:`select-location-btn ${vt?"active":""}`,onClick:()=>Nt(!vt),children:vt?"Done Selecting":"Select on Map"})]}),ne.jsx("div",{className:"map-container",children:ne.jsx(n3e,{onSelectLocation:hr,isSelectingLocation:vt})})]}),ne.jsx("label",{children:"Address:"}),ne.jsx("textarea",{value:W,readOnly:!0}),ne.jsx("label",{children:"Tanod Assigned:"}),ne.jsxs("select",{value:ie,onChange:xn=>he(xn.target.value),required:!0,children:[ne.jsx("option",{value:"",children:"Select Tanod"}),xe.map(xn=>ne.jsxs("option",{value:xn.id,children:[xn.name," (",xn.email,")"]},xn.id))]}),ne.jsx("label",{children:"Add Bikes:"}),ne.jsxs("div",{className:"bike-selection",children:[ne.jsx("button",{type:"button",onClick:()=>Un("Regular Bicycle"),children:"➕"}),ne.jsx("input",{type:"text",value:`${ye.length} Selected`,readOnly:!0})]}),ne.jsx("label",{children:"Add E-Bikes:"}),ne.jsxs("div",{className:"bike-selection",children:[ne.jsx("button",{type:"button",onClick:()=>Un("Electric Bicycle"),children:"➕"}),ne.jsx("input",{type:"text",value:`${be.length} Selected`,readOnly:!0})]}),ne.jsxs("div",{className:"modal-buttons",children:[ne.jsx("button",{type:"submit",className:"save-btn",children:"Save"}),ne.jsx("button",{type:"button",className:"cancel-btn",onClick:()=>l(!1),children:"Cancel"})]})]})]})}),ze&&ne.jsx("div",{className:"add-bike-modal-overlay",children:ne.jsxs("div",{className:"add-bike-modal",children:[ne.jsx("h2",{children:"Select Regular Bikes"}),ne.jsx("div",{className:"bike-list-container",children:Oe.length>0?Oe.map(xn=>ne.jsxs("div",{className:"bike-item",children:[ne.jsxs("label",{children:[xn.bikeName," (",xn.bikeId,")"]}),ne.jsx("input",{type:"checkbox",checked:ye.includes(xn.id),onChange:()=>{pe(Xn=>Xn.includes(xn.id)?Xn.filter(hn=>hn!==xn.id):[...Xn,xn.id])}})]},xn.id)):ne.jsx("p",{children:"No unassigned bikes available"})}),ne.jsx("button",{className:"save-btn",onClick:()=>Ue(!1),children:"Done"})]})}),De&&ne.jsx("div",{className:"add-bike-modal-overlay",children:ne.jsxs("div",{className:"add-bike-modal",children:[ne.jsx("h2",{children:"Select Electric Bikes"}),ne.jsx("div",{className:"bike-list-container",children:we.length>0?we.map(xn=>ne.jsxs("div",{className:"bike-item",children:[ne.jsxs("label",{children:[xn.bikeName," (",xn.bikeId,")"]}),ne.jsx("input",{type:"checkbox",checked:be.includes(xn.id),onChange:()=>{Ae(Xn=>Xn.includes(xn.id)?Xn.filter(hn=>hn!==xn.id):[...Xn,xn.id])}})]},xn.id)):ne.jsx("p",{children:"No unassigned e-bikes available"})}),ne.jsx("button",{className:"save-btn",onClick:()=>je(!1),children:"Done"})]})}),Fe&&ne.jsx("div",{className:"assigned-bike-overlay",children:ne.jsxs("div",{className:"assigned-bike-modal",children:[ne.jsx("h2",{children:"Remove Assigned Regular Bikes"}),ne.jsx("div",{className:"bike-list-container",children:ye.length>0?ye.map(xn=>{const Xn=n.find(hn=>hn.id===xn);return ne.jsxs("div",{className:"bike-item",children:[ne.jsxs("label",{children:[Xn==null?void 0:Xn.bikeName," (",Xn==null?void 0:Xn.bikeId,")"]}),ne.jsx("button",{className:"remove-btn",onClick:()=>pi(xn,"Regular Bicycle"),children:"❌ Remove"})]},xn)}):ne.jsx("p",{children:"No assigned bikes."})}),ne.jsx("button",{className:"save-btn",onClick:()=>Qe(!1),children:"Done"})]})}),Be&&ne.jsx("div",{className:"assigned-bike-overlay",children:ne.jsxs("div",{className:"assigned-bike-modal",children:[ne.jsx("h2",{children:"Remove Assigned Electric Bikes"}),ne.jsx("div",{className:"bike-list-container",children:be.length>0?be.map(xn=>{const Xn=n.find(hn=>hn.id===xn);return ne.jsxs("div",{className:"bike-item",children:[ne.jsxs("label",{children:[Xn==null?void 0:Xn.bikeName," (",Xn==null?void 0:Xn.bikeId,")"]}),ne.jsx("button",{className:"remove-btn",onClick:()=>pi(xn,"Electric Bicycle"),children:"❌ Remove"})]},xn)}):ne.jsx("p",{children:"No assigned e-bikes."})}),ne.jsx("button",{className:"save-btn",onClick:()=>bt(!1),children:"Done"})]})}),f&&x&&ne.jsx("div",{className:"modal-overlay",children:ne.jsxs("div",{className:"modal-content",children:[ne.jsx("h2",{children:"Edit Station"}),ne.jsxs("form",{onSubmit:ur,children:[ne.jsx("label",{children:"Station Name:"}),ne.jsx("input",{type:"text",value:H,onChange:xn=>G(xn.target.value),required:!0}),ne.jsx("label",{children:"Coordinates:"}),ne.jsx("input",{type:"text",value:ge,onChange:ar,placeholder:"Enter lat,long"}),ne.jsx("label",{children:"Address:"}),ne.jsx("textarea",{value:W,readOnly:!0}),ne.jsx("label",{children:"Tanod Assigned:"}),(()=>{const xn=x.tanodAssignedID,Xn=Xe.find(er=>er.id===xn);let hn=[...xe];return Xn&&!hn.some(er=>er.id===Xn.id)&&hn.unshift(Xn),ne.jsxs("select",{value:ie,onChange:er=>he(er.target.value),required:!0,children:[ne.jsx("option",{value:"",children:"Select Tanod"}),hn.map(er=>ne.jsxs("option",{value:er.id,children:[er.name," (",er.email,")"]},er.id))]})})(),ne.jsx("label",{children:"Assigned Bikes:"}),ne.jsxs("div",{className:"bike-selection",children:[ne.jsx("button",{type:"button",onClick:()=>Vr("Regular Bicycle"),children:"➖"}),ne.jsx("input",{type:"text",value:`${ye.length} Assigned`,readOnly:!0}),ne.jsx("button",{type:"button",onClick:()=>Un("Regular Bicycle"),children:"➕"})]}),ne.jsx("label",{children:"Assigned E-Bikes:"}),ne.jsxs("div",{className:"bike-selection",children:[ne.jsx("button",{type:"button",onClick:()=>Vr("Electric Bicycle"),children:"➖"}),ne.jsx("input",{type:"text",value:`${be.length} Assigned`,readOnly:!0}),ne.jsx("button",{type:"button",onClick:()=>Un("Electric Bicycle"),children:"➕"})]}),ne.jsxs("div",{className:"modal-buttons",children:[ne.jsx("button",{type:"submit",className:"save-btn",children:"Save"}),ne.jsx("button",{type:"button",className:"cancel-btn",onClick:()=>i(!1),children:"Cancel"})]})]})]})}),mt&&ne.jsx(wi,{message:_e})]})]})},i3e=()=>{const[t,e]=st.useState([]),[n,r]=st.useState(""),[s,l]=st.useState(""),[f,i]=st.useState(""),[x,S]=st.useState(null),[I,R]=st.useState(""),[F,j]=st.useState(!1),[H,G]=st.useState("station_manager"),[W,J]=st.useState(!1),[ie,he]=st.useState(null),[ge,fe]=st.useState(null),[ye,pe]=st.useState({adminId:null,role:""}),[be,Ae]=st.useState([]);st.useEffect(()=>{Oe()},[]);const Oe=async()=>{try{const Ue=await fs(ca(Yr,"stations")),Fe={};Ue.docs.forEach(bt=>{Fe[bt.id]={stationName:bt.data().stationName,stationAddress:bt.data().stationAddress}}),Ae(Fe);const Be=(await fs(ca(Yr,"admins"))).docs.map(bt=>({id:bt.id,...bt.data(),stationDetails:bt.data().stationAssignedTo?Fe[bt.data().stationAssignedTo]:null}));e(Be)}catch(Ue){console.error("Error fetching admins:",Ue)}},ue=async Ue=>{const Fe=new FormData;Fe.append("profilePhoto",Ue);try{return(await Go.post("http://192.168.6.200:4000/api/upload-profile-photo",Fe,{headers:{"Content-Type":"multipart/form-data"}})).data.profilePhotoUrl}catch(Qe){return console.error("Error uploading to AWS:",Qe),null}},we=async Ue=>{if(Ue.preventDefault(),!n||!s||!f){alert("Please fill in all fields.");return}let Fe="";if(x&&(Fe=await ue(x),!Fe)){alert("Failed to upload profile image.");return}try{const Qe=await Go.post("http://localhost:4001/api/create-admin",{name:n,email:s,password:f,roles:[],profilePhoto:Fe||"",status:"Active",stationAssignedTo:null});Qe.data.success?(alert("Admin added successfully!"),r(""),l(""),i(""),S(null),R(""),j(!1)):alert("Error: "+Qe.data.message)}catch(Qe){console.error("Error creating admin:",Qe),alert("There was an error creating the admin. Please try again.")}},ke=async Ue=>{if(window.confirm("Are you sure you want to delete this admin?"))try{await oK(ol(Yr,"admins",Ue))}catch(Fe){console.error("Error deleting admin:",Fe)}},De=Ue=>{he(Ue),J(!0),fe(null),G(Ue.roles[0])},je=async Ue=>{if(Ue.preventDefault(),!ge){alert("Please select a new profile image.");return}const Fe=await ue(ge);if(!Fe){alert("Failed to upload new profile image.");return}try{const Qe=ol(Yr,"admins",ie.id);await ed(Qe,{profilePhoto:Fe}),alert("Profile photo updated successfully!"),J(!1),he(null),fe(null)}catch(Qe){console.error("Error updating admin profile photo:",Qe),alert("Failed to update admin profile photo. Please try again.")}},ze=()=>{J(!1),he(null),fe(null)};return ne.jsxs(vv,{children:[ne.jsx(g2,{title:"Admin Management"}),ne.jsxs("div",{className:"admin-management-container",children:[ne.jsxs("div",{className:"admin-management-header",children:[ne.jsx("h2",{children:"Admin Creation"}),ne.jsxs("button",{className:"btn-create-admin",onClick:()=>j(!0),children:[ne.jsx(sk,{})," Create New Admin Account"]})]}),ne.jsx("div",{className:"admin-gallery",children:t.length>0?t.map(Ue=>{var Fe,Qe;return ne.jsxs("div",{className:"admin-card",children:[ne.jsxs("div",{className:"admin-photo",children:[ne.jsxs("div",{className:"status-dot-container",children:[ne.jsx("span",{className:`status-dot ${Ue.status==="Active"?"active":"inactive"}`}),ne.jsxs("div",{className:"status-tooltip",children:["Status: ",Ue.status]})]}),Ue.profilePhoto?ne.jsx("img",{src:Ue.profilePhoto,alt:"Admin"}):ne.jsx("div",{className:"placeholder",children:"No Image"})]}),ne.jsxs("div",{className:"admin-info",children:[ne.jsx("h4",{children:Ue.name}),ne.jsx("p",{children:Ue.email}),ne.jsxs("p",{className:"role-text",children:["Role: ",((Fe=Ue.roles)==null?void 0:Fe[0])||"Unassigned"]}),ne.jsx("p",{className:"station-text",children:Ue.stationAssignedTo?ne.jsxs("span",{className:"station-assigned",children:["Station:",((Qe=Ue.stationDetails)==null?void 0:Qe.stationName)||"Loading..."]}):ne.jsx("span",{className:"station-unassigned",children:"📍 No Station Assigned"})})]}),ne.jsxs("div",{className:"admin-actions",children:[ne.jsx("button",{className:"edit-btn",onClick:()=>De(Ue),children:ne.jsx(N0,{})}),ne.jsx("button",{className:"delete-btn",onClick:()=>ke(Ue.id),children:ne.jsx(fK,{})})]})]},Ue.id)}):ne.jsx("p",{children:"No admins found"})}),F&&ne.jsx("div",{className:"modal-overlay",children:ne.jsxs("div",{className:"modal-content",children:[ne.jsx("h3",{children:"Create Admin Account"}),ne.jsxs("form",{onSubmit:we,children:[ne.jsxs("div",{className:"form-group",children:[ne.jsx("label",{children:"Name:"}),ne.jsx("input",{type:"text",value:n,onChange:Ue=>r(Ue.target.value),required:!0})]}),ne.jsxs("div",{className:"form-group",children:[ne.jsx("label",{children:"Role:"}),ne.jsxs("select",{value:H,onChange:Ue=>G(Ue.target.value),children:[ne.jsx("option",{value:"Station Manager",children:"Station Manager"}),ne.jsx("option",{value:"User Support",children:"User Support"})]})]}),ne.jsxs("div",{className:"form-group",children:[ne.jsx("label",{children:"Email:"}),ne.jsx("input",{type:"email",value:s,onChange:Ue=>l(Ue.target.value),required:!0})]}),ne.jsxs("div",{className:"form-group",children:[ne.jsx("label",{children:"Password:"}),ne.jsx("input",{type:"password",value:f,onChange:Ue=>i(Ue.target.value),required:!0})]}),ne.jsxs("div",{className:"form-group",children:[ne.jsx("label",{children:"Profile Picture:"}),ne.jsx("input",{type:"file",accept:"image/*",onChange:Ue=>S(Ue.target.files[0])})]}),x&&ne.jsx("div",{className:"preview-image",children:ne.jsx("img",{src:URL.createObjectURL(x),alt:"Preview"})}),ne.jsx("button",{type:"submit",className:"btn-create",children:"Create"}),ne.jsx("button",{type:"button",className:"btn-cancel",onClick:()=>j(!1),children:"Cancel"})]})]})}),W&&ie&&ne.jsx("div",{className:"modal-overlay",children:ne.jsxs("div",{className:"modal-content",children:[ne.jsxs("h3",{children:["Edit Profile Photo for ",ie.name]}),ne.jsxs("form",{onSubmit:je,children:[ne.jsxs("div",{className:"form-group",children:[ne.jsx("label",{children:"New Profile Picture:"}),ne.jsx("input",{type:"file",accept:"image/*",onChange:Ue=>fe(Ue.target.files[0])})]}),ge&&ne.jsx("div",{className:"preview-image",children:ne.jsx("img",{src:URL.createObjectURL(ge),alt:"Preview"})}),ne.jsx("button",{type:"submit",className:"btn-update",children:"Update Photo"}),ne.jsx("button",{type:"button",className:"btn-cancel",onClick:ze,children:"Cancel"})]})]})})]})]})},h4={RegularBicycle:"Regular Bicycle",ElectricBicycle:"Electric Bicycle"},a3e=()=>{const[t,e]=st.useState([]),[n,r]=st.useState(!0),[s,l]=st.useState(null),[f,i]=st.useState(""),[x,S]=st.useState([]),[I,R]=st.useState([]),[F,j]=st.useState(!1);st.useEffect(()=>{H(),G(),W()},[]);const H=async()=>{try{const fe=(await fs(ca(Yr,"rentalRates"))).docs.map(ye=>({id:ye.id,...ye.data()}));e(fe)}catch(ge){console.error("Error fetching rental rates:",ge)}finally{r(!1)}},G=async()=>{try{const ge=ca(Yr,"rateHistory"),fe=x0(ge,tK("timestamp","desc")),pe=(await fs(fe)).docs.map(be=>({id:be.id,...be.data()}));S(pe)}catch(ge){console.error("Error fetching rate history:",ge)}},W=async()=>{try{const ge=ca(Yr,"stations"),fe=await fs(ge),ye=new Map;fe.forEach(Oe=>{const ue=Oe.data();ye.set(Oe.id,{id:Oe.id,stationName:ue.stationName,revenue:0,rides:{completed:0}})});const pe=ca(Yr,"ride_history");(await fs(pe)).docs.forEach(Oe=>{const ue=Oe.data();if(ue.endStation&&ue.amountPaid){const we=ye.get(ue.endStation);we&&(we.revenue+=Number(ue.amountPaid||0),we.rides.completed+=1)}});const Ae=Array.from(ye.values()).sort((Oe,ue)=>ue.revenue-Oe.revenue);R(Ae)}catch(ge){console.error("Error fetching station revenue:",ge)}},J=ge=>{var fe;l(ge),i(((fe=ge.pricePerMinute)==null?void 0:fe.toString())||"")},ie=()=>{l(null),i("")},he=async()=>{if(!s)return;const ge=parseFloat(f);if(isNaN(ge)||ge<=0){alert("Please enter a valid number greater than 0 for the price.");return}try{const fe=ol(Yr,"rentalRates",s.id);await ed(fe,{pricePerMinute:ge}),await ak(ca(Yr,"rateHistory"),{bikeType:s.id,oldPrice:s.pricePerMinute,newPrice:ge,timestamp:new Date,updatedBy:"admin"});const ye=t.map(pe=>pe.id===s.id?{...pe,pricePerMinute:ge}:pe);e(ye),await G(),ie()}catch(fe){console.error("Error updating rate:",fe),alert("Failed to update the rate. See console for details.")}};return ne.jsx(vv,{children:ne.jsxs("div",{className:"rate-management-container",children:[ne.jsx("h2",{children:"Rental Rate Management"}),n?ne.jsx("p",{children:"Loading..."}):ne.jsx("div",{className:"table-container",children:ne.jsxs("table",{className:"rate-table",children:[ne.jsx("thead",{children:ne.jsxs("tr",{children:[ne.jsx("th",{children:"Bike Type"}),ne.jsx("th",{children:"Price Per Minute (₱)"}),ne.jsx("th",{children:"Actions"})]})}),ne.jsx("tbody",{children:t.length>0?t.map(ge=>{var ye;const fe=h4[ge.id]||ge.id;return ne.jsxs("tr",{children:[ne.jsx("td",{children:fe}),ne.jsx("td",{children:(ye=ge.pricePerMinute)==null?void 0:ye.toFixed(2)}),ne.jsx("td",{children:ne.jsxs("button",{className:"edit-btn",onClick:()=>J(ge),children:[ne.jsx(N0,{})," Edit"]})})]},ge.id)}):ne.jsx("tr",{children:ne.jsx("td",{colSpan:"3",style:{textAlign:"center"},children:"No rental rates available."})})})]})}),ne.jsxs("div",{className:"revenue-section",children:[ne.jsx("h3",{children:"Station Revenue"}),ne.jsx("div",{className:"table-container",children:ne.jsxs("table",{className:"revenue-table",children:[ne.jsx("thead",{children:ne.jsxs("tr",{children:[ne.jsx("th",{children:"Station Name"}),ne.jsx("th",{children:"Total Revenue (₱)"}),ne.jsx("th",{children:"Total Rides"})]})}),ne.jsx("tbody",{children:I.map(ge=>ne.jsxs("tr",{children:[ne.jsx("td",{children:ge.stationName}),ne.jsx("td",{children:ge.revenue.toFixed(2)}),ne.jsx("td",{children:ge.rides.completed})]},ge.id))})]})})]}),ne.jsxs("div",{className:"history-section",children:[ne.jsxs("div",{className:"history-header",children:[ne.jsx("h3",{children:"Rate History"}),ne.jsxs("button",{className:"history-toggle-btn",onClick:()=>j(!F),children:[ne.jsx(Gce,{})," ",F?"Hide History":"Show History"]})]}),F&&ne.jsx("div",{className:"table-container",children:ne.jsxs("table",{className:"history-table",children:[ne.jsx("thead",{children:ne.jsxs("tr",{children:[ne.jsx("th",{children:"Date"}),ne.jsx("th",{children:"Bike Type"}),ne.jsx("th",{children:"Old Price (₱)"}),ne.jsx("th",{children:"New Price (₱)"}),ne.jsx("th",{children:"Updated By"})]})}),ne.jsx("tbody",{children:x.map(ge=>{var fe;return ne.jsxs("tr",{children:[ne.jsx("td",{children:io(ge.timestamp.toDate()).format("MMM D, YYYY HH:mm")}),ne.jsx("td",{children:h4[ge.bikeType]||ge.bikeType}),ne.jsx("td",{children:(fe=ge.oldPrice)==null?void 0:fe.toFixed(2)}),ne.jsx("td",{children:ge.newPrice.toFixed(2)}),ne.jsx("td",{children:ge.updatedBy})]},ge.id)})})]})})]}),s&&ne.jsx("div",{className:"modal-overlay",onClick:ie,children:ne.jsxs("div",{className:"modal-content",onClick:ge=>ge.stopPropagation(),children:[ne.jsx("h3",{children:"Edit Rental Rate"}),ne.jsxs("p",{children:["Bike Type:"," ",ne.jsx("strong",{children:h4[s.id]||s.id})]}),ne.jsx("label",{children:"Price Per Minute (₱):"}),ne.jsx("input",{type:"number",step:"0.01",value:f,onChange:ge=>i(ge.target.value)}),ne.jsxs("div",{className:"modal-buttons",children:[ne.jsx("button",{className:"save-btn",onClick:he,children:"Save"}),ne.jsx("button",{className:"cancel-btn",onClick:ie,children:"Cancel"})]})]})})]})})};var jA={exports:{}},s3e=jA.exports,O$;function o3e(){return O$||(O$=1,function(t,e){(function(n,r){t.exports=r()})(s3e,function(){var n="week",r="year";return function(s,l,f){var i=l.prototype;i.week=function(x){if(x===void 0&&(x=null),x!==null)return this.add(7*(x-this.week()),"day");var S=this.$locale().yearStart||1;if(this.month()===11&&this.date()>25){var I=f(this).startOf(r).add(1,r).date(S),R=f(this).endOf(n);if(I.isBefore(R))return 1}var F=f(this).startOf(r).date(S).startOf(n).subtract(1,"millisecond"),j=this.diff(F,n,!0);return j<0?f(this).startOf("week").week():Math.ceil(j)},i.weeks=function(x){return x===void 0&&(x=null),this.week(x)}}})}(jA)),jA.exports}var l3e=o3e();const c3e=Xa(l3e);var FA={exports:{}},u3e=FA.exports,R$;function h3e(){return R$||(R$=1,function(t,e){(function(n,r){t.exports=r()})(u3e,function(){return function(n,r,s){r.prototype.isBetween=function(l,f,i,x){var S=s(l),I=s(f),R=(x=x||"()")[0]==="(",F=x[1]===")";return(R?this.isAfter(S,i):!this.isBefore(S,i))&&(F?this.isBefore(I,i):!this.isAfter(I,i))||(R?this.isBefore(S,i):!this.isAfter(S,i))&&(F?this.isAfter(I,i):!this.isBefore(I,i))}}})}(FA)),FA.exports}var f3e=h3e();const d3e=Xa(f3e);io.extend(c3e);io.extend(d3e);const p3e=({text:t})=>{const e=new RegExp("(?<!CO)(?<![\\d.])(\\d+\\.?\\d*)","g"),n=t.split(e);return ne.jsx("span",{children:n.map((r,s)=>e.test(r)?ne.jsx("span",{className:"highlighted-number",children:r},s):ne.jsx("span",{children:r},s))})},C_=({title:t,analysis:e})=>ne.jsxs("div",{className:"analysis-card",children:[ne.jsx("h3",{children:t}),ne.jsx("p",{children:ne.jsx(p3e,{text:e})})]}),m3e=()=>{var he,ge,fe,ye;const[t,e]=st.useState([]),[n,r]=st.useState({calories:[],distance:[],duration:[],carbonSaved:[]}),[s,l]=st.useState([]),[f,i]=st.useState([]),[x,S]=st.useState("monthly"),[I,R]=st.useState([]),F=[{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"monthly",label:"Monthly"}],j=["#009C8C","#4CAF50","#2196F3","#FFA726","#FF5722","#9C27B0","#673AB7","#3F51B5","#00BCD4","#795548"],H=(pe,be)=>{const Ae=new Map,Oe=io();let ue,we;switch(be){case"daily":ue=Oe.subtract(6,"day").startOf("day"),we=Oe.endOf("day");break;case"weekly":ue=Oe.subtract(11,"week").startOf("week"),we=Oe.endOf("week");break;case"monthly":ue=Oe.subtract(11,"month").startOf("month"),we=Oe.endOf("month");break;default:const De=pe.map(je=>io(je.rideEndedAt));ue=io.min(De),we=Oe}let ke=ue;for(;ke.isBefore(we);){let De;switch(be){case"daily":De=ke.format("MMM DD"),ke=ke.add(1,"day");break;case"weekly":De=`Week ${ke.week()} - ${ke.format("MMM")}`,ke=ke.add(1,"week");break;case"monthly":De=ke.format("MMM YYYY"),ke=ke.add(1,"month");break}Ae.set(De,{period:De,revenue:0,calories:0,distance:0,duration:0,carbonSaved:0,rides:0})}return pe.forEach(De=>{const je=io(De.rideEndedAt);if(je.isBetween(ue,we,null,"[]")){let ze;switch(be){case"daily":ze=je.format("MMM DD");break;case"weekly":ze=`Week ${je.week()} - ${je.format("MMM")}`;break;case"monthly":ze=je.format("MMM YYYY");break}if(Ae.has(ze)){const Ue=Ae.get(ze);Ue.revenue+=Number(De.amountPaid||0),Ue.calories+=Number(De.caloriesBurned||0),Ue.distance+=Number(De.distance||0),Ue.duration+=Number(De.duration||0)/60,Ue.carbonSaved+=Number(De.carbonSaved||0),Ue.rides+=1}}}),Array.from(Ae.values()).map(De=>({...De,avgCalories:De.rides>0?De.calories/De.rides:0,avgDistance:De.rides>0?De.distance/De.rides:0,avgDuration:De.rides>0?De.duration/De.rides:0,avgCarbonSaved:De.rides>0?De.carbonSaved/De.rides:0}))},G=(pe,be)=>{const Ae=io();switch(be){case"daily":return pe.filter(Oe=>io(Oe.rideEndedAt).isSame(Ae,"day"));case"weekly":return pe.filter(Oe=>io(Oe.rideEndedAt).isAfter(Ae.subtract(1,"week")));case"monthly":return pe.filter(Oe=>io(Oe.rideEndedAt).isAfter(Ae.subtract(1,"month")));default:return pe}},W=(pe,be)=>{if(!pe||pe.length===0)return"No data available";const Ae=G(I,x),Oe=Ae.reduce((ke,De)=>{switch(be){case"revenue":return ke+(De.amountPaid||0);case"calories":return ke+(De.caloriesBurned||0);case"distance":return ke+(De.distance||0);case"duration":return ke+(De.duration||0)/60;case"carbonSaved":return ke+(De.carbonSaved||0);default:return ke}},0),ue=Ae.length,we=x==="daily"?"today":x==="weekly"?"this week":"this month";switch(be){case"revenue":const ke=ue>0?Oe/ue:0;return`The EcoRide Parada system generated ₱${Oe.toFixed(2)} in revenue ${we}. 
                With ${ue} rides completed, residents spent an average of ₱${ke.toFixed(2)} per trip. 
                These funds support system maintenance and expansion, creating sustainable transportation
                infrastructure for Barangay Parada while providing an affordable alternative to motor vehicles.`;case"calories":return`Barangay Parada residents burned ${Oe.toFixed(0)} calories through cycling ${we}, 
                equivalent to approximately ${Math.round(Oe/100)} healthy meals worth of energy. 
                This active transportation promotes community health and wellness, potentially reducing healthcare 
                costs by ₱${(Oe*.05).toFixed(2)} through preventative exercise. Regular cyclists in Parada 
                report improved cardiovascular health and reduced stress levels, creating a healthier community.`;case"distance":const De=Oe*.251,je=Oe*.15;return`EcoRide users covered ${Oe.toFixed(2)} km by bike ${we}, directly alleviating 
                traffic congestion in Barangay Parada's busiest corridors. This represents approximately 
                ${Math.round(Oe/3)} car trips removed from local roads, reducing congestion by an 
                estimated ${je.toFixed(1)}%. Each kilometer cycled improves traffic flow 
                while preventing ${De.toFixed(2)} kg of CO2 emissions, supporting Parada's 
                commitment to sustainable urban mobility.`;case"duration":const ze=Math.floor(Oe/60),Ue=Math.floor(Oe%60),Fe=ue*5,Qe=Oe*.3;return`Barangay Parada cyclists spent ${ze} hours and ${Ue} minutes riding ${we}. 
                By choosing EcoRide over cars, residents collectively saved approximately ${Math.round(Fe/60+Qe)} hours 
                on parking and traffic delays. This represents significant quality-of-life improvement for
                community members while reducing road congestion by an estimated ${Math.round(ue*.8)} vehicles during 
                peak hours, improving mobility for all Parada residents.`;case"carbonSaved":const Be=(Oe/21).toFixed(1),bt=(Oe/.251).toFixed(1),xe=(Oe*.05).toFixed(1);return`The EcoRide system prevented ${Oe.toFixed(2)} kg of CO2 emissions in Barangay Parada ${we}, 
                equivalent to the yearly CO2 absorption of ${Be} trees. This translates to approximately 
                ${bt} km of car travel removed from local roads and an estimated ${xe}% 
                improvement in local air quality. Every ride contributes to Parada's sustainability goals, helping 
                transform the barangay into a model for eco-friendly transportation in Metro Manila.`;default:return"No analysis available"}},J=async()=>{try{const pe=ca(Yr,"ride_history"),Ae=(await fs(pe)).docs.map(Ue=>{var Qe;const Fe=Ue.data();return{id:Ue.id,...Fe,rideEndedAt:(Qe=Fe.rideEndedAt)!=null&&Qe.toDate?Fe.rideEndedAt.toDate():new Date(Fe.rideEndedAt.seconds*1e3),distance:Fe.distance||0,duration:Fe.duration||0,amountPaid:Fe.amountPaid||0,caloriesBurned:Fe.caloriesBurned||0,carbonSaved:Fe.carbonSaved||0}});R(Ae),console.log("Total rides in SystemAnalytics:",Ae.length);const Oe=H(Ae,"monthly"),ue=H(Ae,"weekly"),we=H(Ae,"daily");l({monthly:Oe,weekly:ue,daily:we});const ke=ca(Yr,"stations"),De=await fs(ke),je=new Map;De.forEach(Ue=>{const Fe=Ue.data();je.set(Ue.id,{stationName:Fe.stationName,revenue:0,rides:0})}),Ae.forEach(Ue=>{if(Ue.startStation){const Fe=je.get(Ue.startStation);Fe&&(Fe.revenue+=Number(Ue.amountPaid),Fe.rides+=1)}});const ze=Array.from(je.values()).sort((Ue,Fe)=>Fe.revenue-Ue.revenue);e(ze),i(ze.sort((Ue,Fe)=>Fe.rides-Ue.rides))}catch(pe){console.error("Error fetching analytics:",pe)}};st.useEffect(()=>{J()},[]);const ie=(pe,be)=>pe[be]||[];return ne.jsx(vv,{children:ne.jsxs("div",{className:"analytics-container",children:[ne.jsxs("div",{className:"analytics-header",children:[ne.jsx("h1",{children:"System Analytics"}),ne.jsx("div",{className:"time-filter",children:F.map(pe=>ne.jsx("button",{className:`filter-btn ${x===pe.value?"active":""}`,onClick:()=>S(pe.value),children:pe.label},pe.value))})]}),ne.jsxs("div",{className:"charts-grid",children:[ne.jsxs("div",{className:"chart-section full-width",children:[ne.jsx("h2",{children:"Revenue Trend"}),ne.jsxs("div",{className:"chart-with-analysis",children:[ne.jsx(fm,{width:"100%",height:500,children:ne.jsxs(hx,{data:ie(s,x),margin:{top:20,right:30,left:20,bottom:90},children:[ne.jsx("defs",{children:ne.jsxs("linearGradient",{id:"revenueGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[ne.jsx("stop",{offset:"5%",stopColor:"#009C8C",stopOpacity:.8}),ne.jsx("stop",{offset:"95%",stopColor:"#009C8C",stopOpacity:.1})]})}),ne.jsx(dm,{strokeDasharray:"3 3"}),ne.jsx(wf,{dataKey:"period",angle:-45,textAnchor:"end",height:80,interval:0}),ne.jsx(Sf,{tickFormatter:pe=>`₱${pe.toFixed(0)}`,label:{value:"Revenue (₱)",angle:-90,position:"insideLeft",offset:10,dy:50}}),ne.jsx(Rc,{formatter:pe=>[`₱${pe.toFixed(2)}`,"Revenue"]}),ne.jsx(Nd,{verticalAlign:"bottom",height:36,wrapperStyle:{paddingTop:"20px",marginBottom:"10px"}}),ne.jsx(jd,{type:"monotone",dataKey:"revenue",stroke:"#009C8C",fill:"url(#revenueGradient)",name:"Revenue",dot:{r:4}})]})}),ne.jsx(C_,{title:"Revenue Analysis",analysis:W(ie(s,x),"revenue")})]})]}),ne.jsxs("div",{className:"chart-section full-width",children:[ne.jsx("h2",{children:"Revenue by Station"}),ne.jsxs("div",{className:"chart-with-analysis",children:[ne.jsx(fm,{width:"100%",height:500,children:ne.jsxs(_D,{data:t.filter(pe=>pe.revenue>0),margin:{top:20,right:30,left:20,bottom:120},children:[ne.jsx(dm,{strokeDasharray:"3 3"}),ne.jsx(wf,{dataKey:"stationName",angle:-45,textAnchor:"end",height:100,interval:0,tick:{fontSize:12}}),ne.jsx(Sf,{tickFormatter:pe=>`₱${pe.toFixed(2)}`}),ne.jsx(Rc,{formatter:pe=>`₱${pe.toFixed(2)}`}),ne.jsx(xg,{dataKey:"revenue",children:t.filter(pe=>pe.revenue>0).map((pe,be)=>ne.jsx(uw,{fill:j[be%j.length]},`cell-${be}`))})]})}),ne.jsx(C_,{title:"Station Revenue Analysis",analysis:`The top earning station is ${((he=t[0])==null?void 0:he.stationName)||"N/A"} with ₱${(ge=t[0])==null?void 0:ge.revenue.toFixed(2)} in revenue. There are ${t.filter(pe=>pe.revenue>0).length} stations generating revenue, with a total system revenue of ₱${t.reduce((pe,be)=>pe+be.revenue,0).toFixed(2)}.`})]})]}),ne.jsxs("div",{className:"chart-section full-width",children:[ne.jsx("h2",{children:"Average Calories Burned"}),ne.jsxs("div",{className:"chart-with-analysis",children:[ne.jsx(fm,{width:"100%",height:500,children:ne.jsxs(hx,{data:ie(s,x),margin:{top:20,right:30,left:20,bottom:70},children:[ne.jsx("defs",{children:ne.jsxs("linearGradient",{id:"caloriesGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[ne.jsx("stop",{offset:"5%",stopColor:"#FF5722",stopOpacity:.8}),ne.jsx("stop",{offset:"95%",stopColor:"#FF5722",stopOpacity:.1})]})}),ne.jsx(dm,{strokeDasharray:"3 3"}),ne.jsx(wf,{dataKey:"period"}),ne.jsx(Sf,{}),ne.jsx(Rc,{}),ne.jsx(Nd,{}),ne.jsx(jd,{type:"monotone",dataKey:"calories",stroke:"#FF5722",fill:"url(#caloriesGradient)",name:"Calories Burned",dot:{fill:"#FF5722"}})]})}),ne.jsx(C_,{title:"Health Impact Analysis",analysis:W(ie(s,x),"calories")})]})]}),ne.jsxs("div",{className:"chart-section full-width",children:[ne.jsx("h2",{children:"Average Distance Covered"}),ne.jsxs("div",{className:"chart-with-analysis",children:[ne.jsx(fm,{width:"100%",height:500,children:ne.jsxs(hx,{data:ie(s,x),margin:{top:20,right:30,left:20,bottom:70},children:[ne.jsx("defs",{children:ne.jsxs("linearGradient",{id:"distanceGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[ne.jsx("stop",{offset:"5%",stopColor:"#2196F3",stopOpacity:.8}),ne.jsx("stop",{offset:"95%",stopColor:"#2196F3",stopOpacity:.1})]})}),ne.jsx(dm,{strokeDasharray:"3 3"}),ne.jsx(wf,{dataKey:"period"}),ne.jsx(Sf,{}),ne.jsx(Rc,{}),ne.jsx(Nd,{}),ne.jsx(jd,{type:"monotone",dataKey:"distance",stroke:"#2196F3",fill:"url(#distanceGradient)",name:"Distance (km)",dot:{fill:"#2196F3"}})]})}),ne.jsx(C_,{title:"Distance Analysis",analysis:W(ie(s,x),"distance")})]})]}),ne.jsxs("div",{className:"chart-section full-width",children:[ne.jsx("h2",{children:"Average Ride Duration"}),ne.jsxs("div",{className:"chart-with-analysis",children:[ne.jsx(fm,{width:"100%",height:500,children:ne.jsxs(hx,{data:ie(s,x),margin:{top:20,right:30,left:20,bottom:70},children:[ne.jsx("defs",{children:ne.jsxs("linearGradient",{id:"durationGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[ne.jsx("stop",{offset:"5%",stopColor:"#9C27B0",stopOpacity:.8}),ne.jsx("stop",{offset:"95%",stopColor:"#9C27B0",stopOpacity:.1})]})}),ne.jsx(dm,{strokeDasharray:"3 3"}),ne.jsx(wf,{dataKey:"period"}),ne.jsx(Sf,{}),ne.jsx(Rc,{formatter:(pe,be)=>[`${pe.toFixed(0)} minutes`,"Duration"]}),ne.jsx(Nd,{}),ne.jsx(jd,{type:"monotone",dataKey:"duration",stroke:"#9C27B0",fill:"url(#durationGradient)",name:"Duration (minutes)",dot:{fill:"#9C27B0"}})]})}),ne.jsx(C_,{title:"Duration Analysis",analysis:W(ie(s,x),"duration")})]})]}),ne.jsxs("div",{className:"chart-section full-width",children:[ne.jsx("h2",{children:"Average CO2 Saved"}),ne.jsxs("div",{className:"chart-with-analysis",children:[ne.jsx(fm,{width:"100%",height:500,children:ne.jsxs(hx,{data:ie(s,x),margin:{top:20,right:30,left:20,bottom:70},children:[ne.jsx("defs",{children:ne.jsxs("linearGradient",{id:"co2Gradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[ne.jsx("stop",{offset:"5%",stopColor:"#4CAF50",stopOpacity:.8}),ne.jsx("stop",{offset:"95%",stopColor:"#4CAF50",stopOpacity:.1})]})}),ne.jsx(dm,{strokeDasharray:"3 3"}),ne.jsx(wf,{dataKey:"period"}),ne.jsx(Sf,{}),ne.jsx(Rc,{}),ne.jsx(Nd,{}),ne.jsx(jd,{type:"monotone",dataKey:"carbonSaved",stroke:"#4CAF50",fill:"url(#co2Gradient)",name:"CO2 Saved (kg)",dot:{fill:"#4CAF50"}})]})}),ne.jsx(C_,{title:"Environmental Impact Analysis",analysis:W(ie(s,x),"carbonSaved")})]})]}),ne.jsxs("div",{className:"chart-section full-width",children:[ne.jsx("h2",{children:"Most Popular Stations"}),ne.jsxs("div",{className:"chart-with-analysis",children:[ne.jsxs(fm,{width:"100%",height:600,children:[" ",ne.jsxs(GAe,{children:[ne.jsx(Mg,{data:f.filter(pe=>pe.rides>0).slice(0,5),dataKey:"rides",nameKey:"stationName",cx:"50%",cy:"50%",outerRadius:180,label:({name:pe,percent:be})=>`${pe} ${(be*100).toFixed(0)}%`,children:f.filter(pe=>pe.rides>0).slice(0,5).map((pe,be)=>ne.jsx(uw,{fill:j[be%j.length]},`cell-${be}`))}),ne.jsx(Rc,{formatter:(pe,be)=>[`${pe} rides`,be]}),ne.jsx(Nd,{verticalAlign:"bottom",height:36})]})]}),ne.jsx(C_,{title:"Station Usage Analysis",analysis:`The top ${f.filter(pe=>pe.rides>0).slice(0,5).length} stations account for ${f.filter(pe=>pe.rides>0).slice(0,5).reduce((pe,be)=>pe+be.rides,0)} rides. ${((fe=f[0])==null?void 0:fe.stationName)||"N/A"} is the most active station with ${((ye=f[0])==null?void 0:ye.rides)||0} rides.`})]})]})]})]})})},g3e=()=>{const[t,e]=st.useState([]),[n,r]=st.useState({}),[s,l]=st.useState({}),[f,i]=st.useState({}),[x,S]=st.useState(!0),[I,R]=st.useState("all"),[F,j]=st.useState({key:"rideEndedAt",direction:"desc"}),[H,G]=st.useState(1),W=10,[J,ie]=st.useState({totalRides:0,totalRevenue:0,totalDistance:0,totalDuration:0,totalCalories:0,totalCarbonSaved:0});st.useEffect(()=>{he()},[]);const he=async()=>{try{const Ae=ca(Yr,"bikes"),Oe=await fs(Ae),ue={};Oe.docs.forEach(bt=>{ue[bt.id]=bt.data()}),r(ue);const we=ca(Yr,"approved_users"),ke=await fs(we),De={};ke.docs.forEach(bt=>{const xe=bt.data();De[bt.id]=`${xe.first_name} ${xe.surname}`}),l(De);const je=ca(Yr,"stations"),ze=await fs(je),Ue={};ze.docs.forEach(bt=>{Ue[bt.id]=bt.data().stationName}),i(Ue);const Fe=ca(Yr,"ride_history"),Be=(await fs(Fe)).docs.map(bt=>{var xe;return{id:bt.id,...bt.data(),rideEndedAt:((xe=bt.data().rideEndedAt)==null?void 0:xe.toDate())||new Date(bt.data().rideEndedAt.seconds*1e3)}});e(Be),S(!1)}catch(Ae){console.error("Error fetching data:",Ae),S(!1)}},ge=Ae=>{const Oe=io();switch(I){case"today":return Ae.filter(ue=>io(ue.rideEndedAt).isSame(Oe,"day"));case"week":return Ae.filter(ue=>io(ue.rideEndedAt).isAfter(Oe.subtract(1,"week")));case"month":return Ae.filter(ue=>io(ue.rideEndedAt).isAfter(Oe.subtract(1,"month")));default:return Ae}};st.useEffect(()=>{const Oe=ge(t).reduce((ue,we)=>({totalRides:ue.totalRides+1,totalRevenue:ue.totalRevenue+(we.amountPaid||0),totalDistance:ue.totalDistance+(we.distance||0),totalDuration:ue.totalDuration+(we.duration||0),totalCalories:ue.totalCalories+(we.caloriesBurned||0),totalCarbonSaved:ue.totalCarbonSaved+(we.carbonSaved||0)}),{totalRides:0,totalRevenue:0,totalDistance:0,totalDuration:0,totalCalories:0,totalCarbonSaved:0});ie(Oe)},[t,I]);const fe=Ae=>{j({key:Ae,direction:F.key===Ae&&F.direction==="asc"?"desc":"asc"})},ye=kt.useMemo(()=>[...ge(t)].sort((Oe,ue)=>F.key==="rideEndedAt"?F.direction==="asc"?Oe[F.key]-ue[F.key]:ue[F.key]-Oe[F.key]:F.direction==="asc"?Oe[F.key]>ue[F.key]?1:-1:Oe[F.key]<ue[F.key]?1:-1),[t,I,F]),pe=ye.slice((H-1)*W,H*W),be=Math.ceil(ye.length/W);return ne.jsx(vv,{children:ne.jsxs("div",{className:"ride-details-container",children:[ne.jsx("h1",{children:"Ride Details"}),ne.jsx("div",{className:"controls",children:ne.jsxs("div",{className:"time-filter",children:[ne.jsx("button",{className:`filter-btn ${I==="all"?"active":""}`,onClick:()=>R("all"),children:"All Time"}),ne.jsx("button",{className:`filter-btn ${I==="today"?"active":""}`,onClick:()=>R("today"),children:"Today"}),ne.jsx("button",{className:`filter-btn ${I==="week"?"active":""}`,onClick:()=>R("week"),children:"This Week"}),ne.jsx("button",{className:`filter-btn ${I==="month"?"active":""}`,onClick:()=>R("month"),children:"This Month"})]})}),ne.jsxs("div",{className:"stats-grid",children:[ne.jsxs("div",{className:"stat-card",children:[ne.jsx("h3",{children:"Total Rides"}),ne.jsx("p",{children:J.totalRides})]}),ne.jsxs("div",{className:"stat-card",children:[ne.jsx("h3",{children:"Total Revenue"}),ne.jsxs("p",{children:["₱",J.totalRevenue.toFixed(2)]})]}),ne.jsxs("div",{className:"stat-card",children:[ne.jsx("h3",{children:"Total Distance"}),ne.jsxs("p",{children:[J.totalDistance.toFixed(2)," km"]})]}),ne.jsxs("div",{className:"stat-card",children:[ne.jsx("h3",{children:"Total Duration"}),ne.jsxs("p",{children:[Math.round(J.totalDuration/60)," min"]})]}),ne.jsxs("div",{className:"stat-card",children:[ne.jsx("h3",{children:"Calories Burned"}),ne.jsxs("p",{children:[Math.round(J.totalCalories)," cal"]})]}),ne.jsxs("div",{className:"stat-card",children:[ne.jsx("h3",{children:"CO2 Saved"}),ne.jsxs("p",{children:[J.totalCarbonSaved.toFixed(2)," kg"]})]})]}),x?ne.jsx("div",{className:"loading",children:"Loading..."}):ne.jsxs(ne.Fragment,{children:[ne.jsx("div",{className:"table-container",children:ne.jsxs("table",{children:[ne.jsx("thead",{children:ne.jsxs("tr",{children:[ne.jsxs("th",{onClick:()=>fe("rideEndedAt"),children:["Date"," ",F.key==="rideEndedAt"&&(F.direction==="asc"?"↑":"↓")]}),ne.jsxs("th",{onClick:()=>fe("userId"),children:["User"," ",F.key==="userId"&&(F.direction==="asc"?"↑":"↓")]}),ne.jsxs("th",{onClick:()=>fe("bikeId"),children:["Bike"," ",F.key==="bikeId"&&(F.direction==="asc"?"↑":"↓")]}),ne.jsxs("th",{onClick:()=>fe("duration"),children:["Duration"," ",F.key==="duration"&&(F.direction==="asc"?"↑":"↓")]}),ne.jsxs("th",{onClick:()=>fe("distance"),children:["Distance"," ",F.key==="distance"&&(F.direction==="asc"?"↑":"↓")]}),ne.jsxs("th",{onClick:()=>fe("caloriesBurned"),children:["Calories"," ",F.key==="caloriesBurned"&&(F.direction==="asc"?"↑":"↓")]}),ne.jsxs("th",{onClick:()=>fe("carbonSaved"),children:["CO2 Saved"," ",F.key==="carbonSaved"&&(F.direction==="asc"?"↑":"↓")]}),ne.jsxs("th",{onClick:()=>fe("amountPaid"),children:["Amount"," ",F.key==="amountPaid"&&(F.direction==="asc"?"↑":"↓")]}),ne.jsx("th",{children:"Start Station"}),ne.jsx("th",{children:"End Station"})]})}),ne.jsx("tbody",{children:pe.map(Ae=>{var Oe,ue,we,ke;return ne.jsxs("tr",{children:[ne.jsx("td",{children:io(Ae.rideEndedAt).format("MMM D, YYYY HH:mm")}),ne.jsx("td",{children:s[Ae.userId]||"Unknown User"}),ne.jsx("td",{children:((Oe=n[Ae.bikeId])==null?void 0:Oe.bikeName)||"Unknown Bike"}),ne.jsxs("td",{children:[Math.round(Ae.duration/60)," min"]}),ne.jsxs("td",{children:[((ue=Ae.distance)==null?void 0:ue.toFixed(2))||0," km"]}),ne.jsxs("td",{children:[Math.round(Ae.caloriesBurned)||0," cal"]}),ne.jsxs("td",{children:[((we=Ae.carbonSaved)==null?void 0:we.toFixed(2))||0," kg"]}),ne.jsxs("td",{children:["₱",((ke=Ae.amountPaid)==null?void 0:ke.toFixed(2))||0]}),ne.jsx("td",{children:f[Ae.startStation]||"Unknown Station"}),ne.jsx("td",{children:f[Ae.endStation]||"Unknown Station"})]},Ae.id)})})]})}),ne.jsxs("div",{className:"pagination-controls",children:[ne.jsx("button",{className:"pagination-button",onClick:()=>G(Ae=>Math.max(1,Ae-1)),disabled:H===1,children:"Previous"}),ne.jsxs("span",{className:"pagination-info",children:["Page ",H," of ",be]}),ne.jsx("button",{className:"pagination-button",onClick:()=>G(Ae=>Math.min(be,Ae+1)),disabled:H===be,children:"Next"})]})]})]})})};class y3e extends kt.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,n){console.error("Error caught by boundary:",e,n)}render(){return this.state.hasError?ne.jsxs("div",{className:"error-container",children:[ne.jsx("h2",{children:"Something went wrong."}),ne.jsx("p",{children:"Please refresh the page or try again later."})]}):this.props.children}}const _3e=()=>{const[t,e]=st.useState(null);return st.useEffect(()=>{m2.onAuthStateChanged(n=>{e(n)})},[]),ne.jsx(y3e,{children:ne.jsx(Wte,{children:ne.jsxs(Ate,{children:[ne.jsx(bp,{path:"/login",element:t?ne.jsx(IO,{}):ne.jsx(lm,{})}),ne.jsx(bp,{path:"/dashboard",element:t?ne.jsx(IO,{}):ne.jsx(lm,{})}),ne.jsx(bp,{path:"/user-management",element:t?ne.jsx(tTe,{}):ne.jsx(lm,{})}),ne.jsx(bp,{path:"/bike-management",element:t?ne.jsx(QEe,{}):ne.jsx(lm,{})}),ne.jsx(bp,{path:"/stations",element:t?ne.jsx(r3e,{}):ne.jsx(lm,{})}),ne.jsx(bp,{path:"/admin-management",element:t?ne.jsx(i3e,{}):ne.jsx(lm,{})}),ne.jsx(bp,{path:"/rate-management",element:t?ne.jsx(a3e,{}):ne.jsx(lm,{})}),ne.jsx(bp,{path:"/system-analytics",element:t?ne.jsx(m3e,{}):ne.jsx(lm,{})}),ne.jsx(bp,{path:"/ride-details",element:t?ne.jsx(g3e,{}):ne.jsx(lm,{})}),ne.jsx(bp,{path:"/",element:t?ne.jsx(IO,{}):ne.jsx(lm,{})})]})})})};Lee.createRoot(document.getElementById("root")).render(ne.jsx(st.StrictMode,{children:ne.jsx(_3e,{})}));export{ks as _,BS as c,Xa as g};
